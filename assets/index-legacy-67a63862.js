!function(){function e(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var r,n,s,a,o=[],h=!0,u=!1;try{if(s=(i=i.call(e)).next,0===t){if(Object(i)!==i)return;h=!1}else for(;!(h=(r=s.call(i)).done)&&(o.push(r.value),o.length!==t);h=!0);}catch(l){u=!0,n=l}finally{try{if(!h&&null!=i.return&&(a=i.return(),Object(a)!==a))return}finally{if(u)throw n}}return o}}(e,t)||h(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */t=function(){return e};var e={},i=Object.prototype,r=i.hasOwnProperty,n=Object.defineProperty||function(e,t,i){e[t]=i.value},s="function"==typeof Symbol?Symbol:{},a=s.iterator||"@@iterator",o=s.asyncIterator||"@@asyncIterator",h=s.toStringTag||"@@toStringTag";function u(e,t,i){return Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(R){u=function(e,t,i){return e[t]=i}}function l(e,t,i,r){var s=t&&t.prototype instanceof p?t:p,a=Object.create(s.prototype),o=new C(r||[]);return n(a,"_invoke",{value:w(e,i,o)}),a}function c(e,t,i){try{return{type:"normal",arg:e.call(t,i)}}catch(R){return{type:"throw",arg:R}}}e.wrap=l;var d={};function p(){}function g(){}function f(){}var m={};u(m,a,(function(){return this}));var _=Object.getPrototypeOf,v=_&&_(_(E([])));v&&v!==i&&r.call(v,a)&&(m=v);var y=f.prototype=p.prototype=Object.create(m);function x(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){function i(n,s,a,o){var h=c(e[n],e,s);if("throw"!==h.type){var u=h.arg,l=u.value;return l&&"object"==typeof l&&r.call(l,"__await")?t.resolve(l.__await).then((function(e){i("next",e,a,o)}),(function(e){i("throw",e,a,o)})):t.resolve(l).then((function(e){u.value=e,a(u)}),(function(e){return i("throw",e,a,o)}))}o(h.arg)}var s;n(this,"_invoke",{value:function(e,r){function n(){return new t((function(t,n){i(e,r,t,n)}))}return s=s?s.then(n,n):n()}})}function w(e,t,i){var r="suspendedStart";return function(n,s){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===n)throw s;return I()}for(i.method=n,i.arg=s;;){var a=i.delegate;if(a){var o=T(a,i);if(o){if(o===d)continue;return o}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if("suspendedStart"===r)throw r="completed",i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);r="executing";var h=c(e,t,i);if("normal"===h.type){if(r=i.done?"completed":"suspendedYield",h.arg===d)continue;return{value:h.arg,done:i.done}}"throw"===h.type&&(r="completed",i.method="throw",i.arg=h.arg)}}}function T(e,t){var i=t.method,r=e.iterator[i];if(void 0===r)return t.delegate=null,"throw"===i&&e.iterator.return&&(t.method="return",t.arg=void 0,T(e,t),"throw"===t.method)||"return"!==i&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+i+"' method")),d;var n=c(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,d;var s=n.arg;return s?s.done?(t[e.resultName]=s.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):s:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function A(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function E(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,n=function t(){for(;++i<e.length;)if(r.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=void 0,t.done=!0,t};return n.next=n}}return{next:I}}function I(){return{value:void 0,done:!0}}return g.prototype=f,n(y,"constructor",{value:f,configurable:!0}),n(f,"constructor",{value:g,configurable:!0}),g.displayName=u(f,h,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,u(e,h,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},x(b.prototype),u(b.prototype,o,(function(){return this})),e.AsyncIterator=b,e.async=function(t,i,r,n,s){void 0===s&&(s=Promise);var a=new b(l(t,i,r,n),s);return e.isGeneratorFunction(i)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},x(y),u(y,h,"Generator"),u(y,a,(function(){return this})),u(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),i=[];for(var r in t)i.push(r);return i.reverse(),function e(){for(;i.length;){var r=i.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=E,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(A),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function i(i,r){return a.type="throw",a.arg=e,t.next=i,r&&(t.method="next",t.arg=void 0),!!r}for(var n=this.tryEntries.length-1;n>=0;--n){var s=this.tryEntries[n],a=s.completion;if("root"===s.tryLoc)return i("end");if(s.tryLoc<=this.prev){var o=r.call(s,"catchLoc"),h=r.call(s,"finallyLoc");if(o&&h){if(this.prev<s.catchLoc)return i(s.catchLoc,!0);if(this.prev<s.finallyLoc)return i(s.finallyLoc)}else if(o){if(this.prev<s.catchLoc)return i(s.catchLoc,!0)}else{if(!h)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return i(s.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var n=this.tryEntries[i];if(n.tryLoc<=this.prev&&r.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var s=n;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var a=s?s.completion:{};return a.type=e,a.arg=t,s?(this.method="next",this.next=s.finallyLoc,d):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.finallyLoc===e)return this.complete(i.completion,i.afterLoc),A(i),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.tryLoc===e){var r=i.completion;if("throw"===r.type){var n=r.arg;A(i)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,i){return this.delegate={iterator:E(e),resultName:t,nextLoc:i},"next"===this.method&&(this.arg=void 0),d}},e}function i(e,t,i,r,n,s,a){try{var o=e[s](a),h=o.value}catch(u){return void i(u)}o.done?t(h):Promise.resolve(h).then(r,n)}function r(e){return function(){var t=this,r=arguments;return new Promise((function(n,s){var a=e.apply(t,r);function o(e){i(a,n,s,o,h,"next",e)}function h(e){i(a,n,s,o,h,"throw",e)}o(void 0)}))}}function n(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function s(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?n(Object(i),!0).forEach((function(t){a(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):n(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function a(e,t,i){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function o(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=h(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var r=0,n=function(){};return{s:n,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,o=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return a=e.done,e},e:function(e){o=!0,s=e},f:function(){try{a||null==i.return||i.return()}finally{if(o)throw s}}}}function h(e,t){if(e){if("string"==typeof e)return u(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?u(e,t):void 0}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}System.register([],(function(i,n){"use strict";return{execute:function(){var i={},n={},a={get(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,n=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(null!==e){for(var t=(arguments.length>1?arguments[1]:void 0).split("."),i=0;i<t.length;i++)e=e[t[i]]=void 0!==e[t[i]]?e[t[i]]:{};return"object"==typeof e&&null!==e?Object.keys(e).length?e:void 0:e}}(i[e],t);return void 0!==n?n:r},has(e,t){return!!this.get(e,t)},set(e,t){i.user[e]=t,((e,t)=>{n[e]&&n[e].forEach((e=>e(t)))})(e,t)},subscribe(e,t){n[e]=n[e]||[],n[e].push(t)},unsubscribe(e,t){if(t){var i=n[e]&&n[e].findIndex((e=>e===t));i>-1&&n[e].splice(i,1)}else e in n&&(n[e]=[])},clearSubscribers(){var e,t=o(Object.getOwnPropertyNames(n));try{for(t.s();!(e=t.n()).done;){var i=e.value;delete n[i]}}catch(r){t.e(r)}finally{t.f()}}},h=(e,t)=>["%c"+((t=Array.from(t)).length>1&&"string"==typeof t[0]?t.shift():e),"background-color: "+{Info:"green",Debug:"gray",Warn:"orange",Error:"red"}[e]+"; color: white; padding: 2px 4px; border-radius: 2px",t],u={info(){a.get("platform","log")&&console.log.apply(console,h("Info",arguments))},debug(){a.get("platform","log")&&console.debug.apply(console,h("Debug",arguments))},error(){a.get("platform","log")&&console.error.apply(console,h("Error",arguments))},warn(){a.get("platform","log")&&console.warn.apply(console,h("Warn",arguments))}};class l{static mergeNumbers(e,t,i){return e*i+t*(1-i)}static rgb(e,t,i){return(e<<16)+(t<<8)+i+4278190080}static rgba(e,t,i,r){return(e<<16)+(t<<8)+i+16777216*(255*r|0)}static getRgbString(e){return"rgb("+(e/65536|0)%256+","+(e/256|0)%256+","+e%256+")"}static getRgbaString(e){return"rgba("+(e/65536|0)%256+","+(e/256|0)%256+","+e%256+","+((e/16777216|0)/255).toFixed(4)+")"}static getRgbaStringFromArray(e){return"rgba("+Math.floor(255*e[0])+","+Math.floor(255*e[1])+","+Math.floor(255*e[2])+","+(Math.floor(255*e[3])/255).toFixed(4)+")"}static getRgbaComponentsNormalized(e){return[(e/65536|0)%256/255,(e/256|0)%256/255,e%256/255,(e/16777216|0)/255]}static getRgbComponentsNormalized(e){return[(e/65536|0)%256/255,(e/256|0)%256/255,e%256/255]}static getRgbaComponents(e){return[(e/65536|0)%256,(e/256|0)%256,e%256,e/16777216|0]}static getArgbNumber(e){e[0]=Math.max(0,Math.min(255,e[0])),e[1]=Math.max(0,Math.min(255,e[1])),e[2]=Math.max(0,Math.min(255,e[2])),e[3]=Math.max(0,Math.min(255,e[3]));var t=((0|e[3])<<24)+((0|e[0])<<16)+((0|e[1])<<8)+(0|e[2]);return t<0&&(t=4294967295+t+1),t}static mergeColors(e,t,i){var r=(e/65536|0)%256*i+(t/65536|0)%256*(1-i),n=(e/256|0)%256*i+(t/256|0)%256*(1-i),s=e%256*i+t%256*(1-i),a=(e/16777216|0)*i+(t/16777216|0)*(1-i);return 16777216*Math.round(a)+65536*Math.round(r)+256*Math.round(n)+Math.round(s)}static mergeMultiColors(e,t){for(var i=0,r=0,n=0,s=0,a=0,o=e.length,h=0;h<o;h++){var u=(e[h]/65536|0)%256,l=(e[h]/256|0)%256,c=e[h]%256,d=e[h]/16777216|0;i+=u*t[h],r+=l*t[h],n+=c*t[h],s+=d*t[h],a+=t[h]}return a=1/a,16777216*Math.round(s*a)+65536*Math.round(i*a)+256*Math.round(r*a)+Math.round(n*a)}static mergeMultiColorsEqual(e){for(var t=0,i=0,r=0,n=0,s=0,a=e.length,o=0;o<a;o++){t+=(e[o]/65536|0)%256,i+=(e[o]/256|0)%256,r+=e[o]%256,n+=e[o]/16777216|0,s+=1}return s=1/s,16777216*Math.round(n*s)+65536*Math.round(t*s)+256*Math.round(i*s)+Math.round(r*s)}static mergeColorAlpha(e,t){var i=(e/16777216|0)*t|0;return((e>>16&255)*i/255&255)+((65280&e)*i/255&65280)+(((255&e)<<16)*i/255&16711680)+(i<<24)}static rad(e){return e*(Math.PI/180)}static getTimingBezier(e,t,i,r){var n=3*e,s=3*(i-e)-n,a=1-n-s,o=3*t,h=3*(r-t)-o,u=1-o-h;return function(e){if(e>=1)return 1;if(e<=0)return 0;for(var t,i,r=.5,l=0;l<20;l++){if((i=e-r*(r*(r*a+s)+n))>-1e-8&&i<1e-8)return r*(r*(r*u+h)+o);if((t=r*(r*(3*a)+2*s)+n)>1e-10&&t<1e-10)break;r+=i/t}for(var c=0,d=1,p=0;p<20;p++){if((i=e-(r=.5*(c+d))*(r*(r*a+s)+n))>-1e-8&&i<1e-8)return r*(r*(r*u+h)+o);i<0?d=r:c=r}}}static getTimingFunction(e){switch(e){case"linear":return function(e){return e};case"ease":return l.getTimingBezier(.25,.1,.25,1);case"ease-in":return l.getTimingBezier(.42,0,1,1);case"ease-out":return l.getTimingBezier(0,0,.58,1);case"ease-in-out":return l.getTimingBezier(.42,0,.58,1);case"step-start":return function(){return 1};case"step-end":return function(e){return 1===e?1:0};default:var t="cubic-bezier(";if(e&&0===e.indexOf(t)){var i=e.substr(13,e.length-13-1).split(",");if(4!==i.length)return console.warn("[Lightning] Unknown timing function: "+e),function(e){return e};var r=parseFloat(i[0]),n=parseFloat(i[1]),s=parseFloat(i[2]),a=parseFloat(i[3]);return isNaN(r)||isNaN(n)||isNaN(s)||isNaN(a)?(console.warn("[Lightning] Unknown timing function: "+e),function(e){return e}):l.getTimingBezier(r,n,s,a)}return console.warn("[Lightning] Unknown timing function: "+e),function(e){return e}}}}var c=class e{static isFunction(e){return"function"==typeof e}static isNumber(e){return"number"==typeof e}static isInteger(e){return"number"==typeof e&&e%1==0}static isBoolean(e){return!0===e||!1===e}static isString(e){return"string"==typeof e}static clone(t){return e.isObjectLiteral(t)||Array.isArray(t)?e.getDeepClone(t):t}static cloneObjShallow(e){for(var t=Object.keys(e),i={},r=0;r<t.length;r++)i[t[r]]=e[t[r]];return i}static merge(e,t){for(var i=Object.keys(t),r=0;r<i.length;r++)e[i[r]]=t[i[r]];return e}static isObject(e){var t=typeof e;return!!e&&("object"===t||"function"===t)}static isPlainObject(e){return!!e&&"object"===typeof e}static isObjectLiteral(e){return"object"==typeof e&&e&&e.constructor===Object}static getArrayIndex(t,i){return e.getModuloIndex(t,i.length)}static getModuloIndex(e,t){if(0===t)return e;for(;e<0;)e+=Math.ceil(-e/t)*t;return e%=t}static getDeepClone(t){var i,r;if(e.isFunction(t))return t;if(Array.isArray(t)){r=[];var n=Object.keys(t);for(i=0;i<n.length;i++)r[n[i]]=e.getDeepClone(t[n[i]]);return r}if(e.isObject(t)){r={};var s=Object.keys(t);for(i=0;i<s.length;i++)r[s[i]]=e.getDeepClone(t[s[i]]);return r}return t}static equalValues(t,i){return typeof t==typeof i&&(e.isObjectLiteral(t)?e.isObjectLiteral(i)&&e.equalObjectLiterals(t,i):Array.isArray(t)?Array.isArray(i)&&e.equalArrays(t,i):t===i)}static equalObjectLiterals(t,i){var r=Object.keys(t),n=Object.keys(i);if(r.length!==n.length)return!1;for(var s=0,a=r.length;s<a;s++){var o=r[s],h=n[s];if(o!==h)return!1;var u=t[o],l=i[h];if(!e.equalValues(u,l))return!1}return!0}static equalArrays(e,t){if(e.length!==t.length)return!1;for(var i=0,r=e.length;i<r;i++)if(!this.equalValues(e[i],t[i]))return!1;return!0}static setToArray(e){var t=[];return e.forEach((function(e){t.push(e)})),t}static iteratorToArray(e){for(var t=[],i=e.next();!i.done;)t.push(i.value),i=e.next();return t}static isUcChar(e){return e>=65&&e<=90}};c.isWeb="undefined"!=typeof window&&"undefined"==typeof sparkscene,c.isWPE=c.isWeb&&-1!==navigator.userAgent.indexOf("WPE"),c.isSpark="undefined"!=typeof sparkscene,c.isNode="undefined"==typeof window||c.isSpark,c.isPS4=c.isWeb&&-1!==navigator.userAgent.indexOf("PlayStation 4"),c.isZiggo=c.isWeb&&(-1!==navigator.userAgent.indexOf("EOSSTB")||-1!==navigator.userAgent.indexOf("HZNSTB"));class d{static defaultSetter(e,t,i){e[t]=i}static patchObject(e,t){if(c.isObjectLiteral(t))for(var i=Object.keys(t),r=0,n=i.length;r<n;r++){var s=i[r];this.patchObjectProperty(e,s,t[s])}else console.error("[Lightning] Settings must be object literal")}static patchObjectProperty(e,t,i){var r=e.setSetting||d.defaultSetter;"_"===t.charAt(0)?"__create"!==t&&console.error("[Lightning] Patch of private property '"+t+"' is not allowed"):"type"!==t&&(c.isFunction(i)&&i.__local&&(i=i.__local(e)),r(e,t,i))}static local(e){e.__local=!0}}class p{static getSpacing(e,t,i){var r,n,s,a=t-1;switch(e){case"flex-start":case"stretch":n=0,s=0;break;case"flex-end":n=i,s=0;break;case"center":n=i/2,s=0;break;case"space-between":n=0,s=Math.max(0,i)/a;break;case"space-around":if(i<0)return this.getSpacing("center",t,i);n=.5*(r=i/(a+1)),s=r;break;case"space-evenly":if(i<0)return this.getSpacing("center",t,i);n=r=i/(a+2),s=r;break;default:throw new Error("Unknown mode: "+e)}return{spacingBefore:n,spacingBetween:s}}}class g{constructor(e){this._layout=e,this._totalCrossAxisSize=0}get _lines(){return this._layout._lines}init(){this._totalCrossAxisSize=this._getTotalCrossAxisSize()}align(){var e=this._layout.crossAxisSize-this._totalCrossAxisSize,t=this._getSpacing(e),i=t.spacingBefore,r=t.spacingBetween,n=this._lines,s=0;"stretch"===this._layout._flexContainer.alignContent&&n.length&&e>0&&(s=e/n.length);for(var a=i,o=0,h=n.length;o<h;o++){var u=a,l=n[o].createItemAligner(),c=n[o].crossAxisLayoutSize+s;l.setCrossAxisLayoutSize(c),l.setCrossAxisLayoutOffset(u),l.align(),l.recursiveResizeOccured&&n[o].setItemPositions(),a+=c,a+=r}}get totalCrossAxisSize(){return this._totalCrossAxisSize}_getTotalCrossAxisSize(){for(var e=this._lines,t=0,i=0,r=e.length;i<r;i++){t+=e[i].crossAxisLayoutSize}return t}_getSpacing(e){var t=this._layout._flexContainer.alignContent,i=this._lines.length;return p.getSpacing(t,i,e)}}class f{static getParentAxisSizeWithPadding(e,t){var i=e.target.getParent();if(i){var r=e.flexParent;return r?this.getAxisLayoutSize(r,t)+this.getTotalPadding(r,t):t?i.w:i.h}return 0}static getRelAxisSize(e,t){return t?e.funcW?this._allowRelAxisSizeFunction(e,!0)?e.funcW(this.getParentAxisSizeWithPadding(e,!0)):0:e.originalWidth:e.funcH?this._allowRelAxisSizeFunction(e,!1)?e.funcH(this.getParentAxisSizeWithPadding(e,!1)):0:e.originalHeight}static _allowRelAxisSizeFunction(e,t){var i=e.flexParent;return!i||!i._flex._layout.isAxisFitToContents(t)}static isZeroAxisSize(e,t){return t?!e.originalWidth&&!e.funcW:!e.originalHeight&&!e.funcH}static getAxisLayoutPos(e,t){return t?e.x:e.y}static getAxisLayoutSize(e,t){return t?e.w:e.h}static setAxisLayoutPos(e,t,i){t?e.x=i:e.y=i}static setAxisLayoutSize(e,t,i){t?e.w=i:e.h=i}static getAxisMinSize(e,t){var i=this.getPlainAxisMinSize(e,t),r=0;return e.isFlexItemEnabled()&&(r=e._flexItem._getMinSizeSetting(t)),r>0&&(i=Math.max(i,r)),i}static getPlainAxisMinSize(e,t){return e.isFlexEnabled()?e._flex._layout.getAxisMinSize(t):0!==e.flexItem.shrink?0:this.getRelAxisSize(e,t)}static resizeAxis(e,t,i){e.isFlexEnabled()?e._flex._horizontal===t?e._flex._layout.resizeMainAxis(i):e._flex._layout.resizeCrossAxis(i):this.setAxisLayoutSize(e,t,i)}static getPaddingOffset(e,t){if(e.isFlexEnabled()){var i=e._flex;return t?i.paddingLeft:i.paddingTop}return 0}static getTotalPadding(e,t){if(e.isFlexEnabled()){var i=e._flex;return t?i.paddingRight+i.paddingLeft:i.paddingTop+i.paddingBottom}return 0}static getMarginOffset(e,t){var i=e.flexItem;return i?t?i.marginLeft:i.marginTop:0}static getTotalMargin(e,t){var i=e.flexItem;return i?t?i.marginRight+i.marginLeft:i.marginTop+i.marginBottom:0}}class m{constructor(e){this._line=e,this._amountRemaining=0,this._shrunkSize=0}shrink(e){this._shrunkSize=0,this._amountRemaining=e;var t=this._getTotalShrinkAmount();if(t){var i=this._line.items;do{for(var r=this._amountRemaining/t,n=this._line.startIndex;n<=this._line.endIndex;n++){var s=i[n].flexItem,a=s.shrink;if(a>0){var o=a*r,h=s._getMainAxisMinSize(),u=s._getMainAxisLayoutSize();if(u>h){var l=u-h;o>=l&&(o=l,t-=a);var c=u-o;if(s._resizeMainAxis(c),this._shrunkSize+=o,this._amountRemaining-=o,Math.abs(this._amountRemaining)<1e-5)return}}}}while(t&&Math.abs(this._amountRemaining)>1e-5)}}_getTotalShrinkAmount(){for(var e=0,t=this._line.items,i=this._line.startIndex;i<=this._line.endIndex;i++){var r=t[i].flexItem;if(r.shrink){var n=r._getMainAxisMinSize();r._getMainAxisLayoutSize()>n&&(e+=r.shrink)}}return e}getShrunkSize(){return this._shrunkSize}}class _{constructor(e){this._line=e,this._amountRemaining=0,this._grownSize=0}grow(e){this._grownSize=0,this._amountRemaining=e;var t=this._getTotalGrowAmount();if(t){var i=this._line.items;do{for(var r=this._amountRemaining/t,n=this._line.startIndex;n<=this._line.endIndex;n++){var s=i[n].flexItem,a=s.grow;if(a>0){var o=a*r,h=s._getMainAxisMaxSizeSetting(),u=s._getMainAxisLayoutSize();if(h>0)if(u>=h)o=0;else{var l=h-u;o>=l&&(o=l,t-=a)}if(o>0){var c=u+o;if(s._resizeMainAxis(c),this._grownSize+=o,this._amountRemaining-=o,Math.abs(this._amountRemaining)<1e-5)return}}}}while(t&&Math.abs(this._amountRemaining)>1e-5)}}_getTotalGrowAmount(){for(var e=0,t=this._line.items,i=this._line.startIndex;i<=this._line.endIndex;i++){var r=t[i].flexItem;if(r.grow){var n=r._getMainAxisMaxSizeSetting(),s=r._getMainAxisLayoutSize();(0===n||s<n)&&(e+=r.grow)}}return e}getGrownSize(){return this._grownSize}}class v{constructor(e){this._line=e}get _layout(){return this._line._layout}position(){for(var e=this._getSpacing(),t=e.spacingBefore,i=e.spacingBetween,r=t,n=this._line.items,s=this._line.startIndex;s<=this._line.endIndex;s++){var a=n[s];a.flexItem._setMainAxisLayoutPos(r),r+=a.flexItem._getMainAxisLayoutSizeWithPaddingAndMargin(),r+=i}}_getSpacing(){var e=this._line._availableSpace,t=this._layout._flexContainer.justifyContent,i=this._line.numberOfItems;return p.getSpacing(t,i,e)}}class y{constructor(e){this._line=e,this._crossAxisLayoutSize=0,this._crossAxisLayoutOffset=0,this._alignItemsSetting=null,this._recursiveResizeOccured=!1,this._isCrossAxisFitToContents=!1}get _layout(){return this._line._layout}get _flexContainer(){return this._layout._flexContainer}setCrossAxisLayoutSize(e){this._crossAxisLayoutSize=e}setCrossAxisLayoutOffset(e){this._crossAxisLayoutOffset=e}align(){this._alignItemsSetting=this._flexContainer.alignItems,this._isCrossAxisFitToContents=this._layout.isAxisFitToContents(!this._flexContainer._horizontal),this._recursiveResizeOccured=!1;for(var e=this._line.items,t=this._line.startIndex;t<=this._line.endIndex;t++){var i=e[t];this._alignItem(i)}}get recursiveResizeOccured(){return this._recursiveResizeOccured}_alignItem(e){var t=e.flexItem,i=t.alignSelf||this._alignItemsSetting;switch("stretch"===i&&this._preventStretch(t)&&(i="flex-start"),"stretch"===i||this._isCrossAxisFitToContents||t._hasRelCrossAxisSize()&&t._resetCrossAxisLayoutSize(),i){case"flex-start":this._alignItemFlexStart(t);break;case"flex-end":this._alignItemFlexEnd(t);break;case"center":this._alignItemFlexCenter(t);break;case"stretch":this._alignItemStretch(t)}}_alignItemFlexStart(e){e._setCrossAxisLayoutPos(this._crossAxisLayoutOffset)}_alignItemFlexEnd(e){var t=e._getCrossAxisLayoutSizeWithPaddingAndMargin();e._setCrossAxisLayoutPos(this._crossAxisLayoutOffset+(this._crossAxisLayoutSize-t))}_alignItemFlexCenter(e){var t=e._getCrossAxisLayoutSizeWithPaddingAndMargin(),i=(this._crossAxisLayoutSize-t)/2;e._setCrossAxisLayoutPos(this._crossAxisLayoutOffset+i)}_alignItemStretch(e){e._setCrossAxisLayoutPos(this._crossAxisLayoutOffset);var t=e._getMainAxisLayoutSize(),i=this._crossAxisLayoutSize-e._getCrossAxisMargin()-e._getCrossAxisPadding(),r=e._getCrossAxisMinSizeSetting();r>0&&(i=Math.max(i,r));var n=e._getCrossAxisMaxSizeSetting();n>0&&(i=Math.min(i,n)),e._resizeCrossAxis(i),e._getMainAxisLayoutSize()!==t&&(this._recursiveResizeOccured=!0)}_preventStretch(e){var t=e._hasFixedCrossAxisSize(),i="stretch"===e.alignSelf;return t&&!i}}class x{constructor(e,t,i,r){this._layout=e,this.items=e.items,this.startIndex=t,this.endIndex=i,this._availableSpace=r}performLayout(){this._setItemSizes(),this.setItemPositions(),this._calcLayoutInfo()}_setItemSizes(){this._availableSpace>0?this._growItemSizes(this._availableSpace):this._availableSpace<0&&this._shrinkItemSizes(-this._availableSpace)}_growItemSizes(e){var t=new _(this);t.grow(e),this._availableSpace-=t.getGrownSize()}_shrinkItemSizes(e){var t=new m(this);t.shrink(e),this._availableSpace+=t.getShrunkSize()}setItemPositions(){new v(this).position()}createItemAligner(){return new y(this)}_calcLayoutInfo(){this._calcCrossAxisMaxLayoutSize()}getMainAxisMinSize(){for(var e=0,t=this.startIndex;t<=this.endIndex;t++){e+=this.items[t].flexItem._getMainAxisMinSizeWithPaddingAndMargin()}return e}get numberOfItems(){return this.endIndex-this.startIndex+1}get crossAxisLayoutSize(){var e=this._layout.isCrossAxisFitToContents()&&!this._layout.resizingCrossAxis;return this._layout.isWrapping()||e?this._crossAxisMaxLayoutSize:this._layout.crossAxisSize}_calcCrossAxisMaxLayoutSize(){this._crossAxisMaxLayoutSize=this._getCrossAxisMaxLayoutSize()}_getCrossAxisMaxLayoutSize(){for(var e=0,t=this.startIndex;t<=this.endIndex;t++){var i=this.items[t];e=Math.max(e,i.flexItem._getCrossAxisLayoutSizeWithPaddingAndMargin())}return e}}class b{constructor(e){this._layout=e,this._mainAxisMinSize=-1,this._crossAxisMinSize=-1,this._mainAxisContentSize=0}get lines(){return this._lines}get mainAxisMinSize(){return-1===this._mainAxisMinSize&&(this._mainAxisMinSize=this._getMainAxisMinSize()),this._mainAxisMinSize}get crossAxisMinSize(){return-1===this._crossAxisMinSize&&(this._crossAxisMinSize=this._getCrossAxisMinSize()),this._crossAxisMinSize}get mainAxisContentSize(){return this._mainAxisContentSize}layoutLines(){this._setup();var e,t=this._layout.items,i=this._layout.isWrapping(),r=0,n=t.length;for(e=0;e<n;e++){var s=t[e];this._layoutFlexItem(s);var a=s.flexItem._getMainAxisLayoutSizeWithPaddingAndMargin();if(i&&e>r)this._curMainAxisPos+a>this._mainAxisSize&&(this._layoutLine(r,e-1),this._curMainAxisPos=0,r=e);this._addToMainAxisPos(a)}r<e&&this._layoutLine(r,e-1)}_layoutFlexItem(e){e.isFlexEnabled()?e.flexLayout.updateTreeLayout():e.flexItem._resetLayoutSize()}_setup(){this._mainAxisSize=this._layout.mainAxisSize,this._curMainAxisPos=0,this._maxMainAxisPos=0,this._lines=[],this._mainAxisMinSize=-1,this._crossAxisMinSize=-1,this._mainAxisContentSize=0}_addToMainAxisPos(e){this._curMainAxisPos+=e,this._curMainAxisPos>this._maxMainAxisPos&&(this._maxMainAxisPos=this._curMainAxisPos)}_layoutLine(e,t){var i=this._getAvailableMainAxisLayoutSpace(),r=new x(this._layout,e,t,i);r.performLayout(),this._lines.push(r),(0===this._mainAxisContentSize||this._curMainAxisPos>this._mainAxisContentSize)&&(this._mainAxisContentSize=this._curMainAxisPos)}_getAvailableMainAxisLayoutSpace(){return!this._layout.resizingMainAxis&&this._layout.isMainAxisFitToContents()?0:this._mainAxisSize-this._curMainAxisPos}_getCrossAxisMinSize(){for(var e=0,t=this._layout.items,i=0,r=t.length;i<r;i++){var n=t[i].flexItem._getCrossAxisMinSizeWithPaddingAndMargin();e=Math.max(e,n)}return e}_getMainAxisMinSize(){return 1===this._lines.length?this._lines[0].getMainAxisMinSize():this._layout.mainAxisSize}}class w{constructor(e){this._layout=e,this._isReverse=this._flexContainer._reverse,this._horizontalPaddingOffset=this._layout._getHorizontalPaddingOffset(),this._verticalPaddingOffset=this._layout._getVerticalPaddingOffset()}get _flexContainer(){return this._layout._flexContainer}finalize(){var e=this._layout.getParentFlexContainer();e?new w(e._layout)._finalizeItemAndChildren(this._flexContainer.item):(this._finalizeRoot(),this._finalizeItems())}_finalizeRoot(){var e=this._flexContainer.item,t=f.getAxisLayoutPos(e,!0),i=f.getAxisLayoutPos(e,!1),r=f.getAxisLayoutSize(e,!0),n=f.getAxisLayoutSize(e,!1);r+=this._layout._getHorizontalPadding(),n+=this._layout._getVerticalPadding(),e.clearRecalcFlag(),e.setLayout(t,i,r,n)}_finalizeItems(){for(var e=this._layout.items,t=0,i=e.length;t<i;t++){var r=e[t],n=this._validateItemCache(r);this._finalizeItem(r),n||this._finalizeItemChildren(r)}}_validateItemCache(e){if(0===e.recalc&&e.isFlexEnabled()){var t=e._flex._layout;if(e.w===e.target.w&&e.h===e.target.h)return!0;var i=t.crossAxisSize;t.performResizeMainAxis(t.mainAxisSize),t.performResizeCrossAxis(i)}return!1}_finalizeItemAndChildren(e){this._finalizeItem(e),this._finalizeItemChildren(e)}_finalizeItem(e){this._isReverse&&this._reverseMainAxisLayoutPos(e);var t=f.getAxisLayoutPos(e,!0),i=f.getAxisLayoutPos(e,!1),r=f.getAxisLayoutSize(e,!0),n=f.getAxisLayoutSize(e,!1);t+=this._horizontalPaddingOffset,i+=this._verticalPaddingOffset,e.flex&&(r+=e._flex._layout._getHorizontalPadding(),n+=e._flex._layout._getVerticalPadding());var s=e.flexItem;s&&(t+=s._getHorizontalMarginOffset(),i+=s._getVerticalMarginOffset()),e.clearRecalcFlag(),e.setLayout(t,i,r,n)}_finalizeItemChildren(e){var t=e._flex;t&&new w(t._layout)._finalizeItems()}_reverseMainAxisLayoutPos(e){var t=e.flexItem._getMainAxisLayoutPos()+e.flexItem._getMainAxisLayoutSizeWithPaddingAndMargin(),i=this._layout.mainAxisSize-t;e.flexItem._setMainAxisLayoutPos(i)}}class T{constructor(e){this._flexContainer=e,this._lineLayouter=new b(this),this._resizingMainAxis=!1,this._resizingCrossAxis=!1,this._cachedMainAxisSizeAfterLayout=0,this._cachedCrossAxisSizeAfterLayout=0,this._shrunk=!1}get shrunk(){return this._shrunk}get recalc(){return this.item.recalc}layoutTree(){null!==this.item.flexParent?this._updateSubTreeLayout():this.updateTreeLayout(),this.updateItemCoords()}updateTreeLayout(){this.recalc?this._performUpdateLayoutTree():this._performUpdateLayoutTreeFromCache()}_performUpdateLayoutTree(){this._setInitialAxisSizes(),this._layoutAxes(),this._refreshLayoutCache()}_refreshLayoutCache(){this._cachedMainAxisSizeAfterLayout=this.mainAxisSize,this._cachedCrossAxisSizeAfterLayout=this.crossAxisSize}_performUpdateLayoutTreeFromCache(){this.item.funcW||this.item.funcH?(this.item.enableLocalRecalcFlag(),this._performUpdateLayoutTree()):(this.mainAxisSize=this._cachedMainAxisSizeAfterLayout,this.crossAxisSize=this._cachedCrossAxisSizeAfterLayout)}updateItemCoords(){new w(this).finalize()}_updateSubTreeLayout(){var e=this.crossAxisSize;this._layoutMainAxis(),this.performResizeCrossAxis(e)}_setInitialAxisSizes(){this.item.isFlexItemEnabled()?this.item.flexItem._resetLayoutSize():(this.mainAxisSize=this._getMainAxisBasis(),this.crossAxisSize=this._getCrossAxisBasis()),this._resizingMainAxis=!1,this._resizingCrossAxis=!1,this._shrunk=!1}_layoutAxes(){this._layoutMainAxis(),this._layoutCrossAxis()}_layoutMainAxis(){this._layoutLines(),this._fitMainAxisSizeToContents()}_layoutLines(){this._lineLayouter.layoutLines()}get _lines(){return this._lineLayouter.lines}_fitMainAxisSizeToContents(){this._resizingMainAxis||this.isMainAxisFitToContents()&&(this.mainAxisSize=this._lineLayouter.mainAxisContentSize)}_layoutCrossAxis(){var e=new g(this);e.init(),this._totalCrossAxisSize=e.totalCrossAxisSize,this._fitCrossAxisSizeToContents(),e.align()}_fitCrossAxisSizeToContents(){this._resizingCrossAxis||this.isCrossAxisFitToContents()&&(this.crossAxisSize=this._totalCrossAxisSize)}isWrapping(){return this._flexContainer.wrap}isAxisFitToContents(e){return this._horizontal===e?this.isMainAxisFitToContents():this.isCrossAxisFitToContents()}isMainAxisFitToContents(){return!this.isWrapping()&&!this._hasFixedMainAxisBasis()}isCrossAxisFitToContents(){return!this._hasFixedCrossAxisBasis()}_hasFixedMainAxisBasis(){return!f.isZeroAxisSize(this.item,this._horizontal)}_hasFixedCrossAxisBasis(){return!f.isZeroAxisSize(this.item,!this._horizontal)}getAxisMinSize(e){return this._horizontal===e?this._getMainAxisMinSize():this._getCrossAxisMinSize()}_getMainAxisMinSize(){return this._lineLayouter.mainAxisMinSize}_getCrossAxisMinSize(){return this._lineLayouter.crossAxisMinSize}resizeMainAxis(e){this.mainAxisSize!==e&&(this.recalc>0?this.performResizeMainAxis(e):this._checkValidCacheMainAxisResize()?(this.mainAxisSize=e,this._fitCrossAxisSizeToContents()):(this.item.enableLocalRecalcFlag(),this.performResizeMainAxis(e)))}_checkValidCacheMainAxisResize(e){return e===this.targetMainAxisSize||!this.isCrossAxisFitToContents()}performResizeMainAxis(e){var t=e<this.mainAxisSize;this._shrunk=t,this.mainAxisSize=e,this._resizingMainAxis=!0,this._layoutAxes(),this._resizingMainAxis=!1}resizeCrossAxis(e){this.crossAxisSize!==e&&(this.recalc>0?this.performResizeCrossAxis(e):this.crossAxisSize=e)}performResizeCrossAxis(e){this.crossAxisSize=e,this._resizingCrossAxis=!0,this._layoutCrossAxis(),this._resizingCrossAxis=!1}get targetMainAxisSize(){return this._horizontal?this.item.target.w:this.item.target.h}get targetCrossAxisSize(){return this._horizontal?this.item.target.h:this.item.target.w}getParentFlexContainer(){return this.item.isFlexItemEnabled()?this.item.flexItem.ctr:null}_getHorizontalPadding(){return f.getTotalPadding(this.item,!0)}_getVerticalPadding(){return f.getTotalPadding(this.item,!1)}_getHorizontalPaddingOffset(){return f.getPaddingOffset(this.item,!0)}_getVerticalPaddingOffset(){return f.getPaddingOffset(this.item,!1)}_getMainAxisBasis(){return f.getRelAxisSize(this.item,this._horizontal)}_getCrossAxisBasis(){return f.getRelAxisSize(this.item,!this._horizontal)}get _horizontal(){return this._flexContainer._horizontal}get _reverse(){return this._flexContainer._reverse}get item(){return this._flexContainer.item}get items(){return this.item.items}get resizingMainAxis(){return this._resizingMainAxis}get resizingCrossAxis(){return this._resizingCrossAxis}get numberOfItems(){return this.items.length}get mainAxisSize(){return f.getAxisLayoutSize(this.item,this._horizontal)}get crossAxisSize(){return f.getAxisLayoutSize(this.item,!this._horizontal)}set mainAxisSize(e){f.setAxisLayoutSize(this.item,this._horizontal,e)}set crossAxisSize(e){f.setAxisLayoutSize(this.item,!this._horizontal,e)}}class S{constructor(e){this._item=e,this._layout=new T(this),this._horizontal=!0,this._reverse=!1,this._wrap=!1,this._alignItems="stretch",this._justifyContent="flex-start",this._alignContent="flex-start",this._paddingLeft=0,this._paddingTop=0,this._paddingRight=0,this._paddingBottom=0}get item(){return this._item}_changedDimensions(){this._item.changedDimensions()}_changedContents(){this._item.changedContents()}get direction(){return(this._horizontal?"row":"column")+(this._reverse?"-reverse":"")}set direction(e){this.direction!==e&&(this._horizontal="row"===e||"row-reverse"===e,this._reverse="row-reverse"===e||"column-reverse"===e,this._changedContents())}set wrap(e){this._wrap=e,this._changedContents()}get wrap(){return this._wrap}get alignItems(){return this._alignItems}set alignItems(e){if(this._alignItems!==e){if(-1===S.ALIGN_ITEMS.indexOf(e))throw new Error("Unknown alignItems, options: "+S.ALIGN_ITEMS.join(","));this._alignItems=e,this._changedContents()}}get alignContent(){return this._alignContent}set alignContent(e){if(this._alignContent!==e){if(-1===S.ALIGN_CONTENT.indexOf(e))throw new Error("Unknown alignContent, options: "+S.ALIGN_CONTENT.join(","));this._alignContent=e,this._changedContents()}}get justifyContent(){return this._justifyContent}set justifyContent(e){if(this._justifyContent!==e){if(-1===S.JUSTIFY_CONTENT.indexOf(e))throw new Error("Unknown justifyContent, options: "+S.JUSTIFY_CONTENT.join(","));this._justifyContent=e,this._changedContents()}}set padding(e){this.paddingLeft=e,this.paddingTop=e,this.paddingRight=e,this.paddingBottom=e}get padding(){return this.paddingLeft}set paddingLeft(e){this._paddingLeft=e,this._changedDimensions()}get paddingLeft(){return this._paddingLeft}set paddingTop(e){this._paddingTop=e,this._changedDimensions()}get paddingTop(){return this._paddingTop}set paddingRight(e){this._paddingRight=e,this._changedDimensions()}get paddingRight(){return this._paddingRight}set paddingBottom(e){this._paddingBottom=e,this._changedDimensions()}get paddingBottom(){return this._paddingBottom}patch(e){d.patchObject(this,e)}}S.ALIGN_ITEMS=["flex-start","flex-end","center","stretch"],S.ALIGN_CONTENT=["flex-start","flex-end","center","space-between","space-around","space-evenly","stretch"],S.JUSTIFY_CONTENT=["flex-start","flex-end","center","space-between","space-around","space-evenly"];class A{constructor(e){this._ctr=null,this._item=e,this._grow=0,this._shrink=A.SHRINK_AUTO,this._alignSelf=void 0,this._minWidth=0,this._minHeight=0,this._maxWidth=0,this._maxHeight=0,this._marginLeft=0,this._marginTop=0,this._marginRight=0,this._marginBottom=0}get item(){return this._item}get grow(){return this._grow}set grow(e){this._grow!==e&&(this._grow=parseInt(e)||0,this._changed())}get shrink(){return this._shrink===A.SHRINK_AUTO?this._getDefaultShrink():this._shrink}_getDefaultShrink(){return this.item.isFlexEnabled()?1:0}set shrink(e){this._shrink!==e&&(this._shrink=parseInt(e)||0,this._changed())}get alignSelf(){return this._alignSelf}set alignSelf(e){if(this._alignSelf!==e){if(void 0===e)this._alignSelf=void 0;else{if(-1===S.ALIGN_ITEMS.indexOf(e))throw new Error("Unknown alignSelf, options: "+S.ALIGN_ITEMS.join(","));this._alignSelf=e}this._changed()}}get minWidth(){return this._minWidth}set minWidth(e){this._minWidth=Math.max(0,e),this._item.changedDimensions(!0,!1)}get minHeight(){return this._minHeight}set minHeight(e){this._minHeight=Math.max(0,e),this._item.changedDimensions(!1,!0)}get maxWidth(){return this._maxWidth}set maxWidth(e){this._maxWidth=Math.max(0,e),this._item.changedDimensions(!0,!1)}get maxHeight(){return this._maxHeight}set maxHeight(e){this._maxHeight=Math.max(0,e),this._item.changedDimensions(!1,!0)}set margin(e){this.marginLeft=e,this.marginTop=e,this.marginRight=e,this.marginBottom=e}get margin(){return this.marginLeft}set marginLeft(e){this._marginLeft=e,this._changed()}get marginLeft(){return this._marginLeft}set marginTop(e){this._marginTop=e,this._changed()}get marginTop(){return this._marginTop}set marginRight(e){this._marginRight=e,this._changed()}get marginRight(){return this._marginRight}set marginBottom(e){this._marginBottom=e,this._changed()}get marginBottom(){return this._marginBottom}_changed(){this.ctr&&this.ctr._changedContents()}set ctr(e){this._ctr=e}get ctr(){return this._ctr}patch(e){d.patchObject(this,e)}_resetLayoutSize(){this._resetHorizontalAxisLayoutSize(),this._resetVerticalAxisLayoutSize()}_resetCrossAxisLayoutSize(){this.ctr._horizontal?this._resetVerticalAxisLayoutSize():this._resetHorizontalAxisLayoutSize()}_resetHorizontalAxisLayoutSize(){var e=f.getRelAxisSize(this.item,!0);this._minWidth&&(e=Math.max(this._minWidth,e)),this._maxWidth&&(e=Math.min(this._maxWidth,e)),f.setAxisLayoutSize(this.item,!0,e)}_resetVerticalAxisLayoutSize(){var e=f.getRelAxisSize(this.item,!1);this._minHeight&&(e=Math.max(this._minHeight,e)),this._maxHeight&&(e=Math.min(this._maxHeight,e)),f.setAxisLayoutSize(this.item,!1,e)}_getCrossAxisMinSizeSetting(){return this._getMinSizeSetting(!this.ctr._horizontal)}_getCrossAxisMaxSizeSetting(){return this._getMaxSizeSetting(!this.ctr._horizontal)}_getMainAxisMaxSizeSetting(){return this._getMaxSizeSetting(this.ctr._horizontal)}_getMinSizeSetting(e){return e?this._minWidth:this._minHeight}_getMaxSizeSetting(e){return e?this._maxWidth:this._maxHeight}_getMainAxisMinSize(){return f.getAxisMinSize(this.item,this.ctr._horizontal)}_getCrossAxisMinSize(){return f.getAxisMinSize(this.item,!this.ctr._horizontal)}_getMainAxisLayoutSize(){return f.getAxisLayoutSize(this.item,this.ctr._horizontal)}_getMainAxisLayoutPos(){return f.getAxisLayoutPos(this.item,this.ctr._horizontal)}_setMainAxisLayoutPos(e){return f.setAxisLayoutPos(this.item,this.ctr._horizontal,e)}_setCrossAxisLayoutPos(e){return f.setAxisLayoutPos(this.item,!this.ctr._horizontal,e)}_getCrossAxisLayoutSize(){return f.getAxisLayoutSize(this.item,!this.ctr._horizontal)}_resizeCrossAxis(e){return f.resizeAxis(this.item,!this.ctr._horizontal,e)}_resizeMainAxis(e){return f.resizeAxis(this.item,this.ctr._horizontal,e)}_getMainAxisPadding(){return f.getTotalPadding(this.item,this.ctr._horizontal)}_getCrossAxisPadding(){return f.getTotalPadding(this.item,!this.ctr._horizontal)}_getMainAxisMargin(){return f.getTotalMargin(this.item,this.ctr._horizontal)}_getCrossAxisMargin(){return f.getTotalMargin(this.item,!this.ctr._horizontal)}_getHorizontalMarginOffset(){return f.getMarginOffset(this.item,!0)}_getVerticalMarginOffset(){return f.getMarginOffset(this.item,!1)}_getMainAxisMinSizeWithPaddingAndMargin(){return this._getMainAxisMinSize()+this._getMainAxisPadding()+this._getMainAxisMargin()}_getCrossAxisMinSizeWithPaddingAndMargin(){return this._getCrossAxisMinSize()+this._getCrossAxisPadding()+this._getCrossAxisMargin()}_getMainAxisLayoutSizeWithPaddingAndMargin(){return this._getMainAxisLayoutSize()+this._getMainAxisPadding()+this._getMainAxisMargin()}_getCrossAxisLayoutSizeWithPaddingAndMargin(){return this._getCrossAxisLayoutSize()+this._getCrossAxisPadding()+this._getCrossAxisMargin()}_hasFixedCrossAxisSize(){return!f.isZeroAxisSize(this.item,!this.ctr._horizontal)}_hasRelCrossAxisSize(){return!!(this.ctr._horizontal?this.item.funcH:this.item.funcW)}}A.SHRINK_AUTO=-1;class C{constructor(e){this._target=e,this._recalc=0,this._enabled=!1,this.x=0,this.y=0,this.w=0,this.h=0,this._originalX=0,this._originalY=0,this._originalWidth=0,this._originalHeight=0,this._flex=null,this._flexItem=null,this._flexItemDisabled=!1,this._items=null}get flexLayout(){return this.flex?this.flex._layout:null}layoutFlexTree(){this.isFlexEnabled()&&this.isChanged()&&this.flexLayout.layoutTree()}get target(){return this._target}get flex(){return this._flex}set flex(e){e?(this.isFlexEnabled()||this._enableFlex(),this._flex.patch(e)):this.isFlexEnabled()&&this._disableFlex()}get flexItem(){return!this._flexItemDisabled&&(this._ensureFlexItem(),this._flexItem)}set flexItem(e){if(!1===e){if(!this._flexItemDisabled){var t=this.flexParent;this._flexItemDisabled=!0,this._checkEnabled(),t&&(t._clearFlexItemsCache(),t.changedContents())}}else if(this._ensureFlexItem(),this._flexItem.patch(e),this._flexItemDisabled){this._flexItemDisabled=!1,this._checkEnabled();var i=this.flexParent;i&&(i._clearFlexItemsCache(),i.changedContents())}}_enableFlex(){this._flex=new S(this),this._checkEnabled(),this.changedDimensions(),this._enableChildrenAsFlexItems()}_disableFlex(){this.changedDimensions(),this._flex=null,this._checkEnabled(),this._disableChildrenAsFlexItems()}_enableChildrenAsFlexItems(){var e=this._target._children;if(e)for(var t=0,i=e.length;t<i;t++){e[t].layout._enableFlexItem()}}_disableChildrenAsFlexItems(){var e=this._target._children;if(e)for(var t=0,i=e.length;t<i;t++){e[t].layout._disableFlexItem()}}_enableFlexItem(){this._ensureFlexItem();var e=this._target._parent._layout;this._flexItem.ctr=e._flex,e.changedContents(),this._checkEnabled()}_disableFlexItem(){this._flexItem&&(this._flexItem.ctr=null),this._checkEnabled(),this._resetOffsets()}_resetOffsets(){this.x=0,this.y=0}_ensureFlexItem(){this._flexItem||(this._flexItem=new A(this))}_checkEnabled(){var e=this.isEnabled();this._enabled!==e&&(e?this._enable():this._disable(),this._enabled=e)}_enable(){this._setupTargetForFlex(),this._target.enableFlexLayout()}_disable(){this._restoreTargetToNonFlex(),this._target.disableFlexLayout()}isEnabled(){return this.isFlexEnabled()||this.isFlexItemEnabled()}isFlexEnabled(){return null!==this._flex}isFlexItemEnabled(){return null!==this.flexParent}_restoreTargetToNonFlex(){var e=this._target;e.x=this._originalX,e.y=this._originalY,e.setDimensions(this._originalWidth,this._originalHeight)}_setupTargetForFlex(){var e=this._target;this._originalX=e._x,this._originalY=e._y,this._originalWidth=e._w,this._originalHeight=e._h}setParent(e,t){e&&e.isFlexContainer()&&e._layout._changedChildren(),t&&t.isFlexContainer()&&(this._enableFlexItem(),t._layout._changedChildren()),this._checkEnabled()}get flexParent(){if(this._flexItemDisabled)return null;var e=this._target._parent;return e&&e.isFlexContainer()?e._layout:null}setVisible(e){var t=this.flexParent;t&&t._changedChildren()}get items(){return this._items||(this._items=this._getFlexItems()),this._items}_getFlexItems(){var e=[],t=this._target._children;if(t)for(var i=0,r=t.length;i<r;i++){var n=t[i];n.visible&&n.isFlexItem()&&e.push(n.layout)}return e}_changedChildren(){this._clearFlexItemsCache(),this.changedContents()}_clearFlexItemsCache(){this._items=null}setLayout(e,t,i,r){var n=this._originalX,s=this._originalY;this.funcX&&(n=this.funcX(f.getParentAxisSizeWithPadding(this,!0))),this.funcY&&(s=this.funcY(f.getParentAxisSizeWithPadding(this,!1))),this.isFlexItemEnabled()?this.target.setLayout(e+n,t+s,i,r):this.target.setLayout(n,s,i,r)}changedDimensions(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._updateRecalc(e,t)}changedContents(){this._updateRecalc()}forceLayout(){this._updateRecalc()}isChanged(){return this._recalc>0}_updateRecalc(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.isFlexEnabled()){var i=this._flex._layout;e=e||i.isAxisFitToContents(!0),t=t||i.isAxisFitToContents(!1)}var r=1+(e?2:0)+(t?4:0),n=this.getNewRecalcFlags(r);this._recalc|=r,n>1&&this.flexParent?this.flexParent._updateRecalcBottomUp(r):this._target.triggerLayout()}getNewRecalcFlags(e){return 7-this._recalc&e}_updateRecalcBottomUp(e){var t=this._getRecalcFromChangedChildRecalc(e),i=this.getNewRecalcFlags(t);if(this._recalc|=t,i>1){var r=this.flexParent;r?r._updateRecalcBottomUp(t):this._target.triggerLayout()}else this._target.triggerLayout()}_getRecalcFromChangedChildRecalc(e){var t=this._flex._layout,i=t._horizontal?1:2,r=t._horizontal?2:1;e&r||e&i&&t.isWrapping()&&t.isCrossAxisFitToContents()&&(e+=r);var n=t.isAxisFitToContents(!0),s=t.isAxisFitToContents(!1);return t.shrunk&&(t._horizontal?n=!0:s=!0),e&1+(n?2:0)+(s?4:0)}get recalc(){return this._recalc}clearRecalcFlag(){this._recalc=0}enableLocalRecalcFlag(){this._recalc=1}get originalX(){return this._originalX}setOriginalXWithoutUpdatingLayout(e){this._originalX=e}get originalY(){return this._originalY}setOriginalYWithoutUpdatingLayout(e){this._originalY=e}get originalWidth(){return this._originalWidth}set originalWidth(e){this._originalWidth!==e&&(this._originalWidth=e,this.changedDimensions(!0,!1))}get originalHeight(){return this._originalHeight}set originalHeight(e){this._originalHeight!==e&&(this._originalHeight=e,this.changedDimensions(!1,!0))}get funcX(){return this._target.funcX}get funcY(){return this._target.funcY}get funcW(){return this._target.funcW}get funcH(){return this._target.funcH}}class E{constructor(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.id=E.id++,this.manager=e,this.stage=e.stage,this.textures=new Set,this._activeTextureCount=0,this.loader=t,this.lookupId=null,this._cancelCb=null,this.loadingSince=0,this.w=0,this.h=0,this._nativeTexture=null,this.permanent=!1,this.renderInfo=null,this._isResultTexture=!this.loader,this._loadError=null,this._imageRef=null,this._hasAlpha=!1}get hasAlpha(){return this._hasAlpha}get loadError(){return this._loadError}addTexture(e){this.textures.has(e)||this.textures.add(e)}removeTexture(e){this.textures.delete(e)}incActiveTextureCount(){this._activeTextureCount++,1===this._activeTextureCount&&this.becomesUsed()}decActiveTextureCount(){this._activeTextureCount--,0===this._activeTextureCount&&this.becomesUnused()}get isResultTexture(){return this._isResultTexture}set isResultTexture(e){this._isResultTexture=e}forEachEnabledElement(e){this.textures.forEach((t=>{t.elements.forEach(e)}))}hasEnabledElements(){return this.textures.size>0}forEachActiveElement(e){this.textures.forEach((t=>{t.elements.forEach((t=>{t.active&&e(t)}))}))}getRenderWidth(){return this.w}getRenderHeight(){return this.h}allowCleanup(){return!this.permanent&&!this.isUsed()}becomesUsed(){this.load()}becomesUnused(){this.cancel()}cancel(){this.isLoading()&&(this._cancelCb&&(this._cancelCb(this),this._cancelCb=null),this.loadingSince=0)}isLoaded(){return!!this._nativeTexture}isLoading(){return this.loadingSince>0}isError(){return!!this._loadError}reload(){this.free(),this.isUsed()&&this.load()}load(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.isResultTexture||this._nativeTexture||this.isLoading()||(this.loadingSince=(new Date).getTime(),this._cancelCb=this.loader(((t,i)=>{if(this.isLoading()){if(this._cancelCb=null,this.manager.stage.destroyed)return;if(t)this.onError(t);else if(i&&i.source)if(this.stage.isUpdatingFrame()||e||!1===i.throttle)this.processLoadedSource(i);else{var r=this.stage.textureThrottler;this._cancelCb=r.genericCancelCb,r.add(this,i)}}}),this))}processLoadedSource(e){this.loadingSince=0,this.setSource(e)}setSource(e){var t=e.source;this._hasAlpha=e&&e.hasAlpha||!1,this.w=t.width||e&&e.w||0,this.h=t.height||e&&e.h||0,e&&e.renderInfo&&(this.renderInfo=e.renderInfo),this.permanent=!!e.permanent,e&&e.imageRef&&(this._imageRef=e.imageRef),e&&e.flipTextureY?this._flipTextureY=e.flipTextureY:this._flipTextureY=!1,this._isNativeTexture(t)?(this._nativeTexture=t,this.w=this.w||t.w,this.h=this.h||t.h,this.permanent=!e.hasOwnProperty("permanent")||e.permanent):this.manager.uploadTextureSource(this,e),this._loadError=null,this.onLoad()}isUsed(){return this._activeTextureCount>0}onLoad(){this.isUsed()&&this.textures.forEach((e=>{e.onLoad()}))}forceRenderUpdate(){this._nativeTexture&&(this._nativeTexture.update=this.stage.frameCounter),this.forEachActiveElement((function(e){e.forceRenderUpdate()}))}forceUpdateRenderCoords(){this.forEachActiveElement((function(e){e._updateTextureCoords()}))}get nativeTexture(){return this._nativeTexture}clearNativeTexture(){this._nativeTexture=null,this._imageRef=null}replaceNativeTexture(e,t,i){var r=this._nativeTexture;this._nativeTexture=e,this.w=t,this.h=i,!r&&this._nativeTexture&&this.forEachActiveElement((e=>e.onTextureSourceLoaded())),this._nativeTexture||this.forEachActiveElement((e=>e._setDisplayedTexture(null))),this.forEachEnabledElement((e=>e._updateDimensions()))}onError(e){this._loadError=e,this.loadingSince=0,console.error("[Lightning] texture load error",e,this.lookupId),this.forEachActiveElement((t=>t.onTextureSourceLoadError(e)))}free(){this.isLoaded()&&this.manager.freeTextureSource(this)}_isNativeTexture(e){return c.isNode?"WebGLTexture"===e.constructor.name:"WebGLTexture"in window&&e instanceof WebGLTexture}}E.prototype.isTextureSource=!0,E.id=1;class I{constructor(e){this._element=e.element,this._core=e,this.ctx=this._core.ctx,this._enabled=!1,this.lazy=!1,this._colorize=!1,this._renderTexture=null,this._renderTextureReused=!1,this._resultTextureSource=null,this._renderOffscreen=!1,this.empty=!1}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this._core.updateRenderToTextureEnabled()}get renderOffscreen(){return this._renderOffscreen}set renderOffscreen(e){this._renderOffscreen=e,this._core.setHasRenderUpdates(1),this._core._setRecalc(6)}get colorize(){return this._colorize}set colorize(e){this._colorize!==e&&(this._colorize=e,this._core.setHasRenderUpdates(1))}_getTextureSource(){return this._resultTextureSource||(this._resultTextureSource=new E(this._element.stage.textureManager),this.updateResultTexture()),this._resultTextureSource}hasResultTexture(){return!!this._resultTextureSource}resultTextureInUse(){return this._resultTextureSource&&this._resultTextureSource.hasEnabledElements()}updateResultTexture(){var e=this.getResultTexture();if(this._resultTextureSource){if(this._resultTextureSource.nativeTexture!==e){var t=e?e.w:0,i=e?e.h:0;this._resultTextureSource.replaceNativeTexture(e,t,i)}this._resultTextureSource.forEachEnabledElement((e=>{e._updateDimensions(),e.core.setHasRenderUpdates(3)}))}}mustRenderToTexture(){return!(!this._enabled||this.lazy)||!!(this._enabled&&this.lazy&&this._core._hasRenderUpdates<3)}deactivate(){this.release()}get renderTextureReused(){return this._renderTextureReused}release(){this.releaseRenderTexture()}releaseRenderTexture(){this._renderTexture&&(this._renderTextureReused||this.ctx.releaseRenderTexture(this._renderTexture),this._renderTexture=null,this._renderTextureReused=!1,this.updateResultTexture())}reuseTextureAsRenderTexture(e){this._renderTexture!==e&&(this.releaseRenderTexture(),this._renderTexture=e,this._renderTextureReused=!0)}hasRenderTexture(){return!!this._renderTexture}getRenderTexture(){return this._renderTexture||(this._renderTexture=this.ctx.allocateRenderTexture(this._core._w,this._core._h),this._renderTextureReused=!1),this._renderTexture}getResultTexture(){return this._renderTexture}}class R{constructor(e){this._element=e,this.ctx=e.stage.ctx,this._recalc=0,this._parent=null,this._onUpdate=null,this._pRecalc=0,this._worldContext=new L,this._hasUpdates=!1,this._localAlpha=1,this._onAfterCalcs=null,this._onAfterUpdate=null,this._localPx=0,this._localPy=0,this._localTa=1,this._localTb=0,this._localTc=0,this._localTd=1,this._isComplex=!1,this._dimsUnknown=!1,this._clipping=!1,this._zSort=!1,this._outOfBounds=0,this._displayedTextureSource=null,this._zContextUsage=0,this._children=null,this._hasRenderUpdates=0,this._zIndexedChildren=null,this._renderContext=this._worldContext,this.renderState=this.ctx.renderState,this._scissor=null,this._shaderOwner=null,this._updateTreeOrder=0,this._colorUl=this._colorUr=this._colorBl=this._colorBr=4294967295,this._x=0,this._y=0,this._w=0,this._h=0,this._optFlags=0,this._funcX=null,this._funcY=null,this._funcW=null,this._funcH=null,this._scaleX=1,this._scaleY=1,this._pivotX=.5,this._pivotY=.5,this._mountX=0,this._mountY=0,this._rotation=0,this._alpha=1,this._visible=!0,this._ulx=0,this._uly=0,this._brx=1,this._bry=1,this._zIndex=0,this._forceZIndexContext=!1,this._zParent=null,this._isRoot=!1,this._zIndexResort=!1,this._shader=null,this._renderToTextureEnabled=!1,this._texturizer=null,this._useRenderToTexture=!1,this._boundsMargin=null,this._recBoundsMargin=null,this._withinBoundsMargin=!1,this._viewport=null,this._clipbox=!0,this.render=this._renderSimple,this._layout=null}get offsetX(){return this._funcX?this._funcX:this.hasFlexLayout()?this._layout.originalX:this._x}set offsetX(e){c.isFunction(e)?this.funcX=e:(this._disableFuncX(),this.hasFlexLayout()?(this.x+=e-this._layout.originalX,this._layout.setOriginalXWithoutUpdatingLayout(e)):this.x=e)}get x(){return this._x}set x(e){e!==this._x&&(this._updateLocalTranslateDelta(e-this._x,0),this._x=e)}get funcX(){return 1&this._optFlags?this._funcX:null}set funcX(e){this._funcX!==e&&(this._optFlags|=1,this._funcX=e,this.hasFlexLayout()?(this._layout.setOriginalXWithoutUpdatingLayout(0),this.layout.forceLayout()):(this._x=0,this._triggerRecalcTranslate()))}_disableFuncX(){this._optFlags=65534&this._optFlags,this._funcX=null}get offsetY(){return this._funcY?this._funcY:this.hasFlexLayout()?this._layout.originalY:this._y}set offsetY(e){c.isFunction(e)?this.funcY=e:(this._disableFuncY(),this.hasFlexLayout()?(this.y+=e-this._layout.originalY,this._layout.setOriginalYWithoutUpdatingLayout(e)):this.y=e)}get y(){return this._y}set y(e){e!==this._y&&(this._updateLocalTranslateDelta(0,e-this._y),this._y=e)}get funcY(){return 2&this._optFlags?this._funcY:null}set funcY(e){this._funcY!==e&&(this._optFlags|=2,this._funcY=e,this.hasFlexLayout()?(this._layout.setOriginalYWithoutUpdatingLayout(0),this.layout.forceLayout()):(this._y=0,this._triggerRecalcTranslate()))}_disableFuncY(){this._optFlags=65533&this._optFlags,this._funcY=null}get funcW(){return 4&this._optFlags?this._funcW:null}set funcW(e){this._funcW!==e&&(this._optFlags|=4,this._funcW=e,this.hasFlexLayout()?(this._layout._originalWidth=0,this.layout.changedDimensions(!0,!1)):(this._w=0,this._triggerRecalcTranslate()))}disableFuncW(){this._optFlags=65531&this._optFlags,this._funcW=null}get funcH(){return 8&this._optFlags?this._funcH:null}set funcH(e){this._funcH!==e&&(this._optFlags|=8,this._funcH=e,this.hasFlexLayout()?(this._layout._originalHeight=0,this.layout.changedDimensions(!1,!0)):(this._h=0,this._triggerRecalcTranslate()))}disableFuncH(){this._optFlags=65527&this._optFlags,this._funcH=null}get w(){return this._w}getRenderWidth(){return this.hasFlexLayout()?this._layout.originalWidth:this._w}get h(){return this._h}getRenderHeight(){return this.hasFlexLayout()?this._layout.originalHeight:this._h}get scaleX(){return this._scaleX}set scaleX(e){this._scaleX!==e&&(this._scaleX=e,this._updateLocalTransform())}get scaleY(){return this._scaleY}set scaleY(e){this._scaleY!==e&&(this._scaleY=e,this._updateLocalTransform())}get scale(){return this.scaleX}set scale(e){this._scaleX===e&&this._scaleY===e||(this._scaleX=e,this._scaleY=e,this._updateLocalTransform())}get pivotX(){return this._pivotX}set pivotX(e){this._pivotX!==e&&(this._pivotX=e,this._updateLocalTranslate())}get pivotY(){return this._pivotY}set pivotY(e){this._pivotY!==e&&(this._pivotY=e,this._updateLocalTranslate())}get pivot(){return this._pivotX}set pivot(e){this._pivotX===e&&this._pivotY===e||(this._pivotX=e,this._pivotY=e,this._updateLocalTranslate())}get mountX(){return this._mountX}set mountX(e){this._mountX!==e&&(this._mountX=e,this._updateLocalTranslate())}get mountY(){return this._mountY}set mountY(e){this._mountY!==e&&(this._mountY=e,this._updateLocalTranslate())}get mount(){return this._mountX}set mount(e){this._mountX===e&&this._mountY===e||(this._mountX=e,this._mountY=e,this._updateLocalTranslate())}get rotation(){return this._rotation}set rotation(e){this._rotation!==e&&(this._rotation=e,this._updateLocalTransform())}get alpha(){return this._alpha}set alpha(e){if(e=e>1?1:e<1e-14?0:e,this._alpha!==e){var t=this._alpha;this._alpha=e,this._updateLocalAlpha(),0===t!=(0===e)&&this._element._updateEnabledFlag()}}get visible(){return this._visible}set visible(e){this._visible!==e&&(this._visible=e,this._updateLocalAlpha(),this._element._updateEnabledFlag(),this.hasFlexLayout()&&this.layout.setVisible(e))}_updateLocalTransform(){if(0!==this._rotation&&this._rotation%(2*Math.PI)){var e=Math.sin(this._rotation),t=Math.cos(this._rotation);this._setLocalTransform(t*this._scaleX,-e*this._scaleY,e*this._scaleX,t*this._scaleY)}else this._setLocalTransform(this._scaleX,0,0,this._scaleY);this._updateLocalTranslate()}_updateLocalTranslate(){this._recalcLocalTranslate(),this._triggerRecalcTranslate()}_recalcLocalTranslate(){var e=this._pivotX*this._w,t=this._pivotY*this._h,i=this._x-(e*this._localTa+t*this._localTb)+e,r=this._y-(e*this._localTc+t*this._localTd)+t;i-=this._mountX*this._w,r-=this._mountY*this._h,this._localPx=i,this._localPy=r}_updateLocalTranslateDelta(e,t){this._addLocalTranslate(e,t)}_updateLocalAlpha(){this._setLocalAlpha(this._visible?this._alpha:0)}setHasRenderUpdates(e){if(this._worldContext.alpha){var t=this;for(t._hasRenderUpdates=Math.max(e,t._hasRenderUpdates);(t=t._parent)&&3!==t._hasRenderUpdates;)t._hasRenderUpdates=3}}_setRecalc(e){this._recalc|=e,this._setHasUpdates(),this._parent&&this._parent.setHasRenderUpdates(3)}_setHasUpdates(){for(var e=this;e&&!e._hasUpdates;)e._hasUpdates=!0,e=e._parent}getParent(){return this._parent}setParent(e){if(e!==this._parent){var t=this.isZContext(),i=this._parent;if(this._parent=e,(this._layout||e&&e.isFlexContainer())&&this.layout.setParent(i,e),i&&i.setHasRenderUpdates(3),this._setRecalc(7),this._parent&&this._parent._setHasUpdates(),0===this._zIndex?this.setZParent(e):this.setZParent(e?e.findZContext():null),t!==this.isZContext()&&(this.isZContext()?this.enableZContext(i.findZContext()):this.disableZContext()),this._zIndexResort=!0,this._zParent&&this._zParent.enableZSort(),!this._shader){var r=e&&!e._renderToTextureEnabled?e._shaderOwner:null;r!==this._shaderOwner&&(this.setHasRenderUpdates(1),this._setShaderOwnerRecursive(r))}}}enableZSort(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];!this._zSort&&this._zContextUsage>0&&(this._zSort=!0,e&&this.ctx.forceZSort(this))}addChildAt(e,t){this._children||(this._children=[]),this._children.splice(e,0,t),t.setParent(this)}setChildAt(e,t){this._children||(this._children=[]),this._children[e].setParent(null),this._children[e]=t,t.setParent(this)}removeChildAt(e){var t=this._children[e];this._children.splice(e,1),t.setParent(null)}removeChildren(){if(this._children){for(var e=0,t=this._children.length;e<t;e++)this._children[e].setParent(null);this._children.splice(0),this._zIndexedChildren&&this._zIndexedChildren.splice(0)}}syncChildren(e,t,i){this._children=i;for(var r=0,n=e.length;r<n;r++)e[r].setParent(null);for(var s=0,a=t.length;s<a;s++)t[s].setParent(this)}moveChild(e,t){var i=this._children[e];this._children.splice(e,1),this._children.splice(t,0,i),this._zIndexResort=!0,this._zParent&&this._zParent.enableZSort()}_setLocalTransform(e,t,i,r){this._setRecalc(4),this._localTa=e,this._localTb=t,this._localTc=i,this._localTd=r,this._isComplex=0!==t||0!==i||e<0||r<0}_addLocalTranslate(e,t){this._localPx+=e,this._localPy+=t,this._triggerRecalcTranslate()}_setLocalAlpha(e){!this._worldContext.alpha&&this._parent&&this._parent._worldContext.alpha&&e?this._setRecalc(129):this._setRecalc(1),e<1e-14&&(e=0),this._localAlpha=e}setDimensions(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._dimsUnknown;if(this._dimsUnknown=i,this.hasFlexLayout())this._layout.originalWidth=e,this._layout.originalHeight=t;else if(this._w!==e||this._h!==t)return this._updateDimensions(e,t),!0;return!1}_updateDimensions(e,t){this._w===e&&this._h===t||(this._w=e,this._h=t,this._triggerRecalcTranslate(),this._texturizer&&(this._texturizer.releaseRenderTexture(),this._texturizer.updateResultTexture()),this._updateLocalTranslate())}setTextureCoords(e,t,i,r){this.setHasRenderUpdates(3),this._ulx=e,this._uly=t,this._brx=i,this._bry=r}get displayedTextureSource(){return this._displayedTextureSource}setDisplayedTextureSource(e){this.setHasRenderUpdates(3),this._displayedTextureSource=e}get isRoot(){return this._isRoot}setAsRoot(){this._parent=new R(this._element),this._parent._hasRenderUpdates=3,this._parent._hasUpdates=!0,this._isRoot=!0,this.ctx.root=this,this._parent._viewport=[0,0,this.ctx.stage.coordsWidth,this.ctx.stage.coordsHeight],this._parent._scissor=this._parent._viewport,this._parent._recBoundsMargin=null,this._setRecalc(7)}isAncestorOf(e){for(var t=e;t=t._parent;)if(this===t)return!0;return!1}isZContext(){return this._forceZIndexContext||this._renderToTextureEnabled||0!==this._zIndex||this._isRoot||!this._parent}findZContext(){return this.isZContext()?this:this._parent.findZContext()}setZParent(e){if(this._zParent!==e){if(null!==this._zParent&&(0!==this._zIndex&&this._zParent.decZContextUsage(),this._zParent.enableZSort()),null!==e){var t=e._zContextUsage>0;0!==this._zIndex&&e.incZContextUsage(),e._zContextUsage>0&&((t||this._parent!==e)&&e._zIndexedChildren.push(this),e.enableZSort())}this._zParent=e,this._zIndexResort=!0}}incZContextUsage(){if(this._zContextUsage++,1===this._zContextUsage&&(this._zIndexedChildren||(this._zIndexedChildren=[]),this._children)){for(var e=0,t=this._children.length;e<t;e++)this._zIndexedChildren.push(this._children[e]);this._zSort=!1}}decZContextUsage(){this._zContextUsage--,0===this._zContextUsage&&(this._zSort=!1,this._zIndexedChildren.splice(0))}get zIndex(){return this._zIndex}set zIndex(e){if(this._zIndex!==e){this.setHasRenderUpdates(1);var t=this._zParent,i=this.isZContext();0===e&&0!==this._zIndex?this._parent===this._zParent?this._zParent&&this._zParent.decZContextUsage():t=this._parent:0!==e&&0===this._zIndex?(t=this._parent?this._parent.findZContext():null)===this._zParent&&this._zParent&&(this._zParent.incZContextUsage(),this._zParent.enableZSort()):e!==this._zIndex&&this._zParent&&this._zParent._zContextUsage&&this._zParent.enableZSort(),t!==this._zParent&&this.setZParent(null),this._zIndex=e,t!==this._zParent&&this.setZParent(t),i!==this.isZContext()&&(this.isZContext()?this.enableZContext(this._parent.findZContext()):this.disableZContext()),this._zIndexResort=!0,this._zParent&&this._zParent.enableZSort()}}get forceZIndexContext(){return this._forceZIndexContext}set forceZIndexContext(e){this.setHasRenderUpdates(1);var t=this.isZContext();this._forceZIndexContext=e,t!==this.isZContext()&&(this.isZContext()?this.enableZContext(this._parent.findZContext()):this.disableZContext())}enableZContext(e){e&&e._zContextUsage>0&&this._getZIndexedDescs().forEach((e=>{this.isAncestorOf(e)&&0!==e._zIndex&&e.setZParent(this)}))}_getZIndexedDescs(){var e=[];if(this._children)for(var t=0,i=this._children.length;t<i;t++)this._children[t]._getZIndexedDescsRec(e);return e}_getZIndexedDescsRec(e){if(this._zIndex)e.push(this);else if(this._children&&!this.isZContext())for(var t=0,i=this._children.length;t<i;t++)this._children[t]._getZIndexedDescsRec(e)}disableZContext(){if(this._zContextUsage>0){var e=this._parent.findZContext();this._zSort&&this.sortZIndexedChildren(),this._zIndexedChildren.slice().forEach((function(t){0!==t._zIndex&&t.setZParent(e)}))}}get colorUl(){return this._colorUl}set colorUl(e){this._colorUl!==e&&(this.setHasRenderUpdates(this._displayedTextureSource?3:1),this._colorUl=e)}get colorUr(){return this._colorUr}set colorUr(e){this._colorUr!==e&&(this.setHasRenderUpdates(this._displayedTextureSource?3:1),this._colorUr=e)}get colorBl(){return this._colorBl}set colorBl(e){this._colorBl!==e&&(this.setHasRenderUpdates(this._displayedTextureSource?3:1),this._colorBl=e)}get colorBr(){return this._colorBr}set colorBr(e){this._colorBr!==e&&(this.setHasRenderUpdates(this._displayedTextureSource?3:1),this._colorBr=e)}set onUpdate(e){this._onUpdate=e,this._setRecalc(7)}set onAfterUpdate(e){this._onAfterUpdate=e,this._setRecalc(7)}set onAfterCalcs(e){this._onAfterCalcs=e,this._setRecalc(7)}get shader(){return this._shader}set shader(e){this.setHasRenderUpdates(1);var t=this._shader;if(this._shader=e,!e&&t){var i=this._parent&&!this._parent._renderToTextureEnabled?this._parent._shaderOwner:null;this._setShaderOwnerRecursive(i)}else e&&this._setShaderOwnerRecursive(this)}get activeShader(){return this._shaderOwner?this._shaderOwner.shader:this.renderState.defaultShader}get activeShaderOwner(){return this._shaderOwner}get clipping(){return this._clipping}set clipping(e){this._clipping!==e&&(this._clipping=e,this._setRecalc(3))}get clipbox(){return this._clipbox}set clipbox(e){this._clipbox=e}_setShaderOwnerRecursive(e){if(this._shaderOwner=e,this._children&&!this._renderToTextureEnabled)for(var t=0,i=this._children.length;t<i;t++){var r=this._children[t];r._shader||(r._setShaderOwnerRecursive(e),r._hasRenderUpdates=3)}}_setShaderOwnerChildrenRecursive(e){if(this._children)for(var t=0,i=this._children.length;t<i;t++){var r=this._children[t];r._shader||(r._setShaderOwnerRecursive(e),r._hasRenderUpdates=3)}}_hasRenderContext(){return this._renderContext!==this._worldContext}get renderContext(){return this._renderContext}updateRenderToTextureEnabled(){this.texturizer._enabled?this._enableRenderToTexture():(this._disableRenderToTexture(),this._texturizer.releaseRenderTexture())}_enableRenderToTexture(){if(!this._renderToTextureEnabled){var e=this.isZContext();this._renderToTextureEnabled=!0,this._renderContext=new L,this._setShaderOwnerChildrenRecursive(null),e||this.enableZContext(this._parent?this._parent.findZContext():null),this.setHasRenderUpdates(3),this._setRecalc(7),this.render=this._renderAdvanced}}_disableRenderToTexture(){this._renderToTextureEnabled&&(this._renderToTextureEnabled=!1,this._setShaderOwnerChildrenRecursive(this._shaderOwner),this._renderContext=this._worldContext,this.isZContext()||this.disableZContext(),this._setRecalc(7),this.setHasRenderUpdates(3),this.render=this._renderSimple)}isWhite(){return 4294967295===this._colorUl&&4294967295===this._colorUr&&4294967295===this._colorBl&&4294967295===this._colorBr}hasSimpleTexCoords(){return 0===this._ulx&&0===this._uly&&1===this._brx&&1===this._bry}_stashTexCoords(){this._stashedTexCoords=[this._ulx,this._uly,this._brx,this._bry],this._ulx=0,this._uly=0,this._brx=1,this._bry=1}_unstashTexCoords(){this._ulx=this._stashedTexCoords[0],this._uly=this._stashedTexCoords[1],this._brx=this._stashedTexCoords[2],this._bry=this._stashedTexCoords[3],this._stashedTexCoords=null}_stashColors(){this._stashedColors=[this._colorUl,this._colorUr,this._colorBr,this._colorBl],this._colorUl=4294967295,this._colorUr=4294967295,this._colorBr=4294967295,this._colorBl=4294967295}_unstashColors(){this._colorUl=this._stashedColors[0],this._colorUr=this._stashedColors[1],this._colorBr=this._stashedColors[2],this._colorBl=this._stashedColors[3],this._stashedColors=null}isVisible(){return this._localAlpha>1e-14}get outOfBounds(){return this._outOfBounds}set boundsMargin(e){this._boundsMargin=e?e.slice():null,this._triggerRecalcTranslate()}get boundsMargin(){return this._boundsMargin}update(){this._recalc|=this._parent._pRecalc,this._layout&&this._layout.isEnabled()?256&this._recalc&&this._layout.layoutFlexTree():2&this._recalc&&this._optFlags&&this._applyRelativeDimFuncs(),this._onUpdate&&(this._hasUpdates=!0,this._onUpdate(this.element,this));var e=this._parent._worldContext,t=this._worldContext,i=e.alpha&&this._localAlpha;if(this._hasUpdates||this._recalc&&i||t.alpha&&!i){var r=this._recalc;1&r&&(!t.alpha&&i&&(this._hasRenderUpdates=3),t.alpha=e.alpha*this._localAlpha,t.alpha<1e-14&&(t.alpha=0)),6&r&&(t.px=e.px+this._localPx*e.ta,t.py=e.py+this._localPy*e.td,0!==e.tb&&(t.px+=this._localPy*e.tb),0!==e.tc&&(t.py+=this._localPx*e.tc)),4&r&&(t.ta=this._localTa*e.ta,t.tb=this._localTd*e.tb,t.tc=this._localTa*e.tc,t.td=this._localTd*e.td,this._isComplex&&(t.ta+=this._localTc*e.tb,t.tb+=this._localTb*e.ta,t.tc+=this._localTc*e.td,t.td+=this._localTb*e.tc));var n=this._parent._renderContext;if(this._parent._hasRenderContext()){var s=this._renderContext===this._worldContext;s&&(this._renderContext=new L);var a=this._renderContext;(s||1&r)&&(a.alpha=n.alpha*this._localAlpha,a.alpha<1e-14&&(a.alpha=0)),(s||6&r)&&(a.px=n.px+this._localPx*n.ta,a.py=n.py+this._localPy*n.td,0!==n.tb&&(a.px+=this._localPy*n.tb),0!==n.tc&&(a.py+=this._localPx*n.tc)),s&&(r|=2),(s||4&r)&&(a.ta=this._localTa*n.ta,a.tb=this._localTd*n.tb,a.tc=this._localTa*n.tc,a.td=this._localTd*n.td,this._isComplex&&(a.ta+=this._localTc*n.tb,a.tb+=this._localTb*n.ta,a.tc+=this._localTc*n.td,a.td+=this._localTb*n.tc))}else this._renderContext=this._worldContext;-1===this.ctx.updateTreeOrder?this.ctx.updateTreeOrder=this._updateTreeOrder+1:this._updateTreeOrder=this.ctx.updateTreeOrder++;var o=this._renderToTextureEnabled&&this._texturizer.mustRenderToTexture();this._useRenderToTexture!==o&&(this._recalc|=6,r|=2,this._useRenderToTexture||this._texturizer.release()),this._useRenderToTexture=o;var h,u,l,c,d=this._renderContext,p=this._dimsUnknown?2048:this._w,g=this._dimsUnknown?2048:this._h,f=0!==d.tb||0!==d.tc||d.ta<0||d.td<0;if(f?(h=Math.min(0,p*d.ta,p*d.ta+g*d.tb,g*d.tb)+d.px,l=Math.max(0,p*d.ta,p*d.ta+g*d.tb,g*d.tb)+d.px,u=Math.min(0,p*d.tc,p*d.tc+g*d.td,g*d.td)+d.py,c=Math.max(0,p*d.tc,p*d.tc+g*d.td,g*d.td)+d.py):(h=d.px,l=d.px+d.ta*p,u=d.py,c=d.py+d.td*g),this._dimsUnknown&&(f||this._localTa<1||this._localTb<1)){var m=this._x*n.ta+this._y*n.tb+n.px,_=this._x*n.tc+this._y*n.td+n.py;m<h&&(h=m),_<u&&(u=_),m>l&&(l=m),_>c&&(c=_)}if(6&r||!this._scissor)if(this._clipping&&d.isSquare()){var v=this._parent._useRenderToTexture?this._parent._viewport:this._parent._scissor;if(v){var y=Math.max(v[0],h),x=Math.max(v[1],u);this._scissor=[y,x,Math.min(v[2]+v[0],l)-y,Math.min(v[3]+v[1],c)-x]}else this._scissor=[h,u,l-h,c-u]}else this._scissor=this._parent._useRenderToTexture?this._parent._viewport:this._parent._scissor;if(this._boundsMargin?this._recBoundsMargin=this._boundsMargin:this._recBoundsMargin=this._parent._recBoundsMargin,this._onAfterCalcs&&this._onAfterCalcs(this.element)&&(f?(h=Math.min(0,p*d.ta,p*d.ta+g*d.tb,g*d.tb)+d.px,l=Math.max(0,p*d.ta,p*d.ta+g*d.tb,g*d.tb)+d.px,u=Math.min(0,p*d.tc,p*d.tc+g*d.td,g*d.td)+d.py,c=Math.max(0,p*d.tc,p*d.tc+g*d.td,g*d.td)+d.py):(h=d.px,l=d.px+d.ta*p,u=d.py,c=d.py+d.td*g),this._dimsUnknown&&(f||this._localTa<1||this._localTb<1))){var b=this._x*n.ta+this._y*n.tb+n.px,w=this._x*n.tc+this._y*n.td+n.py;b<h&&(h=b),w<u&&(u=w),b>l&&(l=b),w>c&&(c=w)}if(2===this._parent._outOfBounds)this._outOfBounds=2,this._withinBoundsMargin&&(this._withinBoundsMargin=!1,this.element._disableWithinBoundsMargin());else if(6&r){this._outOfBounds=0;var T=!0;if(this._renderToTextureEnabled&&this._texturizer&&this._texturizer.renderOffscreen||(this._scissor&&(this._scissor[2]<=0||this._scissor[3]<=0)?this._outOfBounds=2:((this._scissor[0]>l||this._scissor[1]>c||h>this._scissor[0]+this._scissor[2]||u>this._scissor[1]+this._scissor[3])&&(this._outOfBounds=1),this._outOfBounds&&(this._clipping||this._useRenderToTexture||this._clipbox&&p&&g)&&(this._outOfBounds=2)),(T=0===this._outOfBounds)||(T=this._recBoundsMargin?!(l<this._scissor[0]-this._recBoundsMargin[2]||c<this._scissor[1]-this._recBoundsMargin[3]||h>this._scissor[0]+this._scissor[2]+this._recBoundsMargin[0]||u>this._scissor[1]+this._scissor[3]+this._recBoundsMargin[1]):!(l<this._scissor[0]-100||c<this._scissor[1]-100||h>this._scissor[0]+this._scissor[2]+100||u>this._scissor[1]+this._scissor[3]+100))&&2===this._outOfBounds&&(this._outOfBounds=1)),this._withinBoundsMargin!==T)if(this._withinBoundsMargin=T,this._withinBoundsMargin){this._hasUpdates=!0;var S=this._recalc;if(this._recalc=0,this.element._enableWithinBoundsMargin(),this._recalc)return this.update();this._recalc=S}else this.element._disableWithinBoundsMargin()}if(this._useRenderToTexture&&(this._viewport?(this._viewport[2]=p,this._viewport[3]=g):this._viewport=[0,0,p,g]),this._pRecalc=135&this._recalc,this._recalc=0,this._hasUpdates=!1,this._outOfBounds<2){if(this._useRenderToTexture&&(this._worldContext.isIdentity()?this._renderContext=this._worldContext:this._renderContext=L.IDENTITY),this._children)for(var A=0,C=this._children.length;A<C;A++)this._children[A].update();this._useRenderToTexture&&(this._renderContext=d)}else if(this._children)for(var E=0,I=this._children.length;E<I;E++)this._children[E]._hasUpdates?this._children[E].update():(this._children[E]._recalc|=this._pRecalc,this._children[E].updateOutOfBounds());this._onAfterUpdate&&this._onAfterUpdate(this.element)}else-1===this.ctx.updateTreeOrder||this._updateTreeOrder>=this.ctx.updateTreeOrder?this.ctx.updateTreeOrder=-1:this.updateTreeOrder()}_applyRelativeDimFuncs(){if(1&this._optFlags){var e=this._funcX(this._parent.w);e!==this._x&&(this._localPx+=e-this._x,this._x=e)}if(2&this._optFlags){var t=this._funcY(this._parent.h);t!==this._y&&(this._localPy+=t-this._y,this._y=t)}var i=!1;if(4&this._optFlags){var r=this._funcW(this._parent.w);r!==this._w&&(this._w=r,i=!0)}if(8&this._optFlags){var n=this._funcH(this._parent.h);n!==this._h&&(this._h=n,i=!0)}i&&(this._recalcLocalTranslate(),this.element.onDimensionsChanged(this._w,this._h))}updateOutOfBounds(){if(2!==this._outOfBounds&&this._renderContext.alpha>0&&(this._outOfBounds=2,this._withinBoundsMargin&&(this._withinBoundsMargin=!1,this.element._disableWithinBoundsMargin()),this._children))for(var e=0,t=this._children.length;e<t;e++)this._children[e].updateOutOfBounds()}updateTreeOrder(){if(this._localAlpha&&2!==this._outOfBounds&&(this._updateTreeOrder=this.ctx.updateTreeOrder++,this._children))for(var e=0,t=this._children.length;e<t;e++)this._children[e].updateTreeOrder()}_renderSimple(){if(this._hasRenderUpdates=0,this._zSort&&this.sortZIndexedChildren(),this._outOfBounds<2&&this._renderContext.alpha){var e=this.renderState;if(0===this._outOfBounds&&this._displayedTextureSource&&(e.setShader(this.activeShader,this._shaderOwner),e.setScissor(this._scissor),this.renderState.addQuad(this)),this._children)if(this._zContextUsage)for(var t=0,i=this._zIndexedChildren.length;t<i;t++)this._zIndexedChildren[t].render();else for(var r=0,n=this._children.length;r<n;r++)0===this._children[r]._zIndex&&this._children[r].render()}}_renderAdvanced(){var e=this._hasRenderUpdates;if(this._hasRenderUpdates=0,this._zSort&&this.sortZIndexedChildren(),this._outOfBounds<2&&this._renderContext.alpha){var t,i,r=this.renderState,n=!0;if(this._useRenderToTexture){if(0===this._w||0===this._h)return;if(!this._texturizer.hasRenderTexture()||e>=3){if(this.ctx.renderToTextureCount++,r.setShader(r.defaultShader,this),i=r.renderTextureInfo,t={nativeTexture:null,offset:0,w:this._w,h:this._h,empty:!0,cleared:!1,ignore:!1,cache:!1},(this._texturizer.hasResultTexture()||!r.isCachingTexturizer&&e<3)&&(t.cache=!0,r.isCachingTexturizer=!0),this._texturizer.hasResultTexture()||this._texturizer.releaseRenderTexture(),r.setRenderTextureInfo(t),r.setScissor(null),this._displayedTextureSource){var s=this._renderContext;this._renderContext=L.IDENTITY,this.renderState.addQuad(this),this._renderContext=s}}else n=!1}else 0===this._outOfBounds&&this._displayedTextureSource&&(r.setShader(this.activeShader,this._shaderOwner),r.setScissor(this._scissor),this.renderState.addQuad(this));if(n&&this._children)if(this._zContextUsage)for(var a=0,o=this._zIndexedChildren.length;a<o;a++)this._zIndexedChildren[a].render();else for(var h=0,u=this._children.length;h<u;h++)0===this._children[h]._zIndex&&this._children[h].render();if(this._useRenderToTexture){var l=!1;if(n&&(r.finishedRenderTexture(),this._texturizer.empty=t.empty,t.empty?this._texturizer.releaseRenderTexture():t.nativeTexture?(this._texturizer.reuseTextureAsRenderTexture(t.nativeTexture),t.ignore=!0):(this._texturizer.renderTextureReused&&this._texturizer.releaseRenderTexture(),t.nativeTexture=this._texturizer.getRenderTexture()),r.setRenderTextureInfo(i),l=!0),!this._texturizer.empty){var c=this._texturizer.getResultTexture();if(l&&(c&&(c.update=r.stage.frameCounter),this._texturizer.updateResultTexture()),!this._texturizer.renderOffscreen){r.setShader(this.activeShader,this._shaderOwner),r.setScissor(this._scissor);var d=!t||t.cache;r.setTexturizer(this._texturizer,d),this._stashTexCoords(),this._texturizer.colorize||this._stashColors(),this.renderState.addQuad(this,!0),this._texturizer.colorize||this._unstashColors(),this._unstashTexCoords(),r.setTexturizer(null)}}}t&&t.cache&&(r.isCachingTexturizer=!1)}}get zSort(){return this._zSort}sortZIndexedChildren(){for(var e=this._zIndexedChildren.length,t=0,i=this._zIndexedChildren,r=[],n=0;n<e;n++)i[n]._zParent===this&&(i[n]._zIndexResort?r.push(i[n]):(t!==n&&(i[t]=i[n]),t++));var s=r.length;if(s){for(var a=0;a<s;a++)r[a]._zIndexResort=!1;r.sort(R.sortZIndexedChildren);var o=t;if(o){t=0;for(var h=0,u=0,l=[];;){var c=(i[h]._zIndex===r[u]._zIndex?i[h]._updateTreeOrder-r[u]._updateTreeOrder:i[h]._zIndex-r[u]._zIndex)>0?r[u++]:i[h++];if(0!==t&&l[t-1]===c||(l[t++]=c),h>=o){do{var d=r[u++];0!==t&&l[t-1]===d||(l[t++]=d)}while(u<s);break}if(u>=s){do{var p=i[h++];0!==t&&l[t-1]===p||(l[t++]=p)}while(h<o);break}}this._zIndexedChildren=l}else{t=0;var g=0;do{i[t++]=r[g++]}while(g<s);i.length>t&&i.splice(t)}}else i.length>t&&i.splice(t);this._zSort=!1}get localTa(){return this._localTa}get localTb(){return this._localTb}get localTc(){return this._localTc}get localTd(){return this._localTd}get element(){return this._element}get renderUpdates(){return this._hasRenderUpdates}get texturizer(){return this._texturizer||(this._texturizer=new I(this)),this._texturizer}getCornerPoints(){var e=this._worldContext;return[e.px,e.py,e.px+this._w*e.ta,e.py+this._w*e.tc,e.px+this._w*e.ta+this._h*e.tb,e.py+this._w*e.tc+this._h*e.td,e.px+this._h*e.tb,e.py+this._h*e.td]}getRenderTextureCoords(e,t){var i=this._renderContext;return[i.px+i.ta*e+i.tb*t,i.py+i.tc*e+i.td*t]}getAbsoluteCoords(e,t){var i=this._renderContext;return[i.px+i.ta*e+i.tb*t,i.py+i.tc*e+i.td*t]}collectAtCoord(e,t,i){if(0!==this._renderContext.alpha){if(this.inBound(e,t)&&(this._scissor?this.inScissor()&&i.push(this):i.push(this)),this._children)for(var r=this._children.length,n=0;n<r;n++)this._children[n].collectAtCoord(e,t,i);return i.sort(R.sortZIndexedChildren)}}inBound(e,t){var i=this.getCornerPoints();return e>i[0]&&e<i[2]&&t>i[1]&&t<i[7]}inScissor(){var e=this._scissor,t=this.getCornerPoints();return t[2]>=e[0]&&t[0]<=e[0]+e[2]&&t[7]>=e[1]&&t[1]<=e[1]+e[3]}get layout(){return this._ensureLayout(),this._layout}get flex(){return this._layout?this._layout.flex:null}set flex(e){this.layout.flex=e}get flexItem(){return this._layout?this._layout.flexItem:null}set flexItem(e){this.layout.flexItem=e}isFlexItem(){return!!this._layout&&this._layout.isFlexItemEnabled()}isFlexContainer(){return!!this._layout&&this._layout.isFlexEnabled()}enableFlexLayout(){this._ensureLayout()}_ensureLayout(){this._layout||(this._layout=new C(this))}disableFlexLayout(){this._triggerRecalcTranslate()}hasFlexLayout(){return this._layout&&this._layout.isEnabled()}setLayout(e,t,i,r){this.x=e,this.y=t,this._updateDimensions(i,r)}triggerLayout(){this._setRecalc(256)}_triggerRecalcTranslate(){this._setRecalc(2)}}class L{constructor(){this.alpha=1,this.px=0,this.py=0,this.ta=1,this.tb=0,this.tc=0,this.td=1}isIdentity(){return 1===this.alpha&&0===this.px&&0===this.py&&1===this.ta&&0===this.tb&&0===this.tc&&1===this.td}isSquare(){return 0===this.tb&&0===this.tc}}L.IDENTITY=new L,R.sortZIndexedChildren=function(e,t){return e._zIndex===t._zIndex?e._updateTreeOrder-t._updateTreeOrder:e._zIndex-t._zIndex};class k{constructor(){this._hasEventListeners=!1}on(e,t){this._hasEventListeners||(this._eventFunction={},this._eventListeners={},this._hasEventListeners=!0),this._eventFunction[e]?this._eventFunction[e]!==k.combiner?(this._eventListeners[e]=[this._eventFunction[e],t],this._eventFunction[e]=k.combiner):this._eventListeners[e].push(t):this._eventFunction[e]=t}once(e,t){var i=(r,n,s)=>{t(r,n,s),this.off(e,i)};i.__originalFunc=t,this.on(e,i)}has(e,t){if(this._hasEventListeners){var i=this._eventFunction[e];if(i)if(i===k.combiner){var r,n=o(this._eventListeners[e]);try{for(n.s();!(r=n.n()).done;){var s=r.value;if(s===t||s.__originalFunc==t)return!0}}catch(a){n.e(a)}finally{n.f()}}else if(this._eventFunction[e]===t||this._eventFunction[e].__originalFunc===t)return!0}return!1}off(e,t){if(this._hasEventListeners){var i=this._eventFunction[e];if(i)if(i===k.combiner){var r=this._eventListeners[e],n=r.indexOf(t);n>=0&&r.splice(n,1),(n=r.map((e=>e.__originalFunc)).indexOf(t))>=0&&r.splice(n,1),1===r.length&&(this._eventFunction[e]=r[0],this._eventListeners[e]=void 0)}else this._eventFunction[e]!==t&&this._eventFunction[e].__originalFunc!==t||(this._eventFunction[e]=void 0)}}removeListener(e,t){this.off(e,t)}emit(e,t,i,r){if(this._hasEventListeners){var n=this._eventFunction[e];n&&(n===k.combiner?n(this,e,t,i,r):n(t,i,r))}}listenerCount(e){if(this._hasEventListeners){var t=this._eventFunction[e];if(t)return t===k.combiner?this._eventListeners[e].length:1}return 0}removeAllListeners(e){this._hasEventListeners&&(delete this._eventFunction[e],delete this._eventListeners[e])}}k.combiner=function(e,t,i,r,n){var s=e._eventListeners[t];if(s)for(var a=0,o=[...s];a<o.length;a++){(0,o[a])(i,r,n)}},k.addAsMixin=function(e){e.prototype.on=k.prototype.on,e.prototype.once=k.prototype.once,e.prototype.has=k.prototype.has,e.prototype.off=k.prototype.off,e.prototype.removeListener=k.prototype.removeListener,e.prototype.emit=k.prototype.emit,e.prototype.listenerCount=k.prototype.listenerCount,e.prototype.removeAllListeners=k.prototype.removeAllListeners};class M{constructor(e){this._initialized=!1,this.ctx=e,this._elements=new Set}static create(e,t){var i;if(c.isObjectLiteral(t))(i=t.type?e.renderer.createShader(e.ctx,t):this.shader)&&d.patchObject(i,t);else if(null===t)i=e.ctx.renderState.defaultShader;else if(void 0===t)i=null;else{if(!t.isShader)return void console.error("[Lightning] Please specify a shader type.");e.renderer.isValidShaderType(t.constructor)||(console.error("[Lightning] Invalid shader type"),t=null),i=t}return i}static getWebGL(){}static getC2d(){}addElement(e){this._elements.add(e)}removeElement(e){this._elements.delete(e),this._elements||this.cleanup()}redraw(){this._elements.forEach((e=>{e.setHasRenderUpdates(2)}))}patch(e){d.patchObject(this,e)}useDefault(){return!1}addEmpty(){return!1}cleanup(){}get isShader(){return!0}}class P{constructor(e){this.stage=e,this.manager=this.stage.textureManager,this.id=P.id++,this.elements=new Set,this._activeCount=0,this._source=null,this._resizeMode=null,this._x=0,this._y=0,this._w=0,this._h=0,this._precision=1,this.mw=0,this.mh=0,this.clipping=!1,this._mustUpdate=!0}get source(){return(this._mustUpdate||this.stage.hasUpdateSourceTexture(this))&&(this._performUpdateSource(!0),this.stage.removeUpdateSourceTexture(this)),this._source}addElement(e){this.elements.has(e)||(this.elements.add(e),1===this.elements.size&&this._source&&this._source.addTexture(this),e.active&&this.incActiveCount())}removeElement(e){this.elements.delete(e)&&(0===this.elements.size&&this._source&&this._source.removeTexture(this),e.active&&this.decActiveCount())}incActiveCount(){this.source&&this._checkForNewerReusableTextureSource(),this._activeCount++,1===this._activeCount&&this.becomesUsed()}decActiveCount(){this.source,this._activeCount--,this._activeCount||this.becomesUnused()}becomesUsed(){this.source&&this.source.incActiveTextureCount()}onLoad(){this._resizeMode&&this._applyResizeMode(),this.elements.forEach((e=>{e.active&&e.onTextureSourceLoaded()}))}_checkForNewerReusableTextureSource(){var e=this.source;if(e.isLoaded())this._resizeMode&&this._applyResizeMode();else{var t=this._getReusableTextureSource();t&&t.isLoaded()&&t!==e&&this._replaceTextureSource(t)}}becomesUnused(){this.source&&this.source.decActiveTextureCount()}isUsed(){return this._activeCount>0}_getLookupId(){return null}_getSourceLoader(){throw new Error("Texture.generate must be implemented.")}get isValid(){return this._getIsValid()}_getIsValid(){return!0}_changed(){this.isUsed()?this._updateSource():this._mustUpdate=!0}_updateSource(){this.stage.addUpdateSourceTexture(this)}_performUpdateSource(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0]||this.isUsed()){this._mustUpdate=!1;var e=this._getTextureSource();this._replaceTextureSource(e)}}_getTextureSource(){var e=null;if(this._getIsValid()){var t=this._getLookupId();(e=this._getReusableTextureSource(t))||(e=this.manager.getTextureSource(this._getSourceLoader(),t))}return e}_getReusableTextureSource(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._getLookupId();return this._getIsValid()&&e?this.manager.getReusableTextureSource(e):null}_replaceTextureSource(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=this._source;if(this._source=e,this.elements.size&&(t&&(this._activeCount&&t.decActiveTextureCount(),t.removeTexture(this),this.text&&!t.isUsed()&&this.manager.freeTextureSource(t)),e&&(e.addTexture(this),this._activeCount&&e.incActiveTextureCount())),this.isUsed())if(e)if(e.isLoaded())this._resizeMode&&this._applyResizeMode(),this.elements.forEach((e=>{e.active&&e._setDisplayedTexture(this)}));else{var i=e.loadError;i&&this.elements.forEach((e=>{e.active&&e.onTextureSourceLoadError(i)}))}else this.elements.forEach((e=>{e.active&&e._setDisplayedTexture(null)}))}load(){this.source&&(this.isLoaded()||this.source.load(!0))}isLoaded(){return this._source&&this._source.isLoaded()}get loadError(){return this._source&&this._source.loadError}free(){this._source&&this._source.free()}set resizeMode(e){var t=e.type,i=void 0===t?"cover":t,r=e.w,n=void 0===r?0:r,s=e.h,a=void 0===s?0:s,o=e.clipX,h=void 0===o?.5:o,u=e.clipY,l=void 0===u?.5:u;this._resizeMode={type:i,w:n,h:a,clipX:h,clipY:l},this.isLoaded()&&this._applyResizeMode()}get resizeMode(){return this._resizeMode}_clearResizeMode(){this._resizeMode=null}_applyResizeMode(){"cover"===this._resizeMode.type?this._applyResizeCover():"contain"===this._resizeMode.type&&this._applyResizeContain(),this._updatePrecision(),this._updateClipping()}_applyResizeCover(){var e=this._resizeMode.w/this._source.w,t=this._resizeMode.h/this._source.h,i=Math.max(e,t);if(i){if(this._precision=1/i,e&&e<i){var r=this._precision*this._resizeMode.w,n=this._source.w-r;this._x=n*this._resizeMode.clipX,this._w=this._source.w-n}if(t&&t<i){var s=this._precision*this._resizeMode.h,a=this._source.h-s;this._y=a*this._resizeMode.clipY,this._h=this._source.h-a}}}_applyResizeContain(){var e=this._resizeMode.w/this._source.w,t=this._resizeMode.h/this._source.h,i=e;(!i||t<i)&&(i=t),i&&(this._precision=1/i)}enableClipping(e,t,i,r){this._clearResizeMode(),e*=this._precision,t*=this._precision,i*=this._precision,r*=this._precision,this._x===e&&this._y===t&&this._w===i&&this._h===r||(this._x=e,this._y=t,this._w=i,this._h=r,this._updateClipping(!0))}disableClipping(){this._clearResizeMode(),(this._x||this._y||this._w||this._h)&&(this._x=0,this._y=0,this._w=0,this._h=0,this._updateClipping())}_updateClipping(){this.clipping=!!(this._x||this._y||this._w||this._h);var e=this;this.elements.forEach((function(t){t.displayedTexture===e&&t.onDisplayedTextureClippingChanged()}))}_updatePrecision(){var e=this;this.elements.forEach((function(t){t.displayedTexture===e&&t.onPrecisionChanged()}))}getNonDefaults(){var e={};return e.type=this.constructor.name,0!==this.x&&(e.x=this.x),0!==this.y&&(e.y=this.y),0!==this.w&&(e.w=this.w),0!==this.h&&(e.h=this.h),1!==this.precision&&(e.precision=this.precision),e}get px(){return this._x}get py(){return this._y}get pw(){return this._w}get ph(){return this._h}get x(){return this._x/this._precision}set x(e){this._clearResizeMode(),e*=this._precision,this._x!==e&&(this._x=e,this._updateClipping())}get y(){return this._y/this._precision}set y(e){this._clearResizeMode(),e*=this._precision,this._y!==e&&(this._y=e,this._updateClipping())}get w(){return this._w/this._precision}set w(e){this._clearResizeMode(),e*=this._precision,this._w!==e&&(this._w=e,this._updateClipping())}get h(){return this._h/this._precision}set h(e){this._clearResizeMode(),e*=this._precision,this._h!==e&&(this._h=e,this._updateClipping())}get precision(){return this._precision}set precision(e){this._clearResizeMode(),this._precision!==e&&(this._precision=e,this._updatePrecision())}isAutosizeTexture(){return!0}getRenderWidth(){return this.isAutosizeTexture()?(this._w||(this._source?this._source.getRenderWidth()-this._x:0))/this._precision:0}getRenderHeight(){return this.isAutosizeTexture()?(this._h||(this._source?this._source.getRenderHeight()-this._y:0))/this._precision:0}patch(e){d.patchObject(this,e)}}P.prototype.isTexture=!0,P.id=0;class O extends P{constructor(e){super(e),this._src=void 0,this._hasAlpha=!1}get src(){return this._src}set src(e){this._src!==e&&(this._src=e,this._changed())}get hasAlpha(){return this._hasAlpha}set hasAlpha(e){this._hasAlpha!==e&&(this._hasAlpha=e,this._changed())}_getIsValid(){return!!this._src}_getLookupId(){return this._src}_getSourceLoader(){var e=this._src,t=this._hasAlpha;if(this.stage.getOption("srcBasePath")){var i=e.charCodeAt(0);-1===e.indexOf("//")&&(i>=65&&i<=90||i>=97&&i<=122||46==i)&&(e=this.stage.getOption("srcBasePath")+e)}return i=>this.stage.platform.loadSrcTexture({src:e,hasAlpha:t},i)}getNonDefaults(){var e=super.getNonDefaults();return this._src&&(e.src=this._src),e}}function D(e,t,i,r,n){var s=e;Array.isArray(s)||(s=[s]);for(var a=[],o=0,h=s.length;o<h;o++){var u=s[o];null===u&&(u=n),"serif"===u||"sans-serif"===u?a.push(u):a.push(`"${u}"`)}return`${t} ${i*r}px ${a.join(",")}`}class N{constructor(e,t,i){this._stage=e,this._canvas=t,this._context=this._canvas.getContext("2d"),this._settings=i}getPrecision(){return this._settings.precision}setFontProperties(){this._context.font=D(this._settings.fontFace,this._settings.fontStyle,this._settings.fontSize,this.getPrecision(),this._stage.getOption("defaultFontFace")),this._context.textBaseline=this._settings.textBaseline}_load(){if(c.isWeb&&document.fonts){var e=D(this._settings.fontFace,this._settings.fontStyle,this._settings.fontSize,this.getPrecision(),this._stage.getOption("defaultFontFace"));try{if(!document.fonts.check(e,this._settings.text))return document.fonts.load(e,this._settings.text).catch((t=>{console.warn("[Lightning] Font load error",t,e)})).then((()=>{document.fonts.check(e,this._settings.text)||console.warn("[Lightning] Font not found",e)}))}catch(t){console.warn("[Lightning] Can't check font loading for "+e)}}}draw(){var e=this._load();return e?e.then((()=>c.isSpark?this._stage.platform.drawText(this):this._draw())):c.isSpark?this._stage.platform.drawText(this):this._draw()}_calculateRenderInfo(){var e={},t=this.getPrecision(),i=this._settings.paddingLeft*t,r=this._settings.paddingRight*t,n=this._settings.fontSize*t,s=null===this._settings.offsetY?null:this._settings.offsetY*t,a=this._settings.lineHeight*t,o=this._settings.w*t,h=this._settings.h*t,u=this._settings.wordWrapWidth*t,l=this._settings.cutSx*t,c=this._settings.cutEx*t,d=this._settings.cutSy*t,p=this._settings.cutEy*t,g=(this._settings.letterSpacing||0)*t,f=this._settings.textIndent*t;this.setFontProperties();var m,_=o||2048/this.getPrecision(),v=_-i;if(v<10&&(_+=10-v,v=10),u||(u=v),this._settings.textOverflow&&!this._settings.wordWrap){var y;switch(this._settings.textOverflow){case"clip":y="";break;case"ellipsis":y=this._settings.maxLinesSuffix;break;default:y=this._settings.textOverflow}this._settings.text=this.wrapWord(this._settings.text,u-f,y)}if(this._settings.wordWrap)m=this.wrapText(this._settings.text,u,g,f);else for(var x=(m={l:this._settings.text.split(/(?:\r\n|\r|\n)/),n:[]}).l.length,b=0;b<x-1;b++)m.n.push(b);var w=m.l;if(this._settings.maxLines&&w.length>this._settings.maxLines){var T=w.slice(0,this._settings.maxLines),S=null;if(this._settings.maxLinesSuffix){var A=this._settings.maxLinesSuffix?this.measureText(this._settings.maxLinesSuffix):0,C=this.wrapText(T[T.length-1],u-A,g,f);T[T.length-1]=C.l[0]+this._settings.maxLinesSuffix,S=[C.l.length>1?C.l[1]:""]}else S=[""];var E,I=w.length,R=0,L=m.n.length;for(E=this._settings.maxLines;E<I;E++)S[R]+=(S[R]?" ":"")+w[E],E+1<L&&m.n[E+1]&&R++;e.remainingText=S.join("\n"),e.moreTextLines=!0,w=T}else e.moreTextLines=!1,e.remainingText="";for(var k,M=0,P=[],O=0;O<w.length;O++){var D=this.measureText(w[O],g)+(0===O?f:0);P.push(D),M=Math.max(M,D)}if(e.lineWidths=P,o||(_=M+i+r,v=M),a=a||n,h)k=h;else{var N="bottom"!=this._settings.textBaseline?.5*n:0;k=a*(w.length-1)+N+Math.max(a,n)+s}return null===s&&(s=n),e.w=_,e.h=k,e.lines=w,e.precision=t,_||(_=1),k||(k=1),(l||c)&&(_=Math.min(_,c-l)),(d||p)&&(k=Math.min(k,p-d)),e.width=_,e.innerWidth=v,e.height=k,e.fontSize=n,e.cutSx=l,e.cutSy=d,e.cutEx=c,e.cutEy=p,e.lineHeight=a,e.lineWidths=P,e.offsetY=s,e.paddingLeft=i,e.paddingRight=r,e.letterSpacing=g,e.textIndent=f,e}_draw(){var e,t,i=this._calculateRenderInfo(),r=this.getPrecision();this._canvas.width=Math.ceil(i.width+this._stage.getOption("textRenderIssueMargin")),this._canvas.height=Math.ceil(i.height),this.setFontProperties(),i.fontSize>=128&&(this._context.globalAlpha=.01,this._context.fillRect(0,0,.01,.01),this._context.globalAlpha=1),(i.cutSx||i.cutSy)&&this._context.translate(-i.cutSx,-i.cutSy);for(var n=[],s=0,a=i.lines.length;s<a;s++)e=0===s?i.textIndent:0,t=s*i.lineHeight+i.offsetY,"middle"==this._settings.verticalAlign?t+=(i.lineHeight-i.fontSize)/2:"bottom"==this._settings.verticalAlign&&(t+=i.lineHeight-i.fontSize),"right"===this._settings.textAlign?e+=i.innerWidth-i.lineWidths[s]:"center"===this._settings.textAlign&&(e+=(i.innerWidth-i.lineWidths[s])/2),e+=i.paddingLeft,n.push({text:i.lines[s],x:e,y:t,w:i.lineWidths[s]});if(this._settings.highlight){var o=this._settings.highlightColor||0,h=this._settings.highlightHeight*r||1.5*i.fontSize,u=this._settings.highlightOffset*r,c=null!==this._settings.highlightPaddingLeft?this._settings.highlightPaddingLeft*r:i.paddingLeft,d=null!==this._settings.highlightPaddingRight?this._settings.highlightPaddingRight*r:i.paddingRight;this._context.fillStyle=l.getRgbaString(o);for(var p=0;p<n.length;p++){var g=n[p];this._context.fillRect(g.x-c,g.y-i.offsetY+u,g.w+d+c,h)}}var f=null;this._settings.shadow&&(f=[this._context.shadowColor,this._context.shadowOffsetX,this._context.shadowOffsetY,this._context.shadowBlur],this._context.shadowColor=l.getRgbaString(this._settings.shadowColor),this._context.shadowOffsetX=this._settings.shadowOffsetX*r,this._context.shadowOffsetY=this._settings.shadowOffsetY*r,this._context.shadowBlur=this._settings.shadowBlur*r),this._context.fillStyle=l.getRgbaString(this._settings.textColor);for(var m=0,_=n.length;m<_;m++){var v=n[m];if(0===i.letterSpacing)this._context.fillText(v.text,v.x,v.y);else for(var y=v.text.split(""),x=v.x,b=0,w=y.length;b<w;b++)this._context.fillText(y[b],x,v.y),x+=this.measureText(y[b],i.letterSpacing)}f&&(this._context.shadowColor=f[0],this._context.shadowOffsetX=f[1],this._context.shadowOffsetY=f[2],this._context.shadowBlur=f[3]),(i.cutSx||i.cutSy)&&this._context.translate(i.cutSx,i.cutSy),this.renderInfo=i}wrapWord(e,t,i){var r=this._context.measureText(i).width,n=e.length,s=this._context.measureText(e).width;if(s<=t)return e;var a=Math.floor(t*n/s),o=this._context.measureText(e.substring(0,a)).width+r;if(o>t)for(;a>0&&(o=this._context.measureText(e.substring(0,a)).width+r)>t;)a-=1;else for(;a<n;){if(!((o=this._context.measureText(e.substring(0,a)).width+r)<t)){a-=1;break}a+=1}return e.substring(0,a)+(t>=r?i:"")}wrapText(e,t,i){for(var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=e.split(/\r?\n/g),s=[],a=[],o=0;o<n.length;o++){for(var h=[],u="",l=t-r,c=n[o].split(" "),d=0;d<c.length;d++){var p=this.measureText(c[d],i),g=p+this.measureText(" ",i);0===d||g>l?(d>0&&(h.push(u),u=""),u+=c[d],l=t-p-(0===d?r:0)):(l-=g,u+=" "+c[d])}h.push(u),u="",s=s.concat(h),o<n.length-1&&a.push(s.length)}return{l:s,n:a}}measureText(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t?e.split("").reduce(((e,i)=>e+this._context.measureText(i).width+t),0):this._context.measureText(e).width}}class F{constructor(e,t,i){this._stage=e,this._canvas=t,this._context=this._canvas.getContext("2d"),this._settings=i}getPrecision(){return this._settings.precision}setFontProperties(){var e=D(this._settings.fontFace,this._settings.fontStyle,this._settings.fontSize,this.getPrecision(),this._stage.getOption("defaultFontFace"));return this._context.font=e,this._context.textBaseline=this._settings.textBaseline,e}_load(){if(c.isWeb&&document.fonts){var e=D(this._settings.fontFace,this._settings.fontStyle,this._settings.fontSize,this.getPrecision(),this._stage.getOption("defaultFontFace"));try{if(!document.fonts.check(e,this._settings.text))return document.fonts.load(e,this._settings.text).catch((t=>{console.warn("Font load error",t,e)})).then((()=>{document.fonts.check(e,this._settings.text)||console.warn("Font not found",e)}))}catch(t){console.warn("Can't check font loading for "+e)}}}draw(){var e=this._load();return e?e.then((()=>c.isSpark?this._stage.platform.drawText(this):this._draw())):c.isSpark?this._stage.platform.drawText(this):this._draw()}_calculateRenderInfo(){var e={},t=this.getPrecision(),i=this._settings.paddingLeft*t,r=this._settings.paddingRight*t,n=this._settings.fontSize*t,s=this._settings.lineHeight*t||n,a=0!=this._settings.w?this._settings.w*t:2048/t,h=this._settings.wordWrapWidth*t,u=this._settings.cutSx*t,l=this._settings.cutEx*t,c=this._settings.cutSy*t,d=this._settings.cutEy*t,p=this._settings.letterSpacing||0;e.baseFont=this.setFontProperties(),e.w=a,e.width=a,e.text=this._settings.text,e.precision=t,e.fontSize=n,e.fontBaselineRatio=this._settings.fontBaselineRatio,e.lineHeight=s,e.letterSpacing=p,e.textAlign=this._settings.textAlign,e.textColor=this._settings.textColor,e.verticalAlign=this._settings.verticalAlign,e.highlight=this._settings.highlight,e.highlightColor=this._settings.highlightColor,e.highlightHeight=this._settings.highlightHeight,e.highlightPaddingLeft=this._settings.highlightPaddingLeft,e.highlightPaddingRight=this._settings.highlightPaddingRight,e.highlightOffset=this._settings.highlightOffset,e.paddingLeft=this._settings.paddingLeft,e.paddingRight=this._settings.paddingRight,e.maxLines=this._settings.maxLines,e.maxLinesSuffix=this._settings.maxLinesSuffix,e.textOverflow=this._settings.textOverflow,e.wordWrap=this._settings.wordWrap,e.wordWrapWidth=h,e.shadow=this._settings.shadow,e.shadowColor=this._settings.shadowColor,e.shadowOffsetX=this._settings.shadowOffsetX,e.shadowOffsetY=this._settings.shadowOffsetY,e.shadowBlur=this._settings.shadowBlur,e.cutSx=u,e.cutEx=l,e.cutSy=c,e.cutEy=d,e.textIndent=this._settings.textIndent*t,e.wordBreak=this._settings.wordBreak;var g=e.text,f=e.wordWrap&&e.wordWrapWidth||e.width;if(e.textOverflow&&!e.wordWrap){var m;switch(this._settings.textOverflow){case"clip":m="";break;case"ellipsis":m=this._settings.maxLinesSuffix;break;default:m=this._settings.textOverflow}g=this.wrapWord(g,h||e.w,m)}g=this.tokenize(g),g=this.parse(g),g=this.measure(g,p,e.baseFont),e.textIndent&&(g=this.indent(g,e.textIndent)),e.wordBreak&&(g=g.reduce(((t,i)=>t.concat(this.wordBreak(i,f,e.baseFont))),[]),this.resetFontStyle());var _,v=i,y=0,x=o(g);try{for(x.s();!(_=x.n()).done;){var b=_.value;(e.wordWrap&&v+b.width>f||"\n"==b.text)&&(v=i,y+=1),b.lineNo=y,"\n"!=b.text&&(b.x=v,v+=b.width)}}catch(K){x.e(K)}finally{x.f()}e.lineNum=y+1,this._settings.h?e.h=this._settings.h:e.maxLines&&e.maxLines<e.lineNum?e.h=e.maxLines*e.lineHeight+n/2:e.h=e.lineNum*e.lineHeight+n/2;var w=e.fontBaselineRatio*e.fontSize,T=0;"top"==e.verticalAlign&&"alphabetic"==this._context.textBaseline?T=-w:"middle"==e.verticalAlign?T=(e.lineHeight-e.fontSize-w)/2:"bottom"==this._settings.verticalAlign&&(T=e.lineHeight-e.fontSize),e.lines=[];for(var S=0;S<e.lineNum;S++)e.lines[S]={width:0,x:0,y:e.lineHeight*S+T,text:[]};var A,C=o(g);try{for(C.s();!(A=C.n()).done;){var E=A.value;e.lines[E.lineNo].text.push(E)}}catch(K){C.e(K)}finally{C.f()}var I,R=o(e.lines);try{for(R.s();!(I=R.n()).done;){var L=I.value;if(0!=L.text.length){var k=L.text[0].text,M=L.text[L.text.length-1].text;"\n"==k&&L.text.shift()," "!=M&&"\n"!=M||L.text.pop()}}}catch(K){R.e(K)}finally{R.f()}var P,O=o(e.lines);try{for(O.s();!(P=O.n()).done;){var D=P.value;D.width=D.text.reduce(((e,t)=>e+t.width),0)}}catch(K){O.e(K)}finally{O.f()}if(e.width=0!=this._settings.w?this._settings.w*t:Math.max(...e.lines.map((e=>e.width)))+r,e.w=e.width,e.maxLines&&e.lineNum>e.maxLines&&e.maxLinesSuffix){var N=e.maxLines-1,F=g.filter((e=>e.lineNo==N)),U=e.maxLinesSuffix;U=this.tokenize(U),U=this.parse(U);var z,B=o(U=this.measure(U,e.letterSpacing,e.baseFont));try{for(B.s();!(z=B.n()).done;){var j=z.value;j.lineNo=N,j.x=0,F.push(j)}}catch(K){B.e(K)}finally{B.f()}for(var H=U.length+1,V=F.reduce(((e,t)=>e+t.width),0);(V>e.width||" "==F[F.length-H].text)&&(F.splice(F.length-H,1),V=F.reduce(((e,t)=>e+t.width),0),!(F.length<H)););this.alignLine(F,F[0].x),e.lines[N].text=F,e.lines[N].width=V}if("center"==e.textAlign){var W,G=o(e.lines);try{for(G.s();!(W=G.n()).done;){var X=W.value;X.x=(e.width-X.width-i)/2}}catch(K){G.e(K)}finally{G.f()}}else if("right"==e.textAlign){var q,Y=o(e.lines);try{for(Y.s();!(q=Y.n()).done;){var $=q.value;$.x=e.width-$.width-i}}catch(K){Y.e(K)}finally{Y.f()}}return e}_draw(){var e=this._calculateRenderInfo(),t=this.getPrecision(),i=e.paddingLeft*t,r=e.w||e.width;(e.cutSx||e.cutEx)&&(r=Math.min(e.w,e.cutEx-e.cutSx));var n=e.h;if((e.cutSy||e.cutEy)&&(n=Math.min(e.h,e.cutEy-e.cutSy)),this._canvas.width=Math.ceil(r+this._stage.getOption("textRenderIssueMargin")),this._canvas.height=Math.ceil(n),this.setFontProperties(),e.fontSize>=128&&(this._context.globalAlpha=.01,this._context.fillRect(0,0,.01,.01),this._context.globalAlpha=1),(e.cutSx||e.cutSy)&&this._context.translate(-e.cutSx,-e.cutSy),e.highlight){var s=e.highlightColor||0,a=e.highlightHeight?e.highlightHeight*t:1.5*e.fontSize,h=e.highlightOffset?e.highlightOffset*t:0,u=null!==e.highlightPaddingLeft?e.highlightPaddingLeft*t:e.paddingLeft,c=null!==e.highlightPaddingRight?e.highlightPaddingRight*t:e.paddingRight;this._context.fillStyle=l.getRgbaString(s);for(var d=e.maxLines?Math.min(e.maxLines,e.lineNum):e.lineNum,p=0;p<d;p++){var g=e.lines[p];this._context.fillRect(g.x-u+i,g.y+h,g.width+u+c,a)}}var f=null;this._settings.shadow&&(f=[this._context.shadowColor,this._context.shadowOffsetX,this._context.shadowOffsetY,this._context.shadowBlur],this._context.shadowColor=l.getRgbaString(this._settings.shadowColor),this._context.shadowOffsetX=this._settings.shadowOffsetX*t,this._context.shadowOffsetY=this._settings.shadowOffsetY*t,this._context.shadowBlur=this._settings.shadowBlur*t);var m=l.getRgbaString(this._settings.textColor),_=m;this._context.fillStyle=m;var v,y=o(e.lines);try{for(y.s();!(v=y.n()).done;){var x,b=o(v.value.text);try{for(b.s();!(x=b.n()).done;){var w=x.value,T=0;if("\n"!=w.text&&!(e.maxLines&&w.lineNo>=e.maxLines))if(w.color!=_&&(_=w.color,this._context.fillStyle=_),this._context.font=w.fontStyle,w.letters){var S,A=o(w.letters);try{for(A.s();!(S=A.n()).done;){var C=S.value,E=e.lines[w.lineNo].x+w.x+T;this._context.fillText(C.text,E,e.lines[w.lineNo].y+e.fontSize),T+=C.width}}catch(R){A.e(R)}finally{A.f()}}else{var I=e.lines[w.lineNo].x+w.x;this._context.fillText(w.text,I,e.lines[w.lineNo].y+e.fontSize)}}}catch(R){b.e(R)}finally{b.f()}}}catch(R){y.e(R)}finally{y.f()}f&&(this._context.shadowColor=f[0],this._context.shadowOffsetX=f[1],this._context.shadowOffsetY=f[2],this._context.shadowBlur=f[3]),(e.cutSx||e.cutSy)&&this._context.translate(e.cutSx,e.cutSy),e.lines=e.lines.map((e=>e.text.reduce(((e,t)=>e+t.text),""))),e.maxLines&&(e.lines=e.lines.slice(0,e.maxLines)),this.renderInfo=e}measureText(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t?e.split("").reduce(((e,i)=>e+this._context.measureText(i).width+t),0):this._context.measureText(e).width}tokenize(e){for(var t=/ |\n|<i>|<\/i>|<b>|<\/b>|<color=0[xX][0-9a-fA-F]{8}>|<\/color>/g,i=e.match(t)||[],r=e.split(t)||[],n=[],s=0;s<r.length;s++)n.push(r[s],i[s]);return n.pop(),n.filter((e=>""!=e))}parse(e){var t=0,i=0,r=[l.getRgbaString(this._settings.textColor)],n=0,s=/<color=(0[xX][0-9a-fA-F]{8})>/;return e.map((e=>{if("<i>"==e)t+=1,e="";else if("</i>"==e&&t>0)t-=1,e="";else if("<b>"==e)i+=1,e="";else if("</b>"==e&&i>0)i-=1,e="";else if("</color>"==e)r.length>1&&(n-=1,r.pop()),e="";else if(s.test(e)){var a=s.exec(e);r.push(l.getRgbaString(parseInt(a[1]))),n+=1,e=""}return{text:e,italic:t,bold:i,color:r[n]}})).filter((e=>""!=e.text))}applyFontStyle(e,t){var i=t;e.bold&&(i="bold "+i),e.italic&&(i="italic "+i),this._context.font=i,e.fontStyle=i}resetFontStyle(e){this._context.font=e}measure(e){var t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0,n=o(e);try{for(n.s();!(t=n.n()).done;){var s=t.value;if(this.applyFontStyle(s,r),s.width=this.measureText(s.text,i),i>0){s.letters=s.text.split("").map((e=>({text:e})));var a,h=o(s.letters);try{for(h.s();!(a=h.n()).done;){var u=a.value;u.width=this.measureText(u.text,i)}}catch(l){h.e(l)}finally{h.f()}}}}catch(l){n.e(l)}finally{n.f()}return this.resetFontStyle(r),e}indent(e,t){return e.splice(0,0,{text:"",width:t}),e}wrapWord(e,t,i){var r=this._context.measureText(i).width,n=e.length,s=this._context.measureText(e).width;if(s<=t)return e;var a=Math.floor(t*n/s),o=this._context.measureText(e.substring(0,a)).width+r;if(o>t)for(;a>0&&(o=this._context.measureText(e.substring(0,a)).width+r)>t;)a-=1;else for(;a<n;){if(!((o=this._context.measureText(e.substring(0,a)).width+r)<t)){a-=1;break}a+=1}return e.substring(0,a)+(t>=r?i:"")}_getBreakIndex(e,t){var i=e.length,r=this.measureText(e);if(r<=t)return{breakIndex:e.length,truncWordWidth:r};var n=Math.floor(t*i/r),s=this.measureText(e.substring(0,n));if(s>t)for(;n>0&&(s=this.measureText(e.substring(0,n)))>t;)n-=1;else for(;n<i;){if(!((s=this.measureText(e.substring(0,n)))<t)){n-=1,s=this.measureText(e.substring(0,n));break}n+=1}return{breakIndex:n,truncWordWidth:s}}wordBreak(e,t,i){if(!e.text)return e;this.applyFontStyle(e,i);var r=[],n=e.text;if(e.letters){var a,h=0,u=[],l=0,c=o(e.letters);try{for(c.s();!(a=c.n()).done;){var d=a.value;h+d.width>=t?(r.push(s({},e)),r[r.length-1].text=n.slice(0,l),r[r.length-1].width=h,r[r.length-1].letters=u,n=n.slice(l),h=0,u=[],l=0):(l+=1,u.push(d),h+=d.width)}}catch(m){c.e(m)}finally{c.f()}h>0&&(r.push(s({},e)),r[r.length-1].text=n.slice(0,l),r[r.length-1].width=h,r[r.length-1].letters=u)}else for(;;){var p=this._getBreakIndex(n,t),g=p.breakIndex,f=p.truncWordWidth;if(r.push(s({},e)),r[r.length-1].text=n.slice(0,g),r[r.length-1].width=f,g===n.length)break;n=n.slice(g)}return r}alignLine(e){var t,i=0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=o(e);try{for(n.s();!(t=n.n()).done;){var s=t.value;"\n"!=s.text&&(s.x=r+i,r=s.x,i=s.width)}}catch(a){n.e(a)}finally{n.f()}}}class U extends P{constructor(e){super(e),this._precision=this.stage.getOption("precision")}static renderer(e,t,i){return this.advancedRenderer?new F(e,t,i):new N(e,t,i)}get text(){return this._text}set text(e){this._text!==e&&(this._text=""+e,this._changed())}get w(){return this._w}set w(e){this._w!==e&&(this._w=e,this._changed())}get h(){return this._h}set h(e){this._h!==e&&(this._h=e,this._changed())}get fontStyle(){return this._fontStyle}set fontStyle(e){this._fontStyle!==e&&(this._fontStyle=e,this._changed())}get fontBaselineRatio(){return this._fontBaselineRatio}set fontBaselineRatio(e){this._fontBaselineRatio!==e&&(this._fontBaselineRatio=e,this._changed())}get fontSize(){return this._fontSize}set fontSize(e){this._fontSize!==e&&(this._fontSize=e,this._changed())}get fontFace(){return this._fontFace}set fontFace(e){this._fontFace!==e&&(this._fontFace=e,this._changed())}get wordWrap(){return this._wordWrap}set wordWrap(e){this._wordWrap!==e&&(this._wordWrap=e,this._changed())}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(e){this._wordWrapWidth!==e&&(this._wordWrapWidth=e,this._changed())}get wordBreak(){return this._wordBreak}set wordBreak(e){this._wordBreak!==e&&(this._wordBreak=e,this._changed())}get textOverflow(){return this._textOverflow}set textOverflow(e){e!=this._textOverflow&&(this._textOverflow=e,this._changed())}get lineHeight(){return this._lineHeight}set lineHeight(e){this._lineHeight!==e&&(this._lineHeight=e,this._changed())}get textBaseline(){return this._textBaseline}set textBaseline(e){this._textBaseline!==e&&(this._textBaseline=e,this._changed())}get textAlign(){return this._textAlign}set textAlign(e){this._textAlign!==e&&(this._textAlign=e,this._changed())}get verticalAlign(){return this._verticalAlign}set verticalAlign(e){this._verticalAlign!==e&&(this._verticalAlign=e,this._changed())}get offsetY(){return this._offsetY}set offsetY(e){this._offsetY!==e&&(this._offsetY=e,this._changed())}get maxLines(){return this._maxLines}set maxLines(e){this._maxLines!==e&&(this._maxLines=e,this._changed())}get maxLinesSuffix(){return this._maxLinesSuffix}set maxLinesSuffix(e){this._maxLinesSuffix!==e&&(this._maxLinesSuffix=e,this._changed())}get textColor(){return this._textColor}set textColor(e){this._textColor!==e&&(this._textColor=e,this._changed())}get paddingLeft(){return this._paddingLeft}set paddingLeft(e){this._paddingLeft!==e&&(this._paddingLeft=e,this._changed())}get paddingRight(){return this._paddingRight}set paddingRight(e){this._paddingRight!==e&&(this._paddingRight=e,this._changed())}get shadow(){return this._shadow}set shadow(e){this._shadow!==e&&(this._shadow=e,this._changed())}get shadowColor(){return this._shadowColor}set shadowColor(e){this._shadowColor!==e&&(this._shadowColor=e,this._changed())}get shadowOffsetX(){return this._shadowOffsetX}set shadowOffsetX(e){this._shadowOffsetX!==e&&(this._shadowOffsetX=e,this._changed())}get shadowOffsetY(){return this._shadowOffsetY}set shadowOffsetY(e){this._shadowOffsetY!==e&&(this._shadowOffsetY=e,this._changed())}get shadowBlur(){return this._shadowBlur}set shadowBlur(e){this._shadowBlur!==e&&(this._shadowBlur=e,this._changed())}get highlight(){return this._highlight}set highlight(e){this._highlight!==e&&(this._highlight=e,this._changed())}get highlightHeight(){return this._highlightHeight}set highlightHeight(e){this._highlightHeight!==e&&(this._highlightHeight=e,this._changed())}get highlightColor(){return this._highlightColor}set highlightColor(e){this._highlightColor!==e&&(this._highlightColor=e,this._changed())}get highlightOffset(){return this._highlightOffset}set highlightOffset(e){this._highlightOffset!==e&&(this._highlightOffset=e,this._changed())}get highlightPaddingLeft(){return this._highlightPaddingLeft}set highlightPaddingLeft(e){this._highlightPaddingLeft!==e&&(this._highlightPaddingLeft=e,this._changed())}get highlightPaddingRight(){return this._highlightPaddingRight}set highlightPaddingRight(e){this._highlightPaddingRight!==e&&(this._highlightPaddingRight=e,this._changed())}get cutSx(){return this._cutSx}set cutSx(e){this._cutSx!==e&&(this._cutSx=e,this._changed())}get cutEx(){return this._cutEx}set cutEx(e){this._cutEx!==e&&(this._cutEx=e,this._changed())}get cutSy(){return this._cutSy}set cutSy(e){this._cutSy!==e&&(this._cutSy=e,this._changed())}get cutEy(){return this._cutEy}set cutEy(e){this._cutEy!==e&&(this._cutEy=e,this._changed())}get advancedRenderer(){return this._advancedRenderer}set advancedRenderer(e){this._advancedRenderer!==e&&(this._advancedRenderer=e,this._changed())}set letterSpacing(e){this._letterSpacing!==e&&(this._letterSpacing=e,this._changed())}get letterSpacing(){return this._letterSpacing}set textIndent(e){this._textIndent!==e&&(this._textIndent=e,this._changed())}get textIndent(){return this._textIndent}get precision(){return super.precision}set precision(e){this.precision!==e&&(super.precision=e,this._changed())}_getIsValid(){return!!this.text}_getLookupId(){var e=[];return 0!==this.w&&e.push("w "+this.w),0!==this.h&&e.push("h "+this.h),"normal"!==this.fontStyle&&e.push("fS"+this.fontStyle),40!==this.fontSize&&e.push("fs"+this.fontSize),0!==this.fontBaselineRatio&&e.push("fb"+this.fontBaselineRatio),null!==this.fontFace&&e.push("ff"+(Array.isArray(this.fontFace)?this.fontFace.join(","):this.fontFace)),!0!==this.wordWrap&&e.push("wr"+(this.wordWrap?1:0)),0!==this.wordWrapWidth&&e.push("ww"+this.wordWrapWidth),!1!==this.wordBreak&&e.push((this.wordBreak,1)),""!=this.textOverflow&&e.push("to"+this.textOverflow),null!==this.lineHeight&&e.push("lh"+this.lineHeight),"alphabetic"!==this.textBaseline&&e.push("tb"+this.textBaseline),"left"!==this.textAlign&&e.push("ta"+this.textAlign),"top"!==this.verticalAlign&&e.push("va"+this.verticalAlign),null!==this.offsetY&&e.push("oy"+this.offsetY),0!==this.maxLines&&e.push("ml"+this.maxLines),".."!==this.maxLinesSuffix&&e.push("ms"+this.maxLinesSuffix),e.push("pc"+this.precision),4294967295!==this.textColor&&e.push("co"+this.textColor.toString(16)),0!==this.paddingLeft&&e.push("pl"+this.paddingLeft),0!==this.paddingRight&&e.push("pr"+this.paddingRight),!1!==this.shadow&&e.push("sh"+(this.shadow?1:0)),4278190080!==this.shadowColor&&e.push("sc"+this.shadowColor.toString(16)),0!==this.shadowOffsetX&&e.push("sx"+this.shadowOffsetX),0!==this.shadowOffsetY&&e.push("sy"+this.shadowOffsetY),5!==this.shadowBlur&&e.push("sb"+this.shadowBlur),!1!==this.highlight&&e.push("hL"+(this.highlight?1:0)),0!==this.highlightHeight&&e.push("hh"+this.highlightHeight),4278190080!==this.highlightColor&&e.push("hc"+this.highlightColor.toString(16)),null!==this.highlightOffset&&e.push("ho"+this.highlightOffset),null!==this.highlightPaddingLeft&&e.push("hl"+this.highlightPaddingLeft),null!==this.highlightPaddingRight&&e.push("hr"+this.highlightPaddingRight),null!==this.letterSpacing&&e.push("ls"+this.letterSpacing),null!==this.textIndent&&e.push("ti"+this.textIndent),this.cutSx&&e.push("csx"+this.cutSx),this.cutEx&&e.push("cex"+this.cutEx),this.cutSy&&e.push("csy"+this.cutSy),this.cutEy&&e.push("cey"+this.cutEy),this.advancedRenderer&&e.push((this.advancedRenderer,1)),"TX$"+e.join("|")+":"+this.text}_getSourceLoader(){var e=this.cloneArgs(),t=this.stage.gl;return function(i){var r=this.stage.platform.getDrawingCanvas(),n=e.advancedRenderer?new F(this.stage,r,e):new N(this.stage,r,e),s=n.draw(),a={},o=this.stage.getOption("fontSharp"),h=!1;if(c.isBoolean(o))h=o;else if(c.isObject(o)){h=this.stage.getRenderPrecision()<=o.precision&&e.fontSize<=o.fontSize}t&&h&&(a[t.TEXTURE_MAG_FILTER]=t.NEAREST),s?s.then((()=>{i(null,Object.assign({renderInfo:n.renderInfo,throttle:!1,texParams:a},this.stage.platform.getTextureOptionsForDrawingCanvas(r)))})).catch((e=>{i(e)})):i(null,Object.assign({renderInfo:n.renderInfo,throttle:!1,texParams:a},this.stage.platform.getTextureOptionsForDrawingCanvas(r)))}}getNonDefaults(){var e=super.getNonDefaults();return""!==this.text&&(e.text=this.text),0!==this.w&&(e.w=this.w),0!==this.h&&(e.h=this.h),"normal"!==this.fontStyle&&(e.fontStyle=this.fontStyle),40!==this.fontSize&&(e.fontSize=this.fontSize),0!==this.fontBaselineRatio&&(e.fontBaselineRatio=this.fontBaselineRatio),null!==this.fontFace&&(e.fontFace=this.fontFace),!0!==this.wordWrap&&(e.wordWrap=this.wordWrap),0!==this.wordWrapWidth&&(e.wordWrapWidth=this.wordWrapWidth),!1!==this.wordBreak&&(e.wordBreak=this.wordBreak),""!=this.textOverflow&&(e.textOverflow=this.textOverflow),null!==this.lineHeight&&(e.lineHeight=this.lineHeight),"alphabetic"!==this.textBaseline&&(e.textBaseline=this.textBaseline),"left"!==this.textAlign&&(e.textAlign=this.textAlign),"top"!==this.verticalAlign&&(e.verticalAlign=this.verticalAlign),null!==this.offsetY&&(e.offsetY=this.offsetY),0!==this.maxLines&&(e.maxLines=this.maxLines),".."!==this.maxLinesSuffix&&(e.maxLinesSuffix=this.maxLinesSuffix),this.precision!==this.stage.getOption("precision")&&(e.precision=this.precision),4294967295!==this.textColor&&(e.textColor=this.textColor),0!==this.paddingLeft&&(e.paddingLeft=this.paddingLeft),0!==this.paddingRight&&(e.paddingRight=this.paddingRight),!1!==this.shadow&&(e.shadow=this.shadow),4278190080!==this.shadowColor&&(e.shadowColor=this.shadowColor),0!==this.shadowOffsetX&&(e.shadowOffsetX=this.shadowOffsetX),0!==this.shadowOffsetY&&(e.shadowOffsetY=this.shadowOffsetY),5!==this.shadowBlur&&(e.shadowBlur=this.shadowBlur),!1!==this.highlight&&(e.highlight=this.highlight),0!==this.highlightHeight&&(e.highlightHeight=this.highlightHeight),4278190080!==this.highlightColor&&(e.highlightColor=this.highlightColor),0!==this.highlightOffset&&(e.highlightOffset=this.highlightOffset),0!==this.highlightPaddingLeft&&(e.highlightPaddingLeft=this.highlightPaddingLeft),0!==this.highlightPaddingRight&&(e.highlightPaddingRight=this.highlightPaddingRight),0!==this.letterSpacing&&(e.letterSpacing=this.letterSpacing),0!==this.textIndent&&(e.textIndent=this.textIndent),this.cutSx&&(e.cutSx=this.cutSx),this.cutEx&&(e.cutEx=this.cutEx),this.cutSy&&(e.cutSy=this.cutSy),this.cutEy&&(e.cutEy=this.cutEy),this.advancedRenderer&&(e.renderer=this.advancedRenderer),e}cloneArgs(){var e={};return e.text=this._text,e.w=this._w,e.h=this._h,e.fontStyle=this._fontStyle,e.fontSize=this._fontSize,e.fontBaselineRatio=this._fontBaselineRatio,e.fontFace=this._fontFace,e.wordWrap=this._wordWrap,e.wordWrapWidth=this._wordWrapWidth,e.wordBreak=this._wordBreak,e.textOverflow=this._textOverflow,e.lineHeight=this._lineHeight,e.textBaseline=this._textBaseline,e.textAlign=this._textAlign,e.verticalAlign=this._verticalAlign,e.offsetY=this._offsetY,e.maxLines=this._maxLines,e.maxLinesSuffix=this._maxLinesSuffix,e.precision=this._precision,e.textColor=this._textColor,e.paddingLeft=this._paddingLeft,e.paddingRight=this._paddingRight,e.shadow=this._shadow,e.shadowColor=this._shadowColor,e.shadowOffsetX=this._shadowOffsetX,e.shadowOffsetY=this._shadowOffsetY,e.shadowBlur=this._shadowBlur,e.highlight=this._highlight,e.highlightHeight=this._highlightHeight,e.highlightColor=this._highlightColor,e.highlightOffset=this._highlightOffset,e.highlightPaddingLeft=this._highlightPaddingLeft,e.highlightPaddingRight=this._highlightPaddingRight,e.letterSpacing=this._letterSpacing,e.textIndent=this._textIndent,e.cutSx=this._cutSx,e.cutEx=this._cutEx,e.cutSy=this._cutSy,e.cutEy=this._cutEy,e.advancedRenderer=this._advancedRenderer,e}}var z=U.prototype;z._text="",z._w=0,z._h=0,z._fontStyle="normal",z._fontSize=40,z._fontFace=null,z._wordWrap=!0,z._wordWrapWidth=0,z._wordBreak=!1,z._textOverflow="",z._lineHeight=null,z._textBaseline="alphabetic",z._textAlign="left",z._verticalAlign="top",z._offsetY=null,z._maxLines=0,z._maxLinesSuffix="..",z._textColor=4294967295,z._paddingLeft=0,z._paddingRight=0,z._shadow=!1,z._shadowColor=4278190080,z._shadowOffsetX=0,z._shadowOffsetY=0,z._shadowBlur=5,z._highlight=!1,z._highlightHeight=0,z._highlightColor=4278190080,z._highlightOffset=0,z._highlightPaddingLeft=0,z._highlightPaddingRight=0,z._letterSpacing=0,z._textIndent=0,z._cutSx=0,z._cutEx=0,z._cutSy=0,z._cutEy=0,z._advancedRenderer=!1,z._fontBaselineRatio=0;class B extends P{constructor(e){super(e),this._textureSource=void 0}get textureSource(){return this._textureSource}set textureSource(e){e!==this._textureSource&&(e.isResultTexture&&(this._precision=this.stage.getRenderPrecision()),this._textureSource=e,this._changed())}_getTextureSource(){return this._textureSource}}class j extends k{constructor(e,t,i,r){super(),this.manager=e,this._settings=t,this._element=i,this._getter=i.constructor.getGetter(r),this._setter=i.constructor.getSetter(r),this._merger=t.merger,this._merger||(this._merger=i.constructor.getMerger(r)),this._startValue=this._getter(this._element),this._targetValue=this._startValue,this._p=1,this._delayLeft=0}start(e){this._startValue=this._getter(this._element),this.isAttached()?e===this._startValue?this.reset(e,1):(this._targetValue=e,this._p=0,this._delayLeft=this._settings.delay,this.emit("start"),this.add()):(this._targetValue=e,this._p=1,this._updateDrawValue())}finish(){this._p<1&&(this._p=1)}stop(){this.emit("stop"),this.manager.removeActive(this)}pause(){this.stop()}play(){this.manager.addActive(this)}reset(e,t){this.isAttached()?(this._startValue=this._getter(this._element),this._targetValue=e,this._p=t,this.add()):(this._startValue=this._getter(this._element),this._targetValue=e,this._p=1,this._updateDrawValue())}_updateDrawValue(){this._setter(this._element,this.getDrawValue())}add(){this.manager.addActive(this)}isAttached(){return this._element.attached}isRunning(){return this._p<1}progress(e){if(this.isAttached()||(this._p=1),this.p<1){if(this.delayLeft>0){if(this._delayLeft-=e,!(this.delayLeft<0))return;e=-this.delayLeft,this._delayLeft=0,this.emit("delayEnd")}0==this._settings.duration?this._p=1:this._p+=e/this._settings.duration,this._p>=1&&(this._p=1)}this._updateDrawValue(),this.invokeListeners()}invokeListeners(){this.emit("progress",this.p),1===this.p&&this.emit("finish")}updateTargetValue(e){var t=this._settings.timingFunctionImpl(this.p);1===t?this._targetValue=e:0===t?(this._startValue=this._targetValue,this._targetValue=e):(this._startValue=e-(e-this._targetValue)/(1-t),this._targetValue=e)}getDrawValue(){if(this.p>=1)return this.targetValue;var e=this._settings._timingFunctionImpl(this.p);return this._merger(this.targetValue,this.startValue,e)}skipDelay(){this._delayLeft=0}get startValue(){return this._startValue}get targetValue(){return this._targetValue}get p(){return this._p}get delayLeft(){return this._delayLeft}get element(){return this._element}get settings(){return this._settings}set settings(e){this._settings=e}}j.prototype.isTransition=!0;class H{constructor(){this._items=[],this._refs={}}get(){return this._items}get first(){return this._items[0]}get last(){return this._items.length?this._items[this._items.length-1]:void 0}add(e){this.addAt(e,this._items.length)}addAt(e,t){if(!(t>=0&&t<=this._items.length))throw new Error("addAt: The index "+t+" is out of bounds "+this._items.length);var i=this._items.indexOf(e);if(i===t)return e;if(c.isObjectLiteral(e)){var r=e;(e=this.createItem(r)).patch(r)}-1!=i?this.setAt(e,t):(e.ref&&(this._refs[e.ref]=e),this._items.splice(t,0,e),this.onAdd(e,t))}replaceByRef(e){if(!e.ref)throw new Error("replaceByRef: no ref specified in item");var t=this.getByRef(e.ref);if(!t)throw new Error("replaceByRef: no item found with reference: "+e.ref);this.replace(e,t),this.addAt(e,this._items.length)}replace(e,t){var i=this.getIndex(t);if(-1===i)throw new Error("replace: The previous item does not exist");this.setAt(e,i)}setAt(e,t){if(!(t>=0&&t<this._items.length))throw new Error("setAt: The index "+t+" is out of bounds "+this._items.length);if(c.isObjectLiteral(e)){var i=e;(e=this.createItem(i)).patch(i)}var r=this._items.indexOf(e);if(-1!=r){if(r!==t){var n=r;n!==t&&(this._items.splice(n,1),this._items.splice(t,0,e),this.onMove(e,n,t))}}else{t<this._items.length&&this._items[t].ref&&(this._refs[this._items[t].ref]=void 0);var s=this._items[t];this._items[t]=e,e.ref&&(this._refs[e.ref]=e),this.onSet(e,t,s)}}getAt(e){return this._items[e]}getIndex(e){return this._items.indexOf(e)}remove(e){var t=this._items.indexOf(e);-1!==t&&this.removeAt(t)}removeAt(e){if(e>=0&&e<this._items.length){var t=this._items[e];return t.ref&&(this._refs[t.ref]=void 0),this._items.splice(e,1),this.onRemove(t,e),t}throw new Error(`removeAt: The index ${e} is out of bounds ${this._items.length-1}`)}clear(){if(this._items.length){var e=this._items;this._items=[],this._refs={},this.onSync(e,[],[])}}a(e){if(c.isObjectLiteral(e)){var t=this.createItem(e);return t.patch(e),this.add(t),t}if(Array.isArray(e)){for(var i=0,r=e.length;i<r;i++)this.a(e[i]);return null}if(this.isItem(e))return this.add(e),e}get length(){return this._items.length}_getRefs(){return this._refs}getByRef(e){return this._refs[e]}clearRef(e){delete this._refs[e]}setRef(e,t){this._refs[e]=t}patch(e){c.isObjectLiteral(e)?this._setByObject(e):Array.isArray(e)&&this._setByArray(e)}_setByObject(e){for(var t=this._getRefs(),i=Object.keys(e),r=0,n=i.length;r<n;r++){var s=i[r],a=e[s],o=t[s];if(o)if(this.isItem(a)){if(o!==a){var h=this.getIndex(o);a.ref=s,this.setAt(a,h)}}else o.patch(a);else this.isItem(a)?(a.ref=s,this.add(a)):((o=this.createItem(a)).ref=s,o.patch(a),this.add(o))}}_equalsArray(e){var t=!0;if(e.length===this._items.length)for(var i=0,r=this._items.length;i<r&&t;i++)t=t&&this._items[i]===e[i];else t=!1;return t}_setByArray(e){if(!this._equalsArray(e)){for(var t=0,i=this._items.length;t<i;t++)this._items[t].marker=!0;for(var r,n=[],s=0,a=e.length;s<a;s++){var o=e[s];if(this.isItem(o))o.marker=!1,n.push(o);else{var h=o.ref,u=void 0;h&&(r||(r=this._getRefs()),u=r[h]),u?u.marker=!1:u=this.createItem(o),c.isObjectLiteral(o)&&u.patch(o),n.push(u)}}this._setItems(n)}}_setItems(e){var t=this._items;this._items=e;var i=t.filter((e=>{var t=e.marker;return delete e.marker,t})),r=e.filter((e=>-1===t.indexOf(e)));if(i.length||r.length){this._refs={};for(var n=0,s=this._items.length;n<s;n++){var a=this._items[n].ref;a&&(this._refs[a]=this._items[n])}}this.onSync(i,r,e)}sort(e){var t=this._items.slice();t.sort(e),this._setByArray(t)}onAdd(e,t){}onRemove(e,t){}onSync(e,t,i){}onSet(e,t,i){}onMove(e,t,i){}createItem(e){throw new Error("ObjectList.createItem must create and return a new object")}isItem(e){return!1}forEach(e){this.get().forEach(e)}}class V extends H{constructor(e){super(),this._element=e}_connectParent(e){var t=e.parent;if(t&&t!==this._element){var i=e.parent.childList,r=i.getIndex(e);e.ref&&(i._refs[e.ref]=void 0),i._items.splice(r,1),t.core.removeChildAt(r)}e._setParent(this._element)}onAdd(e,t){this._connectParent(e),this._element.core.addChildAt(t,e.core)}onRemove(e,t){e._setParent(null),this._element.core.removeChildAt(t)}onSync(e,t,i){for(var r=0,n=e.length;r<n;r++)e[r]._setParent(null);for(var s=0,a=t.length;s<a;s++)this._connectParent(t[s]);var o=e=>e.core;this._element.core.syncChildren(e.map(o),t.map(o),i.map(o))}onSet(e,t,i){i._setParent(null),this._connectParent(e),this._element.core.setChildAt(t,e.core)}onMove(e,t,i){this._element.core.moveChild(t,i)}createItem(e){return e.type?new e.type(this._element.stage):this._element.stage.createElement()}isItem(e){return e.isElement}}var W=class e{constructor(t){this.stage=t,this.__id=e.id++,this.__start(),this._hasEventListeners=!1,this.__core=new R(this),this.__ref=null,this.__attached=!1,this.__enabled=!1,this.__active=!1,this.__parent=null,this.__texture=null,this.__displayedTexture=null,this.__tags=null,this.__treeTags=null,this.__tagRoot=!1,this.__childList=null,this._w=0,this._h=0}__start(){}get id(){return this.__id}set ref(e){if(this.__ref!==e){var t=e.charCodeAt(0);c.isUcChar(t)||this._throwError("Ref must start with an upper case character: "+e),null!==this.__ref&&(this.removeTag(this.__ref),this.__parent&&this.__parent.__childList.clearRef(this.__ref)),this.__ref=e,this.__ref&&(this._addTag(this.__ref),this.__parent&&this.__parent.__childList.setRef(this.__ref,this))}}get ref(){return this.__ref}get core(){return this.__core}setAsRoot(){this.__core.setAsRoot(),this._updateAttachedFlag(),this._updateEnabledFlag()}get isRoot(){return this.__core.isRoot}_setParent(e){this.__parent!==e&&(this.__parent&&this._unsetTagsParent(),this.__parent=e,e&&this._setTagsParent(),this._updateAttachedFlag(),this._updateEnabledFlag(),this._updateCollision(),this.isRoot&&e&&this._throwError("Root should not be added as a child! Results are unspecified!"))}getDepth(){for(var e=0,t=this.__parent;t;)e++,t=t.__parent;return e}getAncestor(e){for(var t=this;e>0&&t.__parent;)t=t.__parent,e--;return t}getAncestors(){for(var e=[],t=this;t;)e.push(t),t=t.__parent;return e}getAncestorAtDepth(e){var t=this.getDepth()-e;return t<0?null:this.getAncestor(t)}isAncestorOf(e){for(var t=e;t=t.parent;)if(this===t)return!0;return!1}getSharedAncestor(e){var t=this,i=e,r=t.getDepth(),n=i.getDepth();r>n?t=t.getAncestor(r-n):n>r&&(i=i.getAncestor(n-r));do{if(t===i)return t;t=t.__parent,i=i.__parent}while(t&&i);return null}get attached(){return this.__attached}get enabled(){return this.__enabled}get active(){return this.__active}_isAttached(){return this.__parent?this.__parent.__attached:this.stage.root===this}_isEnabled(){return this.__core.visible&&this.__core.alpha>0&&(this.__parent?this.__parent.__enabled:this.stage.root===this)}_isActive(){return this._isEnabled()&&this.withinBoundsMargin}_updateAttachedFlag(){var e=this._isAttached();if(this.__attached!==e){this.__attached=e,e&&this._onSetup();var t=this._children.get();if(t){var i=t.length;if(i>0)for(var r=0;r<i;r++)t[r]._updateAttachedFlag()}e?this._onAttach():this._onDetach()}}_updateEnabledFlag(){var e=this._isEnabled();if(this.__enabled!==e){e?(this._onEnabled(),this._setEnabledFlag()):(this._onDisabled(),this._unsetEnabledFlag());var t=this._children.get();if(t){var i=t.length;if(i>0)for(var r=0;r<i;r++)t[r]._updateEnabledFlag()}}}_setEnabledFlag(){this.__enabled=!0,this._updateDimensions(),this._updateTextureCoords(),this.__texture&&this.__texture.addElement(this),this.withinBoundsMargin&&this._setActiveFlag(),this.__core.shader&&this.__core.shader.addElement(this.__core)}_unsetEnabledFlag(){this.__active&&this._unsetActiveFlag(),this.__texture&&this.__texture.removeElement(this),this.__core.shader&&this.__core.shader.removeElement(this.__core),this._texturizer&&this.texturizer.filters.forEach((e=>e.removeElement(this.__core))),this.__enabled=!1}_setActiveFlag(){this.__active=!0,this.__texture&&this.__texture.incActiveCount(),this.__texture&&this._enableTexture(),this._onActive()}_unsetActiveFlag(){this.__texture&&this.__texture.decActiveCount(),this.__active=!1,this.__texture&&this._disableTexture(),this._hasTexturizer()&&this.texturizer.deactivate(),this._onInactive()}_onSetup(){}_onAttach(){}_onDetach(){}_onEnabled(){}_onDisabled(){}_onActive(){}_onInactive(){}_onResize(){}_getRenderWidth(){return this._w?this._w:this.__displayedTexture?this.__displayedTexture.getRenderWidth():this.__texture?this.__texture.getRenderWidth():0}_getRenderHeight(){return this._h?this._h:this.__displayedTexture?this.__displayedTexture.getRenderHeight():this.__texture?this.__texture.getRenderHeight():0}get renderWidth(){return this.__enabled?this.__core.getRenderWidth():this._getRenderWidth()}get renderHeight(){return this.__enabled?this.__core.getRenderHeight():this._getRenderHeight()}get finalX(){return this.__core.x}get finalY(){return this.__core.y}get finalW(){return this.__core.w}get finalH(){return this.__core.h}textureIsLoaded(){return this.__texture&&this.__texture.isLoaded()}loadTexture(){this.__texture&&(this.__texture.load(),this.__texture.isUsed()&&this._isEnabled()||this._updateDimensions())}_enableTextureError(){var e=this.__texture.loadError;e&&this.emit("txError",e,this.__texture._source)}_enableTexture(){this.__texture.isLoaded()?this._setDisplayedTexture(this.__texture):(this._setDisplayedTexture(null),this._enableTextureError())}_disableTexture(){this._setDisplayedTexture(null)}get texture(){return this.__texture}set texture(e){var t;if(c.isObjectLiteral(e))(t=e.type?new e.type(this.stage):this.texture)&&d.patchObject(t,e);else if(e)if(e.isTexture)t=e;else{if(!e.isTextureSource)return void console.error("[Lightning] Please specify a texture type.");(t=new B(this.stage)).textureSource=e}else t=null;var i=this.__texture;t!==i&&(this.__texture=t,this.__texture?this.__enabled&&(this.__texture.addElement(this),this.withinBoundsMargin&&(this.__texture.isLoaded()?this._setDisplayedTexture(this.__texture):this._enableTextureError())):this._setDisplayedTexture(null),i&&i!==this.__displayedTexture&&i.removeElement(this),this._updateDimensions())}get displayedTexture(){return this.__displayedTexture}_setDisplayedTexture(e){var t=this.__displayedTexture;t&&e!==t&&this.__texture!==t&&t.removeElement(this);var i=this.__core.displayedTextureSource?this.__core.displayedTextureSource._source:null,r=(e?e._source:null)!==i;this.__displayedTexture=e,this._updateDimensions(),this.__displayedTexture?r&&(this._updateTextureCoords(),this.__core.setDisplayedTextureSource(this.__displayedTexture._source)):this.__core.setDisplayedTextureSource(null),r&&(this.__displayedTexture?this.emit("txLoaded",this.__displayedTexture):this.emit("txUnloaded",this.__displayedTexture))}onTextureSourceLoaded(){this.active&&this._setDisplayedTexture(this.__texture)}onTextureSourceLoadError(e){this.emit("txError",e,this.__texture._source)}forceRenderUpdate(){this.__core.setHasRenderUpdates(3)}onDisplayedTextureClippingChanged(){this._updateDimensions(),this._updateTextureCoords()}onPrecisionChanged(){this._updateDimensions()}onDimensionsChanged(e,t){this.texture instanceof U&&(this.texture.w=e,this.texture.h=t,this.w=e,this.h=t)}_updateDimensions(){var e=this._getRenderWidth(),t=this._getRenderHeight(),i=!1;e&&t||!this.__displayedTexture&&this.__texture&&(e=e||this.__texture.mw,t=t||this.__texture.mh,e&&t||!this.__texture.isAutosizeTexture()||(i=!0)),this.__core.setDimensions(e,t,i)&&this._onResize()}_updateTextureCoords(){if(this.displayedTexture&&this.displayedTexture._source){var e=this.displayedTexture,t=this.displayedTexture._source,i=0,r=0,n=1,s=1;if(e.clipping){var a,o,h,u,l=t.getRenderWidth(),c=t.getRenderHeight();a=1/l,o=1/c,h=e.pw?e.pw*a:(l-e.px)*a,u=e.ph?e.ph*o:(c-e.py)*o,i=a*=e.px,r=o*=e.py,n=n*h+a,s=s*u+o,i=Math.max(0,i),r=Math.max(0,r),n=Math.min(1,n),s=Math.min(1,s)}if(t._flipTextureY){var d=s;s=r,r=d}this.__core.setTextureCoords(i,r,n,s)}}getCornerPoints(){return this.__core.getCornerPoints()}_unsetTagsParent(){this.__tags&&this.__tags.forEach((e=>{for(var t=this;t=t.__parent;){if(t.__treeTags.get(e).delete(this),t.__tagRoot)break}}));var e=null,t=0;if(this.__treeTags&&!this.__tagRoot&&(t=(e=c.iteratorToArray(this.__treeTags.keys())).length)>0)for(var i=0;i<t;i++)for(var r=this.__treeTags.get(e[i]),n=this,s=function(){var t=n.__treeTags.get(e[i]);if(r.forEach((function(e){t.delete(e)})),n.__tagRoot)return"break"};n=n.__parent;){if("break"===s())break}}_setTagsParent(){this.__tags&&this.__tags.forEach((e=>{for(var t=this;t=t.__parent;){t.__treeTags||(t.__treeTags=new Map);var i=t.__treeTags.get(e);if(i||(i=new Set,t.__treeTags.set(e,i)),i.add(this),t.__tagRoot)break}})),this.__treeTags&&this.__treeTags.size&&(this.__tagRoot||this.__treeTags.forEach(((e,t)=>{for(var i=this,r=function(){i.__tagRoot,i.__treeTags||(i.__treeTags=new Map);var r=i.__treeTags.get(t);r||(r=new Set,i.__treeTags.set(t,r)),e.forEach((function(e){r.add(e)}))};!i.__tagRoot&&(i=i.__parent);)r()})))}_getByTag(e){if(!this.__treeTags)return[];var t=this.__treeTags.get(e);return t?c.setToArray(t):[]}getTags(){return this.__tags?this.__tags:[]}setTags(e){e=e.reduce(((e,t)=>e.concat(t.split(" "))),[]),this.__ref&&e.push(this.__ref);var t,i=e.length,r=[],n=[];for(t=0;t<i;t++)this.hasTag(e[t])||n.push(e[t]);var s=this.tags||[];for(i=s.length,t=0;t<i;t++)-1==e.indexOf(s[t])&&r.push(s[t]);for(t=0;t<r.length;t++)this.removeTag(r[t]);for(t=0;t<n.length;t++)this.addTag(n[t])}addTag(e){if(-1===e.indexOf(" "))c.isUcChar(e.charCodeAt(0))&&this._throwError("Tag may not start with an upper case character."),this._addTag(e);else for(var t=e.split(" "),i=0,r=t.length;i<r;i++){var n=t[i];c.isUcChar(n.charCodeAt(0))&&this._throwError("Tag may not start with an upper case character."),this._addTag(n)}}_addTag(e){if(this.__tags||(this.__tags=[]),-1===this.__tags.indexOf(e)){this.__tags.push(e);var t=this.__parent;if(t)do{t.__treeTags||(t.__treeTags=new Map);var i=t.__treeTags.get(e);i||(i=new Set,t.__treeTags.set(e,i)),i.add(this)}while(!t.__tagRoot&&(t=t.__parent))}}removeTag(e){var t=this.__tags.indexOf(e);if(-1!==t){this.__tags.splice(t,1);var i=this.__parent;if(i)do{var r=i.__treeTags.get(e);r&&r.delete(this)}while(!i.__tagRoot&&(i=i.__parent))}}hasTag(e){return this.__tags&&-1!==this.__tags.indexOf(e)}_tag(e){if(-1!==e.indexOf("."))return this.mtag(e)[0];if(this.__treeTags){var t=this.__treeTags.get(e);if(t){var i=t.values().next();return i?i.value:void 0}}}get tag(){return this._tag}set tag(e){this.tags=e}mtag(e){if(e.indexOf(".")>=0){for(var t=e.split("."),i=this._getByTag(t[0]),r=1,n=t.length;i.length&&r<n;){for(var s=[],a=0,o=i.length;a<o;a++)s=s.concat(i[a]._getByTag(t[r]));i=s,r++}return i}return this._getByTag(e)}stag(e,t){for(var i=this.mtag(e),r=i.length,n=0;n<r;n++)d.patchObject(i[n],t)}get tagRoot(){return this.__tagRoot}set tagRoot(e){this.__tagRoot!==e&&(e?this._unsetTagsParent():this._setTagsParent(),this.__tagRoot=e)}sel(e){var t=this.select(e);return t.length?t[0]:void 0}select(e){if(-1!==e.indexOf(",")){for(var t=e.split(","),i=[],r=0;r<t.length;r++)i=i.concat(this._select(t[r]));return i}return this._select(e)}_select(e){if(""===e)return[this];var t,i=e.indexOf("."),r=e.indexOf(">");return-1===i&&-1===r?this.mtag(e):(0===r?(t=!0,e=e.substr(1)):0===i?(t=!1,e=e.substr(1)):t=!1,this._selectChilds(e,t))}_selectChilds(e,t){var i=e.indexOf("."),r=e.indexOf(">");if(-1===i&&-1===r){if(t){var n=this.getByRef(e);return n?[n]:[]}return this.mtag(e)}if(-1===r||-1!==i&&i<r){var s,a=e.substr(0,i);if(t){var o=this.getByRef(a);s=o?[o]:[]}else s=this.mtag(a);for(var h=[],u=e.substr(i+1),l=0,c=s.length;l<c;l++)h=h.concat(s[l]._selectChilds(u,!1));return h}var d,p=e.substr(0,r);if(t){var g=this.getByRef(p);d=g?[g]:[]}else d=this.mtag(p);for(var f=[],m=e.substr(r+1),_=0,v=d.length;_<v;_++)f=f.concat(d[_]._selectChilds(m,!0));return f}getByRef(e){return this.childList.getByRef(e)}getLocationString(){var e;e=this.__parent?this.__parent._children.getIndex(this):"R";var t=this.getTags(),i=this.__parent?this.__parent.getLocationString():"";return this.ref?i+=":["+e+"]"+this.ref:t.length?i+=":["+e+"]"+t.join(","):i+=":["+e+"]#"+this.id,i}toString(){var t=this.getSettings();return e.getPrettyString(t,"")}static getPrettyString(t,i){var r=t.children;delete t.children;var n=["color","colorUl","colorUr","colorBl","colorBr"],s=JSON.stringify(t,(function(e,t){return-1!==n.indexOf(e)?"COLOR["+t.toString(16)+"]":t}));if(s=s.replace(/"COLOR\[([a-f0-9]{1,8})\]"/g,"0x$1"),r){var a="";if(c.isObjectLiteral(r)){var o=Object.keys(r);a="";for(var h=0,u=o.length;h<u;h++)a+=`\n${i}  "${o[h]}":`,delete r[o[h]].ref,a+=e.getPrettyString(r[o[h]],i+"  ")+(h<u-1?",":"");var l="{}"===s;s=s.substr(0,s.length-1)+(l?"":",")+a+"\n"+i+"}"}else{var d=r.length;a="[";for(var p=0;p<d;p++)a+=e.getPrettyString(r[p],i+"  ")+(p<d-1?",":"")+"\n";a+=i+"]}";var g="{}"===s;s=s.substr(0,s.length-1)+(g?"":",")+'"children":\n'+i+a+"}"}}return s}getSettings(){var e=this.getNonDefaults(),t=this._children.get();if(t){var i=t.length;if(i){for(var r=[],n=!1,s=0;s<i;s++)r.push(t[s].getSettings()),n=n||!t[s].ref;n?e.children=r:(e.children={},r.forEach((t=>{e.children[t.ref]=t})))}}return e.id=this.id,e}getNonDefaults(){var t={};if(this.constructor!==e&&(t.type=this.constructor.name),this.__ref&&(t.ref=this.__ref),this.__tags&&this.__tags.length&&(t.tags=this.__tags),0!==this.x&&(t.x=this.x),0!==this.y&&(t.y=this.y),0!==this.w&&(t.w=this.w),0!==this.h&&(t.h=this.h),this.scaleX===this.scaleY?1!==this.scaleX&&(t.scale=this.scaleX):(1!==this.scaleX&&(t.scaleX=this.scaleX),1!==this.scaleY&&(t.scaleY=this.scaleY)),this.pivotX===this.pivotY?.5!==this.pivotX&&(t.pivot=this.pivotX):(.5!==this.pivotX&&(t.pivotX=this.pivotX),.5!==this.pivotY&&(t.pivotY=this.pivotY)),this.mountX===this.mountY?0!==this.mountX&&(t.mount=this.mountX):(0!==this.mountX&&(t.mountX=this.mountX),0!==this.mountY&&(t.mountY=this.mountY)),1!==this.alpha&&(t.alpha=this.alpha),this.visible||(t.visible=!1),0!==this.rotation&&(t.rotation=this.rotation),this.colorUl===this.colorUr&&this.colorBl===this.colorBr&&this.colorUl===this.colorBl?4294967295!==this.colorUl&&(t.color=this.colorUl.toString(16)):(4294967295!==this.colorUl&&(t.colorUl=this.colorUl.toString(16)),4294967295!==this.colorUr&&(t.colorUr=this.colorUr.toString(16)),4294967295!==this.colorBl&&(t.colorBl=this.colorBl.toString(16)),4294967295!==this.colorBr&&(t.colorBr=this.colorBr.toString(16))),this.zIndex&&(t.zIndex=this.zIndex),this.forceZIndexContext&&(t.forceZIndexContext=!0),this.clipping&&(t.clipping=this.clipping),this.clipbox||(t.clipbox=this.clipbox),this.__texture){var i=this.__texture.getNonDefaults();Object.keys(i).length&&(t.texture=i)}if(this.shader&&c.isFunction(this.shader.getNonDefaults)){var r=this.shader.getNonDefaults();Object.keys(r).length&&(t.shader=r)}return this._hasTexturizer()&&(this.texturizer.enabled&&(t.renderToTexture=this.texturizer.enabled),this.texturizer.lazy&&(t.renderToTextureLazy=this.texturizer.lazy),this.texturizer.colorize&&(t.colorizeResultTexture=this.texturizer.colorize),this.texturizer.renderOffscreen&&(t.renderOffscreen=this.texturizer.renderOffscreen)),t}static getGetter(t){var i=e.PROP_GETTERS.get(t);return i||(i=new Function("obj","return obj."+t),e.PROP_GETTERS.set(t,i)),i}static getSetter(t){var i=e.PROP_SETTERS.get(t);return i||(i=new Function("obj","v","obj."+t+" = v"),e.PROP_SETTERS.set(t,i)),i}get withinBoundsMargin(){return this.__core._withinBoundsMargin}_enableWithinBoundsMargin(){this.__enabled&&this._setActiveFlag()}_disableWithinBoundsMargin(){this.__active&&this._unsetActiveFlag()}set boundsMargin(e){if(!Array.isArray(e)&&null!==e)throw new Error("boundsMargin should be an array of left-top-right-bottom values or null (inherit margin)");this.__core.boundsMargin=e}get boundsMargin(){return this.__core.boundsMargin}get x(){return this.__core.offsetX}set x(e){this.__core.offsetX=e}get y(){return this.__core.offsetY}set y(e){this.__core.offsetY=e}get w(){return this._w}set w(e){c.isFunction(e)?(this._w=0,this.__core.funcW=e):(e=Math.max(e,0),this._w!==e&&(this.__core.disableFuncW(),this._w=e,this._updateDimensions()))}get h(){return this._h}set h(e){c.isFunction(e)?(this._h=0,this.__core.funcH=e):(e=Math.max(e,0),this._h!==e&&(this.__core.disableFuncH(),this._h=e,this._updateDimensions()))}get collision(){return this._collision}set collision(e){this._collision=e}_updateCollision(){this.collision&&this.__parent&&void 0===this.__parent.collision&&(this.__parent.collision=2)}get scaleX(){return this.__core.scaleX}set scaleX(e){this.__core.scaleX=e}get scaleY(){return this.__core.scaleY}set scaleY(e){this.__core.scaleY=e}get scale(){return this.__core.scale}set scale(e){this.__core.scale=e}get pivotX(){return this.__core.pivotX}set pivotX(e){this.__core.pivotX=e}get pivotY(){return this.__core.pivotY}set pivotY(e){this.__core.pivotY=e}get pivot(){return this.__core.pivot}set pivot(e){this.__core.pivot=e}get mountX(){return this.__core.mountX}set mountX(e){this.__core.mountX=e}get mountY(){return this.__core.mountY}set mountY(e){this.__core.mountY=e}get mount(){return this.__core.mount}set mount(e){this.__core.mount=e}get rotation(){return this.__core.rotation}set rotation(e){this.__core.rotation=e}get alpha(){return this.__core.alpha}set alpha(e){this.__core.alpha=e}get visible(){return this.__core.visible}set visible(e){this.__core.visible=e}get colorUl(){return this.__core.colorUl}set colorUl(e){this.__core.colorUl=e}get colorUr(){return this.__core.colorUr}set colorUr(e){this.__core.colorUr=e}get colorBl(){return this.__core.colorBl}set colorBl(e){this.__core.colorBl=e}get colorBr(){return this.__core.colorBr}set colorBr(e){this.__core.colorBr=e}get color(){return this.__core.colorUl}set color(e){this.colorUl===e&&this.colorUr===e&&this.colorBl===e&&this.colorBr===e||(this.colorUl=e,this.colorUr=e,this.colorBl=e,this.colorBr=e)}get colorTop(){return this.colorUl}set colorTop(e){this.colorUl===e&&this.colorUr===e||(this.colorUl=e,this.colorUr=e)}get colorBottom(){return this.colorBl}set colorBottom(e){this.colorBl===e&&this.colorBr===e||(this.colorBl=e,this.colorBr=e)}get colorLeft(){return this.colorUl}set colorLeft(e){this.colorUl===e&&this.colorBl===e||(this.colorUl=e,this.colorBl=e)}get colorRight(){return this.colorUr}set colorRight(e){this.colorUr===e&&this.colorBr===e||(this.colorUr=e,this.colorBr=e)}get zIndex(){return this.__core.zIndex}set zIndex(e){this.__core.zIndex=e}get forceZIndexContext(){return this.__core.forceZIndexContext}set forceZIndexContext(e){this.__core.forceZIndexContext=e}get clipping(){return this.__core.clipping}set clipping(e){this.__core.clipping=e}get clipbox(){return this.__core.clipbox}set clipbox(e){this.__core.clipbox=e}get tags(){return this.getTags()}set tags(e){Array.isArray(e)||(e=[e]),this.setTags(e)}set t(e){this.tags=e}get _children(){return this.__childList||(this.__childList=new V(this,!1)),this.__childList}get childList(){return this._allowChildrenAccess()||this._throwError("Direct access to children is not allowed in "+this.getLocationString()),this._children}hasChildren(){return this._allowChildrenAccess()&&this.__childList&&this.__childList.length>0}_allowChildrenAccess(){return!0}get children(){return this.childList.get()}set children(e){this.childList.patch(e)}add(e){return this.childList.a(e)}get p(){return this.__parent}get parent(){return this.__parent}get src(){return this.texture&&this.texture instanceof O?this.texture._src:void 0}set src(e){var t=new O(this.stage);t.src=e,this.texture=t}set mw(e){this.texture?(this.texture.mw=e,this._updateDimensions()):this._throwError("Please set mw after setting a texture.")}set mh(e){this.texture?(this.texture.mh=e,this._updateDimensions()):this._throwError("Please set mh after setting a texture.")}get rect(){return this.texture===this.stage.rectangleTexture}set rect(e){this.texture=e?this.stage.rectangleTexture:null}enableTextTexture(){return this.texture&&this.texture instanceof U||(this.texture=new U(this.stage),this.texture.w||this.texture.h||(this.texture.w=this.w,this.texture.h=this.h)),this.texture}get text(){return this.texture&&this.texture instanceof U?this.texture:null}set text(e){this.texture&&this.texture instanceof U||this.enableTextTexture(),c.isString(e)?this.texture.text=e:this.texture.patch(e)}set onUpdate(e){this.__core.onUpdate=e}set onAfterCalcs(e){this.__core.onAfterCalcs=e}set onAfterUpdate(e){this.__core.onAfterUpdate=e}forceUpdate(){this.__core._setHasUpdates()}get shader(){return this.__core.shader}set shader(e){if(c.isObjectLiteral(e)&&!e.type)this.shader&&this.shader.patch(e);else{var t=M.create(this.stage,e);this.__enabled&&this.__core.shader&&this.__core.shader.removeElement(this.__core),this.__core.shader=t,this.__enabled&&this.__core.shader&&this.__core.shader.addElement(this.__core)}}_hasTexturizer(){return!!this.__core._texturizer}get renderToTexture(){return this.rtt}set renderToTexture(e){this.rtt=e}get rtt(){return this._hasTexturizer()&&this.texturizer.enabled}set rtt(e){this.texturizer.enabled=e}get rttLazy(){return this._hasTexturizer()&&this.texturizer.lazy}set rttLazy(e){this.texturizer.lazy=e}get renderOffscreen(){return this._hasTexturizer()&&this.texturizer.renderOffscreen}set renderOffscreen(e){this.texturizer.renderOffscreen=e}get colorizeResultTexture(){return this._hasTexturizer()&&this.texturizer.colorize}set colorizeResultTexture(e){this.texturizer.colorize=e}getTexture(){return this.texturizer._getTextureSource()}get texturizer(){return this.__core.texturizer}patch(e){for(var t=Object.keys(e),i=0,r=t.length;i<r;i++){var n=t[i],s=e[n],a=n.charCodeAt(0);if(c.isUcChar(a)){var o=this.getByRef(n);if(o)void 0===s?o.parent&&o.parent.childList.remove(o):c.isObjectLiteral(s)?o.patch(s):s.isElement?(s.ref=n,this.childList.replace(s,o)):this._throwError("Unexpected value for path: "+n);else if(void 0!==s){var h=void 0;c.isObjectLiteral(s)?(h=this.childList.createItem(s)).patch(s):c.isObject(s)&&(h=s),h.isElement&&(h.ref=n),this.childList.a(h)}}else d.patchObjectProperty(this,n,s)}}_throwError(e){throw new Error(this.constructor.name+" ("+this.getLocationString()+"): "+e)}animation(e){return this.stage.animations.createAnimation(this,e)}transition(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return null===t?this._getTransition(e):(this._setTransition(e,t),null)}set transitions(e){Object.keys(e).forEach((t=>{this.transition(t,e[t])}))}set smooth(e){Object.keys(e).forEach((t=>{var i=e[t];Array.isArray(i)?this.setSmooth(t,i[0],i[1]):this.setSmooth(t,i)}))}fastForward(e){if(this._transitions){var t=this._transitions[e];t&&t.isTransition&&t.finish()}}_getTransition(e){this._transitions||(this._transitions={});var t=this._transitions[e];return t?t.isTransitionSettings&&(t=new j(this.stage.transitions,t,this,e)):t=new j(this.stage.transitions,this.stage.transitions.defaultTransitionSettings,this,e),this._transitions[e]=t,t}_setTransition(e,t){if(t){c.isObjectLiteral(t)&&(t=this.stage.transitions.createSettings(t)),this._transitions||(this._transitions={});var i=this._transitions[e];if(i&&i.isTransition)return i.settings=t,i;this._transitions[e]=t}else this._removeTransition(e)}_removeTransition(e){this._transitions&&delete this._transitions[e]}getSmooth(e,t){var i=this._getTransition(e);return i&&i.isAttached()?i.targetValue:t}setSmooth(e,t,i){i&&this._setTransition(e,i);var r=this._getTransition(e);return r.start(t),r}get flex(){return this.__core.flex}set flex(e){this.__core.flex=e}get flexItem(){return this.__core.flexItem}set flexItem(e){this.__core.flexItem=e}static isColorProperty(e){return e.toLowerCase().indexOf("color")>=0}static getMerger(t){return e.isColorProperty(t)?l.mergeColors:l.mergeNumbers}toJSON(){var t=[`${this.constructor.name}`],i={};return i[t]={},this.hasChildren()?e.collectChildren(i[t],this.__childList):i[t]=s({},e.getProperties(this)),i}static collectChildren(e,t){for(var i=t,r=0,n=i.length;r<n;r++){var a=i.getAt(r),o=`${a.__ref||`Element-${a.id}`}`,h=this.getProperties(a);e[o]=s({},h),a.hasChildren()&&(e[o].children={},this.collectChildren(e[o].children,a.__childList))}}static getProperties(e){for(var t={},i=["alpha","active","attached","boundsMargin","color","clipping","enabled","h","id","isComponent","mount","mountY","mountX","pivot","pivotX","pivotY","ref","renderOfScreen","renderToTexture","scale","scaleX","scaleY","state","tag","visible","w","x","y","zIndex","!!flex","!!flexItem","hasFocus()","hasFinalFocus()"],r=i.length;r--;){var n=i[r];/^!{2}/.test(n)?t[n=n.substring(2,n.length)]=!!e[n]:/\(\)$/.test(n)?"function"==typeof e[n=n.substring(0,n.length-2)]&&(t[n]=e[n]()):t[n]=e[n]}return s(s({},t),e.getNonDefaults())}};k.addAsMixin(W),W.prototype.isElement=1,W.id=1,W.PROP_GETTERS=new Map,W.PROP_SETTERS=new Map;class G{constructor(){G.setupStateMachine(this)}static setupStateMachine(e){var t=e.constructor,i=G.create(t);Object.setPrototypeOf(e,i.prototype),e.constructor=t,e._initStateMachine()}static create(e){if(!e.hasOwnProperty("_sm")){var t=new X(e);e._sm=t}return e._sm.router}fire(e){if(this._hasMethod(e)){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];return this[e](...i)}}_getState(){return this._state.__path}_inState(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._state.__path,i=this._sm.getStateByPath(e),r=this._sm.getStateByPath(t),n=i.__level;return G._getStateAtLevel(r,n)===i}_hasMember(e){return!!this.constructor.prototype[e]}_hasMethod(e){var t=this.constructor.prototype[e];return!!t&&"function"==typeof t}_setState(e,t){var i=++this._setStateCounter;if(this._setStateId=i,this._state.__path!==e){var r=this._sm._stateMap[e];r||(r=this._sm.getStateByPath(e));var n=this._state,s=r.prototype.$enter!==this._state.prototype.$enter,a=r.prototype.$exit!==this._state.prototype.$exit;if(s||a){var o=G._getSharedState(this._state,r),h={newState:r.__path,prevState:n.__path,sharedState:o.__path},u=o.__level;if(a)for(var l=G._getStatesUntilLevel(this._state,u),c=0,d=l.length;c<d;c++){if(this.__setState(l[c]),this._callExit(this._state,t,h),this._setStateId!==i)return}if(s)for(var p=G._getStatesUntilLevel(r,u).reverse(),g=0,f=p.length;g<f;g++){if(this.__setState(p[g]),this._callEnter(this._state,t,h),this._setStateId!==i)return}}if(this.__setState(r),this._changedState){var m={newState:r.__path,prevState:n.__path};t?this._changedState(m,...t):this._changedState(m)}if(this._onStateChange){var _={newState:r.__path,prevState:n.__path};this._onStateChange(_)}}}_callEnter(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2?arguments[2]:void 0,r=!!e.__parent;e.prototype.$enter&&(r&&e.__parent.prototype.$enter===e.prototype.$enter||e.prototype.$enter.apply(this,[i,...t]))}_callExit(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2?arguments[2]:void 0,r=!!e.__parent;e.prototype.$exit&&(r&&e.__parent.prototype.$exit===e.prototype.$exit||e.prototype.$exit.apply(this,[i,...t]))}__setState(e){this._state=e,this._stateIndex=e.__index,this.constructor=e}_initStateMachine(){this._state=null,this._stateIndex=0,this._setStateCounter=0,this._sm=this._routedType._sm,this.__setState(this._sm.getStateByPath(""));var e={newState:"",prevState:void 0,sharedState:void 0};this._callEnter(this._state,[],e),this._onStateChange=void 0}_getMostSpecificHandledMember(e){var t=this._state;do{for(var i=0,r=e.length;i<r;i++){var n=e[i];if(t.__parent){if(this[X.getStateMemberAlias(t.__path,n)])return n}else if(t.prototype[n])return n}t=t.__parent}while(t)}static _getStatesUntilLevel(e,t){for(var i=[];e.__level>t;)i.push(e),e=e.__parent;return i}static _getSharedState(e,t){for(var i=G._getAncestorStates(e),r=G._getAncestorStates(t),n=Math.min(i.length,r.length),s=0;s<n;s++)if(i[s]!==r[s])return i[s-1];return i[n-1]}static _getAncestorStates(e){var t=[];do{t.push(e)}while(e=e.__parent);return t.reverse()}static _getStateAtLevel(e,t){if(!(t>e.__level)){for(;t<e.__level;)e=e.__parent;return e}}}class X{constructor(e){this._type=e,this._router=null,this.init()}get router(){return this._router}init(){this._router=this._createRouter(),this._stateMap=this._getStateMap(),this._addStateMemberDelegatorsToRouter()}_createRouter(){var e=this._type,t=class extends e{constructor(){if(super(...arguments),!this.constructor.hasOwnProperty("_isRouter"))throw new Error(`You need to extend ${e.name}.original instead of ${e.name}.`)}};return t._isRouter=!0,t.prototype._routedType=e,t.original=e,this._mixinStateMachineMethods(t),t}_mixinStateMachineMethods(e){for(var t=Object.getOwnPropertyNames(G.prototype),i=0,r=t.length;i<r;i++){var n=t[i];if("constructor"!==n){var s=Object.getOwnPropertyDescriptor(G.prototype,n);Object.defineProperty(e.prototype,n,s)}}}_addStateMemberDelegatorsToRouter(){this._getAllMemberNames().forEach((e=>{this._addMemberRouter(e)}))}_addMemberRouter(e){var t=Object.keys(this._stateMap),i=[],r=[];t.forEach(((t,n)=>{var s=this._stateMap[t],a=this._getDescriptor(s,e);if(a){i[n]=a;var o=X.getStateMemberAlias(a._source.__path,e);r[n]=o,this._router.prototype.hasOwnProperty(o)||Object.defineProperty(this._router.prototype,o,a)}else i[n]=null,r[n]=null}));var n=void 0;switch(i.forEach((t=>{if(t){var i=this._getDescriptorType(t);if(n&&n!==i)return void console.warn(`[Lightning] Member ${e} in ${this._type.name} has inconsistent types.`);n=i}})),n){case"method":this._addMethodRouter(e,i,r);break;case"getter":this._addGetterSetterRouters(e);break;case"property":console.warn("[Lightning] Fixed properties are not supported; please use a getter instead!")}}_getDescriptor(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>!0,r=e,n=e;do{var s=Object.getOwnPropertyDescriptor(r.prototype,t);if(s&&i(s))return s._source=n,s;(r=Object.getPrototypeOf(r))&&r.hasOwnProperty("__state")&&(n=r)}while(r&&r.prototype)}_getDescriptorType(e){return e.get||e.set?"getter":"function"==typeof e.value?"method":"property"}static _supportsSpread(){if(void 0===this.__supportsSpread){this.__supportsSpread=!1;try{new Function("return [].concat(...arguments);")(),this.__supportsSpread=!0}catch(e){}}return this.__supportsSpread}_addMethodRouter(e,t,i){for(var r=["//@ sourceURL=StateMachineRouter.js","var i = this._stateIndex;"],n=i[0],s=X._supportsSpread(),a=1,o=i.length;a<o;a++){var h=i[a];h!==n&&(n?s?r.push(`if (i < ${a}) return this["${n}"](...arguments); else`):r.push(`if (i < ${a}) return this["${n}"].apply(this, arguments); else`):r.push(`if (i < ${a}) return ; else`)),n=h}n?s?r.push(`return this["${n}"](...arguments);`):r.push(`return this["${n}"].apply(this, arguments);`):r.push(";");var u=r.join("\n"),l={value:new Function([],u)};Object.defineProperty(this._router.prototype,e,l)}_addGetterSetterRouters(e){var t={get:this._getGetterRouter(e),set:this._getSetterRouter(e)};Object.defineProperty(this._router.prototype,e,t)}_getGetterRouter(e){var t=Object.keys(this._stateMap),i=[];t.forEach(((t,r)=>{var n=this._stateMap[t],s=this._getDescriptor(n,e,(e=>e.get));if(s){var a=X.getStateMemberAlias(s._source.__path,e);i[r]=a,this._router.prototype.hasOwnProperty(a)||Object.defineProperty(this._router.prototype,a,s)}else i[r]=null}));for(var r=["//@ sourceURL=StateMachineRouter.js","var i = this._stateIndex;"],n=i[0],s=1,a=i.length;s<a;s++){var o=i[s];o!==n&&(n?r.push(`if (i < ${s}) return this["${n}"]; else`):r.push(`if (i < ${s}) return ; else`)),n=o}n?r.push(`return this["${n}"];`):r.push(";");var h=r.join("\n");return new Function([],h)}_getSetterRouter(e){var t=Object.keys(this._stateMap),i=[];t.forEach(((t,r)=>{var n=this._stateMap[t],s=this._getDescriptor(n,e,(e=>e.set));if(s){var a=X.getStateMemberAlias(s._source.__path,e);i[r]=a,this._router.prototype.hasOwnProperty(a)||Object.defineProperty(this._router.prototype,a,s)}else i[r]=null}));for(var r=["//@ sourceURL=StateMachineRouter.js","var i = this._stateIndex;"],n=i[0],s=1,a=i.length;s<a;s++){var o=i[s];o!==n&&(n?r.push(`if (i < ${s}) this["${n}"] = arg; else`):r.push(`if (i < ${s}) ; else`)),n=o}n?r.push(`this["${n}"] = arg;`):r.push(";");var h=r.join("\n");return new Function(["arg"],h)}static getStateMemberAlias(e,t){return"$"+(e?e+".":"")+t}_getAllMemberNames(){var e=this._stateMap,t=Object.keys(e),i=new Set;return t.forEach((t=>{if(""!==t){var r=e[t];this._getStateMemberNames(r).forEach((e=>{i.add(e)}))}})),[...i]}_getStateMemberNames(e){var t=e,i=new Set,r=this._type===e;do{this._getStateMemberNamesForType(t).forEach((e=>{i.add(e)})),t=Object.getPrototypeOf(t)}while(t&&t.prototype&&(!t.hasOwnProperty("__state")||r));return i}_getStateMemberNamesForType(e){return Object.getOwnPropertyNames(e.prototype).filter((e=>"constructor"!==e&&!X._isStateLocalMember(e)))}static _isStateLocalMember(e){return"$enter"===e||"$exit"===e}getStateByPath(e){if(this._stateMap[e])return this._stateMap[e];for(var t=e.split(".");t.pop();){var i=t.join(".");if(this._stateMap[i])return this._stateMap[i]}}_getStateMap(){return this._stateMap||(this._stateMap=this._createStateMap()),this._stateMap}_createStateMap(){var e={};return this._addState(this._type,null,"",e),e}_addState(e,t,i,r){e.__state=!0,e.__name=i,this._addStaticStateProperty(e,t);var n=t?t.__path:"",s=(n?n+".":"")+i;e.__path=s,e.__level=t?t.__level+1:0,e.__parent=t,e.__index=Object.keys(r).length,r[s]=e;var a=e._states;a&&(t&&t._states===a||e._states().forEach((t=>{var i=X._getStateName(t);this._addState(t,e,i,r)})))}static _getStateName(e){var t=e.name,i=t.indexOf("$");return i>0?t.substr(0,i):t}_addStaticStateProperty(e,t){t&&(t&&!t.__parent?this._router[e.__name]=e:t[e.__name]=e)}}class q extends W{constructor(e,t){super(e),this.tagRoot=!0,c.isObjectLiteral(t)&&Object.assign(this,t),this.__initialized=!1,this.__firstActive=!1,this.__firstEnable=!1,this.__signals=void 0,this.__passSignals=void 0,this.__construct();var i=this.constructor.getTemplateFunc(this);i.f(this,i.a),this._build()}__start(){G.setupStateMachine(this),this._onStateChange=q.prototype.__onStateChange}get state(){return this._getState()}__onStateChange(){this.application&&this.application.updateFocusPath()}_refocus(){this.application&&this.application.updateFocusPath()}static bindProp(e){return{__propertyBinding:!0,__name:e,__func:arguments.length>1&&void 0!==arguments[1]?arguments[1]:null}}__bindProperty(e,t,i){for(var r=this,n=t,s=i,a=Array.isArray(e.__name)?e.__name:[e.__name],h=function(){var t=a[u],i=e.__func?e.__func:e=>e[t];r.hasOwnProperty(t)?r[`__prop_bindings_${t}`].push({__obj:n,__prop:s,__func:i}):(r[`__prop_bindings_${t}`]=[{__obj:n,__prop:s,__func:i}],Object.defineProperty(r,t,{set:e=>{r[`__prop_${t}`]=e;var i,n=o(r[`__prop_bindings_${t}`]);try{for(n.s();!(i=n.n()).done;){var s=i.value,a=s.__obj,h=s.__prop,u=s.__func;a[h]=u(r)}}catch(l){n.e(l)}finally{n.f()}},get:()=>r[`__prop_${t}`]}))},u=0;u<a.length;u++)h()}static getTemplateFunc(e){var t="_templateFunc",i="__has"+t;return this[i]!==this&&(this[i]=this,this[t]=this.parseTemplate(this._template(e))),this[t]}static parseTemplate(e){var t={loc:[],store:[],rid:0};this.parseTemplateRec(e,t,"element");var i=t.loc.join(";\n");return{f:new Function("element","store",i),a:t.store}}static parseTemplateRec(e,t,i){var r=t.store,n=t.loc;Object.keys(e).forEach((s=>{var a=e[s];if(c.isUcChar(s.charCodeAt(0)))if(c.isObjectLiteral(a)){var o=`r${s.replace(/[^a-z0-9]/gi,"")+t.rid}`,h=a.type?a.type:W;h===W?n.push(`var ${o} = element.stage.createElement()`):(r.push(h),n.push(`var ${o} = new store[${r.length-1}](${i}.stage)`)),n.push(`${o}.ref = "${s}"`),t.rid++,this.parseTemplateRec(a,t,o),n.push(`${i}.childList.add(${o})`)}else c.isObject(a)&&(r.push(a),n.push(`${i}.childList.add(store[${r.length-1}])`));else if("text"===s){var u=i+"__text";n.push(`var ${u} = ${i}.enableTextTexture()`),!0===a.__propertyBinding?(r.push(a),n.push(`element.__bindProperty(store[${r.length-1}], ${i}, "${s}")`)):this.parseTemplatePropRec(a,t,u)}else if("shader"===s&&c.isObjectLiteral(a)){var l=`${i}["shader"]`;r.push(a),n.push(`${i}["${s}"] = store[${r.length-1}]`),this.parsePropertyBindings(a,t,l)}else if("texture"===s&&c.isObjectLiteral(a)){var d=i+"__texture",p=a.type;p?(r.push(p),n.push(`var ${d} = new store[${r.length-1}](${i}.stage)`),this.parseTemplatePropRec(a,t,d),n.push(`${i}["${s}"] = ${d}`)):(n.push(`${d} = ${i}.texture`),this.parseTemplatePropRec(a,t,d))}else c.isObjectLiteral(a)&&!0===a.__propertyBinding?(r.push(a),n.push(`element.__bindProperty(store[${r.length-1}], ${i}, "${s}")`)):c.isNumber(a)?n.push(`${i}["${s}"] = ${a}`):c.isBoolean(a)?n.push(`${i}["${s}"] = ${a?"true":"false"}`):c.isObject(a)||Array.isArray(a)?(r.push(a),n.push(`${i}["${s}"] = store[${r.length-1}]`)):n.push(`${i}["${s}"] = ${JSON.stringify(a)}`)}))}static parseTemplatePropRec(e,t,i){var r=t.store,n=t.loc;Object.keys(e).forEach((t=>{if("type"!==t){var s=e[t];c.isNumber(s)?n.push(`${i}["${t}"] = ${s}`):c.isBoolean(s)?n.push(`${i}["${t}"] = ${s?"true":"false"}`):c.isObject(s)&&!0===s.__propertyBinding?(r.push(s),n.push(`element.__bindProperty(store[${r.length-1}], ${i}, "${t}")`)):c.isObject(s)||Array.isArray(s)?(r.push(s),n.push(`${i}["${t}"] = store[${r.length-1}]`)):n.push(`${i}["${t}"] = ${JSON.stringify(s)}`)}}))}static parsePropertyBindings(e,t,i){var r=t.store,n=t.loc;Object.keys(e).forEach((t=>{if("type"!==t){var s=e[t];c.isObjectLiteral(s)&&!0===s.__propertyBinding&&(r.push(s),n.push(`element.__bindProperty(store[${r.length-1}], ${i}, "${t}")`))}}))}_onSetup(){this.__initialized||this._setup()}_setup(){}_onAttach(){this.__initialized||(this.__init(),this.__initialized=!0),this._attach()}_attach(){}_onDetach(){this._detach()}_detach(){}_onEnabled(){this.__firstEnable||(this._firstEnable(),this.__firstEnable=!0),this._enable()}_firstEnable(){}_enable(){}_onDisabled(){this._disable()}_disable(){}_onActive(){this.__firstActive||(this._firstActive(),this.__firstActive=!0),this._active()}_firstActive(){}_active(){}_onInactive(){this._inactive()}_inactive(){}get application(){return this.stage.application}__construct(){this._construct()}_construct(){}_build(){}__init(){this._init()}_init(){}_focus(e,t){}_unfocus(e){}_focusChange(e,t){}_getFocused(){return this}_setFocusSettings(e){}_handleFocusSettings(e){}static _template(){return{}}hasFinalFocus(){var e=this.application._focusPath;return e&&e.length&&e[e.length-1]===this}hasFocus(){var e=this.application._focusPath;return e&&e.indexOf(this)>=0}get cparent(){return q.getParent(this)}seekAncestorByType(e){for(var t=this.cparent;t;){if(t.constructor===e)return t;t=t.cparent}}getSharedAncestorComponent(e){for(var t=this.getSharedAncestor(e);t&&!t.isComponent;)t=t.parent;return t}get signals(){return this.__signals}set signals(e){c.isObjectLiteral(e)||this._throwError("Signals: specify an object with signal-to-fire mappings"),this.__signals=e}set alterSignals(e){for(var t in c.isObjectLiteral(e)||this._throwError("Signals: specify an object with signal-to-fire mappings"),this.__signals||(this.__signals={}),e){void 0===e[t]?delete this.__signals[t]:this.__signals[t]=e}}get passSignals(){return this.__passSignals||{}}set passSignals(e){this.__passSignals=Object.assign(this.__passSignals||{},e)}set alterPassSignals(e){for(var t in c.isObjectLiteral(e)||this._throwError("Signals: specify an object with signal-to-fire mappings"),this.__passSignals||(this.__passSignals={}),e){void 0===e[t]?delete this.__passSignals[t]:this.__passSignals[t]=e}}signal(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];return this._signal(e,i)}_signal(e,t){var i=this._getParentSignalHandler();if(i){if(this.__signals){var r=this.__signals[e];if(!1===r)return;if(r){if(!0===r&&(r=e),c.isFunction(r))return r(...t);if(i._hasMethod(r))return i[r](...t)}}var n=this.__passSignals&&this.__passSignals[e];if(n)return n&&!0!==n&&(e=n),i._signal(e,t)}}_getParentSignalHandler(){return this.cparent?this.cparent._getSignalHandler():null}_getSignalHandler(){return this._signalProxy?this.cparent?this.cparent._getSignalHandler():null:this}get _signalProxy(){return!1}fireAncestors(e){if(!e.startsWith("$"))throw new Error("Ancestor event name must be prefixed by dollar sign.");var t=this._getParentSignalHandler();if(t){for(var i=arguments.length,r=new Array(i>1?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];return t._doFireAncestors(e,r)}}_doFireAncestors(e,t){if(this._hasMethod(e))return this.fire(e,...t);var i=this._getParentSignalHandler();return i?i._doFireAncestors(e,t):void 0}static collectSubComponents(e,t){if(t.hasChildren())for(var i=t.__childList,r=0,n=i.length;r<n;r++){var s=i.getAt(r);s.isComponent?e.push(s):q.collectSubComponents(e,s)}}static getComponent(e){for(var t=e;t&&!t.isComponent;)t=t.parent;return t}static getParent(e){return q.getComponent(e.parent)}}q.prototype.isComponent=!0;class Y{constructor(e){this.ctx=e,this.quadTextures=[],this.quadElements=[]}get length(){return this.quadTextures.length}reset(){this.quadTextures=[],this.quadElements=[],this.dataLength=0}getElement(e){return this.quadElements[e]._element}getElementCore(e){return this.quadElements[e]}getTexture(e){return this.quadTextures[e]}getTextureWidth(e){var t=this.quadTextures[e];return t.w?t.w:this.quadElements[e]._displayedTextureSource.w}getTextureHeight(e){var t=this.quadTextures[e];return t.h?t.h:this.quadElements[e]._displayedTextureSource.h}}class $ extends Y{constructor(e){super(e);var t=e.stage.getOption("bufferMemory");this.dataLength=0,this.data=new ArrayBuffer(t),this.floats=new Float32Array(this.data),this.uints=new Uint32Array(this.data)}getAttribsDataByteOffset(e){return 80*e}getQuadContents(){for(var e=this.floats,t=this.uints,i=[],r=1;r<=this.length;r++){for(var n="entry "+r+": ",s=0;s<4;s++){var a=20*r+4*s;n+=e[a]+","+e[a+1]+":"+e[a+2]+","+e[a+3]+"["+t[a+4].toString(16)+"] "}i.push(n)}return i}}class K{constructor(e,t,i,r,n,s){this.ctx=e,this.shader=t,this.shaderOwner=i,this.renderTextureInfo=r,this.scissor=n,this.index=s,this.length=0}get quads(){return this.ctx.renderState.quads}getTexture(e){return this.quads.getTexture(this.index+e)}getElementCore(e){return this.quads.getElementCore(this.index+e)}getElement(e){return this.quads.getElement(this.index+e)}getElementWidth(e){return this.getElement(e).renderWidth}getElementHeight(e){return this.getElement(e).renderHeight}getTextureWidth(e){return this.quads.getTextureWidth(this.index+e)}getTextureHeight(e){return this.quads.getTextureHeight(this.index+e)}getRenderWidth(){return this.renderTextureInfo?this.renderTextureInfo.w:this.ctx.stage.w}getRenderHeight(){return this.renderTextureInfo?this.renderTextureInfo.h:this.ctx.stage.h}}class Z extends K{constructor(e,t,i,r,n,s){super(e,t,i,r,n,s),this.extraAttribsDataByteOffset=0}getAttribsDataByteOffset(e){return this.quads.getAttribsDataByteOffset(this.index+e)}getNormalRenderTextureCoords(e,t){var i=this.shaderOwner.getRenderTextureCoords(e,t);return i[0]/=this.getRenderWidth(),i[1]/=this.getRenderHeight(),i[0]=2*i[0]-1,i[1]=1-2*i[1],i}getProjection(){return null===this.renderTextureInfo?this.ctx.renderExec._projection:this.renderTextureInfo.nativeTexture.projection}}class Q{constructor(e){this.ctx=e,this.renderState=e.renderState,this.gl=this.ctx.stage.gl}destroy(){}_reset(){this._bindRenderTexture(null),this._setScissor(null),this._clearRenderTexture()}execute(){this._reset();for(var e=this.renderState.quadOperations,t=0,i=e.length;t<i;)this._processQuadOperation(e[t]),t++}_processQuadOperation(e){e.renderTextureInfo&&e.renderTextureInfo.ignore||(this._setupQuadOperation(e),this._execQuadOperation(e))}_setupQuadOperation(e){}_execQuadOperation(e){var t=e.renderTextureInfo?e.renderTextureInfo.nativeTexture:null;this._renderTexture!==t&&this._bindRenderTexture(t),e.renderTextureInfo&&!e.renderTextureInfo.cleared?(this._setScissor(null),this._clearRenderTexture(),e.renderTextureInfo.cleared=!0,this._setScissor(e.scissor)):this._setScissor(e.scissor),this._renderQuadOperation(e)}_renderQuadOperation(e){}_bindRenderTexture(e){this._renderTexture=e}_clearRenderTexture(e){}_setScissor(e){}}class J extends Q{constructor(e){super(e),this.gl=this.ctx.stage.gl,this.init()}init(){var e=this.gl;this._attribsBuffer=e.createBuffer();for(var t=Math.floor(this.renderState.quads.data.byteLength/80),i=new Uint16Array(6*t),r=0,n=0;r<t;r+=6,n+=4)i[r]=n,i[r+1]=n+1,i[r+2]=n+2,i[r+3]=n,i[r+4]=n+2,i[r+5]=n+3;this._quadsBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._quadsBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,i,e.STATIC_DRAW),this._projection=new Float32Array([2/this.ctx.stage.coordsWidth,-2/this.ctx.stage.coordsHeight])}destroy(){super.destroy(),this.gl.deleteBuffer(this._attribsBuffer),this.gl.deleteBuffer(this._quadsBuffer)}_reset(){super._reset();var e=this.gl;e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA),e.enable(e.BLEND),e.disable(e.DEPTH_TEST),this._stopShaderProgram(),this._setupBuffers()}_setupBuffers(){var e=this.gl;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._quadsBuffer);var t=new Float32Array(this.renderState.quads.data,0,this.renderState.quads.dataLength);e.bindBuffer(e.ARRAY_BUFFER,this._attribsBuffer),e.bufferData(e.ARRAY_BUFFER,t,e.DYNAMIC_DRAW)}_setupQuadOperation(e){super._setupQuadOperation(e),this._useShaderProgram(e.shader,e)}_renderQuadOperation(e){var t=e.shader;(e.length||e.shader.addEmpty())&&(t.beforeDraw(e),t.draw(e),t.afterDraw(e))}_useShaderProgram(e,t){e.hasSameProgram(this._currentShaderProgram)||(this._currentShaderProgram&&this._currentShaderProgram.stopProgram(),e.useProgram(),this._currentShaderProgram=e),e.setupUniforms(t)}_stopShaderProgram(){this._currentShaderProgram&&(this._currentShaderProgram.stopProgram(),this._currentShaderProgram=null)}_bindRenderTexture(e){super._bindRenderTexture(e);var t=this.gl;this._renderTexture?(t.bindFramebuffer(t.FRAMEBUFFER,this._renderTexture.framebuffer),t.viewport(0,0,this._renderTexture.w,this._renderTexture.h)):(t.bindFramebuffer(t.FRAMEBUFFER,null),t.viewport(0,0,this.ctx.stage.w,this.ctx.stage.h))}_clearRenderTexture(){super._clearRenderTexture();var e=this.gl;if(this._renderTexture)e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT);else{var t=this.ctx.stage.getClearColor();t&&(e.clearColor(t[0]*t[3],t[1]*t[3],t[2]*t[3],t[3]),e.clear(e.COLOR_BUFFER_BIT))}}_setScissor(e){if(super._setScissor(e),this._scissor!==e){this._scissor=e;var t=this.gl;if(e){t.enable(t.SCISSOR_TEST);var i=this.ctx.stage.getRenderPrecision(),r=e[1];null===this._renderTexture&&(r=this.ctx.stage.h/i-(e[1]+e[3])),t.scissor(Math.round(e[0]*i),Math.round(r*i),Math.round(e[2]*i),Math.round(e[3]*i))}else t.disable(t.SCISSOR_TEST)}}}class ee{constructor(e){this.ctx=e,this.stage=e.stage,this.defaultShader=this.stage.renderer.getDefaultShader(e),this.renderer=e.stage.renderer,this.quads=this.renderer.createCoreQuadList(e)}reset(){this._renderTextureInfo=null,this._scissor=null,this._shader=null,this._shaderOwner=null,this._realShader=null,this._check=!1,this.quadOperations=[],this._texturizer=null,this._texturizerTemporary=!1,this._quadOperation=null,this.quads.reset(),this._temporaryTexturizers=[],this._isCachingTexturizer=!1}get length(){return this.quads.quadTextures.length}setShader(e,t){this._shaderOwner===t&&this._realShader===e||(this._realShader=e,e.useDefault()&&(e=this.defaultShader),this._shader===e&&this._shaderOwner===t||(this._shader=e,this._shaderOwner=t,this._check=!0))}get renderTextureInfo(){return this._renderTextureInfo}setScissor(e){this._scissor!==e&&(this._scissor=e||null,this._check=!0)}getScissor(){return this._scissor}setRenderTextureInfo(e){this._renderTextureInfo!==e&&(this._renderTextureInfo=e,this._scissor=null,this._check=!0)}setTexturizer(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._texturizer=e,this._cacheTexturizer=t}set isCachingTexturizer(e){this._isCachingTexturizer=e}get isCachingTexturizer(){return this._isCachingTexturizer}addQuad(e){this._quadOperation?this._check&&this._hasChanges()&&(this._finishQuadOperation(),this._check=!1):this._createQuadOperation();var t=null;this._texturizer&&(t=this._texturizer.getResultTexture(),this._cacheTexturizer||this._temporaryTexturizers.push(this._texturizer)),t||(t=e._displayedTextureSource.nativeTexture),this._renderTextureInfo&&(this._shader===this.defaultShader&&this._renderTextureInfo.empty?(this._renderTextureInfo.nativeTexture=t,this._renderTextureInfo.offset=this.length):this._renderTextureInfo.nativeTexture=null,this._renderTextureInfo.empty=!1),this.quads.quadTextures.push(t),this.quads.quadElements.push(e),this._quadOperation.length++,this.renderer.addQuad(this,this.quads,this.length-1)}finishedRenderTexture(){this._renderTextureInfo.nativeTexture&&(this._isRenderTextureReusable()||(this._renderTextureInfo.nativeTexture=null))}_isRenderTextureReusable(){var e=this._renderTextureInfo.offset;return this.quads.quadTextures[e].w===this._renderTextureInfo.w&&this.quads.quadTextures[e].h===this._renderTextureInfo.h&&this.renderer.isRenderTextureReusable(this,this._renderTextureInfo)}_hasChanges(){var e=this._quadOperation;return this._shader!==e.shader||(this._shaderOwner!==e.shaderOwner||(this._renderTextureInfo!==e.renderTextureInfo||this._scissor!==e.scissor&&(this._scissor[0]!==e.scissor[0]||this._scissor[1]!==e.scissor[1]||this._scissor[2]!==e.scissor[2]||this._scissor[3]!==e.scissor[3])))}_finishQuadOperation(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this._quadOperation){if((this._quadOperation.length||this._shader.addEmpty())&&(!this._quadOperation.scissor||this._quadOperation.scissor[2]>0&&this._quadOperation.scissor[3]>0)&&this.quadOperations.push(this._quadOperation),this._temporaryTexturizers.length){for(var t=0,i=this._temporaryTexturizers.length;t<i;t++)this._temporaryTexturizers[t].releaseRenderTexture();this._temporaryTexturizers=[]}this._quadOperation=null}e&&this._createQuadOperation()}_createQuadOperation(){this._quadOperation=this.renderer.createCoreQuadOperation(this.ctx,this._shader,this._shaderOwner,this._renderTextureInfo,this._scissor,this.length),this._check=!1}finish(){this._quadOperation&&this._finishQuadOperation(!1),this.renderer.finishRenderState(this)}}class te{constructor(e,t){this.vertexShaderSource=e,this.fragmentShaderSource=t,this._program=null,this._uniformLocations=new Map,this._attributeLocations=new Map,this._currentUniformValues={}}compile(e){if(!this._program){this.gl=e,this._program=e.createProgram();var t=this._glCompile(e.VERTEX_SHADER,this.vertexShaderSource),i=this._glCompile(e.FRAGMENT_SHADER,this.fragmentShaderSource);e.attachShader(this._program,t),e.attachShader(this._program,i),e.linkProgram(this._program),e.getProgramParameter(this._program,e.LINK_STATUS)||(console.error("[Lightning] Error: Could not initialize shader."),console.error("[Lightning] gl.VALIDATE_STATUS",e.getProgramParameter(this._program,e.VALIDATE_STATUS)),console.error("[Lightning] gl.getError()",e.getError()),""!==e.getProgramInfoLog(this._program)&&console.warn("[Lightning] Warning: gl.getProgramInfoLog()",e.getProgramInfoLog(this._program)),e.deleteProgram(this._program),this._program=null),e.deleteShader(t),e.deleteShader(i)}}_glCompile(e,t){var i=this.gl.createShader(e);if(this.gl.shaderSource(i,t),this.gl.compileShader(i),!this.gl.getShaderParameter(i,this.gl.COMPILE_STATUS)){console.error("[Lightning]",this.constructor.name,"Type: "+(e===this.gl.VERTEX_SHADER?"vertex shader":"fragment shader")),console.error("[Lightning]",this.gl.getShaderInfoLog(i));var r=0;return console.error("[Lightning]","========== source ==========\n"+t.split("\n").map((e=>++r+": "+e)).join("\n")),null}return i}getUniformLocation(e){var t=this._uniformLocations.get(e);return void 0===t&&(t=this.gl.getUniformLocation(this._program,e),this._uniformLocations.set(e,t)),t}getAttribLocation(e){var t=this._attributeLocations.get(e);return void 0===t&&(t=this.gl.getAttribLocation(this._program,e),this._attributeLocations.set(e,t)),t}destroy(){this._program&&(this.gl.deleteProgram(this._program),this._program=null)}get glProgram(){return this._program}get compiled(){return!!this._program}_valueEquals(e,t){if(e.length&&t.length){for(var i=0,r=e.length;i<r;i++)if(e[i]!==t[i])return!1;return!0}return e===t}_valueClone(e){return e.length?e.slice(0):e}setUniformValue(e,t,i){var r=this._currentUniformValues[e];if(void 0===r||!this._valueEquals(r,t)){var n=this._valueClone(t);this._currentUniformValues[e]=n;var s=this.getUniformLocation(e);if(s)i===this.gl.uniformMatrix2fv||i===this.gl.uniformMatrix3fv||i===this.gl.uniformMatrix4fv?i.call(this.gl,s,!1,n):i.call(this.gl,s,n)}}}class ie extends M{constructor(e){super(e);var t=e.stage;this._program=t.renderer.shaderPrograms.get(this.constructor),this._program||(this._program=new te(this.constructor.vertexShaderSource,this.constructor.fragmentShaderSource),t.renderer.shaderPrograms.set(this.constructor,this._program)),this.gl=t.gl}get glProgram(){return this._program.glProgram}_init(){this._initialized||(this.initialize(),this._initialized=!0)}initialize(){this._program.compile(this.gl)}get initialized(){return this._initialized}_uniform(e){return this._program.getUniformLocation(e)}_attrib(e){return this._program.getAttribLocation(e)}_setUniform(e,t,i){this._program.setUniformValue(e,t,i)}useProgram(){this._init(),this.gl.useProgram(this.glProgram),this.beforeUsage(),this.enableAttribs()}stopProgram(){this.afterUsage(),this.disableAttribs()}hasSameProgram(e){return e&&(e===this||e._program===this._program)}beforeUsage(){}afterUsage(){}enableAttribs(){}disableAttribs(){}getExtraAttribBytesPerVertex(){return 0}getVertexAttribPointerOffset(e){return e.extraAttribsDataByteOffset-4*e.index*this.getExtraAttribBytesPerVertex()}setExtraAttribsInBuffer(e){}setupUniforms(e){}_getProjection(e){return e.getProjection()}getFlipY(e){return this._getProjection(e)[1]<0}beforeDraw(e){}draw(e){}afterDraw(e){}cleanup(){this._initialized=!1}}var re=class extends ie{enableAttribs(){var e=this.gl;e.vertexAttribPointer(this._attrib("aVertexPosition"),2,e.FLOAT,!1,20,0),e.enableVertexAttribArray(this._attrib("aVertexPosition")),-1!==this._attrib("aTextureCoord")&&(e.vertexAttribPointer(this._attrib("aTextureCoord"),2,e.FLOAT,!1,20,8),e.enableVertexAttribArray(this._attrib("aTextureCoord"))),-1!==this._attrib("aColor")&&(e.vertexAttribPointer(this._attrib("aColor"),4,e.UNSIGNED_BYTE,!0,20,16),e.enableVertexAttribArray(this._attrib("aColor")))}disableAttribs(){var e=this.gl;e.disableVertexAttribArray(this._attrib("aVertexPosition")),-1!==this._attrib("aTextureCoord")&&e.disableVertexAttribArray(this._attrib("aTextureCoord")),-1!==this._attrib("aColor")&&e.disableVertexAttribArray(this._attrib("aColor"))}setupUniforms(e){this._setUniform("projection",this._getProjection(e),this.gl.uniform2fv,!1)}draw(e){var t=this.gl,i=e.length;if(i){for(var r=e.getTexture(0),n=0,s=0;s<i;s++){var a=e.getTexture(s);r!==a&&(t.bindTexture(t.TEXTURE_2D,r),t.drawElements(t.TRIANGLES,6*(s-n),t.UNSIGNED_SHORT,6*(n+e.index)*2),r=a,n=s)}n<i&&(t.bindTexture(t.TEXTURE_2D,r),t.drawElements(t.TRIANGLES,6*(i-n),t.UNSIGNED_SHORT,6*(n+e.index)*2))}}};re.vertexShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec4 aColor;\n    uniform vec2 projection;\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    void main(void){\n        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);\n        vTextureCoord = aTextureCoord;\n        vColor = aColor;\n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n",re.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    void main(void){\n        gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor;\n    }\n";class ne{constructor(e){this.stage=e,this._defaultShader=void 0}gc(e){}destroy(){}getDefaultShader(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.stage.ctx;return this._defaultShader||(this._defaultShader=this._createDefaultShader(e)),this._defaultShader}_createDefaultShader(e){}isValidShaderType(e){return e.prototype instanceof this._getShaderBaseType()}createShader(e,t){var i=t.type;if(this.isValidShaderType(i)){var r=new i(e);return d.patchObject(this,t),r}var n=this._getShaderAlternative(i);return n?new n(e):(console.warn("[Lightning] Shader has no implementation for render target: "+i.name),this._createDefaultShader(e))}_getShaderBaseType(){}_getShaderAlternative(e){return this.getDefaultShader()}copyRenderTexture(e,t,i){console.warn("[Lightning] copyRenderTexture not supported by renderer")}}class se extends ne{constructor(e){super(e),this.shaderPrograms=new Map,this._compressedTextureExtensions={astc:e.gl.getExtension("WEBGL_compressed_texture_astc"),etc1:e.gl.getExtension("WEBGL_compressed_texture_etc1"),s3tc:e.gl.getExtension("WEBGL_compressed_texture_s3tc"),pvrtc:e.gl.getExtension("WEBGL_compressed_texture_pvrtc")}}getCompressedTextureExtensions(){return this._compressedTextureExtensions}destroy(){this.shaderPrograms.forEach((e=>e.destroy()))}_createDefaultShader(e){return new re(e)}_getShaderBaseType(){return ie}_getShaderAlternative(e){return e.getWebGL&&e.getWebGL()}createCoreQuadList(e){return new $(e)}createCoreQuadOperation(e,t,i,r,n,s){return new Z(e,t,i,r,n,s)}createCoreRenderExecutor(e){return new J(e)}createCoreRenderState(e){return new ee(e)}createRenderTexture(e,t,i,r){var n=this.stage.gl,s=n.createTexture();return n.bindTexture(n.TEXTURE_2D,s),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,i,r,0,n.RGBA,n.UNSIGNED_BYTE,null),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),s.params={},s.params[n.TEXTURE_MAG_FILTER]=n.LINEAR,s.params[n.TEXTURE_MIN_FILTER]=n.LINEAR,s.params[n.TEXTURE_WRAP_S]=n.CLAMP_TO_EDGE,s.params[n.TEXTURE_WRAP_T]=n.CLAMP_TO_EDGE,s.options={format:n.RGBA,internalFormat:n.RGBA,type:n.UNSIGNED_BYTE},s.framebuffer=n.createFramebuffer(),s.projection=new Float32Array([2/e,2/t]),n.bindFramebuffer(n.FRAMEBUFFER,s.framebuffer),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,s,0),s}freeRenderTexture(e){var t=this.stage.gl;t.deleteFramebuffer(e.framebuffer),t.deleteTexture(e)}_getBytesPerPixel(e,t){var i=this.stage.gl;if(e===i.RGBA)switch(t){case i.UNSIGNED_BYTE:return 4;case i.UNSIGNED_SHORT_4_4_4_4:case i.UNSIGNED_SHORT_5_5_5_1:return 2;default:throw new Error("Invalid type specified for GL_RGBA format")}else{if(e!==i.RGB)throw new Error("Invalid format specified in call to _getBytesPerPixel()");switch(t){case i.UNSIGNED_BYTE:return 3;case i.UNSIGNED_BYTE_5_6_5:return 2;default:throw new Error("Invalid type specified for GL_RGB format")}}}uploadTextureSource(e,t){var i=this.stage.gl,r=t.source,n=!1;t.renderInfo&&(n=t.renderInfo.compressed||!1);var s={premultiplyAlpha:!0,hasAlpha:!0};t&&t.hasOwnProperty("premultiplyAlpha")&&(s.premultiplyAlpha=t.premultiplyAlpha),t&&t.hasOwnProperty("flipBlueRed")&&(s.flipBlueRed=t.flipBlueRed),t&&t.hasOwnProperty("hasAlpha")&&(s.hasAlpha=t.hasAlpha),s.hasAlpha||(s.premultiplyAlpha=!1),s.texParams=t.texParams||{},s.texOptions=t.texOptions||{};var a=i.createTexture();i.bindTexture(i.TEXTURE_2D,a),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s.premultiplyAlpha),c.isNode&&i.pixelStorei(i.UNPACK_FLIP_BLUE_RED,!!s.flipBlueRed);var o=s.texParams;if(o[i.TEXTURE_MAG_FILTER]||(o[i.TEXTURE_MAG_FILTER]=i.LINEAR),o[i.TEXTURE_MIN_FILTER]||(o[i.TEXTURE_MIN_FILTER]=i.LINEAR),o[i.TEXTURE_WRAP_S]||(o[i.TEXTURE_WRAP_S]=i.CLAMP_TO_EDGE),o[i.TEXTURE_WRAP_T]||(o[i.TEXTURE_WRAP_T]=i.CLAMP_TO_EDGE),Object.keys(o).forEach((e=>{var t=o[e];i.texParameteri(i.TEXTURE_2D,parseInt(e),t)})),n)return this.stage.platform.uploadCompressedGlTexture(i,e,r),a;var h=s.texOptions;return h.format=h.format||(s.hasAlpha?i.RGBA:i.RGB),h.type=h.type||i.UNSIGNED_BYTE,h.internalFormat=h.internalFormat||h.format,t&&t.imageRef&&(h.imageRef=t.imageRef),this.stage.platform.uploadGlTexture(i,e,r,h),a.params=c.cloneObjShallow(o),a.options=c.cloneObjShallow(h),a.bytesPerPixel=this._getBytesPerPixel(h.format,h.type),a}freeTextureSource(e){this.stage.gl.deleteTexture(e.nativeTexture)}addQuad(e,t,i){var r=20*i,n=t.quadElements[i],s=n._renderContext,a=e.quads.floats,o=e.quads.uints,h=l.mergeColorAlpha;if(0!==s.tb||0!==s.tc)a[r++]=s.px,a[r++]=s.py,a[r++]=n._ulx,a[r++]=n._uly,o[r++]=h(n._colorUl,s.alpha),a[r++]=s.px+n._w*s.ta,a[r++]=s.py+n._w*s.tc,a[r++]=n._brx,a[r++]=n._uly,o[r++]=h(n._colorUr,s.alpha),a[r++]=s.px+n._w*s.ta+n._h*s.tb,a[r++]=s.py+n._w*s.tc+n._h*s.td,a[r++]=n._brx,a[r++]=n._bry,o[r++]=h(n._colorBr,s.alpha),a[r++]=s.px+n._h*s.tb,a[r++]=s.py+n._h*s.td,a[r++]=n._ulx,a[r++]=n._bry,o[r]=h(n._colorBl,s.alpha);else{var u=s.px+n._w*s.ta,c=s.py+n._h*s.td;a[r++]=s.px,a[r++]=s.py,a[r++]=n._ulx,a[r++]=n._uly,o[r++]=h(n._colorUl,s.alpha),a[r++]=u,a[r++]=s.py,a[r++]=n._brx,a[r++]=n._uly,o[r++]=h(n._colorUr,s.alpha),a[r++]=u,a[r++]=c,a[r++]=n._brx,a[r++]=n._bry,o[r++]=h(n._colorBr,s.alpha),a[r++]=s.px,a[r++]=c,a[r++]=n._ulx,a[r++]=n._bry,o[r]=h(n._colorBl,s.alpha)}}isRenderTextureReusable(e,t){var i=80*e._renderTextureInfo.offset/4,r=e.quads.floats,n=e.quads.uints;return 0===r[i]&&0===r[i+1]&&0===r[i+2]&&0===r[i+3]&&4294967295===n[i+4]&&r[i+5]===t.w&&0===r[i+6]&&1===r[i+7]&&0===r[i+8]&&4294967295===n[i+9]&&r[i+10]===t.w&&r[i+11]===t.h&&1===r[i+12]&&1===r[i+13]&&4294967295===n[i+14]&&0===r[i+15]&&r[i+16]===t.h&&0===r[i+17]&&1===r[i+18]&&4294967295===n[i+19]}finishRenderState(e){for(var t=80*e.length,i=0,r=e.quadOperations.length;i<r;i++){e.quadOperations[i].extraAttribsDataByteOffset=t;var n=4*e.quadOperations[i].shader.getExtraAttribBytesPerVertex()*e.quadOperations[i].length;t+=n,n&&e.quadOperations[i].shader.setExtraAttribsInBuffer(e.quadOperations[i],e.quads)}e.quads.dataLength=t}copyRenderTexture(e,t,i){var r=this.stage.gl;r.bindTexture(r.TEXTURE_2D,t),r.bindFramebuffer(r.FRAMEBUFFER,e.framebuffer);var n=e.precision;r.copyTexSubImage2D(r.TEXTURE_2D,0,n*(i.sx||0),n*(i.sy||0),n*(i.x||0),n*(i.y||0),n*(i.w||e.ow),n*(i.h||e.oh))}}class ae extends Y{constructor(e){super(e),this.renderContexts=[],this.modes=[]}setRenderContext(e,t){this.renderContexts[e]=t}setSimpleTc(e,t){t?this.modes[e]|=1:this.modes[e]-=1&this.modes[e]}setWhite(e,t){t?this.modes[e]|=2:this.modes[e]-=2&this.modes[e]}getRenderContext(e){return this.renderContexts[e]}getSimpleTc(e){return 1&this.modes[e]}getWhite(e){return 2&this.modes[e]}}class oe extends K{getRenderContext(e){return this.quads.getRenderContext(this.index+e)}getSimpleTc(e){return this.quads.getSimpleTc(this.index+e)}getWhite(e){return this.quads.getWhite(this.index+e)}}class he extends Q{init(){this._mainRenderTexture=this.ctx.stage.getCanvas()}_renderQuadOperation(e){var t=e.shader;if(e.length||e.shader.addEmpty()){var i=this._renderTexture||this._mainRenderTexture;t.beforeDraw(e,i),t.draw(e,i),t.afterDraw(e,i)}}_clearRenderTexture(){var e=this._getContext(),t=[0,0,0,0];this._mainRenderTexture.ctx===e&&(t=this.ctx.stage.getClearColor());var i=e.canvas;e.setTransform(1,0,0,1,0,0),t[0]||t[1]||t[2]||t[3]?(e.fillStyle=l.getRgbaStringFromArray(t),e.globalCompositeOperation="copy",e.beginPath(),e.rect(0,0,i.width,i.height),e.closePath(),e.fill(),e.globalCompositeOperation="source-over"):e.clearRect(0,0,i.width,i.height)}_getContext(){return this._renderTexture?this._renderTexture.ctx:this._mainRenderTexture.ctx}_restoreContext(){var e=this._getContext();e.restore(),e.save(),e._scissor=null}_setScissor(e){var t=this._getContext();if(!he._equalScissorAreas(t.canvas,t._scissor,e)){this._restoreContext();var i=this.ctx.stage.getRenderPrecision();e&&(t.beginPath(),t.rect(Math.round(e[0]*i),Math.round(e[1]*i),Math.round(e[2]*i),Math.round(e[3]*i)),t.closePath(),t.clip()),t._scissor=e}}static _equalScissorAreas(e,t,i){return t||(t=[0,0,e.width,e.height]),i||(i=[0,0,e.width,e.height]),c.equalValues(t,i)}}class ue extends M{beforeDraw(e){}draw(e){}afterDraw(e){}}class le extends ue{constructor(e){super(e),this._rectangleTexture=e.stage.rectangleTexture.source.nativeTexture,this._tintManager=this.ctx.stage.renderer.tintManager}draw(e,t){for(var i=t.ctx,r=e.length,n=0;n<r;n++){var s=e.getTexture(n),a=e.getElementCore(n),o=e.getRenderContext(n),h=e.getWhite(n),u=e.getSimpleTc(n),c=this.ctx.stage.getRenderPrecision();i.setTransform(o.ta*c,o.tc*c,o.tb*c,o.td*c,o.px*c,o.py*c);var d=s===this._rectangleTexture,p={operation:e,target:t,index:n,rect:d};if(d)h?i.fillStyle="white":this._setColorGradient(i,a),i.globalAlpha=o.alpha,this._beforeDrawEl(p),i.fillRect(0,0,a.w,a.h),this._afterDrawEl(p),i.globalAlpha=1;else{i.globalAlpha=o.alpha,this._beforeDrawEl(p);var g=u?0:a._ulx*s.w,f=u?0:a._uly*s.h,m=(u?1:a._brx-a._ulx)*s.w,_=(u?1:a._bry-a._uly)*s.h;if(!h){var v=a._colorUl;a._colorUl===a._colorUr&&a._colorUr===a._colorBl&&a._colorBr===a._colorBl||(v=l.mergeMultiColorsEqual([a._colorUl,a._colorUr,a._colorBl,a._colorBr]));var y=(v/16777216|0)/255;i.globalAlpha*=y;var x=16777215&v,b=this._tintManager.getTintTexture(s,x);i.fillStyle="white",i.drawImage(b,g,f,m,_,0,0,a.w,a.h)}else i.fillStyle="white",i.drawImage(s,g,f,m,_,0,0,a.w,a.h);this._afterDrawEl(p),i.globalAlpha=1}}}_setColorGradient(e,t){var i,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.w,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.h,s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=t._colorUl;t._colorUl===t._colorUr?t._colorBl===t._colorBr&&(t._colorUl===t.colorBl||(i=e.createLinearGradient(0,0,0,n),s?(i.addColorStop(0,l.getRgbaString(t._colorUl)),i.addColorStop(1,l.getRgbaString(t._colorBl))):(i.addColorStop(0,l.getRgbString(t._colorUl)),i.addColorStop(1,l.getRgbString(t._colorBl))))):t._colorUl===t._colorBl&&t._colorUr===t._colorBr&&(i=e.createLinearGradient(0,0,r,0),s?(i.addColorStop(0,l.getRgbaString(t._colorUl)),i.addColorStop(1,l.getRgbaString(t._colorBr))):(i.addColorStop(0,l.getRgbString(t._colorUl)),i.addColorStop(1,l.getRgbString(t._colorBr)))),e.fillStyle=i||(s?l.getRgbaString(a):l.getRgbString(a))}_beforeDrawEl(e){}_afterDrawEl(e){}}class ce{constructor(e){this.stage=e,this._usedMemory=0,this._cachedNativeTextures=new Set}destroy(){this.gc(!0)}_addMemoryUsage(e){this._usedMemory+=e,this.stage.addMemoryUsage(e)}delete(e){if(this._hasCache(e)){var t=this._getCache(e),i=t.memoryUsage;t.clear(),this._cachedNativeTextures.delete(e),this._addMemoryUsage(t.memoryUsage-i)}}getTintTexture(e,t){var i=this.stage.frameCounter;this._cachedNativeTextures.add(e);var r=this._getCache(e),n=r.get(t);if(n.lf=i,n.tx)return e.update>n.u&&this._tintTexture(n.tx,e,t),n.tx;var s=r.memoryUsage,a=r.reuseTexture(i);a?a.ctx.clearRect(0,0,a.width,a.height):((a=document.createElement("canvas")).width=e.w,a.height=e.h,a.ctx=a.getContext("2d")),this._tintTexture(a,e,t),r.set(t,a,i);var o=r.memoryUsage;return o!==s&&this._addMemoryUsage(o-s),a}_tintTexture(e,t,i){for(var r=i.toString(16);r.length<6;)r="0"+r;e.ctx.fillStyle="#"+r,e.ctx.globalCompositeOperation="copy",e.ctx.fillRect(0,0,t.w,t.h),e.ctx.globalCompositeOperation="multiply",e.ctx.drawImage(t,0,0,t.w,t.h,0,0,e.width,e.height),e.ctx.globalCompositeOperation="destination-in",e.ctx.drawImage(t,0,0,t.w,t.h,0,0,e.width,e.height)}_hasCache(e){return!!e._tintCache}_getCache(e){return e._tintCache||(e._tintCache=new de(e)),e._tintCache}gc(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.stage.frameCounter,i=0;this._cachedNativeTextures.forEach((r=>{var n=this._getCache(r);if(e)i+=n.memoryUsage,n.clear();else{var s=n.memoryUsage;n.cleanup(t),n.releaseBlancoTextures(),i+=n.memoryUsage-s}})),e&&this._cachedNativeTextures.clear(),i&&this._addMemoryUsage(i)}}class de{constructor(e){this._tx=e,this._colors=new Map,this._blancoTextures=null,this._lastCleanupFrame=0,this._memTextures=0}get memoryUsage(){return this._memTextures*this._tx.w*this._tx.h}releaseBlancoTextures(){this._memTextures-=this._blancoTextures.length,this._blancoTextures=[]}clear(){this._blancoTextures=null,this._colors.clear(),this._memTextures=0}get(e){var t=this._colors.get(e);return t||(t={lf:-1,tx:void 0,u:-1},this._colors.set(e,t)),t}set(e,t,i){var r=this.get(e);r.lf=i,r.tx=t,r.u=i,this._memTextures++}cleanup(e){this._lastCleanupFrame!==e&&(this._blancoTextures=[],this._colors.forEach(((t,i)=>{t.lf<e-1&&(t.tx&&this._blancoTextures.push(t.tx),this._colors.delete(i))})),this._lastCleanupFrame=e)}reuseTexture(e){if(this.cleanup(e),this._blancoTextures&&this._blancoTextures.length)return this._memTextures--,this._blancoTextures.pop()}}class pe extends ne{constructor(e){super(e),this.tintManager=new ce(e),this.setupC2d(this.stage.c2d.canvas)}destroy(){this.tintManager.destroy()}_createDefaultShader(e){return new le(e)}_getShaderBaseType(){return ue}_getShaderAlternative(e){return e.getC2d&&e.getC2d()}createCoreQuadList(e){return new ae(e)}createCoreQuadOperation(e,t,i,r,n,s){return new oe(e,t,i,r,n,s)}createCoreRenderExecutor(e){return new he(e)}createCoreRenderState(e){return new ee(e)}createRenderTexture(e,t,i,r){var n=document.createElement("canvas");return n.width=i,n.height=r,this.setupC2d(n),n}freeRenderTexture(e){this.tintManager.delete(e)}gc(e){this.tintManager.gc(e)}uploadTextureSource(e,t){if(t.source.buffer){var i=document.createElement("canvas");i.width=t.w,i.height=t.h;var r=new ImageData(new Uint8ClampedArray(t.source.buffer),t.w,t.h);return i.getContext("2d").putImageData(r,0,0),i}return t.source}freeTextureSource(e){this.tintManager.delete(e.nativeTexture)}addQuad(e,t,i){var r=t.quadElements[i];t.setRenderContext(i,r._renderContext),t.setWhite(i,r.isWhite()),t.setSimpleTc(i,r.hasSimpleTexCoords())}isRenderTextureReusable(e,t){return!1}finishRenderState(e){}setupC2d(e){var t=e.getContext("2d");e.ctx=t,t._scissor=null,e.ctx.save()}}class ge extends ie{enableAttribs(){var e=this.gl;e.vertexAttribPointer(this._attrib("aVertexPosition"),2,e.FLOAT,!1,20,0),e.enableVertexAttribArray(this._attrib("aVertexPosition")),-1!==this._attrib("aTextureCoord")&&(e.vertexAttribPointer(this._attrib("aTextureCoord"),2,e.FLOAT,!1,20,8),e.enableVertexAttribArray(this._attrib("aTextureCoord"))),-1!==this._attrib("aColor")&&(e.vertexAttribPointer(this._attrib("aColor"),4,e.UNSIGNED_BYTE,!0,20,16),e.enableVertexAttribArray(this._attrib("aColor")))}disableAttribs(){var e=this.gl;e.disableVertexAttribArray(this._attrib("aVertexPosition")),-1!==this._attrib("aTextureCoord")&&e.disableVertexAttribArray(this._attrib("aTextureCoord")),-1!==this._attrib("aColor")&&e.disableVertexAttribArray(this._attrib("aColor"))}setupUniforms(e){this._setUniform("projection",this._getProjection(e),this.gl.uniform2fv,!1)}draw(e){var t=this.gl,i=e.length;if(i){for(var r=e.getTexture(0),n=0,s=0;s<i;s++){var a=e.getTexture(s);if(r!==a){if(r.options&&r.options.imageRef){var o=s>0?s-1:s,h=this.ctx.stage.getOption("precision"),u=e.getElementCore(o);this.ctx.stage.platform.paint(t,r.options.imageRef,u._worldContext.px*h,u._worldContext.py*h,u._colorUl,u)}else t.bindTexture(t.TEXTURE_2D,r),t.drawElements(t.TRIANGLES,6*(s-n),t.UNSIGNED_SHORT,6*(n+e.index)*2);r=a,n=s}}if(n<i)if(r.options&&r.options.imageRef){var l=this.ctx.stage.getOption("precision"),c=e.getElementCore(n);this.ctx.stage.platform.paint(t,r.options.imageRef,c._worldContext.px*l,c._worldContext.py*l,c._colorUl,c)}else t.bindTexture(t.TEXTURE_2D,r),t.drawElements(t.TRIANGLES,6*(i-n),t.UNSIGNED_SHORT,6*(n+e.index)*2)}}}ge.vertexShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec4 aColor;\n    uniform vec2 projection;\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    void main(void){\n        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);\n        vTextureCoord = aTextureCoord;\n        vColor = aColor;\n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n",ge.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    void main(void){\n        gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor;\n    }\n";class fe extends se{constructor(e){super(e)}_createDefaultShader(e){return new ge(e)}createCoreRenderExecutor(e){global.beginDrawing();var t=super.createCoreRenderExecutor(e);return global.endDrawing(),t}}class me{constructor(){this._items=new Map,this._id=0,this._initWorker()}destroy(){this._worker&&this._worker.terminate()}_initWorker(){var e=`(${ve.toString()})()`,t=new Blob([e.replace('"use strict";',"")]),i=(window.URL?URL:webkitURL).createObjectURL(t,{type:"application/javascript; charset=utf-8"});this._worker=new Worker(i),this._worker.postMessage({type:"config",config:{path:window.location.href,protocol:window.location.protocol}}),this._worker.onmessage=e=>{if(e.data&&e.data.id){var t=e.data.id,i=this._items.get(t);i&&("data"==e.data.type?this.finish(i,e.data.info):this.error(i,e.data.info))}}}create(e){var t=++this._id,i=new _e(this,t,e);return this._items.set(t,i),this._worker.postMessage({type:"add",id:t,src:e}),i}cancel(e){this._worker.postMessage({type:"cancel",id:e.id}),this._items.delete(e.id)}error(e,t){e.error(t),this._items.delete(e.id)}finish(e,t){e.load(t),this._items.delete(e.id)}}class _e{constructor(e,t,i){this._manager=e,this._id=t,this._src=i,this._onError=null,this._onLoad=null}get id(){return this._id}get src(){return this._src}set onError(e){this._onError=e}set onLoad(e){this._onLoad=e}cancel(){this._manager.cancel(this)}load(e){this._onLoad&&this._onLoad(e)}error(e){this._onError&&this._onError(e)}}var ve=function(){function e(){this.items=new Map;var e=this;onmessage=function(t){e._receiveMessage(t)}}function t(e,t){this._onError=void 0,this._onFinish=void 0,this._id=e,this._src=t,this._xhr=void 0,this._mimeType=void 0,this._canceled=!1}e.isPathAbsolute=function(e){return/^(?:\/|[a-z]+:\/\/)/.test(e)||"data:"==e.substr(0,5)},e.prototype._receiveMessage=function(e){if("config"===e.data.type){this.config=e.data.config;var t=this.config.path;/#.*?\//.test(t)&&(t=t.replace(/#.*$/,""));var i=t.split("/");i.pop(),this._relativeBase=i.join("/")+"/"}else"add"===e.data.type?this.add(e.data.id,e.data.src):"cancel"===e.data.type&&this.cancel(e.data.id)},e.prototype.add=function(i,r){e.isPathAbsolute(r)||(r=this._relativeBase+r),"//"===r.substr(0,2)&&(r=this.config.protocol+r);var n=new t(i,r),s=this;n.onFinish=function(e){s.finish(n,e)},n.onError=function(e){s.error(n,e)},this.items.set(i,n),n.start()},e.prototype.cancel=function(e){var t=this.items.get(e);t&&(t.cancel(),this.items.delete(e))},e.prototype.finish=function(e,t){var i=t.imageBitmap,r=t.hasAlphaChannel;postMessage({type:"data",id:e.id,info:{imageBitmap:i,hasAlphaChannel:r}},[i]),this.items.delete(e.id)},e.prototype.error=function(e,t){var i=t.type,r=t.message;postMessage({type:"error",id:e.id,info:{type:i,message:r}}),this.items.delete(e.id)},e.isWPEBrowser=function(){return-1!==navigator.userAgent.indexOf("WPE")},Object.defineProperty(t.prototype,"id",{get:function(){return this._id}}),Object.defineProperty(t.prototype,"onFinish",{get:function(){return this._onFinish},set:function(e){this._onFinish=e}}),Object.defineProperty(t.prototype,"onError",{get:function(){return this._onError},set:function(e){this._onError=e}}),t.prototype.start=function(){this._xhr=new XMLHttpRequest,this._xhr.open("GET",this._src,!0),this._xhr.responseType="blob";var e=this;this._xhr.onerror=function(t){e.error({type:"connection",message:"Connection error"})},this._xhr.onload=function(t){var i=e._xhr.response;e._mimeType=i.type,e._createImageBitmap(i)},this._xhr.send()},t.prototype._createImageBitmap=function(e){var t=this;createImageBitmap(e,{premultiplyAlpha:"premultiply",colorSpaceConversion:"none",imageOrientation:"none"}).then((function(e){t.finish({imageBitmap:e,hasAlphaChannel:t._hasAlphaChannel()})})).catch((function(e){t.error({type:"parse",message:"Error parsing image data"})}))},t.prototype._hasAlphaChannel=function(){return!!e.isWPEBrowser()||-1!==this._mimeType.indexOf("image/png")},t.prototype.cancel=function(){this._canceled||(this._xhr&&this._xhr.abort(),this._canceled=!0)},t.prototype.error=function(e,t){!this._canceled&&this._onError&&this._onError({type:e,message:t})},t.prototype.finish=function(e){!this._canceled&&this._onFinish&&this._onFinish(e)},new e};class ye{init(e){this.stage=e,this._looping=!1,this._awaitingLoop=!1,this._loopHandler=null,this._idleLoopCounter=0,this._idleLoopDelay=60,this.stage.getOption("useImageWorker")&&(window.createImageBitmap&&window.Worker?this._imageWorker=new me:console.warn("[Lightning] Can't use image worker because browser does not have createImageBitmap and Web Worker support")),this._registerVisibilityChangeHandler()}destroy(){this._imageWorker&&this._imageWorker.destroy(),this._removeKeyHandler(),this._removeClickHandler(),this._removeHoverHandler(),this._removeScrollWheelHandler(),this._removeVisibilityChangeHandler()}startLoop(){this._looping=!0,this._awaitingLoop||this.loop()}stopLoop(){this._looping=!1}switchLoop(){this._idleLoopCounter<this._idleLoopDelay?this._idleLoopCounter++:this.stage.ctx.hasRenderUpdates()?this._idleLoopCounter=0:(this.stopLoop(),this._loopHandler=setInterval((()=>{this.stage.updateFrame(),this.stage.idleFrame(),this.stage.ctx.hasRenderUpdates()&&(clearInterval(this._loopHandler),this.startLoop())}),1e3/60))}loop(){var e=this;requestAnimationFrame((function t(){e._awaitingLoop=!1,e._looping&&(e.stage.updateFrame(),e.stage.getOption("pauseRafLoopOnIdle")&&e.switchLoop(),e.stage.renderFrame(),requestAnimationFrame(t),e._awaitingLoop=!0)}))}uploadCompressedGlTexture(e,t,i,r){var n=i.pvr?i.mipmaps[0]:new DataView(i.mipmaps[0]);e.compressedTexImage2D(e.TEXTURE_2D,0,i.glInternalFormat,i.pixelWidth,i.pixelHeight,0,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR)}uploadGlTexture(e,t,i,r){if(i instanceof ImageData||i instanceof HTMLImageElement||i instanceof HTMLVideoElement||window.ImageBitmap&&i instanceof ImageBitmap)e.texImage2D(e.TEXTURE_2D,0,r.internalFormat,r.format,r.type,i);else if(i instanceof HTMLCanvasElement){if(c.isZiggo||this.stage.getOption("forceTxCanvasSource"))e.texImage2D(e.TEXTURE_2D,0,r.internalFormat,r.format,r.type,i);else if(i.width>0&&i.height>0){var n=i.getContext("2d");e.texImage2D(e.TEXTURE_2D,0,r.internalFormat,r.format,r.type,n.getImageData(0,0,i.width,i.height))}}else e.texImage2D(e.TEXTURE_2D,0,r.internalFormat,t.w,t.h,0,r.format,r.type,i)}handleKtxLoad(e,t){var i=this;return function(){var r=this.response,n=new DataView(r);3632701469!==n.getUint32(0)+n.getUint32(4)+n.getUint32(8)&&e("Parsing failed: identifier ktx mismatch:",t);var s=16909060===n.getUint32(12),a={glType:n.getUint32(16,s),glTypeSize:n.getUint32(20,s),glFormat:n.getUint32(24,s),glInternalFormat:n.getUint32(28,s),glBaseInternalFormat:n.getUint32(32,s),pixelWidth:n.getUint32(36,s),pixelHeight:n.getUint32(40,s),pixelDepth:n.getUint32(44,s),numberOfArrayElements:n.getUint32(48,s),numberOfFaces:n.getUint32(52,s),numberOfMipmapLevels:n.getUint32(56,s),bytesOfKeyValueData:n.getUint32(60,s),kvps:[],mipmaps:[],get width(){return this.pixelWidth},get height(){return this.pixelHeight}};Object.values(i.stage.renderer.getCompressedTextureExtensions()).filter((e=>null!=e)).map((e=>(e=>{var t=[];for(var i in e)t.push(e[i]);return t})(e))).reduce(((e,t)=>e.concat(t))).includes(a.glInternalFormat)||console.warn("[Lightning] Unrecognized texture extension format:",t,a.glInternalFormat,i.stage.renderer.getCompressedTextureExtensions());var o=64;o+=a.bytesOfKeyValueData;for(var h=0;h<a.numberOfMipmapLevels;h++){var u=n.getUint32(o);o+=4,a.mipmaps.push(n.buffer.slice(o,u)),o+=u}e(null,{source:a,renderInfo:{src:t,compressed:!0}})}}handlePvrLoad(e,t){return function(){for(var i=this.response,r=new Int32Array(i,0,13),n=r[12]+52,s=new Uint8Array(i,n),a={glInternalFormat:36196,pixelWidth:r[7],pixelHeight:r[6],numberOfMipmapLevels:r[11],mipmaps:[],pvr:!0,get width(){return this.pixelWidth},get height(){return this.pixelHeight}},o=0,h=a.pixelWidth,u=a.pixelHeight,l=0;l<a.numberOfMipmapLevels;l++){var c=(h+3>>2)*(u+3>>2)*8,d=new Uint8Array(i,s.byteOffset+o,c);a.mipmaps.push(d),o+=c,h>>=1,u>>=1}e(null,{source:a,renderInfo:{src:t,compressed:!0}})}}loadSrcTexture(e,t){var i=e.src,r=e.hasAlpha,n=void 0,s=i.indexOf(".png")>=0||"data:image/png;base64"==i.substr(0,21),a=i.indexOf(".ktx")>=0,o=i.indexOf(".pvr")>=0;if(a||o){var h=new XMLHttpRequest;h.addEventListener("load",a?this.handleKtxLoad(t,i):this.handlePvrLoad(t,i)),h.open("GET",i),h.responseType="arraybuffer",h.send(),n=function(){h.abort()}}else if(this._imageWorker){var u=this._imageWorker.create(i);u.onError=function(e){return t("Image load error")},u.onLoad=function(e){var r=e.imageBitmap,n=e.hasAlphaChannel;t(null,{source:r,renderInfo:{src:i,compressed:!1},hasAlpha:n,premultiplyAlpha:!0})},n=function(){u.cancel()}}else{var l=new Image;"data:"==i.substr(0,5)||c.isPS4||(l.crossOrigin="Anonymous"),l.onerror=function(e){if(l.src)return t("Image load error")},l.onload=function(){t(null,{source:l,renderInfo:{src:i,compressed:!1},hasAlpha:s||r})},l.src=i,n=function(){l.onerror=null,l.onload=null,l.removeAttribute("src")}}return n}createWebGLContext(e,t){var i=this.stage.getOption("canvas")||document.createElement("canvas");e&&t&&(i.width=e,i.height=t);var r={alpha:!0,antialias:!1,premultipliedAlpha:!0,stencil:!0,preserveDrawingBuffer:!1},n=i.getContext("webgl",r)||i.getContext("experimental-webgl",r);if(!n)throw new Error("This browser does not support webGL.");return n}createCanvasContext(e,t){var i=this.stage.getOption("canvas")||document.createElement("canvas");e&&t&&(i.width=e,i.height=t);var r=i.getContext("2d");if(!r)throw new Error("This browser does not support 2d canvas.");return r}getHrTime(){return window.performance?window.performance.now():(new Date).getTime()}getDrawingCanvas(){return document.createElement("canvas")}getTextureOptionsForDrawingCanvas(e){var t={};return t.source=e,t}nextFrame(e){}registerKeydownHandler(e){this._keydownListener=t=>{e(t)},window.addEventListener("keydown",this._keydownListener)}registerKeyupHandler(e){this._keyupListener=t=>{e(t)},window.addEventListener("keyup",this._keyupListener)}_removeKeyHandler(){this._keydownListener&&window.removeEventListener("keydown",this._keydownListener),this._keyupListener&&window.removeEventListener("keyup",this._keyupListener)}registerClickHandler(e){this._clickListener=t=>{e(t)},window.addEventListener("mousedown",this._clickListener)}_removeClickHandler(){this._clickListener&&window.removeEventListener("mousedown",this._clickListener)}registerHoverHandler(e){this._hoverListener=t=>{e(t)},window.addEventListener("mousemove",this._hoverListener)}_removeHoverHandler(){this._hoverListener&&window.removeEventListener("mousemove",this._hoverListener)}registerScrollWheelHandler(e){this._scrollWheelListener=t=>{e(t)},window.addEventListener("wheel",this._scrollWheelListener)}_removeScrollWheelHandler(){this._scrollWheelListener&&window.removeEventListener("wheel",this._scrollWheelListener)}_registerVisibilityChangeHandler(){this._visibilityChangeHandler=()=>{"visible"===document.visibilityState&&(this.stage.root.core.setHasRenderUpdates(2),this.stage.renderFrame())},document.addEventListener("visibilitychange",this._visibilityChangeHandler)}_removeVisibilityChangeHandler(){this._visibilityChangeHandler&&document.removeEventListener("visibilitychange",this._visibilityChangeHandler)}}class xe{static load(e){return e.platform?e.platform:ye}}var be=class e{static isFunction(e){return"function"==typeof e}static isNumber(e){return"number"==typeof e}static isInteger(e){return"number"==typeof e&&e%1==0}static isBoolean(e){return!0===e||!1===e}static isString(e){return"string"==typeof e}static isObject(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}static isPlainObject(e){return!!e&&"object"==typeof e}static isObjectLiteral(e){return"object"==typeof e&&e&&e.constructor===Object}static getArrayIndex(t,i){return e.getModuloIndex(t,i.length)}static equalValues(t,i){return typeof t==typeof i&&(e.isObjectLiteral(t)?e.isObjectLiteral(i)&&e.equalObjectLiterals(t,i):Array.isArray(t)?Array.isArray(i)&&e.equalArrays(t,i):t===i)}static equalObjectLiterals(t,i){var r=Object.keys(t),n=Object.keys(i);if(r.length!==n.length)return!1;for(var s=0,a=r.length;s<a;s++){var o=r[s],h=n[s];if(o!==h)return!1;var u=t[o],l=i[h];if(!e.equalValues(u,l))return!1}return!0}static equalArrays(e,t){if(e.length!==t.length)return!1;for(var i=0,r=e.length;i<r;i++)if(!this.equalValues(e[i],t[i]))return!1;return!0}};class we{constructor(e,t){this._id=e,this._gl=t,this._program=void 0,this._buffers=new Map,this._framebuffers=new Map,this._renderbuffers=new Map,this._vertexAttribs=new Array(16),this._nonDefaultFlags=new Set,this._settings=new Map,this._textures=new Array(8),this._maxTexture=0,this._activeTexture=t.TEXTURE0,this._pixelStorei=new Array(5)}_getDefaultFlag(e){return e===this._gl.DITHER}setFlag(e,t){return t===this._getDefaultFlag(e)?this._nonDefaultFlags.delete(e):!this._nonDefaultFlags.has(e)&&(this._nonDefaultFlags.add(e),!0)}setBuffer(e,t){var i=this._buffers.get(e)!==t;return this._buffers.set(e,t),i&&e===this._gl.ARRAY_BUFFER&&(this._vertexAttribs=[]),i}setFramebuffer(e,t){var i=this._framebuffers.get(e)!==t;return this._framebuffers.set(e,t),i}setRenderbuffer(e,t){var i=this._renderbuffers.get(e)!==t;return this._renderbuffers.set(e,t),i}setProgram(e){var t=this._program!==e;return this._program=e,t}setSetting(e,t){var i=this._settings.get(e),r=!i||!be.equalValues(i,t);return this._settings.set(e,t),r}disableVertexAttribArray(e){var t=this._vertexAttribs[e];return!(!t||!t[5])&&(t[5]=!1,!0)}enableVertexAttribArray(e){var t=this._vertexAttribs[e];return t?!t[0]&&(t[0]=!0,!0):(this._vertexAttribs[e]=[0,0,0,0,0,!0],!0)}vertexAttribPointer(e,t){var i=this._vertexAttribs[e],r=!1;return i&&(r=i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]&&i[3]===t[3]&&i[4]===t[4]),!r&&(t[5]=!!i&&i[5],!0)}setActiveTexture(e){var t=this._activeTexture!==e;return this._activeTexture=e,t}bindTexture(e,t){var i=we._getTextureIndex(this._activeTexture);this._maxTexture=Math.max(this._maxTexture,i+1);var r=this._textures[i],n=we._getTextureTargetIndex(e);return r?r[n]!==t&&(r[n]=t,!0):!!t&&(this._textures[i]=[],this._textures[i][n]=t,!0)}setPixelStorei(e,t){var i=we._getPixelStoreiIndex(e),r=!be.equalValues(this._pixelStorei[i],t);return this._pixelStorei[i]=t,r}migrate(e){var t=this;this._migrateFlags(t,e),e._program!==t._program&&this._gl._useProgram(e._program),this._migrateFramebuffers(t,e),this._migrateRenderbuffers(t,e);var i=this._migrateBuffers(t,e);this._migrateAttributes(t,e,i),this._migrateFlags(t,e),this._migrateSettings(t,e),this._migratePixelStorei(t,e),this._migrateTextures(t,e)}_migratePixelStorei(e,t){for(var i=0,r=e._pixelStorei.length;i<r;i++)if(e._pixelStorei[i]!==t._pixelStorei[i]){var n=void 0!==t._pixelStorei[i]?t._pixelStorei[i]:we._getDefaultPixelStoreiByIndex(i);this._gl._pixelStorei(we._getPixelStoreiByIndex(i),n)}}_migrateTextures(e,t){for(var i=Math.max(e._maxTexture,t._maxTexture),r=e._activeTexture,n=0;n<i;n++)for(var s=t._textures[n],a=e._textures[n],o=we._getTextureByIndex(n),h=0,u=Math.max(a?a.length:0,s?s.length:0);h<u;h++){var l=we._getTextureTargetByIndex(h);r!==o&&(this._gl._activeTexture(o),r=o);var c=s&&s[h]||null;this._gl._bindTexture(l,c)}t._activeTexture!==r&&this._gl._activeTexture(t._activeTexture)}_migrateBuffers(e,t){return t._buffers.forEach(((t,i)=>{e._buffers.get(i)!==t&&this._gl._bindBuffer(i,t)})),e._buffers.forEach(((e,i)=>{void 0===t._buffers.get(i)&&this._gl._bindBuffer(i,null)})),t._buffers.get(this._gl.ARRAY_BUFFER)!==e._buffers.get(this._gl.ARRAY_BUFFER)}_migrateFramebuffers(e,t){t._framebuffers.forEach(((t,i)=>{e._framebuffers.get(i)!==t&&this._gl._bindFramebuffer(i,t)})),e._framebuffers.forEach(((e,i)=>{void 0===t._framebuffers.get(i)&&this._gl._bindFramebuffer(i,null)}))}_migrateRenderbuffers(e,t){t._renderbuffers.forEach(((t,i)=>{e._renderbuffers.get(i)!==t&&this._gl._bindRenderbuffer(i,t)})),e._renderbuffers.forEach(((e,i)=>{void 0===t._renderbuffers.get(i)&&this._gl._bindRenderbuffer(i,null)}))}_migrateAttributes(e,t,i){i?t._vertexAttribs.forEach(((e,t)=>{e[0]&&this._gl._vertexAttribPointer(t,e[0],e[1],e[2],e[3],e[4]),e[5]&&this._gl._enableVertexAttribArray(t)})):(e._vertexAttribs.forEach(((e,i)=>{t._vertexAttribs[i]||this._gl._disableVertexAttribArray(i)})),t._vertexAttribs.forEach(((e,t)=>{this._gl._vertexAttribPointer(t,e[0],e[1],e[2],e[4]),e[5]?this._gl._enableVertexAttribArray(t):this._gl._disableVertexAttribArray(t)})))}_migrateSettings(e,t){var i=this.constructor.getDefaultSettings();e._settings.forEach(((e,r)=>{var n=r.name||r.xname;if(!t._settings.has(r)){var s=i.get(n);be.isFunction(s)&&(s=s(this._gl)),t._settings.set(r,s),r.apply(this._gl,s)}})),t._settings.forEach(((t,i)=>{var r=e._settings.get(i);r&&be.equalValues(r,t)||i.apply(this._gl,t)}))}_migrateFlags(e,t){e._nonDefaultFlags.forEach((e=>{t._nonDefaultFlags.has(e)||(this._getDefaultFlag(e)?this._gl._enable(e):this._gl._disable(e))})),t._nonDefaultFlags.forEach((t=>{e._nonDefaultFlags.has(t)||(this._getDefaultFlag(t)?this._gl._disable(t):this._gl._enable(t))}))}static getDefaultSettings(){if(!this._defaultSettings){this._defaultSettings=new Map;var e=this._defaultSettings,t=WebGLRenderingContext.prototype;e.set("viewport",(function(e){return[0,0,e.canvas.width,e.canvas.height]})),e.set("scissor",(function(e){return[0,0,e.canvas.width,e.canvas.height]})),e.set("blendColor",[0,0,0,0]),e.set("blendEquation",[t.FUNC_ADD]),e.set("blendEquationSeparate",[t.FUNC_ADD,t.FUNC_ADD]),e.set("blendFunc",[t.ONE,t.ZERO]),e.set("blendFuncSeparate",[t.ONE,t.ZERO,t.ONE,t.ZERO]),e.set("clearColor",[0,0,0,0]),e.set("clearDepth",[1]),e.set("clearStencil",[0]),e.set("colorMask",[!0,!0,!0,!0]),e.set("cullFace",[t.BACK]),e.set("depthFunc",[t.LESS]),e.set("depthMask",[!0]),e.set("depthRange",[0,1]),e.set("frontFace",[t.CCW]),e.set("lineWidth",[1]),e.set("polygonOffset",[0,0]),e.set("sampleCoverage",[1,!1]),e.set("stencilFunc",[t.ALWAYS,0,1]),e.set("_stencilFuncSeparateFront",[t.ALWAYS,0,1]),e.set("_stencilFuncSeparateBack",[t.ALWAYS,0,1]),e.set("_stencilFuncSeparateFrontAndBack",[t.ALWAYS,0,1]),e.set("stencilMask",[1]),e.set("_stencilMaskSeparateFront",[1]),e.set("_stencilMaskSeparateBack",[1]),e.set("_stencilMaskSeparateFrontAndBack",[1]),e.set("stencilOp",[t.KEEP,t.KEEP,t.KEEP]),e.set("_stencilOpSeparateFront",[t.KEEP,t.KEEP,t.KEEP]),e.set("_stencilOpSeparateBack",[t.KEEP,t.KEEP,t.KEEP]),e.set("_stencilOpSeparateFrontAndBack",[t.KEEP,t.KEEP,t.KEEP]),e.set("vertexAttrib1f",[]),e.set("vertexAttrib1fv",[]),e.set("vertexAttrib2f",[]),e.set("vertexAttrib2fv",[]),e.set("vertexAttrib3f",[]),e.set("vertexAttrib3fv",[]),e.set("vertexAttrib4f",[]),e.set("vertexAttrib4fv",[])}return this._defaultSettings}static _getTextureTargetIndex(e){switch(e){case 3553:return 0;case 34067:return 1;default:throw new Error("Unknown texture target: "+e)}}static _getTextureTargetByIndex(e){return this._textureTargetIndices||(this._textureTargetIndices=[3553,34067]),this._textureTargetIndices[e]}static _getTextureIndex(e){return e-33984}static _getTextureByIndex(e){return e+33984}static _getPixelStoreiIndex(e){switch(e){case 3333:return 0;case 3317:return 1;case 37440:return 2;case 37441:return 3;case 37443:return 4;case 37445:return 5;default:throw new Error("Unknown pixelstorei: "+e)}}static _getPixelStoreiByIndex(e){return this._pixelStoreiIndices||(this._pixelStoreiIndices=[3333,3317,37440,37441,37443]),this._pixelStoreiIndices[e]}static _getDefaultPixelStoreiByIndex(e){return this._pixelStoreiDefaults||(this._pixelStoreiDefaults=[4,4,!1,!1,WebGLRenderingContext.prototype.BROWSER_DEFAULT_WEBGL]),this._pixelStoreiDefaults[e]}}class Te{_initStateManager(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";this._states={},this._state=this._getState(e)}_getState(e){return this._states[e]||(this._states[e]=new we(e,this)),this._states[e]}switchState(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";if(this._state._id!==e){var t=this._getState(e);this._state.migrate(t),this._state=t}}$useProgram(e){this._state.setProgram(e)&&this._useProgram(e)}$bindBuffer(e,t){this._state.setBuffer(e,t)&&this._bindBuffer(e,t)}$bindFramebuffer(e,t){this._state.setFramebuffer(e,t)&&this._bindFramebuffer(e,t)}$bindRenderbuffer(e,t){this._state.setRenderbuffer(e,t)&&this._bindRenderbuffer(e,t)}$enable(e){this._state.setFlag(e,!0)&&this._enable(e)}$disable(e){this._state.setFlag(e,!1)&&this._disable(e)}$viewport(e,t,i,r){this._state.setSetting(this._viewport,[e,t,i,r])&&this._viewport(e,t,i,r)}$scissor(e,t,i,r){this._state.setSetting(this._scissor,[e,t,i,r])&&this._scissor(e,t,i,r)}$disableVertexAttribArray(e){this._state.disableVertexAttribArray(e)&&this._disableVertexAttribArray(e)}$enableVertexAttribArray(e){this._state.enableVertexAttribArray(e)&&this._enableVertexAttribArray(e)}$vertexAttribPointer(e,t,i,r,n,s){this._state.vertexAttribPointer(e,[t,i,r,n,s])&&this._vertexAttribPointer(e,t,i,r,n,s)}$activeTexture(e){this._state.setActiveTexture(e)&&this._activeTexture(e)}$bindTexture(e,t){this._state.bindTexture(e,t)&&this._bindTexture(e,t)}$pixelStorei(e,t){this._state.setPixelStorei(e,t)&&this._pixelStorei(e,t)}$stencilFuncSeparate(e,t,i,r){var n;switch(e){case this.FRONT:n=this._stencilFuncSeparateFront;break;case this.BACK:n=this._stencilFuncSeparateBack;break;case this.FRONT_AND_BACK:n=this._stencilFuncSeparateFrontAndBack}this._state.setSetting(n,[t,i,r])&&n.apply(this,[t,i,r])}_stencilFuncSeparateFront(e,t,i){this._stencilFuncSeparate(this.FRONT,e,t,i)}_stencilFuncSeparateBack(e,t,i){this._stencilFuncSeparate(this.BACK,e,t,i)}_stencilFuncSeparateFrontAndBack(e,t,i){this._stencilFuncSeparate(this.FRONT_AND_BACK,e,t,i)}$stencilMaskSeparate(e,t){var i;switch(e){case this.FRONT:i=this._stencilMaskSeparateFront;break;case this.BACK:i=this._stencilMaskSeparateBack;break;case this.FRONT_AND_BACK:i=this._stencilMaskSeparateFrontAndBack}this._state.setSetting(i,[t])&&i.apply(this,[t])}_stencilMaskSeparateFront(e){this._stencilMaskSeparate(this.FRONT,e)}_stencilMaskSeparateBack(e){this._stencilMaskSeparate(this.BACK,e)}_stencilMaskSeparateFrontAndBack(e){this._stencilMaskSeparate(this.FRONT_AND_BACK,e)}$stencilOpSeparate(e,t,i,r){var n;switch(e){case this.FRONT:n=this._stencilOpSeparateFront;break;case this.BACK:n=this._stencilOpSeparateBack;break;case this.FRONT_AND_BACK:n=this._stencilOpSeparateFrontAndBack}this._state.setSetting(n,[t,i,r])&&n.apply(this,[t,i,r])}_stencilOpSeparateFront(e,t,i){this._stencilOpSeparate(this.FRONT,e,t,i)}_stencilOpSeparateBack(e,t,i){this._stencilOpSeparate(this.BACK,e,t,i)}_stencilOpSeparateFrontAndBack(e,t,i){this._stencilOpSeparate(this.FRONT_AND_BACK,e,t,i)}$blendColor(e,t,i,r){this._state.setSetting(this._blendColor,[e,t,i,r])&&this._blendColor(e,t,i,r)}$blendEquation(e){this._state.setSetting(this._blendEquation,[e])&&this._blendEquation(e)}$blendEquationSeparate(e,t){this._state.setSetting(this._blendEquationSeparate,[e,t])&&this._blendEquationSeparate(e,t)}$blendFunc(e,t){this._state.setSetting(this._blendFunc,[e,t])&&this._blendFunc(e,t)}$blendFuncSeparate(e,t,i,r){this._state.setSetting(this._blendFuncSeparate,[e,t,i,r])&&this._blendFuncSeparate(e,t,i,r)}$clearColor(e,t,i,r){this._state.setSetting(this._clearColor,[e,t,i,r])&&this._clearColor(e,t,i,r)}$clearDepth(e){this._state.setSetting(this._clearDepth,[e])&&this._clearDepth(e)}$clearStencil(e){this._state.setSetting(this._clearStencil,[e])&&this._clearStencil(e)}$colorMask(e,t,i,r){this._state.setSetting(this._colorMask,[e,t,i,r])&&this._colorMask(e,t,i,r)}$cullFace(e){this._state.setSetting(this._cullFace,[e])&&this._cullFace(e)}$depthFunc(e){this._state.setSetting(this._depthFunc,[e])&&this._depthFunc(e)}$depthMask(e){this._state.setSetting(this._depthMask,[e])&&this._depthMask(e)}$depthRange(e,t){this._state.setSetting(this._depthRange,[e,t])&&this._depthRange(e,t)}$frontFace(e){this._state.setSetting(this._frontFace,[e])&&this._frontFace(e)}$lineWidth(e){this._state.setSetting(this._lineWidth,[e])&&this._lineWidth(e)}$polygonOffset(e,t){this._state.setSetting(this._polygonOffset,[e,t])&&this._polygonOffset(e,t)}$sampleCoverage(e,t){this._state.setSetting(this._sampleCoverage,[e,t])&&this._sampleCoverage(e,t)}$stencilFunc(e,t,i){this._state.setSetting(this._stencilFunc,[e,t,i])&&this._stencilFunc(e,t,i)}$stencilMask(e){this._state.setSetting(this._stencilMask,[e])&&this._stencilMask(e)}$stencilOp(e,t,i){this._state.setSetting(this._stencilOp,[e,t,i])&&this._stencilOp(e,t,i)}$vertexAttrib1f(e,t){this._state.setSetting(this._vertexAttrib1f,[e,t])&&this._vertexAttrib1f(e,t)}$vertexAttrib1fv(e,t){this._state.setSetting(this._vertexAttrib1fv,[e,t])&&this._vertexAttrib1fv(e,t)}$vertexAttrib2f(e,t,i){this._state.setSetting(this._vertexAttrib2f,[e,t,i])&&this._vertexAttrib2f(e,t,i)}$vertexAttrib2fv(e,t){this._state.setSetting(this._vertexAttrib2fv,[e,t])&&this._vertexAttrib2fv(e,t)}$vertexAttrib3f(e,t,i,r){this._state.setSetting(this._vertexAttrib3f,[e,t,i,r])&&this._vertexAttrib3f(e,t,i,r)}$vertexAttrib3fv(e,t){this._state.setSetting(this._vertexAttrib3fv,[e,t])&&this._vertexAttrib3fv(e,t)}$vertexAttrib4f(e,t,i,r,n){this._state.setSetting(this._vertexAttrib4f,[e,t,i,r,n])&&this._vertexAttrib4f(e,t,i,r,n)}$vertexAttrib4fv(e,t){this._state.setSetting(this._vertexAttrib4fv,[e,t])&&this._vertexAttrib4fv(e,t)}static enable(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default",i=Object.getOwnPropertyNames(Te.prototype);return e.__proto__,i.forEach((t=>{if("constructor"!==t){var i=Te.prototype[t];"$"===t.charAt(0)&&(t=t.substr(1)),e[t]!==i&&(e[t]&&(e[t].name||(e[t].xname=t),e["_"+t]=e[t]),e[t]=i)}})),Te.prototype._initStateManager.call(e,t),e}}class Se{constructor(e){this.stage=e,this._usedMemory=0,this._uploadedTextureSources=[],this.textureSourceHashmap=new Map}get usedMemory(){return this._usedMemory}destroy(){for(var e=0,t=this._uploadedTextureSources.length;e<t;e++)this._nativeFreeTextureSource(this._uploadedTextureSources[e]);this.textureSourceHashmap.clear(),this._usedMemory=0}getReusableTextureSource(e){return this.textureSourceHashmap.get(e)}getTextureSource(e,t){var i=t?this.textureSourceHashmap.get(t):null;return i||(i=new E(this,e),t&&(i.lookupId=t,this.textureSourceHashmap.set(t,i))),i}uploadTextureSource(e,t){if(!e.isLoaded()){this._addMemoryUsage(e.w*e.h);var i=this._nativeUploadTextureSource(e,t);e._nativeTexture=i,i.w=e.w,i.h=e.h,i.update=this.stage.frameCounter,this._uploadedTextureSources.push(e),this.addToLookupMap(e),this._updateVramUsage(e,1)}}_addMemoryUsage(e){this._usedMemory+=e,this.stage.addMemoryUsage(e)}_updateVramUsage(e,t){var i,r=e.nativeTexture;De.isWebglSupported()&&e.isLoaded()&&r.hasOwnProperty("bytesPerPixel")&&!isNaN(r.bytesPerPixel)&&(i=t*(e.w*e.h*r.bytesPerPixel),this.stage.addVramUsage(i,e.hasAlpha))}addToLookupMap(e){var t=e.lookupId;t&&(this.textureSourceHashmap.has(t)||this.textureSourceHashmap.set(t,e))}gc(){this.freeUnusedTextureSources(),this._cleanupLookupMap()}freeUnusedTextureSources(){for(var e=[],t=0,i=this._uploadedTextureSources.length;t<i;t++){var r=this._uploadedTextureSources[t];r.allowCleanup()?this._freeManagedTextureSource(r):e.push(r)}this._uploadedTextureSources=e,this._cleanupLookupMap()}_freeManagedTextureSource(e){e.isLoaded()&&(this._nativeFreeTextureSource(e),this._addMemoryUsage(-e.w*e.h),this._updateVramUsage(e,-1)),e.loadingSince=null}_cleanupLookupMap(){this.textureSourceHashmap.forEach(((e,t)=>{e.isLoaded()||e.isLoading()||e.isUsed()||this.textureSourceHashmap.delete(t)}))}freeTextureSource(e){var t=this._uploadedTextureSources.indexOf(e),i=-1!==t;e.isLoaded()&&(i&&(this._addMemoryUsage(-e.w*e.h),this._uploadedTextureSources.splice(t,1)),this._nativeFreeTextureSource(e)),e.loadingSince=null}_nativeUploadTextureSource(e,t){return this.stage.renderer.uploadTextureSource(e,t)}_nativeFreeTextureSource(e){this.stage.renderer.freeTextureSource(e),e.clearNativeTexture()}}class Ae{constructor(e){this.stage=e,this.genericCancelCb=e=>{this._remove(e)},this._sources=[],this._data=[]}destroy(){this._sources=[],this._data=[]}processSome(){if(this._sources.length){var e=Date.now();do{this._processItem()}while(this._sources.length&&Date.now()-e<Ae.MAX_UPLOAD_TIME_PER_FRAME)}}_processItem(){var e=this._sources.pop(),t=this._data.pop();e.isLoading()&&e.processLoadedSource(t)}add(e,t){this._sources.push(e),this._data.push(t)}_remove(e){var t=this._sources.indexOf(e);t>=0&&(this._sources.splice(t,1),this._data.splice(t,1))}}Ae.MAX_UPLOAD_TIME_PER_FRAME=10;class Ce{constructor(e){this.stage=e,this.root=null,this.updateTreeOrder=0,this.renderState=this.stage.renderer.createCoreRenderState(this),this.renderExec=this.stage.renderer.createCoreRenderExecutor(this),this.renderExec.init(),this._usedMemory=0,this._renderTexturePool=[],this._renderTextureId=1,this._zSorts=[],this.renderToTextureCount=0}get usedMemory(){return this._usedMemory}destroy(){this._renderTexturePool.forEach((e=>this._freeRenderTexture(e))),this._usedMemory=0}hasRenderUpdates(){return!!this.root._parent._hasRenderUpdates}render(){this.root._parent._hasRenderUpdates=0,this._render()}update(){this._update(),this.root._hasUpdates&&this._update(),this._performForcedZSorts()}_performForcedZSorts(){if(this._zSorts.length){for(var e=0,t=this._zSorts.length;e<t;e++)this._zSorts[e].zSort&&this._zSorts[e].sortZIndexedChildren();this._zSorts=[]}}_update(){this.updateTreeOrder=0,this.root.update()}_render(){var e=this.stage.getOption("debugFrame");this._fillRenderState(),this.stage.getOption("readPixelsBeforeDraw")&&this._readPixels(),this._performRender(),e&&console.log(`[Lightning] RTT Renders in frame: ${this.renderToTextureCount}`),this.stage.getOption("readPixelsAfterDraw")&&this.renderToTextureCount>=this.stage.getOption("readPixelsAfterDrawThreshold")&&(e&&console.log("[Lightning] readPixelsAfterDraw behavior triggered"),this._readPixels()),this.renderToTextureCount=0}_readPixels(){var e=new Uint8Array(4),t=this.stage.gl;t.readPixels(0,0,1,1,t.RGBA,t.UNSIGNED_BYTE,e)}_fillRenderState(){this.renderState.reset(),this.root.render(),this.renderState.finish()}_performRender(){this.renderExec.execute()}_addMemoryUsage(e){this._usedMemory+=e,this.stage.addMemoryUsage(e)}allocateRenderTexture(e,t){for(var i=this.stage.getRenderPrecision(),r=Math.max(1,Math.round(e*i)),n=Math.max(1,Math.round(t*i)),s=this._renderTexturePool.length-1;s>=0;s--){var a=this._renderTexturePool[s];if(a.w===r&&a.h===n&&a.update!==this.stage.frameCounter)return a.f=this.stage.frameCounter,this._renderTexturePool.splice(s,1),a}var o=this._createRenderTexture(e,t,r,n);return o.precision=i,o}releaseRenderTexture(e){this._renderTexturePool.push(e)}freeUnusedRenderTextures(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:60,t=this.stage.frameCounter-e;this._renderTexturePool=this._renderTexturePool.filter((e=>!(e.f<=t)||(this._freeRenderTexture(e),!1)))}_createRenderTexture(e,t,i,r){this._addMemoryUsage(i*r);var n=this.stage.renderer.createRenderTexture(e,t,i,r);return n.id=this._renderTextureId++,n.f=this.stage.frameCounter,n.ow=e,n.oh=t,n.w=i,n.h=r,n}_freeRenderTexture(e){this.stage.renderer.freeRenderTexture(e),this._addMemoryUsage(-e.w*e.h)}copyRenderTexture(e,t,i){this.stage.renderer.copyRenderTexture(e,t,i)}forceZSort(e){this._zSorts.push(e)}}class Ee{constructor(e){this.stage=e,this._timingFunction="ease",this._timingFunctionImpl=l.getTimingFunction(this._timingFunction),this.delay=0,this.duration=.2,this.merger=null}get timingFunction(){return this._timingFunction}set timingFunction(e){this._timingFunction=e,this._timingFunctionImpl=l.getTimingFunction(e)}get timingFunctionImpl(){return this._timingFunctionImpl}patch(e){d.patchObject(this,e)}}Ee.prototype.isTransitionSettings=!0;class Ie{constructor(e){this.stage=e,this.stage.on("frameStart",(()=>this.progress())),this.active=new Set,this.defaultTransitionSettings=new Ee(this.stage)}progress(){if(this.active.size){var e=this.stage.dt,t=!1;this.active.forEach((function(i){i.progress(e),i.isRunning()||(t=!0)})),t&&(this.active=new Set([...this.active].filter((e=>e.isRunning()))))}}createSettings(e){var t=new Ee;return d.patchObject(t,e),t}addActive(e){this.active.add(e)}removeActive(e){this.active.delete(e)}}class Re{constructor(){this._clear()}_clear(){this._p=[],this._pe=[],this._idp=[],this._f=[],this._v=[],this._lv=[],this._sm=[],this._s=[],this._ve=[],this._sme=[],this._se=[],this._length=0}parse(e,t){var i,r;c.isObjectLiteral(t)||(t={0:t});var n=.5,s=[];for(var a in t)if(t.hasOwnProperty(a)){var o=t[a];c.isObjectLiteral(o)||(o={v:o});var h=parseFloat(a);"sm"===a?n=o.v:!isNaN(h)&&h>=0&&h<=2&&(o.p=h,o.f=c.isFunction(o.v),o.lv=o.f?o.v(0,0):o.v,s.push(o))}for(r=(s=s.sort((function(e,t){return e.p-t.p}))).length,i=0;i<r;i++){var u=i===r-1;if(s[i].hasOwnProperty("pe")){var l=i<r-1?s[i+1].p:1;s[i].pe>l&&(s[i].pe=l)}else s[i].pe=u?s[i].p<=1?1:2:s[i+1].p;s[i].pe===s[i].p?s[i].idp=0:s[i].idp=1/(s[i].pe-s[i].p)}for(i=0;i<r;i++)if(s[i].hasOwnProperty("sm")||(s[i].sm=n),!s[i].hasOwnProperty("s"))if(0===i||i===r-1||1===s[i].p)s[i].s=e?[0,0,0,0]:0;else{var d=s[i-1],p=s[i+1];if(d.p===p.p)s[i].s=e?[0,0,0,0]:0;else if(e){var g=Re.getRgbaComponents(p.lv),f=Re.getRgbaComponents(d.lv),m=1/(p.p-d.p);s[i].s=[m*(g[0]-f[0]),m*(g[1]-f[1]),m*(g[2]-f[2]),m*(g[3]-f[3])]}else s[i].s=(p.lv-d.lv)/(p.p-d.p)}for(i=0;i<r-1;i++)if(!s[i].f){var _=i===r-1;s[i].hasOwnProperty("ve")||(s[i].ve=_?s[i].lv:s[i+1].lv),c.isNumber(s[i].v)&&c.isNumber(s[i].lv)&&(s[i].hasOwnProperty("sme")||(s[i].sme=_?n:s[i+1].sm),s[i].hasOwnProperty("se")||(s[i].se=_?e?[0,0,0,0]:0:s[i+1].s),s[i].v=e?Re.getSplineRgbaValueFunction(s[i].v,s[i].ve,s[i].p,s[i].pe,s[i].sm,s[i].sme,s[i].s,s[i].se):Re.getSplineValueFunction(s[i].v,s[i].ve,s[i].p,s[i].pe,s[i].sm,s[i].sme,s[i].s,s[i].se),s[i].f=!0)}for(this.length&&this._clear(),i=0,r=s.length;i<r;i++)this._add(s[i])}_add(e){this._p.push(e.p||0),this._pe.push(e.pe||0),this._idp.push(e.idp||0),this._f.push(e.f||!1),this._v.push(e.hasOwnProperty("v")?e.v:0),this._lv.push(e.lv||0),this._sm.push(e.sm||0),this._s.push(e.s||0),this._ve.push(e.ve||0),this._sme.push(e.sme||0),this._se.push(e.se||0),this._length++}_getItem(e){var t=this._length;if(!t)return-1;if(e<this._p[0])return 0;for(var i=0;i<t;i++)if(this._p[i]<=e&&e<this._pe[i])return i;return t-1}getValue(e){var t=this._getItem(e);if(-1!==t){if(this._f[t]){var i=Math.min(1,Math.max(0,(e-this._p[t])*this._idp[t]));return this._v[t](i)}return this._v[t]}}get length(){return this._length}static getRgbaComponents(e){return[(e/65536|0)%256,(e/256|0)%256,e%256,e/16777216|0]}static getSplineValueFunction(e,t,i,r,n,s,a,o){var h=r-i;a*=h,o*=h;var u=Re.getSplineHelpers(e,t,n,s,a,o);return u?function(i){return 0===i?e:1===i?t:Re.calculateSpline(u,i)}:function(i){return 0===i?e:1===i?t:t*i+e*(1-i)}}static getSplineRgbaValueFunction(e,t,i,r,n,s,a,o){var h=r-i;a[0]*=h,a[1]*=h,a[2]*=h,a[3]*=h,o[0]*=h,o[1]*=h,o[2]*=h,o[3]*=h;var u=Re.getRgbaComponents(e),l=Re.getRgbaComponents(t),c=[Re.getSplineHelpers(u[0],l[0],n,s,a[0],o[0]),Re.getSplineHelpers(u[1],l[1],n,s,a[1],o[1]),Re.getSplineHelpers(u[2],l[2],n,s,a[2],o[2]),Re.getSplineHelpers(u[3],l[3],n,s,a[3],o[3])];return c[0]?function(i){return 0===i?e:1===i?t:Re.getArgbNumber([Math.min(255,Re.calculateSpline(c[0],i)),Math.min(255,Re.calculateSpline(c[1],i)),Math.min(255,Re.calculateSpline(c[2],i)),Math.min(255,Re.calculateSpline(c[3],i))])}:function(i){return 0===i?e:1===i?t:Re.mergeColors(t,e,i)}}static getSplineHelpers(e,t,i,r,n,s){if(!i&&!r)return null;var a=e+n*i,o=1-r,h=t-s*r;return[3*i-3*o+1,-6*i+3*o,3*i,3*a-3*h+t-e,3*(h+e)-6*a,3*(a-e),e]}static calculateSpline(e,t){var i=e[0],r=e[1],n=e[2],s=e[3],a=e[4],o=e[5],h=e[6];if(-2===i&&-2===s&&0===n&&0===o)return t;for(var u,l=.5,c=0;c<20;c++){if((u=t-l*(l*(l*i+r)+n))>-1e-8&&u<1e-8)return l*(l*(l*s+a)+o)+h;var d=l*(l*(3*i)+2*r)+n;if(d>1e-10&&d<1e-10)break;l+=u/d}for(var p=0,g=1,f=0;f<20;f++){if((u=t-(l=.5*(p+g))*(l*(l*i+r)+n))>-1e-8&&u<1e-8)return l*(l*(l*s+a)+o)+h;u<0?g=l:p=l}return l}static mergeColors(e,t,i){var r=(e/65536|0)%256*i+(t/65536|0)%256*(1-i),n=(e/256|0)%256*i+(t/256|0)%256*(1-i),s=e%256*i+t%256*(1-i),a=(e/16777216|0)*i+(t/16777216|0)*(1-i);return 16777216*Math.round(a)+65536*Math.round(r)+256*Math.round(n)+Math.round(s)}static getArgbNumber(e){e[0]=Math.max(0,Math.min(255,e[0])),e[1]=Math.max(0,Math.min(255,e[1])),e[2]=Math.max(0,Math.min(255,e[2])),e[3]=Math.max(0,Math.min(255,e[3]));var t=((0|e[3])<<24)+((0|e[0])<<16)+((0|e[1])<<8)+(0|e[2]);return t<0&&(t=4294967295+t+1),t}}class Le{constructor(e){this.animationSettings=e,this._selector="",this._items=new Re,this._props=[],this._propSetters=[],this._resetValue=void 0,this._hasResetValue=!1,this._hasColorProperty=void 0}getResetValue(){return this._hasResetValue?this._resetValue:this._items.getValue(0)}apply(e,t,i){var r=this.getAnimatedElements(e),n=this._items.getValue(t);if(void 0!==n&&r.length){if(1!==i){var s=this.getResetValue();c.isNumber(n)&&c.isNumber(s)&&(n=this.hasColorProperty()?l.mergeColors(n,s,i):l.mergeNumbers(n,s,i))}for(var a=this._propSetters.length,o=r.length,h=0;h<o;h++)for(var u=0;u<a;u++)this._propSetters[u](r[h],n)}}getAnimatedElements(e){return e.select(this._selector)}reset(e){var t=this.getAnimatedElements(e),i=this.getResetValue();if(void 0!==i&&t.length)for(var r=this._propSetters.length,n=t.length,s=0;s<n;s++)for(var a=0;a<r;a++)this._propSetters[a](t[s],i)}set selector(e){this._selector=e}set t(e){this.selector=e}get resetValue(){return this._resetValue}set resetValue(e){this._resetValue=e,this._hasResetValue=void 0!==e}set rv(e){this.resetValue=e}set value(e){this._items.parse(this.hasColorProperty(),e)}set v(e){this.value=e}set properties(e){Array.isArray(e)||(e=[e]),this._props=[],e.forEach((e=>{this._props.push(e),this._propSetters.push(W.getSetter(e))}))}set property(e){this._hasColorProperty=void 0,this.properties=e}set p(e){this.properties=e}patch(e){d.patchObject(this,e)}hasColorProperty(){return void 0===this._hasColorProperty&&(this._hasColorProperty=!!this._props.length&&W.isColorProperty(this._props[0])),this._hasColorProperty}}Le.prototype.isAnimationActionSettings=!0;class ke{constructor(){this._actions=[],this.delay=0,this.duration=1,this.repeat=0,this.repeatOffset=0,this.repeatDelay=0,this.autostop=!1,this.stopMethod=ke.STOP_METHODS.FADE,this._stopTimingFunction="ease",this._stopTimingFunctionImpl=l.getTimingFunction(this._stopTimingFunction),this.stopDuration=0,this.stopDelay=0}get actions(){return this._actions}set actions(e){this._actions=[];for(var t=0,i=e.length;t<i;t++){var r=e[t];if(r.isAnimationActionSettings)this._actions.push(r);else{var n=new Le(this);n.patch(r),this._actions.push(n)}}}apply(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this._actions.forEach((function(r){r.apply(e,t,i)}))}reset(e){this._actions.forEach((function(t){t.reset(e)}))}get stopTimingFunction(){return this._stopTimingFunction}set stopTimingFunction(e){this._stopTimingFunction=e,this._stopTimingFunctionImpl=l.getTimingFunction(e)}get stopTimingFunctionImpl(){return this._stopTimingFunctionImpl}patch(e){d.patchObject(this,e)}}ke.STOP_METHODS={FADE:"fade",REVERSE:"reverse",FORWARD:"forward",IMMEDIATE:"immediate",ONETOTWO:"onetotwo"};class Me extends k{constructor(e,t,i){super(),this.manager=e,this._settings=t,this._element=i,this._state=Me.STATES.IDLE,this._p=0,this._delayLeft=0,this._repeatsLeft=0,this._stopDelayLeft=0,this._stopP=0}start(){this._element&&this._element.attached?(this._p=0,this._delayLeft=this.settings.delay,this._repeatsLeft=this.settings.repeat,this._state=Me.STATES.PLAYING,this.emit("start"),this.checkActive()):console.warn("[Lightning] Element must be attached before starting animation")}play(){this._state===Me.STATES.PAUSED?(this._state=Me.STATES.PLAYING,this.checkActive(),this.emit("resume")):this._state==Me.STATES.STOPPING&&this.settings.stopMethod==ke.STOP_METHODS.REVERSE?(this._state=Me.STATES.PLAYING,this.emit("stopContinue")):this._state!=Me.STATES.PLAYING&&this._state!=Me.STATES.FINISHED&&this.start()}pause(){this._state===Me.STATES.PLAYING&&(this._state=Me.STATES.PAUSED,this.emit("pause"))}replay(){this._state==Me.STATES.FINISHED?this.start():this.play()}skipDelay(){this._delayLeft=0,this._stopDelayLeft=0}finish(){this._state===Me.STATES.PLAYING?(this._delayLeft=0,this._p=1):this._state===Me.STATES.STOPPING&&(this._stopDelayLeft=0,this._p=0)}stop(){this._state!==Me.STATES.STOPPED&&this._state!==Me.STATES.IDLE&&(this._stopDelayLeft=this.settings.stopDelay||0,this.settings.stopMethod===ke.STOP_METHODS.IMMEDIATE&&!this._stopDelayLeft||this._delayLeft>0?(this._state=Me.STATES.STOPPING,this.emit("stop")):(this.settings.stopMethod===ke.STOP_METHODS.FADE&&(this._stopP=0),this._state=Me.STATES.STOPPING,this.emit("stop")),this.checkActive())}stopNow(){this._state===Me.STATES.STOPPED&&this._state===Me.STATES.IDLE||(this._state=Me.STATES.STOPPING,this._p=0,this.emit("stop"),this.reset(),this._state=Me.STATES.STOPPED,this.emit("stopFinish"))}isPaused(){return this._state===Me.STATES.PAUSED}isPlaying(){return this._state===Me.STATES.PLAYING}isStopping(){return this._state===Me.STATES.STOPPING}isFinished(){return this._state===Me.STATES.FINISHED}checkActive(){this.isActive()&&this.manager.addActive(this)}isActive(){return(this._state==Me.STATES.PLAYING||this._state==Me.STATES.STOPPING)&&this._element&&this._element.attached}progress(e){this._element&&(this._progress(e),this.apply())}_progress(e){if(this._state!=Me.STATES.STOPPING){if(this._state==Me.STATES.PLAYING){if(this._delayLeft>0){if(this._delayLeft-=e,!(this._delayLeft<0))return;e=-this._delayLeft,this._delayLeft=0,this.emit("delayEnd")}0===this.settings.duration?this._p=1:this.settings.duration>0&&(this._p+=e/this.settings.duration),this._p>=1?-1==this.settings.repeat||this._repeatsLeft>0?(this._repeatsLeft>0&&this._repeatsLeft--,this._p=this.settings.repeatOffset,this.emit("progress",this._p),this.settings.repeatDelay&&(this._delayLeft=this.settings.repeatDelay),this.emit("repeat",this._repeatsLeft)):(this._p=1,this.emit("progress",this._p),this._state=Me.STATES.FINISHED,this.emit("finish"),this.settings.autostop&&this.stop()):this.emit("progress",this._p)}}else this._stopProgress(e)}_stopProgress(e){var t=this._getStopDuration();if(this._stopDelayLeft>0){if(this._stopDelayLeft-=e,!(this._stopDelayLeft<0))return;e=-this._stopDelayLeft,this._stopDelayLeft=0,this.emit("stopDelayEnd")}this.settings.stopMethod==ke.STOP_METHODS.IMMEDIATE?(this._state=Me.STATES.STOPPED,this.emit("stopFinish")):this.settings.stopMethod==ke.STOP_METHODS.REVERSE?(0===t?this._p=0:t>0&&(this._p-=e/t),this._p<=0&&(this._p=0,this._state=Me.STATES.STOPPED,this.emit("stopFinish"))):this.settings.stopMethod==ke.STOP_METHODS.FADE?(this._progressStopTransition(e),this._stopP>=1&&(this._p=0,this._state=Me.STATES.STOPPED,this.emit("stopFinish"))):this.settings.stopMethod==ke.STOP_METHODS.ONETOTWO?this._p<2&&(0===t?this._p=2:t>0&&(this._p<1?this._p+=e/this.settings.duration:this._p+=e/t),this._p>=2?(this._p=2,this._state=Me.STATES.STOPPED,this.emit("stopFinish")):this.emit("progress",this._p)):this.settings.stopMethod==ke.STOP_METHODS.FORWARD&&this._p<1&&(0==this.settings.duration?this._p=1:this._p+=e/this.settings.duration,this._p>=1?this.settings.stopMethod==ke.STOP_METHODS.FORWARD?(this._p=1,this._state=Me.STATES.STOPPED,this.emit("stopFinish")):this._repeatsLeft>0?(this._repeatsLeft--,this._p=0,this.emit("repeat",this._repeatsLeft)):(this._p=1,this._state=Me.STATES.STOPPED,this.emit("stopFinish")):this.emit("progress",this._p))}_progressStopTransition(e){if(this._stopP<1){if(this._stopDelayLeft>0){if(this._stopDelayLeft-=e,!(this._stopDelayLeft<0))return;e=-this._stopDelayLeft,this._stopDelayLeft=0,this.emit("delayEnd")}var t=this._getStopDuration();0==t?this._stopP=1:this._stopP+=e/t,this._stopP>=1&&(this._stopP=1)}}_getStopDuration(){return this.settings.stopDuration||this.settings.duration}apply(){if(this._state===Me.STATES.STOPPED)this.reset();else{var e=1;this._state===Me.STATES.STOPPING&&this.settings.stopMethod===ke.STOP_METHODS.FADE&&(e=1-this.settings.stopTimingFunctionImpl(this._stopP)),this._settings.apply(this._element,this._p,e)}}reset(){this._settings.reset(this._element)}get state(){return this._state}get p(){return this._p}get delayLeft(){return this._delayLeft}get element(){return this._element}get frame(){return Math.round(this._p*this._settings.duration*60)}get settings(){return this._settings}}Me.STATES={IDLE:0,PLAYING:1,STOPPING:2,STOPPED:3,FINISHED:4,PAUSED:5};class Pe{constructor(e){this.stage=e,this.stage.on("frameStart",(()=>this.progress())),this.active=new Set}progress(){if(this.active.size){var e=this.stage.dt,t=!1;this.active.forEach((function(i){i.isActive()?i.progress(e):t=!0})),t&&(this.active=new Set([...this.active].filter((e=>e.isActive()))))}}createAnimation(e,t){return c.isObjectLiteral(t)&&(t=this.createSettings(t)),new Me(this,t,e)}createSettings(e){var t=new ke;return d.patchObject(t,e),t}addActive(e){this.active.add(e)}}class Oe extends P{_getLookupId(){return"__whitepix"}_getSourceLoader(){return function(e){e(null,{source:new Uint8Array([255,255,255,255]),w:1,h:1,permanent:!0})}}isAutosizeTexture(){return!1}}class De extends k{constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),this._setOptions(e),this._usedMemory=0,this._lastGcFrame=0,this._usedVramAlpha=0,this._usedVramNonAlpha=0;var t=De.platform?De.platform:xe.load(e);this.platform=new t,this.platform.init&&this.platform.init(this),this.gl=null,this.c2d=null;var i=this.getOption("context");i?i.useProgram?this.gl=i:this.c2d=i:!c.isWeb||De.isWebglSupported()&&!this.getOption("canvas2d")?this.gl=this.platform.createWebGLContext(this.getOption("w"),this.getOption("h")):this.c2d=this.platform.createCanvasContext(this.getOption("w"),this.getOption("h")),this.gl&&Te.enable(this.gl,"lightning"),this._mode=this.gl?0:1,this.getCanvas()&&(this._options.w=this.getCanvas().width,this._options.h=this.getCanvas().height),0===this._mode?c.isSpark?this._renderer=new fe(this):this._renderer=new se(this):this._renderer=new pe(this),this.setClearColor(this.getOption("clearColor")),this.frameCounter=0,this.transitions=new Ie(this),this.animations=new Pe(this),this.textureManager=new Se(this),this.textureThrottler=new Ae(this),this.startTime=0,this.currentTime=0,this.dt=0,this.rectangleTexture=new Oe(this),this.rectangleTexture.load(),this.rectangleTexture.source.permanent=!0,this.ctx=new Ce(this),this._updateSourceTextures=new Set}get renderer(){return this._renderer}static isWebglSupported(){if(c.isNode)return!0;try{return!!window.WebGLRenderingContext}catch(e){return!1}}get mode(){return this._mode}isWebgl(){return 0===this.mode}isC2d(){return 1===this.mode}getOption(e){return this._options[e]}_setOptions(e){this._options={};var t=(t,i)=>{var r=e[t];this._options[t]=void 0===r?i:r};t("canvas",null),t("context",null),t("w",1920),t("h",1080),t("srcBasePath",null),t("memoryPressure",24e6),t("bufferMemory",2e6),t("textRenderIssueMargin",0),t("fontSharp",{precision:.6666666667,fontSize:24}),t("clearColor",[0,0,0,0]),t("defaultFontFace","sans-serif"),t("fixedDt",0),t("useImageWorker",!0),t("autostart",!0),t("precision",1),t("canvas2d",!1),t("platform",null),t("readPixelsBeforeDraw",!1),t("readPixelsAfterDraw",!1),t("readPixelsAfterDrawThreshold",0),t("debugFrame",!1),t("forceTxCanvasSource",!1),t("pauseRafLoopOnIdle",!1)}setApplication(e){this.application=e}init(){this.application.getOption("debug")&&this.platform._imageWorker&&console.log("[Lightning] Using image worker!"),this.application.getOption("debug")&&this.c2d&&console.log("[Lightning] Using canvas2d renderer"),this.application.setAsRoot(),this.getOption("autostart")&&this.platform.startLoop()}destroy(){this.platform.stopLoop(),this.platform.destroy(),this.ctx.destroy(),this.textureManager.destroy(),this._renderer.destroy()}stop(){this.platform.stopLoop()}resume(){this.platform.startLoop()}get root(){return this.application}getCanvas(){return this._mode?this.c2d.canvas:this.gl.canvas}getRenderPrecision(){return this._options.precision}addUpdateSourceTexture(e){this._updatingFrame?e._performUpdateSource():this._updateSourceTextures.add(e)}removeUpdateSourceTexture(e){this._updateSourceTextures&&this._updateSourceTextures.delete(e)}hasUpdateSourceTexture(e){return this._updateSourceTextures&&this._updateSourceTextures.has(e)}_performUpdateSource(){this._updateSourceTextures.size&&(this._updateSourceTextures.forEach((e=>{e._performUpdateSource()})),this._updateSourceTextures=new Set)}_calculateDt(){this.startTime=this.currentTime,this.currentTime=this.platform.getHrTime(),this._options.fixedDt?this.dt=this._options.fixedDt:this.dt=this.startTime?.001*(this.currentTime-this.startTime):.02}updateFrame(){this._calculateDt(),this.emit("frameStart"),this._performUpdateSource(),this.emit("update")}idleFrame(){this.textureThrottler.processSome(),this.emit("frameEnd"),this.frameCounter++}renderFrame(){var e=this.ctx.hasRenderUpdates();this.textureThrottler.processSome(),e&&(this._updatingFrame=!0,this.ctx.update(),this.ctx.render(),this._updatingFrame=!1),this.platform.nextFrame(e),this.emit("frameEnd"),this.frameCounter++}isUpdatingFrame(){return this._updatingFrame}drawFrame(){this.updateFrame(),this.renderFrame()}forceRenderUpdate(){this.root&&this.root.core._parent.setHasRenderUpdates(1)}setClearColor(e){this.forceRenderUpdate(),null===e?this._clearColor=null:Array.isArray(e)?this._clearColor=e:this._clearColor=l.getRgbaComponentsNormalized(e)}getClearColor(){return this._clearColor}createElement(e){return e?this.element(e):new W(this)}createShader(e){return M.create(this,e)}element(e){return e.isElement?e:((t=e.type?new e.type(this):new W(this)).patch(e),t);var t}c(e){return this.element(e)}get w(){return this._options.w}get h(){return this._options.h}get coordsWidth(){return this.w/this._options.precision}get coordsHeight(){return this.h/this._options.precision}addMemoryUsage(e){this._usedMemory+=e,this._lastGcFrame!==this.frameCounter&&this._usedMemory>this.getOption("memoryPressure")&&(this.gc(!1),this._usedMemory>this.getOption("memoryPressure")-2e6&&this.gc(!0))}get usedMemory(){return this._usedMemory}addVramUsage(e,t){t?this._usedVramAlpha+=e:this._usedVramNonAlpha+=e}get usedVramAlpha(){return this._usedVramAlpha}get usedVramNonAlpha(){return this._usedVramNonAlpha}get usedVram(){return this._usedVramAlpha+this._usedVramNonAlpha}gc(e){if(this._lastGcFrame!==this.frameCounter){this._lastGcFrame=this.frameCounter;var t=this._usedMemory;if(this.gcTextureMemory(e),this.gcRenderTextureMemory(e),this.renderer.gc(e),this.application.getOption("debug")){console.log(`[Lightning] GC${e?"[aggressive]":""}! Frame ${this._lastGcFrame} Freed ${((t-this._usedMemory)/1e6).toFixed(2)}MP from GPU memory. Remaining: ${(this._usedMemory/1e6).toFixed(2)}MP`);var i=this._usedMemory-this.textureManager.usedMemory-this.ctx.usedMemory;console.log(`[Lightning] Textures: ${(this.textureManager.usedMemory/1e6).toFixed(2)}MP, Render Textures: ${(this.ctx.usedMemory/1e6).toFixed(2)}MP, Renderer caches: ${(i/1e6).toFixed(2)}MP`)}}}gcTextureMemory(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&this.ctx.root.visible?(this.ctx.root.visible=!1,this.textureManager.gc(),this.ctx.root.visible=!0):this.textureManager.gc()}gcRenderTextureMemory(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&this.root.visible?(this.root.visible=!1,this.ctx.freeUnusedRenderTextures(0),this.root.visible=!0):this.ctx.freeUnusedRenderTextures(0)}getDrawingCanvas(){return this.platform.getDrawingCanvas()}update(){this.ctx.update()}addServiceProvider(e){c.isSpark&&this.platform.addServiceProvider(e)}getChildrenByPosition(e,t){var i=[];return this.root.core.update(),this.root.core.collectAtCoord(e,t,i),i}}class Ne extends P{constructor(e){super(e),this._factory=void 0,this._lookupId=void 0}set content(e){var t=e.factory,i=e.lookupId,r=void 0===i?void 0:i;this._factory=t,this._lookupId=r,this._changed()}_getIsValid(){return!!this._factory}_getLookupId(){return this._lookupId}_getSourceLoader(){var e=this._factory;return t=>e(((e,i)=>{if(e)return t(e);t(null,this.stage.platform.getTextureOptionsForDrawingCanvas(i))}),this.stage)}}class Fe{static getCanvasTexture(e,t){return{type:Ne,content:{factory:e,lookupId:t}}}static getRoundRect(e,t,i,r,n,s,a){Array.isArray(i)||(i=[i,i,i,i]);var o="rect"+[e,t,r,n,s?1:0,a].concat(i).join(",");return Fe.getCanvasTexture(((o,h)=>{c.isSpark?h.platform.createRoundRect(o,h,e,t,i,r,n,s,a):o(null,this.createRoundRect(h,e,t,i,r,n,s,a))}),o)}static createRoundRect(e,t,i,r,n,s,a,o){void 0===a&&(a=!0),void 0===n&&(n=0);var h=e.platform.getDrawingCanvas(),u=h.getContext("2d");u.imageSmoothingEnabled=!0,h.width=t+n+2,h.height=i+n+2,u.beginPath();var d=.5*n+1,p=.5*n+1;return u.moveTo(d+r[0],p),u.lineTo(d+t-r[1],p),u.arcTo(d+t,p,d+t,p+r[1],r[1]),u.lineTo(d+t,p+i-r[2]),u.arcTo(d+t,p+i,d+t-r[2],p+i,r[2]),u.lineTo(d+r[3],p+i),u.arcTo(d,p+i,d,p+i-r[3],r[3]),u.lineTo(d,p+r[0]),u.arcTo(d,p,d+r[0],p,r[0]),u.closePath(),a&&(c.isNumber(o)?u.fillStyle=l.getRgbaString(o):u.fillStyle="white",u.fill()),n&&(c.isNumber(s)?u.strokeStyle=l.getRgbaString(s):u.strokeStyle="white",u.lineWidth=n,u.stroke()),h}static getShadowRect(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*r;Array.isArray(i)||(i=[i,i,i,i]);var s="shadow"+[e,t,r,n].concat(i).join(",");return Fe.getCanvasTexture(((s,a)=>{c.isSpark?a.platform.createShadowRect(s,a,e,t,i,r,n):s(null,this.createShadowRect(a,e,t,i,r,n))}),s)}static createShadowRect(e,t,i,r,n,s){var a=e.platform.getDrawingCanvas(),o=a.getContext("2d");o.imageSmoothingEnabled=!0,a.width=t+2*s,a.height=i+2*s,o.globalAlpha=.01,o.fillRect(0,0,.01,.01),o.globalAlpha=1,o.shadowColor=l.getRgbaString(4294967295),o.fillStyle=l.getRgbaString(4294967295),o.shadowBlur=n,o.shadowOffsetX=t+10+s,o.shadowOffsetY=s,o.beginPath();var h=-(t+10);return o.moveTo(h+r[0],0),o.lineTo(h+t-r[1],0),o.arcTo(h+t,0,h+t,0+r[1],r[1]),o.lineTo(h+t,0+i-r[2]),o.arcTo(h+t,0+i,h+t-r[2],0+i,r[2]),o.lineTo(h+r[3],0+i),o.arcTo(h,0+i,h,0+i-r[3],r[3]),o.lineTo(h,0+r[0]),o.arcTo(h,0,h+r[0],0,r[0]),o.closePath(),o.fill(),a}static getSvgTexture(e,t,i){var r="svg"+[t,i,e].join(",");return Fe.getCanvasTexture(((r,n)=>{c.isSpark?n.platform.createSvg(r,n,e,t,i):this.createSvg(r,n,e,t,i)}),r)}static createSvg(e,t,i,r,n){var s=t.platform.getDrawingCanvas(),a=s.getContext("2d");a.imageSmoothingEnabled=!0;var o=new Image;o.onload=()=>{s.width=r,s.height=n,a.drawImage(o,0,0,s.width,s.height),e(null,s)},o.onError=t=>{e(t)},c.isPS4||(o.crossOrigin="Anonymous"),o.src=i}}class Ue{static isMf(e){return c.isFunction(e)&&e.__mf}static mf(e){return e.__mf=!0,e}static merge(e,t){var i=Object.keys(e),r=Object.keys(t);if(!r.length)return e;for(var n={},s={},a=0,o=r.length;a<o;a++){var h=r[a];n[h]=-1,s[h]=a}for(var u=0,l=i.length;u<l;u++){var d=i[u];n[d]=u,void 0===s[d]&&(s[d]=-1)}for(var p=i.length,g={},f=0,m=r.length;f<m;f++){for(var _=r[f],v=n[_],y=v;--y>=0;){if(-1!==s[i[y]])break}for(;++y<v;){var x=i[y];g[x]=e[x]}var b=t[_],w=e[_],T=void 0;void 0!==(T=this.isMf(b)?b(w):c.isObjectLiteral(w)&&c.isObjectLiteral(b)?Ue.merge(w,b):b)&&(g[_]=T)}for(var S=p;--S>=0;){if(-1!==s[i[S]])break}for(;++S<p;){var A=i[S];g[A]=e[A]}return g}}class ze extends H{constructor(e){super(),this._target=e}onAdd(e,t){this._target.addAt(e,t)}onRemove(e,t){this._target.removeAt(t)}onSync(e,t,i){this._target._setByArray(i)}onSet(e,t){this._target.setAt(e,t)}onMove(e,t,i){this._target.setAt(e,i)}createItem(e){return this._target.createItem(e)}isItem(e){return this._target.isItem(e)}}class Be extends ze{constructor(e,t){super(e),this._wrap=t}wrap(e){var t=this._wrap(e);return e._wrapper=t,t}onAdd(e,t){e=this.wrap(e),super.onAdd(e,t)}onRemove(e,t){super.onRemove(e,t)}onSync(e,t,i){t.forEach((e=>this.wrap(e))),i=i.map((e=>e._wrapper)),super.onSync(e,t,i)}onSet(e,t){e=this.wrap(e),super.onSet(e,t)}onMove(e,t,i){super.onMove(e,t,i)}}class je extends P{_getLookupId(){return"__noise"}_getSourceLoader(){var e=this.stage.gl;return function(t){for(var i=new Uint8Array(65536),r=0;r<65536;r+=4){var n=Math.floor(256*Math.random());i[r]=n,i[r+1]=n,i[r+2]=n,i[r+3]=255}var s={};e&&(s[e.TEXTURE_WRAP_S]=e.REPEAT,s[e.TEXTURE_WRAP_T]=e.REPEAT,s[e.TEXTURE_MIN_FILTER]=e.NEAREST,s[e.TEXTURE_MAG_FILTER]=e.NEAREST),t(null,{source:i,w:128,h:128,texParams:s})}}}class He extends P{constructor(e){super(e),this._htmlElement=void 0,this._scale=1}set htmlElement(e){this._htmlElement=e,this._changed()}get htmlElement(){return this._htmlElement}set scale(e){this._scale=e,this._changed()}get scale(){return this._scale}set html(e){if(e){var t=document.createElement("div");t.innerHTML="<div>"+e+"</div>",this.htmlElement=t.firstElementChild}else this.htmlElement=void 0}get html(){return this._htmlElement.innerHTML}_getIsValid(){return this.htmlElement}_getLookupId(){return this._scale+":"+this._htmlElement.innerHTML}_getSourceLoader(){var e=this._htmlElement,t=this._scale;return function(i){if(!window.html2canvas)return i(new Error("Please include html2canvas (https://html2canvas.hertzen.com/)"));var r=He.getPreloadArea();r.appendChild(e),html2canvas(e,{backgroundColor:null,scale:t}).then((function(t){if(r.removeChild(e),0===t.height)return i(new Error("Canvas height is 0"));i(null,{source:t,width:t.width,height:t.height})})).catch((e=>{console.error("[Lightning]",e)}))}}static getPreloadArea(){return this._preloadArea||(this._preloadArea=document.createElement("div"),this._preloadArea.attachShadow&&this._preloadArea.attachShadow({mode:"closed"}),this._preloadArea.style.opacity=0,this._preloadArea.style.pointerEvents="none",this._preloadArea.style.position="fixed",this._preloadArea.style.display="block",this._preloadArea.style.top="100vh",this._preloadArea.style.overflow="hidden",document.body.appendChild(this._preloadArea)),this._preloadArea}}class Ve extends Be{constructor(e){super(e._wrapper._children,(e=>{var t=e.stage.createElement();return t.add(e),t.visible=!1,t})),this.list=e}onAdd(e,t){super.onAdd(e,t),this.checkStarted(t)}checkStarted(e){this.list._reloadVisibleElements=!0,this.list._started?(1===this.list.length?this.list.setIndex(0,!0,!0):this.list._index>=this.list.length&&this.list.setIndex(0),this.list.update()):this.list.start()}onRemove(e,t){super.onRemove(e,t);var i=this.list.realIndex;i===t?(i===this.list.length&&i--,i>=0&&this.list.setIndex(i)):i>t&&this.list.setIndex(i-1),this.list._reloadVisibleElements=!0}onSet(e,t){super.onSet(e,t),this.checkStarted(t)}onSync(e,t,i){super.onSync(e,t,i),this.checkStarted(0)}get _signalProxy(){return!0}}class We extends re{constructor(e){super(e),this._direction=new Float32Array([1,0]),this._kernelRadius=1}get x(){return this._direction[0]}set x(e){this._direction[0]=e,this.redraw()}get y(){return this._direction[1]}set y(e){this._direction[1]=e,this.redraw()}get kernelRadius(){return this._kernelRadius}set kernelRadius(e){this._kernelRadius=e,this.redraw()}useDefault(){return 0===this._kernelRadius}setupUniforms(e){super.setupUniforms(e),this._setUniform("direction",this._direction,this.gl.uniform2fv),this._setUniform("kernelRadius",this._kernelRadius,this.gl.uniform1i);var t=e.getRenderWidth(),i=e.getRenderHeight();this._setUniform("resolution",new Float32Array([t,i]),this.gl.uniform2fv)}}We.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    uniform vec2 resolution;\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    uniform vec2 direction;\n    uniform int kernelRadius;\n    \n    vec4 blur1(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n        vec4 color = vec4(0.0);\n        vec2 off1 = vec2(1.3333333333333333) * direction;\n        color += texture2D(image, uv) * 0.29411764705882354;\n        color += texture2D(image, uv + (off1 / resolution)) * 0.35294117647058826;\n        color += texture2D(image, uv - (off1 / resolution)) * 0.35294117647058826;\n        return color; \n    }\n    \n    vec4 blur2(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n        vec4 color = vec4(0.0);\n        vec2 off1 = vec2(1.3846153846) * direction;\n        vec2 off2 = vec2(3.2307692308) * direction;\n        color += texture2D(image, uv) * 0.2270270270;\n        color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\n        color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\n        color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\n        color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\n        return color;\n    }\n    \n    vec4 blur3(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n        vec4 color = vec4(0.0);\n        vec2 off1 = vec2(1.411764705882353) * direction;\n        vec2 off2 = vec2(3.2941176470588234) * direction;\n        vec2 off3 = vec2(5.176470588235294) * direction;\n        color += texture2D(image, uv) * 0.1964825501511404;\n        color += texture2D(image, uv + (off1 / resolution)) * 0.2969069646728344;\n        color += texture2D(image, uv - (off1 / resolution)) * 0.2969069646728344;\n        color += texture2D(image, uv + (off2 / resolution)) * 0.09447039785044732;\n        color += texture2D(image, uv - (off2 / resolution)) * 0.09447039785044732;\n        color += texture2D(image, uv + (off3 / resolution)) * 0.010381362401148057;\n        color += texture2D(image, uv - (off3 / resolution)) * 0.010381362401148057;\n        return color;\n    }    \n\n    void main(void){\n        if (kernelRadius == 1) {\n            gl_FragColor = blur1(uSampler, vTextureCoord, resolution, direction) * vColor;\n        } else if (kernelRadius == 2) {\n            gl_FragColor = blur2(uSampler, vTextureCoord, resolution, direction) * vColor;\n        } else {\n            gl_FragColor = blur3(uSampler, vTextureCoord, resolution, direction) * vColor;\n        }\n    }\n";class Ge extends re{setupUniforms(e){super.setupUniforms(e);var t=1/e.getTextureWidth(0),i=1/e.getTextureHeight(0);this._setUniform("stepTextureCoord",new Float32Array([t,i]),this.gl.uniform2fv)}}Ge.vertexShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    uniform vec2 stepTextureCoord;\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec4 aColor;\n    uniform vec2 projection;\n    varying vec4 vColor;\n    varying vec2 vTextureCoordUl;\n    varying vec2 vTextureCoordUr;\n    varying vec2 vTextureCoordBl;\n    varying vec2 vTextureCoordBr;\n    void main(void){\n        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);\n        vTextureCoordUl = aTextureCoord - stepTextureCoord;\n        vTextureCoordBr = aTextureCoord + stepTextureCoord;\n        vTextureCoordUr = vec2(vTextureCoordBr.x, vTextureCoordUl.y);\n        vTextureCoordBl = vec2(vTextureCoordUl.x, vTextureCoordBr.y);\n        vColor = aColor;\n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n",Ge.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoordUl;\n    varying vec2 vTextureCoordUr;\n    varying vec2 vTextureCoordBl;\n    varying vec2 vTextureCoordBr;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    void main(void){\n        vec4 color = 0.25 * (texture2D(uSampler, vTextureCoordUl) + texture2D(uSampler, vTextureCoordUr) + texture2D(uSampler, vTextureCoordBl) + texture2D(uSampler, vTextureCoordBr));\n        gl_FragColor = color * vColor;\n    }\n";class Xe extends le{constructor(e){super(e),this._kernelRadius=1}get kernelRadius(){return this._kernelRadius}set kernelRadius(e){this._kernelRadius=e,this.redraw()}useDefault(){return 0===this._amount}_beforeDrawEl(e){e.target.ctx.filter="blur("+this._kernelRadius+"px)"}_afterDrawEl(e){e.target.ctx.filter="none"}}class qe extends q{static _template(){return{forceZIndexContext:!0,rtt:!0,Textwrap:{shader:{type:Xe},Content:{}}}}constructor(e){super(e),this._textwrap=this.sel("Textwrap"),this._wrapper=this.sel("Textwrap>Content"),this._amount=0,this._paddingX=0,this._paddingY=0}static getSpline(){return this._multiSpline||(this._multiSpline=new Re,this._multiSpline.parse(!1,{0:0,.25:1.5,.5:5.5,.75:18,1:39})),this._multiSpline}get content(){return this.sel("Textwrap>Content")}set content(e){this.sel("Textwrap>Content").patch(e,!0)}set padding(e){this._paddingX=e,this._paddingY=e,this._updateBlurSize()}set paddingX(e){this._paddingX=e,this._updateBlurSize()}set paddingY(e){this._paddingY=e,this._updateBlurSize()}_updateBlurSize(){var e=this.renderWidth,t=this.renderHeight,i=this._paddingX,r=this._paddingY;this._wrapper.x=i,this._textwrap.x=-i,this._wrapper.y=r,this._textwrap.y=-r,this._textwrap.w=e+2*i,this._textwrap.h=t+2*r}get amount(){return this._amount}set amount(e){this._amount=e,this._textwrap.shader.kernelRadius=qe._amountToKernelRadius(e)}static _amountToKernelRadius(e){return qe.getSpline().getValue(Math.min(1,.25*e))}get _signalProxy(){return!0}}class Ye extends q{static _template(){var e=function(e,t){if(130&t._recalc){var i=t.w,r=t.h,n=t;do{(n=n._children[0])._element.w=i,n._element.h=r}while(n._children)}};return{Textwrap:{rtt:!0,forceZIndexContext:!0,renderOffscreen:!0,Content:{}},Layers:{L0:{rtt:!0,onUpdate:e,renderOffscreen:!0,visible:!1,Content:{shader:{type:Ge}}},L1:{rtt:!0,onUpdate:e,renderOffscreen:!0,visible:!1,Content:{shader:{type:Ge}}},L2:{rtt:!0,onUpdate:e,renderOffscreen:!0,visible:!1,Content:{shader:{type:Ge}}},L3:{rtt:!0,onUpdate:e,renderOffscreen:!0,visible:!1,Content:{shader:{type:Ge}}}},Result:{shader:{type:$e},visible:!1}}}get _signalProxy(){return!0}constructor(e){super(e),this._textwrap=this.sel("Textwrap"),this._wrapper=this.sel("Textwrap>Content"),this._layers=this.sel("Layers"),this._output=this.sel("Result"),this._amount=0,this._paddingX=0,this._paddingY=0}_buildLayers(){var e=[{x:1,y:0,kernelRadius:1},{x:0,y:1,kernelRadius:1},{x:1.5,y:0,kernelRadius:1},{x:0,y:1.5,kernelRadius:1}].map((e=>M.create(this.stage,Object.assign({type:We},e))));this._setLayerTexture(this.getLayerContents(0),this._textwrap.getTexture(),[]),this._setLayerTexture(this.getLayerContents(1),this.getLayer(0).getTexture(),[e[0],e[1]]),this._setLayerTexture(this.getLayerContents(2),this.getLayer(1).getTexture(),[e[0],e[1],e[2],e[3]]),this._setLayerTexture(this.getLayerContents(3),this.getLayer(2).getTexture(),[e[0],e[1],e[2],e[3]])}_setLayerTexture(e,t,i){if(i.length){var r=i.pop(),n=e.stage.c({rtt:!0,shader:r});this._setLayerTexture(n,t,i),e.childList.add(n)}else e.texture=t;return e}get content(){return this.sel("Textwrap>Content")}set content(e){this.sel("Textwrap>Content").patch(e,!0)}set padding(e){this._paddingX=e,this._paddingY=e,this._updateBlurSize()}set paddingX(e){this._paddingX=e,this._updateBlurSize()}set paddingY(e){this._paddingY=e,this._updateBlurSize()}getLayer(e){return this._layers.sel("L"+e)}getLayerContents(e){return this.getLayer(e).sel("Content")}_onResize(){this._updateBlurSize()}_updateBlurSize(){var e=this.renderWidth,t=this.renderHeight,i=this._paddingX,r=this._paddingY,n=e+2*i,s=t+2*r;this._textwrap.w=n,this._wrapper.x=i,this.getLayer(0).w=this.getLayerContents(0).w=n/2,this.getLayer(1).w=this.getLayerContents(1).w=n/4,this.getLayer(2).w=this.getLayerContents(2).w=n/8,this.getLayer(3).w=this.getLayerContents(3).w=n/16,this._output.x=-i,this._textwrap.x=-i,this._output.w=n,this._textwrap.h=s,this._wrapper.y=r,this.getLayer(0).h=this.getLayerContents(0).h=s/2,this.getLayer(1).h=this.getLayerContents(1).h=s/4,this.getLayer(2).h=this.getLayerContents(2).h=s/8,this.getLayer(3).h=this.getLayerContents(3).h=s/16,this._output.y=-r,this._textwrap.y=-r,this._output.h=s,this.w=e,this.h=t}set amount(e){this._amount=e,this._update()}get amount(){return this._amount}_update(){var e=Math.min(4,Math.max(0,this._amount));0===e?(this._textwrap.renderToTexture=!1,this._output.shader.otherTextureSource=null,this._output.visible=!1):(this._textwrap.renderToTexture=!0,this._output.visible=!0,this.getLayer(0).visible=e>0,this.getLayer(1).visible=e>1,this.getLayer(2).visible=e>2,this.getLayer(3).visible=e>3,e<=1?(this._output.texture=this._textwrap.getTexture(),this._output.shader.otherTextureSource=this.getLayer(0).getTexture(),this._output.shader.a=e):e<=2?(this._output.texture=this.getLayer(0).getTexture(),this._output.shader.otherTextureSource=this.getLayer(1).getTexture(),this._output.shader.a=e-1):e<=3?(this._output.texture=this.getLayer(1).getTexture(),this._output.shader.otherTextureSource=this.getLayer(2).getTexture(),this._output.shader.a=e-2):e<=4&&(this._output.texture=this.getLayer(2).getTexture(),this._output.shader.otherTextureSource=this.getLayer(3).getTexture(),this._output.shader.a=e-3))}set shader(e){super.shader=e,this.renderToTexture||console.warn("[Lightning] Please enable renderToTexture to use with a shader.")}_firstActive(){this._buildLayers()}}class $e extends re{constructor(e){super(e),this._a=0,this._otherTextureSource=null}get a(){return this._a}set a(e){this._a=e,this.redraw()}set otherTextureSource(e){this._otherTextureSource=e,this.redraw()}setupUniforms(e){super.setupUniforms(e),this._setUniform("a",this._a,this.gl.uniform1f),this._setUniform("uSampler2",1,this.gl.uniform1i)}beforeDraw(e){var t=this._otherTextureSource?this._otherTextureSource.nativeTexture:null,i=this.gl;i.activeTexture(i.TEXTURE1),i.bindTexture(i.TEXTURE_2D,t),i.activeTexture(i.TEXTURE0)}}$e.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    uniform sampler2D uSampler2;\n    uniform float a;\n    void main(void){\n        if (a == 1.0) {\n            gl_FragColor = texture2D(uSampler2, vTextureCoord) * vColor;\n        } else {\n            gl_FragColor = ((1.0 - a) * texture2D(uSampler, vTextureCoord) + (a * texture2D(uSampler2, vTextureCoord))) * vColor;\n        }\n    }\n";class Ke extends re{}Ke.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    void main(void){\n        vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n        float m = max(max(color.r, color.g), color.b);\n        float c = max(0.0, (m - 0.80)) * 5.0;\n        color = color * c;\n        gl_FragColor = color;\n    }\n";class Ze extends q{static _template(){return{ContentWrap:{renderOffscreen:!0,forceZIndexContext:!0,onAfterUpdate:Ze._updateDimensions,Content:{}},Scale:{visible:!1}}}constructor(e){super(e),this._smoothScale=1,this._iterations=0}get content(){return this.tag("Content")}set content(e){this.tag("Content").patch(e,!0)}get smoothScale(){return this._smoothScale}set smoothScale(e){if(this._smoothScale!==e){for(var t=0;e<.5&&t<12;)t++,e*=2;this.scale=e,this._setIterations(t),this._smoothScale=e}}_setIterations(e){if(this._iterations!==e){for(var t=this.sel("Scale").childList,i=this.sel("ContentWrap");t.length<e;){var r=0===t.length?i.getTexture():t.last.getTexture();t.a({rtt:!0,renderOffscreen:!0,texture:r})}Ze._updateDimensions(this.tag("ContentWrap"),!0);var n=e>0;this.patch({ContentWrap:{renderToTexture:n},Scale:{visible:n}});for(var s=0,a=t.length;s<a;s++)t.getAt(s).patch({visible:s<e,renderOffscreen:s!==e-1});this._iterations=e}}static _updateDimensions(e,t){var i=e.children[0],r=i.renderWidth,n=i.renderHeight;if(r!==e.w||n!==e.h||t){e.w=r,e.h=n;for(var s=e.parent.tag("Scale").children,a=0,o=s.length;a<o;a++)r*=.5,n*=.5,s[a].w=r,s[a].h=n}}get _signalProxy(){return!0}}class Qe extends re{constructor(e){super(e),this._amount=1}static getC2d(){return Je}set amount(e){this._amount=e,this.redraw()}get amount(){return this._amount}useDefault(){return 0===this._amount}setupUniforms(e){super.setupUniforms(e),this._setUniform("amount",this._amount,this.gl.uniform1f)}}Qe.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    uniform float amount;\n    void main(void){\n        vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n        float grayness = 0.2 * color.r + 0.6 * color.g + 0.2 * color.b;\n        gl_FragColor = vec4(amount * vec3(grayness, grayness, grayness) + (1.0 - amount) * color.rgb, color.a);\n    }\n";class Je extends le{constructor(e){super(e),this._amount=1}static getWebGL(){return Qe}set amount(e){this._amount=e,this.redraw()}get amount(){return this._amount}useDefault(){return 0===this._amount}_beforeDrawEl(e){e.target.ctx.filter="grayscale("+this._amount+")"}_afterDrawEl(e){e.target.ctx.filter="none"}}class et extends re{constructor(e){super(e),this._noiseTexture=new je(e.stage),this._graining=1/256,this._random=!1}set graining(e){this._graining=e,this.redraw()}set random(e){this._random=e,this.redraw()}setExtraAttribsInBuffer(e){this._noiseTexture.load();for(var t=e.extraAttribsDataByteOffset/4,i=e.quads.floats,r=e.length,n=0;n<r;n++){var s=e.getElementWidth(n)/this._noiseTexture.getRenderWidth(),a=e.getElementHeight(n)/this._noiseTexture.getRenderHeight(),o=0,h=0;if(this._random){if(s+=o=Math.random(),a+=h=Math.random(),Math.random()<.5){var u=o;o=s,s=u}if(Math.random()<.5){var l=h;h=a,a=l}}i[t]=o,i[t+1]=h,i[t+2]=s,i[t+3]=h,i[t+4]=s,i[t+5]=a,i[t+6]=o,i[t+7]=a,t+=8}}beforeDraw(e){var t=this.gl;t.vertexAttribPointer(this._attrib("aNoiseTextureCoord"),2,t.FLOAT,!1,8,this.getVertexAttribPointerOffset(e));var i=this._noiseTexture.source.nativeTexture;t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,i),t.activeTexture(t.TEXTURE0)}getExtraAttribBytesPerVertex(){return 8}setupUniforms(e){super.setupUniforms(e),this._setUniform("uNoiseSampler",1,this.gl.uniform1i),this._setUniform("graining",2*this._graining,this.gl.uniform1f)}enableAttribs(){super.enableAttribs(),this.gl.enableVertexAttribArray(this._attrib("aNoiseTextureCoord"))}disableAttribs(){super.disableAttribs(),this.gl.disableVertexAttribArray(this._attrib("aNoiseTextureCoord"))}useDefault(){return 0===this._graining}afterDraw(e){this._random&&this.redraw()}}et.vertexShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec2 aNoiseTextureCoord;\n    attribute vec4 aColor;\n    uniform vec2 projection;\n    varying vec2 vTextureCoord;\n    varying vec2 vNoiseTextureCoord;\n    varying vec4 vColor;\n    void main(void){\n        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);\n        vTextureCoord = aTextureCoord;\n        vNoiseTextureCoord = aNoiseTextureCoord;\n        vColor = aColor;\n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n",et.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec2 vNoiseTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    uniform sampler2D uNoiseSampler;\n    uniform float graining;\n    void main(void){\n        vec4 noise = texture2D(uNoiseSampler, vNoiseTextureCoord);\n        vec4 color = texture2D(uSampler, vTextureCoord);\n        gl_FragColor = (color * vColor) + graining * (noise.r - 0.5);\n    }\n";class tt extends re{constructor(e){super(e),this._inputValue=0,this._maxDerivative=.01,this._normalizedValue=0,this._offset=0,this._amount=.1,this._aspectRatio=1,this._offsetX=0,this._offsetY=0,this.buckets=100}get aspectRatio(){return this._aspectRatio}set aspectRatio(e){this._aspectRatio=e,this.redraw()}get offsetX(){return this._offsetX}set offsetX(e){this._offsetX=e,this.redraw()}get offsetY(){return this._offsetY}set offsetY(e){this._offsetY=e,this.redraw()}set amount(e){this._amount=e,this.redraw()}get amount(){return this._amount}set inputValue(e){this._inputValue=e}get inputValue(){return this._inputValue}set maxDerivative(e){this._maxDerivative=e}get maxDerivative(){return this._maxDerivative}set buckets(e){e>100&&(console.warn("[Lightning] CircularPushShader: supports max 100 buckets"),e=100),this._buckets=e,this._values=new Uint8Array(this._getValues(e)),this.redraw()}get buckets(){return this._buckets}_getValues(e){for(var t=[],i=0;i<e;i++)t.push(this._inputValue);return t}progress(e){this._offset+=e*this._buckets;var t=Math.floor(this._offset);this._offset-=t,this._shiftBuckets(t),this.redraw()}_shiftBuckets(e){for(var t=this._buckets-1;t>=0;t--){var i=t-e;i<0?(this._normalizedValue=Math.min(this._normalizedValue+this._maxDerivative,Math.max(this._normalizedValue-this._maxDerivative,this._inputValue)),this._values[t]=255*this._normalizedValue):this._values[t]=this._values[i]}}set offset(e){this._offset=e,this.redraw()}setupUniforms(e){super.setupUniforms(e),this._setUniform("aspectRatio",this._aspectRatio,this.gl.uniform1f),this._setUniform("offsetX",this._offsetX,this.gl.uniform1f),this._setUniform("offsetY",this._offsetY,this.gl.uniform1f),this._setUniform("amount",this._amount,this.gl.uniform1f),this._setUniform("offset",this._offset,this.gl.uniform1f),this._setUniform("buckets",this._buckets,this.gl.uniform1f),this._setUniform("uValueSampler",1,this.gl.uniform1i)}useDefault(){return 0===this._amount}beforeDraw(e){var t=this.gl;t.activeTexture(t.TEXTURE1),this._valuesTexture?t.bindTexture(t.TEXTURE_2D,this._valuesTexture):(this._valuesTexture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this._valuesTexture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),c.isNode&&t.pixelStorei(t.UNPACK_FLIP_BLUE_RED,!1),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1)),t.texImage2D(t.TEXTURE_2D,0,t.ALPHA,this._buckets,1,0,t.ALPHA,t.UNSIGNED_BYTE,this._values),t.activeTexture(t.TEXTURE0)}cleanup(){this._valuesTexture&&this.gl.deleteTexture(this._valuesTexture)}}tt.vertexShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec4 aColor;\n    uniform vec2 projection;\n    uniform float offsetX;\n    uniform float offsetY;\n    uniform float aspectRatio;\n    varying vec2 vTextureCoord;\n    varying vec2 vPos;\n    varying vec4 vColor;\n    void main(void){\n        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);\n        vTextureCoord = aTextureCoord;\n        vPos = vTextureCoord * 2.0 - 1.0;\n        vPos.y = vPos.y * aspectRatio;\n        vPos.y = vPos.y + offsetY;\n        vPos.x = vPos.x + offsetX;\n        vColor = aColor;\n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n",tt.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    varying vec2 vPos;\n    uniform float amount;\n    uniform float offset;\n    uniform float values[100];\n    uniform float buckets;\n    uniform sampler2D uSampler;\n    uniform sampler2D uValueSampler;\n    void main(void){\n        float l = length(vPos);\n        float m = (l * buckets * 0.678 - offset) / buckets;\n        float f = texture2D(uValueSampler, vec2(m, 0.0)).a * amount;\n        vec2 unit = vPos / l;\n        gl_FragColor = texture2D(uSampler, vTextureCoord - f * unit) * vColor;\n    }\n";class it extends re{constructor(e){super(e),this._amount=1}set amount(e){this._amount=e,this.redraw()}get amount(){return this._amount}useDefault(){return 0===this._amount}setupUniforms(e){super.setupUniforms(e),this._setUniform("amount",this._amount,this.gl.uniform1f)}}it.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    uniform float amount;\n    void main(void){\n        vec4 color = texture2D(uSampler, vTextureCoord);\n        color.rgb = color.rgb * (1.0 - amount) + amount * (1.0 * color.a - color.rgb); \n        gl_FragColor = color * vColor;\n    }\n";class rt extends re{constructor(e){super(e),this._width=5,this._col=4294967295,this._color=[1,1,1,1]}set width(e){this._width=e,this.redraw()}get color(){return this._col}set color(e){if(this._col!==e){var t=l.getRgbaComponentsNormalized(e);t[0]=t[0]*t[3],t[1]=t[1]*t[3],t[2]=t[2]*t[3],this._color=t,this.redraw(),this._col=e}}useDefault(){return 0===this._width||0===this._col[3]}setupUniforms(e){super.setupUniforms(e);var t=this.gl;this._setUniform("color",new Float32Array(this._color),t.uniform4fv)}enableAttribs(){super.enableAttribs(),this.gl.enableVertexAttribArray(this._attrib("aCorner"))}disableAttribs(){super.disableAttribs(),this.gl.disableVertexAttribArray(this._attrib("aCorner"))}setExtraAttribsInBuffer(e){for(var t=e.extraAttribsDataByteOffset/4,i=e.quads.floats,r=e.length,n=0;n<r;n++){var s=e.getElementCore(n),a=this._width/s.w,o=a/(1-2*a),h=this._width/s.h,u=h/(1-2*h);i[t]=-o,i[t+1]=-u,i[t+2]=1+o,i[t+3]=-u,i[t+4]=1+o,i[t+5]=1+u,i[t+6]=-o,i[t+7]=1+u,t+=8}}beforeDraw(e){var t=this.gl;t.vertexAttribPointer(this._attrib("aCorner"),2,t.FLOAT,!1,8,this.getVertexAttribPointerOffset(e))}getExtraAttribBytesPerVertex(){return 8}}rt.vertexShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec4 aColor;\n    attribute vec2 aCorner;\n    uniform vec2 projection;\n    varying vec2 vTextureCoord;\n    varying vec2 vCorner;\n    varying vec4 vColor;\n    void main(void){\n        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);\n        vTextureCoord = aTextureCoord;\n        vCorner = aCorner;\n        vColor = aColor;\n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n",rt.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    varying vec2 vCorner;\n    uniform vec4 color;\n    uniform sampler2D uSampler;\n    void main(void){\n        vec2 m = min(vCorner, 1.0 - vCorner);\n        float value = step(0.0, min(m.x, m.y));\n        gl_FragColor = mix(color, texture2D(uSampler, vTextureCoord) * vColor, value);\n    }\n";class nt extends re{constructor(e){super(e),this._size=new Float32Array([4,4])}get x(){return this._size[0]}set x(e){this._size[0]=e,this.redraw()}get y(){return this._size[1]}set y(e){this._size[1]=e,this.redraw()}get size(){return this._size[0]}set size(e){this._size[0]=e,this._size[1]=e,this.redraw()}useDefault(){return 0===this._size[0]&&0===this._size[1]}static getWebGLImpl(){return WebGLPixelateShaderImpl}setupUniforms(e){super.setupUniforms(e);var t=this.gl;this._setUniform("size",new Float32Array(this._size),t.uniform2fv)}getExtraAttribBytesPerVertex(){return 8}enableAttribs(){super.enableAttribs(),this.gl.enableVertexAttribArray(this._attrib("aTextureRes"))}disableAttribs(){super.disableAttribs(),this.gl.disableVertexAttribArray(this._attrib("aTextureRes"))}setExtraAttribsInBuffer(e){for(var t=e.extraAttribsDataByteOffset/4,i=e.quads.floats,r=e.length,n=0;n<r;n++){var s=e.quads.getTextureWidth(e.index+n),a=e.quads.getTextureHeight(e.index+n);i[t]=s,i[t+1]=a,i[t+2]=s,i[t+3]=a,i[t+4]=s,i[t+5]=a,i[t+6]=s,i[t+7]=a,t+=8}}beforeDraw(e){var t=this.gl;t.vertexAttribPointer(this._attrib("aTextureRes"),2,t.FLOAT,!1,this.getExtraAttribBytesPerVertex(),this.getVertexAttribPointerOffset(e))}}nt.vertexShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec4 aColor;\n    attribute vec2 aTextureRes;\n    uniform vec2 projection;\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    varying vec2 vTextureRes;\n    void main(void){\n        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);\n        vTextureCoord = aTextureCoord;\n        vColor = aColor;\n        vTextureRes = aTextureRes;\n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n",nt.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    varying vec2 vTextureRes;\n\n    uniform vec2 size;\n    uniform sampler2D uSampler;\n    \n    vec2 mapCoord( vec2 coord )\n    {\n        coord *= vTextureRes.xy;\n        return coord;\n    }\n    \n    vec2 unmapCoord( vec2 coord )\n    {\n        coord /= vTextureRes.xy;\n        return coord;\n    }\n    \n    vec2 pixelate(vec2 coord, vec2 size)\n    {\n        return floor( coord / size ) * size;\n    }\n    \n    void main(void)\n    {\n        vec2 coord = mapCoord(vTextureCoord);\n        coord = pixelate(coord, size);\n        coord = unmapCoord(coord);\n        gl_FragColor = texture2D(uSampler, coord) * vColor;\n    }\n";class st extends re{constructor(e){super(e),this._radius=0,this._cutoff=1}set radius(e){this._radius=e,this.redraw()}get radius(){return this._radius}set cutoff(e){this._cutoff=e,this.redraw()}get cutoff(){return this._cutoff}useDefault(){return 0===this._radius}setupUniforms(e){super.setupUniforms(e),this._setUniform("radius",2*(this._radius-.5)/e.getRenderWidth(),this.gl.uniform1f),this._setUniform("cutoff",.5*e.getRenderWidth()/this._cutoff,this.gl.uniform1f)}}st.vertexShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec4 aColor;\n    uniform vec2 projection;\n    varying vec2 pos;\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    void main(void){\n        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);\n        vTextureCoord = aTextureCoord;\n        vColor = aColor;\n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n        pos = gl_Position.xy;\n    }\n",st.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec2 pos;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    uniform float radius;\n    uniform float cutoff;\n    void main(void){\n        vec4 color = texture2D(uSampler, vTextureCoord);\n        float f = max(0.0, min(1.0, 1.0 - (length(pos) - radius) * cutoff));\n        gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor * f;\n    }\n";class at extends re{constructor(e){super(e),this._blend=0,this._radius=[1,1,1,1],this._stroke=0,this._fc=16777215,this._fillColor=this._getNormalizedColor(4294967295),this._strokeColor=this._getNormalizedColor(16777215)}set blend(e){this._blend=Math.min(Math.max(e,0),1)}set radius(e){Array.isArray(e)?2===e.length?this._radius=[e[0],e[1],e[0],e[1]]:3===e.length?this._radius=[e[0],e[1],e[2],this._radius[3]]:4===e.length?this._radius=e:this._radius=[e[0],e[0],e[0],e[0]]:this._radius=[e,e,e,e],this.redraw()}get radius(){return this._radius}set topLeft(e){this._radius[0]=e,this.redraw()}get topLeft(){return this._radius[0]}set topRight(e){this._radius[1]=e,this.redraw()}get topRight(){return this._radius[1]}set bottomRight(e){this._radius[2]=e,this.redraw()}get bottomRight(){return this._radius[2]}set bottomLeft(e){this._radius[3]=e,this.redraw()}get bottomLeft(){return this._radius[4]}set strokeColor(e){this._sc=e,this._strokeColor=this._getNormalizedColor(e),this.redraw()}get strokeColor(){return this._sc}set fillColor(e){this._fc=e,this._fillColor=this._getNormalizedColor(e),this.redraw()}get fillColor(){return this._fc}set stroke(e){this._stroke=e,this.redraw()}get stroke(){return this._stroke}_getNormalizedColor(e){var t=l.getRgbaComponentsNormalized(e);return t[0]*=t[3],t[1]*=t[3],t[2]*=t[3],new Float32Array(t)}setupUniforms(e){super.setupUniforms(e);var t=e.shaderOwner,i=this.ctx.stage.getRenderPrecision(),r=this._radius.map((e=>(e+.5)*i));this._setUniform("radius",new Float32Array(r),this.gl.uniform4fv),this._setUniform("alpha",e.getElementCore(0).renderContext.alpha,this.gl.uniform1f),this._setUniform("blend",this._blend,this.gl.uniform1f),this._setUniform("strokeColor",this._strokeColor,this.gl.uniform4fv),this._setUniform("fillColor",this._fillColor,this.gl.uniform4fv),this._setUniform("stroke",this._stroke*i,this.gl.uniform1f),this._setUniform("resolution",new Float32Array([t._w*i,t._h*i]),this.gl.uniform2fv)}}at.vertexShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n\n    attribute vec4 aColor;\n    uniform vec2 projection;\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n\n    void main(void){\n        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);\n        vTextureCoord = aTextureCoord;\n        vColor = aColor;\n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n",at.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n\n    #define PI 3.14159265359\n\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n\n    uniform sampler2D uSampler;\n    uniform vec2 resolution;\n    uniform vec4 radius;\n    uniform float stroke;\n    uniform vec4 strokeColor;\n    uniform vec4 fillColor;\n    uniform float alpha;\n    uniform float fill;\n    uniform float blend;\n    \n    float boxDist(vec2 p, vec2 size, float radius){\n        size -= vec2(radius);\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0)) - radius;\n    }\n    \n    float fillMask(float dist){\n        return clamp(-dist, 0.0, 1.0);\n    }\n    \n    float innerBorderMask(float dist, float width){\n        float alpha1 = clamp(dist + width, 0.0, 1.0);\n        float alpha2 = clamp(dist, 0.0, 1.0);\n        return alpha1 - alpha2;\n    }\n\n    void main() {\n        vec2 halfRes = 0.5 * resolution.xy;\n        float r = 0.0;\n        if (vTextureCoord.x < 0.5 && vTextureCoord.y < 0.5) {\n            r = radius[0];\n        } else if (vTextureCoord.x >= 0.5 && vTextureCoord.y < 0.5) {\n            r = radius[1];\n        } else if (vTextureCoord.x >= 0.5 && vTextureCoord.y >= 0.5) {\n            r = radius[2];\n        } else {\n            r = radius[3];\n        }\n        \n        float b = boxDist(vTextureCoord.xy * resolution - halfRes, halfRes - 0.005, r);\n        vec4 tex = texture2D(uSampler, vTextureCoord) * vColor;\n        vec4 blend = mix(vec4(1.0) * alpha, tex, blend);     \n        vec4 layer1 = mix(vec4(0.0), tex * fillColor, fillMask(b));\n        gl_FragColor = mix(layer1, blend * strokeColor, innerBorderMask(b, stroke));\n    }\n";class ot extends re{constructor(e){super(e),this._fade=[0,0,0,0]}set top(e){this._fade[0]=e,this.redraw()}get top(){return this._fade[0]}set right(e){this._fade[1]=e,this.redraw()}get right(){return this._fade[1]}set bottom(e){this._fade[2]=e,this.redraw()}get bottom(){return this._fade[2]}set left(e){this._fade[3]=e,this.redraw()}get left(){return this._fade[3]}set fade(e){Array.isArray(e)?2===e.length?this._fade=[e[0],e[1],e[0],e[1]]:3===e.length?this._fade=[e[0],e[1],e[2],this._fade[3]]:4===e.length?this._fade=e:this._fade=[e[0],e[0],e[0],e[0]]:this._fade=[e,e,e,e],this.redraw()}get fade(){return this._fade}setupUniforms(e){super.setupUniforms(e);var t=e.shaderOwner,i=this.ctx.stage.getRenderPrecision(),r=this._fade.map((e=>e*i));this._setUniform("fade",new Float32Array(r),this.gl.uniform4fv),this._setUniform("resolution",new Float32Array([t._w*i,t._h*i]),this.gl.uniform2fv)}}ot.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    uniform vec2 resolution;\n    uniform vec4 fade;\n    \n    void main() {\n        vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n        vec2 halfRes = 0.5 * resolution.xy;\n        vec2 point = vTextureCoord.xy * resolution.xy;\n        \n        vec2 pos1;\n        vec2 pos2;\n        vec2 d;\n        float c;\n        float t = 0.0;\n             \n        if(fade[0] > 0.0) {\n            pos1 = vec2(point.x, point.y);\n            pos2 = vec2(point.x, point.y + fade[0]);\n            d = pos2 - pos1;\n            c = dot(pos1, d) / dot(d, d);\n            t = smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0));\n            color = mix(vec4(0.0), color, t);\n        }\n        \n        if(fade[1] > 0.0) {\n            vec2 pos1 = vec2(point.x - resolution.x - fade[1], vTextureCoord.y);\n            vec2 pos2 = vec2(point.x - resolution.x, vTextureCoord.y);\n            d = pos1 - pos2;\n            c = dot(pos2, d) / dot(d, d);\n            t = smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0));\n            color = mix(vec4(0.0), color, t);\n        }\n        \n        if(fade[2] > 0.0) {\n            vec2 pos1 = vec2(vTextureCoord.x, point.y - resolution.y - fade[2]);\n            vec2 pos2 = vec2(vTextureCoord.x, point.y - resolution.y);\n            d = pos1 - pos2;\n            c = dot(pos2, d) / dot(d, d);\n            t = smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0));\n            color = mix(vec4(0.0), color, t);\n        }\n        \n        if(fade[3] > 0.0) {\n            pos1 = vec2(point.x, point.y);\n            pos2 = vec2(point.x + fade[3], point.y);\n            d = pos2 - pos1;\n            c = dot(pos1, d) / dot(d, d);\n            t = smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0));\n            color = mix(vec4(0.0), color, t);\n        }\n        \n        gl_FragColor = color;\n    }\n";class ht extends re{constructor(e){super(e),this._magnitude=1.3,this._intensity=.7,this._pivot=[.5,.5]}setupUniforms(e){super.setupUniforms(e),this._setUniform("magnitude",this._magnitude,this.gl.uniform1f),this._setUniform("intensity",this._intensity,this.gl.uniform1f),this._setUniform("pivot",new Float32Array(this._pivot),this.gl.uniform2fv),this.redraw()}set pivot(e){Array.isArray(e)?this._pivot=e:this._pivot=[e,e],this.redraw()}get pivotX(){return this._pivot[0]}set pivotX(e){this._pivot[0]=e,this.redraw()}get pivotY(){return this._pivot[1]}set pivotY(e){this._pivot[1]=e,this.redraw()}get intensity(){return this._intensity}set intensity(e){this._intensity=e,this.redraw()}get magnitude(){return this._magnitude}set magnitude(e){this._magnitude=e,this.redraw()}}ht.vertexShaderSource=re.vertexShaderSource,ht.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n\n    uniform float magnitude;\n    uniform float intensity;\n    uniform vec2 pivot;\n\n    void main() {\n        vec2 uv = vTextureCoord.xy - pivot + vec2(0.5);\n        uv.x = clamp(uv.x, 0.0, 1.0);\n        uv.y = clamp(uv.y, 0.0, 1.0);\n   \n        uv *=  1.00 - uv.yx;\n        float vig = uv.x * uv.y * 25.0 * intensity;\n        vig = pow(vig, 0.45 * magnitude);\n        vec4 fragColor = vec4(vig) * vColor;\n        gl_FragColor = texture2D(uSampler, vTextureCoord) * fragColor;\n\n    }\n";class ut extends re{constructor(e){super(e),this._radius=100,this._width=50,this._period=1,this._angle=.5,this._smooth=.005,this._color=4294967295,this._backgroundColor=4278190080,this._time=Date.now()}set radius(e){this._radius=e,this.redraw()}set width(e){this._width=e,this.redraw()}set period(e){this._period=e,this.redraw()}set angle(e){this._angle=e,this.redraw()}set smooth(e){this._smooth=e,this.redraw()}set color(e){this._color=e,this.redraw()}set backgroundColor(e){this._backgroundColor=e,this.redraw()}setupUniforms(e){super.setupUniforms(e);var t=e.shaderOwner;this._setUniform("iTime",Date.now()-this._time,this.gl.uniform1f);var i=this.ctx.stage.getRenderPrecision();this._setUniform("radius",this._radius*i,this.gl.uniform1f),this._setUniform("width",this._width*i,this.gl.uniform1f),this._setUniform("period",this._period,this.gl.uniform1f),this._setUniform("angle",this._angle,this.gl.uniform1f),this._setUniform("smooth",this._smooth,this.gl.uniform1f),this._setUniform("color",new Float32Array(l.getRgbaComponentsNormalized(this._color)),this.gl.uniform4fv),this._setUniform("backgroundColor",new Float32Array(l.getRgbaComponentsNormalized(this._backgroundColor)),this.gl.uniform4fv),this._setUniform("resolution",new Float32Array([t._w*i,t._h*i]),this.gl.uniform2fv),this.redraw()}}ut.vertexShaderSource=re.vertexShaderSource,ut.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n\n    uniform float iTime;\n    uniform float radius;\n    uniform float width;\n    uniform float period;\n    uniform float angle;\n    uniform float smooth;\n    uniform vec2 resolution;\n\n    uniform vec4 color;\n    uniform vec4 backgroundColor;\n\n    float ratio = resolution.y / resolution.x;\n\n    vec2 transpose_pos(vec2 pos) {\n        if (ratio < 1.) {\n            float diff = 0.5 - pos.x;\n            pos.x = 0.5 - diff / ratio;\n        } else {\n            float diff = 0.5 - pos.y;\n            pos.y = 0.5 - diff * ratio;\n        }\n        return pos;\n    }\n\n    float get_angle(vec2 pos) {\n        pos = transpose_pos(pos);\n        float a = atan(pos.y - 0.5, pos.x - 0.5);\n        a = (1.0+a/3.14159)/2.0;\n        \n        return a;\n    }\n\n    float dist(vec2 pos1, vec2 pos2) {\n        pos1 = transpose_pos(pos1);\n        return distance(pos1, pos2);\n    }\n\n    void main()\n    {\n        vec2 fragCoord = vTextureCoord;\n        vec4 fragColor = vColor;\n        \n        vec2 st = vTextureCoord;\n        float pct = dist(st, vec2(0.5));\n\n        float a = get_angle(st);\n        float t = iTime / 1000.0 / period;\n\n        float inner = max((radius - width) / resolution.x, (radius - width) / resolution.y);\n        float outer = max(radius / resolution.x, radius / resolution.y);\n\n        float x1 = mod(t, 1.0);\n        float x2 = mod(t + angle, 1.0);\n\n        if (x1 < x2) {\n            if (a > x1 && a < x2) {\n                float val = (1.0 - (x2 - a) / angle) * smoothstep(0.0, 3. * smooth, (x2 - a));\n                fragColor = mix(backgroundColor, color, val);\n            } else {\n                fragColor = backgroundColor;\n            }\n        } else {\n            if (a < x2) {\n                float val = (1.0 - (x2 - a) / angle) * smoothstep(0.0, 3. * smooth, (x2 - a));\n                fragColor = mix(backgroundColor, color, val);\n            } else if (a > x1) {\n                float val = (1.0 - (1.0 + x2 - a) / angle) * smoothstep(0.0, 3. * smooth, (1.0 + x2 - a));\n                fragColor = mix(backgroundColor, color, val);\n            } else {\n                fragColor = backgroundColor;\n            }\n        }\n\n        float s = smoothstep(inner, inner + smooth + 0.00001, pct) * (1.0 - smoothstep(outer, outer + smooth + 0.00001, pct));\n        gl_FragColor = texture2D(uSampler, fragCoord) * vColor * (1. - s * fragColor.a) + fragColor * s;\n    }\n";class lt extends re{constructor(e){super(e),this._x=0,this._y=0,this._w=0,this._h=0,this._radius=0}get x(){return this._x}set x(e){this._x=e,this.redraw()}get y(){return this._y}set y(e){this._y=e,this.redraw()}get w(){return this._w}set w(e){this._w=e,this.redraw()}get h(){return this._h}set h(e){this._h=e,this.redraw()}get radius(){return this._radius}set radius(e){this._radius=e,this.redraw()}setupUniforms(e){super.setupUniforms(e);var t=e.shaderOwner,i=this.ctx.stage.getRenderPrecision();this._setUniform("x",this._x*i,this.gl.uniform1f),this._setUniform("y",this._y*i,this.gl.uniform1f),this._setUniform("w",this._w*i,this.gl.uniform1f),this._setUniform("h",this._h*i,this.gl.uniform1f),this._setUniform("radius",(this._radius+.5)*i,this.gl.uniform1f),this._setUniform("resolution",new Float32Array([t._w*i,t._h*i]),this.gl.uniform2fv)}useDefault(){return 0===this._x&&0===this._y&&0===this._w&&0===this._h}}lt.vertexShaderSource=re.vertexShaderSource,lt.fragmentShaderSource="\n   #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    uniform float x;\n    uniform float y;\n    uniform float w;\n    uniform float h;\n    uniform vec2 resolution;\n    uniform float radius;\n\n    float roundBox(vec2 p, vec2 b, float r) {\n        float d = length(max(abs(p)-b+r, 0.1))-r;\n        return smoothstep(1.0, 0.0, d);\n    }\n\n    void main(void){\n        vec4 color = texture2D(uSampler, vTextureCoord);\n        vec2 pos = vTextureCoord.xy * resolution - vec2(x, y) - vec2(w, h) / 2.0;\n        vec2 size = vec2(w, h) / 2.0;\n        float b = roundBox(pos, size, radius);\n        gl_FragColor = mix(color, vec4(0.0), b);\n    }\n";class ct extends re{constructor(e){super(e),this._pivot=[0,0],this._ic=4294967295,this._normalizedIC=this._getNormalizedColor(this._ic),this._oc=16777215,this._normalizedOC=this._getNormalizedColor(this._oc),this._radius=0}set radiusX(e){this.radius=e}get radiusX(){return this._radius}set radiusY(e){this._radiusY=e,this.redraw()}get radiusY(){return this._radiusY}set radius(e){this._radius=e,this.redraw()}set innerColor(e){this._ic=e,this._normalizedIC=this._getNormalizedColor(e),this.redraw()}get innerColor(){return this._ic}set outerColor(e){this._oc=e,this._normalizedOC=this._getNormalizedColor(e),this.redraw()}set color(e){this.innerColor=e}get color(){return this.innerColor}get outerColor(){return this._ic}set x(e){this._x=e,this.redraw()}set y(e){this._y=e,this.redraw()}set pivot(e){Array.isArray(e)&&2===e.length?this._pivot=e:Array.isArray(e)?this._pivot=[e[0],e[1]||e[0]]:this._pivot=[e,e],this.redraw()}get pivot(){return this._pivot[0]}set pivotY(e){this._pivot[1]=e,this.redraw()}get pivotY(){return this._pivot[1]}set pivotX(e){this._pivot[0]=e,this.redraw()}get pivotX(){return this._pivot[0]}_getNormalizedColor(e){var t=l.getRgbaComponentsNormalized(e);return t[0]*=t[3],t[1]*=t[3],t[2]*=t[3],new Float32Array(t)}setupUniforms(e){super.setupUniforms(e);var t=e.shaderOwner;this._x&&(this._pivot[0]=this._x/t.w),this._y&&(this._pivot[1]=this._y/t.h),0===this._radius&&(this._radius=.5*t.w),this._setUniform("innerColor",this._normalizedIC,this.gl.uniform4fv),this._setUniform("fill",l.getRgbaComponentsNormalized(this._oc)[3],this.gl.uniform1f),this._setUniform("outerColor",this._normalizedOC,this.gl.uniform4fv),this._setUniform("pivot",new Float32Array(this._pivot),this.gl.uniform2fv),this._setUniform("resolution",new Float32Array([t._w,t._h]),this.gl.uniform2fv),this._setUniform("alpha",e.getElementCore(0).renderContext.alpha,this.gl.uniform1f),this._setUniform("radius",this._radius,this.gl.uniform1f),this._setUniform("radiusY",this._radiusY||this._radius,this.gl.uniform1f)}}ct.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    \n    #define PI 3.14159265359\n    \n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    uniform vec2 resolution;\n    uniform vec2 pivot;\n    uniform vec4 innerColor;\n    uniform vec4 outerColor;\n    uniform float radius;\n    uniform float radiusY;\n    uniform float alpha;\n    uniform float fill;\n    uniform float aspectRatio;\n    \n    void main() {\n        vec2 point = vTextureCoord.xy * resolution;\n        vec2 projection = vec2(pivot.x * resolution.x, pivot.y * resolution.y);\n        float d = length((point - projection) / vec2(radius * 2.0, radiusY * 2.0));\n        vec4 color = mix(texture2D(uSampler, vTextureCoord) * vColor, outerColor * alpha, fill);\n        gl_FragColor = mix(innerColor * alpha, color, smoothstep(0.0, 1.0, d));\n    }\n";class dt extends re{constructor(e){super(e),this._strength=.5,this._ambient=.5,this._fudge=.4,this._rx=0,this._ry=0,this._z=0,this._pivotX=NaN,this._pivotY=NaN,this._pivotZ=0,this._lightY=0,this._lightZ=0}setupUniforms(e){super.setupUniforms(e);var t=e.shaderOwner,i=t.element,r=isNaN(this._pivotX)?i.pivotX*t.w:this._pivotX,n=isNaN(this._pivotY)?i.pivotY*t.h:this._pivotY,s=t.getRenderTextureCoords(r,n),a=-Math.atan2(t._renderContext.tc,t._renderContext.ta),o=this.gl;this._setUniform("pivot",new Float32Array([s[0],s[1],this._pivotZ]),o.uniform3fv),this._setUniform("rot",new Float32Array([this._rx,this._ry,a]),o.uniform3fv),this._setUniform("z",this._z,o.uniform1f),this._setUniform("lightY",this.lightY,o.uniform1f),this._setUniform("lightZ",this.lightZ,o.uniform1f),this._setUniform("strength",this._strength,o.uniform1f),this._setUniform("ambient",this._ambient,o.uniform1f),this._setUniform("fudge",this._fudge,o.uniform1f)}set strength(e){this._strength=e,this.redraw()}get strength(){return this._strength}set ambient(e){this._ambient=e,this.redraw()}get ambient(){return this._ambient}set fudge(e){this._fudge=e,this.redraw()}get fudge(){return this._fudge}get rx(){return this._rx}set rx(e){this._rx=e,this.redraw()}get ry(){return this._ry}set ry(e){this._ry=e,this.redraw()}get z(){return this._z}set z(e){this._z=e,this.redraw()}get pivotX(){return this._pivotX}set pivotX(e){this._pivotX=e+1,this.redraw()}get pivotY(){return this._pivotY}set pivotY(e){this._pivotY=e+1,this.redraw()}get lightY(){return this._lightY}set lightY(e){this._lightY=e,this.redraw()}get pivotZ(){return this._pivotZ}set pivotZ(e){this._pivotZ=e,this.redraw()}get lightZ(){return this._lightZ}set lightZ(e){this._lightZ=e,this.redraw()}useDefault(){return 0===this._rx&&0===this._ry&&0===this._z&&0===this._strength&&1===this._ambient}}dt.vertexShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec4 aColor;\n    uniform vec2 projection;\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n\n    uniform float fudge;\n    uniform float strength;\n    uniform float ambient;\n    uniform float z;\n    uniform float lightY;\n    uniform float lightZ;\n    uniform vec3 pivot;\n    uniform vec3 rot;\n    varying vec3 pos;\n\n    void main(void) {\n        pos = vec3(aVertexPosition.xy, z);\n        \n        pos -= pivot;\n        \n        // Undo XY rotation\n        mat2 iRotXy = mat2( cos(rot.z), sin(rot.z), \n                           -sin(rot.z), cos(rot.z));\n        pos.xy = iRotXy * pos.xy;\n        \n        // Perform 3d rotations\n        gl_Position.x = cos(rot.x) * pos.x - sin(rot.x) * pos.z;\n        gl_Position.y = pos.y;\n        gl_Position.z = sin(rot.x) * pos.x + cos(rot.x) * pos.z;\n        \n        pos.x = gl_Position.x;\n        pos.y = cos(rot.y) * gl_Position.y - sin(rot.y) * gl_Position.z;\n        pos.z = sin(rot.y) * gl_Position.y + cos(rot.y) * gl_Position.z;\n        \n        // Redo XY rotation\n        iRotXy[0][1] = -iRotXy[0][1];\n        iRotXy[1][0] = -iRotXy[1][0];\n        pos.xy = iRotXy * pos.xy; \n\n        // Undo translate to pivot position\n        pos.xyz += pivot;\n\n        pos = vec3(pos.x * projection.x - 1.0, pos.y * -abs(projection.y) + 1.0, pos.z * projection.x);\n        \n        // Set depth perspective\n        float perspective = 1.0 + fudge * pos.z;\n\n        pos.z += lightZ * projection.x;\n\n        // Map coords to gl coordinate space.\n        // Set z to 0 because we don't want to perform z-clipping\n        gl_Position = vec4(pos.xy, 0.0, perspective);\n\n        // Correct light source position.\n        pos.y += lightY * abs(projection.y);\n\n        vTextureCoord = aTextureCoord;\n        vColor = aColor;\n        \n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n",dt.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    varying vec3 pos;\n    uniform sampler2D uSampler;\n    uniform float ambient;\n    uniform float strength;\n    void main(void){\n        vec4 rgba = texture2D(uSampler, vTextureCoord);\n        float d = length(pos);\n        float n = 1.0 / max(0.1, d);\n        rgba.rgb = rgba.rgb * (strength * n + ambient);\n        gl_FragColor = rgba * vColor;\n    }\n";class pt extends re{constructor(e){super(e),this._fudge=.2,this._rx=0,this._ry=0,this._z=1}setupUniforms(e){super.setupUniforms(e);var t=e.shaderOwner,i=t.element,r=i.pivotX*t.w,n=i.pivotY*t.h,s=t.getRenderTextureCoords(r,n),a=-Math.atan2(t._renderContext.tc,t._renderContext.ta),o=this.gl;this._setUniform("pivot",new Float32Array([s[0],s[1],0]),o.uniform3fv),this._setUniform("rot",new Float32Array([this._rx,this._ry,a]),o.uniform3fv),this._setUniform("z",this._z,o.uniform1f),this._setUniform("fudge",this._fudge,o.uniform1f)}set fudge(e){this._fudge=e,this.redraw()}get fudge(){return this._fudge}get rx(){return this._rx}set rx(e){this._rx=e,this.redraw()}get ry(){return this._ry}set ry(e){this._ry=e,this.redraw()}get z(){return this._z}set z(e){this._z=e,this.redraw()}useDefault(){return 0===this._rx&&0===this._ry&&0===this._z}}pt.vertexShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec4 aColor;\n    uniform vec2 projection;\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n\n    uniform float z;\n    uniform vec3 pivot;\n    uniform vec3 rot;\n    varying vec3 pos;\n\n    void main(void) {\n        pos = vec3(aVertexPosition.xy, z);\n        \n        pos -= pivot;\n        \n        // Undo XY rotation\n        mat2 iRotXy = mat2( cos(rot.z), sin(rot.z), \n                           -sin(rot.z), cos(rot.z));\n        pos.xy = iRotXy * pos.xy;\n        \n        // Perform 3d rotations\n        gl_Position.x = cos(rot.x) * pos.x - sin(rot.x) * pos.z;\n        gl_Position.y = pos.y;\n        gl_Position.z = sin(rot.x) * pos.x + cos(rot.x) * pos.z;\n        \n        pos.x = gl_Position.x;\n        pos.y = cos(rot.y) * gl_Position.y - sin(rot.y) * gl_Position.z;\n        pos.z = sin(rot.y) * gl_Position.y + cos(rot.y) * gl_Position.z;\n        \n        // Redo XY rotation\n        iRotXy[0][1] = -iRotXy[0][1];\n        iRotXy[1][0] = -iRotXy[1][0];\n        pos.xy = iRotXy * pos.xy; \n\n        // Undo translate to pivot position\n        pos.xyz += pivot;\n\n        pos = vec3(pos.x * projection.x - 1.0, pos.y * -abs(projection.y) + 1.0, pos.z * projection.x);\n        \n        // Map coords to gl coordinate space.\n        // Set z to 0 because we don't want to perform z-clipping\n        gl_Position = vec4(pos.xy, 0.0, z);\n\n        vTextureCoord = aTextureCoord;\n        vColor = aColor;\n        \n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n",pt.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n\n    uniform vec3 rot;\n    uniform float fudge;\n\n    void main(void) {\n        vec2 coords = vTextureCoord;\n\n        coords.xy -= vec2(0.5);\n        coords.y = coords.y + (sign(rot[0]) * 0.5 - coords.x) * sin(rot[0]) * fudge * coords.y;\n        coords.x = coords.x + (sign(rot[1]) * 0.5 - coords.y) * sin(rot[1]) * fudge * coords.x;\n        coords.xy += vec2(0.5);\n\n        if (coords.x < 0.0 || coords.x > 1.0 || coords.y < 0.0 || coords.y > 1.0) {\n            gl_FragColor = vec4(0.0);\n        } else {\n            gl_FragColor = texture2D(uSampler, coords) * vColor;\n        }\n    }\n";class gt extends re{constructor(e){super(e),this._x=0,this._y=0,this._w=0,this._h=0,this._radius=0,this._magnification=.6}get x(){return this._x}set x(e){this._x=e,this.redraw()}get y(){return this._y}set y(e){this._y=e,this.redraw()}get w(){return this._w}set w(e){this._w=e,this.redraw()}get h(){return this._h}set h(e){this._h=e,this.redraw()}get magnification(){return this._magnification}set magnification(e){this._magnification=e,this.redraw()}get radius(){return this._radius}set radius(e){this._radius=e,this.redraw()}setupUniforms(e){super.setupUniforms(e);var t=e.shaderOwner,i=this.ctx.stage.getRenderPrecision();this._setUniform("x",this._x*i,this.gl.uniform1f),this._setUniform("y",this._y*i,this.gl.uniform1f),this._setUniform("w",this._w*i,this.gl.uniform1f),this._setUniform("h",this._h*i,this.gl.uniform1f),this._setUniform("magnification",this._magnification,this.gl.uniform1f),this._setUniform("radius",(this._radius+.5)*i,this.gl.uniform1f),this._setUniform("resolution",new Float32Array([t._w*i,t._h*i]),this.gl.uniform2fv)}useDefault(){return 0===this._w&&0===this._h}}gt.vertexShaderSource=re.vertexShaderSource,gt.fragmentShaderSource="\n\t  #ifdef GL_ES\n\t\t# ifdef GL_FRAGMENT_PRECISION_HIGH\n\t\tprecision highp float;\n\t\t# else\n\t\tprecision lowp float;\n\t\t# endif\n\t  #endif\n\n\t  varying vec2 vTextureCoord;\n\t  varying vec4 vColor;\n\t  uniform sampler2D uSampler;\n\t  uniform float x;\n\t  uniform float y;\n\t  uniform float w;\n\t  uniform float h;\n\t  uniform vec2 resolution;\n\t  uniform float radius;\n\t  uniform float magnification;\n  \n\t  float roundBox(vec2 p, vec2 b, float r) {\n\t\t  float d = length(max(abs(p)-b+r, 0.1))-r;\n\t\t  return smoothstep(1.0, 0.0, d);\n\t  }\n\n\t  float inside(vec2 v) {\n\t\tvec2 s = step(vec2(0.0, 0.0), v) - step(vec2(1.0, 1.0), v);\n\t\treturn s.x * s.y;   \n      }\n  \n\t  void main(void) {\n\t\tvec4 color = texture2D(uSampler, vTextureCoord);\n\t\tvec2 pos = vTextureCoord.xy * resolution - vec2(x, y) - vec2(w, h) / 2.0;\n\t\tvec2 size = vec2(w, h) / 2.0;\n\t\tfloat b = roundBox(pos, size, radius);\n\t\tvec2 pos2 = (vTextureCoord.xy * magnification * resolution + vec2(x, y) * magnification) / resolution;\n\t\tgl_FragColor = mix(color, texture2D(uSampler, pos2) * inside(pos2), b) * vColor;\n\t  }\n  ";class ft extends re{constructor(e){super(e),this._period=1,this._stroke=0,this._showDot=!0,this._clockwise=!0,this._bc=4278190080,this._normalizedBC=this._getNormalizedColor(this._bc),this._c=4294967295,this._normalizedC=this._getNormalizedColor(this._c)}set radius(e){0===e&&(e=1),this._radius=e}set stroke(e){this._stroke=Math.abs(e)}get stroke(){return this._stroke}set color(e){this._c=e,this._normalizedC=this._getNormalizedColor(e)}get color(){return this._c}set backgroundColor(e){this._bc=e,this._normalizedBC=this._getNormalizedColor(e)}get backgroundColor(){return this._sc}set showDot(e){this._showDot=e}get showDot(){return this._showDot}set clockwise(e){this._clockwise=e}get clockwise(){return this._clockwise}set period(e){this._period=e}get period(){return this._period}_getNormalizedColor(e){var t=l.getRgbaComponentsNormalized(e);return t[0]*=t[3],t[1]*=t[3],t[2]*=t[3],new Float32Array(t)}setupUniforms(e){super.setupUniforms(e);var t=e.shaderOwner,i=this._radius||t._w/2;0===this._stroke&&(this._stroke=.33*i),this._setUniform("resolution",new Float32Array([t._w,t._h]),this.gl.uniform2fv),this._setUniform("color",this._normalizedC,this.gl.uniform4fv),this._setUniform("backgroundColor",this._normalizedBC,this.gl.uniform4fv),this._setUniform("stroke",this._stroke,this.gl.uniform1f),this._setUniform("radius",i,this.gl.uniform1f),this._setUniform("direction",this._clockwise?-1:1,this.gl.uniform1f),this._setUniform("showDot",!!this._showDot,this.gl.uniform1f),this._setUniform("time",Date.now()-ft.spinSync,this.gl.uniform1f),this._setUniform("period",this._period,this.gl.uniform1f),this._setUniform("alpha",e.getElementCore(0).renderContext.alpha,this.gl.uniform1f),this._sc===this._bc&&this._stroke===.5*i||this.redraw()}}ft.spinSync=Date.now(),ft.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    \n    #define PI 3.14159265359\n    \n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    \n    uniform sampler2D uSampler;\n    uniform vec2 resolution;\n    uniform vec4 color;\n    uniform vec4 backgroundColor;\n    uniform float direction;\n    uniform float radius;\n    uniform float time;\n    uniform float stroke;\n    uniform float showDot;\n    uniform float period;\n    uniform float alpha;\n    \n    float circleDist(vec2 p, float radius){\n        return length(p) - radius;\n    }\n    \n    float fillMask(float dist){\n        return clamp(-dist, 0.0, 1.0);\n    }\n    \n    void main() {\n        vec2 halfRes = 0.5 * resolution.xy;\n        vec2 center = vTextureCoord.xy * resolution - halfRes;\n        \n        float c = max(-circleDist(center, radius - stroke), circleDist(center, radius));\n        float rot = -(time / 1000.0 / period) * 6.0 * direction;\n        center *= mat2(cos(rot), sin(rot), -sin(rot), cos(rot));\n        \n        float a = direction * atan(center.x, center.y) * PI * 0.05 + 0.45;\n        \n        float strokeRad = stroke * 0.5;\n        a = mix(a, max(a, fillMask(circleDist(vec2(center.x, center.y + (radius - strokeRad)), strokeRad))), showDot);\n        vec4 base = mix(vec4(0.0), backgroundColor * alpha, fillMask(c));\n        gl_FragColor = mix(base, color * alpha, fillMask(c) * a);\n    }\n";var mt={Application:class e extends q{constructor(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1?arguments[1]:void 0;e._temp_options=t,e.booting=!0,super(new De(t.stage),i),e.booting=!1,this.__updateFocusCounter=0,this.__keypressTimers=new Map,this.__hoveredChild=null,this.stage.init(),this.updateFocusSettings(),this.__keymap=this.getOption("keys"),this.__keymap&&(this.stage.platform.registerKeydownHandler((e=>{this._receiveKeydown(e)})),this.stage.platform.registerKeyupHandler((e=>{this._receiveKeyup(e)}))),this.getOption("enablePointer")&&(this.stage.platform.registerClickHandler((e=>{this._receiveClick(e)})),this.stage.platform.registerHoverHandler((e=>{this._receiveHover(e)})),this.stage.platform.registerScrollWheelHandler((e=>{this._recieveScrollWheel(e)})),this.cursor="default")}getOption(e){return this.__options[e]}_setOptions(e){this.__options={};var t=(t,i)=>{var r=e[t];this.__options[t]=void 0===r?i:r};t("debug",!1),t("keys",{38:"Up",40:"Down",37:"Left",39:"Right",13:"Enter",8:"Back",27:"Exit"}),t("enablePointer",!1)}__construct(){this.stage.setApplication(this),this._setOptions(e._temp_options),delete e._temp_options,super.__construct()}__init(){super.__init(),this.__updateFocus()}updateFocusPath(){this.__updateFocus()}__updateFocus(){var t=this.__updateFocusRec();!e.booting&&t&&this.updateFocusSettings()}__updateFocusRec(){var e=++this.__updateFocusCounter;this.__updateFocusId=e;var t=this.__getFocusPath(),i=t[t.length-1],r=this._focusPath?this._focusPath[this._focusPath.length-1]:void 0;if(!r){this._focusPath=[];for(var n=0,s=t.length;n<s;n++){if(this._focusPath.push(t[n]),this._focusPath[n]._focus(i,void 0),this.__updateFocusId!==e)return!1}return!0}var a,o=Math.min(this._focusPath.length,t.length);for(a=0;a<o&&this._focusPath[a]===t[a];a++);if(this._focusPath.length!==t.length||a!==t.length){this.getOption("debug")&&console.log("[Lightning] Focus changed: "+i.getLocationString());for(var h=this._focusPath.length-1;h>=a;h--){if(this._focusPath.pop()._unfocus(i,r),this.__updateFocusId!==e)return!1}for(var u=a,l=t.length;u<l;u++){if(this._focusPath.push(t[u]),this._focusPath[u]._focus(i,r),this.__updateFocusId!==e)return!1}for(var c=0;c<a;c++)this._focusPath[c]._focusChange(i,r)}return!0}updateFocusSettings(){for(var e=this._focusPath[this._focusPath.length-1],t={},i=q.prototype._setFocusSettings,r=0,n=this._focusPath.length;r<n;r++)this._focusPath[r]._setFocusSettings!==i&&this._focusPath[r]._setFocusSettings(t);for(var s=q.prototype._handleFocusSettings,a=0,o=this._focusPath.length;a<o;a++)this._focusPath[a]._handleFocusSettings!==s&&this._focusPath[a]._handleFocusSettings(t,this.__prevFocusSettings,e);this.__prevFocusSettings=t}_handleFocusSettings(e,t,i,r){}__getFocusPath(){for(var e=[this],t=this;;){var i=t._getFocused();if(!i||i===t)break;var r=i.cparent;if(r===t)e.push(i);else{var n=[i];do{r||t._throwError("Return value for _getFocused must be an attached descendant component but its '"+i.getLocationString()+"'"),n.push(r),r=r.cparent}while(r!==t);for(var s=0,a=n.length;s<a;s++)e.push(n[a-s-1])}t=i}return e}get focusPath(){return this._focusPath}focusTopDownEvent(e){for(var t=this.focusPath,i=t.length,r=arguments.length,n=new Array(r>1?r-1:0),s=1;s<r;s++)n[s-1]=arguments[s];for(var a=0;a<i;a++){var o=t[a]._getMostSpecificHandledMember(e);if(void 0!==o)if(!1!==t[a][o](...n))return!0}return!1}focusBottomUpEvent(e){for(var t=this.focusPath,i=t.length,r=arguments.length,n=new Array(r>1?r-1:0),s=1;s<r;s++)n[s-1]=arguments[s];for(var a=i-1;a>=0;a--){var o=t[a]._getMostSpecificHandledMember(e);if(void 0!==o)if(!1!==t[a][o](...n))return!0}return!1}_receiveKeydown(e){var t,i=e,r=this.__keymap[e.keyCode],n=this.focusPath;if(r&&(t=Array.isArray(r)?r:[r]),t)for(var s=0,a=t.length;s<a;s++){var o=this.__keypressTimers.has(t[s]);if(n[n.length-1].longpress&&o)return;this.stage.application.focusTopDownEvent([`_capture${t[s]}`,"_captureKey"],i)||this.stage.application.focusBottomUpEvent([`_handle${t[s]}`,"_handleKey"],i)}else this.stage.application.focusTopDownEvent(["_captureKey"],i)||this.stage.application.focusBottomUpEvent(["_handleKey"],i);this.updateFocusPath();var h=n[n.length-1];if(t&&h.longpress)for(var u=0,l=t.length;u<l;u++)this._startLongpressTimer(t[u],h)}_receiveKeyup(e){var t,i=e,r=this.__keymap[e.keyCode];if(r&&(t=Array.isArray(r)?r:[r]),t)for(var n=0,s=t.length;n<s;n++)this.stage.application.focusTopDownEvent([`_capture${t[n]}Release`,"_captureKeyRelease"],i)||this.stage.application.focusBottomUpEvent([`_handle${t[n]}Release`,"_handleKeyRelease"],i);else this.stage.application.focusTopDownEvent(["_captureKeyRelease"],i)||this.stage.application.focusBottomUpEvent(["_handleKeyRelease"],i);if(this.updateFocusPath(),t)for(var a=0,o=t.length;a<o;a++)this.__keypressTimers.has(t[a])&&(clearTimeout(this.__keypressTimers.get(t[a])),this.__keypressTimers.delete(t[a]))}_startLongpressTimer(e,t){var i=t.longpress,r=e.toLowerCase();if(i[r]){var n=i[r];c.isNumber(n)?this.__keypressTimers.set(e,setTimeout((()=>{this.stage.application.focusTopDownEvent([`_capture${e}Long`,"_captureKey"],{})||this.stage.application.focusBottomUpEvent([`_handle${e}Long`,"_handleKey"],{}),this.__keypressTimers.delete(e)}),n||500)):t._throwError("config value for longpress must be a number")}}_recieveScrollWheel(e){var t=e,i=t.clientX,r=t.clientY;i<=this.stage.w&&r<=this.stage.h&&(this.fireTopDownScrollWheelHandler("_captureScroll",t)||this.fireBottomUpScrollWheelHandler("_handleScroll",t))}fireTopDownScrollWheelHandler(e,t){for(var i=this.stage.application.children,r=this._findChildren([],i).reverse(),n=r.length;n--;){var s=r[n];if(s&&s[e])return s._captureScroll(t),!0}return!1}fireBottomUpScrollWheelHandler(e,t){for(var i=t.clientX,r=t.clientY,n=this._getTargetChild(i,r);null!==n;){if(n&&n[e])return n._handleScroll(t),!0;n=n.parent}return!1}_receiveClick(e){var t=e,i=t.clientX,r=t.clientY;i<=this.stage.w&&r<=this.stage.h&&this.stage.application.fireBottomUpClickHandler(t)}fireBottomUpClickHandler(e){for(var t=e.clientX,i=e.clientY,r=this._getTargetChild(t,i),n=r;null!==n;){if(n&&n._handleClick){n._handleClick(r);break}n=n.parent}}_receiveHover(e){var t=e,i=t.clientX,r=t.clientY;i<=this.stage.w&&r<=this.stage.h&&this.stage.application.fireBottomUpHoverHandler(t)}fireBottomUpHoverHandler(e){var t=e.clientX,i=e.clientY,r=this._getTargetChild(t,i);if(r!==this.__hoveredChild){var n=new Set,s=new Set;if(r&&(s=new Set(r.getAncestors())),this.__hoveredChild){n=new Set(this.__hoveredChild.getAncestors());var a,h=o([...n].filter((e=>!s.has(e))));try{for(h.s();!(a=h.n()).done;){var u=a.value,l=q.getComponent(u);l._handleUnhover&&l._handleUnhover(u),u.parent&&u.parent.cursor&&(this.stage.getCanvas().style.cursor=u.parent.cursor)}}catch(v){h.e(v)}finally{h.f()}}this.__hoveredChild=r;var c,d=[...s].filter((e=>!n.has(e))),p=o(d);try{for(p.s();!(c=p.n()).done;){var g=c.value,f=q.getComponent(g);f._handleHover&&f._handleHover(g)}}catch(v){p.e(v)}finally{p.f()}var m=d[0];if(m&&m.cursor&&(this.stage.getCanvas().style.cursor=m.cursor),0===d.length&&r){var _=q.getComponent(r);_._handleHover&&_._handleHover(r)}}}_getTargetChild(e,t){var i=this.stage.application.children,r=this._findChildren([],i),n=this._withinClickableRange(r,e,t);return n.sort(((e,t)=>e.zIndex>t.zIndex?1:e.zIndex<t.zIndex?-1:e.id>t.id?1:-1)),n.length?n.slice(-1)[0]:null}_findChildren(e,t){for(var i=t.length;i--;){var r=t[i];r.__active&&r.collision&&(!0===r.collision&&e.push(r),r.hasChildren()&&this._findChildren(e,r.children))}return e}_withinClickableRange(e,t,i){for(var r=this,n=e.length,s=[],a=function(){var a=e[n],o=r.stage.getRenderPrecision(),h=a.core._worldContext,u=h.px*o,l=h.py*o,c=a.finalW*h.ta*o,d=a.finalH*h.td*o;if(u>r.stage.w||l>r.stage.h)return"continue";if(a.parent.core._scissor){var p=a.parent.core._scissor.map((e=>e*o));if(!r._testCollision(t,i,...p))return"continue"}r._testCollision(t,i,u,l,c,d)&&s.push(a)};n--;)a();return s}_testCollision(e,t,i,r,n,s){return e>=i&&e<=i+n&&t>=r&&t<=r+s}destroy(){this._destroyed||(this._destroy(),this.stage.destroy(),this._destroyed=!0)}_destroy(){if(this.stage.setApplication(void 0),this._updateAttachedFlag(),this._updateEnabledFlag(),this.__keypressTimers.size){var e,t=o(this.__keypressTimers.values());try{for(t.s();!(e=t.n()).done;){var i=e.value;clearTimeout(i)}}catch(r){t.e(r)}finally{t.f()}this.__keypressTimers.clear()}}getCanvas(){return this.stage.getCanvas()}},Component:q,Base:d,Utils:c,StageUtils:l,Element:W,Tools:Fe,Stage:De,ElementCore:R,ElementTexturizer:I,Texture:P,EventEmitter:k,shaders:{Grayscale:Qe,BoxBlur:Ge,Dithering:et,CircularPush:tt,Inversion:it,LinearBlur:We,Outline:rt,Pixelate:nt,RadialFilter:st,RoundedRectangle:at,Spinner2:ft,FadeOut:ot,Hole:lt,Vignette:ht,Spinner:ut,RadialGradient:ct,Light3d:dt,Perspective:pt,Magnifier:gt,WebGLShader:ie,WebGLDefaultShader:re,C2dShader:ue,C2dDefaultShader:le,c2d:{Grayscale:Je,Blur:Xe}},textures:{RectangleTexture:Oe,NoiseTexture:je,TextTexture:U,ImageTexture:O,HtmlTexture:He,StaticTexture:class extends P{constructor(e,t){super(e),this._options=t}set options(e){this._options!==e&&(this._options=e,this._changed())}get options(){return this._options}_getIsValid(){return!!this._options}_getSourceLoader(){return e=>{e(null,this._options)}}},StaticCanvasTexture:Ne,SourceTexture:B},components:{FastBlurComponent:class extends q{static _template(){return{}}get wrap(){return this.tag("Wrap")}set content(e){return this.wrap.content=e}get content(){return this.wrap.content}set padding(e){this.wrap._paddingX=e,this.wrap._paddingY=e,this.wrap._updateBlurSize()}set paddingX(e){this.wrap._paddingX=e,this.wrap._updateBlurSize()}set paddingY(e){this.wrap._paddingY=e,this.wrap._updateBlurSize()}set amount(e){return this.wrap.amount=e}get amount(){return this.wrap.amount}_onResize(){this.wrap.w=this.renderWidth,this.wrap.h=this.renderHeight}get _signalProxy(){return!0}_build(){this.patch({Wrap:{type:this.stage.gl?Ye:qe}})}},BloomComponent:class extends q{static _template(){var e=function(e,t){if(130&t._recalc){var i=t.w,r=t.h,n=t;do{(n=n._children[0])._element.w=i,n._element.h=r}while(n._children)}};return{Textwrap:{rtt:!0,forceZIndexContext:!0,renderOffscreen:!0,BloomBase:{shader:{type:Ke},Content:{}}},Layers:{L0:{rtt:!0,onUpdate:e,scale:2,pivot:0,visible:!1,Content:{shader:{type:Ge}}},L1:{rtt:!0,onUpdate:e,scale:4,pivot:0,visible:!1,Content:{shader:{type:Ge}}},L2:{rtt:!0,onUpdate:e,scale:8,pivot:0,visible:!1,Content:{shader:{type:Ge}}},L3:{rtt:!0,onUpdate:e,scale:16,pivot:0,visible:!1,Content:{shader:{type:Ge}}}}}}get _signalProxy(){return!0}constructor(e){super(e),this._textwrap=this.sel("Textwrap"),this._wrapper=this.sel("Textwrap.Content"),this._layers=this.sel("Layers"),this._amount=0,this._paddingX=0,this._paddingY=0}_build(){var e=[{x:1,y:0,kernelRadius:3},{x:0,y:1,kernelRadius:3},{x:1.5,y:0,kernelRadius:3},{x:0,y:1.5,kernelRadius:3}].map((e=>this.stage.createShader(Object.assign({type:We},e))));this._setLayerTexture(this.getLayerContents(0),this._textwrap.getTexture(),[]),this._setLayerTexture(this.getLayerContents(1),this.getLayer(0).getTexture(),[e[0],e[1]]),this._setLayerTexture(this.getLayerContents(2),this.getLayer(1).getTexture(),[e[0],e[1],e[2],e[3]]),this._setLayerTexture(this.getLayerContents(3),this.getLayer(2).getTexture(),[e[0],e[1],e[2],e[3]])}_setLayerTexture(e,t,i){if(i.length){var r=i.pop(),n=e.stage.c({rtt:!0,shader:r});this._setLayerTexture(n,t,i),e.childList.add(n)}else e.texture=t;return e}get content(){return this.sel("Textwrap.Content")}set content(e){this.sel("Textwrap.Content").patch(e)}set padding(e){this._paddingX=e,this._paddingY=e,this._updateBlurSize()}set paddingX(e){this._paddingX=e,this._updateBlurSize()}set paddingY(e){this._paddingY=e,this._updateBlurSize()}getLayer(e){return this._layers.sel("L"+e)}getLayerContents(e){return this.getLayer(e).sel("Content")}_onResize(){this._updateBlurSize()}_updateBlurSize(){var e=this.renderWidth,t=this.renderHeight,i=this._paddingX,r=this._paddingY,n=e+2*i,s=t+2*r;this._textwrap.w=n,this._wrapper.x=i,this.getLayer(0).w=this.getLayerContents(0).w=n/2,this.getLayer(1).w=this.getLayerContents(1).w=n/4,this.getLayer(2).w=this.getLayerContents(2).w=n/8,this.getLayer(3).w=this.getLayerContents(3).w=n/16,this._textwrap.x=-i,this._textwrap.h=s,this._wrapper.y=r,this.getLayer(0).h=this.getLayerContents(0).h=s/2,this.getLayer(1).h=this.getLayerContents(1).h=s/4,this.getLayer(2).h=this.getLayerContents(2).h=s/8,this.getLayer(3).h=this.getLayerContents(3).h=s/16,this._textwrap.y=-r,this.w=e,this.h=t}set amount(e){this._amount=e,this._update()}get amount(){return this._amount}_update(){var e=Math.min(4,Math.max(0,this._amount));e>0&&(this.getLayer(0).visible=e>0,this.getLayer(1).visible=e>1,this.getLayer(2).visible=e>2,this.getLayer(3).visible=e>3)}set shader(e){super.shader=e,this.renderToTexture||console.warn("[Lightning] Please enable renderToTexture to use with a shader.")}_firstActive(){this._build()}},SmoothScaleComponent:Ze,BorderComponent:class extends q{static _template(){return{Content:{},Borders:{Top:{rect:!0,visible:!1,mountY:1},Right:{rect:!0,visible:!1},Bottom:{rect:!0,visible:!1},Left:{rect:!0,visible:!1,mountX:1}}}}get _signalProxy(){return!0}constructor(e){super(e),this._borderTop=this.tag("Top"),this._borderRight=this.tag("Right"),this._borderBottom=this.tag("Bottom"),this._borderLeft=this.tag("Left"),this.onAfterUpdate=function(e){var t=e.childList.first,i=e.core.w||t.renderWidth,r=e.core.h||t.renderHeight;e._borderTop.w=i,e._borderBottom.y=r,e._borderBottom.w=i,e._borderLeft.h=r+e._borderTop.h+e._borderBottom.h,e._borderLeft.y=-e._borderTop.h,e._borderRight.x=i,e._borderRight.h=r+e._borderTop.h+e._borderBottom.h,e._borderRight.y=-e._borderTop.h},this.borderWidth=1}get content(){return this.sel("Content")}set content(e){this.sel("Content").patch(e,!0)}get borderWidth(){return this.borderWidthTop}get borderWidthTop(){return this._borderTop.h}get borderWidthRight(){return this._borderRight.w}get borderWidthBottom(){return this._borderBottom.h}get borderWidthLeft(){return this._borderLeft.w}set borderWidth(e){this.borderWidthTop=e,this.borderWidthRight=e,this.borderWidthBottom=e,this.borderWidthLeft=e}set borderWidthTop(e){this._borderTop.h=e,this._borderTop.visible=e>0}set borderWidthRight(e){this._borderRight.w=e,this._borderRight.visible=e>0}set borderWidthBottom(e){this._borderBottom.h=e,this._borderBottom.visible=e>0}set borderWidthLeft(e){this._borderLeft.w=e,this._borderLeft.visible=e>0}get colorBorder(){return this.colorBorderTop}get colorBorderTop(){return this._borderTop.color}get colorBorderRight(){return this._borderRight.color}get colorBorderBottom(){return this._borderBottom.color}get colorBorderLeft(){return this._borderLeft.color}set colorBorder(e){this.colorBorderTop=e,this.colorBorderRight=e,this.colorBorderBottom=e,this.colorBorderLeft=e}set colorBorderTop(e){this._borderTop.color=e}set colorBorderRight(e){this._borderRight.color=e}set colorBorderBottom(e){this._borderBottom.color=e}set colorBorderLeft(e){this._borderLeft.color=e}get borderTop(){return this._borderTop}set borderTop(e){this.borderTop.patch(e)}get borderRight(){return this._borderRight}set borderRight(e){this.borderRight.patch(e)}get borderBottom(){return this._borderBottom}set borderBottom(e){this.borderBottom.patch(e)}get borderLeft(){return this._borderLeft}set borderLeft(e){this.borderLeft.patch(e)}set borders(e){this.borderTop=e,this.borderLeft=e,this.borderBottom=e,this.borderRight=e}},ListComponent:class extends q{constructor(e){super(e),this._wrapper=super._children.a({}),this._reloadVisibleElements=!1,this._visibleItems=new Set,this._index=0,this._started=!1,this._scrollTransitionSettings=this.stage.transitions.createSettings({}),this._itemSize=100,this._viewportScrollOffset=0,this._itemScrollOffset=0,this._roll=!1,this._rollMin=0,this._rollMax=0,this._progressAnimation=null,this._invertDirection=!1,this._horizontal=!0,this.itemList=new Ve(this)}_allowChildrenAccess(){return!1}get items(){return this.itemList.get()}set items(e){this.itemList.patch(e)}start(){this._wrapper.transition(this.property,this._scrollTransitionSettings),this._scrollTransition=this._wrapper.transition(this.property),this._scrollTransition.on("progress",(e=>this.update())),this.setIndex(0,!0,!0),this._started=!0,this.update()}setIndex(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.length;if(r){if(this.emit("unfocus",this.getElement(this.realIndex),this._index,this.realIndex),i){var n=c.getModuloIndex(e,r)-c.getModuloIndex(this.index,r);n>.5*r?n-=r:n<-.5*r&&(n+=r),this._index+=n}else this._index=e;(this._roll||this.viewportSize>this._itemSize*r)&&(this._index=c.getModuloIndex(this._index,r));var s,a,o,h=this._horizontal^this._invertDirection?-1:1,u=h*this._index*this._itemSize;if(this._roll)if(1==h)a=(r-1)*this._itemSize,a-=o=this._viewportScrollOffset*this.viewportSize-this._itemScrollOffset*this._itemSize,s=this.viewportSize-(this._itemSize+o),this._rollMin&&(s-=this._rollMin),this._rollMax&&(a+=this._rollMax),u=Math.max(Math.min(u,a),s);else{a=r*this._itemSize-this.viewportSize,a+=o=this._viewportScrollOffset*this.viewportSize-this._itemScrollOffset*this._itemSize;var l=o;this._rollMin&&(l-=this._rollMin),this._rollMax&&(a+=this._rollMax),u=Math.min(Math.max(-a,u),-l)}this._scrollTransition.start(u),t&&this._scrollTransition.finish(),this.emit("focus",this.getElement(this.realIndex),this._index,this.realIndex)}}getAxisPosition(){var e=-this._scrollTransition._targetValue,t=-(this._horizontal^this._invertDirection?-1:1)*this._index*this._itemSize;return this._viewportScrollOffset*this.viewportSize+(t-e)}update(){if(this._started){var e=this.length;if(e){var t,i,r,n,s=this._horizontal^this._invertDirection?-1:1,a=this._horizontal?this._wrapper.x:this._wrapper.y,o=this.viewportSize,h=this._viewportScrollOffset*o-this._itemScrollOffset*this._itemSize;a+=h,-1==s?(t=Math.floor(-a/this._itemSize),r=1-(-a/this._itemSize-t),i=Math.floor((o-a)/this._itemSize),n=(o-a)/this._itemSize-i):(t=Math.ceil(a/this._itemSize),r=1+a/this._itemSize-t,n=(i=Math.ceil((a-o)/this._itemSize))-(a-o)/this._itemSize),(this._roll||o>this._itemSize*e)&&(i>=e&&(i=e-1,n=1),t>=e&&(t=e-1,r=1),i<=-1&&(i=0,n=1),t<=-1&&(t=0,r=1));for(var u,l=-s*t*this._itemSize,d=t;-1==s?d<=i:d>=i;-1==s?d++:d--){var p=c.getModuloIndex(d,e),g=this.getElement(p);u=g.parent,this._visibleItems.delete(u),this._horizontal?u.x=l+h:u.y=l+h;var f=u.visible;if(u.visible=!0,f&&!this._reloadVisibleElements||this.emit("visible",d,p),this._progressAnimation){var m=1;d==t?m=r:d==i&&(m=n),this._progressAnimation.apply(g,m)}l+=this._itemSize}var _=this;this._visibleItems.forEach((function(e){e.visible=!1,_._visibleItems.delete(e)}));for(var v=t;-1==s?v<=i:v>=i;-1==s?v++:v--){var y=c.getModuloIndex(v,e);this._visibleItems.add(this.getWrapper(y))}this._reloadVisibleElements=!1}}}setPrevious(){this.setIndex(this._index-1)}setNext(){this.setIndex(this._index+1)}getWrapper(e){return this._wrapper.children[e]}getElement(e){var t=this._wrapper.children[e];return t?t.children[0]:null}reload(){this._reloadVisibleElements=!0,this.update()}get element(){var e=this._wrapper.children[this.realIndex];return e?e.children[0]:null}get length(){return this._wrapper.children.length}get property(){return this._horizontal?"x":"y"}get viewportSize(){return this._horizontal?this.w:this.h}get index(){return this._index}get realIndex(){return c.getModuloIndex(this._index,this.length)}get itemSize(){return this._itemSize}set itemSize(e){this._itemSize=e,this.update()}get viewportScrollOffset(){return this._viewportScrollOffset}set viewportScrollOffset(e){this._viewportScrollOffset=e,this.update()}get itemScrollOffset(){return this._itemScrollOffset}set itemScrollOffset(e){this._itemScrollOffset=e,this.update()}get scrollTransitionSettings(){return this._scrollTransitionSettings}set scrollTransitionSettings(e){this._scrollTransitionSettings.patch(e)}set scrollTransition(e){this._scrollTransitionSettings.patch(e)}get scrollTransition(){return this._scrollTransition}get progressAnimation(){return this._progressAnimation}set progressAnimation(e){c.isObjectLiteral(e)?this._progressAnimation=this.stage.animations.createSettings(e):this._progressAnimation=e,this.update()}get roll(){return this._roll}set roll(e){this._roll=e,this.update()}get rollMin(){return this._rollMin}set rollMin(e){this._rollMin=e,this.update()}get rollMax(){return this._rollMax}set rollMax(e){this._rollMax=e,this.update()}get invertDirection(){return this._invertDirection}set invertDirection(e){this._started||(this._invertDirection=e)}get horizontal(){return this._horizontal}set horizontal(e){e!==this._horizontal&&(this._started||(this._horizontal=e))}}},tools:{ObjMerger:Ue,ObjectListProxy:ze,ObjectListWrapper:Be}};c.isWeb&&(window.lng=mt);var _t=class extends mt.shaders.WebGLDefaultShader{set brightness(e){this._brightness=(e-50)/100,this.redraw()}set contrast(e){this._contrast=(e+50)/100,this.redraw()}set gamma(e){this._gamma=(e+50)/100,this.redraw()}setupUniforms(e){super.setupUniforms(e);var t=this.gl;this._setUniform("colorAdjust",[this._brightness||0,this._contrast||1,this._gamma||1],t.uniform3fv)}};_t.before="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n        \n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    uniform vec3 colorAdjust;\n    \n    const mat3 RGBtoOpponentMat = mat3(0.2814, -0.0971, -0.0930, 0.6938, 0.1458,-0.2529, 0.0638, -0.0250, 0.4665);\n    const mat3 OpponentToRGBMat = mat3(1.1677, 0.9014, 0.7214, -6.4315, 2.5970, 0.1257, -0.5044, 0.0159, 2.0517);    \n",_t.after="    \n    vec3 brightnessContrast(vec3 value, float brightness, float contrast)\n    {\n        return (value - 0.5) * contrast + 0.5 + brightness;\n    }   \n    \n    vec3 updateGamma(vec3 value, float param)\n    {\n        return vec3(pow(abs(value.r), param),pow(abs(value.g), param),pow(abs(value.b), param));\n    } \n       \n    void main(void){\n        vec4 fragColor = texture2D(uSampler, vTextureCoord);        \n        vec4 color = filter(fragColor) * vColor;       \n        \n        vec3 bc = brightnessContrast(color.rgb,colorAdjust[0],colorAdjust[1]);        \n        vec3 ga = updateGamma(bc.rgb, colorAdjust[2]);  \n              \n        gl_FragColor = vec4(ga.rgb, color.a);          \n    }    \n";class vt extends _t{}vt.fragmentShaderSource=`\n    ${_t.before}    \n    vec4 vision(vec4 color)\n    {\n        vec4 r = vec4( 0.20,  0.99, -0.19, 0.0);\n        vec4 g = vec4( 0.16,  0.79,  0.04, 0.0);\n        vec4 b = vec4( 0.01, -0.01,  1.00, 0.0);\n       \n        return vec4(dot(color, r), dot(color, g), dot(color, b), color.a);\t\n    }\n    \n    vec4 filter( vec4 color )\n    {   \n        vec3 opponentColor = RGBtoOpponentMat * vec3(color.r, color.g, color.b);\n        opponentColor.x -= opponentColor.y * 1.5; \n        vec3 rgbColor = OpponentToRGBMat * opponentColor;\n        return vision(vec4(rgbColor.r, rgbColor.g, rgbColor.b, color.a));      \n    }    \n    ${_t.after} \n`;class yt extends _t{}yt.fragmentShaderSource=`\n    ${_t.before}\n    vec4 vision(vec4 color)\n    {\n        vec4 r = vec4( 0.43,  0.72, -0.15, 0.0 );\n        vec4 g = vec4( 0.34,  0.57,  0.09, 0.0 );\n        vec4 b = vec4(-0.02,  0.03,  1.00, 0.0 );\n       \n        return vec4(dot(color, r), dot(color, g), dot(color, b), color.a);\t\n    }\n       \n    vec4 filter( vec4 color )\n    {   \n        vec3 opponentColor = RGBtoOpponentMat * vec3(color.r, color.g, color.b);\n        opponentColor.x -= opponentColor.y * 1.5; \n        vec3 rgbColor = OpponentToRGBMat * opponentColor;\n        return vision(vec4(rgbColor.r, rgbColor.g, rgbColor.b, color.a));    \n    }\n    ${_t.after}    \n`;class xt extends _t{}xt.fragmentShaderSource=`\n    ${_t.before}    \n    vec4 vision(vec4 color)\n    {\n        vec4 r = vec4( 0.97,  0.11, -0.08, 0.0 );\n        vec4 g = vec4( 0.02,  0.82,  0.16, 0.0 );\n        vec4 b = vec4(-0.06,  0.88,  0.18, 0.0 );\n       \n        return vec4(dot(color, r), dot(color, g), dot(color, b), color.a);\t\n    }   \n    \n    vec4 filter( vec4 color )\n    {   \n        vec3 opponentColor = RGBtoOpponentMat * vec3(color.r, color.g, color.b);\n        opponentColor.x -= ((3.0 * opponentColor.z) - opponentColor.y) * 0.25;\n        vec3 rgbColor = OpponentToRGBMat * opponentColor;\n        return vision(vec4(rgbColor.r, rgbColor.g, rgbColor.b, color.a));\n    }   \n    ${_t.after} \n`;class bt extends _t{}bt.fragmentShaderSource=`\n    ${_t.before}\n    vec4 filter( vec4 color )\n    {\n        return color;\n    }\n    ${_t.after}\n`;class wt extends _t{}wt.fragmentShaderSource=`\n    ${_t.before}\n    vec4 filter( vec4 color )\n    {   \n        float grey = dot(color.rgb, vec3(0.299, 0.587, 0.114));\n        return vec4(vec3(grey, grey, grey), 1.0 ); \n    }\n    ${_t.after}\n`;var Tt,St,At,Ct,Et,It,Rt,Lt,kt,Mt,Pt,Ot={colorshift(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{brightness:50,contrast:50,gamma:50};i=s(s({},{brightness:50,contrast:50,gamma:50}),i);var r=t&&(e=>{var t={normal:bt,monochromacy:wt,deuteranopia:yt,tritanopia:xt,protanopia:vt};return e="string"==typeof e&&e.toLowerCase()||null,Object.keys(t).indexOf(e)>-1&&t[e]})(t);r?(u.info("Accessibility Colorshift",t,i),e.rtt=!0,e.shader=s({type:r},i)):(u.info("Accessibility Colorshift","Disabled"),e.rtt=!1,e.shader=null)}},Dt={set log(e){Tt=e},set settings(e){St=e},set ads(e){Ct=e},set lightning(e){Et=e},set appInstance(e){At=e}},Nt=(e,t,i)=>{Tt.info("Sending metric",e,t,i)},Ft=function(e,t,i,r){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};n=s({params:n},{message:t,code:i,visible:r}),Nt(e,"error",n)},Ut=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return t.reduce(((t,r)=>(t[r]=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};n=s(s(s({},i),t?{name:t}:{}),n),Nt(e,r,n)},t)),{error(t,i,r){Ft(e,t,i,r)},event(t,i){Nt(e,t,i)}})},zt=(e=>Object.keys(e).reduce(((t,i)=>(t[i]="media"===i?t=>Ut(i,e[i],{url:t}):Ut(i,e[i]),t)),{error:Ft,event:Nt}))({app:["launch","loaded","ready","close"],page:["view","leave"],user:["click","input"],media:["abort","canplay","ended","pause","play","volumechange","waiting","seeking","seeked"]}),Bt=e=>e&&2===e.length?`${e.toLowerCase()}-${e.toUpperCase()}`:e,jt=e=>new Promise((t=>{new Promise((e=>{!0===St.get("platform","forceBrowserGeolocation")&&e(!0),"permissions"in navigator&&"function"==typeof navigator.permissions.query?navigator.permissions.query({name:"geolocation"}).then((t=>{e("granted"===t.state||"granted"===t.status)})):e(!1)})).then((i=>!0!==i?Ht().then((i=>t(i||e))):"geolocation"in navigator?void navigator.geolocation.getCurrentPosition((e=>e&&e.coords&&t([e.coords.latitude,e.coords.longitude])),(()=>t(e)),{enableHighAccuracy:!0,timeout:5e3,maximumAge:0}):Ht().then((i=>t(i||e)))))})),Ht=()=>new Promise((e=>{fetch("https://geolocation-db.com/json/").then((e=>e.json())).then((t=>{var i=t.latitude,r=t.longitude;return e(!(!i||!r)&&[i,r])})).catch((()=>e(!1)))})),Vt={ageRating:"adult",city:"New York",zipCode:"27505",countryCode:()=>(e=>{if("language"in navigator){var t=Bt(navigator.language).slice(3,5);return Promise.resolve(t)}return Promise.resolve(e)})("US"),ip:"127.0.0.1",household:"b2244e9d4c04826ccd5a7b2c2a50e7d4",language:()=>(e=>{if("language"in navigator){var t=Bt(navigator.language).slice(0,2);return Promise.resolve(t)}return Promise.resolve(e)})("en"),latlon:()=>jt([40.7128,74.006]),locale:()=>(e=>{if("language"in navigator){var t=Bt(navigator.language);return Promise.resolve(t)}return Promise.resolve(e)})("en-US"),mac:"00:00:00:00:00:00",operator:"metrological",platform:"metrological",packages:[],uid:"ee6723b8-7ab3-462c-8d93-dbf61227998e",stbType:"metrological"},Wt=e=>{var t=s(s({},Vt),St.get("platform","profile"));return Promise.resolve("function"==typeof t[e]?t[e]():t[e])},Gt=(e,t)=>{if(e in Vt)return Vt[e]=t},Xt=[{number:1,name:"Metro News 1",description:"New York Cable News Channel",entitled:!0,program:{title:"The Morning Show",description:"New York's best morning show",startTime:new Date(new Date-3e5).toUTCString(),duration:1800,ageRating:0}},{number:2,name:"MTV",description:"Music Television",entitled:!0,program:{title:"Beavis and Butthead",description:"American adult animated sitcom created by Mike Judge",startTime:new Date(new Date-12e5).toUTCString(),duration:2700,ageRating:18}},{number:3,name:"NBC",description:"NBC TV Network",entitled:!1,program:{title:"The Tonight Show Starring Jimmy Fallon",description:"Late-night talk show hosted by Jimmy Fallon on NBC",startTime:new Date(new Date-6e5).toUTCString(),duration:3600,ageRating:10}}],qt=()=>St.get("platform","tv",Xt),Yt=()=>qt()[~~(qt.length*Math.random())],$t={},Kt=function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];$t[e]&&$t[e].forEach((e=>{e.apply(null,i)}))},Zt={getChannel:()=>(It||(It=Yt()),new Promise(((e,t)=>{if(It){var i=s({},It);delete i.program,e(i)}else t("No channel found")}))),getProgram:()=>(It||(It=Yt()),new Promise(((e,t)=>{It.program?e(It.program):t("No program found")}))),setChannel:e=>new Promise(((t,i)=>{if(e){var r=qt().find((t=>t.number===e));if(r){var n=s({},It=r);delete n.program,Kt("channelChange",n),t(n)}else i("Channel not found")}else i("No channel number supplied")}))},Qt={abort:"Abort",canplay:"CanPlay",canplaythrough:"CanPlayThrough",durationchange:"DurationChange",emptied:"Emptied",encrypted:"Encrypted",ended:"Ended",error:"Error",interruptbegin:"InterruptBegin",interruptend:"InterruptEnd",loadeddata:"LoadedData",loadedmetadata:"LoadedMetadata",loadstart:"LoadStart",pause:"Pause",play:"Play",playing:"Playing",progress:"Progress",ratechange:"Ratechange",seeked:"Seeked",seeking:"Seeking",stalled:"Stalled",timeupdate:"TimeUpdate",volumechange:"VolumeChange",waiting:"Waiting"},Jt=null,ei=()=>class extends Et.Component{static _template(){return{Video:{alpha:1,visible:!1,pivot:.5,texture:{type:Et.textures.StaticTexture,options:{}}}}}set videoEl(e){this._videoEl=e}get videoEl(){return this._videoEl}get videoView(){return this.tag("Video")}get videoTexture(){return this.videoView.texture}get isVisible(){return 1===this.videoView.alpha&&!0===this.videoView.visible}_init(){this._createVideoTexture()}_createVideoTexture(){var e=this.stage.gl,t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),this.videoTexture.options={source:t,w:this.videoEl.width,h:this.videoEl.height},this.videoView.w=this.videoEl.width/this.stage.getRenderPrecision(),this.videoView.h=this.videoEl.height/this.stage.getRenderPrecision()}start(){var e=this.stage;this._lastTime=0,this._updateVideoTexture||(this._updateVideoTexture=()=>{if(this.videoTexture.options.source&&this.videoEl.videoWidth&&this.active){var t=e.gl,i=(new Date).getTime(),r=this.videoEl.getVideoPlaybackQuality(),n=r?r.totalVideoFrames:this.videoEl.webkitDecodedFrameCount;if(n?this._lastFrame!==n:this._lastTime<i-30){this._lastTime=i,this._lastFrame=n;try{t.bindTexture(t.TEXTURE_2D,this.videoTexture.options.source),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this.videoEl),this._lastFrame=this.videoEl.webkitDecodedFrameCount,this.videoView.visible=!0,this.videoTexture.options.w=this.videoEl.width,this.videoTexture.options.h=this.videoEl.height;var s=this.videoView.w/this.videoView.h,a=this.videoEl.width/this.videoEl.height;s>a?(this.videoView.scaleX=a/s,this.videoView.scaleY=1):(this.videoView.scaleY=s/a,this.videoView.scaleX=1)}catch(o){Tt.error("texImage2d video",o),this.stop()}this.videoTexture.source.forceRenderUpdate()}}}),this._updatingVideoTexture||(e.on("frameStart",this._updateVideoTexture),this._updatingVideoTexture=!0)}stop(){var e=this.stage;if(e.removeListener("frameStart",this._updateVideoTexture),this._updatingVideoTexture=!1,this.videoView.visible=!1,this.videoTexture.options.source){var t=e.gl;t.bindTexture(t.TEXTURE_2D,this.videoTexture.options.source),t.clearColor(0,0,0,1),t.clear(t.COLOR_BUFFER_BIT)}}position(e,t){this.videoView.patch({smooth:{x:t,y:e}})}size(e,t){this.videoView.patch({smooth:{w:e,h:t}})}show(){this.videoView.setSmooth("alpha",1)}hide(){this.videoView.setSmooth("alpha",0)}},ti=e=>e,ii=1,ri=!1,ni={},si={adsEnabled:!1,playing:!1,_playingAds:!1,get playingAds(){return this._playingAds},set playingAds(e){this._playingAds!==e&&(this._playingAds=e,hi(!0===e?"AdStart":"AdEnd"))},skipTime:!1,playAfterSeek:null},ai={play(){si.playing=!0},pause(){si.playing=!1},seeked(){!0===si.playAfterSeek&&pi.play(),si.playAfterSeek=null},abort(){di()}},oi=e=>Math.round(ii*e)+"px",hi=(e,t)=>{Mt&&(Mt.fire("$videoPlayer"+e,t,Rt.currentTime),Mt.fire("$videoPlayerEvent",e,t,Rt.currentTime))},ui=null,li=null,ci=()=>{Tt.info("VideoPlayer","Registering event listeners"),Object.keys(Qt).forEach((e=>{var t=t=>{kt&&kt[e]&&"function"==typeof kt[e]&&kt[e]({currentTime:Rt.currentTime}),((e,t)=>{ai[e]&&"function"==typeof ai[e]&&ai[e].call(null,e,t)})(e,{videoElement:Rt,event:t}),hi(Qt[e],{videoElement:Rt,event:t})};ni[e]=t,Rt.addEventListener(e,t)}))},di=()=>{Tt.info("VideoPlayer","Deregistering event listeners"),Object.keys(ni).forEach((e=>{Rt.removeEventListener(e,ni[e])})),ni={}},pi={consumer(e){Mt=e},loader(e){ui=e},unloader(e){li=e},position(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Rt.style.left=oi(t),Rt.style.top=oi(e),!0===ri&&Lt.position(e,t)},size(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1920,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1080;Rt.style.width=oi(e),Rt.style.height=oi(t),Rt.width=parseFloat(Rt.style.width),Rt.height=parseFloat(Rt.style.height),!0===ri&&Lt.size(e,t)},area(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1920,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1080,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.position(e,r),this.size(t-r,i-e)},open(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.canInteract)if(kt=zt.media(e),this.hide(),di(),this.src==e)this.clear().then(this.open(e,t));else{var i={enabled:si.adsEnabled,duration:300};t.videoId&&(i.caid=t.videoId),Ct.get(i,Mt).then((i=>{si.playingAds=!0,i.prerolls().then((()=>{si.playingAds=!1,((e,t,i)=>ui&&"function"==typeof ui?ui(e,t,i):new Promise((i=>{e=ti(e),t.setAttribute("src",e),t.load(),i()})))(e,Rt,t).then((()=>{ci(),this.show(),this.play()})).catch((e=>{hi("error",{videoElement:Rt,event:e})}))}))}))}},reload(){if(this.canInteract){var e=Rt.getAttribute("src");this.close(),this.open(e)}},close(){Ct.cancel(),si.playingAds&&(si.playingAds=!1,Ct.stop(),setTimeout((()=>{this.close()}))),this.canInteract&&(this.clear(),this.hide(),di())},clear(){if(this.canInteract)return this.pause(),!0===ri&&Lt.stop(),(e=>li&&"function"==typeof li?li(e):new Promise((t=>{e.removeAttribute("src"),e.load(),t()})))(Rt).then((()=>{hi("Clear",{videoElement:Rt})}))},play(){this.canInteract&&(!0===ri&&Lt.start(),function(e){var t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(e&&"function"==typeof e)try{t=e.apply(r,i)}catch(n){t=n}else t=e;return null!==t&&"object"==typeof t&&t.then&&"function"==typeof t.then?t:new Promise(((e,i)=>{t instanceof Error?i(t):e(t)}))}(Rt.play,null,Rt).catch((e=>{hi("error",{videoElement:Rt,event:e})})))},pause(){this.canInteract&&Rt.pause()},playPause(){this.canInteract&&(!0===this.playing?this.pause():this.play())},mute(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.canInteract&&(Rt.muted=e)},loop(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];Rt.loop=e},seek(e){this.canInteract&&this.src&&(null===si.playAfterSeek&&(si.playAfterSeek=!!si.playing),this.pause(),Rt.currentTime=Math.max(0,Math.min(e,this.duration-.1)))},skip(e){var t,i;this.canInteract&&(this.src&&(si.skipTime=(si.skipTime||Rt.currentTime)+e,t=()=>{this.seek(si.skipTime),si.skipTime=!1},i=300,clearTimeout(Jt),Jt=setTimeout((()=>{t()}),i)))},show(){this.canInteract&&(!0===ri?Lt.show():(Rt.style.display="block",Rt.style.visibility="visible"))},hide(){this.canInteract&&(!0===ri?Lt.hide():(Rt.style.display="none",Rt.style.visibility="hidden"))},enableAds(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];si.adsEnabled=e},get duration(){return Rt&&(isNaN(Rt.duration)?1/0:Rt.duration)},get currentTime(){return Rt&&Rt.currentTime},get muted(){return Rt&&Rt.muted},get looped(){return Rt&&Rt.loop},get src(){return Rt&&Rt.getAttribute("src")},get playing(){return si.playing},get playingAds(){return si.playingAds},get canInteract(){return!1===si.playingAds},get top(){return Rt&&parseFloat(Rt.style.top)},get left(){return Rt&&parseFloat(Rt.style.left)},get bottom(){return Rt&&parseFloat(Rt.style.top-Rt.style.height)},get right(){return Rt&&parseFloat(Rt.style.left-Rt.style.width)},get width(){return Rt&&parseFloat(Rt.style.width)},get height(){return Rt&&parseFloat(Rt.style.height)},get visible(){return!0===ri?Lt.isVisible:Rt&&"block"===Rt.style.display},get adsEnabled(){return si.adsEnabled},get _videoEl(){return Rt},get _consumer(){return Mt}},gi=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>{},i=!1,r=()=>{!1===i&&(t(),i=!0)};return Object.keys(e).reduce(((t,i)=>("function"==typeof e[i]?t[i]=function(){return r(),e[i].apply(e,arguments)}:"function"==typeof Object.getOwnPropertyDescriptor(e,i).get?t.__defineGetter__(i,(function(){return r(),Object.getOwnPropertyDescriptor(e,i).get.apply(e)})):"function"==typeof Object.getOwnPropertyDescriptor(e,i).set?t.__defineSetter__(i,(function(){return r(),Object.getOwnPropertyDescriptor(e,i).set.sourceObject[i].apply(e,arguments)})):t[i]=e[i],t)),{})}(pi,(()=>{ii=At&&At.stage&&At.stage.getRenderPrecision()||ii,Rt=(()=>{var e=document.getElementsByTagName("video");if(e&&e.length)return e[0];var t=document.createElement("video"),i=St.get("platform","width")?St.get("platform","width"):1920,r=St.get("platform","height")?St.get("platform","height"):1080;return t.setAttribute("id","video-player"),t.setAttribute("width",oi(i)),t.setAttribute("height",oi(r)),t.style.position="absolute",t.style.zIndex="1",t.style.display="none",t.style.visibility="hidden",t.style.top=oi(0),t.style.left=oi(0),t.style.width=oi(i),t.style.height=oi(r),document.body.appendChild(t),t})(),!0===(ri=St.get("platform","textureMode",!1))&&(Rt.setAttribute("crossorigin","anonymous"),Lt=(()=>{if(!At.tag("VideoTexture")){var e=At.stage.c({type:ei(),ref:"VideoTexture",zIndex:0,videoEl:Rt});At.childList.addAt(e,0)}return At.tag("VideoTexture")})())})),fi=()=>Promise.resolve({prerolls:[],midrolls:[],postrolls:[]}),mi={active:!1},_i=e=>new Promise((t=>{if(!1===mi.active)return u.info("Ad","Skipping add due to inactive state"),t();var i=document.getElementsByTagName("video")[0];i.style.display="block",i.style.visibility="visible",i.src=ti(e.url),i.load();var r,n=null,s=()=>{Object.keys(a).forEach((e=>i.removeEventListener(e,a[e]))),t()},a={play(){u.info("Ad","Play ad",e.url),yi("Play",e),vi(e.callbacks,"defaultImpression")},ended(){yi("Ended",e),vi(e.callbacks,"complete"),s()},timeupdate(){!n&&i.duration&&(n={firstQuartile:i.duration/4,midPoint:i.duration/2,thirdQuartile:i.duration/4*3},u.info("Ad","Calculated quartiles times",{timeEvents:n})),n&&n.firstQuartile&&i.currentTime>=n.firstQuartile&&(yi("FirstQuartile",e),delete n.firstQuartile,vi(e.callbacks,"firstQuartile")),n&&n.midPoint&&i.currentTime>=n.midPoint&&(yi("MidPoint",e),delete n.midPoint,vi(e.callbacks,"midPoint")),n&&n.thirdQuartile&&i.currentTime>=n.thirdQuartile&&(yi("ThirdQuartile",e),delete n.thirdQuartile,vi(e.callbacks,"thirdQuartile"))},stalled(){yi("Stalled",e),r=setTimeout((()=>{s()}),5e3)},canplay(){r&&clearTimeout(r)},error(){yi("Error",e),s()},abort(){s()}};Object.keys(a).forEach((e=>i.addEventListener(e,a[e]))),i.play()})),vi=(e,t)=>{if(e&&e[t])return u.info("Ad","Sending beacon",t,e[t]),e[t].reduce(((e,i)=>e.then((()=>fetch(i).then((e=>{200===e.status?yi("Beacon"+t+"Sent"):yi("Beacon"+t+"Failed"+e.status),Promise.resolve(null)})).catch((()=>{Promise.resolve(null)}))))),Promise.resolve(null));u.info("Ad","No callback found for "+t)},yi=(e,t)=>{Pt&&(Pt.fire("$ad"+e,t),Pt.fire("$adEvent",e,t))},xi={get:(e,t)=>!1===e.enabled?Promise.resolve({prerolls:()=>Promise.resolve()}):(Pt=t,new Promise((t=>{u.info("Ad","Starting session"),fi(e).then((e=>{u.info("Ad","API result",e),t({prerolls:()=>e.preroll?(mi.active=!0,yi("PrerollSlotImpression",e),vi(e.preroll.callbacks,"slotImpression"),function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).reduce(((e,t)=>e.then((()=>_i(t)))),Promise.resolve(null))}(e.preroll.ads).then((()=>{yi("PrerollSlotEnd",e),vi(e.preroll.callbacks,"slotEnd"),mi.active=!1}))):Promise.resolve(),midrolls:()=>Promise.resolve(),postrolls:()=>Promise.resolve()})}))}))),cancel(){u.info("Ad","Cancel Ad"),mi.active=!1},stop(){u.info("Ad","Stop Ad"),mi.active=!1;var e=document.getElementsByTagName("video")[0];e.pause(),e.removeAttribute("src")}},bi="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function wi(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Ti=function(e){return function(e){return!!e&&"object"==typeof e}(e)&&!function(e){var t=Object.prototype.toString.call(e);return"[object RegExp]"===t||"[object Date]"===t||function(e){return e.$$typeof===Si}(e)}(e)};var Si="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function Ai(e,t){return!1!==t.clone&&t.isMergeableObject(e)?Li((i=e,Array.isArray(i)?[]:{}),e,t):e;var i}function Ci(e,t,i){return e.concat(t).map((function(e){return Ai(e,i)}))}function Ei(e){return Object.keys(e).concat(function(e){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(e).filter((function(t){return Object.propertyIsEnumerable.call(e,t)})):[]}(e))}function Ii(e,t){try{return t in e}catch(i){return!1}}function Ri(e,t,i){var r={};return i.isMergeableObject(e)&&Ei(e).forEach((function(t){r[t]=Ai(e[t],i)})),Ei(t).forEach((function(n){(function(e,t){return Ii(e,t)&&!(Object.hasOwnProperty.call(e,t)&&Object.propertyIsEnumerable.call(e,t))})(e,n)||(Ii(e,n)&&i.isMergeableObject(t[n])?r[n]=function(e,t){if(!t.customMerge)return Li;var i=t.customMerge(e);return"function"==typeof i?i:Li}(n,i)(e[n],t[n],i):r[n]=Ai(t[n],i))})),r}function Li(e,t,i){(i=i||{}).arrayMerge=i.arrayMerge||Ci,i.isMergeableObject=i.isMergeableObject||Ti,i.cloneUnlessOtherwiseSpecified=Ai;var r=Array.isArray(t);return r===Array.isArray(e)?r?i.arrayMerge(e,t,i):Ri(e,t,i):Ai(t,i)}Li.all=function(e,t){if(!Array.isArray(e))throw new Error("first argument should be an array");return e.reduce((function(e,i){return Li(e,i,t)}),{})};var ki=wi(Li),Mi=!1,Pi=function(){!0!==(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&!1!==Mi||console.warn(["The 'Locale'-plugin in the Lightning-SDK is deprecated and will be removed in future releases.","Please consider using the new 'Language'-plugin instead.","https://rdkcentral.github.io/Lightning-SDK/#/plugins/language"].join("\n\n")),Mi=!0};class Oi extends String{format(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var r=t.reduce(((e,t,i)=>e.split(`{${i}}`).join(t)),this);return new Oi(r)}}var Di=new class{constructor(){this.__enabled=!1}load(e){var i=this;return r(t().mark((function r(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i.__enabled){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,fetch(e).then((e=>e.json())).then((e=>{i.loadFromObject(e)}));case 4:case"end":return t.stop()}}),r)})))()}setLanguage(e){Pi(),this.__enabled=!0,this.language=e}get tr(){return Pi(!0),this.__trObj[this.language]}loadFromObject(e){Pi();var t="en";if(-1===Object.keys(e).indexOf(this.language)){if(u.warn("No translations found for: "+this.language),!(Object.keys(e).indexOf(t)>-1)){var i="No translations found for fallback language: en";throw u.error(i),Error(i)}u.warn("Using fallback language: en"),this.language=t}this.__trObj=e;for(var r=0,n=Object.values(this.__trObj);r<n.length;r++)for(var s=n[r],a=0,o=Object.keys(s);a<o.length;a++){var h=o[a];s[h]=new Oi(s[h])}}};class Ni extends mt.Component{static _template(){return{rect:!0,color:3137370284,h:40,w:100,x:e=>e-50,y:e=>e-50,mount:1,Text:{w:e=>e,h:e=>e,y:5,x:20,text:{fontSize:22,lineHeight:26}}}}_firstActive(){this.tag("Text").text=`APP - v${this.version}\nSDK - v${this.sdkVersion}`,this.tag("Text").loadTexture(),this.w=this.tag("Text").renderWidth+40,this.h=this.tag("Text").renderHeight+5}}class Fi extends mt.Component{static _template(){return{rect:!0,color:4294967295,texture:mt.Tools.getRoundRect(80,80,40),h:80,w:80,x:100,y:100,mount:1,Background:{x:3,y:3,texture:mt.Tools.getRoundRect(72,72,36),color:4278222848},Counter:{w:e=>e,h:e=>e,y:10,text:{fontSize:32,textAlign:"center"}},Text:{w:e=>e,h:e=>e,y:48,text:{fontSize:15,textAlign:"center",text:"FPS"}}}}_setup(){this.config=s(s({},{log:!1,interval:500,threshold:1}),a.get("platform","showFps")),this.fps=0,this.lastFps=this.fps-this.config.threshold;var e=()=>{this.fps=~~(1/this.stage.dt)};this.stage.on("frameStart",e),this.stage.off("framestart",e),this.interval=setInterval(this.showFps.bind(this),this.config.interval)}_firstActive(){this.showFps()}_detach(){clearInterval(this.interval)}showFps(){if(!(Math.abs(this.lastFps-this.fps)<=this.config.threshold)){this.lastFps=this.fps;var e=4278222848;this.fps<=40&&this.fps>20?e=4294944e3:this.fps<=20&&(e=4294901760),this.tag("Background").setSmooth("color",e),this.tag("Counter").text=`${this.fps}`,this.config.log&&u.info("FPS",this.fps)}}}var Ui,zi,Bi,ji=e=>new Promise(((t,i)=>{var r=new XMLHttpRequest;r.onreadystatechange=function(){r.readyState==XMLHttpRequest.DONE&&(0===r.status||200===r.status?t(JSON.parse(r.responseText)):i(r.statusText))},r.open("GET",e),r.send(null)})),Hi={asset:e=>Ui+e,proxyUrl(e){return zi?zi+"?"+Xi(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}):e},makeQueryString(){return Xi(...arguments)},ensureUrlWithProtocol(){return Vi(...arguments)}},Vi=e=>/^\/[^/]/i.test(e)&&/^(?:file:)/i.test(window.location.protocol)?window.location.protocol+"//"+e:/^\/\//.test(e)?window.location.protocol+e:/^(?:https?:)/i.test(e)?e:window.location.origin+e,Wi=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/",t=arguments.length>1?arguments[1]:void 0;return t="/"!==t.charAt(t.length-1)?t+"/":t,/^(?:https?:)?(?:\/\/)/.test(t)||"/"===t.charAt(0)?t:(e=Gi(e))+(t="/"!==(t="."===t.charAt(0)?t.substr(1):t).charAt(0)?"/"+t:t)},Gi=e=>{if("/"===e.slice(-1))return e.slice(0,-1);var t=e.split("/");return t[t.length-1].indexOf(".")>-1&&t.pop(),t.join("/")},Xi=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"url";return t.operator="metrological",t[i]=e,Object.keys(t).map((e=>encodeURIComponent(e)+"="+encodeURIComponent(""+t[e]))).join("&")},qi={},Yi={},$i=null,Ki=e=>{"meta"in e&&(qi=s({},e.meta),delete e.meta),Yi=e},Zi=e=>($i=null,new Promise(((t,i)=>{if(e in Yi)$i=e;else if("map"in qi&&e in qi.map&&qi.map[e]in Yi)$i=qi.map[e];else if("default"in qi&&qi.default in Yi){var r="Translations for Language "+$i+" not found. Using default language "+qi.default;u.warn(r),$i=qi.default}else{var n="Translations for Language "+$i+" not found.";u.error(n),i(n)}if($i){u.info("Setting language to",$i);var s=Yi[$i];if("object"==typeof s)t();else if("string"==typeof s){var a=Hi.asset(s);ji(a).then((e=>{Yi[$i]=e,t()})).catch((e=>{var t="Error while fetching "+a;u.error(t,e),i(t)}))}}}))),Qi={eventListeners:[],timeouts:[],intervals:[],targets:[]},Ji={setTimeout(e,t){for(var i=arguments.length,r=new Array(i>2?i-2:0),n=2;n<i;n++)r[n-2]=arguments[n];var s=setTimeout((()=>{Qi.timeouts=Qi.timeouts.filter((e=>e!==s)),e.apply(null,r)}),t,r);return u.info("Set Timeout","ID: "+s),Qi.timeouts.push(s),s},clearTimeout(e){Qi.timeouts.indexOf(e)>-1?(Qi.timeouts=Qi.timeouts.filter((t=>t!==e)),u.info("Clear Timeout","ID: "+e),clearTimeout(e)):u.error("Clear Timeout","ID "+e+" not found")},clearTimeouts(){Qi.timeouts.forEach((e=>{this.clearTimeout(e)}))},setInterval(e,t){for(var i=arguments.length,r=new Array(i>2?i-2:0),n=2;n<i;n++)r[n-2]=arguments[n];var s=setInterval((()=>{Qi.intervals.filter((e=>e!==s)),e.apply(null,r)}),t,r);return u.info("Set Interval","ID: "+s),Qi.intervals.push(s),s},clearInterval(e){Qi.intervals.indexOf(e)>-1?(Qi.intervals=Qi.intervals.filter((t=>t!==e)),u.info("Clear Interval","ID: "+e),clearInterval(e)):u.error("Clear Interval","ID "+e+" not found")},clearIntervals(){Qi.intervals.forEach((e=>{this.clearInterval(e)}))},addEventListener(e,t,i){e.addEventListener(t,i);var r=Qi.targets.indexOf(e)>-1?Qi.targets.indexOf(e):Qi.targets.push(e)-1;Qi.eventListeners[r]=Qi.eventListeners[r]||{},Qi.eventListeners[r][t]=Qi.eventListeners[r][t]||[],Qi.eventListeners[r][t].push(i),u.info("Add eventListener","Target:",e,"Event: "+t,"Handler:",i.toString())},removeEventListener(e,t,i){var r=Qi.targets.indexOf(e);r>-1&&Qi.eventListeners[r]&&Qi.eventListeners[r][t]&&Qi.eventListeners[r][t].indexOf(i)>-1?(Qi.eventListeners[r][t]=Qi.eventListeners[r][t].filter((e=>e!==i)),u.info("Remove eventListener","Target:",e,"Event: "+t,"Handler:",i.toString()),e.removeEventListener(t,i)):u.error("Remove eventListener","Not found","Target",e,"Event: "+t,"Handler",i.toString())},removeEventListeners(e,t){if(e&&t){var i=Qi.targets.indexOf(e);i>-1&&Qi.eventListeners[i][t].forEach((i=>{this.removeEventListener(e,t,i)}))}else if(e){var r=Qi.targets.indexOf(e);r>-1&&Object.keys(Qi.eventListeners[r]).forEach((t=>{this.removeEventListeners(e,t)}))}else Object.keys(Qi.eventListeners).forEach((e=>{this.removeEventListeners(Qi.targets[e])}))},clear(){this.clearTimeouts(),this.clearIntervals(),this.removeEventListeners(),Qi.eventListeners=[],Qi.timeouts=[],Qi.intervals=[],Qi.targets=[]}},er=e=>"string"==typeof e,tr=e=>{var t=(e=>({r:(e/65536|0)%256,g:(e/256|0)%256,b:1*e%256,a:e/16777216|0}))(e),i=t.r/255,r=t.g/255,n=t.b/255,s=Math.max(i,r,n),a=Math.min(i,r,n),o=0,h=0,u=.5*(a+s);if(u>0){var l=s-a;if(l>0){var c=(s-i)/l,d=(s-r)/l,p=(s-n)/l;h=u<.5?s+a:2-s-a,o=i===s&&r===a?5+p:i===s?1-d:r===s&&n===a?1+c:r===s?3-p:n===s?3+d:5-c,o/=6}}return{h:o%1,s:h,l:u,a:t.a}},ir=e=>{var t=1,i=1,r=1,n=e.h,s=e.s,a=e.l;n<0&&(n+=1);var o=0;if((o=a<=.5?a*(1+s):a+s-a*s)>0){n*=6;var h=a+a-o,u=(o-h)/o,l=Math.floor(n),c=o*u*(n-l),d=h+c,p=o-c;0===l&&(t=o,i=d,r=h),1===l&&(t=p,i=o,r=h),2===l&&(t=h,i=o,r=d),3===l&&(t=h,i=p,r=o),4===l&&(t=d,i=h,r=o),5===l&&(t=o,i=h,r=p)}return(e=>{e[0]=Math.max(0,Math.min(255,e[0])),e[1]=Math.max(0,Math.min(255,e[1])),e[2]=Math.max(0,Math.min(255,e[2])),e[3]=Math.max(0,Math.min(255,e[3]));var t=((0|e[3])<<24)+((0|e[0])<<16)+((0|e[1])<<8)+(0|e[2]);return t<0&&(t=4294967295+t+1),t})([Math.floor(255*t),Math.floor(255*i),Math.floor(255*r),e.a])},rr={white:"#ffffff",black:"#000000",red:"#ff0000",green:"#00ff00",blue:"#0000ff",yellow:"#feff00",cyan:"#00feff",magenta:"#ff00ff"},nr={},sr=(e,t)=>{var i;"object"==typeof(i=e)&&null!==i?(Object.keys(e).forEach((e=>ar(e))),rr=Object.assign({},rr,e)):er(e)&&t&&(ar(e),rr[e]=t)},ar=e=>{for(var t in nr)t.indexOf(e)>-1&&delete nr[t]},or=e=>hr.generate(e),hr={color:null,generate:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.color;return nr[e]?this.color=nr[e]:this.color=(e=>{var t=nr[e]||rr[e]||e;t||(t=e);var i=/^#([0-9A-F]{3}|[0-9A-F]{6})$/i;if(er(t)&&i.test(t)){var r=i.exec(t)[1];3===r.length&&(r=r.split("").map((e=>e+e)).join("")),t=1*`0xff${r}`}return nr[e]||(nr[e]=t),t||4294967295})(e),this},get(){return this.color},alpha:function(e){var t,i;return this.color=(t=this.color,(i=Math.abs(e))>1?i/=100:i<0&&(i=0),((t/65536|0)%256<<16)+((t/256|0)%256<<8)+t%256+16777216*(0|Math.round(255*i))),this},darker(e){var t=tr(this.color);return t.l=t.l*(1-e),this.color=ir(t),this},lighter(e){var t=tr(this.color);return t.l=t.l+(1-t.l)*e,this.color=ir(t),this},saturation(e){var t=tr(this.color);return t.s=e,this.color=ir(t),this},lightness(e){var t=tr(this.color);return t.l=e,this.color=ir(t),this},hue(e){var t=tr(this.color);return t.h=e,this.color=ir(t),this},mix(e,t){return this.color=((e,t,i)=>{var r=(e/65536|0)%256*i+(t/65536|0)%256*(1-i),n=(e/256|0)%256*i+(t/256|0)%256*(1-i),s=e%256*i+t%256*(1-i),a=(e/16777216|0)*i+(t/16777216|0)*(1-i);return 16777216*Math.round(a)+65536*Math.round(r)+256*Math.round(n)+Math.round(s)})(this.color,e,t),this}},ur="5.3.1",lr={stage:{w:1920,h:1080,precision:1,clearColor:0,canvas2d:!1},debug:!1,defaultFontFace:"RobotoRegular",keys:{8:"Back",13:"Enter",27:"Menu",37:"Left",38:"Up",39:"Right",40:"Down",174:"ChannelDown",175:"ChannelUp",178:"Stop",250:"PlayPause",191:"Search",409:"Search"}},cr=[];function dr(e,t,i){var r=i.width,n=i.height;return r&&n&&(lr.stage.w=r,lr.stage.h=n,lr.stage.precision=r/1920),r||n||720!==window.innerHeight||(lr.stage.w=1280,lr.stage.h=720,lr.stage.precision=1280/1920),class extends mt.Application{constructor(e){var t=ki(lr,e);e.stage.canvas&&(t.stage.canvas=e.stage.canvas),super(t),this.config=t}static _template(){return{w:1920,h:1080}}colorshift(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Ot.colorshift(this,e,t)}get keymapping(){return this.stage.application.config.keys}overrideKeyMap(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.stage.application.config.keys;return Object.keys(e).reduce(((r,n)=>(t||Object.keys(i).forEach((t=>{t!=n&&i[t]==e[n]&&delete r[t]})),r[n]=e[n],r)),i),i}_setup(){Promise.all([this.loadFonts(e.config&&e.config.fonts||e.getFonts&&e.getFonts()||[]),Di.load(e.config&&e.config.locale||e.getLocale&&e.getLocale()),e.language&&this.loadLanguage(e.language()),e.colors&&this.loadColors(e.colors())]).then((()=>{zt.app.loaded(),this.w=this.config.stage.w/this.config.stage.precision,this.h=this.config.stage.h/this.config.stage.precision,Bi=this.stage.c({ref:"App",type:e,zIndex:1,forceZIndexContext:!!i.showVersion||!!i.showFps}),this.childList.a(Bi),this._refocus(),u.info("App version",this.config.version),u.info("SDK version",ur),i.showVersion&&this.childList.a({ref:"VersionLabel",type:Ni,version:this.config.version,sdkVersion:ur,zIndex:1}),i.showFps&&this.childList.a({ref:"FpsCounter",type:Fi,zIndex:1}),super._setup()})).catch(console.error)}_handleBack(){this.closeApp()}_handleExit(){this.closeApp()}closeApp(){u.info("Signaling App Close"),i.onClose&&"function"==typeof i.onClose?i.onClose(...arguments):this.close()}close(){u.info("Closing App"),a.clearSubscribers(),Ji.clear(),this.childList.remove(this.tag("App")),this.cleanupFonts(),this.stage.gc(),this.destroy()}loadFonts(e){return i.fontLoader&&"function"==typeof i.fontLoader?i.fontLoader(e,cr):((e,t)=>new Promise(((i,r)=>{e.map((e=>{var i=e.family,r=e.url,n=e.urls,s=e.descriptors;return()=>{var e=n?n.map((e=>"url("+e+")")):"url("+r+")",a=new FontFace(i,e,s||{});return t.push(a),u.info("Loading font",i),document.fonts.add(a),a.load()}})).reduce(((e,t)=>e.then((()=>t()))),Promise.resolve(null)).then(i).catch(r)})))(e,cr)}cleanupFonts(){"delete"in document.fonts?cr.forEach((e=>{u.info("Removing font",e.family),document.fonts.delete(e)})):u.info("No support for removing manually-added fonts")}loadLanguage(e){var t=Hi.asset("translations.json"),i=e;return"object"==typeof i&&(i=e.language||null,t=e.file||t),function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new Promise(((i,r)=>{ji(e).then((e=>{Ki(e),"object"==typeof t&&"then"in t&&"function"==typeof t.then?t.then((e=>Zi(e).then(i).catch(r))).catch((e=>{u.error(e),r(e)})):Zi(t).then(i).catch(r)})).catch((()=>{var t="Language file "+e+" not found";u.error(t),r(t)}))}))}(t,i)}loadColors(e){var t=Hi.asset("colors.json");return!e||"string"!=typeof e&&"object"!=typeof e||(t=e),(e=>new Promise(((t,i)=>{if("object"==typeof e)return sr(e),t();ji(e).then((e=>(sr(e),t()))).catch((()=>{var t="Colors file "+e+" not found";return u.error(t),i(t)}))})))(t)}set focus(e){this._focussed=e,this._refocus()}_getFocused(){return this._focussed||this.tag("App")}}}class pr extends mt.textures.ImageTexture{constructor(e){super(e),this._scalingOptions=void 0}set options(e){this.resizeMode=this._scalingOptions=e}_getLookupId(){return`${this._src}-${this._scalingOptions.type}-${this._scalingOptions.w}-${this._scalingOptions.h}`}getNonDefaults(){var e=super.getNonDefaults();return this._src&&(e.src=this._src),e}}var gr,fr;class mr extends mt.Component{_construct(){this._skipRenderToTexture=!1,this._metrics=null,this._textureMode=a.get("platform","textureMode")||!1,u.info("Texture mode: "+this._textureMode),console.warn(["The 'MediaPlayer'-plugin in the Lightning-SDK is deprecated and will be removed in future releases.","Please consider using the new 'VideoPlayer'-plugin instead.","https://rdkcentral.github.io/Lightning-SDK/#/plugins/videoplayer"].join("\n\n"))}static _template(){return{Video:{VideoWrap:{VideoTexture:{visible:!1,pivot:.5,texture:{type:mt.textures.StaticTexture,options:{}}}}}}}set skipRenderToTexture(e){this._skipRenderToTexture=e}get textureMode(){return this._textureMode}get videoView(){return this.tag("Video")}_init(){var e=document.getElementsByTagName("video");e&&e.length>0?this.videoEl=e[0]:(this.videoEl=document.createElement("video"),this.videoEl.setAttribute("id","video-player"),this.videoEl.style.position="absolute",this.videoEl.style.zIndex="1",this.videoEl.style.display="none",this.videoEl.setAttribute("width","100%"),this.videoEl.setAttribute("height","100%"),this.videoEl.style.visibility=this.textureMode?"hidden":"visible",document.body.appendChild(this.videoEl)),this.textureMode&&!this._skipRenderToTexture&&this._createVideoTexture(),this.eventHandlers=[]}_registerListeners(){events.forEach((e=>{var t=t=>{this._metrics&&this._metrics[e]&&"function"==typeof this._metrics[e]&&this._metrics[e]({currentTime:this.videoEl.currentTime}),this.fire(e,{videoElement:this.videoEl,event:t})};this.eventHandlers.push(t),this.videoEl.addEventListener(e,t)}))}_deregisterListeners(){u.info("Deregistering event listeners MediaPlayer"),events.forEach(((e,t)=>{this.videoEl.removeEventListener(e,this.eventHandlers[t])})),this.eventHandlers=[]}_attach(){this._registerListeners()}_detach(){this._deregisterListeners(),this.close()}_createVideoTexture(){var e=this.stage.gl,t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),this.videoTexture.options={source:t,w:this.videoEl.width,h:this.videoEl.height}}_startUpdatingVideoTexture(){if(this.textureMode&&!this._skipRenderToTexture){var e=this.stage;this._updateVideoTexture||(this._updateVideoTexture=()=>{if(this.videoTexture.options.source&&this.videoEl.videoWidth&&this.active){var t=e.gl,i=(new Date).getTime(),r=this.videoEl.webkitDecodedFrameCount;if(r?this._lastFrame!==r:this._lastTime<i-30){this._lastTime=i,this._lastFrame=r;try{t.bindTexture(t.TEXTURE_2D,this.videoTexture.options.source),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this.videoEl),this._lastFrame=this.videoEl.webkitDecodedFrameCount,this.videoTextureView.visible=!0,this.videoTexture.options.w=this.videoEl.videoWidth,this.videoTexture.options.h=this.videoEl.videoHeight;var n=this.videoTextureView.w/this.videoTextureView.h,s=this.videoEl.videoWidth/this.videoEl.videoHeight;n>s?(this.videoTextureView.scaleX=s/n,this.videoTextureView.scaleY=1):(this.videoTextureView.scaleY=n/s,this.videoTextureView.scaleX=1)}catch(a){u.error("texImage2d video",a),this._stopUpdatingVideoTexture(),this.videoTextureView.visible=!1}this.videoTexture.source.forceRenderUpdate()}}}),this._updatingVideoTexture||(e.on("frameStart",this._updateVideoTexture),this._updatingVideoTexture=!0)}}_stopUpdatingVideoTexture(){if(this.textureMode){var e=this.stage;if(e.removeListener("frameStart",this._updateVideoTexture),this._updatingVideoTexture=!1,this.videoTextureView.visible=!1,this.videoTexture.options.source){var t=e.gl;t.bindTexture(t.TEXTURE_2D,this.videoTexture.options.source),t.clearColor(0,0,0,1),t.clear(t.COLOR_BUFFER_BIT)}}}updateSettings(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._consumer=e.consumer,this._consumer&&this._consumer.getMediaplayerSettings&&Object.assign(e,this._consumer.getMediaplayerSettings()),mt.Utils.equalValues(this._stream,e.stream)||(e.stream&&e.stream.keySystem?navigator.requestMediaKeySystemAccess(e.stream.keySystem.id,e.stream.keySystem.config).then((e=>e.createMediaKeys())).then((e=>this.videoEl.setMediaKeys(e))).then((()=>{e.stream&&e.stream.src&&this.open(e.stream.src)})).catch((()=>{console.error("Failed to set up MediaKeys")})):e.stream&&e.stream.src?a.get("app","hls")?(window.Hls||(window.Hls=class{static isSupported(){return console.warn("hls-light not included"),!1}}),window.Hls.isSupported()&&(this._hls||(this._hls=new window.Hls({liveDurationInfinity:!0})),this._hls.loadSource(e.stream.src),this._hls.attachMedia(this.videoEl),this.videoEl.style.display="block")):this.open(e.stream.src):this.close(),this._stream=e.stream),this._setHide(e.hide),this._setVideoArea(e.videoPos)}_setHide(e){this.textureMode?this.tag("Video").setSmooth("alpha",e?0:1):this.videoEl.style.visibility=e?"hidden":"visible"}open(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{hide:!1,videoPosition:null};mediaUrl(e),this._metrics=zt.media(e),u.info("Playing stream",e),this.application.noVideo?u.info("noVideo option set, so ignoring: "+e):(this.videoEl.getAttribute("src")===e&&this.close(),this.videoEl.setAttribute("src",e),this.videoEl.style.visibility="hidden",this.videoEl.style.display="none",setTimeout((()=>{this.videoEl.style.display="block",this.videoEl.style.visibility="visible"})),this._setHide(t.hide),this._setVideoArea(t.videoPosition||[0,0,1920,1080]))}close(){this.videoEl.pause(),this.videoEl.removeAttribute("src"),this.videoEl.load(),this._clearSrc(),this.videoEl.style.display="none"}playPause(){this.isPlaying()?this.doPause():this.doPlay()}get muted(){return this.videoEl.muted}set muted(e){this.videoEl.muted=e}get loop(){return this.videoEl.loop}set loop(e){this.videoEl.loop=e}isPlaying(){return"Playing"===this._getState()}doPlay(){this.videoEl.play()}doPause(){this.videoEl.pause()}reload(){var e=this.videoEl.getAttribute("src");this.close(),this.videoEl.src=e}getPosition(){return Promise.resolve(this.videoEl.currentTime)}setPosition(e){this.videoEl.currentTime=e}getDuration(){return Promise.resolve(this.videoEl.duration)}seek(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1]?this.videoEl.currentTime=e:this.videoEl.currentTime+=e}get videoTextureView(){return this.tag("Video").tag("VideoTexture")}get videoTexture(){return this.videoTextureView.texture}_setVideoArea(e){if(!mt.Utils.equalValues(this._videoPos,e))if(this._videoPos=e,this.textureMode)this.videoTextureView.patch({smooth:{x:e[0],y:e[1],w:e[2]-e[0],h:e[3]-e[1]}});else{var t=this.stage.getRenderPrecision();this.videoEl.style.left=Math.round(e[0]*t)+"px",this.videoEl.style.top=Math.round(e[1]*t)+"px",this.videoEl.style.width=Math.round((e[2]-e[0])*t)+"px",this.videoEl.style.height=Math.round((e[3]-e[1])*t)+"px"}}_fireConsumer(e,t){this._consumer&&this._consumer.fire(e,t)}_equalInitData(e,t){if(!e||!t)return!1;if(e.byteLength!=t.byteLength)return!1;for(var i=new Int8Array(e),r=new Int8Array(t),n=0;n!=e.byteLength;n++)if(i[n]!=r[n])return!1;return!0}error(e){return this._fireConsumer("$mediaplayerError",e),this._setState(""),""}loadeddata(e){this._fireConsumer("$mediaplayerLoadedData",e)}play(e){this._fireConsumer("$mediaplayerPlay",e)}playing(e){this._fireConsumer("$mediaplayerPlaying",e),this._setState("Playing")}canplay(e){this.videoEl.play(),this._fireConsumer("$mediaplayerStart",e)}loadstart(e){this._fireConsumer("$mediaplayerLoad",e)}seeked(){this._fireConsumer("$mediaplayerSeeked",{currentTime:this.videoEl.currentTime,duration:this.videoEl.duration||1})}seeking(){this._fireConsumer("$mediaplayerSeeking",{currentTime:this.videoEl.currentTime,duration:this.videoEl.duration||1})}durationchange(e){this._fireConsumer("$mediaplayerDurationChange",e)}encrypted(e){var t=e.videoElement,i=e.event;t.mediaKeys&&!this._equalInitData(this._previousInitData,i.initData)&&(this._previousInitData=i.initData,this._fireConsumer("$mediaplayerEncrypted",e))}static _states(){return[class extends(this){$enter(){this._startUpdatingVideoTexture()}$exit(){this._stopUpdatingVideoTexture()}timeupdate(){this._fireConsumer("$mediaplayerProgress",{currentTime:this.videoEl.currentTime,duration:this.videoEl.duration||1})}ended(e){this._fireConsumer("$mediaplayerEnded",e),this._setState("")}pause(e){this._fireConsumer("$mediaplayerPause",e),this._setState("Playing.Paused")}_clearSrc(){this._fireConsumer("$mediaplayerStop",{}),this._setState("")}static _states(){return[class extends(this){}]}}]}}class _r{constructor(e){return e=e||{},this.forceCookies=e.forceCookies||!1,!0===this._checkIfLocalStorageWorks()&&!0!==e.forceCookies?{getItem:this._getItemLocalStorage,setItem:this._setItemLocalStorage,removeItem:this._removeItemLocalStorage,clear:this._clearLocalStorage,keys:this._getLocalStorageKeys}:{getItem:this._getItemCookie,setItem:this._setItemCookie,removeItem:this._removeItemCookie,clear:this._clearCookies,keys:this._getCookieKeys}}_checkIfLocalStorageWorks(){if("undefined"==typeof localStorage)return!1;try{return localStorage.setItem("feature_test","yes"),"yes"===localStorage.getItem("feature_test")&&(localStorage.removeItem("feature_test"),!0)}catch(e){return!1}}_getItemLocalStorage(e){return window.localStorage.getItem(e)}_setItemLocalStorage(e,t){return window.localStorage.setItem(e,t)}_removeItemLocalStorage(e){return window.localStorage.removeItem(e)}_clearLocalStorage(){return window.localStorage.clear()}_getLocalStorageKeys(){return Object.keys(window.localStorage)}_getItemCookie(e){var t=document.cookie.match(RegExp("(?:^|;\\s*)"+function(e){return e.replace(/([.*+?\^${}()|\[\]\/\\])/g,"\\$1")}(e)+"=([^;]*)"));return t&&""===t[1]&&(t[1]=null),t?t[1]:null}_setItemCookie(e,t){var i=new Date,r=new Date(i.getTime()+15768e7);document.cookie=`${e}=${t}; expires=${r.toUTCString()};`}_removeItemCookie(e){document.cookie=`${e}=;Max-Age=-99999999;`}_clearCookies(){document.cookie.split(";").forEach((e=>{document.cookie=e.replace(/^ +/,"").replace(/=.*/,"=;expires=Max-Age=-99999999")}))}_getCookieKeys(){return document.cookie.split(";").map((e=>e.split("=")[0]))}}var vr=e=>gr?[gr,e].join("."):e,yr={get(e){try{return JSON.parse(fr.getItem(vr(e)))}catch(t){return null}},set(e,t){try{return fr.setItem(vr(e),JSON.stringify(t)),!0}catch(i){return!1}},remove(e){fr.removeItem(vr(e))},clear(){gr?fr.keys().forEach((e=>{0===e.indexOf(gr+".")&&fr.removeItem(e)})):fr.clear()}},xr=/\{\/(.*?)\/([igm]{0,3})\}/g,br=/^[!*$]$/,wr=/\/:\w+?@@([0-9]+?)@@/,Tr=/^\/:/,Sr=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"R";return xr.test(e)&&(e=e.replace(xr,t)),e};class Ar{constructor(){var e,t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;this._hash=i,this._storeCaller=n,this._register=new Map,this._isCreated=!1,this._isSharedInstance=!1,this._cancelled=!1,this._copiedHistoryState=null,Ln(r)?this._register=(e=r,t=new Map,[...Object.keys(e),...Object.getOwnPropertySymbols(e)].forEach((i=>{t.set(i,e[i])})),t):kn(r)&&(this._storeCaller=r),this._register.set(jn.store,this._storeCaller)}cancel(){u.debug("[router]:",`cancelled ${this._hash}`),this._cancelled=!0}get url(){return this._hash}get register(){return this._register}get hash(){return this._hash}set hash(e){this._hash=e}get route(){return this._route}set route(e){this._route=e}get provider(){return this._provider}set provider(e){this._provider=e}get providerType(){return this._providerType}set providerType(e){this._providerType=e}set page(e){this._page=e}get page(){return this._page}set isCreated(e){this._isCreated=e}get isCreated(){return this._isCreated}get isSharedInstance(){return this._isSharedInstance}set isSharedInstance(e){this._isSharedInstance=e}get isCancelled(){return this._cancelled}set copiedHistoryState(e){this._copiedHistoryState=e}get copiedHistoryState(){return this._copiedHistoryState}}class Cr{constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=["on","before","after"].reduce(((t,i)=>Rn(e[i])?i:t),void 0);this._cfg=e,t&&(this._provider={type:t,request:e[t]})}get path(){return this._cfg.path}get name(){return this._cfg.name}get component(){return this._cfg.component}get options(){return this._cfg.options}get widgets(){return this._cfg.widgets}get cache(){return this._cfg.cache}get hook(){return this._cfg.hook}get beforeNavigate(){return this._cfg.beforeNavigate}get provider(){return this._provider}}var Er,Ir,Rr,Lr,kr,Mr,Pr,Or,Dr,Nr,Fr,Ur,zr=e=>Sr(e).split("/").length,Br=t=>{t=t.replace(/^#/,"");var i=/(\/?:?[^/]+)/g,r=(t=>{var i,r=[],n=o(on.entries());try{for(n.s();!(i=n.n()).done;){var s=e(i.value,1)[0];zr(s)===t&&r.push(s)}}catch(a){n.e(a)}finally{n.f()}return r})(zr(t)),n=t.match(i)||[],s=[],a=r.filter((e=>{var t=!0;if(xr.test(e)){var r=e.match(xr);r&&r.length&&(e=r.reduce(((e,t)=>{var i=s.length;return e=e.replace(t,`@@${i}@@`),s.push(t.substring(1,t.length-1)),e}),e))}for(var a=e.match(i)||[],o=0,h=a.length;o<h;o++){var u=a[o],l=n[o];if(wr.test(u)){var c=wr.exec(u)[1],d=s[c],p=/\/([^\/]+)\/([igm]{0,3})/.exec(d);if(p&&p.length){var g=p[1],f=p[2];new RegExp(`^/${g}$`,f).test(l)||(t=!1)}}else{if(Tr.test(u))continue;l&&u.toLowerCase()!==l.toLowerCase()&&(t=!1)}}return t}));if(a.length){if(-1!==a.indexOf(t)){var h=a[a.indexOf(t)];return on.get(h)}if(a=a.sort((e=>Tr.test(e)?-1:1)),Sn(a[0]))return on.get(a[0])}return!1},jr=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;t=Sr(t,"");var i=/(\/?:?[\w%\s:.-]+)/g,r=e.match(i)||[],n=t.match(i)||[],s=/^\/:([\w-]+)\/?/;return n.reduce(((e,t,i)=>{var n=s.exec(t);return n&&n.length&&e.set(n[1],decodeURIComponent(r[i].replace(/^\//,""))),e}),new Map)},Hr=(e,t)=>{if(e&&e.hasOwnProperty(t))return e[t]},Vr=t=>{var i,r=o(on.entries());try{for(r.s();!(i=r.n()).done;){var n=e(i.value,2),s=n[0];if(n[1].name===t)return s}}catch(a){r.e(a)}finally{r.f()}return!1},Wr=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};On(t)||(t=[t]),t.forEach((t=>{var r=`_on${Dn(t)}`;Rn(e[r])&&e[r](i)}))},Gr=null,Xr=()=>{if(Mr)return Mr.get().reduce(((e,t)=>(e[t.ref.toLowerCase()]=t,e)),{})},qr=()=>{Gr=null,Ir._setState("")},Yr=()=>Gr,$r=e=>{Gr=e},Kr=(e,t)=>e.c({type:t,visible:!1,widgets:Xr()}),Zr=[],Qr=e=>{var t=yn();if(t){var i=e.register.get(jn.store),r=Br(t),n=Hr(r.options,"preventStorage");if(kn(i)?i:!n){var s=t.replace(/^\//,""),a=Jr(s),o=en(bn(),e),h=En();if(-1===a||h.get("storeSameHash"))Zr.push({hash:s,state:o});else{var u=Zr.splice(a,1)[0];Zr.push({hash:u.hash,state:o})}}}},Jr=e=>{for(var t=0;t<Zr.length;t++)if(Zr[t].hash===e)return t;return-1},en=(e,t)=>{if(t.isSharedInstance){if(t.copiedHistoryState)return t.copiedHistoryState}else if(e&&Rn(e.historyState))return e.historyState();return null},tn=()=>Zr.slice(0),rn=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];On(e)&&(Zr=e)},nn=!0,sn=function(){var e=r(t().mark((function e(i,r){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!0);case 1:case"end":return e.stop()}}),e)})));return function(t,i){return e.apply(this,arguments)}}(),an=()=>{},on=new Map,hn=new Map,un=!1,ln=null,cn=(e,t)=>{var i=e.appInstance,r=e.routes;t&&Mn(t)&&(Ir=t),Ir||(Ir=i||Bi),Er=Ir.application,Rr=Er.childList,Lr=Ir.stage,kr=Un(),(e=>{e.pages&&(Rr=e.pages.childList),e.widgets&&e.widgets.children&&(Mr=e.widgets.childList).forEach((e=>e.visible=!1)),e._handleBack=e=>{ds(-1),e.preventDefault()}})(Ir),On(r)?dn(e):Rn(r)&&(console.warn("[Router]: Calling Router.route() directly is deprecated."),console.warn("Use object config: https://rdkcentral.github.io/Lightning-SDK/#/plugins/router/configuration"))},dn=e=>{un||pn(e),e.routes.forEach((e=>{var t=Fn(e.path);if(Sn(t))console.error(`${t} already exists in routes configuration`);else{var i=(e=>{if("$"===e.path){var t={preventStorage:!0};Ln(e.options)&&(t=s(s({},e.options),t)),e.options=t,Or&&(e.after=Or)}return new Cr(e)})(e);if(on.set(t,i),i.component){var r=i.component;Pn(r)&&(kr.get("lazyCreate")||(r=Kr(Lr,r),Rr.a(r))),hn.set(t,r)}}}))},pn=e=>{Pr=e.root,Rn(e.boot)&&(Or=e.boot),kn(e.updateHash)&&(nn=e.updateHash),Rn(e.beforeEachRoute)&&(sn=e.beforeEachRoute),Rn(e.afterEachRoute)&&(an=e.afterEachRoute),e.bootComponent&&(console.warn("[Router]: Boot Component is now available as a special router: https://rdkcentral.github.io/Lightning-SDK/#/plugins/router/configuration?id=special-routes"),console.warn("[Router]: setting { bootComponent } property will be deprecated in a future release"),Mn(e.bootComponent)?e.routes.push({path:"$",component:e.bootComponent,after:Or||null,options:{preventStorage:!0}}):console.error(`[Router]: ${e.bootComponent} is not a valid boot component`)),e.routes.forEach((t=>{var i=Sr(t.path);if(/(?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*\/:(?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*?\?$/.test(i)){var r=t.path.substring(0,t.path.lastIndexOf("/")),n=t.path.substring(0,t.path.lastIndexOf("?"));t.path=n;var a=s({},t);a.path=r,e.routes.push(a)}})),un=!0},gn=(e,t)=>{hn.has(e)&&hn.set(e,t)},fn=e=>hn.has(e)?hn.get(e):null,mn=()=>{if(!kr||!kr.size)return!1;var e=kr.get("updateHash");return!(kn(e)&&!e||kn(nn)&&!nn)},_n=e=>{var t=e.hash,i=e.route,r=e.register,n=e.page;Hr(i.options,"clearHistory")?rn([]):t&&!br.test(i.path)&&Qr(e),gn(i.path,n),e.isSharedInstance||!e.isCreated?Wr(n,"changed"):e.isCreated&&Wr(n,"mounted"),Mr&&((e,t)=>{var i=(e||[]).map((e=>e.toLowerCase()));Mr.forEach((e=>{e.visible=-1!==i.indexOf(e.ref.toLowerCase()),e.visible&&Wr(e,["activated"],t)})),"Widgets"===Ir.state&&Gr&&!Gr.visible&&Ir._setState("")})(i.widgets,n),bn()&&!e.isSharedInstance&&vn(ln,e),r.get(jn.historyState)&&Rn(n.historyState)&&n.historyState(r.get(jn.historyState)),xn(n),Dr=e.hash,Nr=i.path;var s,a=o(rs.values());try{for(a.s();!(s=a.n()).done;){var h=s.value;h.isCancelled&&h.hash&&rs.delete(h.hash)}}catch(l){a.e(l)}finally{a.f()}an(e),u.info("[route]:",i.path),u.info("[hash]:",t)},vn=(e,t)=>{var i=Nr,r=t.register,n=kr.get("lazyDestroy"),s=kr.get("destroyOnHistoryBack"),a=r.get("keepAlive"),o=!1;r.get(jn.backtrack)&&(s||n)&&(o=!0),n&&!a&&(o=!0),Nr===t.route.path&&(o=!0),o?(gn(i,e._routedType||e.constructor),Rr.remove(e),kr.get("gcOnUnload")&&Lr.gc()):e.patch({x:0,y:0,scale:1,alpha:1,visible:!1})},yn=()=>Dr,xn=e=>{ln=e},bn=()=>ln,wn=()=>Nr,Tn=()=>Fr,Sn=e=>on.has(e),An=()=>Pr,Cn=()=>Or,En=()=>kr,In=()=>on,Rn=e=>"function"==typeof e,Ln=e=>"object"==typeof e&&null!==e,kn=e=>"boolean"==typeof e,Mn=e=>!!(e instanceof mt.Element||Pn(e)),Pn=e=>e.prototype&&"isComponent"in e.prototype,On=e=>Array.isArray(e),Dn=e=>`${e.charAt(0).toUpperCase()}${e.slice(1)}`,Nn=e=>"string"==typeof e,Fn=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").replace(/^#/,"").replace(/\/+$/,"")},Un=()=>{var e=a.get("platform","router"),t=Ln(e);return["backtrack","gcOnUnload","destroyOnHistoryBack","lazyCreate","lazyDestroy","reuseInstance","autoRestoreRemote","numberNavigation","updateHash","storeSameHash"].reduce(((i,r)=>(i.set(r,t?e[r]:a.get("platform",r)),i)),new Map)},zn=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:yn(),i=gs();"$"!==t&&t||!i||Nn(i)&&(t=i);var r="",n=/([?&].*)/.exec(t),s={};if(document.location&&document.location.search&&(r=document.location.search),n&&n.length){var a=n[1];r=r?`${r}&${a=a.replace(/^\?/,"")}`:a}if(r){var h,u=o(new URLSearchParams(r).entries());try{for(u.s();!(h=u.n()).done;){var l=e(h.value,2),c=l[0],d=l[1];s[c]=d}}catch(p){u.e(p)}finally{u.f()}return s}return!1},Bn=e=>Ln(e)?"?"+Object.keys(e).map((t=>`${t}=${e[t]}`)).join("&"):"",jn={route:Symbol("route"),hash:Symbol("hash"),store:Symbol("store"),fromHistory:Symbol("fromHistory"),expires:Symbol("expires"),resume:Symbol("resume"),backtrack:Symbol("backtrack"),historyState:Symbol("historyState"),queryParams:Symbol("queryParams")},Hn={on:e=>((e=>{Ur=e})(Ir.state||""),Ir._setState("Loading"),Vn(e)),before:e=>Vn(e),after:e=>{try{Vn(e,!0)}catch(t){}return Promise.resolve()}},Vn=(e,t)=>{var i=e.route,r=i.provider,n=i.cache?1e3*i.cache:0,a=Wn(e);return r.request(e.page,s({},a)).then((()=>{e.page[jn.expires]=Date.now()+n,t&&Wr(e.page,"dataProvided")})).catch((t=>{throw e.page[jn.expires]=Date.now(),t}))},Wn=t=>{var i,r=t.page,n=t.route,s=t.hash,a=t.register,h=void 0===a?new Map:a,u=jr(s,n.path),l=zn(s),c={},d=o(new Map([...u,...h]));try{for(d.s();!(i=d.n()).done;){var p=e(i.value,2),g=p[0],f=p[1];c[g]=f}}catch(w){d.e(w)}finally{d.f()}if(l&&(c[jn.queryParams]=l),h.size){var m,_={},v=o(h);try{for(v.s();!(m=v.n()).done;){var y=e(m.value,2),x=y[0],b=y[1];_[x]=b}}catch(w){v.e(w)}finally{v.f()}r.persist=_}return r.params=c,Wr(r,["urlParams"],c),c},Gn=e=>{if(!e[jn.expires])return!1;var t=e[jn.expires];return Date.now()>=t},Xn=e=>!!Sn(e)&&!!on.get(e).provider,qn=e=>{if(Sn(e.path)){var t=on.get(e.path).provider;return{type:t.type,provider:t.request}}},Yn=(e,t,i,r)=>{var n="x"===e?1920:1080;return new Promise((s=>{i.patch({[`${e}`]:t?-1*n:n,visible:!0,smooth:{[`${e}`]:[0,{duration:.4,delay:.2}]}}),r&&r.patch({[`${e}`]:0,smooth:{[`${e}`]:[t?n:-1*n,{duration:.4,delay:.2}]}}),i.transition(e).on("finish",(()=>{s()}))}))},$n={fade:(e,t)=>new Promise((i=>{e.patch({alpha:0,visible:!0,smooth:{alpha:[1,{duration:.5,delay:.1}]}}),e.transition("alpha").on("finish",(()=>{t&&(t.visible=!1),i()}))})),crossFade:(e,t)=>new Promise((i=>{e.patch({alpha:0,visible:!0,smooth:{alpha:[1,{duration:.5,delay:.1}]}}),t&&t.patch({smooth:{alpha:[0,{duration:.5,delay:.3}]}}),e.transition("alpha").on("finish",(()=>{i()}))})),up:(e,t)=>Yn("y",0,e,t),down:(e,t)=>Yn("y",1,e,t),left:(e,t)=>Yn("x",0,e,t),right:(e,t)=>Yn("x",1,e,t)},Kn=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=e.pageTransition||e.easing,r=!!(e.smoothIn||e.smoothInOut||i),n=En().get("disableTransitions");if(e.easing&&console.warn("easing() method is deprecated and will be removed. Use pageTransition()"),!r||n)return e.visible=!0,t&&(t.visible=!1),Promise.resolve();if(i){var s;try{s=i.call(e,e,t)}catch(o){s="crossFade"}if((e=>{var t;if(Rn(e))try{t=e.apply(null)}catch(o){t=o}else t=e;return Ln(t)&&Rn(t.then)})(s))return s;if(Nn(s)){var a=$n[s];if(a)return a(e,t)}if(e.smoothIn){return e.smoothIn({pageIn:e,smooth:function(t,i){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new Promise((n=>{e.visible=!0,e.setSmooth(t,i,r),e.transition(t).on("finish",(()=>{n()}))}))}})}}return $n.crossFade(e,t)},Zn=function(){var e=r(t().mark((function e(i){var r,n;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=!1,e.prev=1,e.next=4,Qn(i);case 4:if(!(i=e.sent)||i.isCancelled){e.next=12;break}if("Loading"===Ir.state&&("Widgets"===Ur?Ir._setState("Widgets",[Yr()]):Ir._setState("")),i.isSharedInstance||i.isCancelled){e.next=10;break}return e.next=10,Kn(i.page,bn());case 10:e.next=13;break;case 12:r=!0;case 13:if(!r&&!i.isCancelled){e.next=18;break}u.debug("[router]:",`Rejected ${i.hash} because route to ${Tn()} started`),i.isCreated&&!i.isSharedInstance&&Rr.remove(i.page),e.next=20;break;case 18:return _n(i),e.abrupt("return",i.page);case 20:e.next=25;break;case 22:e.prev=22,e.t0=e.catch(1),e.t0.route?r||(n=e.t0.route,Hr(n.options,"clearHistory")?rn([]):br.test(n.path)||Qr(e.t0),e.t0.isCreated&&!e.t0.isSharedInstance&&Rr.remove(e.t0.page),Jn(e.t0)):console.error(e.t0);case 25:case"end":return e.stop()}}),e,null,[[1,22]])})));return function(t){return e.apply(this,arguments)}}(),Qn=function(){var e=r(t().mark((function e(i){var r,n,s,a,o,h,u,l,c,d;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=i.route,n=i.hash,s=i.register,a=fn(r.path),o=Pn(a),h=!1,o||s.get(jn.backtrack)||es(r)||(a=a.constructor,o=!0),o?(i.page=Kr(Lr,a),Rr.a(i.page),Xn(r.path)&&(h=!0),i.isCreated=!0):(i.page=a,Xn(r.path)&&(Gn(a)||a[jn.hash]!==n)&&(h=!0),u=bn()&&bn()[jn.route],r.path===u&&(i.isSharedInstance=!0,Rn(i.page.historyState)&&(i.copiedHistoryState=i.page.historyState()))),i.page[jn.hash]=n,i.page[jn.route]=r.path,e.prev=10,!h){e.next=25;break}return l=qn(r),c=l.type,d=l.provider,i.provider=d,i.providerType=c,e.next=17,Hn[c](i);case 17:if(n===Tn()){e.next=21;break}return e.abrupt("return",!1);case 21:return"after"!==i.providerType&&Wr(i.page,"dataProvided"),e.abrupt("return",i);case 23:e.next=27;break;case 25:return Wn(i),e.abrupt("return",i);case 27:e.next=33;break;case 29:return e.prev=29,e.t0=e.catch(10),i.error=e.t0,e.abrupt("return",Promise.reject(i));case 33:case"end":return e.stop()}}),e,null,[[10,29]])})));return function(t){return e.apply(this,arguments)}}(),Jn=e=>{e&&e.error?console.error(e.error):e&&u.error(e),e.page&&Sn("!")&&hs("!",{request:e},!1)},es=e=>{var t=Hr(e.options,"reuseInstance"),i=kr.get("reuseInstance");return kn(t)?t:!(kn(i)&&!1===i)};class ts extends mt.Component{static _template(){return{Pages:{forceZIndexContext:!0},Loading:{rect:!0,w:1920,h:1080,color:4278190080,visible:!1,zIndex:99,Label:{mount:.5,x:960,y:540,text:{text:"Loading.."}}}}}static _states(){return[class extends(this){$enter(){this.tag("Loading").visible=!0}$exit(){this.tag("Loading").visible=!1}},class extends(this){$enter(e,t){this._widget=t,this._refocus()}_getFocused(){return this._widget}reload(e){this._widget=e,this._refocus()}_handleKey(){var e=kr.get("autoRestoreRemote");kn(e)&&!0!==e||vs.focusPage()}}]}get pages(){return this.tag("Pages")}get widgets(){return this.tag("Widgets")}_handleBack(){}_getFocused(){return vs.getActivePage()}}var is,rs=new Map,ns="",ss="",as=()=>{var e=(fs()||"").replace(/^#/,""),t="$",i=zn(e),r=Cn(),n=An(),s=-1!==e.indexOf(t);br.test(e)&&e!==t&&(e=""),ss=s?n:e||n;var a=()=>{!e&&n?Nn(n)?hs(n):Rn(n)&&n().then((e=>{Ln(e)?hs(e.path,e.params):hs(e)})):(us(e),ls().then((()=>{Ir._refocus()})).catch((e=>{console.error(e)})))};if(Sn(t)){if(e&&!s&&!Br(e))return void hs("*",{failedHash:e});hs(t,{resume:ss,reload:t===e},!1)}else Rn(r)?r(i).then((()=>{a()})).catch((e=>{os(e)})):a()},os=e=>{Sn("!")?hs("!",{request:{error:e}}):console.error(e)},hs=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;if(!Ln(e)||(e=(e=>{if(!e.to&&!e.name)return!1;var t=Vr(e.to||e.name),i=t;if(/\/:([\w-]+)\/?/.test(t)&&(e.params&&(i=Object.keys(e.params).reduce(((t,i)=>t.replace(`:${i}`,e.params[i])),t)),e.query))return`${i}${Bn(e.query)}`;return i})(e),e)){var r=fs();!mn()&&ns&&(r=ns),r.replace(/^#/,"")!==e?(us(e,t,i),mn()?ms(e):(ns=e,ls(e).then((()=>{Ir._refocus()})).catch((e=>{console.error(e)})))):t.reload&&(us(e,t,i),ls(e).then((()=>{Ir._refocus()})).catch((e=>{console.error(e)})))}},us=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;if(e=Fn(e),!rs.has(e)){var r,n=o(rs.values());try{for(n.s();!(r=n.n()).done;){r.value.cancel()}}catch(a){n.e(a)}finally{n.f()}var s=((e,t,i)=>new Ar(e,t,i))(e,t,i);return rs.set(decodeURIComponent(e),s),s}return!1},ls=function(){var e=r(t().mark((function e(i){var r,n,s,a,o,h;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Fn(i||fs()),n=decodeURIComponent(r),(s=rs.get(n))||rs.size||(s=us(r)),a=Br(r)){e.next=8;break}return Sn("*")?hs("*",{failedHash:r}):console.error(`Unable to navigate to: ${r}`),e.abrupt("return");case 8:return s.hash=r,s.route=a,e.next=12,sn(yn(),s);case 12:if(!(o=e.sent)||!a.beforeNavigate){e.next=17;break}return e.next=16,a.beforeNavigate(yn(),s);case 16:o=e.sent;case 17:if(!kn(o)){e.next=22;break}if(!o){e.next=20;break}return e.abrupt("return",cs(s));case 20:e.next=25;break;case 22:s.cancel(),rs.delete(n),Nn(o)?hs(o):Ln(o)&&(h=!0,kn(o.store)&&(h=o.store),hs(o.path,o.params,h));case 25:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),cs=e=>{var t=e.hash,i=e.route,r=decodeURIComponent(t);if((e=>{Fr=e})(t),i.path){var n=fn(i.path);if(Rn(i.hook)){var a,h=jr(t,i.path),u={},l=o(h.keys());try{for(l.s();!(a=l.n()).done;){var c=a.value;u[c]=h.get(c)}}catch(g){l.e(g)}finally{l.f()}i.hook(Ir,s({},u))}if(n){var d=bn();if(d){var p=((e,t)=>{if(Nn(e)){var i=In();if(!i.has(e))return!1;e=i.get(e)}var r=t.register,n=e.options;return r.has("keepAlive")?r.get("keepAlive"):!(!n||!n.keepAlive)&&n.keepAlive})(wn(),e);d&&i.path===wn()&&!p&&d._setState("")}Mn(n)?Zn(e).then((()=>{Ir._refocus(),rs.delete(r)})):n().then((e=>e.default)).then((t=>(gn(i.path,t),Zn(e)))).then((()=>{Ir._refocus(),rs.delete(r)}))}else rs.delete(r)}},ds=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!e||isNaN(e))return!1;var t=tn();if((e=Math.abs(e))>t.length)return Rn(Ir._handleAppClose)?Ir._handleAppClose():Ir.application.closeApp();if(t.length){var i=t.splice(t.length-e,e)[0];return rn(t),hs(i.hash,{[jn.backtrack]:!0,[jn.historyState]:i.state},!1)}if(kr.get("backtrack")){var r=/(\/:?[\w%\s-]+)$/,n=Sr(fs()),s=zr(n);if(s>1)for(;s--;)if(n=n.replace(r,""),Br(n))return hs(n,{[jn.backtrack]:!0},!1)}return!1},ps=()=>{if(rs.size){var e,t=!1,i=o(rs.values());try{for(i.s();!(e=i.n()).done;){e.value.isCancelled||(t=!0)}}catch(r){i.e(r)}finally{i.f()}return t}return!1},gs=()=>ss,fs=()=>document.location.hash,ms=e=>{document.location.hash=e},_s=()=>{Ji.addEventListener(window,"hashchange",r(t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!mn()){e.next=9;break}return e.prev=1,e.next=4,ls();case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),console.error(e.t0);case 9:case"end":return e.stop()}}),e,null,[[1,6]])}))))},vs={startRouter:(e,t)=>{cn(e,t),_s(),as()},navigate:hs,resume:()=>{Nn(ss)?(hs(ss,!1),ss=""):Rn(ss)?ss().then((e=>{ss="",Ln(e)?hs(e.path,e.params):hs(e)})):console.warn("[Router]: resume() called but no hash found")},step:ds,go:ds,back:ds.bind(null,-1),activePage:bn,getActivePage:()=>bn(),getActiveRoute:wn,getActiveHash:yn,focusWidget:e=>{var t=(e=>(e=Dn(e),Mr.getByRef(e)||!1))(e);t&&($r(t),"Widgets"===Ir.state?Ir.reload(Gr):Ir._setState("Widgets",[Gr]))},getActiveWidget:Yr,restoreFocus:qr,isNavigating:ps,getHistory:tn,setHistory:rn,getHistoryState:e=>{var t=null;Zr.length&&(e?-1!==Jr(e)&&(t=Zr[Jr(e)].state):t=Zr[Zr.length-1].state);return t},replaceHistoryState:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;if(Zr.length){var i=t?Jr(t):Zr.length-1;-1!==i&&Ln(e)&&(Zr[i].state=e)}},getQueryStringParams:zn,reload:()=>{if(!ps()){var e=yn();hs(e,{reload:!0},!1)}},symbols:jn,App:ts,focusPage:qr,root:()=>{var e=An();Nn(e)?hs(e):Rn(e)&&e().then((e=>{Ln(e)?hs(e.path,e.params):hs(e)}))},setupRoutes(){console.warn("Router: setupRoutes is deprecated, consolidate your configuration"),console.warn("https://rdkcentral.github.io/Lightning-SDK/#/plugins/router/configuration")},on(){console.warn("Router.on() is deprecated, consolidate your configuration"),console.warn("https://rdkcentral.github.io/Lightning-SDK/#/plugins/router/configuration")},before(){console.warn("Router.before() is deprecated, consolidate your configuration"),console.warn("https://rdkcentral.github.io/Lightning-SDK/#/plugins/router/configuration")},after(){console.warn("Router.after() is deprecated, consolidate your configuration"),console.warn("https://rdkcentral.github.io/Lightning-SDK/#/plugins/router/configuration")}};class ys extends mt.Component{static _template(){return{visible:!1,rect:!0,color:2415919104,shader:{type:mt.shaders.RoundedRectangle,radius:5},Text:{y:5,x:20,text:{textColor:4294967295,fontSize:38,lineHeight:38*1.4,textAlign:"center",wordWrap:!0,maxLines:3,shadow:!0,shadowColor:4281545523}}}}_init(){this._textTextureDefaults=new mt.textures.TextTexture(this.stage).cloneArgs(),this.tag("Text").on("txLoaded",(e=>{var t=e._source;this.w=t.w+2*this.tag("Text").x,this.h=t.h,this.position()}))}get textFormat(){var e=this.tag("Text").text;return{fontFace:e.fontFace||"sans-serif",fontSize:e.fontSize,lineHeight:e.lineHeight,textAlign:e.textAlign,wordWrap:!0,maxLines:e.maxLines}}show(){this.visible=!0}hide(){this.visible=!1}position(){this.x=this._calculateX(this.xPos),this.y=this._calculateY(this.yPos)}set viewportW(e){this._viewportW=e,this.x=this._calculateX(this.xPos)}get viewportW(){return this._viewportW||this.application.finalW}set viewportH(e){this._viewportH=e,this.y=this._calculateY(this.yPos)}get viewportH(){return this._viewportH||this.application.finalH}_calculateX(e){return"center"===e?(this.viewportW-this.finalW)/2:"left"===e?60:"right"===e&&this.viewportW-this.finalW-60,e}set xPos(e){this._x=e,this.x=this._calculateX(e)}get xPos(){return this._x||"center"}_calculateY(e){return"center"===e?(this.viewportH-this.finalH)/2:"top"===e?60:"bottom"===e?this.viewportH-this.finalH-60:e}set yPos(e){this._y=e,this.y=this._calculateY(e)}get yPos(){return this._y||"bottom"}set fontFamily(e){this.tag("Text").text.fontFace=e}set fontSize(e){this.tag("Text").text.fontSize=e,this.tag("Text").text.lineHeight=1.3*e}set fontColor(e){this.tag("Text").color=e}set backgroundColor(e){this.color=e}_defineBreakpoint(e,t){if(t>=this.maxWidth)return this.maxWidth;var i=mt.textures.TextTexture.renderer(this.stage,this.stage.platform.getDrawingCanvas(),s(s(s(s({},this._textTextureDefaults),this.textFormat),{wordWrapWidth:t}),{},{text:e}))._calculateRenderInfo();return i.width<=t&&i.lines.length<=2?t:this._defineBreakpoint(e,1.25*t)}set text(e){if(this.alpha=0,e&&e.length){var t=this._defineBreakpoint(e,640);this.tag("Text").text.wordWrapWidth=t,this.tag("Text").text=e,this.alpha=1}}set textAlign(e){this._textAlign=e,this.tag("Text").text.textAlign=e}set maxWidth(e){this._maxWidth=e}get maxWidth(){return(this._maxWidth||1200)-2*this.tag("Text").x}set maxLines(e){this.tag("Text").text.maxLines=e}}var xs={background:4279639853,primary:4279509822,primaryLight:4280169822,secondary:4283596540,tertiary:4284586236,accent:4291485694,error:4281685370,warning:4281685370,info:4281685370,white:4294046193,yellow:4294105945,accentGrey:{light:4288784562,dark:4282732896},dark:4278584867,black:4278190080},bs=["/filters/dgnlsl30-movies-action?page=1&language=en&size=50","/filters/dgnlsl30-movies-comedy?page=1&language=en&size=50","/filters/marvel-movies?page=1&language=en&size=50","/filters/gNAaDQJl13GS?page=1&language=en&size=100","/filters/dgnlsl30-movies-action?page=1&language=en&size=50","/filters/dgnlsl30-movies-comedy?page=1&language=en&size=50","/filters/marvel-movies?page=1&language=en&size=50","/filters/gNAaDQJl13GS?page=1&language=en&size=100","/filters/dgnlsl30-movies-action?page=1&language=en&size=50","/filters/dgnlsl30-movies-comedy?page=1&language=en&size=50","/filters/marvel-movies?page=1&language=en&size=50","/filters/gNAaDQJl13GS?page=1&language=en&size=100","/filters/dgnlsl30-movies-action?page=1&language=en&size=50","/filters/dgnlsl30-movies-comedy?page=1&language=en&size=50","/filters/marvel-movies?page=1&language=en&size=50","/filters/gNAaDQJl13GS?page=1&language=en&size=100"],ws=["Action Movies","Only on Enlight","Marvel Movies","Drama Movies","Romantic Comdey Movies","Trending Now","Comdey Movies","Thriller Movies","Action Movies","Only on Enlight","Marvel Movies","Drama Movies","Romantic Comdey Movies","Trending Now","Comdey Movies","Thriller Movies","Long Rail"],Ts={w:216,h:324,margin:30,minimumCardsInViewport:7},Ss={w:324,h:216,margin:30,minimumCardsInViewport:5};class As extends mt.Component{constructor(){super(...arguments),this.data={},this.index=0,this.totalElements=0,this.cardSize=Ts}static _template(){return{rect:!0,color:xs.primary,shader:{type:mt.shaders.RoundedRectangle,radius:20},Image:{w:e=>e,h:e=>e,shader:{type:mt.shaders.RoundedRectangle,radius:20}},Label:{x:10,w:e=>e,color:xs.accentGrey.light,text:{fontSize:22.5}}}}set item(e){var t=e.label,i=e.src,r=e.data,n=e.index,s=e.totalElements,a=e.cardSize;this.data=r,this.index=n,this.totalElements=s,this.cardSize=a,this.patch({Image:{src:i},w:this.cardSize.w,h:this.cardSize.h,Label:{text:null==t?void 0:t.toString(),y:this.cardSize.h+4}})}_handleEnter(){vs.navigate(`content/railItem/${this.data.uid}`,{from:"Home",data:this.data})}_focus(){var e={cardWidth:this.w,cardHeight:this.h,cardIndex:this.index,railTotalElements:this.totalElements,cardSize:this.cardSize};this.fireAncestors("$changeItemOnFocus",this.data,e),this.patch({Label:{smooth:{color:xs.white}}})}_unfocus(){this.patch({smooth:{color:xs.primary,scale:1},Label:{smooth:{color:xs.accentGrey.light}},Rectangle:void 0})}}function Cs(e,t){return function(){return e.apply(t,arguments)}}var Es,Is=Object.prototype.toString,Rs=Object.getPrototypeOf,Ls=(Es=Object.create(null),e=>{var t=Is.call(e);return Es[t]||(Es[t]=t.slice(8,-1).toLowerCase())}),ks=e=>(e=e.toLowerCase(),t=>Ls(t)===e),Ms=e=>t=>typeof t===e,Ps=Array.isArray,Os=Ms("undefined");var Ds=ks("ArrayBuffer");var Ns=Ms("string"),Fs=Ms("function"),Us=Ms("number"),zs=e=>null!==e&&"object"==typeof e,Bs=e=>{if("object"!==Ls(e))return!1;var t=Rs(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)},js=ks("Date"),Hs=ks("File"),Vs=ks("Blob"),Ws=ks("FileList"),Gs=ks("URLSearchParams");function Xs(e,t){var i,r,n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).allOwnKeys,s=void 0!==n&&n;if(null!=e)if("object"!=typeof e&&(e=[e]),Ps(e))for(i=0,r=e.length;i<r;i++)t.call(null,e[i],i,e);else{var a,o=s?Object.getOwnPropertyNames(e):Object.keys(e),h=o.length;for(i=0;i<h;i++)a=o[i],t.call(null,e[a],a,e)}}function qs(e,t){t=t.toLowerCase();for(var i,r=Object.keys(e),n=r.length;n-- >0;)if(t===(i=r[n]).toLowerCase())return i;return null}var Ys="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,$s=e=>!Os(e)&&e!==Ys;var Ks,Zs=(Ks="undefined"!=typeof Uint8Array&&Rs(Uint8Array),e=>Ks&&e instanceof Ks),Qs=ks("HTMLFormElement"),Js=(e=>{var t=Object.prototype.hasOwnProperty;return(e,i)=>t.call(e,i)})(),ea=ks("RegExp"),ta=(e,t)=>{var i=Object.getOwnPropertyDescriptors(e),r={};Xs(i,((i,n)=>{!1!==t(i,n,e)&&(r[n]=i)})),Object.defineProperties(e,r)},ia="abcdefghijklmnopqrstuvwxyz",ra="0123456789",na={DIGIT:ra,ALPHA:ia,ALPHA_DIGIT:ia+ia.toUpperCase()+ra};var sa={isArray:Ps,isArrayBuffer:Ds,isBuffer:function(e){return null!==e&&!Os(e)&&null!==e.constructor&&!Os(e.constructor)&&Fs(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{var t="[object FormData]";return e&&("function"==typeof FormData&&e instanceof FormData||Is.call(e)===t||Fs(e.toString)&&e.toString()===t)},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&Ds(e.buffer)},isString:Ns,isNumber:Us,isBoolean:e=>!0===e||!1===e,isObject:zs,isPlainObject:Bs,isUndefined:Os,isDate:js,isFile:Hs,isBlob:Vs,isRegExp:ea,isFunction:Fs,isStream:e=>zs(e)&&Fs(e.pipe),isURLSearchParams:Gs,isTypedArray:Zs,isFileList:Ws,forEach:Xs,merge:function e(){for(var t=($s(this)&&this||{}).caseless,i={},r=(r,n)=>{var s=t&&qs(i,n)||n;Bs(i[s])&&Bs(r)?i[s]=e(i[s],r):Bs(r)?i[s]=e({},r):Ps(r)?i[s]=r.slice():i[s]=r},n=0,s=arguments.length;n<s;n++)arguments[n]&&Xs(arguments[n],r);return i},extend:function(e,t,i){return Xs(t,((t,r)=>{i&&Fs(t)?e[r]=Cs(t,i):e[r]=t}),{allOwnKeys:(arguments.length>3&&void 0!==arguments[3]?arguments[3]:{}).allOwnKeys}),e},trim:e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,i,r)=>{e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),i&&Object.assign(e.prototype,i)},toFlatObject:(e,t,i,r)=>{var n,s,a,o={};if(t=t||{},null==e)return t;do{for(s=(n=Object.getOwnPropertyNames(e)).length;s-- >0;)a=n[s],r&&!r(a,e,t)||o[a]||(t[a]=e[a],o[a]=!0);e=!1!==i&&Rs(e)}while(e&&(!i||i(e,t))&&e!==Object.prototype);return t},kindOf:Ls,kindOfTest:ks,endsWith:(e,t,i)=>{e=String(e),(void 0===i||i>e.length)&&(i=e.length),i-=t.length;var r=e.indexOf(t,i);return-1!==r&&r===i},toArray:e=>{if(!e)return null;if(Ps(e))return e;var t=e.length;if(!Us(t))return null;for(var i=new Array(t);t-- >0;)i[t]=e[t];return i},forEachEntry:(e,t)=>{for(var i,r=(e&&e[Symbol.iterator]).call(e);(i=r.next())&&!i.done;){var n=i.value;t.call(e,n[0],n[1])}},matchAll:(e,t)=>{for(var i,r=[];null!==(i=e.exec(t));)r.push(i);return r},isHTMLForm:Qs,hasOwnProperty:Js,hasOwnProp:Js,reduceDescriptors:ta,freezeMethods:e=>{ta(e,((t,i)=>{if(Fs(e)&&-1!==["arguments","caller","callee"].indexOf(i))return!1;var r=e[i];Fs(r)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")}))}))},toObjectSet:(e,t)=>{var i={},r=e=>{e.forEach((e=>{i[e]=!0}))};return Ps(e)?r(e):r(String(e).split(t)),i},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(e,t,i){return t.toUpperCase()+i})),noop:()=>{},toFiniteNumber:(e,t)=>(e=+e,Number.isFinite(e)?e:t),findKey:qs,global:Ys,isContextDefined:$s,ALPHABET:na,generateString:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:na.ALPHA_DIGIT,i="",r=t.length;e--;)i+=t[Math.random()*r|0];return i},isSpecCompliantForm:function(e){return!!(e&&Fs(e.append)&&"FormData"===e[Symbol.toStringTag]&&e[Symbol.iterator])},toJSONObject:e=>{var t=new Array(10),i=(e,r)=>{if(zs(e)){if(t.indexOf(e)>=0)return;if(!("toJSON"in e)){t[r]=e;var n=Ps(e)?[]:{};return Xs(e,((e,t)=>{var s=i(e,r+1);!Os(s)&&(n[t]=s)})),t[r]=void 0,n}}return e};return i(e,0)}};function aa(e,t,i,r,n){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),i&&(this.config=i),r&&(this.request=r),n&&(this.response=n)}sa.inherits(aa,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:sa.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var oa=aa.prototype,ha={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((e=>{ha[e]={value:e}})),Object.defineProperties(aa,ha),Object.defineProperty(oa,"isAxiosError",{value:!0}),aa.from=(e,t,i,r,n,s)=>{var a=Object.create(oa);return sa.toFlatObject(e,a,(function(e){return e!==Error.prototype}),(e=>"isAxiosError"!==e)),aa.call(a,e.message,t,i,r,n),a.cause=e,a.name=e.name,s&&Object.assign(a,s),a};function ua(e){return sa.isPlainObject(e)||sa.isArray(e)}function la(e){return sa.endsWith(e,"[]")?e.slice(0,-2):e}function ca(e,t,i){return e?e.concat(t).map((function(e,t){return e=la(e),!i&&t?"["+e+"]":e})).join(i?".":""):t}var da=sa.toFlatObject(sa,{},null,(function(e){return/^is[A-Z]/.test(e)}));function pa(e,t,i){if(!sa.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;var r=(i=sa.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(e,t){return!sa.isUndefined(t[e])}))).metaTokens,n=i.visitor||u,s=i.dots,a=i.indexes,o=(i.Blob||"undefined"!=typeof Blob&&Blob)&&sa.isSpecCompliantForm(t);if(!sa.isFunction(n))throw new TypeError("visitor must be a function");function h(e){if(null===e)return"";if(sa.isDate(e))return e.toISOString();if(!o&&sa.isBlob(e))throw new aa("Blob is not supported. Use a Buffer instead.");return sa.isArrayBuffer(e)||sa.isTypedArray(e)?o&&"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}function u(e,i,n){var o=e;if(e&&!n&&"object"==typeof e)if(sa.endsWith(i,"{}"))i=r?i:i.slice(0,-2),e=JSON.stringify(e);else if(sa.isArray(e)&&function(e){return sa.isArray(e)&&!e.some(ua)}(e)||(sa.isFileList(e)||sa.endsWith(i,"[]"))&&(o=sa.toArray(e)))return i=la(i),o.forEach((function(e,r){!sa.isUndefined(e)&&null!==e&&t.append(!0===a?ca([i],r,s):null===a?i:i+"[]",h(e))})),!1;return!!ua(e)||(t.append(ca(n,i,s),h(e)),!1)}var l=[],c=Object.assign(da,{defaultVisitor:u,convertValue:h,isVisitable:ua});if(!sa.isObject(e))throw new TypeError("data must be an object");return function e(i,r){if(!sa.isUndefined(i)){if(-1!==l.indexOf(i))throw Error("Circular reference detected in "+r.join("."));l.push(i),sa.forEach(i,(function(i,s){!0===(!(sa.isUndefined(i)||null===i)&&n.call(t,i,sa.isString(s)?s.trim():s,r,c))&&e(i,r?r.concat(s):[s])})),l.pop()}}(e),t}function ga(e){var t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,(function(e){return t[e]}))}function fa(e,t){this._pairs=[],e&&pa(e,this,t)}var ma=fa.prototype;function _a(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function va(e,t,i){if(!t)return e;var r,n=i&&i.encode||_a,s=i&&i.serialize;if(r=s?s(t,i):sa.isURLSearchParams(t)?t.toString():new fa(t,i).toString(n)){var a=e.indexOf("#");-1!==a&&(e=e.slice(0,a)),e+=(-1===e.indexOf("?")?"?":"&")+r}return e}ma.append=function(e,t){this._pairs.push([e,t])},ma.toString=function(e){var t=e?function(t){return e.call(this,t,ga)}:ga;return this._pairs.map((function(e){return t(e[0])+"="+t(e[1])}),"").join("&")};var ya,xa=class{constructor(){this.handlers=[]}use(e,t,i){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!i&&i.synchronous,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){sa.forEach(this.handlers,(function(t){null!==t&&e(t)}))}},ba={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},wa={isBrowser:!0,classes:{URLSearchParams:"undefined"!=typeof URLSearchParams?URLSearchParams:fa,FormData:"undefined"!=typeof FormData?FormData:null,Blob:"undefined"!=typeof Blob?Blob:null},isStandardBrowserEnv:("undefined"==typeof navigator||"ReactNative"!==(ya=navigator.product)&&"NativeScript"!==ya&&"NS"!==ya)&&"undefined"!=typeof window&&"undefined"!=typeof document,isStandardBrowserWebWorkerEnv:"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,protocols:["http","https","file","blob","url","data"]};function Ta(e){function t(e,i,r,n){var s=e[n++],a=Number.isFinite(+s),o=n>=e.length;return s=!s&&sa.isArray(r)?r.length:s,o?(sa.hasOwnProp(r,s)?r[s]=[r[s],i]:r[s]=i,!a):(r[s]&&sa.isObject(r[s])||(r[s]=[]),t(e,i,r[s],n)&&sa.isArray(r[s])&&(r[s]=function(e){var t,i,r={},n=Object.keys(e),s=n.length;for(t=0;t<s;t++)r[i=n[t]]=e[i];return r}(r[s])),!a)}if(sa.isFormData(e)&&sa.isFunction(e.entries)){var i={};return sa.forEachEntry(e,((e,r)=>{t(function(e){return sa.matchAll(/\w+|\[(\w*)]/g,e).map((e=>"[]"===e[0]?"":e[1]||e[0]))}(e),r,i,0)})),i}return null}var Sa={"Content-Type":void 0};var Aa={transitional:ba,adapter:["xhr","http"],transformRequest:[function(e,t){var i,r=t.getContentType()||"",n=r.indexOf("application/json")>-1,s=sa.isObject(e);if(s&&sa.isHTMLForm(e)&&(e=new FormData(e)),sa.isFormData(e))return n&&n?JSON.stringify(Ta(e)):e;if(sa.isArrayBuffer(e)||sa.isBuffer(e)||sa.isStream(e)||sa.isFile(e)||sa.isBlob(e))return e;if(sa.isArrayBufferView(e))return e.buffer;if(sa.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();if(s){if(r.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return pa(e,new wa.classes.URLSearchParams,Object.assign({visitor:function(e,t,i,r){return wa.isNode&&sa.isBuffer(e)?(this.append(t,e.toString("base64")),!1):r.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((i=sa.isFileList(e))||r.indexOf("multipart/form-data")>-1){var a=this.env&&this.env.FormData;return pa(i?{"files[]":e}:e,a&&new a,this.formSerializer)}}return s||n?(t.setContentType("application/json",!1),function(e,t,i){if(sa.isString(e))try{return(t||JSON.parse)(e),sa.trim(e)}catch(r){if("SyntaxError"!==r.name)throw r}return(i||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){var t=this.transitional||Aa.transitional,i=t&&t.forcedJSONParsing,r="json"===this.responseType;if(e&&sa.isString(e)&&(i&&!this.responseType||r)){var n=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(s){if(n){if("SyntaxError"===s.name)throw aa.from(s,aa.ERR_BAD_RESPONSE,this,null,this.response);throw s}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:wa.classes.FormData,Blob:wa.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};sa.forEach(["delete","get","head"],(function(e){Aa.headers[e]={}})),sa.forEach(["post","put","patch"],(function(e){Aa.headers[e]=sa.merge(Sa)}));var Ca=Aa,Ea=sa.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Ia=Symbol("internals");function Ra(e){return e&&String(e).trim().toLowerCase()}function La(e){return!1===e||null==e?e:sa.isArray(e)?e.map(La):String(e)}function ka(e,t,i,r,n){return sa.isFunction(r)?r.call(this,t,i):(n&&(t=i),sa.isString(t)?sa.isString(r)?-1!==t.indexOf(r):sa.isRegExp(r)?r.test(t):void 0:void 0)}class Ma{constructor(e){e&&this.set(e)}set(e,t,i){var r=this;function n(e,t,i){var n=Ra(t);if(!n)throw new Error("header name must be a non-empty string");var s=sa.findKey(r,n);(!s||void 0===r[s]||!0===i||void 0===i&&!1!==r[s])&&(r[s||t]=La(e))}var s,a,o,h,u,l=(e,t)=>sa.forEach(e,((e,i)=>n(e,i,t)));return sa.isPlainObject(e)||e instanceof this.constructor?l(e,t):sa.isString(e)&&(e=e.trim())&&!/^[-_a-zA-Z]+$/.test(e.trim())?l((u={},(s=e)&&s.split("\n").forEach((function(e){h=e.indexOf(":"),a=e.substring(0,h).trim().toLowerCase(),o=e.substring(h+1).trim(),!a||u[a]&&Ea[a]||("set-cookie"===a?u[a]?u[a].push(o):u[a]=[o]:u[a]=u[a]?u[a]+", "+o:o)})),u),t):null!=e&&n(t,e,i),this}get(e,t){if(e=Ra(e)){var i=sa.findKey(this,e);if(i){var r=this[i];if(!t)return r;if(!0===t)return function(e){for(var t,i=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;t=r.exec(e);)i[t[1]]=t[2];return i}(r);if(sa.isFunction(t))return t.call(this,r,i);if(sa.isRegExp(t))return t.exec(r);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Ra(e)){var i=sa.findKey(this,e);return!(!i||void 0===this[i]||t&&!ka(0,this[i],i,t))}return!1}delete(e,t){var i=this,r=!1;function n(e){if(e=Ra(e)){var n=sa.findKey(i,e);!n||t&&!ka(0,i[n],n,t)||(delete i[n],r=!0)}}return sa.isArray(e)?e.forEach(n):n(e),r}clear(e){for(var t=Object.keys(this),i=t.length,r=!1;i--;){var n=t[i];e&&!ka(0,this[n],n,e,!0)||(delete this[n],r=!0)}return r}normalize(e){var t=this,i={};return sa.forEach(this,((r,n)=>{var s=sa.findKey(i,n);if(s)return t[s]=La(r),void delete t[n];var a=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,((e,t,i)=>t.toUpperCase()+i))}(n):String(n).trim();a!==n&&delete t[n],t[a]=La(r),i[a]=!0})),this}concat(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.constructor.concat(this,...t)}toJSON(e){var t=Object.create(null);return sa.forEach(this,((i,r)=>{null!=i&&!1!==i&&(t[r]=e&&sa.isArray(i)?i.join(", "):i)})),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map((t=>{var i=e(t,2);return i[0]+": "+i[1]})).join("\n")}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e){for(var t=new this(e),i=arguments.length,r=new Array(i>1?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];return r.forEach((e=>t.set(e))),t}static accessor(e){var t=(this[Ia]=this[Ia]={accessors:{}}).accessors,i=this.prototype;function r(e){var r=Ra(e);t[r]||(!function(e,t){var i=sa.toCamelCase(" "+t);["get","set","has"].forEach((r=>{Object.defineProperty(e,r+i,{value:function(e,i,n){return this[r].call(this,t,e,i,n)},configurable:!0})}))}(i,e),t[r]=!0)}return sa.isArray(e)?e.forEach(r):r(e),this}}Ma.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),sa.freezeMethods(Ma.prototype),sa.freezeMethods(Ma);var Pa=Ma;function Oa(e,t){var i=this||Ca,r=t||i,n=Pa.from(r.headers),s=r.data;return sa.forEach(e,(function(e){s=e.call(i,s,n.normalize(),t?t.status:void 0)})),n.normalize(),s}function Da(e){return!(!e||!e.__CANCEL__)}function Na(e,t,i){aa.call(this,null==e?"canceled":e,aa.ERR_CANCELED,t,i),this.name="CanceledError"}sa.inherits(Na,aa,{__CANCEL__:!0});var Fa=wa.isStandardBrowserEnv?{write:function(e,t,i,r,n,s){var a=[];a.push(e+"="+encodeURIComponent(t)),sa.isNumber(i)&&a.push("expires="+new Date(i).toGMTString()),sa.isString(r)&&a.push("path="+r),sa.isString(n)&&a.push("domain="+n),!0===s&&a.push("secure"),document.cookie=a.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}};function Ua(e,t){return e&&!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)?function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}var za=wa.isStandardBrowserEnv?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),i=document.createElement("a");function r(e){var r=e;return t&&(i.setAttribute("href",r),r=i.href),i.setAttribute("href",r),{href:i.href,protocol:i.protocol?i.protocol.replace(/:$/,""):"",host:i.host,search:i.search?i.search.replace(/^\?/,""):"",hash:i.hash?i.hash.replace(/^#/,""):"",hostname:i.hostname,port:i.port,pathname:"/"===i.pathname.charAt(0)?i.pathname:"/"+i.pathname}}return e=r(window.location.href),function(t){var i=sa.isString(t)?r(t):t;return i.protocol===e.protocol&&i.host===e.host}}():function(){return!0};function Ba(e,t){var i=0,r=function(e,t){e=e||10;var i,r=new Array(e),n=new Array(e),s=0,a=0;return t=void 0!==t?t:1e3,function(o){var h=Date.now(),u=n[a];i||(i=h),r[s]=o,n[s]=h;for(var l=a,c=0;l!==s;)c+=r[l++],l%=e;if((s=(s+1)%e)===a&&(a=(a+1)%e),!(h-i<t)){var d=u&&h-u;return d?Math.round(1e3*c/d):void 0}}}(50,250);return n=>{var s=n.loaded,a=n.lengthComputable?n.total:void 0,o=s-i,h=r(o);i=s;var u={loaded:s,total:a,progress:a?s/a:void 0,bytes:o,rate:h||void 0,estimated:h&&a&&s<=a?(a-s)/h:void 0,event:n};u[t?"download":"upload"]=!0,e(u)}}var ja={http:null,xhr:"undefined"!=typeof XMLHttpRequest&&function(e){return new Promise((function(t,i){var r,n=e.data,s=Pa.from(e.headers).normalize(),a=e.responseType;function o(){e.cancelToken&&e.cancelToken.unsubscribe(r),e.signal&&e.signal.removeEventListener("abort",r)}sa.isFormData(n)&&(wa.isStandardBrowserEnv||wa.isStandardBrowserWebWorkerEnv)&&s.setContentType(!1);var h=new XMLHttpRequest;if(e.auth){var u=e.auth.username||"",l=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";s.set("Authorization","Basic "+btoa(u+":"+l))}var c=Ua(e.baseURL,e.url);function d(){if(h){var r=Pa.from("getAllResponseHeaders"in h&&h.getAllResponseHeaders());!function(e,t,i){var r=i.config.validateStatus;i.status&&r&&!r(i.status)?t(new aa("Request failed with status code "+i.status,[aa.ERR_BAD_REQUEST,aa.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i)):e(i)}((function(e){t(e),o()}),(function(e){i(e),o()}),{data:a&&"text"!==a&&"json"!==a?h.response:h.responseText,status:h.status,statusText:h.statusText,headers:r,config:e,request:h}),h=null}}if(h.open(e.method.toUpperCase(),va(c,e.params,e.paramsSerializer),!0),h.timeout=e.timeout,"onloadend"in h?h.onloadend=d:h.onreadystatechange=function(){h&&4===h.readyState&&(0!==h.status||h.responseURL&&0===h.responseURL.indexOf("file:"))&&setTimeout(d)},h.onabort=function(){h&&(i(new aa("Request aborted",aa.ECONNABORTED,e,h)),h=null)},h.onerror=function(){i(new aa("Network Error",aa.ERR_NETWORK,e,h)),h=null},h.ontimeout=function(){var t=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded",r=e.transitional||ba;e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),i(new aa(t,r.clarifyTimeoutError?aa.ETIMEDOUT:aa.ECONNABORTED,e,h)),h=null},wa.isStandardBrowserEnv){var p=(e.withCredentials||za(c))&&e.xsrfCookieName&&Fa.read(e.xsrfCookieName);p&&s.set(e.xsrfHeaderName,p)}void 0===n&&s.setContentType(null),"setRequestHeader"in h&&sa.forEach(s.toJSON(),(function(e,t){h.setRequestHeader(t,e)})),sa.isUndefined(e.withCredentials)||(h.withCredentials=!!e.withCredentials),a&&"json"!==a&&(h.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&h.addEventListener("progress",Ba(e.onDownloadProgress,!0)),"function"==typeof e.onUploadProgress&&h.upload&&h.upload.addEventListener("progress",Ba(e.onUploadProgress)),(e.cancelToken||e.signal)&&(r=t=>{h&&(i(!t||t.type?new Na(null,e,h):t),h.abort(),h=null)},e.cancelToken&&e.cancelToken.subscribe(r),e.signal&&(e.signal.aborted?r():e.signal.addEventListener("abort",r)));var g,f=(g=/^([-+\w]{1,25})(:?\/\/|:)/.exec(c))&&g[1]||"";f&&-1===wa.protocols.indexOf(f)?i(new aa("Unsupported protocol "+f+":",aa.ERR_BAD_REQUEST,e)):h.send(n||null)}))}};sa.forEach(ja,((e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(i){}Object.defineProperty(e,"adapterName",{value:t})}}));var Ha=e=>{for(var t,i,r=(e=sa.isArray(e)?e:[e]).length,n=0;n<r&&(t=e[n],!(i=sa.isString(t)?ja[t.toLowerCase()]:t));n++);if(!i){if(!1===i)throw new aa(`Adapter ${t} is not supported by the environment`,"ERR_NOT_SUPPORT");throw new Error(sa.hasOwnProp(ja,t)?`Adapter '${t}' is not available in the build`:`Unknown adapter '${t}'`)}if(!sa.isFunction(i))throw new TypeError("adapter is not a function");return i};function Va(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Na(null,e)}function Wa(e){return Va(e),e.headers=Pa.from(e.headers),e.data=Oa.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1),Ha(e.adapter||Ca.adapter)(e).then((function(t){return Va(e),t.data=Oa.call(e,e.transformResponse,t),t.headers=Pa.from(t.headers),t}),(function(t){return Da(t)||(Va(e),t&&t.response&&(t.response.data=Oa.call(e,e.transformResponse,t.response),t.response.headers=Pa.from(t.response.headers))),Promise.reject(t)}))}var Ga=e=>e instanceof Pa?e.toJSON():e;function Xa(e,t){t=t||{};var i={};function r(e,t,i){return sa.isPlainObject(e)&&sa.isPlainObject(t)?sa.merge.call({caseless:i},e,t):sa.isPlainObject(t)?sa.merge({},t):sa.isArray(t)?t.slice():t}function n(e,t,i){return sa.isUndefined(t)?sa.isUndefined(e)?void 0:r(void 0,e,i):r(e,t,i)}function s(e,t){if(!sa.isUndefined(t))return r(void 0,t)}function a(e,t){return sa.isUndefined(t)?sa.isUndefined(e)?void 0:r(void 0,e):r(void 0,t)}function o(i,n,s){return s in t?r(i,n):s in e?r(void 0,i):void 0}var h={url:s,method:s,data:s,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:o,headers:(e,t)=>n(Ga(e),Ga(t),!0)};return sa.forEach(Object.keys(e).concat(Object.keys(t)),(function(r){var s=h[r]||n,a=s(e[r],t[r],r);sa.isUndefined(a)&&s!==o||(i[r]=a)})),i}var qa="1.3.4",Ya={};["object","boolean","number","function","string","symbol"].forEach(((e,t)=>{Ya[e]=function(i){return typeof i===e||"a"+(t<1?"n ":" ")+e}}));var $a={};Ya.transitional=function(e,t,i){function r(e,t){return"[Axios v1.3.4] Transitional option '"+e+"'"+t+(i?". "+i:"")}return(i,n,s)=>{if(!1===e)throw new aa(r(n," has been removed"+(t?" in "+t:"")),aa.ERR_DEPRECATED);return t&&!$a[n]&&($a[n]=!0,console.warn(r(n," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(i,n,s)}};var Ka={assertOptions:function(e,t,i){if("object"!=typeof e)throw new aa("options must be an object",aa.ERR_BAD_OPTION_VALUE);for(var r=Object.keys(e),n=r.length;n-- >0;){var s=r[n],a=t[s];if(a){var o=e[s],h=void 0===o||a(o,s,e);if(!0!==h)throw new aa("option "+s+" must be "+h,aa.ERR_BAD_OPTION_VALUE)}else if(!0!==i)throw new aa("Unknown option "+s,aa.ERR_BAD_OPTION)}},validators:Ya},Za=Ka.validators;class Qa{constructor(e){this.defaults=e,this.interceptors={request:new xa,response:new xa}}request(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{};var i,r=t=Xa(this.defaults,t),n=r.transitional,s=r.paramsSerializer,a=r.headers;void 0!==n&&Ka.assertOptions(n,{silentJSONParsing:Za.transitional(Za.boolean),forcedJSONParsing:Za.transitional(Za.boolean),clarifyTimeoutError:Za.transitional(Za.boolean)},!1),void 0!==s&&Ka.assertOptions(s,{encode:Za.function,serialize:Za.function},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase(),(i=a&&sa.merge(a.common,a[t.method]))&&sa.forEach(["delete","get","head","post","put","patch","common"],(e=>{delete a[e]})),t.headers=Pa.concat(i,a);var o=[],h=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(h=h&&e.synchronous,o.unshift(e.fulfilled,e.rejected))}));var u,l=[];this.interceptors.response.forEach((function(e){l.push(e.fulfilled,e.rejected)}));var c,d=0;if(!h){var p=[Wa.bind(this),void 0];for(p.unshift.apply(p,o),p.push.apply(p,l),c=p.length,u=Promise.resolve(t);d<c;)u=u.then(p[d++],p[d++]);return u}c=o.length;var g=t;for(d=0;d<c;){var f=o[d++],m=o[d++];try{g=f(g)}catch(_){m.call(this,_);break}}try{u=Wa.call(this,g)}catch(_){return Promise.reject(_)}for(d=0,c=l.length;d<c;)u=u.then(l[d++],l[d++]);return u}getUri(e){return va(Ua((e=Xa(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}}sa.forEach(["delete","get","head","options"],(function(e){Qa.prototype[e]=function(t,i){return this.request(Xa(i||{},{method:e,url:t,data:(i||{}).data}))}})),sa.forEach(["post","put","patch"],(function(e){function t(t){return function(i,r,n){return this.request(Xa(n||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:i,data:r}))}}Qa.prototype[e]=t(),Qa.prototype[e+"Form"]=t(!0)}));var Ja=Qa;class eo{constructor(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var i=this;this.promise.then((e=>{if(i._listeners){for(var t=i._listeners.length;t-- >0;)i._listeners[t](e);i._listeners=null}})),this.promise.then=e=>{var t,r=new Promise((e=>{i.subscribe(e),t=e})).then(e);return r.cancel=function(){i.unsubscribe(t)},r},e((function(e,r,n){i.reason||(i.reason=new Na(e,r,n),t(i.reason))}))}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(this._listeners){var t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}}static source(){var e;return{token:new eo((function(t){e=t})),cancel:e}}}var to=eo;var io={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(io).forEach((t=>{var i=e(t,2),r=i[0],n=i[1];io[n]=r}));var ro=io;var no=function e(t){var i=new Ja(t),r=Cs(Ja.prototype.request,i);return sa.extend(r,Ja.prototype,i,{allOwnKeys:!0}),sa.extend(r,i,null,{allOwnKeys:!0}),r.create=function(i){return e(Xa(t,i))},r}(Ca);no.Axios=Ja,no.CanceledError=Na,no.CancelToken=to,no.isCancel=Da,no.VERSION=qa,no.toFormData=pa,no.AxiosError=aa,no.Cancel=no.CanceledError,no.all=function(e){return Promise.all(e)},no.spread=function(e){return function(t){return e.apply(null,t)}},no.isAxiosError=function(e){return sa.isObject(e)&&!0===e.isAxiosError},no.mergeConfig=Xa,no.AxiosHeaders=Pa,no.formToJSON=e=>Ta(sa.isHTMLForm(e)?new FormData(e):e),no.HttpStatusCode=ro,no.default=no;var so=no;class ao{constructor(){this.AxiosAPI=so.create({baseURL:"https://api-entertainment.enlight.diagnal.com/v1b3/content"})}fetch(e){var i=this;return r(t().mark((function r(){var n;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,i.AxiosAPI.get(e);case 3:return n=t.sent,t.abrupt("return",[n,void 0]);case 7:return t.prev=7,t.t0=t.catch(0),t.abrupt("return",[void 0,t.t0]);case 10:case"end":return t.stop()}}),r,null,[[0,7]])})))()}}class oo extends mt.Component{constructor(){super(...arguments),this.index=-1,this.dataLength=0,this.railIndex=0,this.axiosRequester=new ao,this.responseData={},this.data=[]}static _template(){return{Header:{x:50,y:20,color:xs.white,text:{text:"",fontSize:35}},Slider:{w:800,h:350,x:480,y:280,mount:.5,Wrapper:{}}}}_init(){var e=[];this.railIndex<bs.length?this.axiosRequester.fetch(bs[this.railIndex]).then((t=>{if(t){var i;this.responseData=null===(i=t[0])||void 0===i?void 0:i.data,this.dataLength=this.responseData.totalElements||0,this.data=this.responseData.content||[];for(var r=0;r<this.dataLength;r++){var n,s,a,o,h,u=Ts,l=null===(n=this.data[r])||void 0===n||null===(s=n.images.find((e=>288===e.width)))||void 0===s?void 0:s.url;if(10===this.dataLength||31===this.dataLength)u=Ss,l=null===(o=this.data[r])||void 0===o||null===(h=o.images.find((e=>526===e.width)))||void 0===h?void 0:h.url;var c=null===(a=this.data[r])||void 0===a?void 0:a.title,d=u.w+u.margin;e.push({type:As,x:r*d,item:{label:c,src:l||"https://pmd205470tn-a.akamaihd.net/D2C_-_Content/191/249/oyPcsfGWL5Se6RGW1JCVgpHlASH_288x432_13635141800.jpg",data:this.data[r],index:r,totalElements:this.dataLength,cardSize:u}})}}this.patch({Header:{text:ws[this.railIndex]}}),this.tag("Wrapper").children=e,this.index=0,this._setState("RowItem")})):this.setLongRail()}setLongRail(){var e=this;return r(t().mark((function i(){var r,n,s,a,o,h,u;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("je"),t.next=3,yr.get("longData");case 3:for(e.data=t.sent,e.dataLength=e.data.length,console.log(e.data.length),r=[],n=0;n<e.dataLength;n++)h=null===(s=e.data[n])||void 0===s?void 0:s.title,u=null===(a=e.data[n])||void 0===a||null===(o=a.images.find((e=>288===e.width)))||void 0===o?void 0:o.url,r.push({type:As,x:246*n,item:{label:h,src:u||"https://pmd205470tn-a.akamaihd.net/D2C_-_Content/191/249/oyPcsfGWL5Se6RGW1JCVgpHlASH_288x432_13635141800.jpg",data:e.data[n]}});e.patch({Header:{text:ws[e.railIndex]}}),e.tag("Wrapper").children=r,e.index=0;case 11:case"end":return t.stop()}}),i)})))()}repositionWrapper(){var e=this.tag("Wrapper"),t=e.children[this.index].cardSize;this.index<this.dataLength-(t.minimumCardsInViewport-1)&&e.setSmooth("x",-(t.w+t.margin)*this.index,{duration:.3})}_handleLeft(){this.index>0&&(this.index-=1,this.repositionWrapper())}_handleRight(){this.index<this.dataLength-1&&(this.index+=1,this.repositionWrapper())}_getFocused(){return this.tag("Slider.Wrapper").children[this.index]}}class ho extends mt.Component{static _template(){return{NavText:{w:120,color:xs.accentGrey.light,text:{fontSize:35}}}}set navtext(e){this.patch({NavText:{text:null==e?void 0:e.toString()}})}_focus(){this.patch({smooth:{scale:1.1},NavText:{smooth:{color:xs.white}},Rectangle:{color:xs.yellow,x:2,y:e=>e+50,w:100,h:5,rect:!0}})}_unfocus(){this.patch({smooth:{color:xs.primary,scale:1},NavText:{smooth:{color:xs.accentGrey.light}},Rectangle:void 0})}}class uo extends mt.Component{static _template(){return{w:50,h:50,src:"https://pmd205470tn-a.akamaihd.net/D2C_-_Content/808/289/5qtySjfuJfOLvVrVXuwNo2BIVPH.jpg",shader:{type:mt.shaders.RoundedRectangle,radius:10,stroke:5,strokeColor:xs.white}}}set navtext(e){this.patch({NavText:{text:null==e?void 0:e.toString()}})}_focus(){this.patch({smooth:{scale:1.1},shader:{strokeColor:xs.yellow}})}_unfocus(){this.patch({smooth:{scale:1},shader:{strokeColor:xs.white}})}}class lo extends mt.Component{constructor(){super(...arguments),this.index=0}static _template(){return{Navbar:{w:1920,h:1080,rect:!0,zIndex:1,shader:{x:100,y:-100,pivot:.5,type:mt.shaders.RadialGradient,outerColor:xs.primaryLight,innerColor:xs.dark,radius:800},NavItems:{x:10,y:10,NavMenu:{shader:null}}}}}_init(){var e,t={Home:{type:ho,x:20,y:12,navtext:"Home"},Search:{type:ho,x:140,y:12,navtext:"Search"},Gridlayout:{type:ho,x:280,y:12,navtext:"Grids"},Profile:{x:1840,y:15,type:uo}};this.tag("Navbar.NavItems.NavMenu").children=t,null===this.tag("Navbar")||void 0===e||e.animation({duration:8,repeat:-1,delay:2,actions:[{p:"shader.radius",v:{0:{v:800},.5:{v:400},1:{v:800}}}]}).start()}_handleLeft(){this.index>0&&(this.index-=1)}_handleRight(){this.index<3&&(this.index+=1)}_handleEnter(){0===this.index?vs.navigate("home"):1===this.index?vs.navigate("search"):2===this.index?vs.navigate("grid"):vs.navigate("settings")}_getFocused(){return this.tag("Navbar.NavItems.NavMenu").children[this.index]}_focus(){}_unfocus(){this.index=0}}class co extends mt.Component{static _template(){return{Back:{w:80,color:xs.accentGrey.light,text:{text:"Back",fontSize:35}}}}_focus(){this.patch({smooth:{scale:1.1},Back:{smooth:{color:xs.white}},Rectangle:{color:xs.yellow,x:2,y:e=>e+50,w:80,h:5,rect:!0}})}_unfocus(){this.patch({smooth:{color:xs.primary,scale:1},Back:{smooth:{color:xs.accentGrey.light}},Rectangle:void 0})}}class po extends mt.Component{static _template(){return{VideoSpec:{w:120,h:80,shader:{type:mt.shaders.RoundedRectangle,radius:20,stroke:8,strokeColor:xs.accentGrey.light},color:xs.accentGrey.light,Spec:{mount:.5,color:xs.accentGrey.light,text:{fontSize:22}}}}}set specData(e){this.patch({VideoSpec:{Spec:{text:e}}})}}class go extends mt.Component{constructor(){super(...arguments),this._isPlaying=!1}static _template(){return{mount:.5,x:960,y:540,rect:!0,w:150,h:150,color:0,Background:{rect:!0,w:150,h:150,color:4289440683,shader:{type:mt.shaders.RoundedRectangle,radius:75}},Text:{mount:.5,x:75,y:75,text:{textColor:4294967295,text:"Pause"}}}}_setup(){this._isPlaying=!0}set isPlaying(e){this._isPlaying=e,this.tag("Text").patch({text:{text:e?"Pause":"Play"}})}get isPlaying(){return this._isPlaying}}class fo extends mt.Component{static _template(){return{Button:{w:500,h:100,color:0,rect:!0,shader:{type:mt.shaders.RadialGradient,innerColor:xs.accentGrey.dark},Label:{shader:null,h:e=>e,text:{fontSize:35,textColor:xs.white,textAlign:"left",textIndent:20,textBaseline:"hanging"}}}}}set label(e){this.patch({Button:{Label:{text:e}}})}_focus(){this.patch({smooth:{scale:1.1},Button:{shader:{innerColor:2868042585},Label:{text:{textColor:xs.white}}}})}_unfocus(){this.patch({smooth:{scale:1},Button:{shader:{innerColor:xs.accentGrey.dark}}})}}class mo extends mt.Component{constructor(){super(...arguments),this.left=this.tag("Gradient.Left"),this.right=this.tag("Gradient.Right"),this.top=this.tag("Gradient.Top"),this.bottom=this.tag("Gradient.Bottom"),this.topLeft=this.tag("Gradient.TopLeft"),this.bottomLeft=this.tag("Gradient.BottomLeft"),this.topRight=this.tag("Gradient.TopRight"),this.bottomRight=this.tag("Gradient.BottomRight")}static _template(){return{Image:{shader:null},Gradient:{Left:{h:e=>e,rect:!0,shader:null,visible:!1,colorRight:or("transparent").get()},Right:{h:e=>e,rect:!0,shader:null,visible:!1,mountX:1,colorLeft:or("transparent").get()},Top:{w:e=>e,rect:!0,shader:null,visible:!1,colorBottom:or("transparent").get()},Bottom:{w:e=>e,rect:!0,shader:null,visible:!1,mountY:1,colorTop:or("transparent").get()},TopLeft:{rect:!0,shader:null,visible:!1,color:or("transparent").get(),colorUl:or("black").get()},BottomLeft:{rect:!0,shader:null,visible:!1,mountY:1,color:or("transparent").get(),colorBl:or("black").get()},TopRight:{rect:!0,shader:null,visible:!1,mountX:1,color:or("transparent").get(),colorUr:or("black").get()},BottomRight:{rect:!0,shader:null,visible:!1,mountX:1,mountY:1,color:or("transparent").get(),colorBr:or("black").get()}}}}set props(e){for(var t=e.w,i=e.h,r=e.imgSrc,n=e.color,s=e.left,a=e.right,o=e.top,h=e.bottom,u=e.topLeft,l=e.bottomLeft,c=e.topRight,d=e.bottomRight,p=["left","right","top","bottom","topLeft","topRight","bottomLeft","bottomRight"],g=0,f=Object.keys(e);g<f.length;g++){var m=f[g];e[m]&&p.includes(m)&&this[m].patch({visible:!0})}this.tag("Image").patch({w:t,h:i,src:r}),this.tag("Gradient").patch({w:t,h:i}),this.left.patch({w:s,colorLeft:n}),this.right.patch({x:t,w:a,colorRight:n}),this.top.patch({h:o,colorTop:n}),this.bottom.patch({y:i,h:h,colorBottom:n}),this.topLeft.patch({w:u,h:i,colorUl:n}),this.bottomLeft.patch({w:l,h:i,y:i,colorBl:n}),this.topRight.patch({x:t,w:c,h:i,colorUr:n}),this.bottomRight.patch({x:t,y:i,w:d,h:i,colorBr:n})}}class _o extends mt.Component{constructor(){super(...arguments),this.firstActive=!0}static _template(){return{ContentView:{Thumbnail:{x:800,shader:null,type:mo},ContentDetails:{ContentData:{shader:null,zIndex:2,Title:{x:40,y:165,shader:null,text:{fontSize:80},color:xs.white},Description:{x:40,y:270,w:900,shader:null,text:{wordWrap:!0,maxLines:3,maxLinesSuffix:"...",fontSize:30},color:xs.accentGrey.light},Genre:{x:40,y:380,w:900,shader:null,text:{fontSize:24},color:xs.accentGrey.light},Info:{visible:!1,Director:{x:40,y:440,w:100,shader:null,text:{text:"Director : ",fontSize:24},color:xs.accentGrey.light},Starring:{x:40,y:470,w:100,shader:null,text:{text:"Staring  : ",fontSize:24},color:xs.accentGrey.light},DirectorList:{x:150,y:440,w:800,shader:null,text:{fontSize:24},color:xs.accentGrey.light},StarringList:{x:150,y:470,w:800,shader:null,text:{fontSize:24,wordWrap:!0,maxLines:1,maxLinesSuffix:"..."},color:xs.accentGrey.light}},VideoSpec:{visible:!1,VideoSpec1:{x:70,y:140,shader:null,type:po,specData:"  16+  "},VideoSpec2:{x:135,y:140,shader:null,type:po,specData:"  4k  "},VideoSpec3:{x:193,y:140,shader:null,type:po,specData:"  cc  "}}}}}}}set data(e){var t=e.imgSrc,i=e.title,r=e.description,n=e.genre,s=e.directorsList,a=e.actorsList;this.tag("ContentView.Thumbnail").patch({props:{imgSrc:t,w:800,h:480,color:xs.black,left:200,bottom:200,topLeft:200,bottomLeft:200}}),this.tag("ContentView.Thumbnail").transition("src").on("start",(()=>{this.tag("ContentView.Thumbnail").setSmooth("alpha",0,{duration:.5})})),this.tag("ContentView.Thumbnail").transition("src").on("finish",(()=>{this.tag("ContentView.Thumbnail").setSmooth("alpha",1,{duration:.5})}));var o=this.tag("ContentView.ContentDetails").animation({duration:1,delay:0,actions:[{p:"alpha",v:{0:1,.5:0,.8:0,1:1}},{p:"x",v:{0:10,.6:-100,.65:10}},{p:"y",v:{0:0,.6:0,.65:-30,1:0}}]});if(this.patch({ContentView:{shader:{type:mt.shaders.RadialGradient,x:300,y:300,innerColor:4278190080,radius:1500},ContentDetails:{x:10,ContentData:{Title:{text:{text:i}},Description:{text:{text:r}},Genre:{text:{text:n}},Info:{visible:!0,DirectorList:{text:{text:s}},StarringList:{text:{text:a}}},VideoSpec:{visible:!0}}}}}),this.firstActive)return this.firstActive=!1,void this.tag("ContentView.ContentDetails").animation({duration:1,delay:0,repeat:0,actions:[{p:"alpha",v:{0:0,1:1}},{p:"y",v:{0:-30,1:0}}]}).start();o.start()}animate(){this.tag("ContentView.ContentDetails").animation({duration:2,delay:0,actions:[{p:"alpha",v:{0:1,.5:0}},{p:"y",v:{0:0,.5:-30,1:0}}]}).start()}_init(){this.tag("ContentView.Thumbnail").on("txError",(()=>{console.error("texture failed to load: "+this.tag("ContentView.Thumbnail").src)}))}}class vo extends mt.Component{static _template(){return{Box:{x:80,y:665,InnerBox:{zIndex:3,w:100,h:100,rect:!0,shader:{type:mt.shaders.RoundedRectangle,radius:20,stroke:5,strokeColor:xs.yellow},color:or("transparent")}}}}}class yo extends mt.Component{constructor(){super(...arguments),this.index=0,this.rowLength=bs.length,this.hideNav=!1,this.eventData={},this.Wrapper=this.getByRef("Background.Slider.Wrapper")}static _template(){return{Background:{w:1920,h:1080,color:xs.black,rect:!0,Box:{x:80,y:665,InnerBox:{zIndex:3,w:100,h:100,rect:!0,shader:{type:mt.shaders.RoundedRectangle,radius:20,stroke:5,strokeColor:xs.yellow},color:or("transparent")}},ContentDetails:{type:_o},Slider:{zIndex:2,clipping:!0,w:1920,h:e=>e,x:960,y:1100,mount:.5,Wrapper:{}}}}}$changeItemOnFocus(e,t){var i,r,n=null===(i=e.images.find((e=>828===e.width)))||void 0===i?void 0:i.url,s=e.title,a=e.description,o=e.genre.join(" . "),h=e.director.map((e=>e.personName)).join(", "),u=e.actor.map((e=>e.personName)).join(", "),l=t.railTotalElements,c=t.cardIndex,d=t.cardSize,p=d.minimumCardsInViewport,g=d.w,f=d.h,m=d.margin,_={type:_o,data:{imgSrc:n,title:s,description:a,genre:o,directorsList:h,actorsList:u}};this.tag("Background.ContentDetails").patch(_),null===(r=this.tag("Box"))||void 0===r||r.patch({InnerBox:{w:g,h:f}});var v=this.tag("Box");c>=l-(p-1)?v.setSmooth("x",(g+m)*(p-(l-c))+80,{duration:.3}):v.setSmooth("x",80,{duration:.3})}_init(){this.backgroundFetchAndSave();for(var e=[],t=0;t<this.rowLength;t++)e.push({type:oo,x:0,y:550*t,railIndex:t});this.tag("Background.Slider.Wrapper").children=e}backgroundFetchAndSave(){return r(t().mark((function e(){var i,r,n,s,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=new ao,r=[],n=0,s=bs;case 3:if(!(n<s.length)){e.next=10;break}return a=s[n],e.next=7,i.fetch(a).then((e=>{if(e){var t,i=(null===(t=e[0])||void 0===t?void 0:t.data).content||[];r=[...r,...i]}}));case 7:n++,e.next=3;break;case 10:return e.next=12,yr.set("longData",r);case 12:case"end":return e.stop()}}),e)})))()}repositionWrapper(){var e=this.tag("Background.Slider.Wrapper"),t=this.tag("Background.Slider").h,i=e.transition("y").targetvalue||e.y,r=e.children[this.index],n=r.y+i,s=r.y+r.h;n<0?e.setSmooth("y",-r.y):s>t&&e.setSmooth("y",t-s)}_active(){var e=this.tag("Background.Slider").animation({duration:1,delay:0,actions:[{p:"alpha",v:{0:0,1:1}},{p:"y",v:{0:1400,1:1100}}]}),t=this.tag("Background.Box").animation({duration:1,delay:0,actions:[{p:"alpha",v:{0:0,1:1}},{p:"y",v:{0:965,1:665}}]});e.start(),t.start()}_handleUp(){this.index>0&&(this.index-=1,this.index>=0&&this.repositionWrapper())}_handleDown(){this.index<this.rowLength-1&&(this.index+=1,this.repositionWrapper())}_getFocused(){return this.index<=0?this.patch({Navbar:{visible:!0}}):this.patch({Navbar:{visible:!1}}),this.index>=0?this.tag("Background.Slider.Wrapper").children[this.index]:this.tag("Navbar")}pageTransitionOut(e){return new Promise(((e,t)=>{this.tag("Background.Slider").patch({smooth:{y:[1300,{duration:1,delay:0,timingFunction:"ease"}],alpha:0}}),this.tag("Background.Box").patch({smooth:{y:[865,{duration:1,delay:0,timingFunction:"ease"}],alpha:0}}),this.tag("Background.ContentDetails").animate(),this.tag("Background.Slider").transition("y").on("finish",(()=>{e()}))}))}}class xo extends mt.Component{static _template(){return{Wrapper:{}}}_construct(){this._direction=xo.DIRECTION.row,this._scrollTransitionSettings=this.stage.transitions.createSettings({}),this._spacing=0,this._autoResize=!1,this._requestingItems=!1,this._requestThreshold=1,this._requestsEnabled=!1,this._gcThreshold=5,this._gcIncrement=0,this._forceLoad=!1,this.clear()}_setup(){this._updateScrollTransition()}_updateScrollTransition(){var e=1===this._direction?"y":"x";this.wrapper.transition(e,this._scrollTransitionSettings),this._scrollTransition=this.wrapper.transition(e)}_indexChanged(e){e.previousIndex;var t=e.index,i=e.dataLength,r=e.mainIndex,n=e.previousMainIndex,s=e.lines;isNaN(n)||isNaN(r)||isNaN(s)||(n,t=r,i=s),this._requestsEnabled&&!this._requestingItems&&t+this._requestThreshold>=i&&this.requestItems(!1,e),this._refocus(),this.scrollCollectionWrapper(e),e.previousIndex!==e.index&&this.signal("onIndexChanged",e)}requestItems(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;void 0===t&&(t={previous:0,index:0,max:0}),this._requestingItems=!0,this.signal("onRequestItems",t).then((t=>{!1===t&&(this.enableRequests=!1),this._requestingItems=!1,e&&this.clear();var i=typeof t;(Array.isArray(t)||"object"===i||"string"===i||"number"===i)&&this.add(t)}))}setIndex(e){var t=So(e,0,this._items.length-1),i=this._index;return this._index=t,this._indexChanged({previousIndex:i,index:t,dataLength:this._items.length}),i!==t}clear(){if(this._uids=[],this._items=[],this._index=0,this._scrollTransition&&this._scrollTransition.reset(0,1),this.wrapper){var e=this.wrapper.children>0;this.wrapper.patch({x:0,y:0,children:[]}),e&&this._collectGarbage(!0)}}add(e){this.addAt(e)}addAt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._items.length;if(!(t>=0&&t<=this._items.length))throw new Error("addAt: The index "+t+" is out of bounds "+this._items.length);Array.isArray(e)||(e=[e]);var i=this._normalizeDataItems(e);this._items.splice(t,0,...i),this.plotItems(),this.setIndex(this._index)}remove(e){if(!this.hasItems||!e.assignedID)throw new Error("remove: item not found");for(var t=this.itemWrappers,i=0;i<this._items.length;i++){var r=this._items[i];if(t[i]&&t[i].component.isAlive&&(r=t[i].component),e.assignedID===r.assignedID)return this.removeAt(i)}}removeAt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(e<0&&e>=this._items.length)throw new Error("removeAt: The index "+e+" is out of bounds "+this._items.length);var i=this._items[e];return this._items.splice(e,t),this.plotItems(),i}reload(e){this.clear(),this.add(e)}plotItems(e,t){}reposition(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:70;this._repositionDebounce&&clearTimeout(this._repositionDebounce),this._repositionDebounce=setTimeout((()=>{this.repositionItems()}),e)}repositionItems(){this.signal("onItemsRepositioned")}up(){return this._attemptNavigation(-1,1)}down(){return this._attemptNavigation(1,1)}left(){return this._attemptNavigation(-1,0)}right(){return this._attemptNavigation(1,0)}first(){return this.setIndex(0)}last(){return this.setIndex(this._items.length-1)}next(){return this.setIndex(this._index+1)}previous(){return this.setIndex(this._index-1)}_attemptNavigation(e,t){return!!this.hasItems&&this.navigate(e,t)}navigate(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._direction)===this._direction&&this.setIndex(this._index+e)}scrollCollectionWrapper(e){var t=e.previousIndex,i=e.index,r=e.dataLength,n=e.mainIndex,s=e.previousMainIndex,a=e.lines;isNaN(s)||isNaN(n)||isNaN(a)||(t=s,i=n,r=a);var o=this._getPlotProperties(this._direction),h=o.directionIsRow,u=o.main,l=o.mainDim,c=o.mainMarginFrom,d=o.mainMarginTo,p=this.currentItemWrapper,g=this[l];0===g&&(g=h?1920:1080);var f=Math.min(this.wrapper[u],this._scrollTransition&&this._scrollTransition.targetValue||0),m=this._getItemSizes(p),_=m[c]||m.margin||0,v=m[d]||m.margin||0,y=this._scroll;if(isNaN(y))if("function"==typeof y)y=y.apply(this,[p,e]);else if("object"==typeof y){var x=y,b=x.jump,w=void 0!==b&&b,T=x.after,S=void 0!==T&&T,A=x.backward,C=void 0===A?0:A,E=x.forward,I=void 0===E?1:E;if(w){var R=i%w;if(0===R&&(y=_-p[u]),R===w-1)y=R*(_+p[l]+v)+_-p[u]}else if(S){if(y=0,i>=S-1)y=(S-1)*(_+p[l]+v)+_-p[u]}else{var L=g*this._normalizePixelToPercentage(C,g),k=g*this._normalizePixelToPercentage(I,g);i<r-1&&t<i&&f+p[u]+p[l]>k?y=k-(p[u]+p[l]):i>0&&i<t&&f+p[u]<L?y=L-p[u]:i===r-1?y=g-(p[u]+p[l]):0===i&&(y=_-p[u])}}else isNaN(y)&&(t<i&&f+p[u]+p[l]>g?y=g-(p[u]+p[l]):i<t&&f+p[u]<0&&(y=_-p[u]));else y>=0&&y<=1?y=g*y-(p[u]+p[l]*y):y-=p[u];this.active&&!isNaN(y)&&this._scrollTransition?this._scrollTransition.isRunning()?this._scrollTransition.reset(y,.05):this._scrollTransition.start(y):isNaN(y)||(this.wrapper[u]=y)}$childInactive(e){var t=e.child;if("object"==typeof t){var i=t.componentIndex;for(var r in this._items[i])void 0!==t.component[r]&&(this._items[i][r]=t.component[r])}this._collectGarbage()}$getChildComponent(e){var t=e.index;return this._items[t]}_resizeWrapper(e){var t=e;if(!isNaN(e)){var i=this._getPlotProperties(this._direction),r=i.main,n=i.mainDim,s=i.crossDim,a=this.wrapper.childList.last;t={[n]:a[r]+a[n],[s]:e}}this.wrapper.patch(t),this._autoResize&&this.patch(t)}_generateUniqueID(){for(var e="";this._uids[e]||""===e;)e=Math.random().toString(36).substr(2,9);return this._uids[e]=!0,e}_getPlotProperties(e){var t=0===e;return{directionIsRow:!!t,mainDirection:t?"rows":"columns",main:t?"x":"y",mainDim:t?"w":"h",mainMarginTo:t?"marginRight":"marginBottom",mainMarginFrom:t?"marginLeft":"marginTop",crossDirection:t?"rows":"columns",cross:t?"y":"x",crossDim:t?"h":"w",crossMarginTo:t?"marginBottom":"marginRight",crossMarginFrom:t?"marginTop":"marginLeft"}}_getItemSizes(e){var t=e.type;return e.component&&e.component.__attached&&(e=e.component),{w:e.w||t&&t.width,h:e.h||t&&t.height,margin:e.margin||t&&t.margin||0,marginLeft:e.marginLeft||t&&t.marginLeft,marginRight:e.marginRight||t&&t.marginRight,marginTop:e.marginTop||t&&t.marginTop,marginBottom:e.marginBottom||t&&t.marginBottom}}_collectGarbage(e){this._gcIncrement++,(e||this.active&&0!==this._gcThreshold&&this._gcIncrement>=this._gcThreshold)&&(this._gcIncrement=0,this.stage.gc())}_normalizeDataItems(e){return e.map(((e,t)=>this._normalizeDataItem(e)||t)).filter((e=>!!isNaN(e)||(console.warn(`Item at index: ${e}, is not a valid item. Removing it from dataset`),!1)))}_normalizeDataItem(e,t){return"string"!=typeof e&&"number"!=typeof e||(e={label:e.toString()}),"object"==typeof e?s({assignedID:this._generateUniqueID(),type:this.itemType,collectionWrapper:this,isAlive:!1},e):t}_normalizePixelToPercentage(e,t){return e&&e>1?e/t:e||0}_getFocused(){return this.hasItems?this.currentItemWrapper:this}_handleRight(){return this.right()}_handleLeft(){return this.left()}_handleUp(){return this.up()}_handleDown(){return this.down()}_inactive(){this._repositionDebounce&&clearTimeout(this._repositionDebounce),this._collectGarbage(!0)}static get itemType(){}set forceLoad(e){this._forceLoad=e}get forceLoad(){return this._forceLoad}get requestingItems(){return this._requestingItems}set requestThreshold(e){this._requestThreshold=e}get requestThreshold(){return this._requestThreshold}set enableRequests(e){this._requestsEnabled=e}get enableRequests(){return this._requestsEnabled}set gcThreshold(e){this._gcThreshold=e}get gcThreshold(){return this._gcThreshold}get wrapper(){return this.tag("Wrapper")}get hasItems(){return this.wrapper&&this.wrapper.children&&this.wrapper.children.length>0}get currentItemWrapper(){return this.wrapper.children[this._index]}get currentItem(){return this.currentItemWrapper&&this.currentItemWrapper.component||void 0}set direction(e){this._direction=xo.DIRECTION[e]||xo.DIRECTION.row}get direction(){return Object.keys(xo.DIRECTION)[this._direction]}set items(e){this.clear(),this.add(e)}get items(){var e=this.itemWrappers;return this._items.map(((t,i)=>e[i]&&e[i].component.isAlive?e[i].component:t))}get length(){return this._items.length}set index(e){this.setIndex(e)}get itemWrappers(){return this.wrapper.children}get index(){return this._index}set scrollTransition(e){this._scrollTransitionSettings.patch(e),this.active&&this._updateScrollTransition()}get scrollTransition(){return this._scrollTransition}set scroll(e){this._scroll=e}get scroll(){return this._scroll}set autoResize(e){this._autoResize=e}get autoResize(){return this._autoResize}set spacing(e){this._spacing=e}get spacing(){return this._spacing}}xo.DIRECTION={row:0,column:1};class bo extends mt.Component{static _template(){return{alpha:0}}_construct(){this._blink=!0}_init(){this._blinkAnimation=this.animation({duration:1,repeat:-1,actions:[{p:"alpha",v:{0:0,.5:1,1:0}}]})}show(){this._blink?this._blinkAnimation.start():this.alpha=1}hide(){this._blink?this._blinkAnimation.stop():this.alpha=0}set blink(e){this._blink=e,this.active&&(e?this.show():this.hide())}get blink(){return this._blink}}class wo extends mt.Component{static _template(){return{clipbox:!0}}create(){if(!(this.children.length>0)){var e=this.fireAncestors("$getChildComponent",{index:this.componentIndex});e.isAlive=!0;var t=this.w,i=this.h,r=this.margin,n=this.marginTop,a=this.marginBottom,o=this.marginRight,h=this.marginLeft;this.children=[s(s({},e),{},{w:t,h:i,margin:r,marginTop:n,marginRight:o,marginLeft:h,marginBottom:a})],this.hasFocus()&&this._refocus()}}get component(){return this.children[0]||this.fireAncestors("$getChildComponent",{index:this.componentIndex})}_setup(){this.forceLoad&&this.create()}_active(){this.create()}_inactive(){this.forceLoad||(this.children[0].isAlive=!1,this.fireAncestors("$childInactive",{child:this}),this.childList.clear())}_getFocused(){return this.children&&this.children[0]||this}}class To extends mt.Component{static _template(){return{clipbox:!0}}_update(){var e=this.children&&this.children[0];e&&e.action===this._key.data.action?e.patch(s({},this._key)):this.children=[s({type:this._key.keyType},this._key)],this.hasFocus()&&this._refocus()}set key(e){this._key=e,this.active&&this._update()}get key(){return this._key}_active(){this._update()}_inactive(){this.childList.clear()}_getFocused(){return this.children&&this.children[0]||this}}var So=(e,t,i)=>Math.min(Math.max(e,t),i);class Ao extends xo{_construct(){this._crossSpacing=5,this._mainSpacing=5,this._rows=0,this._columns=0,super._construct()}clear(){super.clear(),this._mainIndex=0,this._crossIndex=0,this._previous=void 0}setIndex(e){var t=So(e,0,this._items.length-1),i=this._index,r=this._findLocationOfIndex(this._index),n=r.mainIndex,s=r.crossIndex,a=this._findLocationOfIndex(t),o=a.mainIndex,h=a.crossIndex;this._mainIndex=o,this._crossIndex=h,this._previous={mainIndex:o,crossIndex:h,realIndex:i},this._index=t,this._indexChanged({previousIndex:i,index:t,mainIndex:o,previousMainIndex:n,crossIndex:h,previousCrossIndex:s,lines:this._lines.length,dataLength:this._items.length})}_findLocationOfIndex(e){for(var t=0;t<this._lines.length;t++)if(this._lines[t].includes(e))return{mainIndex:t,crossIndex:this._lines[t].indexOf(e)};return{mainIndex:-1,crossIndex:-1}}plotItems(){var e=this._items,t=this.wrapper,i=this._getPlotProperties(this._direction),r=i.directionIsRow,n=i.mainDirection,a=i.main,o=i.mainDim,h=i.mainMarginTo,u=i.mainMarginFrom,l=i.cross,c=i.crossDim,d=i.crossMarginTo,p=i.crossMarginFrom,g=this[c],f=0,m=0,_=0,v=[],y=r?1920:1080,x=r?1080:1920,b=this.core.renderContext;this._lines=[[]];var w=[],T=e.map(((e,i)=>{var r=this._getItemSizes(e),T=r[p]||r.margin||0;if(0===i&&(f+=r[u]||r.margin||0),w.length>0&&(this[n]>0&&this[n]===w.length||0===this[n]&&m+T+r[c]>g)){var S=this._getBiggestInLine(w);f=S[a]+S[o]+(S[h]||S.margin||this._mainSpacing),m=T,this._lines.push([]),w=[],_++}else m+=T;var A=`IW-${e.assignedID}`,C=f,E=m,I=t.tag(A);I&&(I.active&&(m!==I[l]||f!==I[a])||!I.active&&(b[`p${a}`]+t[a]+f<=y||b[`p${l}`]+t[l]+m<=x))&&(C=I[a],E=I[l],v.push(i));var R=s(s({ref:A,type:wo,componentIndex:i,forceLoad:this._forceLoad},r),{},{[`assigned${a.toUpperCase()}`]:f,[`assigned${l.toUpperCase()}`]:m,[a]:C,[l]:E});return m+=r[c]+(r[d]||r.margin||this._crossSpacing),this._lines[_].push(i),w.push(R),R}));t.children=T,v.forEach((e=>{var i=t.children[e];i.patch({smooth:{x:i.assignedX,y:i.assignedY}})}));var S=this._getBiggestInLine(w);this._resizeWrapper({[o]:S[a]+S[o],[c]:g})}repositionItems(){var e=this.wrapper;if(!e&&e.children.length)return!0;var t=this._getPlotProperties(this._direction),i=t.main,r=t.mainDim,n=t.mainMarginTo,s=t.mainMarginFrom,a=t.cross,o=t.crossDim,h=t.crossMarginTo,u=t.crossMarginFrom,l=this[o],c=0,d=0,p=0,g=[];this.lines=[[]],e.children.forEach(((e,t)=>{var f=this._getItemSizes(e),m=f[u]||f.margin||0;if(0===t&&(c+=f[s]||f.margin||0),g.length>0&&(this[mainDirection]>0&&this[mainDirection]===g.length||0===this[mainDirection]&&d+m+f[o]>l)){var _=this._getBiggestInLine(g);c=_[i]+_[r]+(_[n]||_.margin||this._mainSpacing),d=m,this._lines.push([]),g=[],p++}else d+=m;e.patch({[`assigned${i.toUpperCase()}`]:c,[`assigned${a.toUpperCase()}`]:d,[i]:c,[a]:d}),d+=f[o]+(f[h]||f.margin||this._crossSpacing),this._lines[p].push(t),g.push(newItem)}));var f=this._getBiggestInLine(g);this._resizeWrapper({[r]:f[i]+f[r],[o]:l}),super.repositionItems()}_getBiggestInLine(e){var t=this._getPlotProperties(this._direction).mainDim;return e.reduce(((e,i)=>i[t]>e[t]?i:e))}navigate(e,t){var i=this._getPlotProperties(this._direction),r=i.directionIsRow,n=i.cross,s=i.crossDim,a=r&&t===xo.DIRECTION.column||!r&&t===xo.DIRECTION.row,o=this._mainIndex+!a*e,h=this._crossIndex+!!a*e,u=this._index;if(a&&h>-1&&h<=this._lines[o].length)void 0!==this._lines[o][h]&&(u=this._lines[o][h],this._previous=void 0);else if(!a&&o<this._lines.length&&o>-1){var l=this._lines[o];if(this._previous&&this._previous.mainIndex===o)u=this._previous.realIndex,h=this._previous.crossIndex;else if(l){for(var c=this.currentItemWrapper,d=l.map((e=>{var t=this.wrapper.children[e];return t[n]<=c[n]&&c[n]<=t[n]+t[s]?t[n]+t[s]-c[n]:t[n]>=c[n]&&t[n]<=c[n]+c[s]?c[n]+c[s]-t[n]:-1})),p=-1,g=-1,f=0;f<d.length&&!(-1===d[f]&&p>-1);f++)d[f]>p&&(p=d[f],g=f);g>-1&&(h=g,u=l[g])}this._previous={mainIndex:this._mainIndex,crossIndex:this._crossIndex,realIndex:this._index}}return this._index!==u&&(this.setIndex(u),!0)}set rows(e){this._rows=e,this.direction="row"}get rows(){return this._rows}set columns(e){this._columns=e,this.direction="column"}get columns(){return this._columns}set crossSpacing(e){this._crossSpacing=e}get crossSpacing(){return this._crossSpacing}set mainSpacing(e){this._mainSpacing=e}get mainSpacing(){return this._mainSpacing}set spacing(e){this._spacing=e,this._mainSpacing=e,this._crossSpacing=e}}class Co extends mt.Component{static _template(){return{PreLabel:{renderOffscreen:!0},PostLabel:{renderOffscreen:!0},Cursor:{type:bo,rect:!0,w:4,h:54,x:0,y:0}}}_construct(){this._input="",this._previousInput="",this._description="",this._cursorX=0,this._cursorIndex=0,this._passwordMask="*",this._passwordMode=!1,this._autoHideCursor=!0,this._labelPositionStatic=!0,this._maxLabelWidth=0}_init(){this.tag("PreLabel").on("txLoaded",(()=>{this._labelTxLoaded()})),this.tag("PostLabel").on("txLoaded",(()=>{this._labelTxLoaded}))}onInputChanged(e){var t=e.input,i=void 0===t?"":t,r=Math.max(i.length-this._input.length+this._cursorIndex,0);this._input=i,this._update(r)}toggleCursor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!this._cursorVisible;this._cursorVisible=e,this.cursor[e?"show":"hide"]()}_labelTxLoaded(){var e=this.tag("PreLabel"),t=this.tag("Cursor"),i=this.tag("PostLabel");this.h=e.renderHeight||i.renderHeight,t.x=e.renderWidth+this._cursorX,i.x=t.x+t.w*(1-t.mountX),this.setSmooth("x",this._labelOffset),this.autoHideCursor||this.toggleCursor(!0)}_update(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this._input.length>0,i=this._description+"",r="";t?(i=this._input.substring(0,e),r=this._input.substring(e,this._input.length),this._passwordMode&&(i=this._passwordMask.repeat(i.length),r=this._passwordMask.repeat(r.length)),this.toggleCursor(!0)):this._autoHideCursor&&this.toggleCursor(!1),this.patch({PreLabel:{text:{text:i}},PostLabel:{text:{text:r}}}),0===this.h&&(this.tag("PreLabel").loadTexture(),this.h=this.tag("PreLabel").renderHeight),this._cursorIndex=e}_handleRight(){this._update(Math.min(this._input.length,this._cursorIndex+1))}_handleLeft(){this._update(Math.max(0,this._cursorIndex-1))}_firstActive(){this._labelTxLoaded(),this._update()}get input(){return this._input}get hasInput(){return this._input.length>0}get cursorIndex(){return this._cursorIndex}set inputText(e){this._inputText=e,this.tag("PreLabel").patch({text:e}),this.tag("PostLabel").patch({text:e})}get inputText(){return this._inputText}set description(e){this._description=e}get description(){return this._description}set cursor(e){e.x&&(this._cursorX=e.x,delete e.x),this.tag("Cursor").patch(e)}get cursor(){return this.tag("Cursor")}get cursorVisible(){return this._cursorVisible}set autoHideCursor(e){this._autoHideCursor=e}get autoHideCursor(){return this._autoHideCursor}set passwordMode(e){this._passwordMode=e}get passwordMode(){return this._passwordMode}set passwordMask(e){this._passwordMask=e}get passwordmask(){return this._passwordMask}set maxLabelWidth(e){this._maxLabelWidth=e}get maxLabelWidth(){return this._maxLabelWidth}set labelPositionStatic(e){this._labelPositionStatic=e}get labelPositionStatic(){return this._labelPositionStatic}get _labelOffset(){if(this._labelPositionStatic)return 0;var e=this.maxLabelWidth-this.tag("Cursor").x;return e<0?e:0}}var Eo=class extends mt.Component{static _template(){return{Background:{w:e=>e,h:e=>e,rect:!0},Label:{mount:.5,x:e=>e/2,y:e=>e/2}}}_construct(){this._backgroundColors={},this._labelColors={}}set data(e){this._data=e,this._update()}get data(){return this._data}set labelText(e){this._labelText=e,this.tag("Label").patch({text:e})}get labelText(){return this._labelText}set label(e){this.tag("Label").patch(e)}get label(){return this.tag("Label")}set labelColors(e){this._labelColors=e,this._update()}get labelColors(){return this._labelColors}set backgroundColors(e){this._backgroundColors=e,this._update()}get backgroundColors(){return this._backgroundColors}set background(e){this.tag("Background").patch(e)}get background(){return this.tag("Background")}_update(){if(this.active){var e=this._data.label,t=void 0===e?"":e,i=this.hasFocus(),r=this._backgroundColors,n=r.focused,s=r.unfocused,a=void 0===s?4278190080:s,o=this._labelColors,h=o.focused,u=o.unfocused,l=void 0===u?4294967295:u;this.patch({Background:{color:i&&n?n:a},Label:{text:{text:t},color:i&&h?h:l}})}}_firstActive(){this._update()}_focus(){var e=this._backgroundColors,t=e.focused,i=e.unfocused,r=void 0===i?4278190080:i,n=this._labelColors,s=n.focused,a=n.unfocused,o=void 0===a?4294967295:a;this.patch({Background:{smooth:{color:t||r}},Label:{smooth:{color:s||o}}})}_unfocus(){var e=this._backgroundColors.unfocused,t=void 0===e?4278190080:e,i=this._labelColors.unfocused,r=void 0===i?4294967295:i;this.patch({Background:{smooth:{color:t}},Label:{smooth:{color:r}}})}static get width(){return 80}static get height(){return 80}};class Io extends mt.Component{static _template(){return{Keys:{w:e=>e}}}_construct(){this._input="",this._inputField=void 0,this._maxCharacters=56,this.navigationWrapAround=!1,this.resetFocus()}resetFocus(){this._columnIndex=0,this._rowIndex=0,this._previousKey=null}_setup(){this._keys=this.tag("Keys"),this._update()}_update(){var e=this._config,t=e.layouts,i=e.buttonTypes,r=void 0===i?{}:i,n=e.styling,a=void 0===n?{}:n;(!this._layout||this._layout&&void 0===t[this._layout])&&(console.error(`Configured layout "${this._layout}" does not exist. Picking first available: "${Object.keys(t)[0]}"`),this._layout=Object.keys(t)[0]);var o=a.horizontalSpacing,h=void 0===o?0:o,u=a.verticalSpacing,l=void 0===u?0:u,c=a.align,d=void 0===c?"left":c,p=0,g=/^[A-Z][A-Za-z0-9]{1}/,f=/\:/;void 0===r.default&&(r.default=Eo),this._keys.children=t[this._layout].map(((e,t)=>{var i=a[`Row${t+1}`]||{},n=i.x,o=void 0===n?0:n,u=i.margin,c=void 0===u?0:u,m=i.marginRight,_=i.marginLeft,v=i.marginTop,y=i.marginBottom,x=i.spacing,b=void 0===x?h||0:x,w=i.align,T=void 0===w?d:w,S=0,A=0,C=e.map(((e,t)=>{var i=e,n=r.default,a="Input",o=e;g.test(e)&&(f.test(e)&&(o=(e=e.split(":"))[1].toString(),e=e[0]),r[e]&&(n=r[e],a=e.action||e));var h=n.margin||n.type.margin,u=n,l=u.w,c=void 0===l?n.type.width||0:l,d=u.h,p=void 0===d?n.type.height||0:d,m=u.marginLeft,_=void 0===m?n.type.marginLeft||h||0:m,v=u.marginRight,y=void 0===v?n.type.marginRight||h||b:v;A=p>A?p:A;var x=S+_;return S+=_+c+y,{ref:`Key-{${t+1}}`,type:To,keyboard:this,x:x,w:c,h:p,key:s({data:{origin:i,key:e,label:o,action:a},w:c,h:p},n)}})),E=o+(_||c),I=0;this.w&&"center"===T&&(E=this.w/2,I=.5),this.w&&"right"===T&&(E=this.w-(m||c),I=1);var R=p+(v||c);return p=R+A+(y||c||l),{ref:`Row-${t+1}`,x:E,mountX:I,w:S,y:R,children:C}})),this._refocus()}_getFocused(){return this.currentKeyWrapper||this}_handleRight(){return this.navigate("row",1)}_handleLeft(){return this.navigate("row",-1)}_handleUp(){return this.navigate("column",-1)}_handleDown(){return this.navigate("column",1)}_handleKey(e){var t=e.key,i=e.code;if("Backspace"===(void 0===i?"CustomKey":i)&&0===this._input.length)return!1;" "===t&&(t="Space");var r=this._findKey(t);return r&&this._handleEnter(),r}_findKey(e){for(var t=this._config.layouts[this._layout],i=0,r=0;i<t.length;i++)for(r=0;r<t[i].length;r++){var n=t[i][r];if(e.length>1&&n.indexOf(e)>-1||n.toUpperCase()===e.toUpperCase())return this._rowIndex=i,this._columnIndex=r,!0}return!1}_handleEnter(){var e=this.currentKey.data,t=e.origin,i=e.action,r={index:this._input.length,key:t};if(this._inputField&&this._inputField.cursorIndex&&(r.index=this._inputField.cursorIndex),"Input"!==i){var n=r.key.split(":"),a=`on${n[0]}`,o=this[a];r.key=n[1],o&&o.apply&&o.call&&o.call(this,r),this.signal(a,s({input:this._input,keyboard:this},r))}else this.addAt(r.key,r.index)}_changeInput(e){if(!(e.length>this._maxCharacters)){var t={previousInput:this._input,input:this._input=e};this._inputField&&this._inputField.onInputChanged&&this._inputField.onInputChanged(t),this.signal("onInputChanged",t)}}focus(e){this._findKey(e)}add(e){this._changeInput(this._input+e)}addAt(e,t){t>this._input.length-1?this.add(e):t>-1&&this._changeInput(this._input.substring(0,t)+e+this._input.substring(t,this._input.length))}remove(){this._changeInput(this._input.substring(0,this._input.length-1))}removeAt(e){e>this._input.length-1?this.remove():e>-1&&this._changeInput(this._input.substring(0,e-1)+this._input.substring(e,this._input.length))}clear(){this._changeInput("")}layout(e){e!==this._layout&&(this._layout=e,this.attached&&(this.resetFocus(),this._update()))}inputField(e){e&&e.isComponent?(this._rowIndex=0,this._columnIndex=0,this._input=void 0!==e.input?e.input:"",this._inputField=e):(this._rowIndex=0,this._columnIndex=0,this._input="",this._inputField=void 0)}navigate(e,t){var i=("row"===e?this._columnIndex:this._rowIndex)+t,r=this.rows[this._rowIndex];if("row"===e&&i>-1&&i<r.children.length)return this._previous=null,this._columnIndex=i;if("row"===e&&this.navigationWrapAround){this._previous=null;var n=r.children.length;return this._columnIndex=(i%n+n)%n}if("column"===e&&i>-1&&i<this.rows.length){var s=this._rowIndex,a=this._columnIndex;if(this._previous&&this._previous.row===i){var o=this._previous.column;this._previous.column=this._columnIndex,this._columnIndex=o,this._rowIndex=this._previous.row}else{for(var h=this.rows[i],u=this.currentKeyWrapper,l=this.rows[this._rowIndex],c=l.x-l.w*l.mountX+u.x,d=h.children.map((e=>{var t=h.x-h.w*h.mountX+e.x;return t<=c&&c<t+e.w?t+e.w-c:t>=c&&t<=c+u.w?c+u.w-t:-1})),p=-1,g=-1,f=0;f<d.length&&!(-1===d[f]&&p>-1);f++)d[f]>p&&(p=d[f],g=f);if(g>-1)this._rowIndex=i,this._columnIndex=g;else if(this.navigationWrapAround)return this._columnIndex=Math.min(this.rows[0].children.length-1,this._columnIndex),this._rowIndex=0}if(this._rowIndex!==s)return this._previous={column:a,row:s},this._rowIndex=i}else if("column"===e&&this.navigationWrapAround){this._previous={column:this._columnIndex,row:this._rowIndex};var m=this.rows.length;this._rowIndex=(i%m+m)%m,this._columnIndex=Math.min(this.rows[this._rowIndex].children.length-1,this._columnIndex)}return!1}onSpace(e){var t=e.index;this.addAt(" ",t)}onBackspace(e){var t=e.index;this.removeAt(t)}onClear(){this.clear()}onLayout(e){var t=e.key;this.layout(t)}set config(e){this._config=e,this.active&&this._update()}get config(){return this._config}set currentInputField(e){this.inputField(e)}get currentInputField(){return this._inputField}set currentLayout(e){this.layout(e)}get currentLayout(){return this._layout}set maxCharacters(e){this._maxCharacters=e}get maxCharacters(){return this._maxCharacters}get rows(){return this._keys&&this._keys.children}get currentKeyWrapper(){return this.rows&&this.rows[this._rowIndex].children[this._columnIndex]}get currentKey(){return this.currentKeyWrapper&&this.currentKeyWrapper.key}}class Ro extends mt.Component{static _template(){return{LabelClipper:{w:e=>e,rtt:!0,shader:{type:mt.shaders.FadeOut},LabelWrapper:{Label:{renderOffscreen:!0},LabelCopy:{renderOffscreen:!0}}}}}_construct(){this._autoStart=!0,this._scrollAnimation=!1,this._fade=30,this._spacing=30,this._label={},this._align="left",this._animationSettings={delay:.7,repeat:-1,stopMethod:"immediate"}}_init(){var e=this.tag("Label");e.on("txLoaded",(()=>{this._update(e),this._updateAnimation(e),this._autoStart&&this.start()}))}_update(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.tag("Label"),t=e.renderWidth,i=t<=this.renderWidth,r=0;i&&"left"!==this._align&&(r=(this.renderWidth-t)*Ro.ALIGN[this._align]),this.tag("LabelClipper").patch({h:e.renderHeight,shader:{right:i?0:this._fade},LabelWrapper:{x:0,Label:{x:r},LabelCopy:{x:t+this._spacing}}})}_updateAnimation(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.tag("Label");this._scrollAnimation&&this._scrollAnimation.stopNow(),e.renderWidth>this.renderWidth&&(this._animationSettings.duration||(this._animationSettings.duration=e.renderWidth/50),this._scrollAnimation=this.animation(s(s({},this._animationSettings),{},{actions:[{t:"LabelWrapper",p:"x",v:{sm:0,0:0,1:-(e.renderWidth+this._spacing)}},{t:"LabelClipper",p:"shader.left",v:{0:0,.2:this._fade,.8:this._fade,1:0}}]})))}start(){this._scrollAnimation&&(this._scrollAnimation.stopNow(),this.tag("LabelCopy").patch({text:this._label}),this._scrollAnimation.start())}stop(){this._scrollAnimation&&(this._scrollAnimation.stopNow(),this.tag("LabelCopy").text="")}set label(e){"string"==typeof e&&(e={text:e}),this._label=s(s({},this._label),e),this.tag("Label").patch({text:e})}get label(){return this.tag("Label")}set align(e){this._align=e}get align(){return this._align}set autoStart(e){this._autoStart=e}get autoStart(){return this._autoStart}set repeat(e){this.animationSettings={repeat:e}}get repeat(){return this._animationSettings.repeat}set delay(e){this.animationSettings={delay:e}}get delay(){return this._animationSettings.delay}set duration(e){this.animationSettings={duration:e}}get duration(){return this._animationSettings.duration}set animationSettings(e){this._animationSettings=s(s({},this._animationSettings),e),this._scrollAnimation&&this._updateAnimation()}get animationSettings(){return this._animationSettings}}Ro.ALIGN={left:0,center:.5,right:1};class Lo extends mt.Component{static _template(){return{h:80,w:574,Focus:{alpha:0,w:e=>e,h:e=>e,rect:!0},Label:{x:30,y:e=>.5*e,mountY:.5,text:{text:"",fontSize:22}},ValueWrapper:{x:e=>e-30,w:200,h:e=>e,mountX:1,Value:{x:e=>.5*e,y:e=>.5*e,mountX:.5,mountY:.5,text:{text:"",fontSize:22}}}}}_construct(){this._focusColor=4278227525,this._labelColor=4288519581,this._labelColorFocused=4294967295,this._padding=30,this._max=100,this._min=0,this._value=50,this._options=void 0,this._label="label",this._focusAnimation=null,defineProperties(this,["focusColor","labelColor","labelColorFocused","padding","max","min","focusAnimation"])}_update(){this.patch({Focus:{color:this._focusColor},Label:{x:this._padding,color:this._labelColor,text:{text:this._label}},ValueWrapper:{x:e=>e-this._padding,Value:{color:this._labelColor,text:{text:this.optionValue||this.value}}}}),this.hasFocus()&&this._focus()}_createFocusAnimation(){this._focusAnimation=this.animation({duration:.2,stopMethod:"reverse",actions:[{t:"Focus",p:"alpha",v:{0:0,1:1}},{t:"Label",p:"color",v:{0:this._labelColor,1:this._labelColorFocused}},{t:"ValueWrapper.Value",p:"color",v:{0:this._labelColor,1:this._labelColorFocused}}]})}_firstActive(){this._focusAnimation||this._createFocusAnimation(),this._update()}_navigate(e){this.value=((e,t,i,r)=>{var n=t+e;return n<i&&r,n>r&&i,n})(e,this._value,this._min,this._max);var t={value:this._value};this._options&&(t.options=this._options),this.fireAncestors("$onValueChanged",t),this.signal("onValueChanged",t)}_handleLeft(){this._navigate(-1)}_handleRight(){this._navigate(1)}_focus(){this._focusAnimation&&this._focusAnimation.start()}_unfocus(){this._focusAnimation&&this._focusAnimation.stop()}set label(e){this._label=e,this.active&&(this.tag("Label").text.text=e)}get label(){return this._label}set value(e){this._value=e,this.active&&(this.tag("Value").text.text=this.optionValue||this._value)}get value(){return this._value}get optionValue(){return this._options&&this._options[this._value]&&this._options[this._value].label||void 0}set options(e){var t=e.map((e=>"string"==typeof e?{label:e}:e));this._value=0,this._options=t,this._max=t.length-1,this._update()}get options(){return this._options}}class ko extends mt.Component{static _template(){return{w:574,h:240,List:{type:List,w:e=>e,h:e=>e,forceLoad:!0,spacing:0,direction:"column"}}}_construct(){this._autoColorShift=!0,this._focusColor=4278227525,this._labelColor=4288519581,this._labelColorFocused=4294967295,this._options=[{type:"neutral",label:"normal"},{type:"protanopia",label:"Protanopia"},{type:"deuteranopia",label:"Deuteranopia"},{type:"tritanopia",label:"Tritanopia"},{type:"monochromacy",label:"Achromatopsia"}],defineProperties(this,["focusColor","labelColor","labelColorFocused","options","autoColorShift"])}_getFocused(){return this.tag("List")}_shiftColors(){this._autoColorShift&&this.application&&this.application.colorshift&&this.application.colorshift(this._settings.correction,this._settings)}$onValueChanged(){var e=this.tag("List").items,t=e[0];(this._settings={correction:t.options[t.value].type,brightness:e[1].value,contrast:e[2].value,gamma:e[3].value},this._currentCorrection&&this._settings.correction!==this._currentCorrection)&&e.slice(1).forEach((e=>{e.value=50}));this._currentCorrection=this._settings.correction,this._shiftColors(),this.signal("onColorShift",this._settings)}_update(){var e=this.tag("List"),t=this._options,i=this._settings,r={focusColor:this._focusColor,labelColor:this._labelColor,labelColorFocused:this._labelColorFocused};this._shiftColors();var n=["Brightness","Contrast","Gamma"].map((e=>{var t=e.toLocaleLowerCase();return s({type:this[`${t}Component`],label:e,value:i[t],w:this.finalW,h:80},r)}));n.unshift(s({type:this.correctionComponent,options:t,value:findIndexOfObject(t,i.correction,"type"),label:"Color adjustment",w:this.finalW,h:80},r)),e.clear(),e.add(n)}_firstActive(){this._settings||(this._settings={correction:"neutral",brightness:50,contrast:50,gamma:50}),this._update()}set settings(e){if(this._settings=e,this.active){var t=this.tag("List").items;t[0]=findIndexOfObject(this._options,e.correction,"type"),t[1]=e.brightness||50,t[2]=e.contrast||50,t[3]=e.gamma||50}}get settings(){return this._settings}get correctionTag(){return this.tag("List").items[0]}get brightnessTag(){return this.tag("List").items[1]}get contrastTag(){return this.tag("List").items[2]}get gammaTag(){return this.tag("List").items[3]}get adjustmentTags(){return this.tag("List").items}set stepperComponent(e){this._stepperComponent=e}get stepperComponent(){return this._stepperComponent||ArrowStepper}set correctionComponent(e){this._correctionComponent=e}get correctionComponent(){return this._correctionComponent||this.stepperComponent}set brightnessComponent(e){this._brightnessComponent=e}get brightnessComponent(){return this._brightnessComponent||this.stepperComponent}set contrastComponent(e){this._contrastComponent=e}get contrastComponent(){return this._contrastComponent||this.stepperComponent}set gammaComponent(e){this._gammaComponent=e}get gammaComponent(){return this._gammaComponent||this.stepperComponent}}class Mo extends mt.Component{static _template(){return{Focus:{alpha:0,x:e=>.5*e,y:e=>.5*e,mount:.5,w:120,h:50,rect:!0,shader:{type:mt.shaders.RoundedRectangle,radius:25}},Label:{x:e=>.5*e,y:e=>.5*e,mount:.5,renderOffscreen:!0,text:{text:"",fontSize:22}}}}_construct(){this._focusColor=4278227525,this._labelColor=4288519581,this._labelColorFocused=4294967295,this._padding=40,defineProperties(this,["focusColor","labelColor","labelColorFocused","padding"])}set label(e){this.tag("Label").text.text=e,this._label=e}get label(){return this._label}_init(){var e=this.tag("Label");e.on("txLoaded",(()=>{this.patch({w:e.renderWidth,Focus:{w:e.renderWidth+2*this._padding}}),this.collectionWrapper&&this.collectionWrapper.reposition()}))}_focus(){this.patch({Focus:{smooth:{alpha:1}},Label:{smooth:{color:this._labelColorFocused}}})}_unfocus(e){!0===e.isCarouselItem&&this.patch({Focus:{smooth:{alpha:0}},Label:{smooth:{color:this._labelColor}}})}_firstActive(){this.patch({Focus:{color:this._focusColor},Label:{color:this._labelColor}}),this.cparent.componentIndex===this.collectionWrapper.currentItemWrapper.componentIndex&&this._focus()}get isCarouselItem(){return!0}static get width(){return 120}static get height(){return 50}}class Po extends mt.Component{static _template(){return{w:300,h:10,Background:{w:e=>e,h:e=>e,rect:!0,rtt:!0,shader:{type:mt.shaders.RoundedRectangle,radius:5},Progress:{h:e=>e,w:10,rect:!0,shader:{type:mt.shaders.RoundedRectangle,radius:0}}}}}_construct(){this._progressColor=4278227525,this._progressColorFocused=void 0,this._backgroundColor=4288519581,this._backgroundColorFocused=void 0,this._backgroundRadius=5,this._progressRadius=0,this.value=.5,defineProperties(this,["progressColor","backgroundColor","progressColorFocused","backgroundColorFocused"])}progress(e){e>1&&100,this._value=e,this.tag("Progress").w=this.w*e}_createFocusAnimation(){this._focusAnimation=this.animation({duration:.2,stopMethod:"reverse",actions:[{t:"Background",p:"color",v:{0:this._backgroundColor,1:this._backgroundColorFocused||this._backgroundColor}},{t:"Background.Progress",p:"color",v:{0:this._progressColor,1:this._progressColorFocused||this._progressColor}}]})}_firstActive(){this._focusAnimation||this._createFocusAnimation(),this.patch({Background:{color:this._backgroundColor,shader:{radius:this._backgroundRadius},Progress:{color:this._progressColor,shader:{radius:this._progressRadius}}}}),this.progress(this._value),this.hasFocus()&&this._focus()}_focus(){this._focusAnimation&&this._focusAnimation.start()}_unfocus(){this._focusAnimation&&this._focusAnimation.stop()}set value(e){this._value=e,this.active&&this.progress(e)}get value(){return this._value}set backgroundRadius(e){this._backgroundRadius=e,this.active&&(this.tag("Background").shader.radius=e)}get progressRadius(){return this._progressRadius}set progressRadius(e){this._progressRadius=e,this.active&&(this.tag("Progress").shader.radius=e)}get progressRadius(){return this._progressRadius}get backgroundTag(){return this.tag("Background")}get progressTag(){return this.tag("Progress")}}class Oo extends mt.Component{constructor(){super(...arguments),this.index=2,this.intervalSub=0}static _template(){return{w:1920,h:1080,color:xs.primaryLight,rect:!0,shader:{x:100,y:-100,pivot:.5,type:mt.shaders.RadialGradient,outerColor:xs.primaryLight,innerColor:xs.dark,radius:800},SearchComponent:{x:40,y:40,shader:null,SearchBox:{x:0,y:60,w:950,h:60,rect:!0,color:xs.accentGrey.light,shader:{type:mt.shaders.RoundedRectangle,radius:30},InputWrapper:{x:20,color:xs.dark,InputField:{y:20,type:Co}}},BackButton:{type:co},Keyboard:{x:0,y:140,type:Io,config:No,currentLayout:"abc",maxCharacters:24,signals:{onSearch:!0}}}}}_setup(){var e=this.tag("SearchComponent.SearchBox.InputWrapper.InputField");this.tag("Keyboard").inputField(e)}onSearch(e){console.log("search",e.input)}_active(){super._active(),this.tag("SearchComponent.SearchBox.InputWrapper.InputField").color=xs.accentGrey.dark;var e={type:oo,x:-30,y:380,railIndex:16};this.tag("SearchComponent").patch({LongRail:e})}_getFocused(){return this.tag("Keyboard")}_handleUp(){this.index>1&&(this.index-=1)}_handleDown(){this.index<3&&(this.index+=1)}_handleEnter(){1===this.index&&vs.navigate("home")}_getFocused(){return this.tag("SearchComponent").children[this.index]}}class Do extends Eo{_active(){this.label={mountY:.45},this.labelColors={unfocused:or("black").get(),focused:or("white").get()},this.backgroundColors={unfocused:or("white").get(),focused:xs.accentGrey.light},this.hasFocus()&&this._focus()}static get height(){return 60}static get width(){return 160}}var No={layouts:{abc:[["a","b","c","d","e","f","g","h","i","j"],["k","l","m","n","o","p","q","r","s","t"],["u","v","w","x","y","z","_","-","@","."],["Layout:ABC","Layout:123","Space","Search","Del"]],ABC:[["A","B","C","D","E","F","G","H","I","J"],["K","L","M","N","O","P","Q","R","S","T"],["U","V","W","X","Y","Z","_","-","@","."],["Layout:abc","Layout:123","Space","Search","Del"]],123:[["1","2","3","4","5","6","7","8","9","0"],["Layout:abc","Space","Clear","Del"]]},styling:{align:"center",horizontalSpacing:5,verticalSpacing:20},buttonTypes:{default:{type:class extends Eo{_firstActive(){this.label={mountY:.45},this.labelColors={unfocused:or("white").get(),focused:xs.dark},this.backgroundColors={unfocused:or("white").alpha(0).get(),focused:xs.white},this.hasFocus()&&this._focus()}static get width(){return 90}static get height(){return 40}}},Del:{type:Do,icon:"del"},Layout:{type:Do},Space:{type:Do,w:280,label:"space"},Clear:{type:Do,label:"clear"},Search:{type:Do,label:"search"}}};class Fo extends mt.Component{constructor(){super(...arguments),this.contentId="",this.index=1,this.from=""}static _template(){return{ContentView:{w:1920,h:1080,color:xs.black,rect:!0,shader:{x:100,y:-100,pivot:.5,type:mt.shaders.RadialGradient,outerColor:xs.primaryLight,innerColor:xs.dark,radius:800},Thumbnail:{x:1e3,y:110,scale:1.5,shader:{type:mt.shaders.FadeOut,innerColor:xs.black,left:200,bottom:200}},ContentData:{shader:null,zIndex:2,Title:{x:40,y:165,shader:null,text:{fontSize:80},color:xs.white},Description:{x:40,y:270,w:900,shader:null,text:{wordWrap:!0,maxLines:3,maxLinesSuffix:"...",fontSize:30},color:xs.accentGrey.light},Genre:{x:40,y:380,w:900,shader:null,text:{fontSize:24},color:xs.accentGrey.light},Info:{visible:!1,Director:{x:40,y:440,w:100,shader:null,text:{text:"Director : ",fontSize:24},color:xs.accentGrey.light},Starring:{x:40,y:470,w:100,shader:null,text:{text:"Staring  : ",fontSize:24},color:xs.accentGrey.light},DirectorList:{x:150,y:440,w:800,shader:null,text:{fontSize:24},color:xs.accentGrey.light},StarringList:{x:150,y:470,w:800,shader:null,text:{fontSize:24,wordWrap:!0,maxLines:1,maxLinesSuffix:"..."},color:xs.accentGrey.light}},VideoSpec:{visible:!1,VideoSpec1:{x:70,y:140,shader:null,type:po,specData:"  16+  "},VideoSpec2:{x:135,y:140,shader:null,type:po,specData:"  4k  "},VideoSpec3:{x:193,y:140,shader:null,type:po,specData:"  cc  "}}},ContentActions:{shader:null,BackButton:{x:40,y:40,type:co},PlayButton:{x:40,y:570,type:fo,label:"Play Video"},PlayTrailer:{x:40,y:700,type:fo,label:"Play Trailer"}}}}}_inactive(){console.log("Inactive"),this.index=1}set params(e){var t,i=e.id,r=e.from,n=e.data;this.from=r;var s=null===(t=n.images.find((e=>828===e.width)))||void 0===t?void 0:t.url;this.contentId=i,console.log(e),this.patch({ContentView:{shader:{type:mt.shaders.RadialGradient,x:300,y:300,innerColor:4278190080,radius:1500},Thumbnail:{src:s},ContentData:{x:10,Title:{text:{text:n.title}},Description:{text:{text:n.description}},Genre:{text:{text:n.genre.join(" . ")}},Info:{visible:!0,DirectorList:{text:{text:n.director.map((e=>e.personName)).join(", ")}},StarringList:{text:{text:n.actor.map((e=>e.personName)).join(", ")}}},VideoSpec:{visible:!0}}}}),this._refocus()}_init(){}animateElements(){var e=this.tag("ContentView.ContentData").animation({duration:1,delay:0,actions:[{p:"alpha",v:{0:0,1:1}},{p:"y",v:{0:-60,1:0}}]});this.tag("ContentView.ContentActions").animation({duration:1,delay:0,actions:[{p:"alpha",v:{0:0,1:1}},{p:"x",v:{0:-100,1:10}}]}).start(),e.start()}_handleUp(){this.index>0&&(this.index-=1)}_handleDown(){this.index<2&&(this.index+=1)}_handleEnter(){console.log(this.from),0===this.index?"gridItem"==this.from||"Grid"==this.from?vs.navigate("grid"):vs.navigate("home"):(console.log(this.contentId),vs.navigate(`player/${this.contentId}`))}_getFocused(){return this.tag("ContentView.ContentActions").children[this.index]}pageTransition(e,t){return t?new Promise(((i,r)=>{t.pageTransitionOut(t).then((()=>{e.visible=!0,e.animateElements(),i()}))})):Promise.resolve()}}var Uo={};
/*
             @license
             Shaka Player
             Copyright 2016 Google LLC
             SPDX-License-Identifier: Apache-2.0
            */!function(e){!function(){var t="undefined"!=typeof window?window:bi,i={};for(var r in function(e,t,i){
/*
            	 @license
            	 Shaka Player
            	 Copyright 2016 Google LLC
            	 SPDX-License-Identifier: Apache-2.0
            	*/
var n;function s(e){var t=0;return function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}}var a="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,i){return e==Array.prototype||e==Object.prototype||(e[t]=i.value),e};var o=function(i){i=["object"==typeof globalThis&&globalThis,i,"object"==typeof e&&e,"object"==typeof self&&self,"object"==typeof t&&t];for(var r=0;r<i.length;++r){var n=i[r];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);function h(e,t){if(t)e:{var i=o;e=e.split(".");for(var r=0;r<e.length-1;r++){var n=e[r];if(!(n in i))break e;i=i[n]}(t=t(r=i[e=e[e.length-1]]))!=r&&null!=t&&a(i,e,{configurable:!0,writable:!0,value:t})}}function u(e){return(e={next:e})[Symbol.iterator]=function(){return this},e}function l(e){var t="undefined"!=typeof Symbol&&Symbol.iterator&&e[Symbol.iterator];return t?t.call(e):{next:s(e)}}function c(e){if(!(e instanceof Array)){e=l(e);for(var t,i=[];!(t=e.next()).done;)i.push(t.value);e=i}return e}h("Symbol",(function(e){function t(e,t){this.g=e,a(this,"description",{configurable:!0,writable:!0,value:t})}if(e)return e;t.prototype.toString=function(){return this.g};var i="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",r=0;return function e(n){if(this instanceof e)throw new TypeError("Symbol is not a constructor");return new t(i+(n||"")+"_"+r++,n)}})),h("Symbol.iterator",(function(e){if(e)return e;e=Symbol("Symbol.iterator");for(var t="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),i=0;i<t.length;i++){var r=o[t[i]];"function"==typeof r&&"function"!=typeof r.prototype[e]&&a(r.prototype,e,{configurable:!0,writable:!0,value:function(){return u(s(this))}})}return e}));var d,p="function"==typeof Object.create?Object.create:function(e){function t(){}return t.prototype=e,new t};if("function"==typeof Object.setPrototypeOf)d=Object.setPrototypeOf;else{var g;e:{var f={};try{f.__proto__={a:!0},g=f.a;break e}catch(W_){}g=!1}d=g?function(e,t){if(e.__proto__=t,e.__proto__!==t)throw new TypeError(e+" is not extensible");return e}:null}var m=d;function _(e,t){if(e.prototype=p(t.prototype),e.prototype.constructor=e,m)m(e,t);else for(var i in t)if("prototype"!=i)if(Object.defineProperties){var r=Object.getOwnPropertyDescriptor(t,i);r&&Object.defineProperty(e,i,r)}else e[i]=t[i];e.xh=t.prototype}function v(){this.o=!1,this.l=null,this.h=void 0,this.g=1,this.j=this.m=0,this.u=this.i=null}function y(e){if(e.o)throw new TypeError("Generator is already running");e.o=!0}function x(e,t){e.i={Ee:t,Le:!0},e.g=e.m||e.j}function b(e,t,i){return e.g=i,{value:t}}function w(e){e.g=0}function T(e,t,i){e.m=t,null!=i&&(e.j=i)}function S(e){e.m=0,e.j=2}function A(e,t){e.g=t,e.m=0}function C(e){e.m=0;var t=e.i.Ee;return e.i=null,t}function E(e){e.u=[e.i],e.m=0,e.j=0}function I(e,t){var i=e.u.splice(0)[0];(i=e.i=e.i||i)?i.Le?e.g=e.m||e.j:null!=i.A&&e.j<i.A?(e.g=i.A,e.i=null):e.g=e.j:e.g=t}function R(e){this.g=new v,this.h=e}function L(e,t,i,r){try{var n=t.call(e.g.l,i);if(!(n instanceof Object))throw new TypeError("Iterator result "+n+" is not an object");if(!n.done)return e.g.o=!1,n;var s=n.value}catch(a){return e.g.l=null,x(e.g,a),k(e)}return e.g.l=null,r.call(e.g,s),k(e)}function k(e){for(;e.g.g;)try{var t=e.h(e.g);if(t)return e.g.o=!1,{value:t.value,done:!1}}catch(i){e.g.h=void 0,x(e.g,i)}if(e.g.o=!1,e.g.i){if(t=e.g.i,e.g.i=null,t.Le)throw t.Ee;return{value:t.return,done:!0}}return{value:void 0,done:!0}}function M(e){this.next=function(t){return y(e.g),e.g.l?t=L(e,e.g.l.next,t,e.g.s):(e.g.s(t),t=k(e)),t},this.throw=function(t){return y(e.g),e.g.l?t=L(e,e.g.l.throw,t,e.g.s):(x(e.g,t),t=k(e)),t},this.return=function(t){return function(e,t){y(e.g);var i=e.g.l;return i?L(e,"return"in i?i.return:function(e){return{value:e,done:!0}},t,e.g.return):(e.g.return(t),k(e))}(e,t)},this[Symbol.iterator]=function(){return this}}function P(e){return function(e){function t(t){return e.next(t)}function i(t){return e.throw(t)}return new Promise((function(r,n){!function e(s){s.done?r(s.value):Promise.resolve(s.value).then(t,i).then(e,n)}(e.next())}))}(new M(new R(e)))}function O(){for(var e=Number(this),t=[],i=e;i<arguments.length;i++)t[i-e]=arguments[i];return t}function D(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function N(e,t,i){e instanceof String&&(e=String(e));for(var r=e.length,n=0;n<r;n++){var s=e[n];if(t.call(i,s,n,e))return{Je:n,v:s}}return{Je:-1,v:void 0}}function F(e,t,i){if(null==e)throw new TypeError("The 'this' value for String.prototype."+i+" must not be null or undefined");if(t instanceof RegExp)throw new TypeError("First argument to String.prototype."+i+" must not be a regular expression");return e+""}function U(e,t){e instanceof String&&(e+="");var i=0,r=!1,n={next:function(){if(!r&&i<e.length){var n=i++;return{value:t(n,e[n]),done:!1}}return r=!0,{done:!0,value:void 0}}};return n[Symbol.iterator]=function(){return n},n}v.prototype.s=function(e){this.h=e},v.prototype.return=function(e){this.i={return:e},this.g=this.j},v.prototype.A=function(e){this.g=e},h("Promise",(function(e){function t(e){this.h=0,this.i=void 0,this.g=[],this.o=!1;var t=this.j();try{e(t.resolve,t.reject)}catch(r){t.reject(r)}}function i(){this.g=null}function n(e){return e instanceof t?e:new t((function(t){t(e)}))}if(e)return e;i.prototype.h=function(e){if(null==this.g){this.g=[];var t=this;this.i((function(){t.l()}))}this.g.push(e)};var s=o.setTimeout;i.prototype.i=function(e){s(e,0)},i.prototype.l=function(){for(;this.g&&this.g.length;){var e=this.g;this.g=[];for(var t=0;t<e.length;++t){var i=e[t];e[t]=null;try{i()}catch(r){this.j(r)}}}this.g=null},i.prototype.j=function(e){this.i((function(){throw e}))},t.prototype.j=function(){function e(e){return function(r){i||(i=!0,e.call(t,r))}}var t=this,i=!1;return{resolve:e(this.F),reject:e(this.l)}},t.prototype.F=function(e){if(e===this)this.l(new TypeError("A Promise cannot resolve to itself"));else if(e instanceof t)this.H(e);else{e:switch(typeof e){case"object":var i=null!=e;break e;case"function":i=!0;break e;default:i=!1}i?this.D(e):this.m(e)}},t.prototype.D=function(e){var t=void 0;try{t=e.then}catch(r){return void this.l(r)}"function"==typeof t?this.J(t,e):this.m(e)},t.prototype.l=function(e){this.s(2,e)},t.prototype.m=function(e){this.s(1,e)},t.prototype.s=function(e,t){if(0!=this.h)throw Error("Cannot settle("+e+", "+t+"): Promise already settled in state"+this.h);this.h=e,this.i=t,2===this.h&&this.G(),this.u()},t.prototype.G=function(){var e=this;s((function(){if(e.B()){var t=o.console;void 0!==t&&t.error(e.i)}}),1)},t.prototype.B=function(){if(this.o)return!1;var e=o.CustomEvent,t=o.Event,i=o.dispatchEvent;return void 0===i||("function"==typeof e?e=new e("unhandledrejection",{cancelable:!0}):"function"==typeof t?e=new t("unhandledrejection",{cancelable:!0}):(e=o.document.createEvent("CustomEvent")).initCustomEvent("unhandledrejection",!1,!0,e),e.promise=this,e.reason=this.i,i(e))},t.prototype.u=function(){if(null!=this.g){for(var e=0;e<this.g.length;++e)a.h(this.g[e]);this.g=null}};var a=new i;return t.prototype.H=function(e){var t=this.j();e.Lc(t.resolve,t.reject)},t.prototype.J=function(e,t){var i=this.j();try{e.call(t,i.resolve,i.reject)}catch(r){i.reject(r)}},t.prototype.then=function(e,i){function r(e,t){return"function"==typeof e?function(t){try{n(e(t))}catch(i){s(i)}}:t}var n,s,a=new t((function(e,t){n=e,s=t}));return this.Lc(r(e,n),r(i,s)),a},t.prototype.catch=function(e){return this.then(void 0,e)},t.prototype.Lc=function(e,t){function i(){switch(r.h){case 1:e(r.i);break;case 2:t(r.i);break;default:throw Error("Unexpected state: "+r.h)}}var r=this;null==this.g?a.h(i):this.g.push(i),this.o=!0},t.resolve=n,t.reject=function(e){return new t((function(t,i){i(e)}))},t.race=function(e){return new t((function(t,i){for(var r=l(e),s=r.next();!s.done;s=r.next())n(s.value).Lc(t,i)}))},t.all=function(e){var i=l(e),r=i.next();return r.done?n([]):new t((function(e,t){function s(t){return function(i){a[t]=i,0==--o&&e(a)}}var a=[],o=0;do{a.push(void 0),o++,n(r.value).Lc(s(a.length-1),t),r=i.next()}while(!r.done)}))},t})),h("WeakMap",(function(e){function t(e){if(this.g=(h+=Math.random()+1).toString(),e){e=l(e);for(var t;!(t=e.next()).done;)t=t.value,this.set(t[0],t[1])}}function i(){}function r(e){var t=typeof e;return"object"===t&&null!==e||"function"===t}function n(e){if(!D(e,o)){var t=new i;a(e,o,{value:t})}}function s(e){var t=Object[e];t&&(Object[e]=function(e){return e instanceof i?e:(Object.isExtensible(e)&&n(e),t(e))})}if(function(){if(!e||!Object.seal)return!1;try{var t=Object.seal({}),i=Object.seal({}),r=new e([[t,2],[i,3]]);return 2==r.get(t)&&3==r.get(i)&&(r.delete(t),r.set(i,4),!r.has(t)&&4==r.get(i))}catch(n){return!1}}())return e;var o="$jscomp_hidden_"+Math.random();s("freeze"),s("preventExtensions"),s("seal");var h=0;return t.prototype.set=function(e,t){if(!r(e))throw Error("Invalid WeakMap key");if(n(e),!D(e,o))throw Error("WeakMap key fail: "+e);return e[o][this.g]=t,this},t.prototype.get=function(e){return r(e)&&D(e,o)?e[o][this.g]:void 0},t.prototype.has=function(e){return r(e)&&D(e,o)&&D(e[o],this.g)},t.prototype.delete=function(e){return!!(r(e)&&D(e,o)&&D(e[o],this.g))&&delete e[o][this.g]},t})),h("Map",(function(e){function t(){var e={};return e.Qa=e.next=e.head=e}function i(e,t){var i=e.g;return u((function(){if(i){for(;i.head!=e.g;)i=i.Qa;for(;i.next!=i.head;)return i=i.next,{done:!1,value:t(i)};i=null}return{done:!0,value:void 0}}))}function r(e,t){var i=t&&typeof t;"object"==i||"function"==i?s.has(t)?i=s.get(t):(i=""+ ++a,s.set(t,i)):i="p_"+t;var r=e.h[i];if(r&&D(e.h,i))for(e=0;e<r.length;e++){var n=r[e];if(t!=t&&n.key!=n.key||t===n.key)return{id:i,list:r,index:e,ga:n}}return{id:i,list:r,index:-1,ga:void 0}}function n(e){if(this.h={},this.g=t(),this.size=0,e){e=l(e);for(var i;!(i=e.next()).done;)i=i.value,this.set(i[0],i[1])}}if(function(){if(!e||"function"!=typeof e||!e.prototype.entries||"function"!=typeof Object.seal)return!1;try{var t=Object.seal({x:4}),i=new e(l([[t,"s"]]));if("s"!=i.get(t)||1!=i.size||i.get({x:4})||i.set({x:4},"t")!=i||2!=i.size)return!1;var r=i.entries(),n=r.next();return!n.done&&n.value[0]==t&&"s"==n.value[1]&&!((n=r.next()).done||4!=n.value[0].x||"t"!=n.value[1]||!r.next().done)}catch(s){return!1}}())return e;var s=new WeakMap;n.prototype.set=function(e,t){var i=r(this,e=0===e?0:e);return i.list||(i.list=this.h[i.id]=[]),i.ga?i.ga.value=t:(i.ga={next:this.g,Qa:this.g.Qa,head:this.g,key:e,value:t},i.list.push(i.ga),this.g.Qa.next=i.ga,this.g.Qa=i.ga,this.size++),this},n.prototype.delete=function(e){return!(!(e=r(this,e)).ga||!e.list)&&(e.list.splice(e.index,1),e.list.length||delete this.h[e.id],e.ga.Qa.next=e.ga.next,e.ga.next.Qa=e.ga.Qa,e.ga.head=null,this.size--,!0)},n.prototype.clear=function(){this.h={},this.g=this.g.Qa=t(),this.size=0},n.prototype.has=function(e){return!!r(this,e).ga},n.prototype.get=function(e){return(e=r(this,e).ga)&&e.value},n.prototype.entries=function(){return i(this,(function(e){return[e.key,e.value]}))},n.prototype.keys=function(){return i(this,(function(e){return e.key}))},n.prototype.values=function(){return i(this,(function(e){return e.value}))},n.prototype.forEach=function(e,t){for(var i,r=this.entries();!(i=r.next()).done;)i=i.value,e.call(t,i[1],i[0],this)},n.prototype[Symbol.iterator]=n.prototype.entries;var a=0;return n})),h("Set",(function(e){function t(e){if(this.g=new Map,e){e=l(e);for(var t;!(t=e.next()).done;)this.add(t.value)}this.size=this.g.size}return function(){if(!e||"function"!=typeof e||!e.prototype.entries||"function"!=typeof Object.seal)return!1;try{var t=Object.seal({x:4}),i=new e(l([t]));if(!i.has(t)||1!=i.size||i.add(t)!=i||1!=i.size||i.add({x:4})!=i||2!=i.size)return!1;var r=i.entries(),n=r.next();return!n.done&&n.value[0]==t&&n.value[1]==t&&(!(n=r.next()).done&&n.value[0]!=t&&4==n.value[0].x&&n.value[1]==n.value[0]&&r.next().done)}catch(s){return!1}}()?e:(t.prototype.add=function(e){return e=0===e?0:e,this.g.set(e,e),this.size=this.g.size,this},t.prototype.delete=function(e){return e=this.g.delete(e),this.size=this.g.size,e},t.prototype.clear=function(){this.g.clear(),this.size=0},t.prototype.has=function(e){return this.g.has(e)},t.prototype.entries=function(){return this.g.entries()},t.prototype.values=function(){return this.g.values()},t.prototype.keys=t.prototype.values,t.prototype[Symbol.iterator]=t.prototype.values,t.prototype.forEach=function(e,t){var i=this;this.g.forEach((function(r){return e.call(t,r,r,i)}))},t)})),h("Array.prototype.findIndex",(function(e){return e||function(e,t){return N(this,e,t).Je}})),h("Object.is",(function(e){return e||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}})),h("Array.prototype.includes",(function(e){return e||function(e,t){var i=this;i instanceof String&&(i=String(i));var r=i.length;for(0>(t=t||0)&&(t=Math.max(t+r,0));t<r;t++){var n=i[t];if(n===e||Object.is(n,e))return!0}return!1}})),h("String.prototype.includes",(function(e){return e||function(e,t){return-1!==F(this,e,"includes").indexOf(e,t||0)}})),h("Array.prototype.find",(function(e){return e||function(e,t){return N(this,e,t).v}})),h("String.prototype.startsWith",(function(e){return e||function(e,t){var i=F(this,e,"startsWith"),r=i.length,n=e.length;t=Math.max(0,Math.min(0|t,i.length));for(var s=0;s<n&&t<r;)if(i[t++]!=e[s++])return!1;return s>=n}})),h("Array.prototype.keys",(function(e){return e||function(){return U(this,(function(e){return e}))}}));var z="function"==typeof Object.assign?Object.assign:function(e,t){for(var i=1;i<arguments.length;i++){var r=arguments[i];if(r)for(var n in r)D(r,n)&&(e[n]=r[n])}return e};h("Object.assign",(function(e){return e||z})),h("Array.from",(function(e){return e||function(e,t,i){t=null!=t?t:function(e){return e};var r=[],n="undefined"!=typeof Symbol&&Symbol.iterator&&e[Symbol.iterator];if("function"==typeof n){e=n.call(e);for(var s=0;!(n=e.next()).done;)r.push(t.call(i,n.value,s++))}else for(n=e.length,s=0;s<n;s++)r.push(t.call(i,e[s],s));return r}})),h("Array.prototype.values",(function(e){return e||function(){return U(this,(function(e,t){return t}))}})),h("Promise.prototype.finally",(function(e){return e||function(e){return this.then((function(t){return Promise.resolve(e()).then((function(){return t}))}),(function(t){return Promise.resolve(e()).then((function(){throw t}))}))}})),h("Array.prototype.entries",(function(e){return e||function(){return U(this,(function(e,t){return[e,t]}))}})),h("String.prototype.repeat",(function(e){return e||function(e){var t=F(this,null,"repeat");if(0>e||1342177279<e)throw new RangeError("Invalid count value");e|=0;for(var i="";e;)1&e&&(i+=t),(e>>>=1)&&(t+=t);return i}})),h("Number.isNaN",(function(e){return e||function(e){return"number"==typeof e&&isNaN(e)}})),h("Object.values",(function(e){return e||function(e){var t,i=[];for(t in e)D(e,t)&&i.push(e[t]);return i}})),h("Math.log2",(function(e){return e||function(e){return Math.log(e)/Math.LN2}})),h("Math.trunc",(function(e){return e||function(e){if(e=Number(e),isNaN(e)||1/0===e||-1/0===e||0===e)return e;var t=Math.floor(Math.abs(e));return 0>e?-t:t}})),h("Object.entries",(function(e){return e||function(e){var t,i=[];for(t in e)D(e,t)&&i.push([t,e[t]]);return i}}));var B=this||self;function j(e,t){e=e.split(".");var i,r=B;e[0]in r||void 0===r.execScript||r.execScript("var "+e[0]);for(;e.length&&(i=e.shift());)e.length||void 0===t?r=r[i]&&r[i]!==Object.prototype[i]?r[i]:r[i]={}:r[i]=t}function H(e){this.g=Math.exp(Math.log(.5)/e),this.i=this.h=0}function V(e){return e.h/(1-Math.pow(e.g,e.i))}function W(){this.h=new H(2),this.j=new H(5),this.g=0,this.i=128e3,this.l=16e3}function G(){}function X(){}function q(){}function Y(e){var t=O.apply(1,arguments);K.has(e)||(K.add(e),q.apply(G,c(t)))}function $(){}H.prototype.sample=function(e,t){var i=Math.pow(this.g,e);t=t*(1-i)+i*this.h,isNaN(t)||(this.h=t,this.i+=e)},W.prototype.configure=function(e){this.i=e.minTotalBytes,this.l=e.minBytes,this.h.g=Math.exp(Math.log(.5)/e.fastHalfLife),this.j.g=Math.exp(Math.log(.5)/e.slowHalfLife)},W.prototype.sample=function(e,t){if(!(t<this.l)){var i=8e3*t/e;e/=1e3,this.g+=t,this.h.sample(e,i),this.j.sample(e,i)}},W.prototype.getBandwidthEstimate=function(e){return this.g<this.i?e:Math.min(V(this.h),V(this.j))};var K=new Set;if(e.console&&e.console.log.bind){var Z={},Q=(Z[1]=console.error.bind(console),Z[2]=console.warn.bind(console),Z[3]=console.info.bind(console),Z[4]=console.log.bind(console),Z[5]=console.debug.bind(console),Z[6]=console.debug.bind(console),Z);q=Q[2],X=Q[1]}function J(e){if(ee.has(e))return ee.get(e);var t=MediaSource.isTypeSupported(e);return ee.set(e,t),t}var ee=new Map;function te(e,t){return!("number"!=typeof e||"number"!=typeof t||!isNaN(e)||!isNaN(t))||e===t}function ie(e,t){-1<(t=e.indexOf(t))&&e.splice(t,1)}function re(e,t,i){if(i||(i=te),e.length!=t.length)return!1;t=t.slice();for(var r={},n=(e=l(e)).next();!n.done;r={md:r.md},n=e.next()){if(r.md=n.value,-1==(n=t.findIndex(function(e){return function(t){return i(e.md,t)}}(r))))return!1;t[n]=t[t.length-1],t.pop()}return 0==t.length}function ne(e,t,i){if(i||(i=te),e.length!=t.length)return!1;for(var r=0;r<e.length;r++)if(!i(e[r],t[r]))return!1;return!0}function se(e,t,i){this.startTime=e,this.direction=de,this.endTime=t,this.payload=i,this.region=new we,this.position=null,this.positionAlign=oe,this.size=0,this.textAlign=he,this.writingMode=pe,this.lineInterpretation=ge,this.line=null,this.lineHeight="",this.lineAlign=fe,this.displayAlign=le,this.fontSize=this.textStrokeWidth=this.textStrokeColor=this.textShadow=this.border=this.backgroundImage=this.backgroundColor=this.color="",this.fontWeight=ye,this.fontStyle=xe,this.linePadding=this.letterSpacing=this.fontFamily="",this.opacity=1,this.textDecoration=[],this.wrapLine=!0,this.id="",this.nestedCues=[],this.lineBreak=this.isContainer=!1,this.cellResolution={columns:32,rows:15}}function ae(e,t){if(e.startTime!=t.startTime||e.endTime!=t.endTime||e.payload!=t.payload)return!1;for(var i in e)if("startTime"!=i&&"endTime"!=i&&"payload"!=i)if("nestedCues"==i){if(!ne(e.nestedCues,t.nestedCues,ae))return!1}else if("region"==i||"cellResolution"==i){for(var r in e[i])if(e[i][r]!=t[i][r])return!1}else if(Array.isArray(e[i])){if(!ne(e[i],t[i]))return!1}else if(e[i]!=t[i])return!1;return!0}se.prototype.clone=function(){var e,t=new se(0,0,"");for(e in this)t[e]=this[e],t[e]&&t[e].constructor==Array&&(t[e]=t[e].slice());return t},j("shaka.text.Cue",se);var oe="auto";se.positionAlign={LEFT:"line-left",RIGHT:"line-right",CENTER:"center",AUTO:oe};var he="center",ue={LEFT:"left",RIGHT:"right",CENTER:he,START:"start",END:"end"};se.textAlign=ue;var le="after",ce={BEFORE:"before",CENTER:"center",AFTER:le};se.displayAlign=ce;var de="ltr";se.direction={HORIZONTAL_LEFT_TO_RIGHT:de,HORIZONTAL_RIGHT_TO_LEFT:"rtl"};var pe="horizontal-tb";se.writingMode={HORIZONTAL_TOP_TO_BOTTOM:pe,VERTICAL_LEFT_TO_RIGHT:"vertical-lr",VERTICAL_RIGHT_TO_LEFT:"vertical-rl"};var ge=0;se.lineInterpretation={LINE_NUMBER:ge,PERCENTAGE:1};var fe="start",me={CENTER:"center",START:fe,END:"end"};se.lineAlign=me;var _e={white:"#FFF",lime:"#0F0",cyan:"#0FF",red:"#F00",yellow:"#FF0",magenta:"#F0F",blue:"#00F",black:"#000"};se.defaultTextColor=_e;var ve={bg_white:"#FFF",bg_lime:"#0F0",bg_cyan:"#0FF",bg_red:"#F00",bg_yellow:"#FF0",bg_magenta:"#F0F",bg_blue:"#00F",bg_black:"#000"};se.defaultTextBackgroundColor=ve;var ye=400;se.fontWeight={NORMAL:ye,BOLD:700};var xe="normal",be={NORMAL:xe,ITALIC:"italic",OBLIQUE:"oblique"};function we(){this.id="",this.regionAnchorY=this.regionAnchorX=this.viewportAnchorY=this.viewportAnchorX=0,this.height=this.width=100,this.viewportAnchorUnits=this.widthUnits=this.heightUnits=Te,this.scroll=Se}se.fontStyle=be,se.textDecoration={UNDERLINE:"underline",LINE_THROUGH:"lineThrough",OVERLINE:"overline"},j("shaka.text.CueRegion",we);var Te=1;we.units={PX:0,PERCENTAGE:Te,LINES:2};var Se="";function Ae(){}function Ce(e,t){if(!e&&!t)return!0;if(!e||!t||e.byteLength!=t.byteLength)return!1;if(Ee(e)==Ee(t)&&(e.byteOffset||0)==(t.byteOffset||0))return!0;var i=Re(e);t=Re(t);for(var r=0;r<e.byteLength;r++)if(i[r]!=t[r])return!1;return!0}function Ee(e){return e instanceof ArrayBuffer?e:e.buffer}function Ie(e){return e instanceof ArrayBuffer?e:0==e.byteOffset&&e.byteLength==e.buffer.byteLength?e.buffer:new Uint8Array(e).buffer}function Re(e,t,i){return ke(e,void 0===t?0:t,i=void 0===i?1/0:i,Uint8Array)}function Le(e,t,i){return ke(e,void 0===t?0:t,i=void 0===i?1/0:i,DataView)}function ke(e,t,i,r){var n=(e.byteOffset||0)+e.byteLength;return t=Math.max(0,Math.min((e.byteOffset||0)+t,n)),new r(Ee(e),t,Math.min(t+Math.max(i,0),n)-t)}function Me(e,t,i){var r=O.apply(3,arguments);this.severity=e,this.category=t,this.code=i,this.data=r,this.handled=!1}we.scrollMode={NONE:Se,UP:"up"},j("shaka.util.BufferUtils",Ae),Ae.toDataView=Le,Ae.toUint8=Re,Ae.toArrayBuffer=Ie,Ae.equal=Ce,Me.prototype.toString=function(){return"shaka.util.Error "+JSON.stringify(this,null,"  ")},j("shaka.util.Error",Me),Me.Severity={RECOVERABLE:1,CRITICAL:2},Me.Category={NETWORK:1,TEXT:2,MEDIA:3,MANIFEST:4,STREAMING:5,DRM:6,PLAYER:7,CAST:8,STORAGE:9,ADS:10},Me.Code={UNSUPPORTED_SCHEME:1e3,BAD_HTTP_STATUS:1001,HTTP_ERROR:1002,TIMEOUT:1003,MALFORMED_DATA_URI:1004,REQUEST_FILTER_ERROR:1006,RESPONSE_FILTER_ERROR:1007,MALFORMED_TEST_URI:1008,UNEXPECTED_TEST_REQUEST:1009,ATTEMPTS_EXHAUSTED:1010,SEGMENT_MISSING:1011,INVALID_TEXT_HEADER:2e3,INVALID_TEXT_CUE:2001,UNABLE_TO_DETECT_ENCODING:2003,BAD_ENCODING:2004,INVALID_XML:2005,INVALID_MP4_TTML:2007,INVALID_MP4_VTT:2008,UNABLE_TO_EXTRACT_CUE_START_TIME:2009,INVALID_MP4_CEA:2010,TEXT_COULD_NOT_GUESS_MIME_TYPE:2011,CANNOT_ADD_EXTERNAL_TEXT_TO_SRC_EQUALS:2012,TEXT_ONLY_WEBVTT_SRC_EQUALS:2013,MISSING_TEXT_PLUGIN:2014,CHAPTERS_TRACK_FAILED:2015,CANNOT_ADD_EXTERNAL_THUMBNAILS_TO_SRC_EQUALS:2016,UNSUPPORTED_EXTERNAL_THUMBNAILS_URI:2017,BUFFER_READ_OUT_OF_BOUNDS:3e3,JS_INTEGER_OVERFLOW:3001,EBML_OVERFLOW:3002,EBML_BAD_FLOATING_POINT_SIZE:3003,MP4_SIDX_WRONG_BOX_TYPE:3004,MP4_SIDX_INVALID_TIMESCALE:3005,MP4_SIDX_TYPE_NOT_SUPPORTED:3006,WEBM_CUES_ELEMENT_MISSING:3007,WEBM_EBML_HEADER_ELEMENT_MISSING:3008,WEBM_SEGMENT_ELEMENT_MISSING:3009,WEBM_INFO_ELEMENT_MISSING:3010,WEBM_DURATION_ELEMENT_MISSING:3011,WEBM_CUE_TRACK_POSITIONS_ELEMENT_MISSING:3012,WEBM_CUE_TIME_ELEMENT_MISSING:3013,MEDIA_SOURCE_OPERATION_FAILED:3014,MEDIA_SOURCE_OPERATION_THREW:3015,VIDEO_ERROR:3016,QUOTA_EXCEEDED_ERROR:3017,TRANSMUXING_FAILED:3018,CONTENT_TRANSFORMATION_FAILED:3019,UNABLE_TO_GUESS_MANIFEST_TYPE:4e3,DASH_INVALID_XML:4001,DASH_NO_SEGMENT_INFO:4002,DASH_EMPTY_ADAPTATION_SET:4003,DASH_EMPTY_PERIOD:4004,DASH_WEBM_MISSING_INIT:4005,DASH_UNSUPPORTED_CONTAINER:4006,DASH_PSSH_BAD_ENCODING:4007,DASH_NO_COMMON_KEY_SYSTEM:4008,DASH_MULTIPLE_KEY_IDS_NOT_SUPPORTED:4009,DASH_CONFLICTING_KEY_IDS:4010,RESTRICTIONS_CANNOT_BE_MET:4012,HLS_PLAYLIST_HEADER_MISSING:4015,INVALID_HLS_TAG:4016,HLS_INVALID_PLAYLIST_HIERARCHY:4017,DASH_DUPLICATE_REPRESENTATION_ID:4018,HLS_MULTIPLE_MEDIA_INIT_SECTIONS_FOUND:4020,HLS_REQUIRED_ATTRIBUTE_MISSING:4023,HLS_REQUIRED_TAG_MISSING:4024,HLS_COULD_NOT_GUESS_CODECS:4025,HLS_KEYFORMATS_NOT_SUPPORTED:4026,DASH_UNSUPPORTED_XLINK_ACTUATE:4027,DASH_XLINK_DEPTH_LIMIT:4028,CONTENT_UNSUPPORTED_BY_BROWSER:4032,CANNOT_ADD_EXTERNAL_TEXT_TO_LIVE_STREAM:4033,NO_VARIANTS:4036,PERIOD_FLATTENING_FAILED:4037,INCONSISTENT_DRM_ACROSS_PERIODS:4038,HLS_VARIABLE_NOT_FOUND:4039,HLS_MSE_ENCRYPTED_MP2T_NOT_SUPPORTED:4040,HLS_MSE_ENCRYPTED_LEGACY_APPLE_MEDIA_KEYS_NOT_SUPPORTED:4041,NO_WEB_CRYPTO_API:4042,HLS_AES_128_INVALID_IV_LENGTH:4043,HLS_AES_128_INVALID_KEY_LENGTH:4044,CANNOT_ADD_EXTERNAL_THUMBNAILS_TO_LIVE_STREAM:4045,STREAMING_ENGINE_STARTUP_INVALID_STATE:5006,NO_RECOGNIZED_KEY_SYSTEMS:6e3,REQUESTED_KEY_SYSTEM_CONFIG_UNAVAILABLE:6001,FAILED_TO_CREATE_CDM:6002,FAILED_TO_ATTACH_TO_VIDEO:6003,INVALID_SERVER_CERTIFICATE:6004,FAILED_TO_CREATE_SESSION:6005,FAILED_TO_GENERATE_LICENSE_REQUEST:6006,LICENSE_REQUEST_FAILED:6007,LICENSE_RESPONSE_REJECTED:6008,ENCRYPTED_CONTENT_WITHOUT_DRM_INFO:6010,NO_LICENSE_SERVER_GIVEN:6012,OFFLINE_SESSION_REMOVED:6013,EXPIRED:6014,SERVER_CERTIFICATE_REQUIRED:6015,INIT_DATA_TRANSFORM_ERROR:6016,SERVER_CERTIFICATE_REQUEST_FAILED:6017,LOAD_INTERRUPTED:7e3,OPERATION_ABORTED:7001,NO_VIDEO_ELEMENT:7002,OBJECT_DESTROYED:7003,CONTENT_NOT_LOADED:7004,CAST_API_UNAVAILABLE:8e3,NO_CAST_RECEIVERS:8001,ALREADY_CASTING:8002,UNEXPECTED_CAST_ERROR:8003,CAST_CANCELED_BY_USER:8004,CAST_CONNECTION_TIMED_OUT:8005,CAST_RECEIVER_APP_UNAVAILABLE:8006,STORAGE_NOT_SUPPORTED:9e3,INDEXED_DB_ERROR:9001,DEPRECATED_OPERATION_ABORTED:9002,REQUESTED_ITEM_NOT_FOUND:9003,MALFORMED_OFFLINE_URI:9004,CANNOT_STORE_LIVE_OFFLINE:9005,NO_INIT_DATA_FOR_OFFLINE:9007,LOCAL_PLAYER_INSTANCE_REQUIRED:9008,NEW_KEY_OPERATION_NOT_SUPPORTED:9011,KEY_NOT_FOUND:9012,MISSING_STORAGE_CELL:9013,STORAGE_LIMIT_REACHED:9014,DOWNLOAD_SIZE_CALLBACK_ERROR:9015,MODIFY_OPERATION_NOT_SUPPORTED:9016,INDEXED_DB_INIT_TIMED_OUT:9017,CS_IMA_SDK_MISSING:1e4,CS_AD_MANAGER_NOT_INITIALIZED:10001,SS_IMA_SDK_MISSING:10002,SS_AD_MANAGER_NOT_INITIALIZED:10003,CURRENT_DAI_REQUEST_NOT_FINISHED:10004};
/*
            	 @license
            	 Copyright 2008 The Closure Library Authors
            	 SPDX-License-Identifier: Apache-2.0
            	*/
var Pe=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#(.*))?$");
/*
            	 @license
            	 Copyright 2006 The Closure Library Authors
            	 SPDX-License-Identifier: Apache-2.0
            	*/function Oe(e){var t;e instanceof Oe?(De(this,e.Ea),this.pb=e.pb,this.Ha=e.Ha,Ne(this,e.Kb),this.qa=e.qa,Fe(this,e.g.clone()),this.fb=e.fb):e&&(t=String(e).match(Pe))?(De(this,t[1]||"",!0),this.pb=Ue(t[2]||""),this.Ha=Ue(t[3]||"",!0),Ne(this,t[4]),this.qa=Ue(t[5]||"",!0),Fe(this,t[6]||"",!0),this.fb=Ue(t[7]||"")):this.g=new Xe(null)}function De(e,t,i){e.Ea=i?Ue(t,!0):t,e.Ea&&(e.Ea=e.Ea.replace(/:$/,""))}function Ne(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.Kb=t}else e.Kb=null}function Fe(e,t,i){t instanceof Xe?e.g=t:(i||(t=ze(t,We)),e.g=new Xe(t))}function Ue(e,t){return e?t?decodeURI(e):decodeURIComponent(e):""}function ze(e,t,i){return null!=e?(e=encodeURI(e).replace(t,Be),i&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function Be(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}(n=Oe.prototype).Ea="",n.pb="",n.Ha="",n.Kb=null,n.qa="",n.fb="",n.toString=function(){var e=[],t=this.Ea;if(t&&e.push(ze(t,je,!0),":"),t=this.Ha){e.push("//");var i=this.pb;i&&e.push(ze(i,je,!0),"@"),e.push(encodeURIComponent(t).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(t=this.Kb)&&e.push(":",String(t))}return(t=this.qa)&&(this.Ha&&"/"!=t.charAt(0)&&e.push("/"),e.push(ze(t,"/"==t.charAt(0)?Ve:He,!0))),(t=this.g.toString())&&e.push("?",t),(t=this.fb)&&e.push("#",ze(t,Ge)),e.join("")},n.resolve=function(e){var t=this.clone();"data"===t.Ea&&(t=new Oe);var i=!!e.Ea;i?De(t,e.Ea):i=!!e.pb,i?t.pb=e.pb:i=!!e.Ha,i?t.Ha=e.Ha:i=null!=e.Kb;var r=e.qa;if(i)Ne(t,e.Kb);else if(i=!!e.qa){if("/"!=r.charAt(0))if(this.Ha&&!this.qa)r="/"+r;else{var n=t.qa.lastIndexOf("/");-1!=n&&(r=t.qa.substr(0,n+1)+r)}if(".."==r||"."==r)r="";else if(-1!=r.indexOf("./")||-1!=r.indexOf("/.")){n=0==r.lastIndexOf("/",0),r=r.split("/");for(var s=[],a=0;a<r.length;){var o=r[a++];"."==o?n&&a==r.length&&s.push(""):".."==o?((1<s.length||1==s.length&&""!=s[0])&&s.pop(),n&&a==r.length&&s.push("")):(s.push(o),n=!0)}r=s.join("/")}}return i?t.qa=r:i=""!==e.g.toString(),i?Fe(t,e.g.clone()):i=!!e.fb,i&&(t.fb=e.fb),t},n.clone=function(){return new Oe(this)};var je=/[#\/\?@]/g,He=/[#\?:]/g,Ve=/[#\?]/g,We=/[#\?@]/g,Ge=/#/g;function Xe(e){this.g=e||null}function qe(e){if(!e.la&&(e.la={},e.Oc=0,e.g))for(var t=e.g.split("&"),i=0;i<t.length;i++){var r=t[i].indexOf("="),n=null;if(0<=r){var s=t[i].substring(0,r);n=t[i].substring(r+1)}else s=t[i];s=decodeURIComponent(s.replace(/\+/g," ")),n=n||"",e.add(s,decodeURIComponent(n.replace(/\+/g," ")))}}function Ye(e,t){return e.concat(t)}function $e(){}function Ke(e){return null!=e}function Ze(e,t){if(0==t.length)return e;var i=t.map((function(e){return new Oe(e)}));return e.map((function(e){return new Oe(e)})).map((function(e){return i.map((function(t){return e.resolve(t)}))})).reduce(Ye,[]).map((function(e){return e.toString()}))}function Qe(e,t){return{keySystem:e,licenseServerUri:"",distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",serverCertificate:null,serverCertificateUri:"",sessionType:"",initData:t||[],keyIds:new Set}}function Je(e,t){if(1==t.length)return t[0];if(null!=(e=et(e,t)))return e;throw new Me(2,4,4025,t)}function et(e,t){for(var i=l(rt[e]),r=i.next();!r.done;r=i.next()){r=r.value;for(var n=l(t),s=n.next();!s.done;s=n.next())if(s=s.value,r.test(s.trim()))return s.trim()}return e==tt?"":null}(n=Xe.prototype).la=null,n.Oc=null,n.add=function(e,t){qe(this),this.g=null;var i=this.la.hasOwnProperty(e)?this.la[e]:null;return i||(this.la[e]=i=[]),i.push(t),this.Oc++,this},n.set=function(e,t){return qe(this),this.g=null,this.la.hasOwnProperty(e)?this.la[e]=[t]:this.add(e,t),this},n.toString=function(){if(this.g)return this.g;if(!this.la)return"";var e,t=[];for(e in this.la)for(var i=encodeURIComponent(e),r=this.la[e],n=0;n<r.length;n++){var s=i;""!==r[n]&&(s+="="+encodeURIComponent(r[n])),t.push(s)}return this.g=t.join("&")},n.clone=function(){var e=new Xe;if(e.g=this.g,this.la){var t,i={};for(t in this.la)i[t]=this.la[t].concat();e.la=i,e.Oc=this.Oc}return e};var tt="text",it={va:"video",Hc:"audio",X:tt,Wb:"image",Gg:"application"},rt={audio:[/^vorbis$/,/^opus$/,/^flac$/,/^mp4a/,/^[ae]c-3$/,/^ac-4$/,/^dts[cx]$/,/^[du]dts$/],video:[/^avc/,/^hev/,/^hvc/,/^vp0?[89]/,/^av01/,/^dvhe/],text:[/^vtt$/,/^wvtt/,/^stpp/]};function nt(){var e,t,i=new Promise((function(i,r){e=i,t=r}));return i.resolve=e,i.reject=t,i}function st(e){this.h=e,this.g=void 0}function at(e){this.h=e,this.g=null}function ot(e){this.h=e,this.g=null}function ht(){return!(!e.MediaSource||!MediaSource.isTypeSupported)}function ut(e){return""!=vt().canPlayType(e)}function lt(){return!!navigator.userAgent.match(/Edge?\//)}function ct(){return _t("Xbox One")}function dt(){return _t("Tizen")}function pt(){return _t("Web0S")&&_t("Chrome/38.0.2125.122 Safari/537.36")}function gt(){return!!navigator.vendor&&navigator.vendor.includes("Apple")&&!dt()&&!_t("PC=EOS")&&!_t("VirginMedia")&&!ft()&&!_t("AFT")}function ft(){return _t("PlayStation 4")}function mt(){if(!gt())return null;var e=navigator.userAgent.match(/Version\/(\d+)/);return e||(e=navigator.userAgent.match(/OS (\d+)(?:_\d+)?/))?parseInt(e[1],10):null}function _t(e){return(navigator.userAgent||"").includes(e)}function vt(){return xt||(yt||(yt=new ot((function(){xt=null}))),(xt=document.getElementsByTagName("video")[0]||document.getElementsByTagName("audio")[0])||(xt=document.createElement("video")),yt.N(1),xt)}nt.prototype.resolve=function(){},nt.prototype.reject=function(){},st.prototype.value=function(){return null==this.g&&(this.g=this.h()),this.g},at.prototype.N=function(t){var i=this;this.stop();var r=!0,n=null;return this.g=function(){e.clearTimeout(n),r=!1},n=e.setTimeout((function(){r&&i.h()}),1e3*t),this},at.prototype.stop=function(){this.g&&(this.g(),this.g=null)},ot.prototype.Mb=function(){return this.stop(),this.h(),this},ot.prototype.N=function(e){var t=this;return this.stop(),this.g=new at((function(){t.h()})).N(e),this},ot.prototype.Ca=function(e){var t=this;return this.stop(),this.g=new at((function(){t.g.N(e),t.h()})).N(e),this},ot.prototype.stop=function(){this.g&&(this.g.stop(),this.g=null)},j("shaka.util.Timer",ot),ot.prototype.stop=ot.prototype.stop,ot.prototype.tickEvery=ot.prototype.Ca,ot.prototype.tickAfter=ot.prototype.N,ot.prototype.tickNow=ot.prototype.Mb;var yt=null,xt=null;function bt(){}function wt(t){if(!t)return"";if(239==(t=Re(t))[0]&&187==t[1]&&191==t[2]&&(t=t.subarray(3)),e.TextDecoder&&!ft())return(t=(new TextDecoder).decode(t)).includes("�")&&X('Decoded string contains an "unknown character" codepoint.  That probably means the UTF8 encoding was incorrect!'),t;for(var i="",r=0;r<t.length;++r){var n=65533;if(0==(128&t[r])?n=t[r]:t.length>=r+2&&192==(224&t[r])&&128==(192&t[r+1])?(n=(31&t[r])<<6|63&t[r+1],r+=1):t.length>=r+3&&224==(240&t[r])&&128==(192&t[r+1])&&128==(192&t[r+2])?(n=(15&t[r])<<12|(63&t[r+1])<<6|63&t[r+2],r+=2):t.length>=r+4&&240==(241&t[r])&&128==(192&t[r+1])&&128==(192&t[r+2])&&128==(192&t[r+3])&&(n=(7&t[r])<<18|(63&t[r+1])<<12|(63&t[r+2])<<6|63&t[r+3],r+=3),65535>=n)i+=String.fromCharCode(n);else{var s=1023&(n-=65536);i+=String.fromCharCode(55296+(n>>10)),i+=String.fromCharCode(56320+s)}}return i}function Tt(e,t,i){if(!e)return"";if(!i&&0!=e.byteLength%2)throw new Me(2,2,2004);i=Math.floor(e.byteLength/2);var r=new Uint16Array(i);e=Le(e);for(var n=0;n<i;n++)r[n]=e.getUint16(2*n,t);return Et.value()(r)}function St(e){function t(e){return i.byteLength<=e||32<=i[e]&&126>=i[e]}if(!e)return"";var i=Re(e);if(239==i[0]&&187==i[1]&&191==i[2])return wt(i);if(254==i[0]&&255==i[1])return Tt(i.subarray(2),!1);if(255==i[0]&&254==i[1])return Tt(i.subarray(2),!0);if(0==i[0]&&0==i[2])return Tt(e,!1);if(0==i[1]&&0==i[3])return Tt(e,!0);if(t(0)&&t(1)&&t(2)&&t(3))return wt(e);throw new Me(2,2,2003)}function At(t){if(e.TextEncoder&&!ft()){var i=new TextEncoder;return Ie(i.encode(t))}t=encodeURIComponent(t),t=unescape(t),i=new Uint8Array(t.length);for(var r=0;r<t.length;r++)i[r]=t[r].charCodeAt(0);return Ie(i)}function Ct(e,t){for(var i=new ArrayBuffer(2*e.length),r=new DataView(i),n=0;n<e.length;++n)r.setUint16(2*n,e.charCodeAt(n),t);return i}j("shaka.util.StringUtils",bt),bt.resetFromCharCode=function(){Et.g=void 0},bt.toUTF16=Ct,bt.toUTF8=At,bt.fromBytesAutoDetect=St,bt.fromUTF16=Tt,bt.fromUTF8=wt;var Et=new st((function(){function e(e){try{var t=new Uint8Array(e);return 0<String.fromCharCode.apply(null,t).length}catch(i){return!1}}for(var t={Ua:65536};0<t.Ua;(t={Ua:t.Ua}).Ua/=2)if(e(t.Ua))return function(e){return function(t){for(var i="",r=0;r<t.length;r+=e.Ua)i+=String.fromCharCode.apply(null,t.subarray(r,r+e.Ua));return i}}(t);return null}));function It(){}function Rt(e){return e=Re(e),e=Et.value()(e),btoa(e)}function Lt(e,t){return t=null==t||t,e=Rt(e).replace(/\+/g,"-").replace(/\//g,"_"),t?e:e.replace(/[=]*$/,"")}function kt(t){t=e.atob(t.replace(/-/g,"+").replace(/_/g,"/"));for(var i=new Uint8Array(t.length),r=0;r<t.length;++r)i[r]=t.charCodeAt(r);return i}function Mt(t){for(var i=t.length/2,r=new Uint8Array(i),n=0;n<i;n++)r[n]=e.parseInt(t.substr(2*n,2),16);return r}function Pt(e){var t=Re(e);e="";for(var i=(t=l(t)).next();!i.done;i=t.next())1==(i=(i=i.value).toString(16)).length&&(i="0"+i),e+=i;return e}function Ot(){for(var e=O.apply(0,arguments),t=0,i=l(e),r=i.next();!r.done;r=i.next())t+=r.value.byteLength;for(t=new Uint8Array(t),i=0,r=(e=l(e)).next();!r.done;r=e.next())r=r.value,t.set(Re(r),i),i+=r.byteLength;return t}function Dt(){}j("shaka.util.Uint8ArrayUtils",It),It.concat=Ot,It.toHex=Pt,It.fromHex=Mt,It.fromBase64=kt,It.toBase64=Lt,It.toStandardBase64=Rt,j("shaka.dependencies",Dt),Dt.has=function(e){return Ft.has(e)},Dt.add=function(e,t){if(!Nt[e])throw Error(e+" is not supported");Ft.set(e,(function(){return t}))};var Nt={muxjs:"muxjs"};Dt.Allowed=Nt;var Ft=new Map([["muxjs",function(){return e.muxjs}]]);function Ut(e){var t=this;this.o=e,this.m=Ft.get("muxjs")(),this.h=this.g=null,this.l=[],this.i=[],this.j=!1,this.m&&(this.g=new this.m.mp4.Transmuxer({keepOriginalTimestamps:!0}),this.g.on("data",(function(e){t.i=e.captions,t.l.push(Ot(e.initSegment,e.data))})),this.g.on("done",(function(){var e={data:Ot.apply(It,c(t.l)),captions:t.i};t.h.resolve(e),t.j=!1})))}function zt(e,t){var i=Bt(e),r="audio/aac"==e.toLowerCase().split(";")[0];return!(!Ft.get("muxjs")()||!i&&!r)&&(r?J('audio/mp4; codecs="mp4a.40.2"'):t?J(Ht(t,e)):(t=Ht("audio",e),e=Ht("video",e),J(t)||J(e)))}function Bt(e){return"mp2t"==e.toLowerCase().split(";")[0].split("/")[1]}function jt(e,t){return"audio/aac"==t.toLowerCase().split(";")[0]?'audio/mp4; codecs="mp4a.40.2"':Bt(t)?Ht(e,t):t}function Ht(e,t){if(t=t.replace(/mp2t/i,"mp4"),"audio"==e&&(t=t.replace("video","audio")),e=/avc1\.(66|77|100)\.(\d+)/.exec(t)){var i="avc1.",r=e[1],n=Number(e[2]);i=("66"==r?i+"4200":"77"==r?i+"4d00":i+"6400")+(n>>4).toString(16),i+=(15&n).toString(16),t=t.replace(e[0],i)}return t}function Vt(){}function Wt(e,t){return t&&(e+='; codecs="'+t+'"'),e}function Gt(e,t,i){return zt(t=Wt(e,t),i)?jt(i,t):"video/mp2t"!=e&&"audio"==i?t.replace("video","audio"):t}function Xt(e){var t=Yt(e);switch(e=t[0],t=t[1].toLowerCase(),!0){case"mp4a"===e&&"69"===t:case"mp4a"===e&&"6b"===t:return"mp3";case"mp4a"===e&&"66"===t:case"mp4a"===e&&"67"===t:case"mp4a"===e&&"68"===t:case"mp4a"===e&&"40.2"===t:case"mp4a"===e&&"40.02"===t:case"mp4a"===e&&"40.5"===t:case"mp4a"===e&&"40.05"===t:case"mp4a"===e&&"40.29"===t:case"mp4a"===e&&"40.42"===t:return"aac";case"mp4a"===e&&"a5"===t:return"ac-3";case"mp4a"===e&&"a6"===t:return"ec-3";case"mp4a"===e&&"b2"===t:return"dtsx";case"mp4a"===e&&"a9"===t:return"dtsc";case"avc1"===e:case"avc3"===e:return"avc";case"hvc1"===e:case"hev1"===e:return"hevc";case"dvh1"===e:case"dvhe"===e:return"dovi"}return e}function qt(e){return(e=e.split(/ *; */)).shift(),(e=e.find((function(e){return e.startsWith("codecs=")})))?e.split("=")[1].replace(/^"|"$/g,""):""}function Yt(e){var t=(e=e.split("."))[0];return e.shift(),[t,e.join(".")]}function $t(e){this.j=null,this.i=e,this.u=!1,this.l=this.s=0,this.m=1/0,this.h=this.g=null,this.B="",this.o=new Map}function Kt(e){return!(!ei[e]&&"application/cea-608"!=e&&"application/cea-708"!=e)}function Zt(e,t,i){if(e.B=t,t=e.o.get(t))for(var r=l(t.keys()),n=r.next();!n.done;n=r.next())(n=t.get(n.value).filter((function(e){return e.endTime<=i})))&&e.i.append(n)}function Qt(e,t,i){t.startTime+=i,t.endTime+=i;for(var r=(t=l(t.nestedCues)).next();!r.done;r=t.next())Qt(e,r.value,i)}function Jt(e,t,i,r,n){for(var s=i+" "+r,a=new Map,o=(t=l(t)).next();!o.done;o=t.next()){var h=o.value;o=h.stream,h=h.cue,a.has(o)||a.set(o,new Map),a.get(o).has(s)||a.get(o).set(s,[]),Qt(e,h,n),h.startTime>=e.l&&h.startTime<e.m&&(a.get(o).get(s).push(h),o==e.B&&e.i.append([h]))}for(s=(n=l(a.keys())).next();!s.done;s=n.next())for(s=s.value,e.o.has(s)||e.o.set(s,new Map),o=(t=l(a.get(s).keys())).next();!o.done;o=t.next())o=o.value,h=a.get(s).get(o),e.o.get(s).set(o,h);e.g=null==e.g?Math.max(i,e.l):Math.min(e.g,Math.max(i,e.l)),e.h=Math.max(e.h,Math.min(r,e.m))}Ut.prototype.destroy=function(){return this.g&&this.g.dispose(),this.g=null,Promise.resolve()},j("shaka.util.MimeUtils",Vt),Vt.getFullType=Wt,(new Map).set("codecs","codecs").set("frameRate","framerate").set("bandwidth","bitrate").set("width","width").set("height","height").set("channelsCount","channels"),$t.prototype.destroy=function(){return this.i=this.j=null,this.o.clear(),Promise.resolve()},$t.prototype.remove=function(e,t){var i=this;return P((function(r){if(1==r.g)return b(r,Promise.resolve(),2);!i.i||!i.i.remove(e,t)||null==i.g||t<=i.g||e>=i.h||(e<=i.g&&t>=i.h?i.g=i.h=null:e<=i.g&&t<i.h?i.g=t:e>i.g&&t>=i.h&&(i.h=e)),w(r)}))},j("shaka.text.TextEngine",$t),$t.prototype.destroy=$t.prototype.destroy,$t.findParser=function(e){return ei[e]},$t.unregisterParser=function(e){delete ei[e]},$t.registerParser=function(e,t){ei[e]=t};var ei={};function ti(){}function ii(e,t){return e=si(e),t=si(t),e.split("-")[0]==t.split("-")[0]}function ri(e,t){return e=si(e),t=si(t),e=e.split("-"),t=t.split("-"),e[0]==t[0]&&1==e.length&&2==t.length}function ni(e,t){return e=si(e),t=si(t),e=e.split("-"),t=t.split("-"),2==e.length&&2==t.length&&e[0]==t[0]}function si(e){var t=e.split("-");return e=t[0]||"",t=t[1]||"",e=e.toLowerCase(),e=li.get(e)||e,(t=t.toUpperCase())?e+"-"+t:e}function ai(e,t){return e=si(e),(t=si(t))==e?4:ri(t,e)?3:ni(t,e)?2:ri(e,t)?1:0}function oi(e){var t=e.indexOf("-");return e=(e=0<=t?e.substring(0,t):e).toLowerCase(),li.get(e)||e}function hi(e){return e.language?si(e.language):e.audio&&e.audio.language?si(e.audio.language):e.video&&e.video.language?si(e.video.language):"und"}function ui(e,t){e=si(e);var i=new Set,r=l(t);for(t=r.next();!t.done;t=r.next())i.add(si(t.value));for(t=(r=l(i)).next();!t.done;t=r.next())if((t=t.value)==e)return t;for(t=(r=l(i)).next();!t.done;t=r.next())if(ri(t=t.value,e))return t;for(t=(r=l(i)).next();!t.done;t=r.next())if(ni(t=t.value,e))return t;for(t=(i=l(i)).next();!t.done;t=i.next())if(ri(e,t=t.value))return t;return null}j("shaka.util.LanguageUtils",ti),ti.findClosestLocale=ui,ti.getLocaleForVariant=hi,ti.getLocaleForText=function(e){return si(e.language||"und")},ti.getBase=oi,ti.relatedness=ai,ti.areSiblings=function(e,t){var i=oi(e),r=oi(t);return e!=i&&t!=r&&i==r},ti.normalize=si,ti.isSiblingOf=ni,ti.isParentOf=ri,ti.areLanguageCompatible=ii,ti.areLocaleCompatible=function(e,t){return(e=si(e))==(t=si(t))};var li=new Map([["aar","aa"],["abk","ab"],["afr","af"],["aka","ak"],["alb","sq"],["amh","am"],["ara","ar"],["arg","an"],["arm","hy"],["asm","as"],["ava","av"],["ave","ae"],["aym","ay"],["aze","az"],["bak","ba"],["bam","bm"],["baq","eu"],["bel","be"],["ben","bn"],["bih","bh"],["bis","bi"],["bod","bo"],["bos","bs"],["bre","br"],["bul","bg"],["bur","my"],["cat","ca"],["ces","cs"],["cha","ch"],["che","ce"],["chi","zh"],["chu","cu"],["chv","cv"],["cor","kw"],["cos","co"],["cre","cr"],["cym","cy"],["cze","cs"],["dan","da"],["deu","de"],["div","dv"],["dut","nl"],["dzo","dz"],["ell","el"],["eng","en"],["epo","eo"],["est","et"],["eus","eu"],["ewe","ee"],["fao","fo"],["fas","fa"],["fij","fj"],["fin","fi"],["fra","fr"],["fre","fr"],["fry","fy"],["ful","ff"],["geo","ka"],["ger","de"],["gla","gd"],["gle","ga"],["glg","gl"],["glv","gv"],["gre","el"],["grn","gn"],["guj","gu"],["hat","ht"],["hau","ha"],["heb","he"],["her","hz"],["hin","hi"],["hmo","ho"],["hrv","hr"],["hun","hu"],["hye","hy"],["ibo","ig"],["ice","is"],["ido","io"],["iii","ii"],["iku","iu"],["ile","ie"],["ina","ia"],["ind","id"],["ipk","ik"],["isl","is"],["ita","it"],["jav","jv"],["jpn","ja"],["kal","kl"],["kan","kn"],["kas","ks"],["kat","ka"],["kau","kr"],["kaz","kk"],["khm","km"],["kik","ki"],["kin","rw"],["kir","ky"],["kom","kv"],["kon","kg"],["kor","ko"],["kua","kj"],["kur","ku"],["lao","lo"],["lat","la"],["lav","lv"],["lim","li"],["lin","ln"],["lit","lt"],["ltz","lb"],["lub","lu"],["lug","lg"],["mac","mk"],["mah","mh"],["mal","ml"],["mao","mi"],["mar","mr"],["may","ms"],["mkd","mk"],["mlg","mg"],["mlt","mt"],["mon","mn"],["mri","mi"],["msa","ms"],["mya","my"],["nau","na"],["nav","nv"],["nbl","nr"],["nde","nd"],["ndo","ng"],["nep","ne"],["nld","nl"],["nno","nn"],["nob","nb"],["nor","no"],["nya","ny"],["oci","oc"],["oji","oj"],["ori","or"],["orm","om"],["oss","os"],["pan","pa"],["per","fa"],["pli","pi"],["pol","pl"],["por","pt"],["pus","ps"],["que","qu"],["roh","rm"],["ron","ro"],["rum","ro"],["run","rn"],["rus","ru"],["sag","sg"],["san","sa"],["sin","si"],["slk","sk"],["slo","sk"],["slv","sl"],["sme","se"],["smo","sm"],["sna","sn"],["snd","sd"],["som","so"],["sot","st"],["spa","es"],["sqi","sq"],["srd","sc"],["srp","sr"],["ssw","ss"],["sun","su"],["swa","sw"],["swe","sv"],["tah","ty"],["tam","ta"],["tat","tt"],["tel","te"],["tgk","tg"],["tgl","tl"],["tha","th"],["tib","bo"],["tir","ti"],["ton","to"],["tsn","tn"],["tso","ts"],["tuk","tk"],["tur","tr"],["twi","tw"],["uig","ug"],["ukr","uk"],["urd","ur"],["uzb","uz"],["ven","ve"],["vie","vi"],["vol","vo"],["wel","cy"],["wln","wa"],["wol","wo"],["xho","xh"],["yid","yi"],["yor","yo"],["zha","za"],["zho","zh"],["zul","zu"]]);function ci(){this.g={}}function di(e,t,i,r,n){var s=e.variants;(t.length||i.length)&&(s=function(e,t,i){for(var r={},n=(t=l(t)).next();!n.done;r={xd:r.xd},n=t.next())if(r.xd=n.value,n=e.filter(function(e){return function(t){return t.video&&t.video.codecs.startsWith(e.xd)}}(r)),n.length){e=n;break}for(r={},i=l(i),t=i.next();!t.done;r={jd:r.jd},t=i.next())if(r.jd=t.value,t=e.filter(function(e){return function(t){return t.audio&&t.audio.codecs.startsWith(e.jd)}}(r)),t.length){e=t;break}return e}(s,t,i)),t=function(e){for(var t=new ci,i=(e=l(e)).next();!i.done;i=e.next()){var r=gi(i=i.value);t.push(r,i)}return t}(s=Pi(s,r)),t=function(e){var t=0,i=new Map,r=e.size();return e.forEach((function(e,n){for(var s=(n=l(n)).next();!s.done;s=n.next()){var a=(s=s.value).video;if(a&&a.width&&a.height){a=a.width*a.height*(a.frameRate||1),i.has(a)||i.set(a,new ci);var o=i.get(a);o.push(e,s),o.size()===r&&(t=Math.max(t,a))}}})),t?i.get(t):e}(t);var a=function(e,t){for(var i=(t=l(t)).next();!i.done;i=t.next())if((i=i.value)==zi||i==Bi){if(1==(e=pi(e,i)).size())return e.keys()[0]}else if(i==ji)break;return function(e){var t="",i=1/0;return e.forEach((function(e,r){for(var n=0,s=0,a=(r=l(r)).next();!a.done;a=r.next())n+=a.value.bandwidth||0,++s;(n/=s)<i&&(t=e,i=n)})),t}(e)}(t,n);e.variants=e.variants.filter((function(e){return gi(e)==a}))}function pi(e,t){var i=0,r=new ci;return e.forEach((function(e,n){for(var s=0,a=0,o=l(n),h=o.next();!h.done;h=o.next())(h=h.value).decodingInfos.length&&(s+=h.decodingInfos[0][t]?1:0,a++);(s/=a)>i?(r.g={},r.push(e,n),i=s):s==i&&r.push(e,n)})),r}function gi(e){var t="";e.video&&(t=Xt(e.video.codecs));var i="";return e.audio&&(i=Xt(e.audio.codecs)),t+"-"+i}function fi(e,t,i){function r(e,t,i){return e>=t&&e<=i}var n=e.video;if(0!=e.disabledUntilTime){if(e.disabledUntilTime>Date.now()/1e3)return!1;e.disabledUntilTime=0}return!(n&&n.width&&n.height&&(!r(n.width,t.minWidth,Math.min(t.maxWidth,i.width))||!r(n.height,t.minHeight,Math.min(t.maxHeight,i.height))||!r(n.width*n.height,t.minPixels,t.maxPixels))||e&&e.video&&e.video.frameRate&&!r(e.video.frameRate,t.minFrameRate,t.maxFrameRate)||!r(e.bandwidth,t.minBandwidth,t.maxBandwidth))}function mi(e,t,i){for(var r=!1,n=(e=l(e)).next();!n.done;n=e.next()){var s=(n=n.value).allowedByApplication;n.allowedByApplication=fi(n,t,i),s!=n.allowedByApplication&&(r=!0)}return r}function _i(e,t){return P((function(i){return 1==i.g?b(i,vi(t,0<t.offlineSessionIds.length),2):(Ti(e,t),function(e){e.textStreams=e.textStreams.filter((function(e){return Kt(Wt(e.mimeType,e.codecs))}))}(t),b(i,function(e){var t,i,r,n,s,a,o;return P((function(h){switch(h.g){case 1:t=[],i=l(e.imageStreams),r=i.next();case 2:if(r.done){h.A(4);break}if(n=r.value,s=n.mimeType,Hi.has(s)){h.A(5);break}if(!(a=Vi.get(s))){Hi.set(s,!1),h.A(5);break}return b(h,function(e){return new Promise((function(t){var i=new Image;i.src=e,"decode"in i?i.decode().then((function(){t(!0)})).catch((function(){t(!1)})):i.onload=i.onerror=function(){t(2===i.height)}}))}(a),7);case 7:o=h.h,Hi.set(s,o);case 5:Hi.get(s)&&t.push(n),r=i.next(),h.A(2);break;case 4:e.imageStreams=t,w(h)}}))}(t),0))}))}function vi(e,t){return P((function(i){if(1==i.g)return b(i,yi(e.variants,t,!1),2);e.variants=e.variants.filter((function(e){var t=e.video;if(t){var i=wi(t.codecs);if(t.codecs.includes(",")){var r=t.codecs.split(",");i=wi(i=Je("video",r)),r=bi(r=Je("audio",r));var n=Gt(t.mimeType,r,"audio");if(!J(n))return!1;i=[i,r].join()}if(!J(r=Gt(t.mimeType,i,"video")))return!1;t.codecs=i}if(i=e.audio){if(r=bi(i.codecs),!J(n=Gt(i.mimeType,r,"audio")))return!1;i.codecs=r}return ct()&&t&&(t.width&&1920<t.width||t.height&&1080<t.height)&&(t.codecs.includes("avc1.")||t.codecs.includes("avc3."))?(Ni(e),!1):((t=e.decodingInfos.some((function(e){return e.supported})))||Ni(e),t)})),w(i)}))}function yi(e,t,i){var r,n,s,a,o,h,u,c,d,p;return P((function(g){if(e.some((function(e){return e.decodingInfos.length})))return g.return();for(r=navigator.mediaCapabilities,n=[],s=function(e,t){var i;return P((function(n){return 1==n.g?(T(n,2),b(n,r.decodingInfo(t),4)):2!=n.g?(i=n.h,e.decodingInfos.push(i),A(n,0)):(C(n),JSON.stringify(t),void w(n))}))},a=l(e),o=a.next();!o.done;o=a.next())for(h=o.value,u=xi(h,t,i),c=l(u),d=c.next();!d.done;d=c.next())p=d.value,n.push(s(h,p));return b(g,Promise.all(n),0)}))}function xi(e,t,i){var r=e.audio,n=e.video;if(i={type:i?"file":"media-source"},n){var s=n.codecs;if(n.codecs.includes(",")){var a=n.codecs.split(",");s=wi(s=Je("video",a)),a=Je("audio",a),a=Gt(n.mimeType,a,"audio"),i.audio={contentType:a,channels:2,bitrate:e.bandwidth||1,samplerate:1,spatialRendering:!1}}if(s=wi(s),s=Gt(n.mimeType,s,"video"),i.video={contentType:s,width:n.width||64,height:n.height||64,bitrate:n.bandwidth||e.bandwidth||1,framerate:n.frameRate||1},n.hdr)switch(n.hdr){case"SDR":i.video.transferFunction="srgb";break;case"PQ":i.video.transferFunction="pq";break;case"HLG":i.video.transferFunction="hlg"}}if(r&&(s=bi(r.codecs),s=Gt(r.mimeType,s,"audio"),i.audio={contentType:s,channels:r.channelsCount||2,bitrate:r.bandwidth||e.bandwidth||1,samplerate:r.audioSamplingRate||1,spatialRendering:r.spatialAudio}),!(a=(e.video?e.video.drmInfos:[]).concat(e.audio?e.audio.drmInfos:[])).length)return[i];e=[],s=new Map;for(var o=(a=l(a)).next();!o.done;o=a.next()){var h=o.value;s.get(h.keySystem)||s.set(h.keySystem,[]),s.get(h.keySystem).push(h)}a=t?"required":"optional",t=t?["persistent-license"]:["temporary"];for(var u=(h=l(s.keys())).next();!u.done;u=h.next()){var c=u.value;u=Object.assign({},i);var d=s.get(c);for(c={keySystem:c,initDataType:"cenc",persistentState:a,distinctiveIdentifier:"optional",sessionTypes:t},o=(d=l(d)).next();!o.done;o=d.next()){if((o=o.value).initData&&o.initData.length){for(var p=new Set,g=l(o.initData),f=g.next();!f.done;f=g.next())p.add(f.value.initDataType);c.initDataType=o.initData[0].initDataType}o.distinctiveIdentifierRequired&&(c.distinctiveIdentifier="required"),o.persistentStateRequired&&(c.persistentState="required"),o.sessionType&&(c.sessionTypes=[o.sessionType]),r&&(""!=o.audioRobustness?c.audio?c.audio.robustness=c.audio.robustness||o.audioRobustness:c.audio={robustness:o.audioRobustness}:c.audio||(c.audio={})),n&&(""!=o.videoRobustness?c.video?c.video.robustness=c.video.robustness||o.videoRobustness:c.video={robustness:o.videoRobustness}:c.video||(c.video={}))}u.keySystemConfiguration=c,e.push(u)}return e}function bi(e){return dt()&&"ac-3"==e.toLowerCase()?"ec-3":e}function wi(e){if(e.includes("avc1")){var t=e.split(".");if(3==t.length)return e=t.shift()+".",(e+=parseInt(t.shift(),10).toString(16))+("000"+parseInt(t.shift(),10).toString(16)).slice(-4)}else if("vp9"==e)return"vp09.00.41.08";return e}function Ti(e,t){t.variants=t.variants.filter((function(t){var i=t.audio;return t=t.video,!(i&&e&&e.audio&&!Si(i,e.audio)||t&&e&&e.video&&!Si(t,e.video))}))}function Si(e,t){return e.mimeType==t.mimeType&&e.codecs.split(".")[0]==t.codecs.split(".")[0]}function Ai(e){var t=e.audio,i=e.video,r=t?t.mimeType:null,n=i?i.mimeType:null,s=t?t.codecs:null,a=i?i.codecs:null,o=[];a&&o.push(a),s&&o.push(s);var h=[];i&&h.push(i.mimeType),t&&h.push(t.mimeType),h=h[0]||null;var u=[];t&&u.push(t.kind),i&&u.push(i.kind),u=u[0]||null;var c=new Set;if(t)for(var d=l(t.roles),p=d.next();!p.done;p=d.next())c.add(p.value);if(i)for(p=(d=l(i.roles)).next();!p.done;p=d.next())c.add(p.value);return e={id:e.id,active:!1,type:"variant",bandwidth:e.bandwidth,language:e.language,label:null,kind:u,width:null,height:null,frameRate:null,pixelAspectRatio:null,hdr:null,mimeType:h,audioMimeType:r,videoMimeType:n,codecs:o.join(", "),audioCodec:s,videoCodec:a,primary:e.primary,roles:Array.from(c),audioRoles:null,forced:!1,videoId:null,audioId:null,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,tilesLayout:null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:null,originalImageId:null},i&&(e.videoId=i.id,e.originalVideoId=i.originalId,e.width=i.width||null,e.height=i.height||null,e.frameRate=i.frameRate||null,e.pixelAspectRatio=i.pixelAspectRatio||null,e.videoBandwidth=i.bandwidth||null),t&&(e.audioId=t.id,e.originalAudioId=t.originalId,e.channelsCount=t.channelsCount,e.audioSamplingRate=t.audioSamplingRate,e.audioBandwidth=t.bandwidth||null,e.spatialAudio=t.spatialAudio,e.label=t.label,e.audioRoles=t.roles),e}function Ci(e){return{id:e.id,active:!1,type:tt,bandwidth:0,language:e.language,label:e.label,kind:e.kind||null,width:null,height:null,frameRate:null,pixelAspectRatio:null,hdr:null,mimeType:e.mimeType,audioMimeType:null,videoMimeType:null,codecs:e.codecs||null,audioCodec:null,videoCodec:null,primary:e.primary,roles:e.roles,audioRoles:null,forced:e.forced,videoId:null,audioId:null,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,tilesLayout:null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:e.originalId,originalImageId:null}}function Ei(e){var t=e.width||null,i=e.height||null,r=null;e.segmentIndex&&(r=e.segmentIndex.get(0));var n=e.tilesLayout;return r&&(n=r.tilesLayout||n),n&&null!=t&&(t/=Number(n.split("x")[0])),n&&null!=i&&(i/=Number(n.split("x")[1])),{id:e.id,active:!1,type:"image",bandwidth:e.bandwidth||0,language:"",label:null,kind:null,width:t,height:i,frameRate:null,pixelAspectRatio:null,hdr:null,mimeType:e.mimeType,audioMimeType:null,videoMimeType:null,codecs:null,audioCodec:null,videoCodec:null,primary:!1,roles:[],audioRoles:null,forced:!1,videoId:null,audioId:null,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,tilesLayout:n||null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:null,originalImageId:e.originalId}}function Ii(e){return e.__shaka_id||(e.__shaka_id=Ui++),e.__shaka_id}function Ri(e){var t=ki(e);return t.active="disabled"!=e.mode,t.type="text",t.originalTextId=e.id,"captions"==e.kind&&(t.mimeType="application/cea-608"),e.kind&&(t.roles=[e.kind]),"forced"==e.kind&&(t.forced=!0),t}function Li(e){var t=ki(e);return t.active=e.enabled,t.type="variant",t.originalAudioId=e.id,"main"==e.kind&&(t.primary=!0),e.kind&&(t.roles=[e.kind],t.audioRoles=[e.kind],t.label=e.label),t}function ki(e){return{id:Ii(e),active:!1,type:"",bandwidth:0,language:si(e.language),label:e.label,kind:e.kind,width:null,height:null,frameRate:null,pixelAspectRatio:null,hdr:null,mimeType:null,audioMimeType:null,videoMimeType:null,codecs:null,audioCodec:null,videoCodec:null,primary:!1,roles:[],forced:!1,audioRoles:null,videoId:null,audioId:null,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,tilesLayout:null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:null,originalImageId:null}}function Mi(e){return e.allowedByApplication&&e.allowedByKeySystem}function Pi(e,t){for(var i=e.filter((function(e){return e.audio&&e.audio.channelsCount})),r=new Map,n=(i=l(i)).next();!n.done;n=i.next()){var s=(n=n.value).audio.channelsCount;r.has(s)||r.set(s,[]),r.get(s).push(n)}return 0==(i=Array.from(r.keys())).length?e:(e=i.filter((function(e){return e<=t}))).length?r.get(Math.max.apply(Math,c(e))):r.get(Math.min.apply(Math,c(i)))}function Oi(e,t,i,r){var n=e,s=e.filter((function(e){return e.primary}));s.length&&(n=s);var a=n.length?n[0].language:"";if(n=n.filter((function(e){return e.language==a})),t){var o=ui(si(t),e.map((function(e){return e.language})));o&&(n=e.filter((function(e){return si(e.language)==o})))}if(n=n.filter((function(e){return e.forced==r})),i){if((e=Di(n,i)).length)return e}else if(e=n.filter((function(e){return 0==e.roles.length})),e.length)return e;return e=n.map((function(e){return e.roles})).reduce(Ye,[]),e.length?Di(n,e[0]):n}function Di(e,t){return e.filter((function(e){return e.roles.includes(t)}))}function Ni(e){var t=[];return e.audio&&t.push(Fi(e.audio)),e.video&&t.push(Fi(e.video)),t.join(", ")}function Fi(e){return"audio"==e.type?"type=audio codecs="+e.codecs+" bandwidth="+e.bandwidth+" channelsCount="+e.channelsCount+" audioSamplingRate="+e.audioSamplingRate:"video"==e.type?"type=video codecs="+e.codecs+" bandwidth="+e.bandwidth+" frameRate="+e.frameRate+" width="+e.width+" height="+e.height:"unexpected stream type"}(n=ci.prototype).push=function(e,t){this.g.hasOwnProperty(e)?this.g[e].push(t):this.g[e]=[t]},n.get=function(e){return(e=this.g[e])?e.slice():null},n.remove=function(e,t){e in this.g&&(this.g[e]=this.g[e].filter((function(e){return e!=t})),0==this.g[e].length&&delete this.g[e])},n.forEach=function(e){for(var t in this.g)e(t,this.g[t])},n.size=function(){return Object.keys(this.g).length},n.keys=function(){return Object.keys(this.g)};var Ui=0,zi="smooth",Bi="powerEfficient",ji="bandwidth",Hi=(new Map).set("image/svg+xml",!0).set("image/png",!0).set("image/jpeg",!0).set("image/jpg",!0),Vi=(new Map).set("image/webp","data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA").set("image/avif","data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=");function Wi(){var e=this;this.l=null,this.o=!1,this.i=new W,navigator.connection&&navigator.connection.addEventListener("change",(function(){if(e.g.useNetworkInformation&&e.o){e.i=new W,e.g&&e.i.configure(e.g.advanced);var t=e.chooseVariant();t&&e.l(t)}})),this.m=[],this.u=1,this.B=!1,this.h=this.j=this.g=this.s=null,this.D=new ot((function(){if(e.g.restrictToElementSize){var t=e.chooseVariant();t&&e.l(t)}}))}function Gi(e){var t=e.g.defaultBandwidthEstimate;return navigator.connection&&navigator.connection.downlink&&e.g.useNetworkInformation&&(t=1e6*navigator.connection.downlink),t}function Xi(e,t,i,r){return e&&(t=t.filter((function(t){return fi(t,e,{width:r,height:i})}))),t.sort((function(e,t){return e.bandwidth-t.bandwidth}))}(n=Wi.prototype).stop=function(){this.l=null,this.o=!1,this.m=[],this.u=1,this.j=this.s=null,this.h&&(this.h.disconnect(),this.h=null),this.D.stop()},n.init=function(e){this.l=e},n.chooseVariant=function(){var t=1/0,i=1/0;this.g.restrictToScreenSize&&(i=this.g.ignoreDevicePixelRatio?1:e.devicePixelRatio,t=e.screen.height*i,i*=e.screen.width),this.h&&this.g.restrictToElementSize&&(i=this.g.ignoreDevicePixelRatio?1:e.devicePixelRatio,t=this.j.clientWidth*i,i*=this.j.clientHeight),t=Xi(this.g.restrictions,this.m,t,i),i=this.i.getBandwidthEstimate(Gi(this)),this.m.length&&!t.length&&(t=[(t=Xi(null,this.m,1/0,1/0))[0]]);for(var r=t[0]||null,n=0;n<t.length;n++){for(var s=t[n],a=isNaN(this.u)?1:Math.abs(this.u),o=a*s.bandwidth/this.g.bandwidthDowngradeTarget,h={bandwidth:1/0},u=n+1;u<t.length;u++)if(s.bandwidth!=t[u].bandwidth){h=t[u];break}a=a*h.bandwidth/this.g.bandwidthUpgradeTarget,i>=o&&i<=a&&r.bandwidth!=s.bandwidth&&(r=s)}return this.s=Date.now(),r},n.enable=function(){this.o=!0},n.disable=function(){this.o=!1},n.segmentDownloaded=function(e,t){if(this.i.sample(e,t),null!=this.s&&this.o)e:{if(this.B){if(Date.now()-this.s<1e3*this.g.switchInterval)break e}else{if(!((e=this.i).g>=e.i))break e;this.B=!0}e=this.chooseVariant(),this.i.getBandwidthEstimate(Gi(this)),e&&this.l(e)}},n.getBandwidthEstimate=function(){return this.i.getBandwidthEstimate(Gi(this))},n.setVariants=function(e){this.m=e},n.playbackRateChanged=function(e){this.u=e},n.setMediaElement=function(t){var i=this;this.j=t,this.h&&(this.h.disconnect(),this.h=null),this.j&&"ResizeObserver"in e&&(this.h=new ResizeObserver((function(){i.D.N(qi)})),this.h.observe(this.j))},n.configure=function(e){this.g=e,this.i&&this.g&&this.i.configure(this.g.advanced)},j("shaka.abr.SimpleAbrManager",Wi),Wi.prototype.configure=Wi.prototype.configure,Wi.prototype.setMediaElement=Wi.prototype.setMediaElement,Wi.prototype.playbackRateChanged=Wi.prototype.playbackRateChanged,Wi.prototype.setVariants=Wi.prototype.setVariants,Wi.prototype.getBandwidthEstimate=Wi.prototype.getBandwidthEstimate,Wi.prototype.segmentDownloaded=Wi.prototype.segmentDownloaded,Wi.prototype.disable=Wi.prototype.disable,Wi.prototype.enable=Wi.prototype.enable,Wi.prototype.chooseVariant=Wi.prototype.chooseVariant,Wi.prototype.init=Wi.prototype.init,Wi.prototype.stop=Wi.prototype.stop;var qi=1;function Yi(e,t){this.g=e,this.h=t}function $i(e,t){var i=new Yi(5,0),r=Qi,n=r.g,s=i.h-n.h;(0<(i.g-n.g||s)?r.i:r.h)(r.g,i,e,t)}function Ki(e,t,i,r){q([i,"has been deprecated and will be removed in",t,". We are currently at version",e,". Additional information:",r].join(" "))}function Zi(e,t,i,r){X([i,"has been deprecated and has been removed in",t,". We are now at version",e,". Additional information:",r].join(""))}Yi.prototype.toString=function(){return"v"+this.g+"."+this.h};var Qi=null;function Ji(e,t){for(this.h=e,this.g=new Set([e]),t=(e=l(t=t||[])).next();!t.done;t=e.next())this.add(t.value)}function er(e,t){var i;if(!(i=!!e.audio!=!!t.audio||!!e.video!=!!t.video||e.language!=t.language)&&(i=e.audio&&t.audio)){i=e.audio;var r=t.audio;i=!((!(!i.channelsCount||!r.channelsCount||2<i.channelsCount||2<r.channelsCount)||i.channelsCount==r.channelsCount)&&tr(i,r)&&ir(i.roles,r.roles))}return!i&&(i=e.video&&t.video)&&(i=!(tr(e=e.video,t=t.video)&&ir(e.roles,t.roles))),!i}function tr(e,t){if(e.mimeType!=t.mimeType)return!1;if(e=e.codecs.split(",").map((function(e){return Yt(e)[0]})),t=t.codecs.split(",").map((function(e){return Yt(e)[0]})),e.length!=t.length)return!1;e.sort(),t.sort();for(var i=0;i<e.length;i++)if(e[i]!=t[i])return!1;return!0}function ir(e,t){if(e=new Set(e),t=new Set(t),e.delete("main"),t.delete("main"),e.size!=t.size)return!1;for(var i=(e=l(e)).next();!i.done;i=e.next())if(!t.has(i.value))return!1;return!0}function rr(e){this.g=e,this.h=new nr(e.language,"",e.audio&&e.audio.channelsCount?e.audio.channelsCount:0,"")}function nr(e,t,i,r){this.i=e,this.j=t,this.g=i,this.h=void 0===r?"":r}function sr(){this.g=hr,this.h=(new Map).set(hr,2).set(or,1)}function ar(e,t,i){e.h.set(hr,i).set(or,t)}j("shaka.config.AutoShowText",{NEVER:0,ALWAYS:1,IF_PREFERRED_TEXT_LANGUAGE:2,IF_SUBTITLES_MAY_BE_NEEDED:3}),Ji.prototype.add=function(e){return!!er(this.h,e)&&(this.g.add(e),!0)},Ji.prototype.values=function(){return this.g.values()},rr.prototype.create=function(e){var t=this,i=e.filter((function(e){return er(t.g,e)}));return i.length?new Ji(i[0],i):this.h.create(e)},nr.prototype.create=function(e){var t=[];t=function(e,t){t=si(t);var i=ui(t,e.map((function(e){return hi(e)})));return i?e.filter((function(e){return i==hi(e)})):[]}(e,this.i);var i=e.filter((function(e){return e.primary}));for(e=function(e,t){return e.filter((function(e){return!!e.audio&&(t?e.audio.roles.includes(t):0==e.audio.roles.length)}))}(t=t.length?t:i.length?i:e,this.j),e.length&&(t=e),this.g&&((e=Pi(t,this.g)).length&&(t=e)),this.h&&(e=function(e,t){return e.filter((function(e){return!!e.audio&&e.audio.label.toLowerCase()==t.toLowerCase()}))}(t,this.h),e.length&&(t=e)),e=new Ji(t[0]),i=(t=l(t)).next();!i.done;i=t.next())i=i.value,er(e.h,i)&&e.add(i);return e};var or=0,hr=1;function ur(e,t){var i={maxAttempts:2,baseDelay:1e3,backoffFactor:2,fuzzFactor:.5,timeout:3e4,stallTimeout:5e3,connectionTimeout:1e4};this.l=null==e.maxAttempts?i.maxAttempts:e.maxAttempts,this.j=null==e.baseDelay?i.baseDelay:e.baseDelay,this.o=null==e.fuzzFactor?i.fuzzFactor:e.fuzzFactor,this.m=null==e.backoffFactor?i.backoffFactor:e.backoffFactor,this.g=0,this.h=this.j,(this.i=void 0!==t&&t)&&(this.g=1)}function lr(e){var t,i;return P((function(r){if(1==r.g){if(e.g>=e.l){if(!e.i)throw new Me(2,7,1010);e.g=1,e.h=e.j}return t=e.g,e.g++,0==t?r.return():(i=e.h*(1+(2*Math.random()-1)*e.o),b(r,new Promise((function(e){new ot(e).N(i/1e3)})),2))}e.h*=e.m,w(r)}))}function cr(e,t){this.promise=e,this.i=t,this.g=!1}function dr(e){return new cr(Promise.reject(e),(function(){return Promise.resolve()}))}function pr(){var e=Promise.reject(new Me(2,7,7001));return e.catch((function(){})),new cr(e,(function(){return Promise.resolve()}))}function gr(e){return new cr(Promise.resolve(e),(function(){return Promise.resolve()}))}function fr(e){return new cr(e,(function(){return e.catch((function(){}))}))}function mr(e){return new cr(Promise.all(e.map((function(e){return e.promise}))),(function(){return Promise.all(e.map((function(e){return e.abort()})))}))}function _r(t,i){if(i)if(i instanceof Map)for(var r=l(i.keys()),n=r.next();!n.done;n=r.next())n=n.value,Object.defineProperty(this,n,{value:i.get(n),writable:!0,enumerable:!0});else for(r in i)Object.defineProperty(this,r,{value:i[r],writable:!0,enumerable:!0});this.defaultPrevented=this.cancelable=this.bubbles=!1,this.timeStamp=e.performance&&e.performance.now?e.performance.now():Date.now(),this.type=t,this.isTrusted=!1,this.target=this.currentTarget=null,this.g=!1}function vr(e){var t,i=new _r(e.type);for(t in e)Object.defineProperty(i,t,{value:e[t],writable:!0,enumerable:!0});return i}cr.prototype.abort=function(){return this.g=!0,this.i()},cr.prototype.finally=function(e){return this.promise.then((function(){return e(!0)}),(function(){return e(!1)})),this},cr.prototype.Y=function(e,t){function i(i){return function(o){if(n.g&&i)s.reject(a);else{var h=i?e:t;h?r=function(e,t,i){try{var r=e(t);return r&&r.promise&&r.abort?(i.resolve(r.promise),function(){return r.abort()}):(i.resolve(r),function(){return Promise.resolve(r).then((function(){}),(function(){}))})}catch(n){return i.reject(n),function(){return Promise.resolve()}}}(h,o,s):(i?s.resolve:s.reject)(o)}}}function r(){return s.reject(a),n.abort()}var n=this,s=new nt,a=new Me(2,7,7001);return this.promise.then(i(!0),i(!1)),new cr(s,(function(){return r()}))},j("shaka.util.AbortableOperation",cr),cr.prototype.chain=cr.prototype.Y,cr.prototype.finally=cr.prototype.finally,cr.all=mr,cr.prototype.abort=cr.prototype.abort,cr.notAbortable=fr,cr.completed=gr,cr.aborted=pr,cr.failed=dr,_r.prototype.preventDefault=function(){this.cancelable&&(this.defaultPrevented=!0)},_r.prototype.stopImmediatePropagation=function(){this.g=!0},_r.prototype.stopPropagation=function(){},j("shaka.util.FakeEvent",_r);var yr={Ig:"abrstatuschanged",Jg:"adaptation",Kg:"buffering",Lg:"downloadfailed",Mg:"downloadheadersreceived",Ng:"drmsessionupdate",Pg:"emsg",ah:"prft",Error:"error",Qg:"expirationupdated",Rg:"gapjumped",Tg:"loaded",Ug:"loading",Wg:"manifestparsed",Xg:"mediaqualitychanged",Metadata:"metadata",Zg:"onstatechange",$g:"onstateidle",bh:"ratechange",eh:"segmentappended",fh:"sessiondata",gh:"stalldetected",hh:"streaming",ih:"textchanged",jh:"texttrackvisibility",kh:"timelineregionadded",lh:"timelineregionenter",mh:"timelineregionexit",nh:"trackschanged",ph:"unloading",qh:"variantchanged"};function xr(){this.da=new ci,this.Wc=this}function br(e){var t=new Set;return function e(i){switch(typeof i){case"undefined":case"boolean":case"number":case"string":case"symbol":case"function":return i;default:if(!i||i.buffer&&i.buffer.constructor==ArrayBuffer)return i;if(t.has(i))return null;var r=i.constructor==Array;if(i.constructor!=Object&&!r)return null;t.add(i);var n,s=r?[]:{};for(n in i)s[n]=e(i[n]);return r&&(s.length=i.length),s}}(e)}function wr(e){var t,i={};for(t in e)i[t]=e[t];return i}function Tr(){this.g=[]}function Sr(e,t){e.g.push(t.finally((function(){ie(e.g,t)})))}function Ar(e,t,i){xr.call(this),this.i=!1,this.m=new Tr,this.g=new Set,this.h=new Set,this.l=e||null,this.j=t||null,this.s=i||null,this.o=!1}function Cr(e,t,i,r){i=i||Mr;var n=Pr[e];(!n||i>=n.priority)&&(Pr[e]={priority:i,jg:t,kg:void 0!==r&&r})}function Er(e,t,i){return{uris:e,method:"GET",body:null,headers:{},allowCrossSiteCredentials:!1,retryParameters:t,licenseRequestType:null,sessionId:null,drmInfo:null,initData:null,initDataType:null,streamDataCallback:void 0===i?null:i}}function Ir(e,t,i,r,n,s,a){e.o&&(i.uris[n]=i.uris[n].replace("http://","https://"));var o=new Oe(i.uris[n]),h=o.Ea,u=!1;h||(De(o,h=(h=location.protocol).slice(0,-1)),i.uris[n]=o.toString()),h=h.toLowerCase();var l=(h=Pr[h])?h.jg:null;if(!l)return dr(new Me(2,1,1e3,o));var c,d=h.kg,p=null,g=null,f=!1,m=!1;return fr(lr(r)).Y((function(){if(e.i)return pr();c=Date.now();var r=l(i.uris[n],i,t,(function(i,r,n){p&&p.stop(),g&&g.N(o/1e3),e.l&&t==kr&&(e.l(i,r),u=!0,a.g=n)}),(function(r){e.j&&e.j(r,i,t),m=!0}));if(!d)return r;var s=i.retryParameters.connectionTimeout;s&&(p=new ot((function(){f=!0,r.abort()}))).N(s/1e3);var o=i.retryParameters.stallTimeout;return o&&(g=new ot((function(){f=!0,r.abort()}))),r})).Y((function(r){p&&p.stop(),g&&g.stop(),null==r.timeMs&&(r.timeMs=Date.now()-c);var n={response:r,Yf:u};return!m&&e.j&&e.j(r.headers,i,t),n}),(function(o){if(p&&p.stop(),g&&g.stop(),e.s){var h=null,u=0;o instanceof Me&&(h=o,1001==o.code&&(u=o.data[1])),e.s(i,h,u,f)}if(e.i)return pr();if(f&&(o=new Me(1,1,1003,i.uris[n],t)),o instanceof Me){if(7001==o.code)throw o;if(1010==o.code)throw s;if(1==o.severity)return h=new _r("retry",h=(new Map).set("error",o)),e.dispatchEvent(h),n=(n+1)%i.uris.length,Ir(e,t,i,r,n,o,a)}throw o}))}function Rr(){this.g=0}function Lr(e,t,i){cr.call(this,e,t),this.h=i}xr.prototype.addEventListener=function(e,t){this.da&&this.da.push(e,t)},xr.prototype.removeEventListener=function(e,t){this.da&&this.da.remove(e,t)},xr.prototype.dispatchEvent=function(e){if(!this.da)return!0;var t=this.da.get(e.type)||[],i=this.da.get("All");for(i&&(t=t.concat(i)),i=(t=l(t)).next();!i.done;i=t.next()){i=i.value,e.target=this.Wc,e.currentTarget=this.Wc;try{i.handleEvent?i.handleEvent(e):i.call(this,e)}catch(r){}if(e.g)break}return e.defaultPrevented},xr.prototype.release=function(){this.da=null},Tr.prototype.destroy=function(){for(var e=[],t=l(this.g),i=t.next();!i.done;i=t.next())(i=i.value).promise.catch((function(){})),e.push(i.abort());return this.g=[],Promise.all(e)},_(Ar,xr),(n=Ar.prototype).je=function(e){this.o=e},n.lg=function(e){this.g.add(e)},n.Bg=function(e){this.g.delete(e)},n.rf=function(){this.g.clear()},n.mg=function(e){this.h.add(e)},n.Cg=function(e){this.h.delete(e)},n.tf=function(){this.h.clear()},n.destroy=function(){return this.i=!0,this.g.clear(),this.h.clear(),xr.prototype.release.call(this),this.m.destroy()},n.request=function(e,t){var i=this,r=new Rr;if(this.i){var n=Promise.reject(new Me(2,7,7001));return n.catch((function(){})),new Lr(n,(function(){return Promise.resolve()}),r)}t.method=t.method||"GET",t.headers=t.headers||{},t.retryParameters=t.retryParameters?br(t.retryParameters):{maxAttempts:2,baseDelay:1e3,backoffFactor:2,fuzzFactor:.5,timeout:3e4,stallTimeout:5e3,connectionTimeout:1e4},t.uris=br(t.uris),n=function(e,t,i){for(var r=gr(void 0),n={},s=(e=l(e.g)).next();!s.done;n={sd:n.sd},s=e.next())n.sd=s.value,r=r.Y(function(e){return function(){return i.body&&(i.body=Ie(i.body)),e.sd(t,i)}}(n));return r.Y(void 0,(function(e){if(e instanceof Me&&7001==e.code)throw e;throw new Me(2,1,1006,e)}))}(this,e,t);var s=n.Y((function(){return Ir(i,e,t,new ur(t.retryParameters,!1),0,null,r)})),a=s.Y((function(t){return function(e,t,i){for(var r=gr(void 0),n={},s=(e=l(e.h)).next();!s.done;n={td:n.td},s=e.next())n.td=s.value,r=r.Y(function(e){return function(){var r=i.response;return r.data&&(r.data=Ie(r.data)),e.td(t,r)}}(n));return r.Y((function(){return i}),(function(e){var t=2;if(e instanceof Me){if(7001==e.code)throw e;t=e.severity}throw new Me(t,1,1007,e)}))}(i,e,t)})),o=Date.now(),h=0;n.promise.then((function(){h=Date.now()-o}),(function(){}));var u=0;s.promise.then((function(){u=Date.now()}),(function(){}));var c=a.Y((function(t){var r=Date.now()-u,n=t.response;return n.timeMs+=h,n.timeMs+=r,t.Yf||!i.l||n.fromCache||e!=kr||i.l(n.timeMs,n.data.byteLength),n}),(function(e){throw e&&(e.severity=2),e}));return n=new Lr(c.promise,(function(){return c.abort()}),r),Sr(this.m,n),n},j("shaka.net.NetworkingEngine",Ar),Ar.prototype.request=Ar.prototype.request,Ar.prototype.destroy=Ar.prototype.destroy,Ar.makeRequest=Er,Ar.defaultRetryParameters=function(){return{maxAttempts:2,baseDelay:1e3,backoffFactor:2,fuzzFactor:.5,timeout:3e4,stallTimeout:5e3,connectionTimeout:1e4}},Ar.prototype.clearAllResponseFilters=Ar.prototype.tf,Ar.prototype.unregisterResponseFilter=Ar.prototype.Cg,Ar.prototype.registerResponseFilter=Ar.prototype.mg,Ar.prototype.clearAllRequestFilters=Ar.prototype.rf,Ar.prototype.unregisterRequestFilter=Ar.prototype.Bg,Ar.prototype.registerRequestFilter=Ar.prototype.lg,Ar.unregisterScheme=function(e){delete Pr[e]},Ar.registerScheme=Cr,Ar.prototype.setForceHTTPS=Ar.prototype.je,Ar.NumBytesRemainingClass=Rr,_(Lr,cr),Ar.PendingRequest=Lr;var kr=1;Ar.RequestType={MANIFEST:0,SEGMENT:kr,LICENSE:2,APP:3,TIMING:4,SERVER_CERTIFICATE:5,KEY:6};var Mr=3;Ar.PluginPriority={FALLBACK:1,PREFERRED:2,APPLICATION:Mr};var Pr={};function Or(e){this.g=!1,this.h=new nt,this.i=e}function Dr(e,t){if(e.g){if(t instanceof Me&&7003==t.code)throw t;throw new Me(2,7,7003,t)}}function Nr(){this.g=new ci}function Fr(e,t,i,r){this.target=e,this.type=t,this.listener=i,this.g=function(e,t){if(null==t)return!1;if("boolean"==typeof t)return t;var i=new Set(["passive","capture"]);return Object.keys(t).filter((function(e){return!i.has(e)})),function(e){var t=Ur;if(null==t){t=!1;try{var i={},r={get:function(){return t=!0,!1}};Object.defineProperty(i,"passive",r),Object.defineProperty(i,"capture",r),r=function(){},e.addEventListener("test",r,i),e.removeEventListener("test",r,i)}catch(n){t=!1}Ur=t}return t||!1}(e)?t:t.capture||!1}(e,r),this.target.addEventListener(t,i,this.g)}Or.prototype.destroy=function(){var e=this;return this.g?this.h:(this.g=!0,this.i().then((function(){e.h.resolve()}),(function(){e.h.resolve()})))},(n=Nr.prototype).release=function(){this.nb(),this.g=null},n.C=function(e,t,i,r){this.g&&(e=new Fr(e,t,i,r),this.g.push(t,e))},n.ma=function(e,t,i,r){var n=this;this.C(e,t,(function r(s){n.zc(e,t,r),i(s)}),r)},n.zc=function(e,t,i){if(this.g)for(var r=this.g.get(t)||[],n=(r=l(r)).next();!n.done;n=r.next())(n=n.value).target!=e||i!=n.listener&&i||(n.zc(),this.g.remove(t,n))},n.nb=function(){if(this.g){var e,t=this.g,i=[];for(e in t.g)i.push.apply(i,c(t.g[e]));for(i=(t=l(i)).next();!i.done;i=t.next())i.value.zc();this.g.g={}}},j("shaka.util.EventManager",Nr),Nr.prototype.removeAll=Nr.prototype.nb,Nr.prototype.unlisten=Nr.prototype.zc,Nr.prototype.listenOnce=Nr.prototype.ma,Nr.prototype.listen=Nr.prototype.C,Nr.prototype.release=Nr.prototype.release,Fr.prototype.zc=function(){this.target.removeEventListener(this.type,this.listener,this.g),this.listener=this.target=null,this.g=!1};var Ur=void 0;function zr(e,t){for(var i=[],r=(e=l(e)).next();!r.done;r=e.next())i.push(t(r.value));return i}function Br(e){for(var t=new Map,i=l(Object.keys(e)),r=i.next();!r.done;r=i.next())r=r.value,t.set(r,e[r]);return t}function jr(e){var t={};return e.forEach((function(e,i){t[i]=e})),t}function Hr(e,t){if(!e&&!t)return!0;if(e&&!t||t&&!e)return!1;if(e.size!=t.size)return!1;for(var i=(e=l(e)).next();!i.done;i=e.next()){var r=l(i.value);if(i=r.next().value,r=r.next().value,!t.has(i))return!1;if((i=t.get(i))!=r||null==i)return!1}return!0}function Vr(e,t){this.S=Le(e),this.h=t==Gr,this.g=0}function Wr(){return new Me(2,3,3e3)}(n=Vr.prototype).ha=function(){return this.g<this.S.byteLength},n.Z=function(){return this.g},n.Gf=function(){return this.S.byteLength},n.Ra=function(){try{var e=this.S.getUint8(this.g);return this.g+=1,e}catch(t){throw Wr()}},n.$d=function(){try{var e=this.S.getUint16(this.g,this.h);return this.g+=2,e}catch(t){throw Wr()}},n.K=function(){try{var e=this.S.getUint32(this.g,this.h);return this.g+=4,e}catch(t){throw Wr()}},n.Pe=function(){try{var e=this.S.getInt32(this.g,this.h);return this.g+=4,e}catch(t){throw Wr()}},n.$a=function(){try{if(this.h)var e=this.S.getUint32(this.g,!0),t=this.S.getUint32(this.g+4,!0);else t=this.S.getUint32(this.g,!1),e=this.S.getUint32(this.g+4,!1)}catch(i){throw Wr()}if(2097151<t)throw new Me(2,3,3001);return this.g+=8,t*Math.pow(2,32)+e},n.Za=function(e){if(this.g+e>this.S.byteLength)throw Wr();var t=Re(this.S,this.g,e);return this.g+=e,t},n.skip=function(e){if(this.g+e>this.S.byteLength)throw Wr();this.g+=e},n.sg=function(e){if(this.g<e)throw Wr();this.g-=e},n.seek=function(e){if(0>e||e>this.S.byteLength)throw Wr();this.g=e},n.sc=function(){for(var e=this.g;this.ha()&&0!=this.S.getUint8(this.g);)this.g+=1;return e=Re(this.S,e,this.g-e),this.g+=1,wt(e)},j("shaka.util.DataViewReader",Vr),Vr.prototype.readTerminatedString=Vr.prototype.sc,Vr.prototype.seek=Vr.prototype.seek,Vr.prototype.rewind=Vr.prototype.sg,Vr.prototype.skip=Vr.prototype.skip,Vr.prototype.readBytes=Vr.prototype.Za,Vr.prototype.readUint64=Vr.prototype.$a,Vr.prototype.readInt32=Vr.prototype.Pe,Vr.prototype.readUint32=Vr.prototype.K,Vr.prototype.readUint16=Vr.prototype.$d,Vr.prototype.readUint8=Vr.prototype.Ra,Vr.prototype.getLength=Vr.prototype.Gf,Vr.prototype.getPosition=Vr.prototype.Z,Vr.prototype.hasMoreData=Vr.prototype.ha;var Gr=1;function Xr(){this.i=[],this.h=[],this.g=!1}function qr(e){for(var t=Jr(e);e.reader.ha()&&!e.parser.g;)e.parser.qc(e.start+t,e.reader,e.partialOkay)}function Yr(e){for(var t=Jr(e),i=e.reader.K(),r=0;r<i&&(e.parser.qc(e.start+t,e.reader,e.partialOkay),!e.parser.g);r++);}function $r(e){var t=Jr(e);for(e.reader.skip(78);e.reader.ha()&&!e.parser.g;)e.parser.qc(e.start+t,e.reader,e.partialOkay)}function Kr(e){return function(t){e(t.reader.Za(t.reader.S.byteLength-t.reader.Z()))}}function Zr(e){for(var t=0,i=(e=l(e)).next();!i.done;i=e.next())t=t<<8|i.value.charCodeAt(0);return t}function Qr(e){return String.fromCharCode(e>>24&255,e>>16&255,e>>8&255,255&e)}function Jr(e){return 8+(e.has64BitSize?8:0)+(null!=e.flags?4:0)}Vr.Endianness={BIG_ENDIAN:0,LITTLE_ENDIAN:Gr},(n=Xr.prototype).box=function(e,t){return e=Zr(e),this.i[e]=en,this.h[e]=t,this},n.P=function(e,t){return e=Zr(e),this.i[e]=tn,this.h[e]=t,this},n.stop=function(){this.g=!0},n.parse=function(e,t,i){for(e=new Vr(e,0),this.g=!1;e.ha()&&!this.g;)this.qc(0,e,t,i)},n.qc=function(e,t,i,r){var n=t.Z();if(r&&n+8>t.S.byteLength)this.g=!0;else{var s=t.K(),a=t.K(),o=Qr(a),h=!1;switch(s){case 0:s=t.S.byteLength-n;break;case 1:if(r&&t.Z()+8>t.S.byteLength)return void(this.g=!0);s=t.$a(),h=!0}var u=this.h[a];if(u){var l=null,c=null;if(this.i[a]==tn){if(r&&t.Z()+4>t.S.byteLength)return void(this.g=!0);l=(c=t.K())>>>24,c&=16777215}a=n+s,i&&a>t.S.byteLength&&(a=t.S.byteLength),r&&a>t.S.byteLength?this.g=!0:(r=a-t.Z(),u({name:o,parser:this,partialOkay:i||!1,version:l,flags:c,reader:t=new Vr(t=0<r?t.Za(r):new Uint8Array(0),0),size:s,start:n+e,has64BitSize:h}))}else t.skip(Math.min(n+s-t.Z(),t.S.byteLength-t.Z()))}},j("shaka.util.Mp4Parser",Xr),Xr.headerSize=Jr,Xr.typeToString=Qr,Xr.allData=Kr,Xr.visualSampleEntry=$r,Xr.sampleDescription=Yr,Xr.children=qr,Xr.prototype.parseNext=Xr.prototype.qc,Xr.prototype.parse=Xr.prototype.parse,Xr.prototype.stop=Xr.prototype.stop,Xr.prototype.fullBox=Xr.prototype.P,Xr.prototype.box=Xr.prototype.box;var en=0,tn=1;function rn(e){var t=this;this.g=[],this.h=[],this.data=[],(new Xr).box("moov",qr).box("moof",qr).P("pssh",(function(e){if(!(1<e.version)){var i=Re(e.reader.S,-12,e.size);if(t.data.push(i),t.g.push(Pt(e.reader.Za(16))),0<e.version){i=e.reader.K();for(var r=0;r<i;r++){var n=Pt(e.reader.Za(16));t.h.push(n)}}}})).parse(e)}function nn(e,t,i,r){var n=e.length,s=t.length+16+n;0<r&&(s+=4+16*i.size);var a=new Uint8Array(s),o=Le(a),h=0;if(o.setUint32(h,s),h+=4,o.setUint32(h,1886614376),h+=4,1>r?o.setUint32(h,0):o.setUint32(h,16777216),h+=4,a.set(t,h),h+=t.length,0<r)for(o.setUint32(h,i.size),h+=4,i=(t=l(i)).next();!i.done;i=t.next())i=Mt(i.value),a.set(i,h),h+=i.length;return o.setUint32(h,n),a.set(e,h+4),a}function sn(e,t){return 1!=(e=on(e,t)).length?null:e[0]}function an(e,t,i){return 1!=(e=hn(e,t,i)).length?null:e[0]}function on(e,t){for(var i=[],r=(e=l(e.childNodes)).next();!r.done;r=e.next())(r=r.value)instanceof Element&&r.tagName==t&&i.push(r);return i}function hn(e,t,i){for(var r=[],n=(e=l(e.childNodes)).next();!n.done;n=e.next())(n=n.value)instanceof Element&&n.localName==i&&n.namespaceURI==t&&r.push(n);return r}function un(e,t,i){return e.hasAttributeNS(t,i)?e.getAttributeNS(t,i):null}function ln(e,t,i){for(var r=(t=l(t)).next();!r.done;r=t.next())if(r=r.value,e.hasAttributeNS(r,i))return e.getAttributeNS(r,i);return null}function cn(e){return Array.from(e.childNodes).every(dn)?e.textContent.trim():null}function dn(e){return e.nodeType==Node.TEXT_NODE||e.nodeType==Node.CDATA_SECTION_NODE}function pn(e,t,i,r){r=void 0===r?null:r;var n=null;return null!=(e=e.getAttribute(t))&&(n=i(e)),null==n?r:n}function gn(e){return e?(/^\d+-\d+-\d+T\d+:\d+:\d+(\.\d+)?$/.test(e)&&(e+="Z"),e=Date.parse(e),isNaN(e)?null:e/1e3):null}function fn(e){return e&&(e=RegExp("^P(?:([0-9]*)Y)?(?:([0-9]*)M)?(?:([0-9]*)D)?(?:T(?:([0-9]*)H)?(?:([0-9]*)M)?(?:([0-9.]*)S)?)?$").exec(e))?(e=31536e3*Number(e[1]||null)+2592e3*Number(e[2]||null)+86400*Number(e[3]||null)+3600*Number(e[4]||null)+60*Number(e[5]||null)+Number(e[6]||null),isFinite(e)?e:null):null}function mn(e){var t=/([0-9]+)-([0-9]+)/.exec(e);return t?(e=Number(t[1]),isFinite(e)?(t=Number(t[2]),isFinite(t)?{start:e,end:t}:null):null):null}function _n(e){return 0==(e=Number(e))%1?e:null}function vn(e){return 0==(e=Number(e))%1&&0<e?e:null}function yn(e){return 0==(e=Number(e))%1&&0<=e?e:null}function xn(e){return e=Number(e),isNaN(e)?null:e}function bn(e){var t,i=(t=e.match(/^(\d+)\/(\d+)$/))?Number(t[1])/Number(t[2]):Number(e);return isNaN(i)?null:i}function wn(e,t){var i=new DOMParser,r=Sn.value()(e);e=null;try{e=i.parseFromString(r,"text/xml")}catch(n){return null}if(!(i=e.documentElement)||i.getElementsByTagName("parsererror").length||i.tagName!=t)return null;for(t=document.createNodeIterator(e,NodeFilter.SHOW_ALL);e=t.nextNode();)if(e instanceof HTMLElement||e instanceof SVGElement)return null;return i}function Tn(e,t){try{return wn(wt(e),t)}catch(i){return null}}var Sn=new st((function(){if("undefined"!=typeof trustedTypes){var e=trustedTypes.createPolicy("shaka-player#xml",{createHTML:function(e){return e}});return function(t){return e.createHTML(t)}}return function(e){return e}}));function An(e,t){var i=this;t=void 0===t?1:t,this.D=e,this.G=new Set,this.l=this.u=null,this.da=this.W=!1,this.H=0,this.g=null,this.s=new Nr,this.i=new Map,this.B=[],this.o=new nt,this.h=null,this.m=function(t){i.o.reject(t),e.onError(t)},this.ea=new Map,this.ba=new Map,this.O=new ot((function(){return function(e){var t=e.ea,i=e.ba;i.clear(),t.forEach((function(e,t){return i.set(t,e)})),t=Array.from(i.values()),t.length&&t.every((function(e){return"expired"==e}))&&e.m(new Me(2,6,6014)),e.D.cd(jr(i))}(i)})),this.L=!1,this.J=[],this.M=!1,this.ca=new ot((function(){!function(e){e.i.forEach((function(t,i){var r=t.Vd,n=i.expiration;isNaN(n)&&(n=1/0),n!=r&&(e.D.onExpirationUpdated(i.sessionId,n),t.Vd=n)}))}(i)})).Ca(t),this.o.catch((function(){})),this.j=new Or((function(){return function(e){return P((function(t){switch(t.g){case 1:return e.s.release(),e.s=null,e.o.reject(),e.ca.stop(),e.ca=null,e.O.stop(),e.O=null,b(t,Un(e),2);case 2:if(!e.l){t.A(3);break}return T(t,4),b(t,e.l.setMediaKeys(null),6);case 6:A(t,5);break;case 4:C(t);case 5:e.l=null;case 3:e.g=null,e.G.clear(),e.u=null,e.B=[],e.h=null,e.m=function(){},e.D=null,e.V=!1,e.F=null,w(t)}}))}(i)})),this.V=!1,this.F=null}function Cn(e,t,i){return e.B=i,e.L=0<i.length,En(e,t)}function En(t,i){var r,n,s,a,o,h,u,c,d,p,g,f;return P((function(m){if(1==m.g){if(r=function(t){if(t=Br(t.h.clearKeys),0==t.size)return null;var i=[],r=[];t.forEach((function(e,t){var n=t;22!=n.length&&(n=Lt(Mt(t),!1)),22!=(t=e).length&&(t=Lt(Mt(e),!1)),e={kty:"oct",kid:n,k:t},i.push(e),r.push(e.kid)})),t=JSON.stringify({keys:i});var n=JSON.stringify({kids:r});return n=[{initData:Re(At(n)),initDataType:"keyids"}],{keySystem:"org.w3.clearkey",licenseServerUri:"data:application/json;base64,"+e.btoa(t),distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",serverCertificate:null,serverCertificateUri:"",sessionType:"",initData:n,keyIds:new Set(r)}}(t))for(n=l(i),s=n.next();!s.done;s=n.next())(a=s.value).video&&(a.video.drmInfos=[r]),a.audio&&(a.audio.drmInfos=[r]);for((o=i.some((function(e){return!!(e.video&&e.video.drmInfos.length||e.audio&&e.audio.drmInfos.length)})))||(h=Br(t.h.servers),function(e,t){var i=[];for(t.forEach((function(e,t){i.push({keySystem:t,licenseServerUri:e,distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",serverCertificate:null,serverCertificateUri:"",initData:[],keyIds:new Set})})),e=l(e),t=e.next();!t.done;t=e.next())(t=t.value).video&&(t.video.drmInfos=i),t.audio&&(t.audio.drmInfos=i)}(i,h)),u=l(i),s=u.next();!s.done;s=u.next())for(c=s.value,d=Bn(c),p=l(d),g=p.next();!g.done;g=p.next())Vn(g.value,Br(t.h.servers),Br(t.h.advanced||{}),t.h.keySystemsMapping);return b(m,yi(i,t.L,t.V),2)}return o||Object.keys(t.h.servers).length?(f=On(t,void 0,i),m.return(o?f:f.catch((function(){})))):(t.W=!0,m.return(Promise.resolve()))}))}function In(e){var t;return P((function(i){switch(i.g){case 1:if(e.l.mediaKeys)return i.return();if(!e.F){i.A(2);break}return b(i,e.F,3);case 3:return Dr(e.j),i.return();case 2:return T(i,4),e.F=e.l.setMediaKeys(e.u),b(i,e.F,6);case 6:A(i,5);break;case 4:t=C(i),e.m(new Me(2,6,6003,t.message));case 5:Dr(e.j),w(i)}}))}function Rn(e){var t,i;return P((function(r){switch(r.g){case 1:if(!e.u||!e.g)return r.return();if(!e.g.serverCertificateUri||e.g.serverCertificate&&e.g.serverCertificate.length){r.A(2);break}return t=Er([e.g.serverCertificateUri],e.h.retryParameters),T(r,3),b(r,e.D.kb.request(5,t).promise,5);case 5:i=r.h,e.g.serverCertificate=Re(i.data),A(r,4);break;case 3:throw new Me(2,6,6017,C(r));case 4:if(e.j.g)return r.return();case 2:return e.g.serverCertificate&&e.g.serverCertificate.length?(T(r,6),b(r,e.u.setServerCertificate(e.g.serverCertificate),8)):r.return();case 8:A(r,0);break;case 6:throw new Me(2,6,6004,C(r).message)}}))}function Ln(e){for(var t=(e.g?e.g.initData:[])||[],i=l(t),r=i.next();!r.done;r=i.next())kn(e,(r=r.value).initDataType,r.initData);for(r=(i=l(e.B)).next();!r.done;r=i.next())Dn(e,r.value);return t.length||e.B.length||e.o.resolve(),e.o}function kn(e,t,i){if(i.length){for(var r=e.i.values(),n=(r=l(r)).next();!n.done;n=r.next())if(Ce(i,n.value.initData)&&!_t("Tizen 2"))return;0<e.i.size&&jn(e)&&(e.o.resolve(),e.o=new nt,e.o.catch((function(){}))),function(e,t,i,r){try{var n=e.u.createSession(r)}catch(s){return void e.m(new Me(2,6,6005,s.message))}e.s.C(n,"message",(function(t){e.l&&e.h.delayLicenseRequestUntilPlayed&&e.l.paused&&!e.M?e.J.push(t):Nn(e,t)})),e.s.C(n,"keystatuseschange",(function(t){return Fn(e,t)})),e.i.set(n,{initData:i,initDataType:t,loaded:!1,Vd:1/0,Ja:null,type:r});try{i=e.h.initDataTransform(i,t,e.g)}catch(s){return t=s,s instanceof Me||(t=new Me(2,6,6016,s)),void e.m(t)}e.h.logLicenseExchange&&Lt(i),n.generateRequest(t,i).catch((function(t){if(!e.j.g){e.i.delete(n);var i=t.errorCode;if(i&&i.systemCode){var r=i.systemCode;0>r&&(r+=Math.pow(2,32)),r="0x"+r.toString(16)}e.m(new Me(2,6,6006,t.message,t,r))}}))}(e,t,i,e.g.sessionType)}}function Mn(e){return!!e&&!!e.match(/^com\.(microsoft|chromecast)\.playready/)}function Pn(e){return e=zr(e=e.i.keys(),(function(e){return e.sessionId})),Array.from(e)}function On(e,t,i){var r,n,s,a,o,h,u,c,d,p,g,f,m;return P((function(_){switch(_.g){case 1:if(r=new Map,i.length){n=function(e,t,i){for(var r=l(t),n=r.next();!n.done;n=r.next()){var s=l(Bn(n.value));for(n=s.next();!n.done;n=s.next())n=n.value,i.has(n.keySystem)||i.set(n.keySystem,[]),i.get(n.keySystem).push(n)}if(1==i.size&&i.has(""))throw new Me(2,6,6e3);for(r={},e=l(e.h.preferredKeySystems),n=e.next();!n.done;r={qd:r.qd},n=e.next())for(r.qd=n.value,s=l(t),n=s.next();!n.done;n=s.next())if(n=n.value.decodingInfos.find(function(e){return function(t){return t.supported&&null!=t.keySystemAccess&&t.keySystemAccess.keySystem==e.qd}}(r)))return n.keySystemAccess;for(e=l([!0,!1]),n=e.next();!n.done;n=e.next())for(r=n.value,s=l(t),n=s.next();!n.done;n=s.next()){var a=l(n.value.decodingInfos);for(n=a.next();!n.done;n=a.next()){var o=n.value;if(o.supported&&o.keySystemAccess){var h=l(n=i.get(o.keySystemAccess.keySystem));for(n=h.next();!n.done;n=h.next())if(!!n.value.licenseServerUri==r)return o.keySystemAccess}}}return null}(e,i,r),_.A(2);break}return b(_,function(e,t){var i,r,n,s,a,o,h,u,c,d,p,g,f,m,_;return P((function(v){switch(v.g){case 1:if(1==t.size&&t.has(""))throw new Me(2,6,6e3);for(r=l(t.values()),n=r.next();!n.done;n=r.next())0==(s=n.value).audioCapabilities.length&&delete s.audioCapabilities,0==s.videoCapabilities.length&&delete s.videoCapabilities;a=l(e.h.preferredKeySystems),o=a.next();case 2:if(o.done){v.A(4);break}if(h=o.value,!t.has(h)){v.A(3);break}return u=t.get(h),T(v,6),b(v,navigator.requestMediaKeySystemAccess(h,[u]),8);case 8:return i=v.h,v.return(i);case 6:C(v);case 7:Dr(e.j);case 3:o=a.next(),v.A(2);break;case 4:c=l([!0,!1]),d=c.next();case 9:if(d.done){v.A(11);break}p=d.value,g=l(t.keys()),o=g.next();case 12:if(o.done){d=c.next(),v.A(9);break}if(f=o.value,m=t.get(f),_=m.drmInfos.some((function(e){return!!e.licenseServerUri})),_!=p){v.A(13);break}return T(v,15),b(v,navigator.requestMediaKeySystemAccess(f,[m]),17);case 17:return i=v.h,v.return(i);case 15:C(v);case 16:Dr(e.j);case 13:o=g.next(),v.A(12);break;case 11:return v.return(i)}}))}(e,t),3);case 3:n=_.h;case 2:if(!(s=n))throw new Me(2,6,6001);for(Dr(e.j),T(_,4),e.G.clear(),a=s.getConfiguration(),o=a.audioCapabilities||[],h=a.videoCapabilities||[],u=l(o),c=u.next();!c.done;c=u.next())d=c.value,e.G.add(d.contentType.toLowerCase());for(p=l(h),c=p.next();!c.done;c=p.next())g=c.value,e.G.add(g.contentType.toLowerCase());if(i.length){var v=s.keySystem,y=r.get(s.keySystem),x=[],w=[],S=[],E=[],I=new Set;Hn(y,x,S,w,E,I);var R=e.L?"persistent-license":"temporary";for(v={keySystem:v,licenseServerUri:x[0],distinctiveIdentifierRequired:y[0].distinctiveIdentifierRequired,persistentStateRequired:y[0].persistentStateRequired,sessionType:y[0].sessionType||R,audioRobustness:y[0].audioRobustness||"",videoRobustness:y[0].videoRobustness||"",serverCertificate:S[0],serverCertificateUri:w[0],initData:E,keyIds:I},x=(y=l(y)).next();!x.done;x=y.next())(x=x.value).distinctiveIdentifierRequired&&(v.distinctiveIdentifierRequired=x.distinctiveIdentifierRequired),x.persistentStateRequired&&(v.persistentStateRequired=x.persistentStateRequired);y=v}else y=s.keySystem,v=t.get(s.keySystem),x=[],w=[],S=[],E=[],I=new Set,Hn(v.drmInfos,x,S,w,E,I),y={keySystem:y,licenseServerUri:x[0],distinctiveIdentifierRequired:"required"==v.distinctiveIdentifier,persistentStateRequired:"required"==v.persistentState,sessionType:v.sessionTypes[0]||"temporary",audioRobustness:(v.audioCapabilities?v.audioCapabilities[0].robustness:"")||"",videoRobustness:(v.videoCapabilities?v.videoCapabilities[0].robustness:"")||"",serverCertificate:S[0],serverCertificateUri:w[0],initData:E,keyIds:I};if(e.g=y,!e.g.licenseServerUri)throw new Me(2,6,6012,e.g.keySystem);return b(_,s.createMediaKeys(),6);case 6:return f=_.h,Dr(e.j),e.u=f,e.W=!0,b(_,Rn(e),7);case 7:Dr(e.j),A(_,0);break;case 4:if(m=C(_),Dr(e.j,m),e.g=null,e.G.clear(),m instanceof Me)throw m;throw new Me(2,6,6002,m.message)}}))}function Dn(e,t){var i,n,s,a,o;return P((function(h){switch(h.g){case 1:try{i=e.u.createSession("persistent-license")}catch(r){return n=new Me(2,6,6005,r.message),e.m(n),h.return(Promise.reject(n))}return e.s.C(i,"message",(function(t){e.l&&e.h.delayLicenseRequestUntilPlayed&&e.l.paused&&!e.M?e.J.push(t):Nn(e,t)})),e.s.C(i,"keystatuseschange",(function(t){return Fn(e,t)})),s={initData:null,initDataType:null,loaded:!1,Vd:1/0,Ja:null,type:"persistent-license"},e.i.set(i,s),T(h,2),b(h,i.load(t),4);case 4:return a=h.h,Dr(e.j),a?(s.loaded=!0,jn(e)&&e.o.resolve(),h.return(i)):(e.i.delete(i),e.m(new Me(2,6,6013)),h.return(Promise.resolve()));case 2:o=C(h),Dr(e.j,o),e.i.delete(i),e.m(new Me(2,6,6005,o.message));case 3:return h.return(Promise.resolve())}}))}function Nn(e,t){var i,r,n,s,a,o,h,u,c,d,p,g;P((function(f){switch(f.g){case 1:return i=t.target,e.h.logLicenseExchange&&Lt(t.message),r=e.i.get(i),n=e.g.licenseServerUri,s=e.h.advanced[e.g.keySystem],"individualization-request"==t.messageType&&s&&s.individualizationServer&&(n=s.individualizationServer),(a=Er([n],e.h.retryParameters)).body=t.message,a.method="POST",a.licenseRequestType=t.messageType,a.sessionId=i.sessionId,a.drmInfo=e.g,r&&(a.initData=r.initData,a.initDataType=r.initDataType),Mn(e.g.keySystem)&&function(e){var t=Tt(e.body,!0,!0);if(t.includes("PlayReadyKeyMessage")){for(var i=l((t=wn(t,"PlayReadyKeyMessage")).getElementsByTagName("HttpHeader")),r=i.next();!r.done;r=i.next())r=r.value,e.headers[r.getElementsByTagName("name")[0].textContent]=r.getElementsByTagName("value")[0].textContent;e.body=kt(t.getElementsByTagName("Challenge")[0].textContent)}else e.headers["Content-Type"]="text/xml; charset=utf-8"}(a),o=Date.now(),T(f,2),b(f,e.D.kb.request(2,a).promise,4);case 4:h=f.h,A(f,3);break;case 2:return u=C(f),c=new Me(2,6,6007,u),e.m(c),r&&r.Ja&&r.Ja.reject(c),f.return();case 3:return e.j.g?f.return():(e.H+=(Date.now()-o)/1e3,e.h.logLicenseExchange&&Lt(h.data),T(f,5),b(f,i.update(h.data),7));case 7:A(f,6);break;case 5:return d=C(f),p=new Me(2,6,6008,d.message),e.m(p),r&&r.Ja&&r.Ja.reject(p),f.return();case 6:if(e.j.g)return f.return();g=new _r("drmsessionupdate"),e.D.onEvent(g),r&&(r.Ja&&r.Ja.resolve(),new ot((function(){r.loaded=!0,jn(e)&&e.o.resolve()})).N(Gn)),w(f)}}))}function Fn(e,t){t=t.target;var i=e.i.get(t),r=!1;t.keyStatuses.forEach((function(t,n){if("string"==typeof n){var s=n;n=t,t=s}if(Mn(e.g.keySystem)&&16==n.byteLength&&(lt()||ft())){var a=(s=Le(n)).getUint32(0,!0),o=s.getUint16(4,!0),h=s.getUint16(6,!0);s.setUint32(0,a,!1),s.setUint16(4,o,!1),s.setUint16(6,h,!1)}"status-pending"!=t&&(i.loaded=!0),"expired"==t&&(r=!0),n=Pt(n).slice(0,32),e.ea.set(n,t)}));var n=t.expiration-Date.now();(0>n||r&&1e3>n)&&i&&!i.Ja&&(e.i.delete(t),t.close().catch((function(){}))),jn(e)&&(e.o.resolve(),e.O.N(Xn))}function Un(e){var t;return P((function(i){return t=Array.from(e.i.entries()),e.i.clear(),b(i,Promise.all(t.map((function(t){var i=(t=l(t)).next().value,r=t.next().value;return P((function(t){return 1==t.g?(T(t,2),e.da||e.B.includes(i.sessionId)||"persistent-license"!==r.type?b(t,function(e){var t;return P((function(i){return 1==i.g?(t=new Promise((function(e,t){new ot(t).N(Wn)})),T(i,2),b(i,Promise.race([Promise.all([e.close(),e.closed]),t]),4)):2!=i.g?A(i,0):(C(i),void w(i))}))}(i),5):b(t,i.remove(),5)):2!=t.g?A(t,0):(C(t),void w(t))}))}))),0)}))}function zn(e,t){if(!e.length)return t;if(!t.length)return e;for(var i=[],r=(e=l(e)).next();!r.done;r=e.next()){r=r.value;for(var n={},s=l(t),a=s.next();!a.done;n={Da:n.Da},a=s.next())if(a=a.value,r.keySystem==a.keySystem){n.Da=[],n.Da=n.Da.concat(r.initData||[]),n.Da=n.Da.concat(a.initData||[]),n.Da=n.Da.filter(function(e){return function(t,i){return void 0===t.keyId||i===e.Da.findIndex((function(e){return e.keyId===t.keyId}))}}(n)),s=r.keyIds&&a.keyIds?new Set([].concat(c(r.keyIds),c(a.keyIds))):r.keyIds||a.keyIds,i.push({keySystem:r.keySystem,licenseServerUri:r.licenseServerUri||a.licenseServerUri,distinctiveIdentifierRequired:r.distinctiveIdentifierRequired||a.distinctiveIdentifierRequired,persistentStateRequired:r.persistentStateRequired||a.persistentStateRequired,videoRobustness:r.videoRobustness||a.videoRobustness,audioRobustness:r.audioRobustness||a.audioRobustness,serverCertificate:r.serverCertificate||a.serverCertificate,serverCertificateUri:r.serverCertificateUri||a.serverCertificateUri,initData:n.Da,keyIds:s});break}}return i}function Bn(e){return(e.video?e.video.drmInfos:[]).concat(e.audio?e.audio.drmInfos:[])}function jn(e){return function(e,t){for(var i=(e=l(e)).next();!i.done;i=e.next())if(!t(i.value))return!1;return!0}(e=e.i.values(),(function(e){return e.loaded}))}function Hn(e,t,i,r,n,s){for(var a={},o=(e=l(e)).next();!o.done;a={oa:a.oa},o=e.next()){if(a.oa=o.value,t.includes(a.oa.licenseServerUri)||t.push(a.oa.licenseServerUri),r.includes(a.oa.serverCertificateUri)||r.push(a.oa.serverCertificateUri),a.oa.serverCertificate&&(i.some(function(e){return function(t){return Ce(t,e.oa.serverCertificate)}}(a))||i.push(a.oa.serverCertificate)),a.oa.initData){o={};for(var h=l(a.oa.initData),u=h.next();!u.done;o={Dc:o.Dc},u=h.next())o.Dc=u.value,n.some(function(e){return function(t){var i=e.Dc;return!(!t.keyId||t.keyId!=i.keyId)||t.initDataType==i.initDataType&&Ce(t.initData,i.initData)}}(o))||n.push(o.Dc)}if(a.oa.keyIds)for(h=(o=l(a.oa.keyIds)).next();!h.done;h=o.next())s.add(h.value)}}function Vn(t,i,r,n){var s=t.keySystem;!s||"org.w3.clearkey"==s&&t.licenseServerUri||(i.size&&(i=i.get(s)||"",t.licenseServerUri=i),t.keyIds||(t.keyIds=new Set),(r=r.get(s))&&(t.distinctiveIdentifierRequired||(t.distinctiveIdentifierRequired=r.distinctiveIdentifierRequired),t.persistentStateRequired||(t.persistentStateRequired=r.persistentStateRequired),t.videoRobustness||(t.videoRobustness=r.videoRobustness),t.audioRobustness||(t.audioRobustness=r.audioRobustness),t.serverCertificate||(t.serverCertificate=r.serverCertificate),r.sessionType&&(t.sessionType=r.sessionType),t.serverCertificateUri||(t.serverCertificateUri=r.serverCertificateUri)),n[s]&&(t.keySystem=n[s]),e.cast&&e.cast.__platform__&&"com.microsoft.playready"==s&&(t.keySystem="com.chromecast.playready"))}(n=An.prototype).destroy=function(){return this.j.destroy()},n.configure=function(e){this.h=e},n.Yb=function(e){var t,i=this;return P((function(r){if(1==r.g)return i.u?(i.l=e,i.s.ma(i.l,"play",(function(){for(var e=l(i.J),t=e.next();!t.done;t=e.next())Nn(i,t.value);i.M=!0,i.J=[]})),"webkitCurrentPlaybackTargetIsWireless"in i.l&&i.s.C(i.l,"webkitcurrentplaybacktargetiswirelesschanged",(function(){return Un(i)})),(t=i.g?i.g.initData.find((function(e){return 0<e.initData.length})):null)||"com.apple.fps"!==i.g.keySystem||i.B.length?b(r,In(i),2):r.A(2)):(i.s.ma(e,"encrypted",(function(){i.m(new Me(2,6,6010))})),r.return());Ln(i),t||i.B.length||i.h.parseInbandPsshEnabled||i.s.C(i.l,"encrypted",(function(e){return function(e,t){return P((function(i){if(1==i.g)return b(i,In(e),2);kn(e,t.initDataType,Re(t.initData)),w(i)}))}(i,e)})),w(r)}))},n.ic=function(){for(var e=1/0,t=this.i.keys(),i=(t=l(t)).next();!i.done;i=t.next())i=i.value,isNaN(i.expiration)||(e=Math.min(e,i.expiration));return e},n.Qc=function(){return jr(this.ba)};var Wn=1,Gn=5,Xn=.5,qn=new st((function(){return Ie(new Uint8Array([0]))}));function Yn(){}function $n(e,t,i,r){var n,s,a,o;return P((function(h){if(1==h.g)return r&&(n=Qn[r.toLowerCase()])?h.return(n):(s=Zn(e))&&(a=Jn[s])?h.return(a):r?h.A(2):b(h,Kn(e,t,i),3);if(2!=h.g&&(r=h.h)&&(o=Qn[r]))return h.return(o);throw new Me(2,4,4e3,e)}))}function Kn(e,t,i){var r,n,s;return P((function(a){return 1==a.g?((r=Er([e],i)).method="HEAD",b(a,t.request(0,r).promise,2)):(n=a.h,s=n.headers["content-type"],a.return(s?s.toLowerCase().split(";").shift():""))}))}function Zn(e){return 1==(e=new Oe(e).qa.split("/").pop().split(".")).length?"":e.pop().toLowerCase()}j("shaka.media.ManifestParser",Yn),Yn.unregisterParserByMime=function(e){delete Qn[e]},Yn.registerParserByMime=function(e,t){Qn[e]=t},Yn.registerParserByExtension=function(e,t){Jn[e]=t};var Qn={},Jn={};function es(e,t,i,r,n){var s=is.value(),a=e.subarray(i.start,i.start+i.size),o=Le(a),h=new Uint8Array(i.size+s.byteLength);for(h.set(a,0),(a=Le(h)).setUint32(4,n),h.set(s,i.size),n=o.getUint32(4),a.setUint32(i.size+16,n),ts(h,0,h.byteLength),n=new Uint8Array(e.byteLength+h.byteLength),i=ct()?i.start:i.start+i.size,s=e.subarray(i),n.set(e.subarray(0,i)),n.set(h,i),n.set(s,i+h.byteLength),r=(e=l(r)).next();!r.done;r=e.next())ts(n,(r=r.value).start,r.size+h.byteLength);return h=Le(n,t.start),t=Jr(t),e=h.getUint32(t),h.setUint32(t,e+1),n}function ts(e,t,i){0!=(t=(e=Le(e,t)).getUint32(0))&&(1==t?(e.setUint32(8,i>>32),e.setUint32(12,4294967295&i)):e.setUint32(0,i))}var is=new st((function(){return new Uint8Array([0,0,0,80,115,105,110,102,0,0,0,12,102,114,109,97,0,0,0,0,0,0,0,20,115,99,104,109,0,0,0,0,99,101,110,99,0,1,0,0,0,0,0,40,115,99,104,105,0,0,0,32,116,101,110,99,0,0,0,0,0,0,1,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0])}));function rs(e,t,i,r,n){if(r>=n)return null;for(var s=-1,a=-1,o=0;o<i.length;o++)if(i[o].some((function(e){return null!=e&&""!=e.g.trim()}))){s=o;break}for(o=i.length-1;0<=o;o--)if(i[o].some((function(e){return null!=e&&""!=e.g.trim()}))){a=o;break}if(-1===s||-1===a)return null;for(var h=o=!1,u="white",l="black",c=ns(r,n,o,h,u,l);s<=a;s++){for(var d=i[s],p=-1,g=-1,f=0;f<d.length;f++)if(null!=d[f]&&""!==d[f].g.trim()){p=f;break}for(f=d.length-1;0<=f;f--)if(null!=d[f]&&""!==d[f].g.trim()){g=f;break}if(-1===p||-1===g)d=ss(r,n),e.nestedCues.push(d);else{for(;p<=g;p++)if(f=d[p]){var m=f.l,_=f.i,v=f.j,y=f.h;m==o&&_==h&&v==u&&y==l||(c.payload&&e.nestedCues.push(c),c=ns(r,n,m,_,v,y),o=m,h=_,u=v,l=y),c.payload+=f.g}else c.payload+=" ";c.payload&&e.nestedCues.push(c),s!==a&&(c=ss(r,n),e.nestedCues.push(c)),c=ns(r,n,o,h,u,l)}}return e.nestedCues.length?{cue:e,stream:t}:null}function ns(e,t,i,r,n,s){return e=new se(e,t,""),i&&e.textDecoration.push("underline"),r&&(e.fontStyle="italic"),e.color=n,e.backgroundColor=s,e}function ss(e,t){return(e=new se(e,t,"")).lineBreak=!0,e}function as(e,t,i,r,n){this.g=e,this.l=t,this.i=i,this.h=r,this.j=n}function os(e,t){this.i=[],this.g=1,this.h=0,this.u=e,this.s=t,this.j=this.m=!1,this.l="white",this.o="black",us(this)}function hs(e,t,i){return rs(new se(t,i,""),"CC"+(e.u<<1|e.s+1),e.i,t,i)}function us(e){ds(e,0,15),e.g=1}function ls(e,t,i){if(!(32>i||127<i)){var r="";switch(t){case ps:r=_s.has(i)?_s.get(i):String.fromCharCode(i);break;case gs:r=vs.get(i);break;case fs:e.i[e.g].pop(),r=ys.get(i);break;case ms:e.i[e.g].pop(),r=xs.get(i)}r&&e.i[e.g].push(new as(r,e.m,e.j,e.o,e.l))}}function cs(e,t,i,r){if(!(0>i||0>t))if(t>=i)for(--r;0<=r;r--)e.i[t+r]=e.i[i+r].map((function(e){return e}));else for(var n=0;n<r;n++)e.i[t+n]=e.i[i+n].map((function(e){return e}))}function ds(e,t,i){for(var r=0;r<=i;r++)e.i[t+r]=[]}var ps=0,gs=1,fs=2,ms=3,_s=new Map([[39,"’"],[42,"á"],[92,"é"],[92,"é"],[94,"í"],[95,"ó"],[96,"ú"],[123,"ç"],[124,"÷"],[125,"Ñ"],[126,"ñ"],[127,"█"]]),vs=new Map([[48,"®"],[49,"°"],[50,"½"],[51,"¿"],[52,"™"],[53,"¢"],[54,"£"],[55,"♪"],[56,"à"],[57,"⠀"],[58,"è"],[59,"â"],[60,"ê"],[61,"î"],[62,"ô"],[63,"û"]]),ys=new Map([[32,"Á"],[33,"É"],[34,"Ó"],[35,"Ú"],[36,"Ü"],[37,"ü"],[38,"‘"],[39,"¡"],[40,"*"],[41,"'"],[42,"─"],[43,"©"],[44,"℠"],[45,"·"],[46,"“"],[47,"”"],[48,"À"],[49,"Â"],[50,"Ç"],[51,"È"],[52,"Ê"],[53,"Ë"],[54,"ë"],[55,"Î"],[56,"Ï"],[57,"ï"],[58,"Ô"],[59,"Ù"],[60,"ù"],[61,"Û"],[62,"«"],[63,"»"]]),xs=new Map([[32,"Ã"],[33,"ã"],[34,"Í"],[35,"Ì"],[36,"ì"],[37,"Ò"],[38,"ò"],[39,"Õ"],[40,"õ"],[41,"{"],[42,"}"],[43,"\\"],[44,"^"],[45,"_"],[46,"|"],[47,"~"],[48,"Ä"],[49,"ä"],[50,"Ö"],[51,"ö"],[52,"ß"],[53,"¥"],[54,"¤"],[55,"│"],[56,"Å"],[57,"å"],[58,"Ø"],[59,"ø"],[60,"┌"],[61,"┐"],[62,"└"],[63,"┘"]]);function bs(e,t){this.h=As,this.o=new os(e,t),this.i=new os(e,t),this.l=new os(e,t),this.g=this.i,this.j=0,this.m=null}function ws(e,t,i){e.g=e.i;var r=e.g,n=null;return e.h!==Es&&e.h!==Is&&(n=hs(r,e.j,i),(i=e.i).g=0<i.h?i.h:0,ds(i,0,15),(i=e.l).g=0<i.h?i.h:0,ds(i,0,15),r.g=15),e.h=Es,r.h=t,n}function Ts(e){e.h=Cs,e.g=e.l,e.g.h=0}function Ss(e){Y("Cea608DataChannel","CEA-608 text mode entered, but is unsupported"),e.g=e.o,e.h=Is}var As=0,Cs=1,Es=3,Is=4,Rs="black green blue cyan red yellow magenta black".split(" "),Ls="white green blue cyan red yellow magenta white_italics".split(" ");function ks(){this.l=!1,this.B=this.F=0,this.D=zs,this.i=[],this.g=this.h=this.j=0,this.u=this.o=!1,this.s="white",this.m="black",Ms(this)}function Ms(e){e.i=[];for(var t=0;16>t;t++)e.i.push(Ps())}function Ps(){for(var e=[],t=0;42>t;t++)e.push(null);return e}function Os(e,t){Ds(e)&&(e.i[e.h][e.g]=new as(t,e.u,e.o,e.m,e.s),e.g++)}function Ds(e){var t=e.g<e.B&&0<=e.g;return e.h<e.F&&0<=e.h&&t}function Ns(e,t,i){var r=new se(e.j,t,"");return r.textAlign=e.D===Fs?"left":e.D===Us?"right":he,(i=rs(r,"svc"+i,e.i,e.j,t))&&(e.j=t),i}ks.prototype.isVisible=function(){return this.l};var Fs=0,Us=1,zs=2;function Bs(){this.i=[],this.h=null,this.g=0}function js(e,t){3===t.type?(e.g=2*(63&t.value)-1,e.h=[]):e.h&&(0<e.g&&(e.h.push(t),e.g--),0===e.g&&(e.i.push(new Hs(e.h)),e.h=null,e.g=0))}function Hs(e){this.g=0,this.h=e}function Vs(e){if(!e.ha())throw new Me(2,2,3e3);return e.h[e.g++]}function Ws(e){this.i=e,this.h=[null,null,null,null,null,null,null,null],this.g=null}function Gs(e,t,i,r){if(128<=i&&135>=i)r=7&i,e.h[r]&&(e.g=e.h[r]);else{if(136===i){i=Vs(t).value,t=null;for(var n=(i=l(Xs(e,i))).next();!n.done;n=i.next())(n=e.h[n.value]).isVisible()&&(t=Ns(n,r,e.i)),Ms(n);return t}if(137===i)for(i=(t=l(Xs(e,t=Vs(t).value))).next();!i.done;i=t.next())(i=e.h[i.value]).isVisible()||(i.j=r),i.l=!0;else{if(138===i){for(i=Vs(t).value,t=null,n=(i=l(Xs(e,i))).next();!n.done;n=i.next())(n=e.h[n.value]).isVisible()&&(t=Ns(n,r,e.i)),n.l=!1;return t}if(139===i){for(i=Vs(t).value,t=null,n=(i=l(Xs(e,i))).next();!n.done;n=i.next())(n=e.h[n.value]).isVisible()?t=Ns(n,r,e.i):n.j=r,n.l=!n.l;return t}if(140===i)return qs(e,t=Vs(t).value,r);if(143===i)return r=qs(e,255,r),Ys(e),r;if(144===i)t.skip(1),r=Vs(t).value,e.g&&(e.g.o=0<(128&r),e.g.u=0<(64&r));else if(145===i)r=Vs(t).value,i=Vs(t).value,t.skip(1),e.g&&(t=$s((48&i)>>4,(12&i)>>2,3&i),e.g.s=$s((48&r)>>4,(12&r)>>2,3&r),e.g.m=t);else if(146===i)r=Vs(t).value,t=Vs(t).value,e.g&&((e=e.g).h=15&r,e.g=63&t);else if(151===i)t.skip(1),t.skip(1),r=Vs(t).value,t.skip(1),e.g&&(e.g.D=3&r);else if(152<=i&&159>=i){if(i=(15&i)-8,!(n=null!==e.h[i])){var s=new ks;s.j=r,e.h[i]=s}r=Vs(t).value,Vs(t),Vs(t),s=Vs(t).value;var a=Vs(t).value;t=Vs(t).value,n&&0==(7&t)||((t=e.h[i]).h=0,t.g=0,t.u=!1,t.o=!1,t.s="white",t.m="black"),(t=e.h[i]).l=0<(32&r),t.F=1+(15&s),t.B=1+(63&a),e.g=e.h[i]}}}return null}function Xs(e,t){for(var i=[],r=0;8>r;r++)1==(1&t)&&e.h[r]&&i.push(r),t>>=1;return i}function qs(e,t,i){for(var r=null,n=(t=l(Xs(e,t))).next();!n.done;n=t.next()){n=n.value;var s=e.h[n];s.isVisible()&&(r=Ns(s,i,e.i)),e.h[n]=null}return r}function Ys(e){e.g=null,e.h=[null,null,null,null,null,null,null,null]}function $s(e,t,i){var r={0:0,1:0,2:1,3:1};return Zs[(e=r[e])<<2|(t=r[t])<<1|(i=r[i])]}Hs.prototype.ha=function(){return this.g<this.h.length},Hs.prototype.Z=function(){return this.g},Hs.prototype.skip=function(e){if(this.g+e>this.h.length)throw new Me(2,2,3e3);this.g+=e};var Ks=new Map([[32," "],[33," "],[37,"…"],[42,"Š"],[44,"Œ"],[48,"█"],[49,"‘"],[50,"’"],[51,"“"],[52,"”"],[53,"•"],[57,"™"],[58,"š"],[60,"œ"],[61,"℠"],[63,"Ÿ"],[118,"⅛"],[119,"⅜"],[120,"⅝"],[121,"⅞"],[122,"│"],[123,"┐"],[124,"└"],[125,"─"],[126,"┘"],[127,"┌"]]),Zs="black blue green cyan red magenta yellow white".split(" ");function Qs(){this.h=[],this.g=[],this.i=new Bs,this.l=0,this.s=new Map([["CC1",new bs(0,0)],["CC2",new bs(0,1)],["CC3",new bs(1,0)],["CC4",new bs(1,1)]]),this.o=this.m=0,this.j=new Map,Js(this)}function Js(e){e.m=0,e.o=0;for(var t=(e=l(e.s.values())).next();!t.done;t=e.next())(t=t.value).h=2,t.g=t.i,t.m=null,us(t.i),us(t.l),us(t.o)}function ea(e,t){var i=t.type;if(16==(112&t.xa)){var r=t.xa>>3&1;0===i?e.m=r:e.o=r}if(i=e.s.get("CC"+(i<<1|(i?e.o:e.m)+1)),255===t.xa&&255===t.La||!t.xa&&!t.La||!ia(t.xa)||!ia(t.La))return 45<=++e.l&&Js(e),null;if(e.l=0,t.xa&=127,t.La&=127,!t.xa&&!t.La)return null;if(e=null,16==(112&t.xa))e:{if(r=t.xa,e=t.La,i.m===(r<<8|e))i.m=null;else if(i.m=r<<8|e,16==(240&r)&&64==(192&e)){t=[11,11,1,2,3,4,12,13,14,15,5,6,7,8,9,10][(7&r)<<1|e>>5&1];var n=(30&e)>>1;r="white";var s=!1;if(7>n?r=Ls[n]:7===n&&(s=!0),e=1==(1&e),i.h!==Is){if(n=i.g,i.h===Es&&t!==n.g){var a=1+t-n.h;cs(n,a,1+n.g-n.h,n.h),ds(n,0,a-1),ds(n,t+1,15-t)}n.g=t,i.g.m=e,i.g.j=s,i.g.l=r,i.g.o="black"}}else if(17==(247&r)&&32==(240&e))i.g.m=!1,i.g.j=!1,i.g.l="white",ls(i.g,ps,32),r=!1,"white_italics"===(t=Ls[(14&e)>>1])&&(t="white",r=!0),i.g.m=1==(1&e),i.g.j=r,i.g.l=t;else if(16==(247&r)&&32==(240&e)||23==(247&r)&&45==(255&e))t="black",0==(7&r)&&(t=Rs[(14&e)>>1]),i.g.o=t;else if(17==(247&r)&&48==(240&e))ls(i.g,gs,e);else if(18==(246&r)&&32==(224&e))ls(i.g,1&r?ms:fs,e);else if(20==(246&r)&&32==(240&e)){switch(e=t.pts,r=null,t.La){case 32:Ts(i);break;case 33:(i=i.g).i[i.g].pop();break;case 37:r=ws(i,2,e);break;case 38:r=ws(i,3,e);break;case 39:r=ws(i,4,e);break;case 40:ls(i.g,ps,32);break;case 41:i.h=2,i.g=i.i,i.g.h=0,i.j=e;break;case 42:us(i.o),Ss(i);break;case 43:Ss(i);break;case 44:t=i.i,r=null,i.h!==Is&&(r=hs(t,i.j,e)),ds(t,0,15);break;case 45:t=i.g,i.h!==Es?r=null:(r=hs(t,i.j,e),cs(t,(s=t.g-t.h+1)-1,s,t.h),ds(t,0,s-1),ds(t,t.g,15-t.g),i.j=e);break;case 46:ds(i.l,0,15);break;case 47:t=null,i.h!==Is&&(t=hs(i.i,i.j,e)),r=i.l,i.l=i.i,i.i=r,Ts(i),i.j=e,r=t}e=r;break e}e=null}else r=t.La,ls(i.g,ps,t.xa),ls(i.g,ps,r);return e}function ta(e,t){var i=[];try{for(;t.ha();){var r=Vs(t).value,n=(224&r)>>5,s=31&r;if(7===n&&0!=s&&(n=63&Vs(t).value),0!=n){e.j.has(n)||e.j.set(n,new Ws(n));for(var a=e.j.get(n),o=t.Z();t.Z()-o<s;){var h=Vs(n=t),u=h.value,l=h.pts;if(16===u)u=u<<16|Vs(n).value;if(0<=u&&31>=u){var c=l;if(a.g){var d=a.g;switch(n=null,u){case 8:!Ds(d)||0>=d.g&&0>=d.h||(0>=d.g?(d.g=d.B-1,d.h--):d.g--,d.i[d.h][d.g]=null);break;case 13:if(d.isVisible()&&(n=Ns(d,c,a.i)),d.h+1>=d.F){c=d;for(var p=0,g=1;16>g;g++,p++)c.i[p]=c.i[g];for(g=0;1>g;g++,p++)c.i[p]=Ps()}else d.h++;d.g=0;break;case 14:d.isVisible()&&(n=Ns(d,c,a.i)),d.i[d.h]=Ps(),d.g=0;break;case 12:d.isVisible()&&(n=Ns(d,c,a.i)),Ms(d),(c=d).h=0,c.g=0}var f=n}else f=null}else if(128<=u&&159>=u)f=Gs(a,n,u,l);else{if(4096<=u&&4127>=u)8<=(c=255&u)&&15>=c?n.skip(1):16<=c&&23>=c?n.skip(2):24<=c&&31>=c&&n.skip(3);else if(4224<=u&&4255>=u)128<=(c=255&u)&&135>=c?n.skip(4):136<=c&&143>=c&&n.skip(5);else if(32<=u&&127>=u)n=u,a.g&&Os(a.g,127===n?"♪":String.fromCharCode(n));else if(160<=u&&255>=u)a.g&&Os(a.g,String.fromCharCode(u));else if(4128<=u&&4223>=u){if(n=255&u,a.g)if(Ks.has(n)){var m=Ks.get(n);Os(a.g,m)}else Os(a.g,"_")}else 4256<=u&&4351>=u&&a.g&&Os(a.g,160!=(255&u)?"_":"[CC]");f=null}(n=f)&&i.push(n)}}}}catch(_){if(!(_ instanceof Me&&3e3===_.code))throw _;Y("CEA708_INVALID_DATA","Buffer read out of bounds / invalid CEA-708 Data.")}return i}function ia(e){for(var t=0;e;)t^=1&e,e>>=1;return 1===t}function ra(){}function na(e,t){var i=null,r=null,n=null,s=e.K();return 1&t&&(n=e.$a()),2&t&&e.skip(4),8&t&&(i=e.K()),16&t&&(r=e.K()),{trackId:s,Ce:i,xf:r,rh:n}}function sa(e,t){return{we:1==t?e.$a():e.K()}}function aa(e,t){return 1==t?(e.skip(8),e.skip(8)):(e.skip(4),e.skip(4)),{timescale:e.K()}}function oa(e,t,i){var r=e.K(),n=[],s=null;1&i&&(s=e.K()),4&i&&e.skip(4);for(var a=0;a<r;a++){var o={ee:null,sampleSize:null,ed:null};256&i&&(o.ee=e.K()),512&i&&(o.sampleSize=e.K()),1024&i&&e.skip(4),2048&i&&(o.ed=0==t?e.K():e.Pe()),n.push(o)}return{wh:r,Re:n,wf:s}}function ha(){this.j=new Map,this.i=this.h=0,this.g=ua}ra.prototype.init=function(){},ra.prototype.parse=function(){return[]},ha.prototype.init=function(e){function t(e){(e=e.name)in da&&(i.g=da[e])}var i=this,r=[],n=[];if((new Xr).box("moov",qr).box("mvex",qr).P("trex",(function(e){var t=e.reader;t.skip(4),t.skip(4),e=t.K(),t=t.K(),i.h=e,i.i=t})).box("trak",qr).P("tkhd",(function(e){var t=e.reader;1==e.version?(t.skip(8),t.skip(8)):(t.skip(4),t.skip(4)),e=t.K(),r.push(e)})).box("mdia",qr).P("mdhd",(function(e){e=aa(e.reader,e.version),n.push(e.timescale)})).box("minf",qr).box("stbl",qr).P("stsd",Yr).box("avc1",t).box("avc3",t).box("hev1",t).box("hvc1",t).box("dvh1",t).box("dvhe",t).box("encv",$r).box("sinf",qr).box("frma",(function(e){(e=Qr(e=e.reader.K()))in da&&(i.g=da[e])})).parse(e,!0),!r.length||!n.length||r.length!=n.length)throw new Me(2,2,2010);this.g==ua&&q("Unable to determine bitstream format for CEA parsing!"),r.forEach((function(e,t){i.j.set(e,n[t])}))},ha.prototype.parse=function(e){var t=this;if(this.g==ua)return[];var i=[],r=this.h,n=this.i,s=[],a=null,o=null,h=null,u=9e4;return(new Xr).box("moof",(function(e){a=e.start,qr(e)})).box("traf",qr).P("trun",(function(e){e=oa(e.reader,e.version,e.flags),s=e.Re,o=e.wf})).P("tfhd",(function(e){e=na(e.reader,e.flags),r=e.Ce||t.h,n=e.xf||t.i,e=e.trackId,t.j.has(e)&&(u=t.j.get(e))})).P("tfdt",(function(e){h=sa(e.reader,e.version).we})).box("mdat",(function(e){if(null===h)throw new Me(2,2,2010);e:{var d=e.reader,p=h,g=u,f=r,m=n,_=s,v=0,y=m;for(_.length&&(y=_[0].sampleSize||m),d.skip((a||0)+(o||0)-e.start-8);d.ha();){e=d.K();var x=d.Ra();switch(t.g){case la:x=6==(x&=31);break;case ca:x=39==(x=x>>1&63)||40==x;break;default:break e}if(x){x=0,_.length>v&&(x=_[v].ed||0),x=(p+x)/g;for(var b,w=[],T=d.Za(e-1),S=b=0;S<T.length;)2==b&&3==T[S]?(b=0,(T=[].concat(c(T))).splice(S,1),T=new Uint8Array(T)):0==T[S]?b++:b=0,S++;for(b=T,S=0;S<b.length;){for(T=0;255==b[S];)T+=255,S++;T+=b[S++];for(var A=0;255==b[S];)A+=255,S++;A+=b[S++],4==T&&w.push(b.subarray(S,S+A)),S+=A}for(b=(w=l(w)).next();!b.done;b=w.next())i.push({ig:b.value,pts:x})}else try{d.skip(e-1)}catch(C){break}0==(y-=e+4)&&(p=_.length>v?p+(_[v].ee||f):p+f,v++,y=_.length>v&&_[v].sampleSize||m)}}})).parse(e,!1),i};var ua=0,la=1,ca=2,da={avc1:la,avc3:la,hev1:ca,hvc1:ca,dvh1:ca,dvhe:ca};function pa(e){this.h=new ra,e.includes("video/mp4")&&(this.h=new ha),this.g=new Qs}function ga(e,t){for(var i=(t=l(t=e.h.parse(t))).next();!i.done;i=t.next()){var r=i.value,n=Re(r.ig);if(0<n.length&&(i=e.g,r=r.pts,181===(n=new Vr(n,0)).Ra()&&49===n.$d()&&1195456820===n.K()&&3===n.Ra())){var s=n.Ra();if(0!=(64&s)){s&=31,n.skip(1);for(var a=0;a<s;a++){var o=n.Ra(),h=(4&o)>>2,u=n.Ra(),d=n.Ra();h&&(0===(o&=3)||1===o?i.h.push({pts:r,type:o,xa:u,La:d,order:i.h.length}):(i.g.push({pts:r,type:o,value:u,order:i.g.length}),i.g.push({pts:r,type:2,value:d,order:i.g.length})))}}}}return function(e){function t(e,t){return e.pts-t.pts||e.order-t.order}var i=[];e.h.sort(t),e.g.sort(t);for(var r=l(e.h),n=r.next();!n.done;n=r.next())(n=ea(e,n.value))&&i.push(n);for(n=(r=l(e.g)).next();!n.done;n=r.next())js(e.i,n.value);for(n=(r=l(e.i.i)).next();!n.done;n=r.next())n=ta(e,n.value),i.push.apply(i,c(n));return e.i.i=[],e.h=[],e.g=[],i}(e.g)}function fa(e,t,i,r,n){this.ya=e,this.Ba=t,this.ka=i,this.Od=void 0===r?null:r,this.timescale=n}function ma(e,t,i,r,n,s,a,o,h,u,l,c,d,p,g){u=void 0===u?[]:u,p=void 0===p?_a:p,this.startTime=e,this.j=this.endTime=t,this.u=i,this.Ba=r,this.ka=n,this.h=s,this.timestampOffset=a,this.appendWindowStart=o,this.appendWindowEnd=h,this.i=u,this.tilesLayout=void 0===l?"":l,this.s=void 0===c?null:c,this.g=void 0===d?null:d,this.status=p,this.l=void 0===g?null:g,this.o=null,this.m=0}pa.prototype.init=function(e){this.h.init(e)},fa.prototype.lc=function(){return this.Ba},fa.prototype.hc=function(){return this.ka},j("shaka.media.InitSegmentReference",fa),fa.prototype.getEndByte=fa.prototype.hc,fa.prototype.getStartByte=fa.prototype.lc,(n=ma.prototype).ya=function(){return this.u()},n.getStartTime=function(){return this.startTime},n.Ef=function(){return this.endTime},n.lc=function(){return this.Ba},n.hc=function(){return this.ka},n.Vf=function(){return this.tilesLayout},n.Uf=function(){return this.s},n.Eb=function(){return this.status},n.bg=function(){this.status=va},n.Ye=function(e){this.o=e},n.Sf=function(){return this.o},n.offset=function(e){this.startTime+=e,this.endTime+=e,this.j+=e;for(var t=l(this.i),i=t.next();!i.done;i=t.next())(i=i.value).startTime+=e,i.endTime+=e,i.j+=e},n.oe=function(e){null==this.g?X("Sync attempted without sync time!"):(e=this.g-e-this.startTime,.001<=Math.abs(e)&&this.offset(e))},j("shaka.media.SegmentReference",ma),ma.prototype.syncAgainst=ma.prototype.oe,ma.prototype.offset=ma.prototype.offset,ma.prototype.getThumbnailSprite=ma.prototype.Sf,ma.prototype.setThumbnailSprite=ma.prototype.Ye,ma.prototype.markAsUnavailable=ma.prototype.bg,ma.prototype.getStatus=ma.prototype.Eb,ma.prototype.getTileDuration=ma.prototype.Uf,ma.prototype.getTilesLayout=ma.prototype.Vf,ma.prototype.getEndByte=ma.prototype.hc,ma.prototype.getStartByte=ma.prototype.lc,ma.prototype.getEndTime=ma.prototype.Ef,ma.prototype.getStartTime=ma.prototype.getStartTime,ma.prototype.getUris=ma.prototype.ya;var _a=0,va=1;function ya(e){return!e||1==e.length&&1e-6>e.end(0)-e.start(0)?null:1==e.length&&0>e.start(0)?0:e.length?e.start(0):null}function xa(e){return!e||1==e.length&&1e-6>e.end(0)-e.start(0)?null:e.length?e.end(e.length-1):null}function ba(e,t){return!(!e||!e.length||1==e.length&&1e-6>e.end(0)-e.start(0)||t>e.end(e.length-1))&&t>=e.start(0)}function wa(e,t){if(!e||!e.length||1==e.length&&1e-6>e.end(0)-e.start(0))return 0;for(var i=0,r=(e=l(Ta(e))).next();!r.done;r=e.next()){var n=r.value;r=n.start,(n=n.end)>t&&(i+=n-Math.max(r,t))}return i}function Ta(e){if(!e)return[];for(var t=[],i=0;i<e.length;i++)t.push({start:e.start(i),end:e.end(i)});return t}function Sa(){}function Aa(e,t){var i=(127&e[t])<<21;return i|=(127&e[t+1])<<14,(i|=(127&e[t+2])<<7)|127&e[t+3]}function Ca(e){var t={key:e.type,description:"",data:""};if("TXXX"===e.type){if(2>e.size||3!==e.data[0])return null;var i=e.data.subarray(1).indexOf(0);if(-1===i)return null;var r=wt(Re(e.data,1,i));return e=wt(Re(e.data,2+i)).replace(/\0*$/,""),t.description=r,t.data=e,t}return"WXXX"===e.type?2>e.size||3!==e.data[0]||-1===(i=e.data.subarray(1).indexOf(0))?null:(r=wt(Re(e.data,1,i)),e=wt(Re(e.data,2+i)).replace(/\0*$/,""),t.description=r,t.data=e,t):"PRIV"===e.type?2>e.size||-1===(r=e.data.indexOf(0))?null:(r=wt(Re(e.data,0,r)),e=Ie(e.data.subarray(r.length+1)),t.description=r,t.data=e,t):"T"===e.type[0]?2>e.size||3!==e.data[0]?null:(e=wt(e.data.subarray(1)).replace(/\0*$/,""),t.data=e,t):"W"===e.type[0]?(e=wt(e.data).replace(/\0*$/,""),t.data=e,t):e.data?(t.data=Ie(e.data),t):null}function Ea(e){for(var t=0,i=[];t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&255>e[t+3]&&255>e[t+4]&&128>e[t+6]&&128>e[t+7]&&128>e[t+8]&&128>e[t+9];){var r=Aa(e,t+6);for(e[t+5]>>6&1&&(t+=10),r=(t+=10)+r;t+10<r;){var n=e.subarray(t),s=Aa(n,4);(s=Ca(n={type:String.fromCharCode(n[0],n[1],n[2],n[3]),size:s,data:n.subarray(10,10+s)}))&&i.push(s),t+=n.size+10}t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&255>e[t+3]&&255>e[t+4]&&128>e[t+6]&&128>e[t+7]&&128>e[t+8]&&128>e[t+9]&&(t+=10)}return i}function Ia(){this.o=null,this.s=!1,this.l=this.m=null,this.B=[],this.g=this.h=null,this.u=[],this.j=null,this.i=[]}function Ra(e){if(1!=(e[0]<<16|e[1]<<8|e[2]))return null;var t={data:new Uint8Array(0),vh:6+(e[4]<<8|e[5]),pts:null,dts:null},i=e[7];return 192&i&&(t.pts=536870912*(14&e[9])+4194304*(255&e[10])+16384*(254&e[11])+128*(255&e[12])+(254&e[13])/2,t.dts=t.pts,64&i&&(t.dts=536870912*(14&e[14])+4194304*(255&e[15])+16384*(254&e[16])+128*(255&e[17])+(254&e[18])/2)),t.data=e.subarray(9+e[8]),t}function La(e){for(var t=Math.min(1e3,e.length-564),i=0;i<t;){if(71===e[i]&&71===e[i+188]&&71===e[i+376])return i;i++}return-1}function ka(e,t,i){this.g=null,this.i=-1,this.j=e,this.h=t,this.l=i,"undefined"==typeof libDPIModule&&q("Could not Find LCEVC Library dependencies on this page"),"undefined"==typeof LcevcDil?q("Could not Find LCEVC Library on this page"):LcevcDil.SupportObject.SupportStatus||q(LcevcDil.SupportObject.SupportError),"undefined"!=typeof LcevcDil&&"undefined"!=typeof libDPIModule&&this.h instanceof HTMLCanvasElement&&LcevcDil.SupportObject.SupportStatus&&!this.g&&LcevcDil.SupportObject.webGLSupport(this.h)&&(this.h.classList.remove("shaka-hidden"),this.g=new LcevcDil.LcevcDil(this.j,this.h,this.l))}function Ma(e,t){var i=Pa;switch(t.mimeType){case"video/webm":i=Oa;break;case"video/mp4":i=Da}e.g&&(e.i=t.id,e.g.setLevelSwitching(t.id,!0),e.g.setContainerFormat(i))}ma.Status={Hg:_a,oh:va,Vg:2},j("shaka.util.Id3Utils",Sa),Sa.getID3Frames=Ea,Ia.prototype.parse=function(e){if(564>e.length)return this;for(var t=Math.max(0,La(e)),i=e.length-(e.length+t)%188,r=!1,n=t;n<i;n+=188)if(71===e[n]){var s=!!(64&e[n+1]),a=((31&e[n+1])<<8)+e[n+2];if(1<(48&e[n+3])>>4){var o=n+5+e[n+4];if(o===n+188)continue}else o=n+4;switch(a){case 0:s&&(o+=e[o]+1),this.o=(31&e[o+10])<<8|e[o+11];break;case 17:case 8191:break;case this.o:s&&(o+=e[o]+1),a={audio:-1,video:-1,Ed:-1,audioCodec:"",videoCodec:""};var h=o+3+((15&(s=e)[o+1])<<8|s[o+2])-4;for(o+=12+((15&s[o+10])<<8|s[o+11]);o<h;){var u=(31&s[o+1])<<8|s[o+2];switch(s[o]){case 15:-1===a.audio&&(a.audio=u,a.audioCodec="aac");break;case 21:-1===a.Ed&&(a.Ed=u);break;case 27:-1===a.video&&(a.video=u,a.videoCodec="avc");break;case 3:case 4:-1===a.audio&&(a.audio=u,a.audioCodec="mp3");break;case 36:-1===a.video&&(a.video=u,a.videoCodec="hvc")}o+=5+((15&s[o+3])<<8|s[o+4])}s=a,null==this.l&&(this.l=s.video),null==this.g&&(this.g=s.audio),null==this.j&&(this.j=s.Ed),r&&!this.s&&(r=!1,n=t-188),this.s=!0;break;case this.l:s=e.subarray(o,n+188),null==this.m&&(o=Ra(s))&&null!=o.pts&&(this.m=o.pts/9e4),this.B.push(s);break;case this.g:s=e.subarray(o,n+188),null==this.h&&(o=Ra(s))&&null!=o.pts&&(this.h=o.pts/9e4),this.u.push(s);break;case this.j:this.i.push(e.subarray(o,n+188));break;default:r=!0}}return this},Ia.prototype.getStartTime=function(){return{audio:this.h,video:this.m}},j("shaka.util.TsParser",Ia),ka.prototype.release=function(){this.g&&(this.g.close(),this.g=null)},j("shaka.lcevc.Dil",ka),ka.prototype.release=ka.prototype.release;var Pa=0,Oa=1,Da=2;function Na(e,t,i,r){var n=this;this.j=e,this.F=null,this.m=t,this.h={},this.L={},this.O={},this.g=null,this.H=!1,this.V=i||function(){},this.D=r||null,this.i={},this.u=new Nr,this.o={},this.s=null,this.J=new nt,this.l=function(e,t){var i=new MediaSource;return e.u.ma(i,"sourceopen",(function(){URL.revokeObjectURL(e.M),t.resolve()})),e.M=Ja(i),e.j.src=e.M,i}(this,this.J),this.G=new Or((function(){return function(e){var t,i,r,n,s,a,o;return P((function(h){if(1==h.g){for(i in t=[],e.i)for(r=e.i[i],n=r[0],e.i[i]=r.slice(0,1),n&&t.push(n.p.catch($e)),s=l(r.slice(1)),a=s.next();!a.done;a=s.next())a.value.p.reject(new Me(2,7,7003,void 0));for(o in e.g&&t.push(e.g.destroy()),e.m&&t.push(e.m.destroy()),e.o)t.push(e.o[o].destroy());return b(h,Promise.all(t),2)}e.u&&(e.u.release(),e.u=null),e.j&&(e.j.removeAttribute("src"),e.j.load(),e.j=null),e.F=null,e.l=null,e.g=null,e.m=null,e.h={},e.o={},e.s=null,e.i={},e.D=null,w(h)}))}(n)})),this.M="",this.B=!1,this.W=new nt}function Fa(e,t,i){e.g||(e.g=new $t(e.m));var r=e.g;e=e.H,"application/cea-608"!=t&&"application/cea-708"!=t&&(r.j=(0,ei[t])(),r.j.setSequenceMode?r.j.setSequenceMode(i):q('Text parsers should have a "setSequenceMode" method!'),r.u=e)}function Ua(e){return!e.l||"ended"==e.l.readyState}function za(e,t){return t==tt?e.g.g:ya(ja(e,t))}function Ba(e,t){return t==tt?e.g.h:xa(ja(e,t))}function ja(e,t){try{return e.h[t].buffered}catch(i){return null}}function Ha(e,t,i,r,n,s,a){var o,h,u,c,d,p,g,f,m,_,v,y,x,T,S,A,C,E,I,R,L,k;return s=void 0!==s&&s,a=void 0!==a&&a,P((function(M){switch(M.g){case 1:if(t!=(o=it).X){M.A(2);break}if(!e.B){M.A(3);break}return b(M,e.W,4);case 4:h=M.h,e.g.s=h;case 3:return b(M,function(e,t,i,r){var n,s,a,o;return P((function(h){return 1==h.g?b(h,Promise.resolve(),2):e.j&&e.i?null==i||null==r?(e.j.parseInit(Re(t)),h.return()):(n=e.u?i:e.s,s={periodStart:e.s,segmentStart:i,segmentEnd:r,vttOffset:n},a=e.j.parseMedia(Re(t),s),o=a.filter((function(t){return t.startTime>=e.l&&t.startTime<e.m})),e.i.append(o),null==e.g&&(e.g=Math.max(i,e.l)),e.h=Math.min(r,e.m),void w(h)):h.return()}))}(e.g,i,r?r.startTime:null,r?r.endTime:null),5);case 5:return M.return();case 2:if(u=Re(i),c=e.L[t],e.o[t]&&(c=e.o[t].o),0>La(u)?to.includes(c)&&((f=Ea(u)).length&&r&&(m={cueTime:r.startTime,data:u,frames:f,dts:r.startTime,pts:r.startTime},e.V([m],0,r.endTime))):(d=(new Ia).parse(u),p=r.startTime-(d.getStartTime()[t]||0),g=function(e){for(var t=[],i=new Uint8Array(0),r=e.i.length-1;0<=r;r--){var n=Ra(i=Ot(e.i[r],i));n&&(t.unshift({cueTime:n.pts?n.pts/9e4:null,data:n.data,frames:Ea(n.data),dts:n.dts,pts:n.pts}),i=new Uint8Array(0))}return t}(d),g.length&&e.V(g,p,r?r.endTime:null)),!e.o[t]){n&&t==o.va&&(e.g||Fa(e,"text/vtt",e.B),e.s||(e.s=new pa(c)),r?(_=ga(e.s,i)).length&&(v=e.h[o.va].timestampOffset,Jt(e.g,_,r.startTime,r.endTime,v)):e.s.init(i)),M.A(6);break}return s&&e.o[t].g.resetCaptions(),b(M,function(e,t){return e.j=!0,e.h=new nt,e.l=[],e.i=[],t=Re(t),e.g.push(t),e.g.flush(),e.j&&e.h.reject(new Me(2,3,3018)),e.h}(e.o[t],i),7);case 7:y=M.h,e.g||Fa(e,"text/vtt",e.B),y.captions&&y.captions.length&&(x=e.h[o.va].timestampOffset,T=function(e){for(var t=[],i=(e=l(e)).next();!i.done;i=e.next())i=i.value,t.push({stream:i.stream,cue:new se(i.startTime,i.endTime,i.text)});return t}(y.captions),Jt(e.g,T,r?r.startTime:null,r?r.endTime:null,x)),i=y.data;case 6:if(i=function(e,t,i,r){var n=e.O[r];return null==i&&n&&(dt()||ct())&&"mp4"==e.L[r].split(";")[0].split("/")[1]&&(t=function(e){function t(){n=!0}function i(e){s.push(e),qr(e)}e=Re(e);var r,n=!1,s=[],a=[];if((new Xr).box("moov",i).box("trak",i).box("mdia",i).box("minf",i).box("stbl",i).P("stsd",(function(e){r=e,s.push(e),Yr(e)})).P("encv",t).P("enca",t).P("hev1",(function(e){a.push({box:e,lb:1701733238})})).P("hvc1",(function(e){a.push({box:e,lb:1701733238})})).P("avc1",(function(e){a.push({box:e,lb:1701733238})})).P("avc3",(function(e){a.push({box:e,lb:1701733238})})).P("ac-3",(function(e){a.push({box:e,lb:1701733217})})).P("ec-3",(function(e){a.push({box:e,lb:1701733217})})).P("mp4a",(function(e){a.push({box:e,lb:1701733217})})).parse(e),n)return e;if(0==a.length||!r)throw Pt(e),new Me(2,3,3019);a.reverse();for(var o=l(a),h=o.next();!h.done;h=o.next())h=h.value,e=es(e,r,h.box,s,h.lb);return e}(t)),t}(e,i,r?r.startTime:null,t),S=e.h[t],A=eo,!e.B||S.mode==A||!r){M.A(8);break}if(C=e.l.duration,!(t==o.va||!(o.va in e.h))){M.A(9);break}return E=[S.appendWindowStart,S.appendWindowEnd],S.appendWindowStart=0,S.appendWindowEnd=1/0,I=S.timestampOffset,S.timestampOffset=0,b(M,$a(e,t,(function(){return Wa(e,t,i)})),10);case 10:return b(M,$a(e,t,(function(){return Xa(e,t)})),11);case 11:return S.timestampOffset=I,S.appendWindowStart=E[0],S.appendWindowEnd=E[1],R=ya(ja(e,t)),L=(r.startTime||0)-(R||0),e.W.resolve(L),b(M,$a(e,t,(function(){return Ga(e,t,0,C)})),12);case 12:if(t!=o.va){M.A(9);break}return b(M,$a(e,t,(function(){e.j.currentTime-=.001,Ya(e,t)})),9);case 9:return S.mode=A,b(M,e.Aa(C),8);case 8:return r&&e.B&&t!=o.X&&(s||a)&&(k=r.startTime,$a(e,t,(function(){return Xa(e,t)})),$a(e,t,(function(){return qa(e,t,k)}))),b(M,$a(e,t,(function(){Wa(e,t,i)})),16);case 16:w(M)}}))}function Va(e,t){return P((function(i){return t==it.X?e.g?b(i,e.g.remove(0,1/0),0):i.return():b(i,$a(e,t,(function(){return Ga(e,t,0,e.l.duration)})),0)}))}function Wa(e,t,i){if("video"==t&&e.D){var r=e.D;r.g&&r.g.appendBuffer(i,"video",r.i)}e.h[t].appendBuffer(i)}function Ga(e,t,i,r){r<=i?Ya(e,t):e.h[t].remove(i,r)}function Xa(e,t){var i=e.h[t].appendWindowStart,r=e.h[t].appendWindowEnd;e.h[t].abort(),e.h[t].appendWindowStart=i,e.h[t].appendWindowEnd=r,Ya(e,t)}function qa(e,t,i){0>i&&(i+=.001),e.h[t].timestampOffset=i,Ya(e,t)}function Ya(e,t){var i=e.i[t][0];i&&(i.p.resolve(),Za(e,t))}function $a(e,t,i){return Dr(e.G),i={start:i,p:new nt},e.i[t].push(i),1==e.i[t].length&&Qa(e,t),i.p}function Ka(e,t){var i,r,n,s,a;return P((function(o){switch(o.g){case 1:for(n in Dr(e.G),i=[],r={},e.h)r.Ub=new nt,s={start:function(e){return function(){return e.Ub.resolve()}}(r),p:r.Ub},e.i[n].push(s),i.push(r.Ub),1==e.i[n].length&&s.start(),r={Ub:r.Ub};return T(o,2),b(o,Promise.all(i),4);case 4:A(o,3);break;case 2:throw C(o);case 3:try{t()}catch(h){throw new Me(2,3,3015,h)}finally{for(a in e.h)Za(e,a)}w(o)}}))}function Za(e,t){e.i[t].shift(),Qa(e,t)}function Qa(e,t){var i=e.i[t][0];if(i)try{i.start()}catch(r){"QuotaExceededError"==r.name?i.p.reject(new Me(2,3,3017,t)):i.p.reject(new Me(2,3,3015,r)),Za(e,t)}}(n=Na.prototype).destroy=function(){return this.G.destroy()},n.init=function(e,t,i){i=void 0!==i&&i;var r,n,s,a,o,h,u,c,d=this;return P((function(p){if(1==p.g)return r=it,b(p,d.J,2);for(d.B=i,n={},s=l(e.keys()),a=s.next();!a.done;n={na:n.na},a=s.next())n.na=a.value,o=e.get(n.na),h=Wt(o.mimeType,o.codecs),n.na==r.X?Fa(d,h,i):(!t&&J(h)||!zt(h,n.na)||(d.o[n.na]=new Ut(h),h=jt(n.na,h)),u=h+d.F.sourceBufferExtraFeatures,c=d.l.addSourceBuffer(u),d.u.C(c,"error",function(e){return function(){d.i[e.na][0].p.reject(new Me(2,3,3014,d.j.error?d.j.error.code:0))}}(n)),d.u.C(c,"updateend",function(e){return function(){return Ya(d,e.na)}}(n)),d.h[n.na]=c,d.L[n.na]=h,d.i[n.na]=[],d.O[n.na]=!!o.drmInfos.length);w(p)}))},n.configure=function(e){this.F=e},n.Na=function(){var e={total:Ta(this.j.buffered),audio:Ta(ja(this,"audio")),video:Ta(ja(this,"video")),text:[]};if(this.g){var t=this.g.g,i=this.g.h;null!=t&&null!=i&&e.text.push({start:t,end:i})}return e},n.remove=function(e,t,i){var r=this;return P((function(n){return e==it.X?b(n,r.g.remove(t,i),0):b(n,$a(r,e,(function(){return Ga(r,e,t,i)})),0)}))},n.flush=function(e){var t=this;return P((function(i){return e==it.X?i.return():b(i,$a(t,e,(function(){t.j.currentTime-=.001,Ya(t,e)})),0)}))},n.endOfStream=function(e){var t=this;return P((function(i){return b(i,Ka(t,(function(){Ua(t)||(e?t.l.endOfStream(e):t.l.endOfStream())})),0)}))},n.Aa=function(e){var t=this;return P((function(i){return b(i,Ka(t,(function(){if(e<t.l.duration)for(var i in t.h){var r={start:function(){},p:new nt};t.i[i].unshift(r)}t.l.duration=e})),0)}))},n.getDuration=function(){return this.l.duration};var Ja=e.URL.createObjectURL,eo="sequence",to=["audio/aac","audio/ac3","audio/ec3","audio/mpeg"];function io(e,t,i){this.i=e,this.m=t,this.o=this.j=1/0,this.g=1,this.h=this.l=null,this.s=0,this.u=!0,this.B=0,this.D=void 0===i||i,this.F=0,this.G=!1}function ro(e,t,i){this.l=i,this.j=e,this.s=so(e),this.g=e.g.currentTime,this.m=Date.now()/1e3,this.h=!1,this.o=0,this.u=t,this.i=function(){}}function no(e){this.g=e}function so(e){if(e.g.paused||0==e.g.playbackRate||0==e.g.buffered.length)var t=!1;else e:{t=e.g.currentTime;for(var i=(e=l(Ta(e.g.buffered))).next();!i.done;i=e.next())if(!(t<(i=i.value).start-.1||t>i.end-.5)){t=!0;break e}t=!1}return t}function ao(e,t,i,r,n){var s=this;this.o=n,this.g=e,this.s=t,this.D=i,this.i=new Nr,this.m=!1,this.B=e.readyState,this.u=0,this.h=r,this.l=!1,this.i.C(e,"waiting",(function(){return oo(s)})),this.j=new ot((function(){oo(s)})).Ca(.25)}function oo(e){if(0!=e.g.readyState){if(e.g.seeking){if(!e.m)return}else e.m=!1;if(!e.g.paused||0==e.g.currentTime&&(e.g.autoplay||0!=e.g.currentTime)){var t;if(e.g.readyState!=e.B&&(e.B=e.g.readyState),!(t=!e.h)){var i=(t=e.h).j,r=so(i),n=i.g.currentTime,s=Date.now()/1e3;t.g==n&&t.s==r||(t.m=s,t.g=n,t.s=r,t.h=!1),(r=(n=s-t.m)>=t.u&&r&&!t.h)&&(t.i(t.g,n),t.h=!0,t.g=i.g.currentTime,t.o++,t.l(new _r("stalldetected"))),t=!r}t&&(t=e.g.currentTime,r=function(e,t,i){return!e||!e.length||1==e.length&&1e-6>e.end(0)-e.start(0)?null:0<=(e=Ta(e).findIndex((function(e,r,n){return e.start>t&&(0==r||n[r-1].end-t<=i)})))?e:null}(i=e.g.buffered,t,e.D.gapDetectionThreshold),null==r||0==r&&!e.l||((n=i.start(r))>=e.s.Oa()||.001>n-t||(0!=r&&i.end(r-1),e.g.currentTime=n,e.u++,e.o(new _r("gapjumped")))))}}}function ho(e,t,i,r){t==HTMLMediaElement.HAVE_NOTHING||e.readyState>=t?r():(t=uo.value().get(t),i.ma(e,t,r))}(n=io.prototype).getDuration=function(){return this.j},n.Kf=function(){return this.g},n.Xe=function(e){this.i=e},n.Aa=function(e){this.j=e},n.Pf=function(){return this.i},n.Ve=function(e){this.s=e},n.yc=function(e){this.u=e},n.me=function(e){this.o=e},n.We=function(e){this.m=e},n.Df=function(){return this.m},n.Ib=function(e){if(0!=e.length){for(var t=e[0].startTime,i=e[0].endTime,r=(e=l(e)).next();!r.done;r=e.next())r=r.value,t=Math.min(t,r.startTime),i=Math.max(i,r.endTime),this.g=Math.max(this.g,r.endTime-r.startTime);this.Td(t),this.h=Math.max(this.h,i),null!=this.i&&this.D&&!this.G&&(this.i=(Date.now()+this.s)/1e3-this.h-this.g)}},n.Md=function(){this.G=!0},n.Td=function(e){this.l=null==this.l?e:Math.min(this.l,e)},n.Sd=function(e){this.g=Math.max(this.g,e)},n.offset=function(e){null!=this.l&&(this.l+=e),null!=this.h&&(this.h+=e)},n.U=function(){return 1/0==this.j&&!this.u},n.jb=function(){return 1/0!=this.j&&!this.u},n.Pa=function(){return Math.max(this.B,this.gb()-this.o)},n.Ze=function(e){this.B=e},n.gb=function(){return this.U()||this.jb()?Math.min(Math.max(0,(Date.now()+this.s)/1e3-this.g-this.i)+this.F,this.j):this.h?Math.min(this.h,this.j):this.j},n.kc=function(e){var t=Math.max(this.l,this.B);return 1/0==this.o?Math.ceil(1e3*t)/1e3:Math.max(t,Math.min(this.gb()-this.o+e,this.Oa()))},n.Db=function(){return this.kc(0)},n.Oa=function(){return Math.max(0,this.gb()-(this.U()||this.jb()?this.m:0))},n.df=function(){return!(null==this.i||null!=this.h&&this.D)},n.Ue=function(e){this.F=e},j("shaka.media.PresentationTimeline",io),io.prototype.setAvailabilityTimeOffset=io.prototype.Ue,io.prototype.usingPresentationStartTime=io.prototype.df,io.prototype.getSeekRangeEnd=io.prototype.Oa,io.prototype.getSeekRangeStart=io.prototype.Db,io.prototype.getSafeSeekRangeStart=io.prototype.kc,io.prototype.getSegmentAvailabilityEnd=io.prototype.gb,io.prototype.setUserSeekStart=io.prototype.Ze,io.prototype.getSegmentAvailabilityStart=io.prototype.Pa,io.prototype.isInProgress=io.prototype.jb,io.prototype.isLive=io.prototype.U,io.prototype.offset=io.prototype.offset,io.prototype.notifyMaxSegmentDuration=io.prototype.Sd,io.prototype.notifyMinSegmentStartTime=io.prototype.Td,io.prototype.lockStartTime=io.prototype.Md,io.prototype.notifySegments=io.prototype.Ib,io.prototype.getDelay=io.prototype.Df,io.prototype.setDelay=io.prototype.We,io.prototype.setSegmentAvailabilityDuration=io.prototype.me,io.prototype.setStatic=io.prototype.yc,io.prototype.setClockOffset=io.prototype.Ve,io.prototype.getPresentationStartTime=io.prototype.Pf,io.prototype.setDuration=io.prototype.Aa,io.prototype.setPresentationStartTime=io.prototype.Xe,io.prototype.getMaxSegmentDuration=io.prototype.Kf,io.prototype.getDuration=io.prototype.getDuration,ro.prototype.release=function(){this.l=this.j=null,this.i=function(){}},ao.prototype.release=function(){this.i&&(this.i.release(),this.i=null),null!=this.j&&(this.j.stop(),this.j=null),this.h&&(this.h.release(),this.h=null),this.g=this.s=this.o=null},ao.prototype.Wd=function(){this.l=!0,oo(this)};var uo=new st((function(){return new Map([[HTMLMediaElement.HAVE_METADATA,"loadedmetadata"],[HTMLMediaElement.HAVE_CURRENT_DATA,"loadeddata"],[HTMLMediaElement.HAVE_FUTURE_DATA,"canplay"],[HTMLMediaElement.HAVE_ENOUGH_DATA,"canplaythrough"]])}));function lo(e,t,i){var r=this;this.g=e,this.l=t,this.j=i,this.m=!1,this.h=new Nr,this.i=new mo(e),ho(this.g,HTMLMediaElement.HAVE_METADATA,this.h,(function(){go(r,r.j)}))}function co(e){return e.m?e.g.currentTime:e.j}function po(e,t){0<e.g.readyState?_o(e.i,t):ho(e.g,HTMLMediaElement.HAVE_METADATA,e.h,(function(){go(e,e.j)}))}function go(e,t){.001>Math.abs(e.g.currentTime-t)?fo(e):(e.h.ma(e.g,"seeking",(function(){fo(e)})),_o(e.i,e.g.currentTime&&0!=e.g.currentTime?e.g.currentTime:t))}function fo(e){e.m=!0,e.h.C(e.g,"seeking",(function(){return e.l()}))}function mo(e){var t=this;this.h=e,this.m=10,this.l=this.j=this.i=0,this.g=new ot((function(){0>=t.i||t.h.currentTime!=t.j?t.g.stop():(t.h.currentTime=t.l,t.i--)}))}function _o(e,t){e.j=e.h.currentTime,e.l=t,e.i=e.m,e.h.currentTime=t,e.g.Ca(.1)}function vo(e){this.g=e,this.j=!1,this.h=null,this.i=new Nr}function yo(e,t,i,r,n,s){var a=this;this.i=e,this.g=t.presentationTimeline,this.B=t.minBufferTime||0,this.l=i,this.u=n,this.s=null,this.o=function(e,t,i){if(!t.stallEnabled)return null;var r=t.stallSkip;return t=new ro(new no(e),t.stallThreshold,i),function(e,t){e.i=t}(t,(function(){r?e.currentTime+=r:(e.pause(),e.play())})),t}(e,i,s),this.j=new ao(e,t.presentationTimeline,i,this.o,s),this.h=new lo(e,(function(){var e=a.j;e.m=!0,e.l=!1;var t=co(a.h);return e=bo(a,t),.001<Math.abs(e-t)&&(t=Date.now()/1e3,!a.s||a.s<t-1)?(a.s=t,po(a.h,e),e=void 0):(a.u(),e=void 0),e}),function(e,t){return null==t?t=1/0>e.g.getDuration()?e.g.Db():e.g.Oa():0>t&&(t=e.g.Oa()+t),xo(e,wo(e,t))}(this,r)),this.m=new ot((function(){if(0!=a.i.readyState&&!a.i.paused){var e=co(a.h),t=a.g.Db(),i=a.g.Oa();3>i-t&&(t=i-3),e<t&&(e=bo(a,e),a.i.currentTime=e)}}))}function xo(e,t){var i=e.g.getDuration();return t>=i?i-e.l.durationBackoff:t}function bo(e,t){var i=Math.max(e.B,e.l.rebufferingGoal),r=e.l.safeSeekOffset,n=e.g.Db(),s=e.g.Oa(),a=e.g.getDuration();3>s-n&&(n=s-3);var o=e.g.kc(i),h=e.g.kc(r);return i=e.g.kc(i+r),t>=a?xo(e,t):t>s?s:t<n?ba(e.i.buffered,h)?h:i:t>=o||ba(e.i.buffered,t)?t:i}function wo(e,t){var i=e.g.Db();return t<i?i:t>(e=e.g.Oa())?e:t}function To(e){this.g=e,this.h=null,this.i=0,this.j=!1}function So(e,t){for(var i=(e=l(e.g)).next();!i.done;i=e.next())t(i.value)}function Ao(e,t,i){return new To([new ma(e,e+t,(function(){return i}),0,null,null,e,e,e+t)])}function Co(e,t,i){this.i=e,this.g=t,this.h=i}function Eo(){To.call(this,[]),this.l=[]}function Io(e){var t=this;this.g=e,this.j=!1,this.i=this.g.Tc(),this.h=new ot((function(){t.g.Me(.25*t.i)}))}function Ro(e){e.h.stop();var t=e.j?0:e.i;if(0<=t)try{return void(e.g.Tc()!=t&&e.g.le(t))}catch(i){}e.h.Ca(.25),0!=e.g.Tc()&&e.g.le(0)}function Lo(e){var t=this;this.h=e,this.g=new Set,this.i=new ot((function(){ko(t,!1)})).Ca(.25)}function ko(e,t){for(var i=l(e.g),r=i.next();!r.done;r=i.next())r.value.j(e.h.currentTime,t)}function Mo(e){xr.call(this),this.g=new Map,this.h=e}function Po(e){xr.call(this);var t=this;this.g=new Set,this.i=e,this.h=new ot((function(){for(var e=t.i(),i=l(t.g),r=i.next();!r.done;r=i.next())(r=r.value).endTime<e.start&&(t.g.delete(r),r=new _r("regionremove",new Map([["region",r]])),t.dispatchEvent(r))})).Ca(2)}function Oo(e){xr.call(this);var t=this;this.i=e,this.g=new Map,this.l=[{rb:null,qb:Fo,ib:function(e,i){return Do(t,"enter",e,i)}},{rb:No,qb:Fo,ib:function(e,i){return Do(t,"enter",e,i)}},{rb:Uo,qb:Fo,ib:function(e,i){return Do(t,"enter",e,i)}},{rb:Fo,qb:No,ib:function(e,i){return Do(t,"exit",e,i)}},{rb:Fo,qb:Uo,ib:function(e,i){return Do(t,"exit",e,i)}},{rb:No,qb:Uo,ib:function(e,i){return Do(t,"skip",e,i)}},{rb:Uo,qb:No,ib:function(e,i){return Do(t,"skip",e,i)}}],this.h=new Nr,this.h.C(this.i,"regionremove",(function(e){t.g.delete(e.region)}))}function Do(e,t,i,r){t=new _r(t,new Map([["region",i],["seeking",r]])),e.dispatchEvent(t)}lo.prototype.release=function(){this.h&&(this.h.release(),this.h=null),null!=this.i&&(this.i.release(),this.i=null),this.l=function(){},this.g=null},mo.prototype.release=function(){this.g&&(this.g.stop(),this.g=null),this.h=null},(n=vo.prototype).yd=function(){var e=this;ho(this.g,HTMLMediaElement.HAVE_CURRENT_DATA,this.i,(function(){null==e.h||0==e.h?e.j=!0:(e.i.ma(e.g,"seeking",(function(){e.j=!0})),e.g.currentTime=Math.max(0,e.g.currentTime+e.h))}))},n.release=function(){this.i&&(this.i.release(),this.i=null),this.g=null},n.zd=function(e){this.h=this.j?this.h:e},n.Ic=function(){return(this.j?this.g.currentTime:this.h)||0},n.ue=function(){return 0},n.te=function(){return 0},n.Ne=function(){},(n=yo.prototype).yd=function(){this.m.Ca(.25)},n.release=function(){this.h&&(this.h.release(),this.h=null),this.j&&(this.j.release(),this.j=null),this.m&&(this.m.stop(),this.m=null),this.i=this.h=this.g=this.l=null,this.u=function(){}},n.zd=function(e){po(this.h,e)},n.Ic=function(){var e=co(this.h);return 0<this.i.readyState&&!this.i.paused?wo(this,e):e},n.ue=function(){return this.o?this.o.o:0},n.te=function(){return this.j.u},n.Ne=function(){this.j.Wd()},(n=To.prototype).release=function(){this.j||(this.g=[],this.h&&this.h.stop(),this.h=null)},n.cg=function(){this.j=!0},n.find=function(e){for(var t=this.g.length-1,i=t;0<=i;--i){var r=this.g[i],n=i<t?this.g[i+1].startTime:r.endTime;if(e>=r.startTime&&e<n)return i+this.i}return this.g.length&&e<this.g[0].startTime?this.i:null},n.get=function(e){return 0==this.g.length||0>(e-=this.i)||e>=this.g.length?null:this.g[e]},n.offset=function(e){if(!this.j)for(var t=l(this.g),i=t.next();!i.done;i=t.next())i.value.offset(e)},n.pc=function(e){if(!this.j&&e.length){var t=Math.round(1e3*e[0].startTime)/1e3;this.g=this.g.filter((function(e){return Math.round(1e3*e.startTime)/1e3<t})),this.g.push.apply(this.g,c(e))}},n.Hb=function(e,t){var i=this;e=e.filter((function(e){return e.endTime>t&&(0==i.g.length||e.endTime>i.g[0].startTime)})),this.pc(e),this.eb(t)},n.eb=function(e){if(!this.j){var t=this.g.length;this.g=this.g.filter((function(t){return t.endTime>e})),this.i+=t-this.g.length}},n.Wa=function(e,t,i){if(i=void 0!==i&&i,!this.j){for(;this.g.length&&this.g[this.g.length-1].startTime>=t;)this.g.pop();for(;this.g.length&&this.g[0].endTime<=e;)this.g.shift(),i||this.i++;0!=this.g.length&&(e=this.g[this.g.length-1],this.g[this.g.length-1]=new ma(e.startTime,t,e.u,e.Ba,e.ka,e.h,e.timestampOffset,e.appendWindowStart,e.appendWindowEnd,e.i,e.tilesLayout,e.s,e.g,e.status,e.l))}},n.fd=function(e,t){var i=this;this.j||(this.h&&this.h.stop(),this.h=new ot((function(){var e=t();e?i.g.push.apply(i.g,c(e)):(i.h.stop(),i.h=null)})),this.h.Ca(e))},To.prototype[Symbol.iterator]=function(){return this.Cb(0)},To.prototype.Cb=function(e){var t=this.find(e);if(null==t)return null;t--;var i=this.get(t+1),r=-1;if(i&&0<i.i.length)for(var n=i.i.length-1;0<=n;--n){var s=i.i[n];if(e>=s.startTime&&e<s.endTime){t++,r=n-1;break}}return new Co(this,t,r)},j("shaka.media.SegmentIndex",To),To.forSingleSegment=Ao,To.prototype.getIteratorForTime=To.prototype.Cb,To.prototype.updateEvery=To.prototype.fd,To.prototype.fit=To.prototype.Wa,To.prototype.evict=To.prototype.eb,To.prototype.mergeAndEvict=To.prototype.Hb,To.prototype.offset=To.prototype.offset,To.prototype.get=To.prototype.get,To.prototype.find=To.prototype.find,To.prototype.markImmutable=To.prototype.cg,To.prototype.release=To.prototype.release,Co.prototype.vf=function(){return this.g},Co.prototype.current=function(){var e=this.i.get(this.g);return e&&0<e.i.length&&e.ya().length&&this.h>=e.i.length&&(this.g++,this.h=0,e=this.i.get(this.g)),e&&0<e.i.length?e.i[this.h]:e},Co.prototype.next=function(){var e=this.i.get(this.g);return e&&0<e.i.length?(this.h++,e.ya().length&&this.h==e.i.length&&(this.g++,this.h=0)):(this.g++,this.h=0),{value:e=this.current(),done:!e}},j("shaka.media.SegmentIterator",Co),Co.prototype.next=Co.prototype.next,Co.prototype.current=Co.prototype.current,Co.prototype.currentPosition=Co.prototype.vf,_(Eo,To),(n=Eo.prototype).clone=function(){var e=new Eo;return e.l=this.l.slice(),e},n.release=function(){for(var e=l(this.l),t=e.next();!t.done;t=e.next())t.value.release();this.l=[]},n.find=function(e){for(var t=0,i=l(this.l),r=i.next();!r.done;r=i.next()){var n=(r=r.value).find(e);if(null!=n)return n+t;t+=r.i+r.g.length}return null},n.get=function(e){for(var t=0,i=l(this.l),r=i.next();!r.done;r=i.next()){var n=(r=r.value).get(e-t);if(n)return n;t+=r.i+r.g.length}return null},n.offset=function(){},n.pc=function(){},n.eb=function(){},n.Hb=function(){},n.Wa=function(){},n.fd=function(){},j("shaka.media.MetaSegmentIndex",Eo),Eo.prototype.updateEvery=Eo.prototype.fd,Eo.prototype.fit=Eo.prototype.Wa,Eo.prototype.mergeAndEvict=Eo.prototype.Hb,Eo.prototype.evict=Eo.prototype.eb,Eo.prototype.merge=Eo.prototype.pc,Eo.prototype.offset=Eo.prototype.offset,Eo.prototype.get=Eo.prototype.get,Eo.prototype.find=Eo.prototype.find,Eo.prototype.release=Eo.prototype.release,Io.prototype.release=function(){this.h&&(this.h.stop(),this.h=null),this.g=null},Io.prototype.set=function(e){this.i=e,Ro(this)},Io.prototype.Pc=function(){return this.g.Pc()},Lo.prototype.release=function(){this.i.stop();for(var e=l(this.g),t=e.next();!t.done;t=e.next())t.value.release();this.g.clear()},_(Mo,xr),Mo.prototype.release=function(){this.g.clear(),xr.prototype.release.call(this)},Mo.prototype.j=function(e){for(var t=l(this.g.values()),i=t.next();!i.done;i=t.next()){e:{for(var r=(i=i.value).rc,n=r.length-1;0<=n;n--){var s=r[n];if(s.position<=e){r=s.Od;break e}}r=null}if((n=r)&&(n=!((n=i.Ae)===r||n&&r&&n.bandwidth==r.bandwidth&&n.audioSamplingRate==r.audioSamplingRate&&n.codecs==r.codecs&&n.contentType==r.contentType&&n.frameRate==r.frameRate&&n.height==r.height&&n.mimeType==r.mimeType&&n.channelsCount==r.channelsCount&&n.pixelAspectRatio==r.pixelAspectRatio&&n.width==r.width)),n)e:{if(n=e,s=r.contentType,(s=this.h()[s])&&0<s.length){var a=s[s.length-1].end;if(n>=s[0].start&&n<a){n=!0;break e}}n=!1}n&&(i.Ae=r,JSON.stringify(r),i=new _r("qualitychange",new Map([["quality",r],["position",e]])),this.dispatchEvent(i))}},_(Po,xr),Po.prototype.release=function(){this.g.clear(),this.h.stop(),xr.prototype.release.call(this)},_(Oo,xr),Oo.prototype.release=function(){this.i=null,this.g.clear(),this.h.release(),this.h=null,xr.prototype.release.call(this)},Oo.prototype.j=function(e,t){for(var i=l(this.i.g),r=i.next();!r.done;r=i.next()){r=r.value;var n=this.g.get(r),s=e<r.startTime?No:e>r.endTime?Uo:Fo;this.g.set(r,s);for(var a=l(this.l),o=a.next();!o.done;o=a.next())(o=o.value).rb==n&&o.qb==s&&o.ib(r,t)}};var No=1,Fo=2,Uo=3;function zo(e,t,i,r,n){return e=Er(e,r,n),0==t&&null==i||(e.headers.Range=i?"bytes="+t+"-"+i:"bytes="+t+"-"),e}function Bo(e,t){var i=this;this.g=t,this.m=e,this.i=null,this.u=1,this.o=this.l=null,this.D=!1,this.j=new Map,this.B=!1,this.F=null,this.s=!1,this.h=new Or((function(){return function(e){var t,i,r,n;return P((function(s){if(1==s.g){for(t=[],i=l(e.j.values()),r=i.next();!r.done;r=i.next())Jo(n=r.value),t.push(eh(n));return b(s,Promise.all(t),2)}e.j.clear(),e.g=null,e.m=null,e.i=null,w(s)}))}(i)}))}function jo(e,t){var i=e.j.get("video");if(i){var r=i.stream;r&&(t?(t=r.trickModeVideo)&&!i.ob&&(Wo(e,t,!1,0,!1),i.ob=r):(r=i.ob)&&(i.ob=null,Wo(e,r,!0,0,!1)))}}function Ho(e,t,i,r,n,s){i=void 0!==i&&i,r=void 0===r?0:r,n=void 0!==n&&n,s=void 0!==s&&s,e.l=t,e.B&&(t.video&&Wo(e,t.video,i,r,n,s),t.audio&&Wo(e,t.audio,i,r,n,s))}function Vo(e,t){e.o=t,e.B&&Wo(e,t,!0,0,!1)}function Wo(e,t,i,r,n,s){var a=e.j.get(t.type);a||t.type!=tt?a&&(a.ob&&(t.trickModeVideo?(a.ob=t,t=t.trickModeVideo):a.ob=null),a.stream!=t||n)&&(t.type==tt&&Fa(e.g.R,Wt(t.mimeType,t.codecs),e.m.sequenceMode),a.stream.closeSegmentIndex&&a.stream.closeSegmentIndex(),a.stream=t,a.aa=null,a.ve=!!s,i&&(a.ac?a.hd=!0:a.ra?(a.bb=!0,a.Nc=r,a.hd=!0):(Jo(a),Zo(e,a,!0,r).catch((function(t){e.g&&e.g.onError(t)})))),function(e,t){var i,r;return P((function(n){if(1==n.g)return t.ta?(i=t.stream,r=t.ta,i.segmentIndex?n.A(2):b(n,i.createSegmentIndex(),2)):n.return();if(t.ta!=r||t.stream!=i)return n.return();var s=e.g.Sc(),a=Ba(e.g.R,t.type),o=t.stream.segmentIndex.find(t.pa?t.pa.endTime:s),h=null==o?null:t.stream.segmentIndex.get(o);o=h&&h.ka?h.ka-h.Ba:null,h&&!o&&(o=(h.endTime-h.getStartTime())*(t.stream.bandwidth||0)/8),o?((h=h.h)&&(o+=(h.ka?h.ka-h.Ba:null)||0),s=8*o/(h=e.g.getBandwidthEstimate())<(a||0)-s-Math.max(e.m.minBufferTime||0,e.i.rebufferingGoal)||t.ta.h.g>o):s=!1,s&&t.ta.abort(),w(n)}))}(e,a).catch((function(t){e.g&&e.g.onError(t)}))):function(e,t){var i,r,n,s;P((function(a){switch(a.g){case 1:return i=it,T(a,2),b(a,Va(e.g.R,i.X),4);case 4:A(a,3);break;case 2:r=C(a),e.g&&e.g.onError(r);case 3:n=Wt(t.mimeType,t.codecs),Fa(e.g.R,n,e.m.sequenceMode),(e.g.R.m.isTextVisible()||e.i.alwaysStreamText)&&(s=Xo(t),e.j.set(i.X,s),Qo(e,s,0)),w(a)}}))}(e,t)}function Go(e,t){t.ac||t.bb||(t.ra?(t.bb=!0,t.Nc=0):null==za(e.g.R,t.type)?null==t.Ka&&Qo(e,t,0):(Jo(t),Zo(e,t,!1,0).catch((function(t){e.g&&e.g.onError(t)}))))}function Xo(e){return{stream:e,type:e.type,aa:null,pa:null,Zc:null,Kd:null,Jd:null,Id:null,ob:null,endOfStream:!1,ra:!1,Ka:null,bb:!1,Nc:0,hd:!1,ac:!1,vc:!0,Rd:!1,be:!1,nc:!1,ta:null}}function qo(t,i){var r,n,s,a,o;return P((function(h){switch(h.g){case 1:if(Dr(t.h),i.ra||null==i.Ka||i.ac)return h.return();if(i.Ka=null,!i.bb){h.A(2);break}return b(h,Zo(t,i,i.hd,i.Nc),3);case 3:return h.return();case 2:if(i.stream.segmentIndex){h.A(4);break}return r=i.stream,b(h,i.stream.createSegmentIndex(),5);case 5:if(r!=i.stream)return r.closeSegmentIndex&&r.closeSegmentIndex(),i.ra||i.Ka||Qo(t,i,0),h.return();case 4:T(h,6),n=function(t,i){if($o(i))return function(e,t){var i=Ba(e,"video")||0;Zt(e.g,t,i)}(t.g.R,i.stream.originalId||""),null;i.type==tt&&function(e){e.g&&Zt(e.g,"",0)}(t.g.R);var r=t.g.Sc(),n=i.pa?i.pa.endTime:r,s=function(e,t,i){return t==tt?null==(e=e.g).h||e.h<i?0:e.h-Math.max(i,e.g):wa(e=ja(e,t),i)}(t.g.R,i.type,r),a=Math.max(t.m.minBufferTime||0,t.i.rebufferingGoal,t.i.bufferingGoal)*t.u,o=t.m.presentationTimeline.getDuration()-n,h=Ba(t.g.R,i.type);if(1e-6>o&&h)return i.endOfStream=!0,"video"==i.type&&(t=t.j.get(tt))&&$o(t)&&(t.endOfStream=!0),null;if(i.endOfStream=!1,s>=a)return t.i.updateIntervalSeconds/2;if(s=function(e,t,i,r){if(t.aa)return t.aa.current();if(t.pa||r)return i=t.pa?t.pa.endTime:r,t.Rd=!0,t.aa=t.stream.segmentIndex.Cb(i),t.aa&&t.aa.next().value;e=e.i.inaccurateManifestTolerance,r=Math.max(i-e,0);var n=null;return e&&(t.aa=t.stream.segmentIndex.Cb(r),n=t.aa&&t.aa.next().value),n||(t.aa=t.stream.segmentIndex.Cb(i),n=t.aa&&t.aa.next().value),n}(t,i,r,h),!s)return t.i.updateIntervalSeconds;for(a=1/0,o=l(o=Array.from(t.j.values())),h=o.next();!h.done;h=o.next())$o(h=h.value)||h.aa&&!h.aa.current()||(a=Math.min(a,h.pa?h.pa.endTime:r));return n>=a+t.m.presentationTimeline.g?t.i.updateIntervalSeconds:(function(t,i,r,n){var s,a,o,h,u,l,c,d,p,g,f,m,_,v;return P((function(y){switch(y.g){case 1:if(s=it,a=i.stream,o=i.aa,i.ra=!0,T(y,2),2==n.Eb())throw new Me(1,1,1011);return b(y,function(e,t,i){var r,n,s,a,o,h,u,l;return P((function(c){return r=[],n=Math.max(0,i.appendWindowStart-.1),s=i.appendWindowEnd+.01,(a=i.timestampOffset)==t.Kd&&n==t.Jd&&s==t.Id||(o=function(){var i;return P((function(r){if(1==r.g)return T(r,2),t.Jd=n,t.Id=s,t.Kd=a,b(r,function(e,t,i,r,n,s){return P((function(a){return t==it.X?(s||(e.g.s=i),function(e,t,i){e.l=t,e.m=i}(e.g,r,n),a.return()):b(a,Promise.all([$a(e,t,(function(){return Xa(e,t)})),s?Promise.resolve():$a(e,t,(function(){return qa(e,t,i)})),$a(e,t,(function(){e.h[t].appendWindowStart=0,e.h[t].appendWindowEnd=n,e.h[t].appendWindowStart=r,Ya(e,t)}))]),0)}))}(e.g.R,t.type,a,n,s,e.m.sequenceMode),4);if(2!=r.g)return A(r,0);throw i=C(r),t.Jd=null,t.Id=null,t.Kd=null,i}))},r.push(o())),!function(e,t){return e&&t?e.lc()==t.lc()&&e.hc()==t.hc()&&ne(e.ya(),t.ya()):e==t}(i.h,t.Zc)&&(t.Zc=i.h)&&(h=Ko(e,t,i.h),u=function(){var r,n,s;return P((function(a){switch(a.g){case 1:return T(a,2),b(a,h,4);case 4:return r=a.h,Dr(e.h),(new Xr).box("moov",qr).box("trak",qr).box("mdia",qr).P("mdhd",(function(e){e=aa(e.reader||0,e.version||0),i.h.timescale=e.timescale})).parse(r),n=t.stream.closedCaptions&&0<t.stream.closedCaptions.size,b(a,e.g.xe(t.type,r),5);case 5:return b(a,Ha(e.g.R,t.type,r,null,n),6);case 6:A(a,0);break;case 2:throw s=C(a),t.Zc=null,s}}))},e.g.fg(i.startTime,i.h),r.push(u())),e.m.sequenceMode&&(l=t.pa?t.pa.m:null,i.m!=l||t.Rd)&&(t.Rd=!1,r.push(function(e,t,i){return P((function(r){return t==it.X?r.return():($a(e,t,(function(){return Xa(e,t)})),b(r,$a(e,t,(function(){return qa(e,t,i)})),0))}))}(e.g.R,t.type,i.startTime))),b(c,Promise.all(r),0)}))}(t,i,n),4);case 4:return Dr(t.h),t.s?y.return():(h="video/mp4"==a.mimeType||"audio/mp4"==a.mimeType,u=e.ReadableStream,t.i.lowLatencyMode&&u&&h&&!n.l?(c=new Uint8Array(0),p=d=!1,g=function(e){var s,o,h;return P((function(u){return d?u.return():(p=!0,Dr(t.h),t.s?u.return():(c=function(e,t){var i=new Uint8Array(e.length+t.length);return i.set(e),i.set(t,e.length),i}(c,e),s=!1,o=0,(new Xr).box("mdat",(function(e){o=e.size+e.start,s=!0})).parse(c,!1,!0),s?(h=c.subarray(0,o),c=c.subarray(o),b(u,Yo(t,i,r,a,n,h),0)):u.A(0)))}))},b(y,Ko(t,i,n,g),11)):b(y,Ko(t,i,n),7));case 7:if(l=y.h,Dr(t.h),t.s)return y.return();if(!n.l){y.A(8);break}return b(y,function(t,i,r){var n,s,a,o;return P((function(h){if(1==h.g)return(n=i.l).cryptoKey?h.A(2):b(h,n.fetchKey(),3);if(!(s=n.iv))for(s=Re(new ArrayBuffer(16)),a=n.firstMediaSequenceNumber+r.g,o=s.byteLength-1;0<=o;o--)s[o]=255&a,a>>=8;return h.return(e.crypto.subtle.decrypt({name:"AES-CBC",iv:s},n.cryptoKey,t))}))}(l,n,o),9);case 9:l=y.h;case 8:return Dr(t.h),i.bb?(i.ra=!1,Qo(t,i,0),y.return()):b(y,Yo(t,i,r,a,n,l),6);case 11:if(f=y.h,p){y.A(6);break}return d=!0,Dr(t.h),t.s?y.return():i.bb?(i.ra=!1,Qo(t,i,0),y.return()):b(y,Yo(t,i,r,a,n,f),6);case 6:if(Dr(t.h),t.s)return y.return();i.pa=n,o.next(),i.ra=!1,i.be=!1,m=t.g.R.Na(),_=m[i.type],JSON.stringify(_),i.bb||t.g.Wd(n.startTime,n.endTime,i.type),Qo(t,i,0),A(y,0);break;case 2:if(v=C(y),Dr(t.h,v),t.s)return y.return();if(i.ra=!1,7001==v.code)i.ra=!1,Jo(i),Qo(t,i,0),y.A(0);else if(i.type==s.X&&t.i.ignoreTextStreamFailures)t.j.delete(s.X),y.A(0);else{if(3017!=v.code)return i.nc=!0,v.severity=2,b(y,th(t,v),0);(function(e,t,i){if(!Array.from(e.j.values()).some((function(e){return e!=t&&e.be}))){var r=Math.round(100*e.u);if(20<r)e.u-=.2;else{if(!(4<r))return t.nc=!0,e.s=!0,void e.g.onError(i);e.u-=.04}t.be=!0}Qo(e,t,4)})(t,i,v),y.A(0)}}}))}(t,i,r,s).catch((function(){})),null)}(t,i),null!=n&&(Qo(t,i,n),i.nc=!1),A(h,7);break;case 6:return s=C(h),b(h,th(t,s),8);case 8:return h.return();case 7:if(a=Array.from(t.j.values()),!t.B||!a.every((function(e){return e.endOfStream}))){h.A(0);break}return b(h,t.g.R.endOfStream(),10);case 10:Dr(t.h),0!=(o=t.g.R.getDuration())&&o<t.m.presentationTimeline.getDuration()&&t.m.presentationTimeline.Aa(o),w(h)}}))}function Yo(e,t,i,r,n,s){var a,o,h,u,l,c;return P((function(d){switch(d.g){case 1:return a=r.closedCaptions&&0<r.closedCaptions.size,h=null!=r.emsgSchemeIdUris&&0<r.emsgSchemeIdUris.length||e.i.dispatchAllEmsgBoxes,u=e.i.parsePrftBox&&!e.D,(h||u)&&(o=new Xr),h&&o.P("emsg",(function(t){var i=r.emsgSchemeIdUris;if(0===t.version)var s=t.reader.sc(),a=t.reader.sc(),o=t.reader.K(),h=t.reader.K(),u=t.reader.K(),l=t.reader.K(),c=n.startTime+h/o;else o=t.reader.K(),h=(c=t.reader.$a()/o+n.timestampOffset)-n.startTime,u=t.reader.K(),l=t.reader.K(),s=t.reader.sc(),a=t.reader.sc();t=t.reader.Za(t.reader.S.byteLength-t.reader.Z()),(i&&i.includes(s)||e.i.dispatchAllEmsgBoxes)&&("urn:mpeg:dash:event:2012"==s?e.g.gg():"https://aomedia.org/emsg/ID3"==s?(i=Ea(t)).length&&n&&e.g.hg([{cueTime:n.startTime,data:t,frames:i,dts:n.startTime,pts:n.startTime}],0,n.endTime):(i=new _r("emsg",i=(new Map).set("detail",{startTime:c,endTime:c+u/o,schemeIdUri:s,value:a,timescale:o,presentationTimeDelta:h,eventDuration:u,id:l,messageData:t})),e.g.onEvent(i)))})),u&&o.P("prft",(function(t){e:{if(!e.D&&n.h.timescale){t.reader.K();var i=t.reader.K();if(i=1e3*i+t.reader.K()/Math.pow(2,32)*1e3,0===t.version)var r=t.reader.K();else try{r=t.reader.$a()}catch(s){e.D=!0,r=void 0;break e}t=new Date(new Date(Date.UTC(1900,0,1,0,0,0)).getTime()+i).getTime(),r=new _r("prft",r=(new Map).set("detail",{wallClockTime:t,programStartDate:new Date(t-r/n.h.timescale*1e3)})),e.g.onEvent(r),e.D=!0}r=void 0}return r})),(h||u)&&o.parse(s),b(d,function(e,t,i){var r,n,s;return P((function(a){if(1==a.g)return r=Math.max(e.i.bufferBehind,e.m.presentationTimeline.g),null==(n=za(e.g.R,t.type))||.01>=(s=i-n-r)?a.return():b(a,e.g.R.remove(t.type,n,n+s),2);Dr(e.h),w(a)}))}(e,t,i),2);case 2:return Dr(e.h),l=t.vc,t.vc=!1,c=t.ve,t.ve=!1,b(d,e.g.xe(t.type,s),3);case 3:return b(d,Ha(e.g.R,t.type,s,n,a,l,c),4);case 4:Dr(e.h),w(d)}}))}function $o(e){return e&&e.type==tt&&("application/cea-608"==e.stream.mimeType||"application/cea-708"==e.stream.mimeType)}function Ko(e,t,i,r){var n,s,a,o,h;return P((function(u){return 1==u.g?(n=kr,s=zo(i.ya(),i.Ba,i.ka,e.i.retryParameters,r),a=t.stream,e.g.modifySegmentRequest(s,{type:a.type,init:i instanceof fa,duration:i.endTime-i.startTime,mimeType:a.mimeType,codecs:a.codecs,bandwidth:a.bandwidth}),o=e.g.kb.request(n,s),t.ta=o,b(u,o.promise,2)):(h=u.h,t.ta=null,u.return(h.data))}))}function Zo(e,t,i,r){var n,s;return P((function(a){return 1==a.g?(t.bb=!1,t.hd=!1,t.Nc=0,t.ac=!0,t.pa=null,t.Zc=null,t.aa=null,r?(n=e.g.Sc(),s=e.g.R.getDuration(),b(a,e.g.R.remove(t.type,n+r,s),3)):b(a,Va(e.g.R,t.type),4)):3!=a.g?(Dr(e.h),i?b(a,e.g.R.flush(t.type),3):a.A(3)):(Dr(e.h),t.ac=!1,t.endOfStream=!1,t.ra||t.Ka||Qo(e,t,0),void w(a))}))}function Qo(e,t,i){var r=t.type;(r!=tt||e.j.has(r))&&(t.Ka=new at((function(){var i;return P((function(r){return 1==r.g?(T(r,2),b(r,qo(e,t),4)):2!=r.g?A(r,0):(i=C(r),e.g&&e.g.onError(i),void w(r))}))})).N(i))}function Jo(e){null!=e.Ka&&(e.Ka.stop(),e.Ka=null)}function eh(e){return P((function(t){return e.ta?b(t,e.ta.abort(),0):t.A(0)}))}function th(e,t){return P((function(i){if(1==i.g)return b(i,lr(e.F),2);Dr(e.h),e.g.onError(t),t.handled||e.i.failureCallback(t),w(i)}))}function ih(e,t){var i=Vu(),r=this;this.j=t,this.i=e,this.l=i,this.o=null,this.m=[],this.h=this.g=null,this.u=Promise.resolve().then((function(){return function(e){return P((function(t){if(e.s.g)t=t.A(0);else{if(0==e.m.length||e.g&&!e.g.hb)var i=!1;else{e.g&&(e.g.Ia.mb(),e.g=null);var r=(i=e.m.shift()).create(e.l);r?(i.Ia.Jb(),e.g={node:r.node,payload:r.payload,hb:r.hb,Ia:i.Ia}):i.Ia.dd(),i=!0}i?i=Promise.resolve():e.g?i=function(e){var t,i;return P((function(r){switch(r.g){case 1:return e.i=e.j.Mf(e.i,e.l,e.g.node,e.g.payload),T(r,2),e.h=e.j.yf(e.i,e.l,e.g.payload),b(r,e.h.promise,4);case 4:e.h=null,e.i==e.g.node&&(e.g.Ia.bd(),e.g=null),A(r,0);break;case 2:return 7001==(t=C(r)).code?e.g.Ia.mb():e.g.Ia.onError(t),e.g=null,e.h=null,i=e,b(r,e.j.handleError(e.l,t),5);case 5:i.i=r.h,w(r)}}))}(e):(e.j.eg(e.i),e.o=new nt,i=e.o),t=b(t,i,1)}return t}))}(r)})),this.s=new Or((function(){return function(e){var t,i;return P((function(r){if(1==r.g)return e.h&&e.h.abort(),nh(e),b(r,e.u,2);for(e.g&&e.g.Ia.mb(),t=l(e.m),i=t.next();!i.done;i=t.next())i.value.Ia.mb();e.g=null,e.m=[],e.j=null,w(r)}))}(r)}))}function rh(e,t){var i={Jb:function(){},bd:function(){},mb:function(){},onError:function(){},dd:function(){},uh:function(){}};return e.m.push({create:t,Ia:i}),e.h&&e.h.abort(),nh(e),i}function nh(e){e.o&&(e.o.resolve(),e.o=null)}function sh(e){var t=[],i=700<=e.fontWeight,r="italic"==e.fontStyle,n=e.textDecoration.includes("underline");return i&&t.push("b"),r&&t.push("i"),n&&t.push("u"),i=t.reduce((function(e,t){return e+"<"+t+">"}),""),t=t.reduceRight((function(e,t){return e+"</"+t+">"}),""),e.lineBreak?"\n":e.nestedCues.length?e.nestedCues.map(sh).join(""):i+e.payload+t}function ah(e,t){for(var i=(e=l(e)).next();!i.done;i=e.next())if((i=i.value).isContainer)ah(i.nestedCues,t);else{var r=i.clone();r.nestedCues=[],r.payload=sh(i),t.push(r)}return t}function oh(e){this.g=null;for(var t=l(Array.from(e.textTracks)),i=t.next();!i.done;i=t.next())(i=i.value).mode="disabled","Shaka Player TextTrack"==i.label&&(this.g=i);this.g||(this.g=e.addTextTrack("subtitles","Shaka Player TextTrack")),this.g.mode="hidden"}function hh(e){if(e.startTime>=e.endTime)return null;var t=new VTTCue(e.startTime,e.endTime,e.payload);t.lineAlign=e.lineAlign,t.positionAlign=e.positionAlign,e.size&&(t.size=e.size);try{t.align=e.textAlign}catch(i){}return"center"==e.textAlign&&"center"!=t.align&&(t.align="middle"),"vertical-lr"==e.writingMode?t.vertical="lr":"vertical-rl"==e.writingMode&&(t.vertical="rl"),1==e.lineInterpretation&&(t.snapToLines=!1),null!=e.line&&(t.line=e.line),null!=e.position&&(t.position=e.position),t}function uh(e,t){var i=e.mode;e.mode="showing"==i?"showing":"hidden";for(var r=l(Array.from(e.cues)),n=r.next();!n.done;n=r.next())(n=n.value)&&t(n)&&e.removeCue(n);e.mode=i}function lh(){}function ch(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function dh(t,i){var r=this;this.j=!1,this.i=[],this.B=t,this.m=i,this.g=document.createElement("div"),this.g.classList.add("shaka-text-container"),this.g.style.textAlign="center",this.g.style.display="flex",this.g.style.flexDirection="column",this.g.style.alignItems="center",this.g.style.justifyContent="flex-end",this.m.appendChild(this.g),this.u=new ot((function(){fh(r)})).Ca(.25),this.h=new Map,this.s=new Nr,this.s.C(document,"fullscreenchange",(function(){fh(r,!0)})),this.l=null,"ResizeObserver"in e&&(this.l=new ResizeObserver((function(){fh(r,!0)})),this.l.observe(this.g)),this.o=new Map}function ph(e,t){for(;null!=t;){if(t==e.g)return!0;t=t.parentElement}return!1}function gh(e,t,i,r,n){for(var s=!1,a=[],o=[],h=(t=l(t)).next();!h.done;h=t.next()){h=h.value,n.push(h);var u=e.h.get(h),c=h.startTime<=r&&h.endTime>r,d=u?u.ef:null;u&&(a.push(u.Bd),u.tc&&a.push(u.tc),c||(s=!0,e.h.delete(h),u=null)),c&&(o.push(h),u?ph(e,d)||(s=!0):(mh(e,h,n),d=(u=e.h.get(h)).ef,s=!0)),0<h.nestedCues.length&&d&&gh(e,h.nestedCues,d,r,n),n.pop()}if(s){for(n=(r=l(a)).next();!n.done;n=r.next())(n=n.value).parentElement&&n.parentElement.removeChild(n);for(o.sort((function(e,t){return e.startTime!=t.startTime?e.startTime-t.startTime:e.endTime-t.endTime})),h=(o=l(o)).next();!h.done;h=o.next())(r=e.h.get(h.value)).tc?(i.appendChild(r.tc),r.tc.appendChild(r.Bd)):i.appendChild(r.Bd)}}function fh(e,t){if(e.g){var i=e.B.currentTime;if(!e.j||void 0!==t&&t){for(var r=(t=l(e.o.values())).next();!r.done;r=t.next())ch(r.value);ch(e.g),e.h.clear(),e.o.clear()}if(e.j){t=new Map;for(var n=(r=l(e.h.keys())).next();!n.done;n=r.next())n=n.value,t.set(n,e.h.get(n));gh(e,e.i,e.g,i,[])}}}function mh(e,t,i){var r=1<i.length,n=r?"span":"div";t.lineBreak&&(n="br"),r=!r&&0<t.nestedCues.length;var s=document.createElement(n);if("br"!=n&&function(e,t,i,r,n){var s=t.style,a=0==i.nestedCues.length,o=1<r.length;s.whiteSpace="pre-wrap";var h=i.payload.replace(/\s+$/g,(function(e){return" ".repeat(e.length)}));if(s.webkitTextStrokeColor=i.textStrokeColor,s.webkitTextStrokeWidth=i.textStrokeWidth,s.color=i.color,s.direction=i.direction,s.opacity=i.opacity,s.paddingLeft=_h(i.linePadding,i,e.m),s.paddingRight=_h(i.linePadding,i,e.m),s.textShadow=i.textShadow,i.backgroundImage)s.backgroundImage="url('"+i.backgroundImage+"')",s.backgroundRepeat="no-repeat",s.backgroundSize="contain",s.backgroundPosition="center",s.width="100%",s.height="100%";else{if(i.nestedCues.length)var u=t;else u=document.createElement("span"),t.appendChild(u);i.border&&(u.style.border=i.border),n||((t=function(e,t){for(var i=e.length-1;0<=i;i--){var r=t(e[i]);if(r||0===r)return r}return null}(r,(function(e){return e.backgroundColor})))?u.style.backgroundColor=t:h&&(u.style.backgroundColor="rgba(0, 0, 0, 0.8)")),h&&(u.textContent=h)}o&&!r[r.length-1].isContainer?s.display="inline":(s.display="flex",s.flexDirection="column",s.alignItems="center",s.justifyContent="before"==i.displayAlign?"flex-start":"center"==i.displayAlign?"center":"flex-end"),a||(s.margin="0"),s.fontFamily=i.fontFamily,s.fontWeight=i.fontWeight.toString(),s.fontStyle=i.fontStyle,s.letterSpacing=i.letterSpacing,s.fontSize=_h(i.fontSize,i,e.m),null!=i.line&&1==i.lineInterpretation&&(s.position="absolute",i.writingMode==pe?(s.width="100%",i.lineAlign==fe?s.top=i.line+"%":"end"==i.lineAlign&&(s.bottom=100-i.line+"%")):"vertical-lr"==i.writingMode?(s.height="100%",i.lineAlign==fe?s.left=i.line+"%":"end"==i.lineAlign&&(s.right=100-i.line+"%")):(s.height="100%",i.lineAlign==fe?s.right=i.line+"%":"end"==i.lineAlign&&(s.left=100-i.line+"%"))),s.lineHeight=i.lineHeight,null!=i.position&&(i.writingMode==pe?s.paddingLeft=i.position:s.paddingTop=i.position),"line-left"==i.positionAlign?s.cssFloat="left":"line-right"==i.positionAlign&&(s.cssFloat="right"),s.textAlign=i.textAlign,s.textDecoration=i.textDecoration.join(" "),s.writingMode=i.writingMode,"writingMode"in document.documentElement.style&&s.writingMode==i.writingMode||(s.webkitWritingMode=i.writingMode),i.size&&(i.writingMode==pe?s.width=i.size+"%":s.height=i.size+"%")}(e,s,t,i,r),i=null,t.region&&t.region.id)if(n=(i=t.region).id+"_"+i.width+"x"+i.height+(i.heightUnits==Te?"%":"px")+"-"+i.viewportAnchorX+"x"+i.viewportAnchorY+(i.viewportAnchorUnits==Te?"%":"px"),e.o.has(n))i=e.o.get(n);else{var a=document.createElement("span"),o=i.heightUnits==Te?"%":"px",h=i.widthUnits==Te?"%":"px",u=i.viewportAnchorUnits==Te?"%":"px";a.id="shaka-text-region---"+n,a.classList.add("shaka-text-region"),a.style.height=i.height+o,a.style.width=i.width+h,a.style.position="absolute",a.style.top=i.viewportAnchorY+u,a.style.left=i.viewportAnchorX+u,a.style.display="flex",a.style.flexDirection="column",a.style.alignItems="center",a.style.justifyContent="before"==t.displayAlign?"flex-start":"center"==t.displayAlign?"center":"flex-end",e.o.set(n,a),i=a}n=s,r&&((n=document.createElement("span")).classList.add("shaka-text-wrapper"),n.style.backgroundColor=t.backgroundColor,n.style.lineHeight="normal",s.appendChild(n)),e.h.set(t,{Bd:s,ef:n,tc:i})}function _h(e,t,i){var r=(r=new RegExp(/(\d*\.?\d+)([a-z]+|%+)/).exec(e))?{value:Number(r[1]),unit:r[2]}:null;if(!r)return e;var n=r.value;switch(r.unit){case"%":return n/100*i.clientHeight/t.cellResolution.rows+"px";case"c":return i.clientHeight*n/t.cellResolution.rows+"px";default:return e}}function vh(e,t){this.h=e,this.g=t,this.j="",this.o=void 0,this.i=!1,this.m=!0,this.l=!1}function yh(e,t,i){try{if(e.g.enabled){var r={d:1e3*i.duration,st:e.h.U()?Mh:kh};r.ot=function(e){var t=e.type;if(e.init)return Ih;if("video"==t)return e.codecs.includes(",")?Eh:Ch;if("audio"==t)return Ah;if("text"==t)return"application/mp4"===e.mimeType?Lh:Rh}(i);var n=r.ot===Ch||r.ot===Ah||r.ot===Eh||r.ot===Lh;n&&(r.bl=function(e,t){if(t=e.h.Na()[t],!t.length)return NaN;var i=e.h.getCurrentTime();return(e=t.find((function(e){return e.start<=i&&e.end>=i})))?1e3*(e.end-i):NaN}(e,i.type)),i.bandwidth&&(r.br=i.bandwidth/1e3),n&&r.ot!==Lh&&(r.tb=function(e,t){var i=e.h.Xa();if(!i.length)return NaN;e=i[0];for(var r=(i=l(i)).next();!r.done;r=i.next())"variant"===(r=r.value).type&&r.bandwidth>e.bandwidth&&(e=r);switch(t){case Ch:return e.videoBandwidth||NaN;case Ah:return e.audioBandwidth||NaN;default:return e.bandwidth}}(e,r.ot)/1e3),bh(e,t,r)}}catch(s){Y("CMCD_SEGMENT_ERROR","Could not generate segment CMCD data.",s)}}function xh(t){return t.j||(t.j=t.g.sessionId||e.crypto.randomUUID()),{v:1,sf:t.o,sid:t.j,cid:t.g.contentId,mtp:t.h.getBandwidthEstimate()/1e3}}function bh(e,t,i){i=void 0===i?{}:i;var r=void 0===r?e.g.useHeaders:r;if(e.g.enabled){Object.assign(i,xh(e)),i.pr=e.h.Rc();var n=i.ot===Ch||i.ot===Eh;if(e.l&&n&&(i.bs=!0,i.su=!0,e.l=!1),null==i.su&&(i.su=e.m),r)e=function(e){for(var t=Object.keys(e),i={},r=["Object","Request","Session","Status"],n=[{},{},{},{}],s={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},a=(t=l(t)).next();!a.done;a=t.next())a=a.value,n[null!=s[a]?s[a]:1][a]=e[a];for(e=0;e<n.length;e++)(s=wh(n[e]))&&(i["CMCD-"+r[e]]=s);return i}(i),Object.keys(e).length&&Object.assign(t.headers,e);else{var s=wh(i);s&&(t.uris=t.uris.map((function(e){return Th(e,s)})))}}}function wh(e){function t(e){return 100*i(e/100)}function i(e){return Math.round(e)}for(var r,n=[],s={br:i,d:i,bl:t,dl:t,mtp:t,nor:function(e){return encodeURIComponent(e)},rtp:t,tb:i},a=Object.keys(e||{}).sort(),o=(a=l(a)).next();!o.done;o=a.next()){var h=e[o=o.value];if(!(r=h,Number.isNaN(r)||null==r||""===r||!1===r||"v"===o&&1===h||"pr"==o&&1===h)){var u=s[o];u&&(h=u(h));var c;c="string"===(u=typeof h)&&"ot"!==o&&"sf"!==o&&"st"!==o?o+"="+JSON.stringify(h):"boolean"===u?o:"symbol"===u?o+"="+h.description:o+"="+h,n.push(c)}}return n.join(",")}function Th(e,t){return!t||e.includes("offline:")?e:((e=new Oe(e)).g.set("CMCD",t),e.toString())}(n=Bo.prototype).destroy=function(){return this.h.destroy()},n.configure=function(e){this.i=e,this.F=new ur({maxAttempts:Math.max(e.retryParameters.maxAttempts,2),baseDelay:e.retryParameters.baseDelay,backoffFactor:e.retryParameters.backoffFactor,fuzzFactor:e.retryParameters.fuzzFactor,timeout:0,stallTimeout:0,connectionTimeout:0},!0)},n.start=function(){var e=this;return P((function(t){if(1==t.g)return b(t,function(e){var t,i,r,n,s,a,o,h,u,c;return P((function(d){if(1==d.g){if(t=it,!e.l)throw new Me(2,5,5006);return i=new Map,r=new Set,e.l.audio&&(i.set(t.Hc,e.l.audio),r.add(e.l.audio)),e.l.video&&(i.set(t.va,e.l.video),r.add(e.l.video)),e.o&&(i.set(t.X,e.o),r.add(e.o)),n=e.g.R,s=e.i.forceTransmux,b(d,n.init(i,s,e.m.sequenceMode),2)}for(Dr(e.h),e.updateDuration(),a=l(i.keys()),o=a.next();!o.done;o=a.next())h=o.value,u=i.get(h),e.j.has(h)||(c=Xo(u),e.j.set(h,c),Qo(e,c,0));w(d)}))}(e),2);Dr(e.h),e.B=!0,w(t)}))},n.vc=function(){if(this.g)for(var e=this.g.Sc(),t=l(this.j.keys()),i=t.next();!i.done;i=t.next()){var r=i.value;(i=this.j.get(r)).aa=null;var n=this.g.R;if(r==tt?n=null!=(n=n.g).g&&null!=n.h&&(e>=n.g&&e<n.h):n=ba(n=ja(n,r),e),!n){if((null!=Ba(this.g.R,r)||i.ra)&&Go(this,i),i.ta&&(i.ta.abort(),i.ta=null),r===tt&&(r=this.g.R).s)for((r=r.s.g).l=0,r.h=[],r.g=[],(n=r.i).i=[],n.h=[],n.g=0,Js(r),n=(r=l(r.j.values())).next();!n.done;n=r.next())Ys(n.value);i.vc=!0}}},n.updateDuration=function(){var e=this.m.presentationTimeline.getDuration();1/0>e?this.g.R.Aa(e):this.g.R.Aa(Math.pow(2,32))},ih.prototype.destroy=function(){return this.s.destroy()},(n=oh.prototype).remove=function(e,t){return!!this.g&&(uh(this.g,(function(i){return i.startTime<t&&i.endTime>e})),!0)},n.append=function(e){var t=ah(e,[]),i=[];e=this.g.cues?Array.from(this.g.cues):[];for(var r={},n=(t=l(t)).next();!n.done;r={sb:r.sb},n=t.next())r.sb=n.value,e.some(function(e){return function(t){return t.startTime==e.sb.startTime&&t.endTime==e.sb.endTime&&t.text==e.sb.payload}}(r))||(n=hh(r.sb))&&i.push(n);for(r=(e=l(e=i.slice().sort((function(e,t){return e.startTime!=t.startTime?e.startTime-t.startTime:e.endTime!=t.endTime?e.endTime-t.startTime:"line"in VTTCue.prototype?i.indexOf(t)-i.indexOf(e):i.indexOf(e)-i.indexOf(t)})))).next();!r.done;r=e.next())this.g.addCue(r.value)},n.destroy=function(){return this.g&&(uh(this.g,(function(){return!0})),this.g.mode="disabled"),this.g=null,Promise.resolve()},n.isTextVisible=function(){return"showing"==this.g.mode},n.setTextVisibility=function(e){this.g.mode=e?"showing":"hidden"},j("shaka.text.SimpleTextDisplayer",oh),oh.prototype.setTextVisibility=oh.prototype.setTextVisibility,oh.prototype.isTextVisible=oh.prototype.isTextVisible,oh.prototype.destroy=oh.prototype.destroy,oh.prototype.append=oh.prototype.append,oh.prototype.remove=oh.prototype.remove,j("shaka.util.Dom",lh),lh.removeAllChildren=ch,(n=dh.prototype).append=function(e){for(var t=[].concat(c(this.i)),i={},r=(e=l(e)).next();!r.done;i={Cc:i.Cc},r=e.next())i.Cc=r.value,t.some(function(e){return function(t){return ae(t,e.Cc)}}(i))||this.i.push(i.Cc);fh(this)},n.destroy=function(){this.m.removeChild(this.g),this.g=null,this.j=!1,this.i=[],this.u&&this.u.stop(),this.h.clear(),this.s&&(this.s.release(),this.s=null),this.l&&(this.l.disconnect(),this.l=null)},n.remove=function(e,t){if(!this.g)return!1;var i=this.i.length;return this.i=this.i.filter((function(i){return i.startTime<e||i.endTime>=t})),fh(this,i>this.i.length),!0},n.isTextVisible=function(){return this.j},n.setTextVisibility=function(e){this.j=e},j("shaka.text.UITextDisplayer",dh),dh.prototype.setTextVisibility=dh.prototype.setTextVisibility,dh.prototype.isTextVisible=dh.prototype.isTextVisible,dh.prototype.remove=dh.prototype.remove,dh.prototype.destroy=dh.prototype.destroy,dh.prototype.append=dh.prototype.append,j("shaka.text.WebVttGenerator",(function(){}));var Sh="m",Ah="a",Ch="v",Eh="av",Ih="i",Rh="c",Lh="tt",kh="v",Mh="l";function Ph(){}function Oh(e,t,i,r,n){var s,a=n in r,o=!0;for(s in t){var h=n+"."+s,u=a?r[n]:i[s];a||s in i?void 0===t[s]?void 0===u||a?delete e[s]:e[s]=br(u):u.constructor==Object&&t[s]&&t[s].constructor==Object?(e[s]||(e[s]=br(u)),h=Oh(e[s],t[s],u,r,h),o=o&&h):typeof t[s]!=typeof u||null==t[s]||"function"!=typeof t[s]&&t[s].constructor!=u.constructor?(X("Invalid config, wrong type for "+h),o=!1):("function"==typeof i[s]&&i[s].length!=t[s].length&&q("Unexpected number of arguments for "+h),e[s]=t[s]):(X("Invalid config, unrecognized key "+h),o=!1)}return o}function Dh(e,t){for(var i={},r=i,n=0,s=0;!(0>(n=e.indexOf(".",n)));)0!=n&&"\\"==e[n-1]||(r[s=e.substring(s,n).replace(/\\\./g,".")]={},r=r[s],s=n+1),n+=1;return r[e.substring(s).replace(/\\\./g,".")]=t,i}function Nh(e,t){return e&&t}function Fh(){}function Uh(e){return new Oe(e=St(e)).Ha}function zh(e,t,i){function r(e){Le(s).setUint32(a,e.byteLength,!0),a+=4,s.set(Re(e),a),a+=e.byteLength}if(!i||!i.byteLength)throw new Me(2,6,6015);var n;n="string"==typeof t?Ct(t,!0):t,e=Ct(e=St(e),!0);var s=new Uint8Array(12+e.byteLength+n.byteLength+i.byteLength),a=0;return r(e),r(n),r(i),s}function Bh(){}function jh(){var e=1/0;navigator.connection&&navigator.connection.saveData&&(e=360);var t={retryParameters:{maxAttempts:2,baseDelay:1e3,backoffFactor:2,fuzzFactor:.5,timeout:3e4,stallTimeout:5e3,connectionTimeout:1e4},servers:{},clearKeys:{},advanced:{},delayLicenseRequestUntilPlayed:!1,initDataTransform:function(e,t,i){return"com.apple.fps.1_0"==i.keySystem&&"skd"==t&&(t=i.serverCertificate,e=zh(e,i=Uh(e),t)),e},logLicenseExchange:!1,updateExpirationTime:1,preferredKeySystems:[],keySystemsMapping:{},parseInbandPsshEnabled:ct()},i={retryParameters:{maxAttempts:2,baseDelay:1e3,backoffFactor:2,fuzzFactor:.5,timeout:3e4,stallTimeout:5e3,connectionTimeout:1e4},availabilityWindowOverride:NaN,disableAudio:!1,disableVideo:!1,disableText:!1,disableThumbnails:!1,defaultPresentationDelay:0,segmentRelativeVttTiming:!1,dash:{clockSyncUri:"",ignoreDrmInfo:!1,disableXlinkProcessing:!1,xlinkFailGracefully:!1,ignoreMinBufferTime:!1,autoCorrectDrift:!0,initialSegmentLimit:1e3,ignoreSuggestedPresentationDelay:!1,ignoreEmptyAdaptationSet:!1,ignoreMaxSegmentDuration:!1,keySystemsByURI:{"urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b":"org.w3.clearkey","urn:uuid:e2719d58-a985-b3c9-781a-b030af78d30e":"org.w3.clearkey","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":"com.widevine.alpha","urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95":"com.microsoft.playready","urn:uuid:79f0049a-4098-8642-ab92-e65be0885f95":"com.microsoft.playready","urn:uuid:f239e769-efa3-4850-9c16-a903c6932efb":"com.adobe.primetime"},manifestPreprocessor:function(e){return Nh([e],e)},sequenceMode:!1},hls:{ignoreTextStreamFailures:!1,ignoreImageStreamFailures:!1,defaultAudioCodec:"mp4a.40.2",defaultVideoCodec:"avc1.42E01E",ignoreManifestProgramDateTime:!1,mediaPlaylistFullMimeType:'video/mp2t; codecs="avc1.42E01E, mp4a.40.2"',useSafariBehaviorForLive:!0,liveSegmentsDelay:3}},r={retryParameters:{maxAttempts:2,baseDelay:1e3,backoffFactor:2,fuzzFactor:.5,timeout:3e4,stallTimeout:5e3,connectionTimeout:1e4},failureCallback:function(e){return Nh([e])},rebufferingGoal:2,bufferingGoal:10,bufferBehind:30,ignoreTextStreamFailures:!1,alwaysStreamText:!1,startAtSegmentBoundary:!1,gapDetectionThreshold:.5,durationBackoff:1,forceTransmux:!1,safeSeekOffset:5,stallEnabled:!0,stallThreshold:1,stallSkip:.1,useNativeHlsOnSafari:!0,inaccurateManifestTolerance:2,lowLatencyMode:!1,autoLowLatencyMode:!1,forceHTTPS:!1,preferNativeHls:!1,updateIntervalSeconds:1,dispatchAllEmsgBoxes:!1,observeQualityChanges:!1,maxDisabledTime:30,parsePrftBox:!1};(_t("Web0S")||dt()||_t("CrKey"))&&(r.stallSkip=0);var n={trackSelectionCallback:function(e){return P((function(t){return t.return(e)}))},downloadSizeCallback:function(e){var t;return P((function(i){return 1==i.g?navigator.storage&&navigator.storage.estimate?b(i,navigator.storage.estimate(),3):i.return(!0):(t=i.h,i.return(t.usage+e<.95*t.quota))}))},progressCallback:function(e,t){return Nh([e,t])},usePersistentLicense:!0,numberOfParallelDownloads:5},s={drm:t,manifest:i,streaming:r,mediaSource:{sourceBufferExtraFeatures:""},offline:n,abrFactory:function(){return new Wi},abr:{enabled:!0,useNetworkInformation:!0,defaultBandwidthEstimate:1e6,switchInterval:8,bandwidthUpgradeTarget:.85,bandwidthDowngradeTarget:.95,restrictions:{minWidth:0,maxWidth:1/0,minHeight:0,maxHeight:e,minPixels:0,maxPixels:1/0,minFrameRate:0,maxFrameRate:1/0,minBandwidth:0,maxBandwidth:1/0},advanced:{minTotalBytes:128e3,minBytes:16e3,fastHalfLife:2,slowHalfLife:5},restrictToElementSize:!1,restrictToScreenSize:!1,ignoreDevicePixelRatio:!1},autoShowText:3,preferredAudioLanguage:"",preferredTextLanguage:"",preferredVariantRole:"",preferredTextRole:"",preferredAudioChannelCount:2,preferredVideoCodecs:[],preferredAudioCodecs:[],preferForcedSubs:!1,preferredDecodingAttributes:[],restrictions:{minWidth:0,maxWidth:1/0,minHeight:0,maxHeight:1/0,minPixels:0,maxPixels:1/0,minFrameRate:0,maxFrameRate:1/0,minBandwidth:0,maxBandwidth:1/0},playRangeStart:0,playRangeEnd:1/0,textDisplayFactory:function(){return null},cmcd:{enabled:!1,sessionId:"",contentId:"",useHeaders:!1},lcevc:{enabled:!1,dynamicPerformanceScaling:!0,logLevel:0,drawLogo:!1}};return n.trackSelectionCallback=function(e){return P((function(t){return t.return(function(e,t){var i=e.filter((function(e){return"variant"==e.type})),r=[],n=ui(t,i.map((function(e){return e.language})));n&&(r=i.filter((function(e){return si(e.language)==n}))),0==r.length&&(r=i.filter((function(e){return e.primary}))),0==r.length&&(i.map((function(e){return e.language})),r=i);var s=r.filter((function(e){return e.height&&480>=e.height}));for(s.length&&(s.sort((function(e,t){return t.height-e.height})),r=s.filter((function(e){return e.height==s[0].height}))),t=[],r.length&&(i=Math.floor(r.length/2),r.sort((function(e,t){return e.bandwidth-t.bandwidth})),t.push(r[i])),e=l(e),r=e.next();!r.done;r=e.next())(r=r.value).type!=tt&&"image"!=r.type||t.push(r);return t}(e,s.preferredAudioLanguage))}))},s}function Hh(e,t,i){var r={".drm.keySystemsMapping":"",".drm.servers":"",".drm.clearKeys":"",".drm.advanced":{distinctiveIdentifierRequired:!1,persistentStateRequired:!1,videoRobustness:"",audioRobustness:"",sessionType:"",serverCertificate:new Uint8Array(0),serverCertificateUri:"",individualizationServer:""}};return Oh(e,t,i||jh(),r,"")}function Vh(){this.g=null,this.h=[]}function Wh(e,t){if(null==e.g)e.g={timestamp:Date.now()/1e3,state:t,duration:0};else{var i=Date.now()/1e3;e.g.duration=i-e.g.timestamp,e.g.state!=t&&(e.h.push(e.g),e.g={timestamp:i,state:t,duration:0})}}function Gh(e,t){var i=0;e.g&&e.g.state==t&&(i+=e.g.duration);for(var r=(e=l(e.h)).next();!r.done;r=e.next())i+=(r=r.value).state==t?r.duration:0;return i}function Xh(){this.i=this.h=null,this.g=[]}function qh(e,t,i){e.i!=t&&(e.i=t,e.g.push({timestamp:Date.now()/1e3,id:t.id,type:"text",fromAdaptation:i,bandwidth:null}))}function Yh(){this.u=this.B=this.G=this.D=this.s=this.j=this.F=this.m=this.i=this.M=this.O=this.H=this.J=this.L=this.l=this.o=NaN,this.g=new Vh,this.h=new Xh}function $h(t,i){xr.call(this);var n=this;this.l=Xu,this.Uc=this.g=null,this.ca=!1,this.Xc=new Nr,this.Xb=new Nr,this.s=new Nr,this.Nb=this.i=this.Yc=this.J=this.j=this.ua=this.L=this.cf=this.V=this.Fa=this.M=this.Vc=this.H=this.xb=this.B=this.G=this.m=this.D=null,this.dc=!1,this.Nd=this.u=null,this.Yd=1e9,this.h=du(this),this.ec={width:1/0,height:1/0},this.o=null,this.ub=new nr(this.h.preferredAudioLanguage,this.h.preferredVariantRole,this.h.preferredAudioChannelCount),this.vb=this.h.preferredTextLanguage,this.cc=this.h.preferredTextRole,this.$b=this.h.preferForcedSubs,this.Zb=[],this.fc=null,i&&i(this),this.D=function(e){return new Ar((function(t,i){e.u&&e.u.segmentDownloaded(t,i)}),(function(t,i,r){t=(new Map).set("headers",t).set("request",i).set("requestType",r),e.dispatchEvent(Zh("downloadheadersreceived",t))}),(function(t,i,r,n){t=(new Map).set("request",t).set("error",i).set("httpResponseCode",r).set("aborted",n),e.dispatchEvent(Zh("downloadfailed",t))}))}(this),this.D.je(this.h.streaming.forceHTTPS),this.F=null,Qu&&(this.F=Qu()),this.Xc.C(e,"online",(function(){n.ce()})),this.O={name:"detach"},this.W={name:"attach"},this.ea={name:"unload"},this.Zd={name:"manifest-parser"},this.Xd={name:"manifest"},this.wb={name:"media-source"},this.Qd={name:"drm-engine"},this.ba={name:"load"},this.de={name:"src-equals-drm-engine"},this.yb={name:"src-equals"};var s=new Map;s.set(this.W,(function(e,t){return fr(function(e,t,i){return null==t.mediaElement&&(t.mediaElement=i.mediaElement,e.Xb.C(t.mediaElement,"error",(function(){var t=Mu(e);t&&Lu(e,t)}))),e.g=t.mediaElement,Promise.resolve()}(n,e,t))})),s.set(this.O,(function(e){return e.mediaElement&&(n.Xb.nb(),e.mediaElement=null),n.F&&n.F.release(),n.g=null,fr(e=Promise.resolve())})),s.set(this.ea,(function(e){return fr(Qh(n,e))})),s.set(this.wb,(function(e){return e=function(e,t){var i,r,n,s,a;return P((function(o){if(1==o.g)return i=e.h.textDisplayFactory,r=i(),e.Ud=i,n=function(e,t,i,r){return new Na(e,t,i,r)}(t.mediaElement,r,(function(t,i,r){Jh(e,t,i,r)}),e.L),n.configure(e.h.mediaSource),s=e.h.manifest,a=s.segmentRelativeVttTiming,n.H=a,b(o,n.J,2);e.G=n,w(o)}))}(n,e),fr(e)})),s.set(this.Zd,(function(e,t){return e=function(e,t,i){var r,n,s,a;return P((function(o){if(1==o.g)return t.mimeType=i.mimeType,t.uri=i.uri,r=t.uri,n=e.D,e.Nb=r,s=e,b(o,$n(r,n,e.h.manifest.retryParameters,t.mimeType),2);s.Yc=o.h,e.J=e.Yc(),a=br(e.h.manifest),i.mediaElement&&"AUDIO"===i.mediaElement.nodeName&&(a.disableVideo=!0),e.J.configure(a),w(o)}))}(n,e,t),fr(e)})),s.set(this.Xd,(function(e){return function(e,t){var i=t.uri;t=e.D,e.Fa=new Po((function(){return e.uc()})),e.Fa.addEventListener("regionadd",(function(t){t=t.region,ku(e,"timelineregionadded",t),e.F&&e.F.onDashTimedMetadata(t)})),e.ua=null,e.h.streaming.observeQualityChanges&&(e.ua=new Mo((function(){return e.Na()})),e.ua.addEventListener("qualitychange",(function(t){var i=t.quality;t=t.position,i=(new Map).set("mediaQuality",{bandwidth:i.bandwidth,audioSamplingRate:i.audioSamplingRate,codecs:i.codecs,contentType:i.contentType,frameRate:i.frameRate,height:i.height,mimeType:i.mimeType,channelsCount:i.channelsCount,pixelAspectRatio:i.pixelAspectRatio,width:i.width}).set("position",t),e.dispatchEvent(Zh("mediaqualitychanged",i))})));var n={networkingEngine:t,modifyManifestRequest:function(t,i){var n=e.V;try{n.g.enabled&&(n.o=i.format,bh(n,t,{ot:Sh,su:!n.i}))}catch(r){Y("CMCD_MANIFEST_ERROR","Could not generate manifest CMCD data.",r)}},modifySegmentRequest:function(t,i){yh(e.V,t,i)},filter:function(t){return pu(e,t)},makeTextStreamsForClosedCaptions:function(t){return function(e,t){for(var i=new Set,r=l(t.textStreams),n=r.next();!n.done;n=r.next())"application/cea-608"!=(n=n.value).mimeType&&"application/cea-708"!=n.mimeType||i.add(n.originalId);for(r=l(t.variants),n=r.next();!n.done;n=r.next())if((n=n.value.video)&&n.closedCaptions)for(var s=l(n.closedCaptions.keys()),a=s.next();!a.done;a=s.next())if(a=a.value,!i.has(a)){var o=a.startsWith("CC")?"application/cea-608":"application/cea-708",h=new Eo;o={id:e.Yd++,originalId:a,createSegmentIndex:function(){return Promise.resolve()},segmentIndex:h,mimeType:o,codecs:"",kind:"caption",encrypted:!1,drmInfos:[],keyIds:new Set,language:n.closedCaptions.get(a),label:null,type:tt,primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:n.roles,forced:!1,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,closedCaptions:null},t.textStreams.push(o),i.add(a)}}(e,t)},onTimelineRegionAdded:function(t){var i=e.Fa;e:{for(var r=l(i.g),n=r.next();!n.done;n=r.next())if((n=n.value).schemeIdUri==t.schemeIdUri&&n.id==t.id&&n.startTime==t.startTime&&n.endTime==t.endTime){r=n;break e}r=null}null==r&&(i.g.add(t),t=new _r("regionadd",new Map([["region",t]])),i.dispatchEvent(t))},onEvent:function(t){return e.dispatchEvent(t)},onError:function(t){return Lu(e,t)},isLowLatencyMode:function(){return e.h.streaming.lowLatencyMode},isAutoLowLatencyMode:function(){return e.h.streaming.autoLowLatencyMode},enableLowLatencyMode:function(){e.configure("streaming.lowLatencyMode",!0)},updateDuration:function(){e.j&&e.j.updateDuration()},newDrmInfo:function(t){var i=e.m?e.m.g:null;i&&e.m.u&&fu(e,i.keySystem,t)}},s=Date.now()/1e3;return new cr(function(){var t,r,a,o;return P((function(h){if(1==h.g)return t=e,b(h,e.J.start(i,n),2);if(t.i=h.h,r=Zh("manifestparsed"),e.dispatchEvent(r),0==e.i.variants.length)throw new Me(2,4,4036);!function(e){function t(e){return e.video&&e.audio||e.video&&e.video.codecs.includes(",")}e.variants.some(t)&&(e.variants=e.variants.filter(t))}(e.i),a=Date.now()/1e3,o=a-s,e.o.F=o,w(h)}))}(),(function(){return e.J.stop()}))}(n,e)})),s.set(this.Qd,(function(e){return e=function(e,t){var i,r;return P((function(n){return 1==n.g?(i=Date.now()/1e3,r=!0,e.m=iu(e,{kb:e.D,onError:function(t){Lu(e,t)},cd:function(t){Pu(e,t)},onExpirationUpdated:function(t,i){Ou(e,t,i)},onEvent:function(t){e.dispatchEvent(t),"drmsessionupdate"==t.type&&r&&(r=!1,e.o.j=Date.now()/1e3-i,e.L&&((t=e.L).g&&t.h.classList.add("shaka-hidden")))}}),e.m.configure(e.h.drm),b(n,Cn(e.m,e.i.variants,e.i.offlineSessionIds),2)):3!=n.g?b(n,e.m.Yb(t.mediaElement),3):b(n,pu(e,e.i),0)}))}(n,e),fr(e)})),s.set(this.ba,(function(e,t){return fr(function(e,t,i){var r,n,s,a,o,h,u,c,d,p,g,f,m,_,v,y;return P((function(x){switch(x.g){case 1:for(t.startTime=i.startTime,null!=e.fc&&(t.startTime=e.fc,e.fc=null),r=t.mediaElement,n=t.uri,e.Nb=n,e.H=new Io({Tc:function(){return r.playbackRate},Pc:function(){return r.defaultPlaybackRate},le:function(e){r.playbackRate=e},Me:function(e){r.currentTime+=e}}),s=function(){return vu(e)},a=function(){return _u(e)},e.s.C(r,"playing",s),e.s.C(r,"pause",s),e.s.C(r,"ended",s),e.s.C(r,"ratechange",a),function(e,t){if(t.lcevc.enabled){var i=e.Xa();i&&i[0]&&i[0].videoMimeType==Ju.ts&&(lt()||navigator.userAgent.match(/Edge\//))&&(t.streaming.forceTransmux||q("LCEVC Warning: For MPEG-2 TS decoding the config.streaming.forceTransmux must be enabled.")),Kh(e),null==e.L&&(e.L=new ka(e.g,e.cf,t.lcevc),e.G&&(e.G.D=e.L))}else Kh(e)}(e,e.h),o=e.h.abrFactory,e.u&&e.Nd==o||(e.Nd=o,e.u=o(),"function"!=typeof e.u.setMediaElement&&($i("AbrManager","Please use an AbrManager with setMediaElement function."),e.u.setMediaElement=function(){}),e.u.configure(e.h.abr)),e.ub=new nr(e.h.preferredAudioLanguage,e.h.preferredVariantRole,e.h.preferredAudioChannelCount),e.vb=e.h.preferredTextLanguage,e.cc=e.h.preferredTextRole,e.$b=e.h.preferForcedSubs,Du(e.i.presentationTimeline,e.h.playRangeStart,e.h.playRangeEnd),e.u.init((function(t,i,r){e.j&&t!=e.j.l&&wu(e,t,!0,void 0!==i&&i,void 0===r?0:r)})),e.u.setMediaElement(r),di(e.i,e.h.preferredVideoCodecs,e.h.preferredAudioCodecs,e.h.preferredAudioChannelCount,e.h.preferredDecodingAttributes),e.j=function(e){return new Bo(e.i,{Sc:function(){return e.B?e.B.Ic():0},getBandwidthEstimate:function(){return e.u.getBandwidthEstimate()},modifySegmentRequest:function(t,i){yh(e.V,t,i)},R:e.G,kb:e.D,onError:function(t){return Lu(e,t)},onEvent:function(t){return e.dispatchEvent(t)},gg:function(){e.J&&e.J.update&&e.J.update()},Wd:function(t,i,r){e.B&&e.B.Ne(),nu(e),t=(new Map).set("start",t).set("end",i).set("contentType",r),e.dispatchEvent(Zh("segmentappended",t))},fg:function(t,i){(i=i.Od)&&e.ua&&function(e,t,i){var r=function(e,t){var i=e.g.get(t);return i||(i={rc:[],Ae:null,contentType:t},e.g.set(t,i)),i}(e,t.contentType);!function(e,t){if((e=e.h()[t.contentType])&&0<e.length){var i=e[0].start,r=e[e.length-1].end,n=t.rc;t.rc=n.filter((function(e,t){return!(e.position<=i&&t+1<n.length&&n[t+1].position<=i||e.position>=r)}))}else t.rc=[]}(e,r),e={Od:t,position:i},0<=(t=(r=r.rc).findIndex((function(e){return e.position>=i})))?r.splice(t,r[t].position==i?1:0,e):r.push(e)}(e.ua,i,t)},xe:function(t,i){var r=e.m;if(r.h.parseInbandPsshEnabled&&["audio","video"].includes(t)){var n=0,s=l((i=new rn(Re(i))).data);for(t=s.next();!t.done;t=s.next())n+=t.value.length;if(0==n)r=Promise.resolve();else{for(n=new Uint8Array(n),s=0,t=(i=l(i.data)).next();!t.done;t=i.next())t=t.value,n.set(t,s),s+=t.length;kn(r,"cenc",n),r=r.o}}else r=Promise.resolve();return r},hg:function(t,i,r){Jh(e,t,i,r)}})}(e),e.j.configure(e.h.streaming),e.l=qu,r.textTracks&&e.s.C(r.textTracks,"addtrack",(function(t){if(t.track&&"chapters"===(t=t.track).kind)tu(e,t)})),e.dispatchEvent(Zh("streaming")),h=null,(u=e.j.l)||(h=xu(e)),c=[],p=l([(d=u||h).video,d.audio]),g=p.next();!g.done;g=p.next())(f=g.value)&&!f.segmentIndex&&c.push(f.createSegmentIndex());if(!(0<c.length)){x.A(2);break}return b(x,Promise.all(c),2);case 2:if(e.B=function(e,t){return new yo(e.g,e.i,e.h.streaming,t,(function(){e.xb&&ko(e.xb,!0),e.j&&e.j.vc(),e.M&&nu(e)}),(function(t){return e.dispatchEvent(t)}))}(e,t.startTime),e.xb=function(e){var t=new Oo(e.Fa);t.addEventListener("enter",(function(t){ku(e,"timelineregionenter",t.region)})),t.addEventListener("exit",(function(t){ku(e,"timelineregionexit",t.region)})),t.addEventListener("skip",(function(t){var i=t.region;t.seeking||(ku(e,"timelineregionenter",i),ku(e,"timelineregionexit",i))}));var i=new Lo(e.g);return i.g.add(t),e.ua&&i.g.add(e.ua),i}(e),m=Math.max(e.i.minBufferTime,e.h.streaming.rebufferingGoal),ru(e,m),u){x.A(4);break}if(wu(e,h,!0,!1,0),!e.h.streaming.startAtSegmentBoundary){x.A(5);break}return _=e.B.Ic(),b(x,function(e,t){var i,r,n,s,a;return P((function(o){return 1==o.g?(i=e.audio,r=e.video,n=function(e,t){var i,r,n;return P((function(s){return 1==s.g?e?b(s,e.createSegmentIndex(),2):s.return(null):(r=(i=e.segmentIndex.Cb(t))?i.next().value:null)?(n=r.startTime,s.return(n)):s.return(null)}))},b(o,n(i,t),2)):3!=o.g?(s=o.h,b(o,n(r,t),3)):null!=(a=o.h)&&null!=s?o.return(Math.max(a,s)):null!=a?o.return(a):null!=s?o.return(s):o.return(t)}))}(h,_),6);case 6:v=x.h,e.B.zd(v);case 5:Su(e,null,Ai(h));case 4:return e.B.yd(),e.Fb().find((function(e){return e.active}))||((y=Oi(e.i.textStreams,e.vb,e.cc,e.$b)[0]||null)&&qh(e.o.h,y,!0),h&&(y?(h.audio&&function(e,t,i){if(0==e.h.autoShowText)return!1;if(1==e.h.autoShowText)return!0;var r=si(e.h.preferredTextLanguage);return i=si(i.language),2==e.h.autoShowText?ii(i,r):3==e.h.autoShowText?(e=si(t.language),ii(i,r)&&!ii(e,i)):(q("Invalid autoShowText setting!"),!1)}(e,h.audio,y)&&(e.ca=!0),e.ca&&e.G.m.setTextVisibility(!0),Iu(e)):e.ca=!1),y&&(e.h.streaming.alwaysStreamText||e.Hd())&&Vo(e.j,y)),b(x,e.j.start(),7);case 7:e.h.abr.enabled&&(e.u.enable(),Ru(e)),Ti(e.j?e.j.l:null,e.i),Fu(e.i),Au(e),yu(e),e.i.variants.some((function(e){return e.primary})),e.dc=!0,e.s.ma(r,"loadedmetadata",(function(){e.o.m=Date.now()/1e3-i.ne})),w(x)}}))}(n,e,t))})),s.set(this.de,(function(e,t){return e=function(e,t,i){var r,n,s,a,o,h,u;return P((function(l){return 1==l.g?(r=it,n=Date.now()/1e3,s=!0,e.m=iu(e,{kb:e.D,onError:function(t){Lu(e,t)},cd:function(t){Pu(e,t)},onExpirationUpdated:function(t,i){Ou(e,t,i)},onEvent:function(t){e.dispatchEvent(t),"drmsessionupdate"==t.type&&s&&(s=!1,e.o.j=Date.now()/1e3-n)}}),e.m.configure(e.h.drm),a=i.uri||"",o=Zn(a),"application/x-mpegurl"==(h=Ju[o])&&gt()&&(h="application/vnd.apple.mpegurl"),h||(h="video/mp4"),u={id:0,language:"und",disabledUntilTime:0,primary:!1,audio:null,video:{id:0,originalId:null,createSegmentIndex:function(){return Promise.resolve()},segmentIndex:null,mimeType:i.mimeType?i.mimeType.split(";")[0]:h,codecs:i.mimeType?qt(i.mimeType):"",encrypted:!0,drmInfos:[],keyIds:new Set,language:"und",label:null,type:r.va,primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],forced:!1,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,closedCaptions:null},bandwidth:100,allowedByApplication:!0,allowedByKeySystem:!0,decodingInfos:[]},e.m.V=!0,b(l,Cn(e.m,[u],[]),2)):b(l,e.m.Yb(t.mediaElement),0)}))}(n,e,t),fr(e)})),s.set(this.yb,(function(e,t){return function(e,t,i){function r(){return vu(e)}t.uri=i.uri,t.startTime=i.startTime,e.Nb=t.uri;var n=t.mediaElement;e.B=new vo(n);var s=!1;e.Zb.push((function(){s=!0})),null!=t.startTime&&e.B.zd(t.startTime),e.H=new Io({Tc:function(){return n.playbackRate},Pc:function(){return n.defaultPlaybackRate},le:function(e){n.playbackRate=e},Me:function(e){n.currentTime+=e}}),ru(e,e.h.streaming.rebufferingGoal),e.s.C(n,"playing",r),e.s.C(n,"pause",r),e.s.C(n,"ended",r),e.s.C(n,"ratechange",(function(){return _u(e)})),"none"!=n.preload&&e.s.ma(n,"loadedmetadata",(function(){e.o.m=Date.now()/1e3-i.ne})),n.audioTracks&&(e.s.C(n.audioTracks,"addtrack",(function(){return Au(e)})),e.s.C(n.audioTracks,"removetrack",(function(){return Au(e)})),e.s.C(n.audioTracks,"change",(function(){return Au(e)}))),n.textTracks&&(e.s.C(n.textTracks,"addtrack",(function(t){if(t.track)switch(t=t.track,t.kind){case"metadata":!function(e,t){if("metadata"==t.kind){t.mode="hidden",e.s.C(t,"cuechange",(function(){if(t.activeCues)for(var i=l(t.activeCues),r=i.next();!r.done;r=i.next())r=r.value,eu(e,r.startTime,r.endTime,r.type,r.value),e.F&&e.F.onCueMetadataChange(r.value)}));var i=new ot((function(){for(var t=function(e){return Array.from(e.g.textTracks).filter((function(e){return"metadata"==e.kind}))}(e),i=(t=l(t)).next();!i.done;i=t.next())i.value.mode="hidden"})).Mb().N(.5);e.Zb.push((function(){i.stop()}))}}(e,t);break;case"chapters":tu(e,t);break;default:Au(e)}})),e.s.C(n.textTracks,"removetrack",(function(){return Au(e)})),e.s.C(n.textTracks,"change",(function(){return Au(e)})));var a=Zn(t.uri);n.src=function(e,t,i){try{if(!e.g.enabled)return t;var r=xh(e);e:{switch(i){case"video/webm":case"video/mp4":var n=Eh;break e;case"application/x-mpegurl":n=Sh;break e}n=void 0}return r.ot=n,r.su=!0,Th(t,wh(r))}catch(a){return Y("CMCD_SRC_ERROR","Could not generate src CMCD data.",a),t}}(e.V,t.uri,Ju[a]),(dt()||_t("Web0S"))&&n.load(),e.l=Yu,e.dispatchEvent(Zh("streaming"));var o=new nt;return ho(n,HTMLMediaElement.HAVE_METADATA,e.s,(function(){e.B.yd(),o.resolve()})),ho(n,HTMLMediaElement.HAVE_CURRENT_DATA,e.s,(function(){var t;return P((function(i){return 1==i.g?(function(e){var t=e.h.preferredAudioLanguage;if(""!=t){e.ge(t);var i=e.h.preferredVariantRole;""!=i&&e.ge(t,i)}}(e),(t=au(e)).find((function(e){return"disabled"!=e.mode}))?(0<t.length&&(e.ca=!0),i.A(2)):b(i,new Promise((function(t){e.s.ma(n.textTracks,"change",t),new ot(t).N(1)})),2)):s?i.return():(function(e){var t=e.h.preferredTextLanguage,i=e.h.preferForcedSubs;if(""!=t){e.he(t,"",i);var r=e.h.preferredTextRole;""!=r&&e.he(t,r,i)}}(e),void w(i))}))})),n.error?o.reject(Mu(e)):"none"==n.preload&&(q('With <video preload="none">, the browser will not load anything until play() is called. We are unable to measure load latency in a meaningful way, and we cannot provide track info yet. Please do not use preload="none" with Shaka Player.'),o.resolve()),e.s.ma(n,"error",(function(){o.reject(Mu(e))})),new cr(o,(function(){return o.reject(new Me(2,7,7001)),Promise.resolve()})).Y((function(){e.dc=!0}))}(n,e,t)})),this.Ga=new ih(this.O,{Mf:function(e,t,i,r){var s=null;return e==n.O&&(s=i==n.O?n.O:n.W),e==n.W&&(s=i==n.O||t.mediaElement!=r.mediaElement?n.O:i==n.W?n.W:i==n.wb||i==n.ba?n.wb:i==n.yb?n.de:null),e==n.wb&&(s=i==n.ba&&t.mediaElement==r.mediaElement?n.Zd:n.ea),e==n.Zd&&(s=Hu(n.ba,n.Xd,n.ea,i,t,r)),e==n.Xd&&(s=Hu(n.ba,n.Qd,n.ea,i,t,r)),e==n.Qd&&(s=Hu(n.ba,n.ba,n.ea,i,t,r)),e==n.de&&(s=i==n.yb&&t.mediaElement==r.mediaElement?n.yb:n.ea),e!=n.ba&&e!=n.yb||(s=n.ea),e==n.ea&&(s=r.mediaElement&&t.mediaElement==r.mediaElement?n.W:n.O),s},yf:function(e,t,i){return n.dispatchEvent(Zh("onstatechange",(new Map).set("state",e.name))),s.get(e)(t,i)},handleError:function(e){return P((function(t){return 1==t.g?b(t,Qh(n,e),2):t.return(e.mediaElement?n.W:n.O)}))},eg:function(e){n.dispatchEvent(Zh("onstateidle",(new Map).set("state",e.name)))}}),this.af=new ot((function(){mi(n.i.variants,n.h.restrictions,n.ec)&&xu(n)})),t&&this.Yb(t,!0)}function Kh(e){null!=e.L&&(e.L.release(),e.L=null)}function Zh(e,t){return new _r(e,t)}function Qh(e,t){var i,r,n,s,a,o,h,u,c;return P((function(d){switch(d.g){case 1:return e.l!=Gu&&(e.l=Xu),i=e.Zb.map((function(e){return e()})),e.Zb=[],b(d,Promise.all(i),2);case 2:if(e.dispatchEvent(Zh("unloading")),t.mimeType=null,t.startTime=null,t.uri=null,e.Fa&&(e.Fa.release(),e.Fa=null),t.mediaElement&&e.s.nb(),e.af.stop(),e.xb&&(e.xb.release(),e.xb=null),e.Vc&&(e.Vc.stop(),e.Vc=null),!e.J){d.A(3);break}return b(d,e.J.stop(),4);case 4:e.J=null,e.Yc=null;case 3:if(!e.u){d.A(5);break}return b(d,e.u.stop(),5);case 5:if(!e.j){d.A(7);break}return b(d,e.j.destroy(),8);case 8:e.j=null;case 7:if(e.H&&(e.H.release(),e.H=null),e.B&&(e.B.release(),e.B=null),!e.G){d.A(9);break}return b(d,e.G.destroy(),10);case 10:e.G=null;case 9:if(e.F&&e.F.onAssetUnload(),!t.mediaElement||!t.mediaElement.src){d.A(11);break}return b(d,new Promise((function(e){return new ot(e).N(.1)})),12);case 12:for(t.mediaElement.removeAttribute("src"),t.mediaElement.load();t.mediaElement.lastChild;)t.mediaElement.removeChild(t.mediaElement.firstChild);case 11:if(!e.m){d.A(13);break}return b(d,e.m.destroy(),14);case 14:e.m=null;case 13:if(e.Nb=null,e.M=null,e.i){for(r=l(e.i.variants),n=r.next();!n.done;n=r.next())for(s=n.value,a=l([s.audio,s.video]),o=a.next();!o.done;o=a.next())(h=o.value)&&h.segmentIndex&&h.segmentIndex.release();for(u=l(e.i.textStreams),o=u.next();!o.done;o=u.next())(c=o.value).segmentIndex&&c.segmentIndex.release()}e.i=null,e.o=new Yh,e.Ud=null,mu(e),w(d)}}))}function Jh(e,t,i,r){for(var n=(t=l(t)).next();!n.done;n=t.next())if((n=n.value).data&&n.cueTime&&n.frames){var s=n.cueTime+i,a=r;a&&s>a&&(a=s);for(var o=l(n.frames),h=o.next();!h.done;h=o.next())eu(e,s,a,"org.id3",h.value);e.F&&e.F.onHlsTimedMetadata(n,s)}}function eu(e,t,i,r,n){t=(new Map).set("startTime",t).set("endTime",i).set("metadataType",r).set("payload",n),e.dispatchEvent(Zh("metadata",t))}function tu(e,t){if(t&&"chapters"==t.kind){t.mode="hidden";var i=new ot((function(){t.mode="hidden"})).Mb().N(.5);e.Zb.push((function(){i.stop()}))}}function iu(e,t){return new An(t,e.h.drm.updateExpirationTime)}function ru(e,t){e.M=new sr,e.M.g=or,ar(e.M,t,Math.min(.5,t/2)),mu(e),e.Vc=new ot((function(){nu(e)})).Ca(.25)}function nu(e){switch(e.l){case Yu:if(e.g.ended)var t=!0;else{var i=xa(e.g.buffered);t=null!=i&&i>=e.g.duration-1}break;case qu:e:if(e.g.ended||Ua(e.G))t=!0;else{if(e.i.presentationTimeline.U()){i=e.i.presentationTimeline.gb();var r=xa(e.g.buffered);if(null!=r&&r>=i){t=!0;break e}}t=!1}break;default:t=!1}r=wa(e.g.buffered,e.g.currentTime);var n=t,s=(i=e.M).h.get(i.g);t=i.g,r=n||r>=s?hr:or,i.g=r,t!=r&&mu(e)}function su(e){if(e.J){var t=br(e.h.manifest);e.g&&"AUDIO"===e.g.nodeName&&(t.disableVideo=!0),e.J.configure(t)}if(e.m&&e.m.configure(e.h.drm),e.j){e.j.configure(e.h.streaming);try{gu(e,e.i)}catch(s){Lu(e,s)}e.u&&yu(e),!(t=e.j.l)||t.allowedByApplication&&t.allowedByKeySystem||bu(e)}if(e.D&&e.D.je(e.h.streaming.forceHTTPS),e.G&&(e.G.configure(e.h.mediaSource),e.G.H=e.h.manifest.segmentRelativeVttTiming,t=e.h.textDisplayFactory,e.Ud!=t)){var i=t(),r=e.G,n=r.m;r.m=i,n&&(i.setTextVisibility(n.isTextVisible()),n.destroy()),r.g&&(r.g.i=i),e.Ud=t,e.j&&((i=(t=e.j).j.get(tt))&&Wo(t,i.stream,!0,0,!0))}e.u&&(e.u.configure(e.h.abr),e.h.abr.enabled?e.u.enable():e.u.disable(),Ru(e)),e.M&&(t=e.h.streaming.rebufferingGoal,e.i&&(t=Math.max(t,e.i.minBufferTime)),ar(e.M,t,Math.min(.5,t/2))),e.i&&Du(e.i.presentationTimeline,e.h.playRangeStart,e.h.playRangeEnd)}function au(e){return Array.from(e.g.textTracks).filter((function(e){return"metadata"!=e.kind&&"chapters"!=e.kind&&"Shaka Player TextTrack"!=e.label}))}function ou(e){return Array.from(e.g.textTracks).filter((function(e){return"chapters"==e.kind}))}function hu(e,t){var i,r;return P((function(n){switch(n.g){case 1:return i=Zn(t),(r=el[i])?n.return(r):(T(n,2),b(n,Kn(t,e.D,e.h.streaming.retryParameters),4));case 4:r=n.h,A(n,3);break;case 2:C(n);case 3:if(r)return n.return(r);throw new Me(1,2,2011,i)}}))}function uu(e,t,i,r,n,s,a){var o,h,u,l;return P((function(c){if(1==c.g)return"text/vtt"!=n||a.length?b(c,lu(e,t,e.D,e.h.streaming.retryParameters),3):c.A(2);2!=c.g&&(o=c.h,h=cu(e,o,n,a),u=new Blob([h],{type:"text/vtt"}),t=Ja(u),n="text/vtt"),l=document.createElement("track");var d=e.V,p=t;try{if(d.g.enabled){var g=xh(d);g.ot=Rh,g.su=!0;var f=Th(p,wh(g))}else f=p}catch(m){Y("CMCD_TEXT_TRACK_ERROR","Could not generate text track CMCD data.",m),f=p}return l.src=f,l.label=s,l.kind=r,l.srclang=i,e.g.getAttribute("crossorigin")||e.g.setAttribute("crossorigin","anonymous"),e.g.appendChild(l),c.return(l)}))}function lu(e,t,i,r){var n,s,a;return P((function(o){if(1==o.g){n=kr,(s=Er([t],r)).method="GET";var h=e.V;try{h.g.enabled&&bh(h,s,{ot:Rh,su:!0})}catch(u){Y("CMCD_TEXT_ERROR","Could not generate text CMCD data.",u)}return b(o,i.request(n,s).promise,2)}return a=o.h,o.return(a.data)}))}function cu(e,t,i,r){var n=ei[i];if(n)return i=n(),e={periodStart:0,segmentStart:0,segmentEnd:e.g.duration,vttOffset:0},t=Re(t),function(e,t){function i(e){for(var i=e,r=l(t),n=r.next();!n.done;n=r.next())(n=n.value).end&&n.start<e&&(i+=n.end-n.start);return(10>(e=Math.floor(i/3600))?"0":"")+e+":"+(10>(r=Math.floor(i/60%60))?"0":"")+r+":"+(10>(n=Math.floor(i%60))?"0":"")+n+"."+(100>(i=Math.floor(1e3*i%1e3))?10>i?"00":"0":"")+i}var r=ah(e,[]);e="WEBVTT\n\n";for(var n=(r=l(r)).next();!n.done;n=r.next())e+=i((n=n.value).startTime)+" --\x3e "+i(n.endTime)+function(e){var t=[];switch(e.textAlign){case"left":t.push("align:left");break;case"right":t.push("align:right");break;case he:t.push("align:middle");break;case"start":t.push("align:start");break;case"end":t.push("align:end")}switch(e.writingMode){case"vertical-lr":t.push("vertical:lr");break;case"vertical-rl":t.push("vertical:rl")}return t.length?" "+t.join(" "):""}(n)+"\n",e+=n.payload+"\n\n";return e}(t=i.parseMedia(t,e),r);throw new Me(2,2,2014,i)}function du(e){var t=jh();return t.streaming.failureCallback=function(t){if(e.U()){var i=null;1001==t.code||1002==t.code?i=1:1003==t.code&&(i=.1),null!=i&&(t.severity=1,e.ce(i))}},t.textDisplayFactory=function(){return e.Uc?new dh(e.g,e.Uc):new oh(e.g)},t}function pu(e,t){return P((function(i){if(1==i.g)return b(i,function(e,t){return P((function(i){if(1==i.g)return b(i,_i(e.j?e.j.l:null,t),2);Fu(t),w(i)}))}(e,t),2);gu(e,t),w(i)}))}function gu(e,t){if(e.l!=Gu){mi(t.variants,e.h.restrictions,e.ec)&&e.j&&Au(e);var i=e.m?e.m.g:null;if(i&&e.m.u)for(var r=l(t.variants),n=r.next();!n.done;n=r.next())n=n.value,fu(e,i.keySystem,n.video),fu(e,i.keySystem,n.audio);Nu(e,t)}}function fu(e,t,i){if(i)for(var r=(i=l(i.drmInfos)).next();!r.done;r=i.next())if((r=r.value).keySystem==t)for(var n=(r=l(r.initData||[])).next();!n.done;n=r.next())n=n.value,kn(e.m,n.initDataType,n.initData)}function mu(e){var t=e.Fd();if(e.o&&e.M&&e.B){var i=e.H;i.j=t,Ro(i),e.V&&(i=e.V,t||i.i||(i.i=!0),i.i&&t&&(i.l=!0),i.m=t),vu(e)}t=(new Map).set("buffering",t),e.dispatchEvent(Zh("buffering",t))}function _u(e){var t=e.g.playbackRate;0!=t&&(e.H&&e.H.set(t),t=Zh("ratechange"),e.dispatchEvent(t))}function vu(e){if(e.o&&e.M){var t=e.o.g;e.M.g==or?Wh(t,"buffering"):e.g.paused?Wh(t,"paused"):e.g.ended?Wh(t,"ended"):Wh(t,"playing")}}function yu(e){try{Nu(e,e.i)}catch(i){return Lu(e,i),!1}var t=e.i.variants.filter((function(e){return Mi(e)}));return t=e.ub.create(t),e.u.setVariants(Array.from(t.values())),!0}function xu(e){return yu(e)?e.u.chooseVariant():null}function bu(e){var t=xu(e);t&&wu(e,t,!0,!0,0)}function wu(e,t,i,r,n){var s=e.j.l;if(t==s)r&&Ho(e.j,t,r,n,!0);else{var a=e.o.h;a.h!=t&&(a.h=t,a.g.push({timestamp:Date.now()/1e3,id:t.id,type:"variant",fromAdaptation:i,bandwidth:t.bandwidth})),Ho(e.j,t,r,n,void 0,i),r=null,s&&(r=Ai(s)),t=Ai(t),i?Su(e,r,t):Cu(e,r,t)}}function Tu(e,t){var i=Array.from(e.g.audioTracks).find((function(e){return e.enabled}));t.enabled=!0,t.id!==i.id&&(i.enabled=!1),Cu(e,i=Li(i),t=Li(t))}function Su(e,t,i){t=(new Map).set("oldTrack",t).set("newTrack",i),e.L&&Ma(e.L,i),Uu(e,i=Zh("adaptation",t))}function Au(e){Uu(e,Zh("trackschanged"))}function Cu(e,t,i){t=(new Map).set("oldTrack",t).set("newTrack",i),e.L&&Ma(e.L,i),Uu(e,i=Zh("variantchanged",t))}function Eu(e){Uu(e,Zh("textchanged"))}function Iu(e){Uu(e,Zh("texttrackvisibility"))}function Ru(e){Uu(e,Zh("abrstatuschanged",(new Map).set("newStatus",e.h.abr.enabled)))}function Lu(e,t){if(e.l!=Gu)if(function(e,t){if(1002!=t.code&&1011!=t.code||1!=t.category||!navigator.onLine)return!1;var i=e.h.streaming.maxDisabledTime;if(0==i){if(1011!=t.code)return!1;i=1}t=e.Xa().find((function(e){return e.active}));for(var r=e.i,n=l(r.variants),s=n.next();!s.done;s=n.next())(s=s.value).id===t.id&&(s.disabledUntilTime=Date.now()/1e3+i);return mi(r.variants,e.h.restrictions,e.ec),!!(t=xu(e))&&(r=e.Na().video.reduce((function(e,t){return e+t.end-t.start}),0),wu(e,t,!1,!0,r),e.af.N(i),!0)}(e,t))t.handled=!0;else{var i=Zh("error",(new Map).set("detail",t));e.dispatchEvent(i),i.defaultPrevented&&(t.handled=!0)}}function ku(e,t,i){i=(new Map).set("detail",{schemeIdUri:i.schemeIdUri,value:i.value,startTime:i.startTime,endTime:i.endTime,id:i.id,eventElement:i.eventElement}),e.dispatchEvent(Zh(t,i))}function Mu(e){if(!e.g.error)return null;var t=e.g.error.code;if(1==t)return null;var i=e.g.error.msExtendedCode;return i&&(0>i&&(i+=Math.pow(2,32)),i=i.toString(16)),new Me(2,3,3016,t,i,e.g.error.message)}function Pu(e,t){if(e.j){var i=Object.keys(t),r=1==i.length&&"00"==i[0],n=!1;if(i.length)for(var s=(i=l(e.i.variants)).next();!s.done;s=i.next()){var a=[];(s=s.value).audio&&a.push(s.audio),s.video&&a.push(s.video);for(var o=(a=l(a)).next();!o.done;o=a.next()){var h=o.value;if(o=s.allowedByKeySystem,h.keyIds.size){s.allowedByKeySystem=!0;for(var u=(h=l(h.keyIds)).next();!u.done;u=h.next())u=u.value,u=t[r?"00":u],s.allowedByKeySystem=s.allowedByKeySystem&&!!u&&!Ku.includes(u)}o!=s.allowedByKeySystem&&(n=!0)}}n&&!yu(e)||((t=e.j.l)&&!t.allowedByKeySystem&&bu(e),n&&Au(e))}}function Ou(e,t,i){e.J&&e.J.onExpirationUpdated&&e.J.onExpirationUpdated(t,i),t=Zh("expirationupdated"),e.dispatchEvent(t)}function Du(e,t,i){0<t&&(e.U()||e.Ze(t)),i<(t=e.getDuration())&&(e.U()||e.Aa(i))}function Nu(e,t){e=e.m?e.m.Qc():{};var i=Object.keys(e);i=i.length&&"00"==i[0];for(var r=!1,n=!1,s=new Set,a=new Set,o=(t=l(t.variants)).next();!o.done;o=t.next()){var h=[];(o=o.value).audio&&h.push(o.audio),o.video&&h.push(o.video);for(var u=(h=l(h)).next();!u.done;u=h.next())if((u=u.value).keyIds.size)for(var c=(u=l(u.keyIds)).next();!c.done;c=u.next()){c=c.value;var d=e[i?"00":c];d?Ku.includes(d)&&a.add(d):s.add(c)}o.allowedByApplication?o.allowedByKeySystem&&(r=!0):n=!0}if(!r)throw new Me(2,4,4012,e={hasAppRestrictions:n,missingKeys:Array.from(s),restrictedKeyStatuses:Array.from(a)})}function Fu(e){if(!e.variants.some(Mi))throw new Me(2,4,4032)}function Uu(e,t){P((function(i){if(1==i.g)return b(i,Promise.resolve(),2);e.l!=Gu&&e.dispatchEvent(t),w(i)}))}function zu(e){for(var t=new Set,i=(e=l(e)).next();!i.done;i=e.next())(i=i.value).language?t.add(si(i.language)):t.add("und");return t}function Bu(e){for(var t=new Map,i=new Map,r=(e=l(e)).next();!r.done;r=e.next()){var n="und",s=[];(r=r.value).language&&(n=si(r.language)),(s="variant"==r.type?r.audioRoles:r.roles)&&s.length||(s=[""]),t.has(n)||t.set(n,new Set);for(var a=(s=l(s)).next();!a.done;a=s.next())a=a.value,t.get(n).add(a),r.label&&(i.has(n)||i.set(n,new Map),i.get(n).set(a,r.label))}var o=[];return t.forEach((function(e,t){for(var r=(e=l(e)).next();!r.done;r=e.next()){r=r.value;var n=null;i.has(t)&&i.get(t).has(r)&&(n=i.get(t).get(r)),o.push({language:t,role:r,label:n})}})),o}function ju(){return new Me(2,7,7e3)}function Hu(e,t,i,r,n,s){return r==e&&n.mediaElement==s.mediaElement&&n.uri==s.uri&&n.mimeType==s.mimeType?t:i}function Vu(){return{mediaElement:null,mimeType:null,startTime:null,ne:NaN,uri:null}}function Wu(e){return new Promise((function(t,i){e.mb=function(){return i(ju())},e.bd=function(){return t()},e.onError=function(e){return i(e)},e.dd=function(){return i(ju())}}))}j("shaka.util.CmcdManager.StreamingFormat",{DASH:"d",HLS:"h",dh:"s",Yg:"o"}),j("shaka.util.ConfigUtils",Ph),Ph.convertToConfigObject=Dh,Ph.mergeConfigObjects=Oh,j("shaka.util.FairPlayUtils",Fh),Fh.commonFairPlayResponse=function(e,t){if(2===e){try{var i=wt(t.data)}catch(n){return}e=!1,"<ckc>"===(i=i.trim()).substr(0,5)&&"</ckc>"===i.substr(-6)&&(i=i.slice(5,-6),e=!0);try{var r=JSON.parse(i);r.ckc&&(i=r.ckc,e=!0),r.CkcMessage&&(i=r.CkcMessage,e=!0),r.License&&(i=r.License,e=!0)}catch(n){}e&&(t.data=Ie(kt(i)))}},Fh.conaxFairPlayRequest=function(e,t){2===e&&(t.headers["Content-Type"]="application/octet-stream")},Fh.ezdrmFairPlayRequest=function(e,t){2===e&&(t.headers["Content-Type"]="application/octet-stream")},Fh.verimatrixFairPlayRequest=function(e,t){2===e&&(e=Lt(e=Re(t.body)),t.headers["Content-Type"]="application/x-www-form-urlencoded",t.body=At("spc="+e))},Fh.conaxInitDataTransform=function(t,i,r){if("skd"!==i)return t;i=r.serverCertificate,r=St(t).split("skd://").pop().split("?").shift(),r=e.atob(r);var n=new ArrayBuffer(2*r.length);n=new Uint16Array(n);for(var s=0,a=r.length;s<a;s++)n[s]=r.charCodeAt(s);return zh(t,n,i)},Fh.ezdrmInitDataTransform=function(e,t,i){return"skd"!==t?e:(t=i.serverCertificate,zh(e,i=St(e).split(";").pop(),t))},Fh.verimatrixInitDataTransform=function(e,t,i){return"skd"!==t?e:(t=i.serverCertificate,zh(e,i=St(e).split("skd://").pop(),t))},Fh.initDataTransform=zh,Fh.defaultGetContentId=Uh,Fh.isFairPlaySupported=function(){var e;return P((function(t){return 1==t.g?(e={initDataTypes:["cenc","sinf","skd"],videoCapabilities:[{contentType:'video/mp4; codecs="avc1.42E01E"'}]},T(t,2),b(t,navigator.requestMediaKeySystemAccess("com.apple.fps",[e]),4)):2!=t.g?t.return(!0):(C(t),t.return(!1))}))},j("shaka.util.PlayerConfiguration",Bh),Bh.mergeConfigObjects=Hh,Bh.createDefault=jh,_($h,xr),(n=$h.prototype).destroy=function(){var e,t=this;return P((function(i){switch(i.g){case 1:return t.l==Gu?i.return():(Kh(t),t.l=Gu,e=rh(t.Ga,(function(){return{node:t.O,payload:Vu(),hb:!1}})),b(i,new Promise((function(t){e.Jb=function(){},e.bd=function(){t()},e.mb=function(){t()},e.onError=function(){t()},e.dd=function(){t()}})),2));case 2:return b(i,t.Ga.destroy(),3);case 3:if(t.Xc&&(t.Xc.release(),t.Xc=null),t.Xb&&(t.Xb.release(),t.Xb=null),t.s&&(t.s.release(),t.s=null),t.Nd=null,t.u=null,t.h=null,t.o=null,t.Uc=null,t.V=null,!t.D){i.A(4);break}return b(i,t.D.destroy(),5);case 5:t.D=null;case 4:xr.prototype.release.call(t),w(i)}}))},n.Yb=function(e,t){if(t=void 0===t||t,this.l==Gu)return Promise.reject(ju());var i=Vu();i.mediaElement=e,ht()||(t=!1);var r=t?this.wb:this.W;return(e=rh(this.Ga,(function(){return{node:r,payload:i,hb:!1}}))).Jb=function(){},Wu(e)},n.lf=function(e){this.cf=e},n.detach=function(){var e=this;if(this.l==Gu)return Promise.reject(ju());var t=rh(this.Ga,(function(){return{node:e.O,payload:Vu(),hb:!1}}));return t.Jb=function(){},Wu(t)},n.re=function(e){var t=this;if(e=void 0===e||e,this.l==Gu)return Promise.reject(ju());this.dc=!1,ht()||(e=!1),Kh(this);var i=Vu(),r=rh(this.Ga,(function(r){var n=r.mediaElement&&e?t.wb:r.mediaElement?t.W:t.O;return i.mediaElement=r.mediaElement,{node:n,payload:i,hb:!1}}));return r.Jb=function(){},Wu(r)},n.Fg=function(e){this.fc=e},n.load=function(e,t,i){var r=this;if(this.fc=null,this.dc=!1,this.l==Gu)return Promise.reject(ju());this.dispatchEvent(Zh("loading"));var n=Vu();n.uri=e,n.ne=Date.now()/1e3,i&&(n.mimeType=i),void 0!==t&&(n.startTime=t);var s=function(e,t){if(!ht())return!0;var i=t.mimeType,r=t.uri||"";if(i||(i=Zn(r),i=Ju[i]),i){if(""==(t.mediaElement||vt()).canPlayType(i))return!1;if(!ht()||!(i in Qn)&&!(Zn(r)in Jn)||e.h.streaming.preferNativeHls)return!0;if(gt())return e.h.streaming.useNativeHlsOnSafari}return!1}(this,n)?this.yb:this.ba,a=rh(this.Ga,(function(e){return null==e.mediaElement?null:(n.mediaElement=e.mediaElement,{node:s,payload:n,hb:!0})}));return this.o=new Yh,this.V=function(e){return new vh({getBandwidthEstimate:function(){return e.u?e.u.getBandwidthEstimate():NaN},Na:function(){return e.Na()},getCurrentTime:function(){return e.g?e.g.currentTime:0},Xa:function(){return e.Xa()},Rc:function(){return e.Rc()},U:function(){return e.U()}},e.h.cmcd)}(this),a.Jb=function(){},new Promise((function(e,t){a.dd=function(){return t(new Me(2,7,7002))},a.bd=function(){e(),r.dispatchEvent(Zh("loaded"))},a.mb=function(){return t(ju())},a.onError=function(e){return t(e)}}))},n.configure=function(e,t){2==arguments.length&&"string"==typeof e&&(e=Dh(e,t)),e.streaming&&"forceTransmuxTS"in e.streaming&&($i("streaming.forceTransmuxTS configuration","Please Use streaming.forceTransmux instead."),e.streaming.forceTransmux=e.streaming.forceTransmuxTS,delete e.streaming.forceTransmuxTS),e.streaming&&e.streaming.lowLatencyMode&&(null==e.streaming.inaccurateManifestTolerance&&(e.streaming.inaccurateManifestTolerance=0),null==e.streaming.rebufferingGoal&&(e.streaming.rebufferingGoal=.01));var i=Hh(this.h,e,du(this));return su(this),i},n.getConfiguration=function(){var e=du(this);return Hh(e,this.h,du(this)),e},n.Bf=function(){if(this.g){var e=this.g.buffered.length;e=e?this.g.buffered.end(e-1):0;var t=this.getConfiguration().streaming.bufferingGoal;if(e>=(t=Math.min(this.g.currentTime+t,this.uc().end)))return 1;if(!(e<=this.g.currentTime)&&e<t)return(e-this.g.currentTime)/(t-this.g.currentTime)}return 0},n.rg=function(){for(var e in this.h)delete this.h[e];Hh(this.h,du(this),du(this)),su(this)},n.Hf=function(){return this.l},n.Lf=function(){return this.g},n.jc=function(){return this.D},n.Dd=function(){return this.Nb},n.Ge=function(){return this.F?this.F:null},n.U=function(){return this.i?this.i.presentationTimeline.U():!(!this.g||!this.g.src)&&1/0==this.g.duration},n.jb=function(){return!!this.i&&this.i.presentationTimeline.jb()},n.Zf=function(){if(this.i){var e=this.i.variants;return!!e.length&&!e[0].video}return!(!this.g||!this.g.src)&&(this.g.videoTracks?0==this.g.videoTracks.length:0==this.g.videoHeight)},n.uc=function(){if(!this.dc)return{start:0,end:0};if(this.i){var e=this.i.presentationTimeline;return{start:e.Db(),end:e.Oa()}}return this.g&&this.g.src&&(e=this.g.seekable).length?{start:e.start(0),end:e.end(e.length-1)}:{start:0,end:0}},n.Xf=function(){this.U()&&(this.g.currentTime=this.uc().end)},n.keySystem=function(){var e=this.drmInfo();return e?e.keySystem:""},n.drmInfo=function(){return this.m?this.m.g:null},n.ic=function(){return this.m?this.m.ic():1/0},n.Qc=function(){return this.m?this.m.Qc():{}},n.Fd=function(){return!!this.M&&this.M.g==or},n.Rc=function(){return this.g?this.H?this.H.i:1:0},n.Ag=function(e){0==e?q("A trick play rate of 0 is unsupported!"):(this.g.paused&&this.g.play(),this.H.set(e),this.l==qu&&(this.u.playbackRateChanged(e),jo(this.j,1<Math.abs(e))))},n.pf=function(){var e=this.H.Pc();this.l==Yu&&this.H.set(e),this.l==qu&&(this.H.set(e),this.u.playbackRateChanged(e),jo(this.j,!1))},n.Xa=function(){if(this.i){for(var e=this.j?this.j.l:null,t=[],i=0,r=l(this.i.variants),n=r.next();!n.done;n=r.next())if(Mi(n=n.value)){var s=Ai(n);s.active=n==e,s.active||1==i||null==e||n.video!=e.video||n.audio!=e.audio||(s.active=!0),s.active&&i++,t.push(s)}return t}return this.g&&this.g.audioTracks?Array.from(this.g.audioTracks).map((function(e){return Li(e)})):[]},n.Fb=function(){if(this.i){for(var e=this.j?this.j.o:null,t=[],i=l(this.i.textStreams),r=i.next();!r.done;r=i.next()){var n=Ci(r=r.value);n.active=r==e,t.push(n)}return t}return this.g&&this.g.src&&this.g.textTracks?au(this).map((function(e){return Ri(e)})):[]},n.Ff=function(){return this.i?this.i.imageStreams.map((function(e){return Ei(e)})):[]},n.Tf=function(e,t){var i,r,n,s,a,o,h,u,l,c,d,p,g,f,m,_,v,y,x,w,T=this;return P((function(S){return 1==S.g?T.i?(i=T.i.imageStreams.find((function(t){return t.id==e})))?i.segmentIndex?S.A(3):b(S,i.createSegmentIndex(),3):S.return(null):S.A(2):2!=S.g?null==(r=i.segmentIndex.find(t))?S.return(null):(n=i.segmentIndex.get(r),s=n.tilesLayout||i.tilesLayout,(a=/(\d+)x(\d+)/.exec(s))?(o=i.width||0,h=i.height||0,u=parseInt(a[1],10),l=parseInt(a[2],10),c=o/u,d=h/l,p=u*l,g=n.j-n.startTime,f=n.s||g/p,m=n.startTime,v=_=0,1<p&&(y=Math.floor((t-n.startTime)/f),m=n.startTime+y*f,_=y%u*c,v=Math.floor(y/u)*d),x=!1,(w=n.o)&&(x=!0,d=w.height,_=w.positionX,v=w.positionY,c=w.width),S.return({imageHeight:h,imageWidth:o,height:d,positionX:_,positionY:v,startTime:m,duration:f,uris:n.ya(),width:c,sprite:x})):S.return(null)):S.return(null)}))},n.Se=function(e){if(this.i&&this.j){var t=this.i.textStreams.find((function(t){return t.id==e.id}));t&&t!=this.j.o&&(qh(this.o.h,t,!1),Vo(this.j,t),Eu(this),this.vb=t.language)}else if(this.g&&this.g.src&&this.g.textTracks){for(var i=(t=l(t=au(this))).next();!i.done;i=t.next())Ii(i=i.value)==e.id?i.mode=this.ca?"showing":"hidden":i.mode="disabled";Eu(this)}},n.Te=function(e,t,i){if(t=void 0!==t&&t,i=void 0===i?0:i,this.i&&this.j){this.h.abr.enabled&&q("Changing tracks while abr manager is enabled will likely result in the selected track being overriden. Consider disabling abr before calling selectVariantTrack().");var r=this.i.variants.find((function(t){return t.id==e.id}));r&&Mi(r)&&(wu(this,r,!1,t,i),this.ub=new rr(r),yu(this))}else if(this.g&&this.g.audioTracks)for(i=(t=l(t=Array.from(this.g.audioTracks))).next();!i.done;i=t.next())if(Ii(i=i.value)==e.id){Tu(this,i);break}},n.Af=function(){return Bu(this.Xa())},n.Rf=function(){return Bu(this.Fb())},n.zf=function(){return Array.from(zu(this.Xa()))},n.Qf=function(){return Array.from(zu(this.Fb()))},n.ge=function(e,t,i){if(i=void 0===i?0:i,this.i&&this.B){this.ub=new nr(e,t||"",i,""),t=function(e,t){return e.video||t.video?e.video&&t.video?Math.abs((e.video.height||0)-(t.video.height||0))+Math.abs((e.video.width||0)-(t.video.width||0)):1/0:0},e=this.j.l;var r=this.ub.create(this.i.variants);i=null;for(var n=(r=l(r.values())).next();!n.done;n=r.next())n=n.value,(!i||t(i,e)>t(n,e))&&(i=n);i?(t=Ai(i),this.Te(t,!0)):bu(this)}else if(this.g&&this.g.audioTracks){n=Array.from(this.g.audioTracks),e=si(e),r=i=null;for(var s=(n=l(n)).next();!s.done;s=n.next()){var a=Li(s=s.value);si(a.language)==e&&(i=s,t?a.roles.includes(t)&&(r=s):0==a.roles.length&&(r=s))}r?Tu(this,r):i&&Tu(this,i)}},n.he=function(e,t,i){if(i=void 0!==i&&i,this.i&&this.B)this.vb=e,this.cc=t||"",this.$b=i,(e=Oi(this.i.textStreams,this.vb,this.cc,this.$b)[0]||null)&&e!=this.j.o&&(qh(this.o.h,e,!1),this.h.streaming.alwaysStreamText||this.Hd())&&(Vo(this.j,e),Eu(this));else{var r=si(e);(e=this.Fb().find((function(e){return si(e.language)==r&&(!t||e.roles.includes(t))&&e.forced==i})))&&this.Se(e)}},n.tg=function(e){if(this.i&&this.B){for(var t=null,i=l(this.i.variants),r=i.next();!r.done;r=i.next())if((r=r.value).audio.label==e){t=r;break}null!=t&&(this.ub=new nr(t.language,"",0,e),bu(this))}},n.Hd=function(){var e=this.ca;return this.G?this.G.m.isTextVisible():this.g&&this.g.src&&this.g.textTracks?au(this).some((function(e){return"showing"==e.mode})):e},n.He=function(){return this.g&&this.g.src&&this.g.textTracks?ou(this).map((function(e){return Ri(e)})):[]},n.Cf=function(e){var t=si(e),i=ou(this).filter((function(e){return si(e.language)==t}));if(!i||!i.length)return[];e=[];for(var r=new Set,n=(i=l(i)).next();!n.done;n=i.next())if((n=n.value)&&n.cues)for(var s=(n=l(n.cues)).next();!s.done;s=n.next()){var a=s.value;(s=a.id)&&""!=s||(s=a.startTime+"-"+a.endTime+"-"+a.text),a={id:s,title:a.text,startTime:a.startTime,endTime:a.endTime},r.has(s)||(e.push(a),r.add(s))}return e},n.yg=function(e){if(e=!!e,this.ca!=e){if(this.ca=e,this.l==qu)this.G.m.setTextVisibility(e),this.h.streaming.alwaysStreamText||(e?this.j.o||0<(e=Oi(this.i.textStreams,this.vb,this.cc,this.$b)).length&&(Vo(this.j,e[0]),Eu(this)):function(e){var t=e.j.get(tt);t&&(Jo(t),eh(t).catch((function(){})),e.j.delete(tt)),e.o=null}(this.j));else if(this.g&&this.g.src&&this.g.textTracks)for(var t=au(this),i=(t=l(t)).next();!i.done;i=t.next())"disabled"!=(i=i.value).mode&&(i.mode=e?"showing":"hidden");Iu(this)}},n.Of=function(){if(!this.U())return null;var e=this.Ga.l,t=0;if(this.B)t=this.B.Ic();else if(e){if(null==e.startTime)return new Date;t=e.startTime}return this.i?new Date(1e3*(this.i.presentationTimeline.i+t)):this.g&&this.g.getStartDate?(e=this.g.getStartDate(),isNaN(e.getTime())?null:new Date(e.getTime()+1e3*t)):null},n.Ie=function(){if(!this.U())return null;if(this.i)return new Date(1e3*this.i.presentationTimeline.i);if(this.g&&this.g.getStartDate){var e=this.g.getStartDate();return isNaN(e.getTime())?null:e}return null},n.Na=function(){if(this.l==qu)return this.G.Na();var e={total:[],audio:[],video:[],text:[]};return this.l==Yu&&(e.total=Ta(this.g.buffered)),e},n.getStats=function(){if(this.l!=qu&&this.l!=Yu)return{width:NaN,height:NaN,streamBandwidth:NaN,decodedFrames:NaN,droppedFrames:NaN,corruptedFrames:NaN,stallsDetected:NaN,gapsJumped:NaN,estimatedBandwidth:NaN,completionPercent:NaN,loadLatency:NaN,manifestTimeSeconds:NaN,drmTimeSeconds:NaN,playTime:NaN,pauseTime:NaN,bufferingTime:NaN,licenseTime:NaN,liveLatency:NaN,maxSegmentDuration:NaN,switchHistory:[],stateHistory:[]};vu(this);var e=this.g,t=e.currentTime/e.duration;if(!isNaN(t)){var i=this.o;t=Math.round(100*t),i.i=isNaN(i.i)?t:Math.max(i.i,t)}if(this.B&&(this.o.M=this.B.te(),this.o.O=this.B.ue()),e.getVideoPlaybackQuality){i=e.getVideoPlaybackQuality(),t=this.o;var r=Number(i.totalVideoFrames);t.L=Number(i.droppedVideoFrames),t.J=r,this.o.H=Number(i.corruptedVideoFrames)}this.m?i=(i=this.m).H?i.H:NaN:i=NaN,this.o.s=i,this.l==qu&&((i=this.j.l)&&(this.o.B=(this.H?this.H.i:1)*i.bandwidth),i&&i.video&&(t=this.o,r=i.video.height||NaN,t.o=i.video.width||NaN,t.l=r),this.U()&&(i=this.Ie().valueOf()+1e3*this.uc().end,this.o.D=(Date.now()-i)/1e3),this.i&&this.i.presentationTimeline&&(this.o.G=this.i.presentationTimeline.g),i=this.u.getBandwidthEstimate(),this.o.u=i),this.l==Yu&&(i=this.o,t=e.videoHeight||NaN,i.o=e.videoWidth||NaN,i.l=t);var n=this.o;e=n.o,i=n.l,t=n.B,r=n.J;for(var s=n.L,a=n.H,o=n.O,h=n.M,u=n.u,c=n.i,d=n.m,p=n.F,g=n.j,f=Gh(n.g,"playing"),m=Gh(n.g,"paused"),_=Gh(n.g,"buffering"),v=n.s,y=n.D,x=n.G,b=function(e){function t(e){return{timestamp:e.timestamp,state:e.state,duration:e.duration}}for(var i=[],r=l(e.h),n=r.next();!n.done;n=r.next())i.push(t(n.value));return e.g&&i.push(t(e.g)),i}(n.g),w=[],T=(n=l(n.h.g)).next();!T.done;T=n.next())T=T.value,w.push({timestamp:T.timestamp,id:T.id,type:T.type,fromAdaptation:T.fromAdaptation,bandwidth:T.bandwidth});return{width:e,height:i,streamBandwidth:t,decodedFrames:r,droppedFrames:s,corruptedFrames:a,stallsDetected:o,gapsJumped:h,estimatedBandwidth:u,completionPercent:c,loadLatency:d,manifestTimeSeconds:p,drmTimeSeconds:g,playTime:f,pauseTime:m,bufferingTime:_,licenseTime:v,liveLatency:y,maxSegmentDuration:x,stateHistory:b,switchHistory:w}},n.hf=function(e,t,i,r,n,s,a){a=void 0!==a&&a;var o,h,u,l,c,d,p,g,f,m,_=this;return P((function(v){switch(v.g){case 1:if(_.l!=qu&&_.l!=Yu)throw new Me(1,7,7004);if(r){v.A(2);break}return b(v,hu(_,e),3);case 3:r=v.h;case 2:if(o=[],_.F)try{o=_.F.getServerSideCuePoints()}catch(y){}if(_.l!=Yu){v.A(4);break}return a&&(i="forced"),b(v,uu(_,e,t,i,r,s||"",o),5);case 5:if(h=_.Fb(),u=h.find((function(e){return e.language==t&&e.label==(s||"")&&e.kind==i})))return Au(_),v.return(u);throw new Me(1,2,2012);case 4:if(l=it,1/0==(c=_.i.presentationTimeline.getDuration()))throw new Me(1,4,4033);if(!o.length){v.A(6);break}return b(v,lu(_,e,_.D,_.h.streaming.retryParameters),7);case 7:d=v.h,p=cu(_,d,r,o),g=new Blob([p],{type:"text/vtt"}),e=Ja(g),r="text/vtt";case 6:if(f={id:_.Yd++,originalId:null,createSegmentIndex:function(){return Promise.resolve()},segmentIndex:Ao(0,c,[e]),mimeType:r||"",codecs:n||"",kind:i,encrypted:!1,drmInfos:[],keyIds:new Set,language:t,label:s||null,type:l.X,primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],forced:!!a,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,closedCaptions:null},m=Wt(f.mimeType,f.codecs),!Kt(m))throw new Me(2,2,2014,r);return _.i.textStreams.push(f),Au(_),v.return(Ci(f))}}))},n.jf=function(e,t){var i,r,n,s,a,o,h,u,c,d,p,g,f,m,_,v,y=this;return P((function(x){switch(x.g){case 1:if(y.l!=qu&&y.l!=Yu)throw new Me(1,7,7004);if(y.l==Yu)throw new Me(1,2,2016);if(t){x.A(2);break}return b(x,hu(y,e),3);case 3:t=x.h;case 2:if("text/vtt"!=t)throw new Me(1,2,2017,e);if(i=it,1/0==(r=y.i.presentationTimeline.getDuration()))throw new Me(1,4,4045);return b(x,lu(y,e,y.D,y.h.streaming.retryParameters),4);case 4:if(n=x.h,!(s=ei[t]))throw new Me(2,2,2014,t);for(a=s(),o={periodStart:0,segmentStart:0,segmentEnd:r,vttOffset:0},h=Re(n),u=a.parseMedia(h,o),c=[],d={},p=l(u),g=p.next();!g.done;d={Rb:d.Rb},g=p.next())f=g.value,d.Rb=Ze([e],[f.payload])[0],m=new ma(f.startTime,f.endTime,function(e){return function(){return[e.Rb]}}(d),0,null,null,0,0,1/0),d.Rb.includes("#xywh")&&(4===(_=d.Rb.split("#xywh=")[1].split(",")).length&&m.Ye({height:parseInt(_[3],10),positionX:parseInt(_[0],10),positionY:parseInt(_[1],10),width:parseInt(_[2],10)})),c.push(m);return v={id:y.Yd++,originalId:null,createSegmentIndex:function(){return Promise.resolve()},segmentIndex:new To(c),mimeType:t||"",codecs:"",kind:"",encrypted:!1,drmInfos:[],keyIds:new Set,language:"und",label:null,type:i.Wb,primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],forced:!1,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,closedCaptions:null,tilesLayout:"1x1"},y.i.imageStreams.push(v),Au(y),x.return(Ei(v))}}))},n.gf=function(e,t,i){var r,n,s,a,o=this;return P((function(h){switch(h.g){case 1:if(o.l!=qu&&o.l!=Yu)throw new Me(1,7,7004);if(i){h.A(2);break}return b(h,hu(o,e),3);case 3:i=h.h;case 2:if(r=[],o.F)try{r=o.F.getServerSideCuePoints()}catch(u){}return b(h,uu(o,e,t,"chapters",i,"",r),4);case 4:if(n=h.h,s=o.He(),!(a=s.find((function(e){return e.language==t})))){h.A(5);break}return b(h,new Promise((function(e,t){o.s.ma(n,"load",e),o.s.ma(n,"error",(function(){t(new Me(1,2,2015))}))})),6);case 6:return h.return(a);case 5:throw new Me(1,2,2012)}}))},n.ke=function(e,t){this.ec.width=e,this.ec.height=t},n.ce=function(e){if(this.l==qu){var t=this.j;if(e=void 0===e?.1:e,t.h.g)t=!1;else if(t.s)t=!1;else{for(var i=l(t.j.values()),r=i.next();!r.done;r=i.next())!(r=r.value).nc||r.ra||r.Ka||(r.nc=!1,Qo(t,r,e));t=!0}}else t=!1;return t},n.If=function(){return q("Shaka Player's internal Manifest structure is NOT covered by semantic versioning compatibility guarantees.  It may change at any time!  Please consider filing a feature request for whatever you use getManifest() for."),this.i},n.Jf=function(){return this.Yc},n.$e=function(e){this.Uc=e},j("shaka.Player",$h),$h.prototype.setVideoContainer=$h.prototype.$e,$h.prototype.getManifestParserFactory=$h.prototype.Jf,$h.prototype.getManifest=$h.prototype.If,$h.prototype.retryStreaming=$h.prototype.ce,$h.prototype.setMaxHardwareResolution=$h.prototype.ke,$h.prototype.addChaptersTrack=$h.prototype.gf,$h.prototype.addThumbnailsTrack=$h.prototype.jf,$h.prototype.addTextTrackAsync=$h.prototype.hf,$h.prototype.getStats=$h.prototype.getStats,$h.prototype.getBufferedInfo=$h.prototype.Na,$h.prototype.getPresentationStartTimeAsDate=$h.prototype.Ie,$h.prototype.getPlayheadTimeAsDate=$h.prototype.Of,$h.prototype.setTextTrackVisibility=$h.prototype.yg,$h.prototype.getChapters=$h.prototype.Cf,$h.prototype.getChaptersTracks=$h.prototype.He,$h.prototype.isTextTrackVisible=$h.prototype.Hd,$h.prototype.selectVariantsByLabel=$h.prototype.tg,$h.prototype.selectTextLanguage=$h.prototype.he,$h.prototype.selectAudioLanguage=$h.prototype.ge,$h.prototype.getTextLanguages=$h.prototype.Qf,$h.prototype.getAudioLanguages=$h.prototype.zf,$h.prototype.getTextLanguagesAndRoles=$h.prototype.Rf,$h.prototype.getAudioLanguagesAndRoles=$h.prototype.Af,$h.prototype.selectVariantTrack=$h.prototype.Te,$h.prototype.selectTextTrack=$h.prototype.Se,$h.prototype.getThumbnails=$h.prototype.Tf,$h.prototype.getImageTracks=$h.prototype.Ff,$h.prototype.getTextTracks=$h.prototype.Fb,$h.prototype.getVariantTracks=$h.prototype.Xa,$h.prototype.cancelTrickPlay=$h.prototype.pf,$h.prototype.trickPlay=$h.prototype.Ag,$h.prototype.getPlaybackRate=$h.prototype.Rc,$h.prototype.isBuffering=$h.prototype.Fd,$h.prototype.getKeyStatuses=$h.prototype.Qc,$h.prototype.getExpiration=$h.prototype.ic,$h.prototype.drmInfo=$h.prototype.drmInfo,$h.prototype.keySystem=$h.prototype.keySystem,$h.prototype.goToLive=$h.prototype.Xf,$h.prototype.seekRange=$h.prototype.uc,$h.prototype.isAudioOnly=$h.prototype.Zf,$h.prototype.isInProgress=$h.prototype.jb,$h.prototype.isLive=$h.prototype.U,$h.prototype.getAdManager=$h.prototype.Ge,$h.prototype.getAssetUri=$h.prototype.Dd,$h.prototype.getNetworkingEngine=$h.prototype.jc,$h.prototype.getMediaElement=$h.prototype.Lf,$h.prototype.getLoadMode=$h.prototype.Hf,$h.prototype.resetConfiguration=$h.prototype.rg,$h.prototype.getBufferFullness=$h.prototype.Bf,$h.prototype.getConfiguration=$h.prototype.getConfiguration,$h.prototype.configure=$h.prototype.configure,$h.prototype.load=$h.prototype.load,$h.prototype.updateStartTime=$h.prototype.Fg,$h.prototype.unload=$h.prototype.re,$h.prototype.detach=$h.prototype.detach,$h.prototype.attachCanvas=$h.prototype.lf,$h.prototype.attach=$h.prototype.Yb,$h.probeSupport=function(e){var t,i,r,n,s;return e=void 0===e||e,P((function(a){if(1==a.g)return t={},e?b(a,function(){var e,t,i,r,n,s;return P((function(a){return 1==a.g?(e="org.w3.clearkey com.widevine.alpha com.microsoft.playready com.microsoft.playready.recommendation com.apple.fps.1_0 com.apple.fps com.adobe.primetime".split(" "),i=[{videoCapabilities:t=[{contentType:'video/mp4; codecs="avc1.42E01E"'},{contentType:'video/webm; codecs="vp8"'}],persistentState:"required",sessionTypes:["persistent-license"]},{initDataTypes:["cenc"],videoCapabilities:t}],r=new Map,n=function(e){var t,n,s;return P((function(a){switch(a.g){case 1:if(T(a,2),"org.w3.clearkey"===e&&mt())throw Error("Unsupported keySystem");return b(a,navigator.requestMediaKeySystemAccess(e,i),4);case 4:return t=a.h,s=!!(n=t.getConfiguration().sessionTypes)&&n.includes("persistent-license"),_t("Tizen 3")&&(s=!1),r.set(e,{persistentState:s}),b(a,t.createMediaKeys(),5);case 5:A(a,0);break;case 2:C(a),r.set(e,null),w(a)}}))},s=e.map((function(e){return n(e)})),b(a,Promise.all(s),2)):a.return(jr(r))}))}(),3):a.A(2);2!=a.g&&(t=a.h);var o={};if(ht()){for(var h in Qn)o[h]=!0;for(var u in Jn)o[u]=!0}h={mpd:"application/dash+xml",m3u8:"application/x-mpegurl",ism:"application/vnd.ms-sstr+xml"};for(var d=(u=l(["application/dash+xml","application/x-mpegurl","application/vnd.apple.mpegurl","application/vnd.ms-sstr+xml"])).next();!d.done;d=u.next())o[d=d.value]=ht()?!!Qn[d]:ut(d);for(var p in h)o[p]=ht()?!!Jn[p]:ut(h[p]);for(i=o,o={},h=(p=l(p='video/mp4; codecs="avc1.42E01E",video/mp4; codecs="avc3.42E01E",video/mp4; codecs="hev1.1.6.L93.90",video/mp4; codecs="hvc1.1.6.L93.90",video/mp4; codecs="hev1.2.4.L153.B0"; eotf="smpte2084",video/mp4; codecs="hvc1.2.4.L153.B0"; eotf="smpte2084",video/mp4; codecs="vp9",video/mp4; codecs="vp09.00.10.08",video/mp4; codecs="av01.0.01M.08",audio/mp4; codecs="mp4a.40.2",audio/mp4; codecs="ac-3",audio/mp4; codecs="ec-3",audio/mp4; codecs="opus",audio/mp4; codecs="flac",video/webm; codecs="vp8",video/webm; codecs="vp9",video/webm; codecs="vp09.00.10.08",audio/webm; codecs="vorbis",audio/webm; codecs="opus",video/mp2t; codecs="avc1.42E01E",video/mp2t; codecs="avc3.42E01E",video/mp2t; codecs="hvc1.1.6.L93.90",video/mp2t; codecs="mp4a.40.2",video/mp2t; codecs="ac-3",video/mp2t; codecs="ec-3",text/vtt,application/mp4; codecs="wvtt",application/ttml+xml,application/mp4; codecs="stpp"'.split(",").concat(c(to)))).next();!h.done;h=p.next())o[h=h.value]=ht()?!!Kt(h)||(J(h)||zt(h)):ut(h),o[u=h.split(";")[0]]=o[u]||o[h];for(s in r={manifest:i,media:o,drm:t},n=Zu)r[s]=n[s]();return a.return(r)}))},$h.isBrowserSupported=function(){if(e.Promise||q("A Promise implementation or polyfill is required"),!(e.Promise&&e.Uint8Array&&Array.prototype.forEach)||_t("Trident/"))return!1;var t=mt();return!(t&&13>t||!(e.MediaKeys&&e.navigator&&e.navigator.requestMediaKeySystemAccess&&e.MediaKeySystemAccess&&e.MediaKeySystemAccess.prototype.getConfiguration))&&(!!ht()||ut("application/x-mpegurl"))},$h.setAdManagerFactory=function(e){Qu=e},$h.registerSupportPlugin=function(e,t){Zu[e]=t},$h.prototype.destroy=$h.prototype.destroy;var Gu=0,Xu=1,qu=2,Yu=3;$h.LoadMode={DESTROYED:Gu,NOT_LOADED:Xu,MEDIA_SOURCE:qu,SRC_EQUALS:Yu},$h.version="v4.3.5";var $u=["4","3"];Qi=new function(e){this.g=e,this.i=Ki,this.h=Zi}(new Yi(Number($u[0]),Number($u[1])));var Ku=["output-restricted","internal-error"],Zu={},Qu=null,Ju={mp4:"video/mp4",m4v:"video/mp4",m4a:"audio/mp4",webm:"video/webm",weba:"audio/webm",mkv:"video/webm",ts:"video/mp2t",ogv:"video/ogg",ogg:"audio/ogg",mpg:"video/mpeg",mpeg:"video/mpeg",m3u8:"application/x-mpegurl",mpd:"application/dash+xml",mp3:"audio/mpeg",aac:"audio/aac",flac:"audio/flac",wav:"audio/wav"},el={sbv:"text/x-subviewer",srt:"text/srt",vtt:"text/vtt",webvtt:"text/vtt",ttml:"application/ttml+xml",lrc:"application/x-subtitle-lrc",ssa:"text/x-ssa",ass:"text/x-ssa"};function tl(){this.h=[],this.j=this.i=this.g=0}function il(e,t,i){var r=this;this.h=e,this.g=t,this.m=i,this.i=!1,this.l=this.g.getVolume(),this.j=new Nr,this.j.C(this.g,google.ima.AdEvent.Type.PAUSED,(function(){r.i=!0})),this.j.C(this.g,google.ima.AdEvent.Type.RESUMED,(function(){r.i=!1}))}function rl(t,i,r,n){var s=this;this.o=t,this.i=i,this.s=null,this.u=NaN,this.l=n,this.j=null,this.h=new Nr,google.ima.settings.setLocale(r),(t=new google.ima.AdDisplayContainer(this.o,this.i)).initialize(),this.m=new google.ima.AdsLoader(t),this.m.getSettings().setPlayerType("shaka-player"),this.m.getSettings().setPlayerVersion("v4.3.5"),this.g=null,this.h.ma(this.m,google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,(function(t){!function(t,i){t.l(new _r("ads-loaded",(new Map).set("loadTime",Date.now()/1e3-t.u))),t.g=i.getAdsManager(t.i),t.l(new _r("ima-ad-manager-loaded",(new Map).set("imaAdManager",t.g)));var r=t.g.getCuePoints();if(r.length){i=[];for(var n=(r=l(r)).next();!n.done;n=r.next())i.push({start:n.value,end:null});t.l(new _r("ad-cue-points-changed",(new Map).set("cuepoints",i)))}!function(e){function t(t,i){t=(new Map).set("originalEvent",t),e.l(new _r(i,t))}e.h.C(e.g,google.ima.AdErrorEvent.Type.AD_ERROR,(function(t){nl(e,t)})),e.h.C(e.g,google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,(function(t){al(e,t)})),e.h.C(e.g,google.ima.AdEvent.Type.STARTED,(function(t){al(e,t)})),e.h.C(e.g,google.ima.AdEvent.Type.FIRST_QUARTILE,(function(e){t(e,"ad-first-quartile")})),e.h.C(e.g,google.ima.AdEvent.Type.MIDPOINT,(function(e){t(e,"ad-midpoint")})),e.h.C(e.g,google.ima.AdEvent.Type.THIRD_QUARTILE,(function(e){t(e,"ad-third-quartile")})),e.h.C(e.g,google.ima.AdEvent.Type.COMPLETE,(function(e){t(e,"ad-complete")})),e.h.C(e.g,google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,(function(t){ol(e,t)})),e.h.C(e.g,google.ima.AdEvent.Type.ALL_ADS_COMPLETED,(function(t){ol(e,t)})),e.h.C(e.g,google.ima.AdEvent.Type.SKIPPED,(function(e){t(e,"ad-skipped")})),e.h.C(e.g,google.ima.AdEvent.Type.VOLUME_CHANGED,(function(e){t(e,"ad-volume-changed")})),e.h.C(e.g,google.ima.AdEvent.Type.VOLUME_MUTED,(function(e){t(e,"ad-muted")})),e.h.C(e.g,google.ima.AdEvent.Type.PAUSED,(function(i){e.j&&(e.j.i=!0,t(i,"ad-paused"))})),e.h.C(e.g,google.ima.AdEvent.Type.RESUMED,(function(i){e.j&&(e.j.i=!1,t(i,"ad-resumed"))})),e.h.C(e.g,google.ima.AdEvent.Type.SKIPPABLE_STATE_CHANGED,(function(i){e.j&&t(i,"ad-skip-state-changed")})),e.h.C(e.g,google.ima.AdEvent.Type.CLICK,(function(e){t(e,"ad-clicked")})),e.h.C(e.g,google.ima.AdEvent.Type.AD_PROGRESS,(function(e){t(e,"ad-progress")})),e.h.C(e.g,google.ima.AdEvent.Type.AD_BUFFERING,(function(e){t(e,"ad-buffering")})),e.h.C(e.g,google.ima.AdEvent.Type.IMPRESSION,(function(e){t(e,"ad-impression")})),e.h.C(e.g,google.ima.AdEvent.Type.DURATION_CHANGE,(function(e){t(e,"ad-duration-changed")})),e.h.C(e.g,google.ima.AdEvent.Type.USER_CLOSE,(function(e){t(e,"ad-closed")})),e.h.C(e.g,google.ima.AdEvent.Type.LOADED,(function(e){t(e,"ad-loaded")})),e.h.C(e.g,google.ima.AdEvent.Type.ALL_ADS_COMPLETED,(function(e){t(e,"all-ads-completed")})),e.h.C(e.g,google.ima.AdEvent.Type.LINEAR_CHANGED,(function(e){t(e,"ad-linear-changed")})),e.h.C(e.g,google.ima.AdEvent.Type.AD_METADATA,(function(e){t(e,"ad-metadata")})),e.h.C(e.g,google.ima.AdEvent.Type.LOG,(function(e){t(e,"ad-recoverable-error")})),e.h.C(e.g,google.ima.AdEvent.Type.AD_BREAK_READY,(function(e){t(e,"ad-break-ready")})),e.h.C(e.g,google.ima.AdEvent.Type.INTERACTION,(function(e){t(e,"ad-interaction")}))}(t);try{t.g.init(t.i.offsetWidth,t.i.offsetHeight,sl(t)?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL),t.h.C(t.i,"loadeddata",(function(){t.g.resize(t.i.offsetWidth,t.i.offsetHeight,sl(t)?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL)})),"ResizeObserver"in e?(t.s=new ResizeObserver((function(){t.g.resize(t.i.offsetWidth,t.i.offsetHeight,sl(t)?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL)})),t.s.observe(t.i)):t.h.C(document,"fullscreenchange",(function(){t.g.resize(t.i.offsetWidth,t.i.offsetHeight,sl(t)?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL)})),t.i.addEventListener("play",(function(){t.g.start()}),{once:!0})}catch(s){ol(t,null)}}(s,t)})),this.h.C(this.m,google.ima.AdErrorEvent.Type.AD_ERROR,(function(e){nl(s,e)})),this.h.C(this.i,"ended",(function(){s.m.contentComplete()}))}function nl(e,t){t.getError(),ol(e,null),e.l(new _r("ad-cue-points-changed",(new Map).set("cuepoints",[])))}function sl(e){return document.fullscreenEnabled?!!document.fullscreenElement:!!(e=e.i).webkitSupportsFullscreen&&e.webkitDisplayingFullscreen}function al(e,t){var i=t.getAd();i?(e.j=new il(i,e.g,e.i),t=(new Map).set("ad",e.j).set("sdkAdObject",i).set("originalEvent",t),e.l(new _r("ad-started",t)),e.j.isLinear()&&(e.o.setAttribute("ad-active","true"),e.i.pause(),e.j.setVolume(e.i.muted?0:e.i.volume))):q("The IMA SDK fired a "+t.type+" event with no associated ad. Unable to play ad!")}function ol(e,t){e.l(new _r("ad-stopped",(new Map).set("originalEvent",t))),e.j&&e.j.isLinear()&&(e.o.removeAttribute("ad-active"),e.i.ended||e.i.play())}function hl(e,t){this.i=e,this.h=null,this.g=t}function ul(e,t,i,r){var n=this;this.s=e,this.l=t,this.j=null,this.G=NaN,this.i=r,this.F=!1,this.u=this.m=this.o=null,this.B="",this.D=[],this.h=new Nr,(e=new google.ima.dai.api.UiSettings).setLocale(i),this.g=new google.ima.dai.api.StreamManager(this.l,this.s,e),this.i(new _r("ima-stream-manager-loaded",(new Map).set("imaStreamManager",this.g))),this.h.C(this.g,google.ima.dai.api.StreamEvent.Type.LOADED,(function(e){!function(e,t){e.i(new _r("ads-loaded",(new Map).set("loadTime",Date.now()/1e3-e.G))),t=t.getStreamData().url,e.j.resolve(t),e.j=null,e.F||e.h.C(e.l,"seeked",(function(){var t=e.l.currentTime;if(0!=t){e.g.streamTimeForContentTime(t);var i=e.g.previousCuePointForStreamTime(t);i&&!i.played&&(e.o=t,e.l.currentTime=i.start)}}))}(n,e)})),this.h.C(this.g,google.ima.dai.api.StreamEvent.Type.ERROR,(function(){n.B.length?n.j.resolve(n.B):n.j.reject("IMA Stream request returned an error and there was no backup asset uri provided."),n.j=null})),this.h.C(this.g,google.ima.dai.api.StreamEvent.Type.AD_BREAK_STARTED,(function(){})),this.h.C(this.g,google.ima.dai.api.StreamEvent.Type.STARTED,(function(e){e=e.getAd(),n.m=new hl(e,n.l),n.u&&(n.m.h=n.u),n.i(new _r("ad-started",(new Map).set("ad",n.m))),n.s.setAttribute("ad-active","true")})),this.h.C(this.g,google.ima.dai.api.StreamEvent.Type.AD_BREAK_ENDED,(function(){n.s.removeAttribute("ad-active");var e=n.l.currentTime;n.o&&n.o>e&&(n.l.currentTime=n.o,n.o=null)})),this.h.C(this.g,google.ima.dai.api.StreamEvent.Type.AD_PROGRESS,(function(e){n.u=e.getStreamData().adProgressData,n.m&&(n.m.h=n.u)})),this.h.C(this.g,google.ima.dai.api.StreamEvent.Type.FIRST_QUARTILE,(function(){n.i(new _r("ad-first-quartile"))})),this.h.C(this.g,google.ima.dai.api.StreamEvent.Type.MIDPOINT,(function(){n.i(new _r("ad-midpoint"))})),this.h.C(this.g,google.ima.dai.api.StreamEvent.Type.THIRD_QUARTILE,(function(){n.i(new _r("ad-third-quartile"))})),this.h.C(this.g,google.ima.dai.api.StreamEvent.Type.COMPLETE,(function(){n.i(new _r("ad-complete")),n.i(new _r("ad-stopped")),n.s.removeAttribute("ad-active"),n.m=null})),this.h.C(this.g,google.ima.dai.api.StreamEvent.Type.SKIPPED,(function(){n.i(new _r("ad-skipped")),n.i(new _r("ad-stopped"))})),this.h.C(this.g,google.ima.dai.api.StreamEvent.Type.CUEPOINTS_CHANGED,(function(e){var t=e.getStreamData();e=[];for(var i=(t=l(t.cuepoints)).next();!i.done;i=t.next())i=i.value,e.push({start:i.start,end:i.end});n.D=e,n.i(new _r("ad-cue-points-changed",(new Map).set("cuepoints",e)))}))}function ll(){xr.call(this),this.g=this.i=null,this.h=new tl,this.j=navigator.language}function cl(e){return JSON.stringify(e,(function(e,t){if("function"!=typeof t){if(t instanceof Event||t instanceof _r){var i={};for(r in t)(e=t[r])&&"object"==typeof e?"detail"==r&&(i[r]=e):r in Event||(i[r]=e);return i}if(t instanceof Error){var r=new Set(["name","message","stack"]);for(i in t)r.add(i);for(i=(e=l(Object.getOwnPropertyNames(t))).next();!i.done;i=e.next())r.add(i.value);for(e={},i=(r=l(r)).next();!i.done;i=r.next())e[i=i.value]=t[i];t={__type__:"Error",contents:e}}else if(t instanceof TimeRanges){for(r={__type__:"TimeRanges",length:t.length,start:[],end:[]},i=(t=l(Ta(t))).next();!i.done;i=t.next())e=(i=i.value).end,r.start.push(i.start),r.end.push(e);t=r}else t=t instanceof Uint8Array?{__type__:"Uint8Array",entries:Array.from(t)}:"number"==typeof t?isNaN(t)?"NaN":isFinite(t)?t:0>t?"-Infinity":"Infinity":t;return t}}))}function dl(e){return JSON.parse(e,(function(e,t){if("NaN"==t)var i=NaN;else if("-Infinity"==t)i=-1/0;else if("Infinity"==t)i=1/0;else if(t&&"object"==typeof t&&"TimeRanges"==t.__type__)i=function(e){return{length:e.length,start:function(t){return e.start[t]},end:function(t){return e.end[t]}}}(t);else if(t&&"object"==typeof t&&"Uint8Array"==t.__type__)i=new Uint8Array(t.entries);else if(t&&"object"==typeof t&&"Error"==t.__type__){for(i in e=t.contents,t=Error(e.message),e)t[i]=e[i];i=t}else i=t;return i}))}(n=il.prototype).getDuration=function(){return this.h.getDuration()},n.getMinSuggestedDuration=function(){return this.h.getMinSuggestedDuration()},n.getRemainingTime=function(){return this.g.getRemainingTime()},n.isPaused=function(){return this.i},n.isSkippable=function(){return 0<=this.h.getSkipTimeOffset()},n.getTimeUntilSkippable=function(){var e=this.h.getSkipTimeOffset();return e=this.getRemainingTime()-e,Math.max(e,0)},n.canSkipNow=function(){return this.g.getAdSkippableState()},n.skip=function(){return this.g.skip()},n.pause=function(){return this.g.pause()},n.play=function(){return this.g.resume()},n.getVolume=function(){return this.g.getVolume()},n.setVolume=function(e){return this.g.setVolume(e)},n.isMuted=function(){return 0==this.g.getVolume()},n.isLinear=function(){return this.h.isLinear()},n.resize=function(e,t){var i=!1,r=this.m;document.fullscreenEnabled?i=!!document.fullscreenElement:r.webkitSupportsFullscreen&&(i=r.webkitDisplayingFullscreen),this.g.resize(e,t,i?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL)},n.setMuted=function(e){e?(this.l=this.getVolume(),this.setVolume(0)):this.setVolume(this.l)},n.getSequenceLength=function(){var e=this.h.getAdPodInfo();return null==e?1:e.getTotalAds()},n.getPositionInSequence=function(){var e=this.h.getAdPodInfo();return null==e?1:e.getAdPosition()},n.getTitle=function(){return this.h.getTitle()},n.getDescription=function(){return this.h.getDescription()},n.release=function(){this.g=this.h=null},j("shaka.ads.ClientSideAd",il),il.prototype.release=il.prototype.release,il.prototype.getDescription=il.prototype.getDescription,il.prototype.getTitle=il.prototype.getTitle,il.prototype.getPositionInSequence=il.prototype.getPositionInSequence,il.prototype.getSequenceLength=il.prototype.getSequenceLength,il.prototype.setMuted=il.prototype.setMuted,il.prototype.resize=il.prototype.resize,il.prototype.isLinear=il.prototype.isLinear,il.prototype.isMuted=il.prototype.isMuted,il.prototype.setVolume=il.prototype.setVolume,il.prototype.getVolume=il.prototype.getVolume,il.prototype.play=il.prototype.play,il.prototype.pause=il.prototype.pause,il.prototype.skip=il.prototype.skip,il.prototype.canSkipNow=il.prototype.canSkipNow,il.prototype.getTimeUntilSkippable=il.prototype.getTimeUntilSkippable,il.prototype.isSkippable=il.prototype.isSkippable,il.prototype.isPaused=il.prototype.isPaused,il.prototype.getRemainingTime=il.prototype.getRemainingTime,il.prototype.getMinSuggestedDuration=il.prototype.getMinSuggestedDuration,il.prototype.getDuration=il.prototype.getDuration,rl.prototype.stop=function(){this.g&&this.g.stop(),this.o&&ch(this.o)},rl.prototype.release=function(){this.stop(),this.s&&this.s.disconnect(),this.h&&this.h.release(),this.g&&this.g.destroy(),this.m.destroy()},(n=hl.prototype).getDuration=function(){return this.h?this.h.duration:-1},n.getMinSuggestedDuration=function(){return this.getDuration()},n.getRemainingTime=function(){return this.h?this.h.duration-this.h.currentTime:-1},n.isPaused=function(){return this.g.paused},n.isSkippable=function(){return this.i.isSkippable()},n.getTimeUntilSkippable=function(){var e=this.i.getSkipTimeOffset();return e=this.getRemainingTime()-e,Math.max(e,0)},n.canSkipNow=function(){return 0==this.getTimeUntilSkippable()},n.skip=function(){this.g.currentTime+=this.getRemainingTime()},n.pause=function(){return this.g.pause()},n.play=function(){return this.g.play()},n.getVolume=function(){return this.g.volume},n.setVolume=function(e){this.g.volume=e},n.isMuted=function(){return this.g.muted},n.isLinear=function(){return!0},n.resize=function(){},n.setMuted=function(e){this.g.muted=e},n.getSequenceLength=function(){var e=this.i.getAdPodInfo();return null==e?1:e.getTotalAds()},n.getPositionInSequence=function(){var e=this.i.getAdPodInfo();return null==e?1:e.getAdPosition()},n.getTitle=function(){return this.i.getTitle()},n.getDescription=function(){return this.i.getDescription()},n.release=function(){this.g=this.h=this.i=null},j("shaka.ads.ServerSideAd",hl),hl.prototype.release=hl.prototype.release,hl.prototype.getDescription=hl.prototype.getDescription,hl.prototype.getTitle=hl.prototype.getTitle,hl.prototype.getPositionInSequence=hl.prototype.getPositionInSequence,hl.prototype.getSequenceLength=hl.prototype.getSequenceLength,hl.prototype.setMuted=hl.prototype.setMuted,hl.prototype.resize=hl.prototype.resize,hl.prototype.isLinear=hl.prototype.isLinear,hl.prototype.isMuted=hl.prototype.isMuted,hl.prototype.setVolume=hl.prototype.setVolume,hl.prototype.getVolume=hl.prototype.getVolume,hl.prototype.play=hl.prototype.play,hl.prototype.pause=hl.prototype.pause,hl.prototype.skip=hl.prototype.skip,hl.prototype.canSkipNow=hl.prototype.canSkipNow,hl.prototype.getTimeUntilSkippable=hl.prototype.getTimeUntilSkippable,hl.prototype.isSkippable=hl.prototype.isSkippable,hl.prototype.isPaused=hl.prototype.isPaused,hl.prototype.getRemainingTime=hl.prototype.getRemainingTime,hl.prototype.getMinSuggestedDuration=hl.prototype.getMinSuggestedDuration,hl.prototype.getDuration=hl.prototype.getDuration,ul.prototype.stop=function(){this.B="",this.o=null,this.D=[]},ul.prototype.release=function(){this.stop(),this.h&&this.h.release()},ul.prototype.onCueMetadataChange=function(e){if(e.key&&e.data){var t={};t[e.key]=e.data,this.g.onTimedMetadata(t)}},_(ll,xr),(n=ll.prototype).setLocale=function(e){this.j=e},n.initClientSide=function(t,i){var r=this;if(!e.google||!google.ima||!google.ima.AdsLoader)throw new Me(2,10,1e4);this.i&&this.i.release(),this.i=new rl(t,i,this.j,(function(e){if(e&&e.type)switch(e.type){case"ads-loaded":r.h.h.push(e.loadTime);break;case"ad-started":r.h.g++;break;case"ad-complete":r.h.i++;break;case"ad-skipped":r.h.j++}r.dispatchEvent(e)}))},n.release=function(){this.i&&(this.i.release(),this.i=null),this.g&&(this.g.release(),this.g=null),xr.prototype.release.call(this)},n.onAssetUnload=function(){this.i&&this.i.stop(),this.g&&this.g.stop(),this.dispatchEvent(new _r("ad-stopped")),this.h=new tl},n.requestClientSideAds=function(e){if(!this.i)throw new Me(1,10,10001);var t=this.i;t.u=Date.now()/1e3,t.m.requestAds(e)},n.initServerSide=function(t,i){var r=this;if(!e.google||!google.ima||!google.ima.dai)throw new Me(2,10,10002);this.g&&this.g.release(),this.g=new ul(t,i,this.j,(function(e){if(e&&e.type)switch(e.type){case"ads-loaded":r.h.h.push(e.loadTime);break;case"ad-started":r.h.g++;break;case"ad-complete":r.h.i++;break;case"ad-skipped":r.h.j++}r.dispatchEvent(e)}))},n.requestServerSideStream=function(e,t){if(t=void 0===t?"":t,!this.g)throw new Me(1,10,10003);e.adTagParameters||(e.adTagParameters={});var i=e.adTagParameters;return(i.mpt||i.mpv)&&q('You have attempted to set "mpt" and/or "mpv" parameters of the ad tag. Please note that those parameters are used for Shaka adoption tracking and will be overriden.'),e.adTagParameters.mpt="shaka-player",e.adTagParameters.mpv="v4.3.5",(i=this.g).j?e=Promise.reject(new Me(1,10,10004)):(e instanceof google.ima.dai.api.LiveStreamRequest&&(i.F=!0),i.j=new nt,i.g.requestStream(e),i.B=t||"",i.G=Date.now()/1e3,e=i.j),e},n.replaceServerSideAdTagParameters=function(e){if(!this.g)throw new Me(1,10,10003);(e.mpt||e.mpv)&&q('You have attempted to set "mpt" and/or "mpv" parameters of the ad tag. Please note that those parameters are used for Shaka adoption tracking and will be overriden.'),e.mpt="Shaka Player",e.mpv="v4.3.5",this.g.g.replaceAdTagParameters(e)},n.getServerSideCuePoints=function(){if(!this.g)throw new Me(1,10,10003);return this.g.D},n.getStats=function(){var e=this.h;return{loadTimes:e.h,started:e.g,playedCompletely:e.i,skipped:e.j}},n.onDashTimedMetadata=function(e){if(this.g&&"urn:google:dai:2018"==e.schemeIdUri){var t=e.schemeIdUri,i=e.eventElement?e.eventElement.getAttribute("messageData"):null;this.g.g.processMetadata(t,i,e.startTime)}},n.onHlsTimedMetadata=function(e,t){this.g&&this.g.g.processMetadata("ID3",e.data,t)},n.onCueMetadataChange=function(e){this.g&&this.g.onCueMetadataChange(e)},j("shaka.ads.AdManager",ll),ll.prototype.onCueMetadataChange=ll.prototype.onCueMetadataChange,ll.prototype.onHlsTimedMetadata=ll.prototype.onHlsTimedMetadata,ll.prototype.onDashTimedMetadata=ll.prototype.onDashTimedMetadata,ll.prototype.getStats=ll.prototype.getStats,ll.prototype.getServerSideCuePoints=ll.prototype.getServerSideCuePoints,ll.prototype.replaceServerSideAdTagParameters=ll.prototype.replaceServerSideAdTagParameters,ll.prototype.requestServerSideStream=ll.prototype.requestServerSideStream,ll.prototype.initServerSide=ll.prototype.initServerSide,ll.prototype.requestClientSideAds=ll.prototype.requestClientSideAds,ll.prototype.onAssetUnload=ll.prototype.onAssetUnload,ll.prototype.release=ll.prototype.release,ll.prototype.initClientSide=ll.prototype.initClientSide,ll.prototype.setLocale=ll.prototype.setLocale,ll.ADS_LOADED="ads-loaded",ll.AD_STARTED="ad-started",ll.AD_FIRST_QUARTILE="ad-first-quartile",ll.AD_MIDPOINT="ad-midpoint",ll.AD_THIRD_QUARTILE="ad-third-quartile",ll.AD_COMPLETE="ad-complete",ll.AD_STOPPED="ad-stopped",ll.AD_SKIPPED="ad-skipped",ll.AD_VOLUME_CHANGED="ad-volume-changed",ll.AD_MUTED="ad-muted",ll.AD_PAUSED="ad-paused",ll.AD_RESUMED="ad-resumed",ll.AD_SKIP_STATE_CHANGED="ad-skip-state-changed",ll.CUEPOINTS_CHANGED="ad-cue-points-changed",ll.IMA_AD_MANAGER_LOADED="ima-ad-manager-loaded",ll.IMA_STREAM_MANAGER_LOADED="ima-stream-manager-loaded",ll.AD_CLICKED="ad-clicked",ll.AD_PROGRESS="ad-progress",ll.AD_BUFFERING="ad-buffering",ll.AD_IMPRESSION="ad-impression",ll.AD_DURATION_CHANGED="ad-duration-changed",ll.AD_CLOSED="ad-closed",ll.AD_LOADED="ad-loaded",ll.ALL_ADS_COMPLETED="all-ads-completed",ll.AD_LINEAR_CHANGED="ad-linear-changed",ll.AD_METADATA="ad-metadata",ll.AD_RECOVERABLE_ERROR="ad-recoverable-error",ll.AD_BREAK_READY="ad-break-ready",ll.AD_INTERACTION="ad-interaction",Qu=function(){return new ll};var pl="ended play playing pause pausing ratechange seeked seeking timeupdate volumechange".split(" "),gl="buffered currentTime duration ended loop muted paused playbackRate seeking videoHeight videoWidth volume".split(" "),fl=["loop","playbackRate"],ml=["pause","play"],_l={getAssetUri:2,getAudioLanguages:4,getAudioLanguagesAndRoles:4,getBufferFullness:1,getBufferedInfo:2,getExpiration:2,getKeyStatuses:2,getPlaybackRate:2,getTextLanguages:4,getTextLanguagesAndRoles:4,getImageTracks:2,getThumbnails:2,isAudioOnly:10,isBuffering:1,isInProgress:1,isLive:10,isTextTrackVisible:1,keySystem:10,seekRange:1,getLoadMode:10},vl={getConfiguration:4,getStats:5,getTextTracks:2,getVariantTracks:2},yl={getPlayheadTimeAsDate:1,getPresentationStartTimeAsDate:20},xl=[["getConfiguration","configure"]],bl=[["isTextTrackVisible","setTextTrackVisibility"]],wl="addChaptersTrack addTextTrackAsync addThumbnailsTrack cancelTrickPlay configure getChapters getChaptersTracks resetConfiguration retryStreaming selectAudioLanguage selectTextLanguage selectTextTrack selectVariantTrack selectVariantsByLabel setTextTrackVisibility trickPlay updateStartTime goToLive".split(" "),Tl=["attach","attachCanvas","detach","load","unload"];function Sl(e,t,i,r,n,s,a){var o=this;this.G=e,this.M=a,this.j=new ot(t),this.O=i,this.u=!1,this.s=r,this.F=n,this.J=s,this.h=this.m=!1,this.L="",this.o=null,this.B=function(){return Rl(o)},this.D=function(e,t){switch((e=dl(t)).type){case"event":var i=e.targetName,r=vr(e.event);o.s(i,r);break;case"update":for(r in i=e.update)for(var n in e=o.g[r]||{},i[r])e[n]=i[r][n];o.u&&(o.O(),o.u=!1);break;case"asyncComplete":if(r=e.id,n=e.error,e=o.i[r],delete o.i[r],e)if(n){for(i in r=new Me(n.severity,n.category,n.code),n)r[i]=n[i];e.reject(r)}else e.resolve()}},this.g={video:{},player:{}},this.H=0,this.i={},this.l=null,Nl.add(this)}function Al(e,t,i){Ol=i,i.addUpdateListener(e.B),i.addMessageListener("urn:x-cast:com.google.shaka.v2",e.D),Rl(e),kl(e,{type:"init",initState:t,appData:e.o}),e.l.resolve()}function Cl(e,t){var i=8003;switch(t.code){case"cancel":i=8004;break;case"timeout":i=8005;break;case"receiver_unavailable":i=8006}e.l.reject(new Me(2,8,i,t))}function El(e,t){var i=e.J();e.l=new nt,e.u=!0,Al(e,i,t)}function Il(e){var t=Ol;t.removeUpdateListener(e.B),t.removeMessageListener("urn:x-cast:com.google.shaka.v2",e.D)}function Rl(e){var t=!!Ol&&"connected"==Ol.status;if(e.h&&!t){for(var i in e.F(),e.g)e.g[i]={};Ll(e)}e.h=t,e.L=t?Ol.receiver.friendlyName:"",e.j.Mb()}function Ll(e){for(var t in e.i){var i=e.i[t];delete e.i[t],i.reject(new Me(1,7,7e3))}}function kl(e,t){t=cl(t);var i=Ol;try{i.sendMessage("urn:x-cast:com.google.shaka.v2",t,(function(){}),$)}catch(r){throw t=new Me(2,8,8005,r),i=new _r("error",(new Map).set("detail",t)),e.s("player",i),e.Ab(),t}}(n=Sl.prototype).destroy=function(){return Nl.delete(this),Ll(this),Ol&&Il(this),this.j&&(this.j.stop(),this.j=null),this.F=this.s=null,this.h=this.m=!1,this.D=this.B=this.l=this.i=this.g=this.o=null,Promise.resolve()},n.sa=function(){return this.h},n.ae=function(){return this.L},n.init=function(){if(this.G.length)if(e.chrome&&chrome.cast&&chrome.cast.isAvailable){this.m=!0,this.j.Mb();var t=new chrome.cast.SessionRequest(this.G,[],null,this.M,null);t=new chrome.cast.ApiConfig(t,(function(e){for(var t=l(Nl),i=t.next();!i.done;i=t.next())El(i.value,e)}),(function(e){for(var t=l(Nl),i=t.next();!i.done;i=t.next())i=i.value,Pl="available"==e,i.j.Mb()}),"origin_scoped"),chrome.cast.initialize(t,(function(){}),(function(){})),Pl&&this.j.N(Ml),(t=Ol)&&t.status!=chrome.cast.SessionStatus.STOPPED?El(this,t):Ol=null}else e.__onGCastApiAvailable!==Fl&&(Dl=e.__onGCastApiAvailable||null,e.__onGCastApiAvailable=Fl)},n.ie=function(e){this.o=e,this.h&&kl(this,{type:"appData",appData:this.o})},n.cast=function(e){var t=this;return P((function(i){if(!t.m)throw new Me(1,8,8e3);if(!Pl)throw new Me(1,8,8001);if(t.h)throw new Me(1,8,8002);return t.l=new nt,chrome.cast.requestSession((function(i){return Al(t,e,i)}),(function(e){return Cl(t,e)})),b(i,t.l,0)}))},n.Ab=function(){if(this.h){if(Ll(this),Ol){Il(this);try{Ol.stop((function(){}),(function(){}))}catch(W_){}Ol=null}Rl(this)}},n.get=function(e,t){var i=this;if("video"==e){if(ml.includes(t))return function(){return i.Qe.apply(i,[e,t].concat(c(O.apply(0,arguments))))}}else if("player"==e){if(yl[t]&&!this.get("player","isLive")())return function(){};if(wl.includes(t))return function(){return i.Qe.apply(i,[e,t].concat(c(O.apply(0,arguments))))};if(Tl.includes(t))return function(){return i.og.apply(i,[e,t].concat(c(O.apply(0,arguments))))};if(_l[t]||vl[t])return function(){return i.g[e][t]}}return this.g[e][t]},n.set=function(e,t,i){this.g[e][t]=i,kl(this,{type:"set",targetName:e,property:t,value:i})},n.Qe=function(e,t){kl(this,{type:"call",targetName:e,methodName:t,args:O.apply(2,arguments)})},n.og=function(e,t){var i=O.apply(2,arguments),r=new nt,n=this.H.toString();this.H++,this.i[n]=r;try{kl(this,{type:"asyncCall",targetName:e,methodName:t,args:i,id:n})}catch(s){r.reject(s)}return r};var Ml=.02,Pl=!1,Ol=null,Dl=null,Nl=new Set;function Fl(t){if(Dl?e.__onGCastApiAvailable=Dl:delete e.__onGCastApiAvailable,Dl=null,t)for(var i=l(Nl),r=i.next();!r.done;r=i.next())r.value.init();"function"==typeof e.__onGCastApiAvailable&&e.__onGCastApiAvailable(t)}function Ul(e,t,i,r){r=void 0!==r&&r,xr.call(this);var n=this;this.i=e,this.h=t,this.m=this.o=this.j=this.s=this.l=null,this.D=i,this.B=r,this.u=new Map,this.g=new Sl(i,(function(){return jl(n)}),(function(){return Hl(n)}),(function(e,t){return Gl(n,e,t)}),(function(){return Vl(n)}),(function(){return Bl(n)}),r),function(e){e.g.init(),e.m=new Nr;for(var t=l(pl),i=t.next();!i.done;i=t.next())e.m.C(e.i,i.value,(function(t){e.g.sa()||(t=vr(t),e.j.dispatchEvent(t))}));for(var r in yr)e.m.C(e.h,yr[r],(function(t){e.g.sa()||e.o.dispatchEvent(t)}));for(var n in e.l={},t={},e.i)t.Sb=n,Object.defineProperty(e.l,t.Sb,{configurable:!1,enumerable:!0,get:function(t){return function(){return Wl(e,t.Sb)}}(t),set:function(t){return function(i){var r=t.Sb;e.g.sa()?e.g.set("video",r,i):e.i[r]=i}}(t)}),t={Sb:t.Sb};e.s={},zl(e,(function(t){Object.defineProperty(e.s,t,{configurable:!1,enumerable:!0,get:function(){return function(e,t){if(e.u.has(t)&&(t=e.u.get(t)),"addEventListener"==t)return function(t,i,r){return e.o.addEventListener(t,i,r)};if("removeEventListener"==t)return function(t,i,r){return e.o.removeEventListener(t,i,r)};if("getMediaElement"==t)return function(){return e.l};if("getSharedConfiguration"==t)return e.g.get("player","getConfiguration");if("getNetworkingEngine"==t)return function(){return e.h.jc()};if("getDrmEngine"==t)return function(){return e.h.m};if("getAdManager"==t)return function(){return e.h.Ge()};if("setVideoContainer"==t)return function(t){return e.h.$e(t)};if(e.g.sa()){if("getManifest"==t||"drmInfo"==t)return function(){return q(t+"() does not work while casting!"),null};if("attach"==t||"detach"==t)return function(){return q(t+"() does not work while casting!"),Promise.resolve()}}return e.g.sa()&&0==Object.keys(e.g.g.video).length&&(_l[t]||vl[t])||!e.g.sa()?e.h[t].bind(e.h):e.g.get("player",t)}(e,t)}})})),function(e){var t=new Map;zl(e,(function(i,r){t.has(r)?(r=t.get(r),i.length<r.length?e.u.set(i,r):e.u.set(r,i)):t.set(r,i)}))}(e),e.j=new xr,e.j.Wc=e.l,e.o=new xr,e.o.Wc=e.s}(this)}function zl(e,t){function i(e){return"constructor"!=e&&"function"==typeof n[e]&&!s.has(e)}var r,n=e.h,s=new Set;for(r in n)i(r)&&(s.add(r),t(r,n[r]));for(e=Object.getPrototypeOf(n),r=Object.getPrototypeOf({});e&&e!=r;){for(var a=l(Object.getOwnPropertyNames(e)),o=a.next();!o.done;o=a.next())i(o=o.value)&&(s.add(o),t(o,n[o]));e=Object.getPrototypeOf(e)}}function Bl(e){var t={video:{},player:{},playerAfterLoad:{},manifest:e.h.Dd(),startTime:null};e.i.pause();for(var i=l(fl),r=i.next();!r.done;r=i.next())r=r.value,t.video[r]=e.i[r];for(e.i.ended||(t.startTime=e.i.currentTime),r=(i=l(xl)).next();!r.done;r=i.next()){var n=r.value;r=n[1],n=e.h[n[0]](),t.player[r]=n}for(r=(i=l(bl)).next();!r.done;r=i.next())r=(n=r.value)[1],n=e.h[n[0]](),t.playerAfterLoad[r]=n;return t}function jl(e){var t=new _r("caststatuschanged");e.dispatchEvent(t)}function Hl(e){var t=new _r(e.l.paused?"pause":"play");e.j.dispatchEvent(t)}function Vl(e){for(var t=l(xl),i=t.next();!i.done;i=t.next()){var r=i.value;i=r[1],r=e.g.get("player",r[0])(),e.h[i](r)}var n=e.g.get("player","getAssetUri")();i=e.g.get("video","ended"),t=Promise.resolve();var s=e.i.autoplay;r=null,i||(r=e.g.get("video","currentTime")),n&&(e.i.autoplay=!1,t=e.h.load(n,r));var a={};for(r=(i=l(fl)).next();!r.done;r=i.next())r=r.value,a[r]=e.g.get("video",r);t.then((function(){if(e.i){for(var t=l(fl),i=t.next();!i.done;i=t.next())i=i.value,e.i[i]=a[i];for(i=(t=l(bl)).next();!i.done;i=t.next()){var r=i.value;i=r[1],r=e.g.get("player",r[0])(),e.h[i](r)}e.i.autoplay=s,n&&e.i.play()}}),(function(t){t=new _r("error",t=(new Map).set("detail",t)),e.h.dispatchEvent(t)}))}function Wl(e,t){if("addEventListener"==t)return function(t,i,r){return e.j.addEventListener(t,i,r)};if("removeEventListener"==t)return function(t,i,r){return e.j.removeEventListener(t,i,r)};if(e.g.sa()&&0==Object.keys(e.g.g.video).length){var i=e.i[t];if("function"!=typeof i)return i}return e.g.sa()?e.g.get("video",t):("function"==typeof(t=e.i[t])&&(t=t.bind(e.i)),t)}function Gl(e,t,i){e.g.sa()&&("video"==t?e.j.dispatchEvent(i):"player"==t&&e.o.dispatchEvent(i))}function Xl(e,t,i,r){xr.call(this);var n=this;this.g=e,this.h=t,this.j=new Nr,this.H={video:e,player:t},this.D=i||function(){},this.J=r||function(e){return e},this.i=null,this.F=!1,this.o=!0,this.m=0,this.B=!1,this.u=!0,this.s=this.l=null,this.G=new ot((function(){Kl(n)})),function(e){var t=cast.receiver.CastReceiverManager.getInstance();t.onSenderConnected=function(){return ql(e)},t.onSenderDisconnected=function(){return ql(e)},t.onSystemVolumeChanged=function(){var t=cast.receiver.CastReceiverManager.getInstance().getSystemVolume();t&&ec(e,{type:"update",update:{video:{volume:t.level,muted:t.muted}}},e.l),ec(e,{type:"event",targetName:"video",event:{type:"volumechange"}},e.l)},e.s=t.getCastMessageBus("urn:x-cast:com.google.cast.media"),e.s.onMessage=function(t){return function(e,t){var i=dl(t.data);switch(i.type){case"PLAY":e.g.play(),tc(e);break;case"PAUSE":e.g.pause(),tc(e);break;case"SEEK":t=i.currentTime;var r=i.resumeState;null!=t&&(e.g.currentTime=Number(t)),r&&"PLAYBACK_START"==r?(e.g.play(),tc(e)):r&&"PLAYBACK_PAUSE"==r&&(e.g.pause(),tc(e));break;case"STOP":e.h.re().then((function(){e.h&&tc(e)}));break;case"GET_STATUS":Ql(e,Number(i.requestId));break;case"VOLUME":t=(r=i.volume).level,r=r.muted;var n=e.g.volume,s=e.g.muted;null!=t&&(e.g.volume=Number(t)),null!=r&&(e.g.muted=r),n==e.g.volume&&s==e.g.muted||tc(e);break;case"LOAD":e.m=0,e.B=!1,e.u=!1,t=i.media,r=i.currentTime,n=e.J(t.contentId),s=i.autoplay||!0,e.D(t.customData),s&&(e.g.autoplay=!0),e.h.load(n,r).then((function(){e.h&&Ql(e)})).catch((function(t){var r="LOAD_FAILED";7==t.category&&7e3==t.code&&(r="LOAD_CANCELLED"),ec(e,{requestId:Number(i.requestId),type:r},e.s)}));break;default:ec(e,{requestId:Number(i.requestId),type:"INVALID_REQUEST",reason:"INVALID_COMMAND"},e.s)}}(e,t)},e.l=t.getCastMessageBus("urn:x-cast:com.google.shaka.v2"),e.l.onMessage=function(t){return function(e,t){var i=dl(t.data);switch(i.type){case"init":e.m=0,e.B=!1,e.u=!0,function(e,t,i){var r,n,s,a,o,h,u,l,c,d;P((function(p){switch(p.g){case 1:for(r in t.player)n=t.player[r],e.h[r](n);return e.D(i),s=e.g.autoplay,t.manifest?(e.g.autoplay=!1,T(p,5),b(p,e.h.load(t.manifest,t.startTime),7)):b(p,Promise.resolve(),3);case 7:A(p,3);break;case 5:return a=C(p),o=(new Map).set("detail",a),h=new _r("error",o),e.h&&e.h.dispatchEvent(h),p.return();case 3:if(!e.h)return p.return();for(u in t.video)l=t.video[u],e.g[u]=l;for(c in t.playerAfterLoad)d=t.playerAfterLoad[c],e.h[c](d);e.g.autoplay=s,t.manifest&&(e.g.play(),tc(e)),w(p)}}))}(e,i.initState,i.appData),Kl(e);break;case"appData":e.D(i.appData);break;case"set":var r=i.targetName,n=i.property;if(i=i.value,"video"==r){if(t=cast.receiver.CastReceiverManager.getInstance(),"volume"==n){t.setSystemVolumeLevel(i);break}if("muted"==n){t.setSystemVolumeMuted(i);break}}e.H[r][n]=i;break;case"call":(r=e.H[i.targetName])[i.methodName].apply(r,i.args);break;case"asyncCall":r=i.targetName,n=i.methodName,"player"==r&&"load"==n&&(e.m=0,e.B=!1);var s=i.id,a=t.senderId;i=(t=e.H[r])[n].apply(t,i.args),"player"==r&&"load"==n&&(i=i.then((function(){e.u=!0}))),i.then((function(){return Jl(e,a,s,null)}),(function(t){return Jl(e,a,s,t)}))}}(e,t)},t.start();for(var i=(t=l(pl)).next();!i.done;i=t.next())e.j.C(e.g,i.value,(function(t){return $l(e,"video",t)}));for(var r in yr)e.j.C(e.h,yr[r],(function(t){return $l(e,"player",t)}));cast.__platform__&&cast.__platform__.canDisplayType('video/mp4; codecs="avc1.640028"; width=3840; height=2160')?e.h.ke(3840,2160):e.h.ke(1920,1080),e.j.C(e.g,"loadeddata",(function(){e.B=!0})),e.j.C(e.h,"loading",(function(){e.o=!1,Yl(e)})),e.j.C(e.g,"playing",(function(){e.o=!1,Yl(e)})),e.j.C(e.g,"pause",(function(){Yl(e)})),e.j.C(e.h,"unloading",(function(){e.o=!0,Yl(e)})),e.j.C(e.g,"ended",(function(){new ot((function(){e.g&&e.g.ended&&(e.o=!0,Yl(e))})).N(rc)}))}(this)}function ql(e){e.m=0,e.u=!0,e.F=0!=cast.receiver.CastReceiverManager.getInstance().getSenders().length,Yl(e)}function Yl(e){var t;P((function(i){return 1==i.g?b(i,Promise.resolve(),2):e.h?(t=new _r("caststatuschanged"),e.dispatchEvent(t),Zl(e)||tc(e),void w(i)):i.return()}))}function $l(e,t,i){e.h&&(Kl(e),ec(e,{type:"event",targetName:t,event:i},e.l))}function Kl(e){e.G.N(ic);for(var t={video:{},player:{}},i=l(gl),r=i.next();!r.done;r=i.next())r=r.value,t.video[r]=e.g[r];if(e.h.U())for(var n in yl)0==e.m%yl[n]&&(t.player[n]=e.h[n]());for(var s in _l)0==e.m%_l[s]&&(t.player[s]=e.h[s]());for(var a in(i=cast.receiver.CastReceiverManager.getInstance().getSystemVolume())&&(t.video.volume=i.level,t.video.muted=i.muted),ec(e,{type:"update",update:t},e.l),vl)0==e.m%vl[a]&&((t={player:{}}).player[a]=e.h[a](),ec(e,{type:"update",update:t},e.l));e.B&&(e.m+=1),Zl(e)}function Zl(e){return!(!e.u||!e.g.duration&&!e.h.U())&&(Ql(e),e.u=!1,!0)}function Ql(e,t){var i={contentId:e.h.Dd(),streamType:e.h.U()?"LIVE":"BUFFERED",contentType:""};e.h.U()||(i.duration=e.g.duration),e.i&&(i.metadata=e.i),tc(e,void 0===t?0:t,i)}function Jl(e,t,i,r){e.h&&ec(e,{type:"asyncComplete",id:i,error:r},e.l,t)}function ec(e,t,i,r){e.F&&(e=cl(t),r?i.getCastChannel(r).send(e):i.broadcast(e))}function tc(e,t,i){i=void 0===i?null:i;var r={mediaSessionId:0,playbackRate:e.g.playbackRate,playerState:e.o?nc:e.h.Fd()?ac:e.g.paused?oc:sc,currentTime:e.g.currentTime,supportedMediaCommands:63,volume:{level:e.g.volume,muted:e.g.muted}};i&&(r.media=i),ec(e,{requestId:void 0===t?0:t,type:"MEDIA_STATUS",status:[r]},e.s)}_(Ul,xr),(n=Ul.prototype).destroy=function(e){return e&&this.g.Ab(),this.m&&(this.m.release(),this.m=null),e=[],this.h&&(e.push(this.h.destroy()),this.h=null),this.g&&(e.push(this.g.destroy()),this.g=null),this.s=this.l=this.i=null,xr.prototype.release.call(this),Promise.all(e)},n.Wf=function(){return this.l},n.Nf=function(){return this.s},n.nf=function(){return this.g.m&&Pl},n.sa=function(){return this.g.sa()},n.ae=function(){return this.g.ae()},n.cast=function(){var e,t=this;return P((function(i){return 1==i.g?(e=Bl(t),b(i,t.g.cast(e),2)):t.h?b(i,t.h.re(),0):i.return()}))},n.ie=function(e){this.g.ie(e)},n.zg=function(){!function(e){if(e.h){var t=e.J();chrome.cast.requestSession((function(i){return Al(e,t,i)}),(function(t){return Cl(e,t)}))}}(this.g)},n.Ab=function(){this.g.Ab()},n.qf=function(e,t){t=void 0!==t&&t;var i=this;return P((function(r){if(1==r.g)return e==i.D&&t==i.B?r.return():(i.D=e,i.B=t,i.g.Ab(),b(r,i.g.destroy(),2));i.g=null,i.g=new Sl(e,(function(){return jl(i)}),(function(){return Hl(i)}),(function(e,t){return Gl(i,e,t)}),(function(){return Vl(i)}),(function(){return Bl(i)}),t),i.g.init(),w(r)}))},j("shaka.cast.CastProxy",Ul),Ul.prototype.changeReceiverId=Ul.prototype.qf,Ul.prototype.forceDisconnect=Ul.prototype.Ab,Ul.prototype.suggestDisconnect=Ul.prototype.zg,Ul.prototype.setAppData=Ul.prototype.ie,Ul.prototype.cast=Ul.prototype.cast,Ul.prototype.receiverName=Ul.prototype.ae,Ul.prototype.isCasting=Ul.prototype.sa,Ul.prototype.canCast=Ul.prototype.nf,Ul.prototype.getPlayer=Ul.prototype.Nf,Ul.prototype.getVideo=Ul.prototype.Wf,Ul.prototype.destroy=Ul.prototype.destroy,_(Xl,xr),(n=Xl.prototype).isConnected=function(){return this.F},n.$f=function(){return this.o},n.wg=function(e){this.i=e},n.uf=function(){this.i=null},n.xg=function(e){this.i||(this.i={metadataType:cast.receiver.media.MetadataType.GENERIC}),this.i.title=e},n.vg=function(e){this.i||(this.i={metadataType:cast.receiver.media.MetadataType.GENERIC}),this.i.images=[{url:e}]},n.ug=function(e){this.i||(this.i={}),this.i.artist=e,this.i.metadataType=cast.receiver.media.MetadataType.MUSIC_TRACK},n.destroy=function(){var e,t=this;return P((function(i){if(1==i.g)return t.j&&(t.j.release(),t.j=null),e=[],t.h&&(e.push(t.h.destroy()),t.h=null),t.G&&(t.G.stop(),t.G=null),t.g=null,t.H=null,t.D=null,t.F=!1,t.o=!0,t.l=null,t.s=null,xr.prototype.release.call(t),b(i,Promise.all(e),2);cast.receiver.CastReceiverManager.getInstance().stop(),w(i)}))},j("shaka.cast.CastReceiver",Xl),Xl.prototype.destroy=Xl.prototype.destroy,Xl.prototype.setContentArtist=Xl.prototype.ug,Xl.prototype.setContentImage=Xl.prototype.vg,Xl.prototype.setContentTitle=Xl.prototype.xg,Xl.prototype.clearContentMetadata=Xl.prototype.uf,Xl.prototype.setContentMetadata=Xl.prototype.wg,Xl.prototype.isIdle=Xl.prototype.$f,Xl.prototype.isConnected=Xl.prototype.isConnected;var ic=.5,rc=5,nc="IDLE",sc="PLAYING",ac="BUFFERING",oc="PAUSED";function hc(e,t,i){var r=function(e){for(var t=[],i=(e=l(e)).next();!i.done;i=e.next())(i=lc(i.value))&&t.push(i);return t}(e),n=null;e=[];var s=[],a=new Set(r.map((function(e){return e.keyId})));if(a.delete(null),1<a.size)throw new Me(2,4,4010);if(t||(s=r.filter((function(e){return"urn:mpeg:dash:mp4protection:2011"!=e.fe||(n=e.init||n,!1)}))).length&&(e=function(e,t,i,r){for(var n=[],s=(t=l(t)).next();!s.done;s=t.next()){var a=i[(s=s.value).fe];if(a){var o;if(o=an(s.node,"urn:microsoft:playready","pro")){o=kt(o.textContent);var h=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);o=[{initData:nn(o,h,new Set,0),initDataType:"cenc",keyId:s.keyId}]}else o=null;if(h=null,"urn:uuid:e2719d58-a985-b3c9-781a-b030af78d30e"===s.fe)if(0==(h=r).size)h=null;else{var u=new Uint8Array([16,119,239,236,192,178,77,2,172,227,60,30,82,226,251,75]);h=[{initData:nn(new Uint8Array([]),u,h,1),initDataType:"cenc",keyId:s.keyId}]}o=Qe(a,s.init||e||o||h),(a=dc.get(a))&&(o.licenseServerUri=a(s)),n.push(o)}}return n}(n,s,i,a),0==e.length&&(e=[Qe("",n)])),r.length&&(t||!s.length))for(e=[],i=(t=l(Object.values(i))).next();!i.done;i=t.next())"org.w3.clearkey"!=(i=i.value)&&e.push(Qe(i,n));if(a=Array.from(a)[0]||null)for(i=(t=l(e)).next();!i.done;i=t.next())for(r=(i=l(i.value.initData)).next();!r.done;r=i.next())r.value.keyId=a;return{Be:a,sh:n,drmInfos:e,Fe:!0}}function uc(e){return(e=an(e.node,"urn:microsoft:playready","pro"))&&(e=function(e){var t=0,i=Le(e),r=i.getUint32(t,!0);if(r!=e.byteLength)return[];e:{for(e=t+6,t=[];e<i.byteLength-1;){r=i.getUint16(e,!0),e+=2;var n=i.getUint16(e,!0);if(e+=2,0!=(1&n)||n+e>i.byteLength){i=[];break e}var s=Re(i,e,n);t.push({type:r,value:s}),e+=n}i=t}return i}(e=kt(e.textContent)).filter((function(e){return e.type===cc}))[0])&&(e=wn(e=Tt(e.value,!0),"WRMHEADER"))?function(e){for(var t=(e=l(e.getElementsByTagName("DATA"))).next();!t.done;t=e.next())for(var i=(t=l(t.value.childNodes)).next();!i.done;i=t.next())if((i=i.value)instanceof Element&&"LA_URL"==i.tagName)return i.textContent;return""}(e):""}function lc(e){var t=e.getAttribute("schemeIdUri"),i=un(e,"urn:mpeg:cenc:2013","default_KID"),r=hn(e,"urn:mpeg:cenc:2013","pssh").map(cn);if(!t)return null;if(t=t.toLowerCase(),i&&(i=i.replace(/-/g,"").toLowerCase()).includes(" "))throw new Me(2,4,4009);var n=[];try{n=r.map((function(e){return{initDataType:"cenc",initData:kt(e),keyId:null}}))}catch(s){throw new Me(2,4,4007)}return{node:e,fe:t,keyId:i,init:0<n.length?n:null}}var cc=1,dc=(new Map).set("com.widevine.alpha",(function(e){return(e=an(e.node,"urn:microsoft","laurl"))&&e.getAttribute("licenseUrl")||""})).set("com.microsoft.playready",uc).set("com.microsoft.playready.recommendation",uc).set("com.microsoft.playready.software",uc).set("com.microsoft.playready.hardware",uc).set("org.w3.clearkey",(function(e){return(e=an(e.node,"http://dashif.org/guidelines/clearKey","Laurl"))&&"EME-1.0"===e.getAttribute("Lic_type")&&e.textContent?e.textContent:""}));function pc(t,i,r,n,s){var a={RepresentationID:i,Number:r,Bandwidth:n,Time:s};return t.replace(/\$(RepresentationID|Number|Bandwidth|Time)?(?:%0([0-9]+)([diouxX]))?\$/g,(function(t,i,r,n){if("$$"==t)return"$";var s=a[i];if(null==s)return t;switch("RepresentationID"==i&&r&&(r=void 0),"Time"==i&&(s=Math.round(s)),n){case void 0:case"d":case"i":case"u":t=s.toString();break;case"o":t=s.toString(8);break;case"x":t=s.toString(16);break;case"X":t=s.toString(16).toUpperCase();break;default:t=s.toString()}return r=e.parseInt(r,10)||1,Array(Math.max(0,r-t.length)+1).join("0")+t}))}function gc(e,t){var i=fc(e,t,"timescale"),r=1;i&&(r=vn(i)||1);var n=fc(e,t,"duration");i=vn(n||""),"image"==e.I.contentType&&(i=xn(n||"")),i&&(i/=r);var s=fc(e,t,"startNumber");n=Number(fc(e,t,"presentationTimeOffset"))||0;var a=yn(s||"");if(null!=s&&null!=a||(a=1),s=mc(e,t,"SegmentTimeline"),t=null,s){t=r,e=e.T.duration||1/0,s=on(s,"S");for(var o=[],h=-n,u=0;u<s.length;++u){var l=s[u],c=s[u+1],d=pn(l,"t",yn),p=pn(l,"d",yn);if(l=pn(l,"r",_n),null!=d&&(d-=n),!p)break;if(d=null!=d?d:h,0>(l=l||0))if(c){if(null==(c=pn(c,"t",yn)))break;if(d>=c)break;l=Math.ceil((c-d)/p)-1}else{if(1/0==e)break;if(d/t>=e)break;l=Math.ceil((e*t-d)/p)-1}for(0<o.length&&d!=h&&(o[o.length-1].end=d/t),c=0;c<=l;++c)h=d+p,o.push({start:d/t,end:h/t,Dg:d}),d=h}t=o}return{timescale:r,ia:i,Lb:a,Sa:n/r||0,se:n,timeline:t}}function fc(e,t,i){return[t(e.I),t(e.fa),t(e.$)].filter(Ke).map((function(e){return e.getAttribute(i)})).reduce((function(e,t){return e||t}))}function mc(e,t,i){return[t(e.I),t(e.fa),t(e.$)].filter(Ke).map((function(e){return sn(e,i)})).reduce((function(e,t){return e||t}))}function _c(e,t,i,r,n,s){if(s=void 0===s?0:s,un(e,"http://www.w3.org/1999/xlink","href")){var a=function(e,t,i,r,n,s){for(var a=un(e,"http://www.w3.org/1999/xlink","href"),o=un(e,"http://www.w3.org/1999/xlink","actuate")||"onRequest",h=l(Array.from(e.attributes)),u=h.next();!u.done;u=h.next())"http://www.w3.org/1999/xlink"==(u=u.value).namespaceURI&&e.removeAttributeNS(u.namespaceURI,u.localName);if(5<=s)return dr(new Me(2,4,4028));if("onLoad"!=o)return dr(new Me(2,4,4027));var c=Ze([r],[a]);return n.request(0,Er(c,t)).Y((function(r){if(!(r=Tn(r.data,e.tagName)))return dr(new Me(2,4,4001,a));for(;e.childNodes.length;)e.removeChild(e.childNodes[0]);for(;r.childNodes.length;){var o=r.childNodes[0];r.removeChild(o),e.appendChild(o)}for(o=(r=l(Array.from(r.attributes))).next();!o.done;o=r.next())e.setAttributeNode(o.value.cloneNode(!1));return _c(e,t,i,c[0],n,s+1)}))}(e,t,i,r,n,s);return i&&(a=a.Y(void 0,(function(){return _c(e,t,i,r,n,s)}))),a}a=[];for(var o=l(Array.from(e.childNodes)),h=o.next();!h.done;h=o.next())(h=h.value)instanceof Element&&("urn:mpeg:dash:resolve-to-zero:2013"==un(h,"http://www.w3.org/1999/xlink","href")?e.removeChild(h):"SegmentTimeline"!=h.tagName&&a.push(_c(h,t,i,r,n,s)));return mr(a).Y((function(){return e}))}function vc(e,t,i,r,n,s,a){var o,h=(new Xr).P("sidx",(function(e){o=function(e,t,i,r,n,s,a){var o=[];a.reader.skip(4);var h=a.reader.K();if(0==h)throw new Me(2,3,3005);if(0==a.version)var u=a.reader.K(),l=a.reader.K();else u=a.reader.$a(),l=a.reader.$a();a.reader.skip(2);var c=a.reader.$d();for(e=e+a.size+l,l=0;l<c;l++){var d=a.reader.K(),p=(2147483648&d)>>>31;d&=2147483647;var g=a.reader.K();if(a.reader.skip(4),1==p)throw new Me(2,3,3006);o.push(new ma(u/h+i,(u+g)/h+i,(function(){return s}),e,e+d-1,t,i,r,n)),u+=g,e+=d}return a.parser.stop(),o}(t,r,n,s,a,i,e)}));if(e&&h.parse(e),o)return o;throw new Me(2,3,3004)}function yc(e){this.h=Le(e),this.g=new Vr(this.h,0)}function xc(e){var t=bc(e);if(7<t.length)throw new Me(2,3,3002);for(var i=0,r=(t=l(t)).next();!r.done;r=t.next())i=256*i+r.value;t=bc(e);e:{for(var n=(r=l(wc)).next();!n.done;n=r.next())if(Ce(t,new Uint8Array(n.value))){r=!0;break e}r=!1}if(r)t=e.h.byteLength-e.g.Z();else{if(8==t.length&&224&t[1])throw new Me(2,3,3001);for(n=r=0;n<t.length;n++){var s=t[n];r=0==n?s&(1<<8-t.length)-1:256*r+s}t=r}return t=e.g.Z()+t<=e.h.byteLength?t:e.h.byteLength-e.g.Z(),r=Le(e.h,e.g.Z(),t),e.g.skip(t),new Tc(i,r)}function bc(e){var t=e.g.Z(),i=e.g.Ra();if(0==i)throw new Me(2,3,3002);return i=8-Math.floor(Math.log2(i)),e.g.skip(i-1),Re(e.h,t,i)}yc.prototype.ha=function(){return this.g.ha()};var wc=[[255],[127,255],[63,255,255],[31,255,255,255],[15,255,255,255,255],[7,255,255,255,255,255],[3,255,255,255,255,255,255],[1,255,255,255,255,255,255,255]];function Tc(e,t){this.id=e,this.g=t}function Sc(e){if(8<e.g.byteLength)throw new Me(2,3,3002);if(8==e.g.byteLength&&224&e.g.getUint8(0))throw new Me(2,3,3001);for(var t=0,i=0;i<e.g.byteLength;i++){t=256*t+e.g.getUint8(i)}return t}function Ac(e){var t=new yc(e.g);if(179!=(e=xc(t)).id)throw new Me(2,3,3013);if(e=Sc(e),183!=(t=xc(t)).id)throw new Me(2,3,3012);t=new yc(t.g);for(var i=0;t.ha();){var r=xc(t);if(241==r.id){i=Sc(r);break}}return{Eg:e,ng:i}}function Cc(e,t){if(!(t=mc(e,t,"Initialization")))return null;var i=e.I.wa,r=t.getAttribute("sourceURL");r&&(i=Ze(e.I.wa,[r])),r=0;var n=null;return(t=pn(t,"range",mn))&&(r=t.start,n=t.end),new fa((function(){return i}),r,n,Mc(e))}function Ec(e,t){var i=Number(fc(e,Rc,"presentationTimeOffset"))||0,r=fc(e,Rc,"timescale"),n=1;r&&(n=vn(r)||1);var s=i/n||0,a=Cc(e,Rc);!function(e,t){if(kc(e,t),!Lc(e))throw new Me(2,4,4002)}(e,a);var o=wr(e);return{Bb:function(){var e=mc(o,Rc,"RepresentationIndex"),i=o.I.wa;return e&&(e=e.getAttribute("sourceURL"))&&(i=Ze(o.I.wa,[e])),e=Lc(o),Ic(o,t,a,i,e.start,e.end,s)}}}function Ic(e,t,i,r,n,s,a){var o,h,u,l,c,d,p,g,f,m,_,v,y,x,w;return P((function(T){if(1==T.g)return o=e.presentationTimeline,h=!e.Ma||!e.T.Gd,u=e.T.start,l=e.T.duration,c=e.I.mimeType.split("/")[1],p=null,g=[(d=t)(r,n,s),"webm"==c?d(i.ya(),i.Ba,i.ka):null],d=null,b(T,Promise.all(g),2);if(f=T.h,m=f[0],_=f[1]||null,null,y=u-a,x=u,w=l?u+l:1/0,"mp4"==c)var S=vc(m,n,r,i,y,x,w);else{if(440786851!=xc(S=new yc(_)).id)throw new Me(2,3,3008);var A=xc(S);if(408125543!=A.id)throw new Me(2,3,3009);S=A.g.byteOffset,A=new yc(A.g);for(var C=null;A.ha();){var E=xc(A);if(357149030==E.id){C=E;break}}if(!C)throw new Me(2,3,3010);for(C=new yc(C.g),E=1e6,A=null;C.ha();){var I=xc(C);if(2807729==I.id)E=Sc(I);else if(17545==I.id)if(4==I.g.byteLength)A=I.g.getFloat32(0);else{if(8!=I.g.byteLength)throw new Me(2,3,3003);A=I.g.getFloat64(0)}}if(null==A)throw new Me(2,3,3011);if(A*=C=E/1e9,475249515!=(E=xc(new yc(m))).id)throw new Me(2,3,3007);S=function(e,t,i,r,n,s,a,o,h){function u(){return n}var l=[];e=new yc(e.g);for(var c=null,d=null;e.ha();){var p=xc(e);if(187==p.id){var g=Ac(p);g&&(p=i*g.Eg,g=t+g.ng,null!=c&&l.push(new ma(c+a,p+a,u,d,g-1,s,a,o,h)),c=p,d=g)}}return null!=c&&l.push(new ma(c+a,r+a,u,d,null,s,a,o,h)),l}(E,S,C,A,r,i,y,x,w)}return v=S,o.Ib(v),p=new To(v),h&&p.Wa(x,w,!0),T.return(p)}))}function Rc(e){return e.wc}function Lc(e){var t=mc(e,Rc,"RepresentationIndex");return e=mn((e=fc(e,Rc,"indexRange"))||""),t&&(e=pn(t,"range",mn,e)),e}function kc(e,t){var i=e.I.mimeType.split("/")[1];if(e.I.contentType!=tt&&"mp4"!=i&&"webm"!=i)throw new Me(2,4,4006);if("webm"==i&&!t)throw new Me(2,4,4005)}function Mc(e){var t=e.I;return{bandwidth:e.bandwidth,audioSamplingRate:t.audioSamplingRate,codecs:t.codecs,contentType:t.contentType,frameRate:t.frameRate||null,height:t.height||null,mimeType:t.mimeType,channelsCount:t.ad,pixelAspectRatio:t.pixelAspectRatio||null,width:t.width||null}}function Pc(e,t){var i=Cc(e,Oc),r=function(e){var t=function(e){return[e.I.ab,e.fa.ab,e.$.ab].filter(Ke).map((function(e){return on(e,"SegmentURL")})).reduce((function(e,t){return 0<e.length?e:t})).map((function(t){return t.getAttribute("indexRange")&&!e.Ke&&(e.Ke=!0),{dg:t.getAttribute("media"),start:(t=pn(t,"mediaRange",mn,{start:0,end:null})).start,end:t.end}}))}(e);e=gc(e,Oc);var i=e.Lb;0==i&&(i=1);var r=0;return e.ia?r=e.ia*(i-1):e.timeline&&0<e.timeline.length&&(r=e.timeline[0].start),{ia:e.ia,startTime:r,Lb:i,Sa:e.Sa,timeline:e.timeline,Gb:t}}(e);if(!r.ia&&!r.timeline&&1<r.Gb.length)throw new Me(2,4,4002);if(!r.ia&&!e.T.duration&&!r.timeline&&1==r.Gb.length)throw new Me(2,4,4002);if(r.timeline&&0==r.timeline.length)throw new Me(2,4,4002);var n=null,s=null;e.$.id&&e.I.id&&(s=t[e.$.id+","+e.I.id])&&(n=s.segmentIndex);var a=function(e,t,i,r,n){var s=r.Gb.length;r.timeline&&r.timeline.length!=r.Gb.length&&(s=Math.min(r.timeline.length,r.Gb.length));for(var a=e-r.Sa,o=t?e+t:1/0,h=[],u=r.startTime,l={},c=0;c<s;l={od:l.od},c++){var d=r.Gb[c];l.od=Ze(i,[d.dg]);var p=void 0;p=null!=r.ia?u+r.ia:r.timeline?r.timeline[c].end:u+t,h.push(new ma(e+u,e+p,function(e){return function(){return e.od}}(l),d.start,d.end,n,a,e,o)),u=p}return h}(e.T.start,e.T.duration,e.I.wa,r,i);return t=!n,n?n.Hb(a,e.presentationTimeline.Pa()):n=new To(a),e.presentationTimeline.Ib(a),e.Ma&&e.T.Gd||n.Wa(e.T.start,e.T.duration?e.T.start+e.T.duration:1/0,t),s&&(s.segmentIndex=n),{Bb:function(){return n&&0!=n.g.length||n.pc(a),Promise.resolve(n)}}}function Oc(e){return e.ab}function Dc(e,t,i,r,n,s){var a=function(e){var t=fc(e,Nc,"initialization");if(!t)return null;var i=e.I.id,r=e.bandwidth||null,n=e.I.wa;return new fa((function(){var e=pc(t,i,null,r,null);return Ze(n,[e])}),0,null,Mc(e))}(e),o=function(e){var t=gc(e,Nc),i=fc(e,Nc,"media");return e=fc(e,Nc,"index"),{ia:t.ia,timescale:t.timescale,Lb:t.Lb,Sa:t.Sa,se:t.se,timeline:t.timeline,Pd:i,oc:e}}(e);!function(e){var t=e.oc?1:0;if(t+=e.timeline?1:0,t+=e.ia?1:0,0==t)throw new Me(2,4,4002);if(1!=t&&(e.oc&&(e.timeline=null),e.ia=null),!e.oc&&!e.Pd)throw new Me(2,4,4002)}(o);var h=wr(e);if(o.oc)return kc(e,a),{Bb:function(){var e=pc(o.oc,h.I.id,null,h.bandwidth||null,null);return e=Ze(h.I.wa,[e]),Ic(h,t,a,e,0,null,o.Sa)}};if(o.ia)return r||"image"===e.fa.contentType||(e.presentationTimeline.Sd(o.ia),e.presentationTimeline.Td(e.T.start)),{Bb:function(){return function(e,t,i,r,n){function s(e){var i=(e-g)*p,n=i+t.Sa,s=i+u;return i=s+p,(s=new ma(s,Math.min(i,o()),(function(){var t=pc(m,v,e,_,n*f);return Ze(y,[t])}),0,null,r,x,u,o())).j=i,s}function a(){var e=[Math.max(h.Pa(),u),Math.min(h.gb(),o())].map((function(e){return e-u}));return[Math.ceil(e[0]/p),Math.ceil(e[1]/p)-1].map((function(e){return e+g}))}function o(){var e=null!=c&&n[c]||d;return e?u+e:1/0}var h=e.presentationTimeline,u=e.T.start,c=e.$.id,d=e.T.duration,p=t.ia,g=t.Lb,f=t.timescale,m=t.Pd,_=e.bandwidth||null,v=e.I.id,y=e.I.wa,x=u-t.Sa,b=a();e=e.Ma?Math.max(b[0],b[1]-i+1):b[0],b=b[1],i=[];for(var w=e;w<=b;++w){var T=s(w);i.push(T)}var S=new To(i);if(i=h.gb()<o(),w=h.U(),i||w){var A=Math.max(e,b+1);S.fd(p,(function(){var e=h.Pa();S.eb(e);var t=l(a());t.next(),t=t.next().value;for(var i=[];A<=t;){var r=s(A);i.push(r),A++}return e>o()&&!i.length?null:i}))}return Promise.resolve(S)}(h,o,n,a,s)}};var u=null;r=r=null,e.$.id&&e.I.id&&(r=i[r=e.$.id+","+e.I.id])&&(u=r.segmentIndex);var c=function(e,t,i){var r=e.T.start,n=e.T.duration,s=r-t.Sa;n=n?r+n:1/0;for(var a=[],o={},h=0;h<t.timeline.length;o={nd:o.nd,rd:o.rd,ud:o.ud,kd:o.kd,wd:o.wd,ld:o.ld},h++){var u=t.timeline[h],l=u.start,c=u.Dg;u=u.end,o.ud=h+t.Lb,o.wd=c+t.se,o.rd=e.I.id,o.kd=e.bandwidth||null,o.nd=t.Pd,o.ld=e.I.wa,a.push(new ma(r+l,r+u,function(e){return function(){var t=pc(e.nd,e.rd,e.ud,e.kd||null,e.wd);return Ze(e.ld,[t]).map((function(e){return e.toString()}))}}(o),0,null,i,s,r,n))}return a}(h,o,a);i=e.T.start;var d=e.T.duration?e.T.start+e.T.duration:1/0,p=!(e.Ma&&e.T.Gd);return u?(p&&new To(c).Wa(i,d,!0),u.Hb(c,e.presentationTimeline.Pa())):u=new To(c),e.presentationTimeline.Ib(c),p&&u.Wa(i,d),r&&e.Ma&&(r.segmentIndex=u),{Bb:function(){return u&&0!=u.g.length||u.pc(c),Promise.resolve(u)}}}function Nc(e){return e.xc}function Fc(){this.l=[],this.g=[],this.h=[],this.j=[],this.i=[],this.m=new Set}function Uc(e,t,i){var r,n,s,a,o,h,u,c,d,p,g,f,m,_,v,y,x,T,S,A,C,E,I,R,L,k,M,O;return P((function(P){switch(P.g){case 1:if(r=it,function(e){for(var t=(e=l(e)).next();!t.done;t=e.next()){for(var i=[],r=l((t=t.value).Kc),n=r.next();!n.done;n=r.next()){n=n.value;for(var s=!1,a=l(i),o=a.next();!o.done;o=a.next())o=o.value,n.id!=o.id&&n.channelsCount==o.channelsCount&&n.language==o.language&&n.bandwidth==o.bandwidth&&n.label==o.label&&n.codecs==o.codecs&&n.mimeType==o.mimeType&&re(n.roles,o.roles)&&n.audioSamplingRate==o.audioSamplingRate&&n.primary==o.primary&&(s=!0);s||i.push(n)}t.Kc=i}}(t),function(e){for(var t=(e=l(e)).next();!t.done;t=e.next()){for(var i=[],r=l((t=t.value).gd),n=r.next();!n.done;n=r.next()){n=n.value;for(var s=!1,a=l(i),o=a.next();!o.done;o=a.next())o=o.value,n.id!=o.id&&n.width==o.width&&n.frameRate==o.frameRate&&n.codecs==o.codecs&&n.mimeType==o.mimeType&&n.label==o.label&&re(n.roles,o.roles)&&Hr(n.closedCaptions,o.closedCaptions)&&n.bandwidth==o.bandwidth&&(s=!0);s||i.push(n)}t.gd=i}}(t),function(e){for(var t=(e=l(e)).next();!t.done;t=e.next()){for(var i=[],r=l((t=t.value).textStreams),n=r.next();!n.done;n=r.next()){n=n.value;for(var s=!1,a=l(i),o=a.next();!o.done;o=a.next())o=o.value,n.id!=o.id&&n.language==o.language&&n.label==o.label&&n.codecs==o.codecs&&n.mimeType==o.mimeType&&n.bandwidth==o.bandwidth&&re(n.roles,o.roles)&&(s=!0);s||i.push(n)}t.textStreams=i}}(t),function(e){for(var t=(e=l(e)).next();!t.done;t=e.next()){for(var i=[],r=l((t=t.value).imageStreams),n=r.next();!n.done;n=r.next()){n=n.value;for(var s=!1,a=l(i),o=a.next();!o.done;o=a.next())o=o.value,n.id!=o.id&&n.width==o.width&&n.codecs==o.codecs&&n.mimeType==o.mimeType&&(s=!0);s||i.push(n)}t.imageStreams=i}}(t),!i&&1==t.length){n=t[0],e.g=n.Kc,e.h=n.gd,e.j=n.textStreams,e.i=n.imageStreams,P.A(2);break}for(s=-1,a=0;a<t.length;a++)o=t[a],e.m.has(o.id)||(e.m.add(o.id),-1==s&&(s=a));if(-1==s)return P.return();for(h=t.map((function(e){return e.Kc})),u=t.map((function(e){return e.gd})),c=t.map((function(e){return e.textStreams})),d=t.map((function(e){return e.imageStreams})),p=l(c),g=p.next();!g.done;g=p.next())g.value.push(rd(r.X));for(f=l(d),m=f.next();!m.done;m=f.next())m.value.push(rd(r.Wb));return b(P,Bc(e.g,h,s,Wc,Xc),3);case 3:return b(P,Bc(e.h,u,s,Wc,Xc),4);case 4:return b(P,Bc(e.j,c,s,Wc,Xc),5);case 5:return b(P,Bc(e.i,d,s,Wc,Xc),2);case 2:if(_=0,v=[],e.h.length&&e.g.length)for(C=l(e.g),E=C.next();!E.done;E=C.next())for(I=E.value,R=l(e.h),L=R.next();!L.done;L=R.next())k=L.value,M=zn(I.drmInfos,k.drmInfos),I.drmInfos.length&&k.drmInfos.length&&!M.length||(O=_++,v.push({id:O,language:I.language,primary:I.primary,audio:I,video:k,bandwidth:(I.bandwidth||0)+(k.bandwidth||0),drmInfos:M,allowedByApplication:!0,allowedByKeySystem:!0,decodingInfos:[]}));else for(y=e.h.concat(e.g),x=l(y),T=x.next();!T.done;T=x.next())S=T.value,A=_++,v.push({id:A,language:S.language,primary:S.primary,audio:S.type==r.Hc?S:null,video:S.type==r.va?S:null,bandwidth:S.bandwidth||0,drmInfos:S.drmInfos,allowedByApplication:!0,allowedByKeySystem:!0,decodingInfos:[]});e.l=v,w(P)}}))}function zc(e){var t,i,r,n,s,a,o,h,u,c,d,p,g,f,m,_,v,y,x,w,T,S,A,C;return P((function(E){switch(E.g){case 1:if(t=it,1==e.length)return E.return(e[0]);for(i=e.map((function(e){return e.filter((function(e){return e.type==t.Hc}))})),r=e.map((function(e){return e.filter((function(e){return e.type==t.va}))})),n=e.map((function(e){return e.filter((function(e){return e.type==t.X}))})),s=e.map((function(e){return e.filter((function(e){return e.type==t.Wb}))})),a=l(n),o=a.next();!o.done;o=a.next())o.value.push(id(t.X));for(h=l(s),u=h.next();!u.done;u=h.next())u.value.push(id(t.Wb));return b(E,Bc([],i,0,Gc,qc),2);case 2:return c=E.h,b(E,Bc([],r,0,Gc,qc),3);case 3:return d=E.h,b(E,Bc([],n,0,Gc,qc),4);case 4:return p=E.h,b(E,Bc([],s,0,Gc,qc),5);case 5:if(g=E.h,f=0,d.length&&c.length)for(y=l(c),x=y.next();!x.done;x=y.next())for(w=x.value,T=l(d),S=T.next();!S.done;S=T.next())A=S.value,C=f++,A.variantIds.push(C),w.variantIds.push(C);else for(m=d.concat(c),_=l(m),v=_.next();!v.done;v=_.next())v.value.variantIds=[f++];return E.return(d.concat(c).concat(p).concat(g))}}))}function Bc(e,t,i,r,n){var s,a,o,h,u,c,d,p,g,f,m,_,v,y,x,w,T,S;return P((function(A){switch(A.g){case 1:for(s=it,a=[],o=0;o<t.length;o++)o>=i?a.push(new Set(t[o])):a.push(new Set);h=l(e),u=h.next();case 2:if(u.done){A.A(4);break}return b(A,function(e,t,i,r,n){return P((function(s){return 1==s.g?(Yc(t,e),e.matchedStreams?e.segmentIndex?b(s,jc(e,i),2):s.A(2):s.return(!1)):(Vc(e,i,r,n),s.return(!0))}))}(u.value,t,i,n,a),5);case 5:if(!A.h)throw new Me(2,4,4037);u=h.next(),A.A(2);break;case 4:for(c=l(a),d=c.next();!d.done;d=c.next())for(p=d.value,g=l(p),f=g.next();!f.done;f=g.next())m=f.value,(_=Hc(m,t,r,n,a))&&e.push(_);for(v=l(a),d=v.next();!d.done;d=v.next())for(y=d.value,x={},w=l(y),f=w.next();!f.done;x={Va:x.Va},f=w.next())if(x.Va=f.value,T=x.Va.type==s.X&&!x.Va.language,S=x.Va.type==s.Wb&&!x.Va.tilesLayout,!T&&!S&&e.some(function(e){return function(t){return t.mimeType==e.Va.mimeType&&Xt(t.codecs)==Xt(e.Va.codecs)}}(x)))throw new Me(2,4,4037);return A.return(e)}}))}function jc(e,t){var i,r,n,s,a,o,h;return P((function(u){if(1==u.g){for(i=[],r=e.matchedStreams,n=l(r),s=n.next();!s.done;s=n.next())a=s.value,i.push(a.createSegmentIndex()),a.trickModeVideo&&!a.trickModeVideo.segmentIndex&&i.push(a.trickModeVideo.createSegmentIndex());return b(u,Promise.all(i),2)}if(e.segmentIndex instanceof Eo)for(o=0;o<r.length;o++)(h=r[o]).segmentIndex&&o>=t&&e.segmentIndex.l.push(h.segmentIndex);w(u)}))}function Hc(e,t,i,r,n){var s=i(e);return Yc(t,s),s.createSegmentIndex&&(s.createSegmentIndex=function(){return P((function(e){return s.segmentIndex?e.A(0):(s.segmentIndex=new Eo,b(e,jc(s,0),0))}))}),s.matchedStreams?(Vc(s,0,r,n),s):null}function Vc(e,t,i,r){for(var n=e.matchedStreams,s=0;s<n.length;s++)if(s>=t){var a=n[s];i(e,a);var o=!0;"audio"==e.type&&0==ai(e.language,a.language)&&(o=!1),o&&r[s].delete(a)}}function Wc(e){var t=Object.assign({},e);return t.originalId=null,t.createSegmentIndex=function(){return Promise.resolve()},t.closeSegmentIndex=function(){if(t.segmentIndex&&(t.segmentIndex.release(),t.segmentIndex=null),t.matchedStreams)for(var e=l(t.matchedStreams),i=e.next();!i.done;i=e.next())(i=i.value).segmentIndex&&(i.segmentIndex.release(),i.segmentIndex=null)},t.segmentIndex=null,t.emsgSchemeIdUris=[],t.keyIds=new Set,t.closedCaptions=null,t.trickModeVideo=null,t}function Gc(e){return(e=Object.assign({},e)).keyIds=new Set,e.segments=[],e.variantIds=[],e.closedCaptions=null,e}function Xc(e,t){var i,r;e.roles=Array.from(new Set(e.roles.concat(t.roles))),t.emsgSchemeIdUris&&(e.emsgSchemeIdUris=Array.from(new Set(e.emsgSchemeIdUris.concat(t.emsgSchemeIdUris)))),e.keyIds=(i=e.keyIds,r=t.keyIds,new Set([].concat(c(i),c(r)))),null==e.originalId?e.originalId=t.originalId:e.originalId+=","+(t.originalId||"");var n=zn(e.drmInfos,t.drmInfos);if(t.drmInfos.length&&e.drmInfos.length&&!n.length)throw new Me(2,4,4038);if(e.drmInfos=n,e.encrypted=e.encrypted||t.encrypted,t.closedCaptions){e.closedCaptions||(e.closedCaptions=new Map);for(var s=(n=l(t.closedCaptions)).next();!s.done;s=n.next()){var a=l(s.value);s=a.next().value,a=a.next().value,e.closedCaptions.set(s,a)}}t.trickModeVideo?(e.trickModeVideo||(e.trickModeVideo=Wc(t.trickModeVideo),e.trickModeVideo.createSegmentIndex=function(){return e.trickModeVideo.segmentIndex=e.segmentIndex.clone(),Promise.resolve()}),Xc(e.trickModeVideo,t.trickModeVideo)):e.trickModeVideo&&Xc(e.trickModeVideo,t)}function qc(e,t){e.roles=Array.from(new Set(e.roles.concat(t.roles)));var i=t.keyIds;if(i=new Set([].concat(c(e.keyIds),c(i))),e.keyIds=i,e.encrypted=e.encrypted&&t.encrypted,e.segments.push.apply(e.segments,c(t.segments)),t.closedCaptions)for(e.closedCaptions||(e.closedCaptions=new Map),i=(t=l(t.closedCaptions)).next();!i.done;i=t.next()){var r=l(i.value);i=r.next().value,r=r.next().value,e.closedCaptions.set(i,r)}}function Yc(e,t){for(var i=[],r=(e=l(e)).next();!r.done;r=e.next()){for(var n=t,s={audio:$c,video:$c,text:Kc,image:Zc}[n.type],a={audio:Qc,video:Jc,text:ed,image:td}[n.type],o=null,h=(r=l(r.value)).next();!h.done;h=r.next())!s(n,h=h.value)||o&&!a(n,o,h)||(o=h);if(!(n=o))return;i.push(n)}t.matchedStreams=i}function $c(e,t){var i;return!(i=t.mimeType!=e.mimeType||Xt(t.codecs)!=Xt(e.codecs))&&(i=e.drmInfos)&&(e=e.drmInfos,t=t.drmInfos,i=!(!e.length||!t.length||0<zn(e,t).length)),!i}function Kc(e,t){return!!e.language&&(!t.language||0!=ai(e.language,t.language)&&t.kind==e.kind)}function Zc(e){return!!e.tilesLayout}function Qc(e,t,i){if(e.id==i.id)return!0;var r=ai(e.language,t.language),n=ai(e.language,i.language);return n>r||!(n<r)&&(e.roles.length?(r=t.roles.filter((function(t){return e.roles.includes(t)})),(n=i.roles.filter((function(t){return e.roles.includes(t)}))).length>r.length||!(n.length<r.length)&&i.roles.length<t.roles.length):!(i.roles.length||!t.roles.length)||!(i.roles.length&&!t.roles.length)&&(!(t.primary||!i.primary)||!(t.primary&&!i.primary)&&((r=nd(e.channelsCount,t.channelsCount,i.channelsCount))==ad||r!=hd&&((r=nd(e.audioSamplingRate,t.audioSamplingRate,i.audioSamplingRate))==ad||r!=hd&&!(!e.bandwidth||sd(e.bandwidth,t.bandwidth,i.bandwidth)!=ad)))))}function Jc(e,t,i){if(e.id==i.id)return!0;var r=nd(e.width*e.height,t.width*t.height,i.width*i.height);if(r==ad)return!0;if(r==hd)return!1;if(e.frameRate){if((r=nd(e.frameRate,t.frameRate,i.frameRate))==ad)return!0;if(r==hd)return!1}return!(!e.bandwidth||sd(e.bandwidth,t.bandwidth,i.bandwidth)!=ad)}function ed(e,t,i){if(e.id==i.id)return!0;var r=ai(e.language,t.language),n=ai(e.language,i.language);if(n>r)return!0;if(n<r)return!1;if(!t.primary&&i.primary)return!0;if(t.primary&&!i.primary)return!1;if(e.roles.length){if(r=t.roles.filter((function(t){return e.roles.includes(t)})),(n=i.roles.filter((function(t){return e.roles.includes(t)}))).length>r.length)return!0;if(n.length<r.length)return!1}else{if(!i.roles.length&&t.roles.length)return!0;if(i.roles.length&&!t.roles.length)return!1}return i.mimeType==e.mimeType&&i.codecs==e.codecs&&(t.mimeType!=e.mimeType||t.codecs!=e.codecs)}function td(e,t,i){return e.id==i.id||nd(e.width*e.height,t.width*t.height,i.width*i.height)==ad}function id(e){return{id:0,originalId:"",primary:!1,type:e,mimeType:"",codecs:"",language:"",label:null,width:null,height:null,encrypted:!1,keyIds:new Set,segments:[],variantIds:[],roles:[],forced:!1,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,closedCaptions:null}}function rd(e){return{id:0,originalId:"",createSegmentIndex:function(){return Promise.resolve()},segmentIndex:new To([]),mimeType:"",codecs:"",encrypted:!1,drmInfos:[],keyIds:new Set,language:"",label:null,type:e,primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],forced:!1,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,closedCaptions:null}}function nd(e,t,i){if(t==e&&e!=i)return hd;if(i==e&&e!=t)return ad;if(t>e){if(i<=e||i-e<t-e)return ad;if(i-e>t-e)return hd}else{if(i>e)return hd;if(e-i<e-t)return ad;if(e-i>e-t)return hd}return od}function sd(e,t,i){return t=Math.abs(e-t),(e=Math.abs(e-i))<t?ad:t<e?hd:od}Fc.prototype.release=function(){for(var e=l(this.g.concat(this.h,this.j,this.i)),t=e.next();!t.done;t=e.next())(t=t.value).segmentIndex&&t.segmentIndex.release();this.g=[],this.h=[],this.j=[],this.i=[],this.l=[]};var ad=1,od=0,hd=-1;function ud(){var e=this;this.h=this.g=null,this.m=[],this.i=null,this.G=1,this.l={},this.L={},this.j=new Fc,this.F=0,this.H=new H(5),this.D=new ot((function(){!function(e){var t,i;P((function(r){switch(r.g){case 1:return t=0,T(r,2),b(r,ld(e),4);case 4:t=r.h,A(r,3);break;case 2:i=C(r),e.h&&(i.severity=1,e.h.onError(i));case 3:if(!e.h)return r.return();gd(e,t),w(r)}}))}(e)})),this.o=new Tr,this.s=null,this.J=[],this.u=1/0,this.B=!1}function ld(e){var t,i,r,n,s,a,o;return P((function(h){return 1==h.g?(t=Er(e.m,e.g.retryParameters),i=e.h.networkingEngine,e.h.modifyManifestRequest(t,{format:"d"}),r=Date.now(),n=i.request(0,t),Sr(e.o,n),b(h,n.promise,2)):3!=h.g?(s=h.h,e.h?(s.uri&&!e.m.includes(s.uri)&&e.m.unshift(s.uri),b(h,function(e,t,i){var r,n,s,a;return P((function(o){if(1==o.g){if(!(r=Tn(t,"MPD")))throw new Me(2,4,4001,i);return e.g.dash.disableXlinkProcessing?o.return(cd(e,r,i)):(n=e.g.dash.xlinkFailGracefully,s=_c(r,e.g.retryParameters,n,i,e.h.networkingEngine),Sr(e.o,s),b(o,s.promise,2))}return a=o.h,o.return(cd(e,a,i))}))}(e,s.data,s.uri),3)):h.return(0)):(a=Date.now(),o=(a-r)/1e3,e.H.sample(1,o),h.return(o))}))}function cd(e,t,i){var r,n,s,a,o,h,u,c,d,p,g,f,m,_,v,y,x,S,E,I,R,L,k,M,O,D,N,F,U;return P((function(z){switch(z.g){case 1:if((r=e.g.dash.manifestPreprocessor)&&r(t),n=[i],0<(s=on(t,"Location").map(cn).filter(Ke)).length&&(a=Ze(n,s),n=e.m=a),o=on(t,"BaseURL"),h=o.map(cn),u=Ze(n,h),c=0,o&&o.length&&(c=pn(o[0],"availabilityTimeOffset",xn)||0),d=e.g.dash.ignoreMinBufferTime,p=0,d||(p=pn(t,"minBufferTime",fn)||0),e.F=pn(t,"minimumUpdatePeriod",fn,-1),g=pn(t,"availabilityStartTime",gn),f=pn(t,"timeShiftBufferDepth",fn),m=e.g.dash.ignoreSuggestedPresentationDelay,_=null,m||(_=pn(t,"suggestedPresentationDelay",fn)),v=e.g.dash.ignoreMaxSegmentDuration,y=null,v||(y=pn(t,"maxSegmentDuration",fn)),x=t.getAttribute("type")||"static",e.i)for(S=e.i.presentationTimeline,E=l(Object.values(e.l)),I=E.next();!I.done;I=E.next())(R=I.value).segmentIndex&&R.segmentIndex.eb(S.Pa());else L=e.g.defaultPresentationDelay||1.5*p,S=new io(g,null!=_?_:L,e.g.dash.autoCorrectDrift);return S.yc("static"==x),S.U()&&!isNaN(e.g.availabilityWindowOverride)&&(f=e.g.availabilityWindowOverride),null==f&&(f=1/0),S.me(f),k=t.getAttribute("profiles")||"",M={Ma:"static"!=x,presentationTimeline:S,$:null,T:null,fa:null,I:null,bandwidth:0,Ke:!1,zb:c,profiles:k.split(",")},O=function(e,t,i,r){var n=pn(r,"mediaPresentationDuration",fn),s=[],a=0;r=on(r,"Period");for(var o=0;o<r.length;o++){var h=r[o],u=r[o+1],l=pn(h,"start",fn,a),c=h.id,d=pn(h,"duration",fn),p=null;if(u){var g=pn(u,"start",fn);null!=g&&(p=g-l)}else null!=n&&(p=n-l);if(null==p&&(p=d),!(null!==e.s&&null!==c&&null!==l&&l<e.s)||e.J.includes(c)||o+1==r.length){if(null!==l&&(null===e.s||l>e.s)&&(e.s=l),a=dd(e,t,i,{start:l,duration:p,node:h,Gd:null==p||!u}),s.push(a),t.$.id&&p&&(e.L[t.$.id]=p),null==p){a=null;break}a=l+p}}return e.J=s.map((function(e){return e.id})),null!=n?{periods:s,duration:n,De:!1}:{periods:s,duration:a,De:!0}}(e,M,u,t),D=O.duration,N=O.periods,"static"!=x&&O.De||S.Aa(D||1/0),e.u&&!e.B&&e.h.isAutoLowLatencyMode()&&(e.h.enableLowLatencyMode(),e.B=e.h.isLowLatencyMode()),e.B?S.Ue(e.u):e.u&&q("Low-latency DASH live stream detected, but low-latency streaming mode is not enabled in Shaka Player. Set streaming.lowLatencyMode configuration to true, and see https://bit.ly/3clctcj for details."),S.Sd(y||1),b(z,Uc(e.j,N,M.Ma),2);case 2:if(e.i){e.i.variants=e.j.l,e.i.textStreams=e.j.j.slice(),e.i.imageStreams=e.j.i,e.h.filter(e.i),z.A(3);break}if(e.i={presentationTimeline:S,variants:e.j.l,textStreams:e.j.j.slice(),imageStreams:e.j.i,offlineSessionIds:[],minBufferTime:p||0,sequenceMode:e.g.dash.sequenceMode},!S.df()){z.A(4);break}return F=on(t,"UTCTiming"),b(z,function(e,t,i){var r,n,s,a,o,h,u,c;return P((function(d){switch(d.g){case 1:r=i.map((function(e){return{scheme:e.getAttribute("schemeIdUri"),value:e.getAttribute("value")}})),n=e.g.dash.clockSyncUri,!r.length&&n&&r.push({scheme:"urn:mpeg:dash:utc:http-head:2014",value:n}),s=l(r),a=s.next();case 2:if(a.done){d.A(4);break}switch(o=a.value,T(d,5),h=o.scheme,u=o.value,h){case"urn:mpeg:dash:utc:http-head:2014":case"urn:mpeg:dash:utc:http-head:2012":return d.A(7);case"urn:mpeg:dash:utc:http-xsdate:2014":case"urn:mpeg:dash:utc:http-iso:2014":case"urn:mpeg:dash:utc:http-xsdate:2012":case"urn:mpeg:dash:utc:http-iso:2012":return d.A(8);case"urn:mpeg:dash:utc:direct:2014":case"urn:mpeg:dash:utc:direct:2012":return c=Date.parse(u),d.return(isNaN(c)?0:c-Date.now());case"urn:mpeg:dash:utc:http-ntp:2014":case"urn:mpeg:dash:utc:ntp:2014":case"urn:mpeg:dash:utc:sntp:2014":q("NTP UTCTiming scheme is not supported");break;default:q("Unrecognized scheme in UTCTiming element",h)}d.A(9);break;case 7:return b(d,md(e,t,u,"HEAD"),10);case 10:return d.return(d.h);case 8:return b(d,md(e,t,u,"GET"),11);case 11:return d.return(d.h);case 9:A(d,3);break;case 5:C(d);case 3:a=s.next(),d.A(2);break;case 4:return q("A UTCTiming element should always be given in live manifests! This content may not play on clients with bad clocks!"),d.return(0)}}))}(e,u,F),5);case 5:if(U=z.h,!e.h)return z.return();S.Ve(U);case 4:S.Md();case 3:e.h.makeTextStreamsForClosedCaptions(e.i),w(z)}}))}function dd(e,t,i,r){t.$=fd(r.node,null,i),t.T=r,t.$.zb=t.zb,t.$.id||(t.$.id="__shaka_period_"+r.start);var n=on(r.node,"EventStream");i=t.presentationTimeline.Pa();for(var s=(n=l(n)).next();!s.done;s=n.next())_d(e,r.start,r.duration,s.value,i);if(i=on(r.node,"AdaptationSet").map((function(i){return function(e,t,i){function r(e){switch(e){case 1:case 6:case 13:case 14:case 15:return"SDR";case 16:return"PQ";case 18:return"HLG"}}t.fa=fd(i,t.$,null);var n,s=!1,a=on(i,"Role"),o=a.map((function(e){return e.getAttribute("value")})).filter(Ke),h=void 0,u=t.fa.contentType==tt;u&&(h="subtitle");for(var d=(a=l(a)).next();!d.done;d=a.next()){var p=(d=d.value).getAttribute("schemeIdUri");if(null==p||"urn:mpeg:dash:role:2011"==p)switch(d=d.getAttribute("value"),d){case"main":s=!0;break;case"caption":case"subtitle":h=d}}p=on(i,"EssentialProperty"),a=null,d=!1;for(var g=(p=l(p)).next();!g.done;g=p.next()){var f=(g=g.value).getAttribute("schemeIdUri");"http://dashif.org/guidelines/trickmode"==f?a=g.getAttribute("value"):"urn:mpeg:mpegB:cicp:TransferCharacteristics"==f?n=r(parseInt(g.getAttribute("value"),10)):d=!0}for(p=l(p=on(i,"SupplementalProperty")),g=p.next();!g.done;g=p.next())"urn:mpeg:mpegB:cicp:TransferCharacteristics"==(g=g.value).getAttribute("schemeIdUri")&&(n=r(parseInt(g.getAttribute("value"),10)));p=on(i,"Accessibility");var m=new Map;for(p=l(p),g=p.next();!g.done;g=p.next())if(f=g.value,g=f.getAttribute("schemeIdUri"),f=f.getAttribute("value"),"urn:scte:dash:cc:cea-608:2015"==g)if(g=1,null!=f)for(var _=l(f=f.split(";")),v=_.next();!v.done;v=_.next()){var y=v.value,x=v=void 0;y.includes("=")?(v=(y=y.split("="))[0].startsWith("CC")?y[0]:"CC"+y[0],x=y[1]||"und"):(v="CC"+g,2==f.length?g+=2:g++,x=y),m.set(v,si(x))}else m.set("CC1","und");else if("urn:scte:dash:cc:cea-708:2015"==g)if(g=1,null!=f)for(v=(f=l(f.split(";"))).next();!v.done;v=f.next())y=_=void 0,(v=v.value).includes("=")?(_="svc"+(v=v.split("="))[0],y=v[1].split(",")[0].split(":").pop()):(_="svc"+g,g++,y=v),m.set(_,si(y));else m.set("svc1","und");else"urn:mpeg:dash:role:2011"==g&&null!=f&&(o.push(f),"captions"==f&&(h="caption"));if(d)return null;d=on(i,"ContentProtection");var T=hc(d,e.g.dash.ignoreDrmInfo,e.g.dash.keySystemsByURI),S=si(i.getAttribute("lang")||"und"),A=i.getAttribute("label");if((d=on(i,"Label"))&&d.length&&(d=d[0],d.textContent&&(A=d.textContent)),d=on(i,"Representation"),i=d.map((function(i){return(i=function(e,t,i,r,n,s,a,o,h,u){if(t.I=fd(u,t.fa,null),e.u=Math.min(e.u,t.I.zb),!function(e){var t=e.wc?1:0;return t+=e.ab?1:0,t+=e.xc?1:0,0==t?e.contentType==tt||"application"==e.contentType:(1!=t&&(e.wc&&(e.ab=null),e.xc=null),!0)}(t.I))return null;var l=t.T.start;t.bandwidth=pn(u,"bandwidth",vn)||0;var c=t.I.contentType,d=c==tt||"application"==c;c="image"==c;try{var p=function(t,i,r){return function(e,t,i,r){var n,s,a,o,h;return P((function(u){return 1==u.g?(n=kr,s=zo(t,i,r,e.g.retryParameters),a=e.h.networkingEngine,o=a.request(n,s),Sr(e.o,o),b(u,o.promise,2)):(h=u.h,u.return(h.data))}))}(e,t,i,r)};if(t.I.wc)var g=Ec(t,p);else if(t.I.ab)g=Pc(t,e.l);else if(t.I.xc)g=Dc(t,p,e.l,!!e.i,e.g.dash.initialSegmentLimit,e.L);else{var f=t.I.wa,m=t.T.duration||0;g={Bb:function(){return Promise.resolve(Ao(l,m,f))}}}}catch(A){if((d||c)&&4002==A.code)return null;throw A}p=on(u,"ContentProtection"),p=function(e,t,i,r){var n=hc(e,i,r);if(t.Fe)e=1==t.drmInfos.length&&!t.drmInfos[0].keySystem,i=0==n.drmInfos.length,(0==t.drmInfos.length||e&&!i)&&(t.drmInfos=n.drmInfos),t.Fe=!1;else if(0<n.drmInfos.length&&(t.drmInfos=t.drmInfos.filter((function(e){return n.drmInfos.some((function(t){return t.keySystem==e.keySystem}))})),0==t.drmInfos.length))throw new Me(2,4,4008);return n.Be||t.Be}(p,i,e.g.dash.ignoreDrmInfo,e.g.dash.keySystemsByURI),p=new Set(p?[p]:[]);var _=!1;on(u,"SupplementalProperty").some((function(e){return"tag:dolby.com,2018:dash:EC3_ExtensionType:2018"==e.getAttribute("schemeIdUri")&&"JOC"==e.getAttribute("value")}))&&(_=!0);var v,y,x=!1;if(d&&(x=o.includes("forced_subtitle")||o.includes("forced-subtitle")),c&&((u=on(u,"EssentialProperty").find((function(e){return["http://dashif.org/thumbnail_tile","http://dashif.org/guidelines/thumbnail_tile"].includes(e.getAttribute("schemeIdUri"))})))&&(v=u.getAttribute("value")),!v))return null;u=t.I.codecs,t.profiles.includes("http://dashif.org/guidelines/dash-if-uhd#hevc-hdr-pq10")&&(u.includes("hvc1.2.4.L153.B0")||u.includes("hev1.2.4.L153.B0"))&&(y="PQ");var T=t.I.id?t.$.id+","+t.I.id:"",S={id:e.G++,originalId:t.I.id,createSegmentIndex:function(){var i,r;return P((function(n){if(1==n.g)return(i=T&&t.Ma&&e.l[T]?e.l[T]:S).segmentIndex?n.A(0):(r=i,b(n,g.Bb(),3));r.segmentIndex=n.h,w(n)}))},closeSegmentIndex:function(){S.segmentIndex&&(S.segmentIndex.release(),S.segmentIndex=null)},segmentIndex:null,mimeType:t.I.mimeType,codecs:t.I.codecs,frameRate:t.I.frameRate,pixelAspectRatio:t.I.pixelAspectRatio,bandwidth:t.bandwidth,width:t.I.width,height:t.I.height,kind:r,encrypted:0<i.drmInfos.length,drmInfos:i.drmInfos,keyIds:p,language:n,label:s,type:t.fa.contentType,primary:a,trickModeVideo:null,emsgSchemeIdUris:t.I.emsgSchemeIdUris,roles:o,forced:x,channelsCount:t.I.ad,audioSamplingRate:t.I.audioSamplingRate,spatialAudio:_,closedCaptions:h,hdr:y,tilesLayout:v,matchedStreams:[]};return T&&t.Ma&&!e.l[T]&&(e.l[T]=S),S}(e,t,T,h,S,A,s,o,m,i))&&(i.hdr=i.hdr||n),i})).filter((function(e){return!!e})),0==i.length){if(a="image"==t.fa.contentType,e.g.dash.ignoreEmptyAdaptationSet||u||a)return null;throw new Me(2,4,4003)}if(!t.fa.contentType||"application"==t.fa.contentType)for(t.fa.contentType=vd(i[0].mimeType,i[0].codecs),u=l(i),p=u.next();!p.done;p=u.next())p.value.type=t.fa.contentType;for(u=l(i),p=u.next();!p.done;p=u.next())for(p=p.value,g=l(T.drmInfos),f=g.next();!f.done;f=g.next())(f=f.value).keyIds=f.keyIds&&p.keyIds?new Set([].concat(c(f.keyIds),c(p.keyIds))):f.keyIds||p.keyIds;return u=d.map((function(e){return e.getAttribute("id")})).filter(Ke),{id:t.fa.id||"__fake__"+e.G++,contentType:t.fa.contentType,language:S,th:s,streams:i,drmInfos:T.drmInfos,qe:a,qg:u}}(e,t,i)})).filter(Ke),t.Ma){for(r=[],s=(n=l(i)).next();!s.done;s=n.next())for(var a=(s=l(s.value.qg)).next();!a.done;a=s.next())r.push(a.value);if(r.length!=new Set(r).size)throw new Me(2,4,4018)}for(r=i.filter((function(e){return!e.qe})),n=(i=l(i=i.filter((function(e){return e.qe})))).next();!n.done;n=i.next()){s=(n=n.value).qe.split(" ");for(var o=(a=l(r)).next();!o.done;o=a.next()){var h=o.value;if(s.includes(h.id)){o={};for(var u=(h=l(h.streams)).next();!u.done;o={Gc:o.Gc},u=h.next())o.Gc=u.value,o.Gc.trickModeVideo=n.streams.find(function(e){return function(t){return Xt(e.Gc.codecs)==Xt(t.codecs)}}(o))}}}if(n=e.g.disableAudio?[]:pd(r,"audio"),a=e.g.disableVideo?[]:pd(r,"video"),s=e.g.disableText?[]:pd(r,tt),i=e.g.disableThumbnails?[]:pd(r,"image"),!a.length&&!n.length)throw new Me(2,4,4004);for(r=[],o=(n=l(n)).next();!o.done;o=n.next())r.push.apply(r,c(o.value.streams));for(n=[],o=(a=l(a)).next();!o.done;o=a.next())n.push.apply(n,c(o.value.streams));for(a=[],o=(s=l(s)).next();!o.done;o=s.next())a.push.apply(a,c(o.value.streams));for(s=[],o=(i=l(i)).next();!o.done;o=i.next())s.push.apply(s,c(o.value.streams));return{id:t.$.id,Kc:r,gd:n,textStreams:a,imageStreams:s}}function pd(e,t){return e.filter((function(e){return e.contentType==t}))}function gd(e,t){0>e.F||e.D.N(Math.max(3,e.F-t,V(e.H)))}function fd(e,t,i){t=t||{contentType:"",mimeType:"",codecs:"",emsgSchemeIdUris:[],frameRate:void 0,pixelAspectRatio:void 0,ad:null,audioSamplingRate:null,zb:0},i=i||t.wa;for(var r=on(e,"BaseURL"),n=r.map(cn),s=e.getAttribute("contentType")||t.contentType,a=e.getAttribute("mimeType")||t.mimeType,o=e.getAttribute("codecs")||t.codecs,h=pn(e,"frameRate",bn)||t.frameRate,u=e.getAttribute("sar")||t.pixelAspectRatio,c=on(e,"InbandEventStream"),d=t.emsgSchemeIdUris.slice(),p=(c=l(c)).next();!p.done;p=c.next())p=p.value.getAttribute("schemeIdUri"),d.includes(p)||d.push(p);c=function(e){for(var t=(e=l(e)).next();!t.done;t=e.next()){var i=t.value;if((t=i.getAttribute("schemeIdUri"))&&(i=i.getAttribute("value")))switch(t){case"urn:mpeg:dash:outputChannelPositionList:2012":return i.trim().split(/ +/).length;case"urn:mpeg:dash:23003:3:audio_channel_configuration:2011":case"urn:dts:dash:audio_channel_configuration:2012":if(!(t=parseInt(i,10)))continue;return t;case"tag:dolby.com,2014:dash:audio_channel_configuration:2011":case"urn:dolby:dash:audio_channel_configuration:2011":if(!(t=parseInt(i,16)))continue;for(e=0;t;)1&t&&++e,t>>=1;return e;case"urn:mpeg:mpegB:cicp:ChannelConfiguration":if(t=[0,1,2,3,4,5,6,8,2,3,4,7,8,24,8,12,10,12,14,12,14],(i=parseInt(i,10))&&0<i&&i<t.length)return t[i]}}return null}(c=on(e,"AudioChannelConfiguration"))||t.ad,p=pn(e,"audioSamplingRate",yn)||t.audioSamplingRate,s||(s=vd(a,o));var g=sn(e,"SegmentBase"),f=sn(e,"SegmentTemplate"),m=g&&pn(g,"availabilityTimeOffset",xn)||0,_=f&&pn(f,"availabilityTimeOffset",xn)||0;return r=r&&r.length&&pn(r[0],"availabilityTimeOffset",xn)||0,r=t.zb+r+m+_,{wa:Ze(i,n),wc:g||t.wc,ab:sn(e,"SegmentList")||t.ab,xc:f||t.xc,width:pn(e,"width",yn)||t.width,height:pn(e,"height",yn)||t.height,contentType:s,mimeType:a,codecs:o,frameRate:h,pixelAspectRatio:u,emsgSchemeIdUris:d,id:e.getAttribute("id"),ad:c,audioSamplingRate:p,zb:r}}function md(e,t,i,r){var n,s,a,o,h,u;return P((function(l){if(1==l.g)return n=Ze(t,[i]),(s=Er(n,e.g.retryParameters)).method=r,a=e.h.networkingEngine.request(4,s),Sr(e.o,a),b(l,a.promise,2);if(o=l.h,"HEAD"==r){if(!o.headers||!o.headers.date)return l.return(0);h=o.headers.date}else h=wt(o.data);return u=Date.parse(h),isNaN(u)?l.return(0):l.return(u-Date.now())}))}function _d(e,t,i,r,n){for(var s=r.getAttribute("schemeIdUri")||"",a=r.getAttribute("value")||"",o=pn(r,"timescale",yn)||1,h=(r=l(on(r,"Event"))).next();!h.done;h=r.next()){var u=pn(h=h.value,"presentationTime",yn)||0,c=pn(h,"duration",yn)||0;c=(u=u/o+t)+c/o,null!=i&&(u=Math.min(u,t+i),c=Math.min(c,t+i)),c<n||(h={schemeIdUri:s,value:a,startTime:u,endTime:c,id:h.getAttribute("id")||"",eventElement:h},e.h.onTimelineRegionAdded(h))}}function vd(e,t){return Kt(Wt(e,t))?tt:e.split("/")[0]}function yd(e,t,i,r){this.h=e,this.type=t,this.g=i,this.segments=r||null}function xd(e,t,i,r){this.id=e,this.name=t,this.g=i,this.value=void 0===r?null:r}function bd(e,t,i){return(e=e.getAttribute(t))?e.value:i||null}function wd(e,t){if(!(e=e.getAttribute(t)))throw new Me(2,4,4023,t);return e.value}function Td(e,t,i){i=void 0===i?[]:i,this.g=t,this.i=e,this.h=i}function Sd(e,t){this.name=e,this.value=t}function Ad(e,t){return e.filter((function(e){return e.name==t}))}function Cd(e,t){return e.filter((function(e){return wd(e,"TYPE")==t}))}function Ed(e,t){return(e=Ad(e,t)).length?e[0]:null}function Id(e,t){var i=0;return i=void 0===i?0:i,(e=Ed(e,t))?Number(e.value):i}function Rd(e,t){return Ze([e],[t])[0]}function Ld(e){this.h=e,this.g=0}function kd(e){Md(e,/[ \t]+/gm)}function Md(e,t){return t.lastIndex=e.g,t=null==(t=t.exec(e.h))?null:{position:t.index,length:t[0].length,results:t},e.g==e.h.length||null==t||t.position!=e.g?null:(e.g+=t.length,t.results)}function Pd(e){return e.g==e.h.length?null:(e=Md(e,/[^ \t\n]*/gm))?e[0]:null}function Od(){this.g=0}function Dd(e,t,i){var r=(t=(t=wt(t)).replace(/\r\n|\r(?=[^\n]|$)/gm,"\n").trim()).split(/\n+/m);if(!/^#EXTM3U($|[ \t\n])/m.test(r[0]))throw new Me(2,4,4015);t=0;for(var n=!0,s=l(r),a=s.next();!a.done;a=s.next())if(a=a.value,/^#(?!EXT)/m.test(a)||n)n=!1;else{if(a=Nd(e,a),--e.g,Fd.includes(a.name)){t=1;break}"EXT-X-STREAM-INF"==a.name&&(n=!0)}for(s=[],n=!0,a=0;a<r.length;a++){var o=r[a],h=r[a+1];if(/^#(?!EXT)/m.test(o)||n)n=!1;else{if(o=Nd(e,o),Ud.includes(o.name)){if(1!=t)throw new Me(2,4,4017);var u=r.splice(a,r.length-a);r=i,n=[],a=[],h=[],o=null;for(var c=(u=l(u)).next();!c.done;c=u.next())c=c.value,/^(#EXT)/.test(c)?(c=Nd(e,c),Fd.includes(c.name)?s.push(c):"EXT-X-MAP"==c.name?o=c:"EXT-X-PART"==c.name?h.push(c):"EXT-X-PRELOAD-HINT"==c.name?"PART"==bd(c,"TYPE")?h.push(c):"MAP"==bd(c,"TYPE")&&(c.name="EXT-X-MAP",o=c):a.push(c)):/^#(?!EXT)/m.test(c)||(c=Rd(r,c.trim()),o&&a.push(o),n.push(new Td(c,a,h)),a=[],h=[]);return h.length&&(o&&a.push(o),n.push(new Td("",a,h))),new yd(i,t,s,n)}s.push(o),"EXT-X-STREAM-INF"==o.name&&(o.g.push(new Sd("URI",h)),n=!0)}}return new yd(i,t,s)}function Nd(e,t){e=e.g++;var i=t.match(/^#(EXT[^:]*)(?::(.*))?$/);if(!i)throw new Me(2,4,4016,t);t=i[1];var r,n=i[2];if(i=[],n){var s;(s=Md(n=new Ld(n),/^([^,=]+)(?:,|$)/g))&&(r=s[1]);for(var a=/([^=]+)=(?:"([^"]*)"|([^",]*))(?:,|$)/g;s=Md(n,a);)i.push(new Sd(s[1],s[2]||s[3])),kd(n)}return new xd(e,t,i,r)}(n=ud.prototype).configure=function(e){this.g=e},n.start=function(e,t){var i,r=this;return P((function(n){if(1==n.g)return r.B=t.isLowLatencyMode(),r.m=[e],r.h=t,b(n,ld(r),2);if(i=n.h,r.h&&gd(r,i),!r.h)throw new Me(2,7,7001);return n.return(r.i)}))},n.stop=function(){for(var e=l(Object.values(this.l)),t=e.next();!t.done;t=e.next())(t=t.value).segmentIndex&&t.segmentIndex.release();return this.j&&this.j.release(),this.g=this.h=null,this.m=[],this.i=null,this.l={},this.j=null,null!=this.D&&(this.D.stop(),this.D=null),this.o.destroy()},n.update=function(){var e,t=this;return P((function(i){return 1==i.g?(T(i,2),b(i,ld(t),4)):2!=i.g?A(i,0):(e=C(i),t.h&&e?(t.h.onError(e),void w(i)):i.return())}))},n.onExpirationUpdated=function(){},j("shaka.dash.DashParser",ud),Jn.mpd=function(){return new ud},Qn["application/dash+xml"]=function(){return new ud},Qn["video/vnd.mpeg.dash.mpd"]=function(){return new ud},xd.prototype.toString=function(){var e="#"+this.name,t=this.g?this.g.map((function(e){return e.name+"="+(isNaN(Number(e.value))?'"'+e.value+'"':e.value)})):[];return this.value&&t.unshift(this.value),0<t.length&&(e+=":"+t.join(",")),e},xd.prototype.getAttribute=function(e){var t=this.g.filter((function(t){return t.name==e}));return t.length?t[0]:null};var Fd="EXT-X-TARGETDURATION EXT-X-MEDIA-SEQUENCE EXT-X-DISCONTINUITY-SEQUENCE EXT-X-PLAYLIST-TYPE EXT-X-I-FRAMES-ONLY EXT-X-ENDLIST EXT-X-SERVER-CONTROL EXT-X-SKIP".split(" "),Ud="EXTINF EXT-X-BYTERANGE EXT-X-DISCONTINUITY EXT-X-PROGRAM-DATE-TIME EXT-X-KEY EXT-X-DATERANGE EXT-X-MAP".split(" ");function zd(){}function Bd(e){try{var t=jd(e);return gr({uri:e,Oe:e,data:t.data,headers:{"content-type":t.contentType}})}catch(i){return dr(i)}}function jd(t){var i=t.split(":");if(2>i.length||"data"!=i[0])throw new Me(2,1,1004,t);if(2>(i=i.slice(1).join(":").split(",")).length)throw new Me(2,1,1004,t);var r=i[0];t=e.decodeURIComponent(i.slice(1).join(",")),i=r.split(";"),r=i[0];var n=!1;return 1<i.length&&"base64"==i[i.length-1]&&(n=!0,i.pop()),{data:n?kt(t):At(t),contentType:r}}function Hd(){var e=this;this.g=this.i=null,this.Fa=1,this.o=new Map,this.u=new Map,this.F=new Map,this.F.set("video",new Map),this.F.set("audio",new Map),this.F.set(tt,new Map),this.F.set("image",new Map),this.ua=new Set,this.h=new Map,this.j=null,this.M="",this.W=new Od,this.O=0,this.B=-1,this.H=1/0,this.Ga=!1,this.m=new ot((function(){!function(e){var t,i;P((function(r){return 1==r.g?e.i?(T(r,2),b(r,e.update(),4)):r.return():2!=r.g?(fp(e)&&(t=e.O,e.m.N(t)),A(r,0)):(i=C(r),e.i?(i.severity=1,e.i.onError(i),e.m.N(.1),void w(r)):r.return())}))}(e)})),this.ea=Tp,this.D=null,this.ca=0,this.J=1/0,this.V=this.da=0,this.G=new Tr,this.L=new Map,this.s=new Map,this.ba=new Map,this.l=!1}function Vd(e,t){return fp(e)?e.F.get(t.type):t.$c}function Wd(e,t){var i,r,n,s,a,o,h,u,l,d,p,g,f,m,_;return P((function(v){if(1==v.g)return i=t.Jc,r=new Oe(i),e.l&&t.Mc&&Fe(r,new Xe("_HLS_skip=YES")),b(v,gp(e,r.toString()),2);if(n=v.h,!t.stream.segmentIndex)return v.return();if(1!=(s=Dd(e.W,n.data,n.uri)).type)throw new Me(2,4,4017);a=Ad(s.g,"EXT-X-DEFINE"),o=qd(e,a),h=t.stream,u=Vd(e,t),l=rp(s,h.mimeType),d=l.keyIds,p=l.drmInfos,function(e,t){return e.size===t.size&&[].concat(c(e)).every((function(e){return t.has(e)}))}(h.keyIds,d)||(h.keyIds=d,h.drmInfos=p,e.i.newDrmInfo(h)),g=lp(e,s,h.type,u,o),h.segmentIndex.Hb(g,e.j.Pa()),g.length&&(f=Id(s.g,"EXT-X-MEDIA-SEQUENCE"),m=u.get(f),h.segmentIndex.eb(m)),_=g[g.length-1],Ed(s.g,"EXT-X-ENDLIST")&&(t.mc=!0,t.Ya=_.endTime),w(v)}))}function Gd(e,t,i){t.Ya+=i;for(var r=(t=l(e=Vd(e,t))).next();!r.done;r=t.next()){var n=l(r.value);r=n.next().value,n=n.next().value,e.set(r,n+i)}}function Xd(e){if(fp(e)){if(e.O=e.J,e.ea==Ap){var t=Qd(e);e.g.hls.useSafariBehaviorForLive&&(t=e.j.m),isNaN(e.g.availabilityWindowOverride)||(t=e.g.availabilityWindowOverride),e.j.me(t)}}else e.j.Aa(Qd(e));e.j.Md()}function qd(e,t){for(var i=new Map,r=(t=l(t)).next();!r.done;r=t.next()){var n=r.value;r=bd(n,"NAME");var s=bd(n,"VALUE");n=bd(n,"IMPORT"),r&&s&&i.set(r,s),n&&(r=e.o.get(n))&&i.set(n,r)}return i}function Yd(e,t){var i=[];e.g.disableVideo||i.push(e.g.hls.defaultVideoCodec),e.g.disableAudio||i.push(e.g.hls.defaultAudioCodec),i=bd(t,"CODECS",i.join(",")).split(/\s*,\s*/),e=new Set,t=[];for(var r=(i=l(i)).next();!r.done;r=i.next()){var n=Yt(r=r.value)[0];e.has(n)||(t.push(r),e.add(n))}return t}function $d(e){return si(e=bd(e,"LANGUAGE")||"und")}function Kd(e,t){var i=wd(t,"GROUP-ID"),r="",n=wd(t,"TYPE").toLowerCase();"subtitles"==n&&(n=tt);var s=n;if(s!=tt&&i&&e.s.has(i)&&(r=e.s.get(i)),n=cp(wd(t,"URI"),e.o),e.h.has(n))return e.h.get(n);var a=$d(t),o=bd(t,"NAME"),h="YES"==bd(t,"DEFAULT"),u="audio"==s&&(u=bd(t,"CHANNELS"))?parseInt(u.split("/")[0],10):null,l="audio"==s&&(!!(l=bd(t,"CHANNELS"))&&l.includes("/JOC"));return r=Zd(e,n,r,s,a,h,o,u,null,bd(t,"CHARACTERISTICS"),t="YES"==bd(t,"FORCED"),l),e.u.has(i)?e.u.get(i).push(r):e.u.set(i,[r]),e.h.has(n)?e.h.get(n):(e.h.set(n,r),r)}function Zd(e,t,i,r,n,s,a,o,h,u,c,d){function p(p){var g,_,v,y,x,T,S,A,C,E,I,R,L;return P((function(k){if(1==k.g)return b(k,gp(e,m.Jc),2);if(3!=k.g)return g=k.h,p.aborted?k.return():(_=g.uri,v=Dd(e.W,g.data,_),y=fp(e),b(k,tp(e,v,t,_,i,r,n,s,a,o,h,u,c,d),3));if(x=k.h,p.aborted)return k.return();if(T=x.stream,fp(e)&&!y&&ap(e),m.Jc=_,m.Ya=x.Ya,m.Mc=x.Mc,m.mc=x.mc,m.$c=x.$c,m.Ld=!0,f.segmentIndex=T.segmentIndex,f.encrypted=T.encrypted,f.drmInfos=T.drmInfos,f.keyIds=T.keyIds,f.mimeType=T.mimeType,to.includes(f.mimeType)&&(f.codecs=""),f.drmInfos.length&&e.i.newDrmInfo(f),r==(S=it).va||r==S.Hc)for(A=l(e.h.values()),C=A.next();!C.done;C=A.next())(E=C.value).Ld||E.type!=r||(E.stream.mimeType=T.mimeType,to.includes(E.stream.mimeType)&&(E.stream.codecs=""));(function(e){if(!e.D)return!1;for(var t=[],i=[],r=(e=l(e.D.variants)).next();!r.done;r=e.next())(r=r.value).video&&t.push(r.video),r.audio&&i.push(r.audio);return!(0<t.length&&!t.some((function(e){return e.segmentIndex}))||0<i.length&&!i.some((function(e){return e.segmentIndex})))})(e)&&(e.Ga?ep(e,[m]):(e.Ga=!0,I=Array.from(e.h.values()),R=I.filter((function(e){return e.stream.segmentIndex})),ep(e,R),Xd(e),0<(L=e.O)&&e.m.N(L))),w(k)}))}var g=Rd(e.M,t),f=ip(e,i,r,n,s,a,o,h,u,c,d);to.includes(f.mimeType)&&(f.codecs="");var m={stream:f,type:r,Ac:t,Jc:g,Ya:0,$c:new Map,Mc:!1,mc:!1,Cd:-1,Ld:!1},_=null,v=new AbortController;return f.createSegmentIndex=function(){return _||(v=new AbortController,_=new Promise((function(e){e(p(v.signal))})))},f.closeSegmentIndex=function(){_&&!f.segmentIndex&&v.abort(),f.segmentIndex&&(f.segmentIndex.release(),f.segmentIndex=null),_=null},m}function Qd(e){for(var t=1/0,i=(e=l(e.h.values())).next();!i.done;i=e.next())(i=i.value).stream.segmentIndex&&"text"!=i.stream.type&&(t=Math.min(t,i.Ya));return t}function Jd(e,t){for(var i=[],r=(t=l(t)).next();!r.done;r=t.next())(r=r.value).segmentIndex&&So(r.segmentIndex,(function(e){i.push(e)}));e.j.Ib(i)}function ep(e,t){if(!fp(e))for(var i=Qd(e),r=l(t),n=r.next();!n.done;n=r.next())n.value.stream.segmentIndex.Wa(0,i);for(n=(i=l(t)).next();!n.done;n=i.next())n=n.value.stream,to.includes(n.mimeType)&&(n.codecs="");Jd(e,t.map((function(e){return e.stream}))),e.g.hls.ignoreManifestProgramDateTime?function(e,t){for(var i=-1==e.B,r=l(t),n=r.next();!n.done;n=r.next()){var s=(n=n.value).stream.segmentIndex,a=Vd(e,n);if(s=s.g[0]||null)for(var o=(a=l(a)).next();!o.done;o=a.next()){var h=(o=l(o.value)).next().value;if(o.next().value==s.startTime){i&&(e.B=Math.max(e.B,h)),n.Cd=h;break}}}if(!(0>e.B))for(n=(t=l(t)).next();!n.done;n=t.next())(r=(i=n.value).stream.segmentIndex)&&(r.g.splice(0,e.B-i.Cd),(r=r.g[0]||null)&&(r=-r.startTime,i.stream.segmentIndex.offset(r),Gd(e,i,r)))}(e,t):function(e,t){if(1/0==e.H)for(var i=(t=l(t)).next();!i.done;i=t.next()){var r=i.value.stream.segmentIndex.g[0]||null;null!=r&&null!=r.g&&(e.H=Math.min(e.H,r.g))}if(1/0!=(t=e.H))for(i=(r=l(e.h.values())).next();!i.done;i=r.next()){var n=(i=i.value).stream.segmentIndex;if(null!=n){var s=n.g[0]||null;if(null==s.g)X("Missing EXT-X-PROGRAM-DATE-TIME for stream",i.Ac,"Expect AV sync issues!");else for(Gd(e,i,s.g-t-s.startTime),n=(i=l(n)).next();!n.done;n=i.next())n.value.oe(t)}}}(e,t)}function tp(e,t,i,r,n,s,a,o,h,u,l,c,d,p,g){var f,m,_,v,y,x,w,T,S,A,C,E,I,R,L;return P((function(k){if(1==k.g){if(1!=t.type)throw new Me(2,4,4017);return f=Ad(t.g,"EXT-X-DEFINE"),m=qd(e,f),sp(e,t),g?k.A(2):b(k,function(e,t,i,r,n){var s,a,o,h,u,l,c,d,p,g;return P((function(f){return 1==f.g?(s=kr,a=Math.trunc((r.segments.length-1)/2),o=cp(r.segments[a].i,n),h=new Oe(o),u=h.qa.split(".").pop(),l=bp[t],(c=l[u])||(c=vp[u])||(c=dp(t,i))?f.return(c):((d=Er([o],e.g.retryParameters)).method="HEAD",b(f,_p(e,d,s),2))):(p=f.h,(g=p.headers["content-type"])?f.return(g.split(";")[0]):f.return(pp(t)))}))}(e,s,n,t,m),3)}if(2!=k.g&&(g=k.h),_=rp(t,g),v=_.drmInfos,y=_.keyIds,x=_.encrypted,w=_.kf,x&&!v.length&&!w)throw new Me(2,4,4026);return T=fp(e)?e.F.get(s):new Map,S=e.l,A=lp(e,t,s,T,m),S!=e.l&&sp(e,t),C=A[A.length-1].endTime,E=new To(A),R=!!(I=Ed(t.g,"EXT-X-SERVER-CONTROL"))&&null!=I.getAttribute("CAN-SKIP-UNTIL"),(L=ip(e,n,s,a,o,h,u,l,c,d,p)).segmentIndex=E,L.encrypted=x,L.drmInfos=v,L.keyIds=y,L.mimeType=g,k.return({stream:L,type:s,Ac:i,Jc:r,Ya:C,Mc:R,mc:!1,Cd:-1,$c:T,Ld:!1})}))}function ip(e,t,i,r,n,s,a,o,h,u,l){var c=dp(i,t)||pp(i);return{id:e.Fa++,originalId:s,createSegmentIndex:function(){return Promise.resolve()},segmentIndex:null,mimeType:c,codecs:t,kind:i==tt?"subtitle":void 0,encrypted:!1,drmInfos:[],keyIds:new Set,language:r,label:s,type:i,primary:n,trickModeVideo:null,emsgSchemeIdUris:null,frameRate:void 0,pixelAspectRatio:void 0,width:void 0,height:void 0,bandwidth:void 0,roles:h?h.split(","):[],forced:u,channelsCount:a,audioSamplingRate:null,spatialAudio:l,closedCaptions:o,hdr:void 0,tilesLayout:void 0}}function rp(e,t){var i=[];if(e.segments)for(var r=(e=l(e.segments)).next();!r.done;r=e.next())r=Ad(r.value.g,"EXT-X-KEY"),i.push.apply(i,c(r));r=e=!1;for(var n=[],s=new Set,a=(i=l(i)).next();!a.done;a=i.next()){var o=wd(a=a.value,"METHOD");if("NONE"!=o)if(e=!0,"AES-128"==o)r=!0;else if(o=bd(a,"KEYFORMAT")||"identity",a=(o=wp[o])?o(a,t):null){if(a.keyIds)for(var h=(o=l(a.keyIds)).next();!h.done;h=o.next())s.add(h.value);n.push(a)}}return{drmInfos:n,keyIds:s,encrypted:e,kf:r}}function np(t,i,r){if(!e.crypto||!e.crypto.subtle)throw q("Web Crypto API is not available to decrypt AES-128. (Web Crypto only exists in secure origins like https)"),new Me(2,4,4042);var n=0,s=bd(i,"IV","");if(s){var a=Mt(s.substr(2));if(16!=a.byteLength)throw new Me(2,4,4043)}else n=Id(r.g,"EXT-X-MEDIA-SEQUENCE");var o=Er([i=Rd(r.h,wd(i,"URI"))],t.g.retryParameters),h={method:"AES-128",iv:a,firstMediaSequenceNumber:n,fetchKey:function(){var i,r,n;return P((function(s){if(1==s.g)return b(s,_p(t,o,6),2);if(3!=s.g){if(!(i=s.h).data||16!=i.data.byteLength)throw new Me(2,4,4044);return r={name:"AES-CBC"},n=h,b(s,e.crypto.subtle.importKey("raw",i.data,r,!0,["decrypt"]),3)}n.cryptoKey=s.h,h.fetchKey=void 0,w(s)}))}};return h}function sp(e,t){var i=Ed(t.g,"EXT-X-PLAYLIST-TYPE"),r=Ed(t.g,"EXT-X-ENDLIST");if(r=i&&"VOD"==i.value||r,i=i&&"EVENT"==i.value&&!r,i=!r&&!i,r)mp(e,Tp);else{if(mp(e,i?Ap:Sp),!(r=Ed(t.g,"EXT-X-TARGETDURATION")))throw new Me(2,4,4024,"EXT-X-TARGETDURATION");r=Number(r.value),i=Ed(t.g,"EXT-X-PART-INF"),e.l&&i?(e.da=Number(wd(i,"PART-TARGET")),e.J=Math.min(e.da,e.J),t=Ed(t.g,"EXT-X-SERVER-CONTROL"),e.V=t?Number(wd(t,"PART-HOLD-BACK")):0):e.J=Math.min(r,e.J),e.ca=Math.max(r,e.ca)}}function ap(e){var t=e.g.defaultPresentationDelay?e.g.defaultPresentationDelay:e.V?e.V:e.ca*e.g.hls.liveSegmentsDelay;e.j.Xe(0),e.j.We(t),e.j.yc(!1)}function op(e,t,i,r){return(i=Ed(i,"EXT-X-MAP"))?(t=[r=cp(Rd(t,wd(i,"URI")),r),bd(i,"BYTERANGE","")].join("-"),e.ba.has(t)||(i=function(e,t){var i=0,r=null;(t=bd(t,"BYTERANGE"))&&(i=t.split("@"),r=Number(i[0]),i=Number(i[1]),r=i+r-1);return new fa((function(){return[e]}),i,r)}(r,i),e.ba.set(t,i)),e.ba.get(t)):null}function hp(e,t,i,r,n,s,a,o,h){var u=r.g,c=cp(r.i,s),d=Ed(u,"EXTINF"),p=s=0,g=null;r.h.length&&!e.l&&q("Low-latency HLS live stream detected, but low-latency streaming mode is not enabled in Shaka Player. Set streaming.lowLatencyMode configuration to true, and see https://bit.ly/3clctcj for details.");var f=null;if(!e.g.hls.ignoreManifestProgramDateTime){var m=Ed(u,"EXT-X-PROGRAM-DATE-TIME");m&&m.value&&(f=gn(m.value))}if(m=_a,Ed(u,"EXT-X-GAP")&&(m=2),!d){if(0==r.h.length)throw new Me(2,4,4024,"EXTINF");if(!e.l)return null}var _=[];if(e.l)for(var v={},y=0;y<r.h.length;v={pd:v.pd},y++){var x=r.h[y],b=0==y?i:_[_.length-1],w=0==y?n:b.endTime,T=Number(bd(x,"DURATION"))||e.da;if(T){T=w+T;var S=0,A=null;"EXT-X-PRELOAD-HINT"==x.name?S=(S=bd(x,"BYTERANGE-START"))?Number(S):0:(S=(A=l(up(b,S=bd(x,"BYTERANGE")))).next().value,A=A.next().value),(b=bd(x,"URI"))&&(v.pd=Rd(a,b),b=_a,"YES"==bd(x,"GAP")&&(b=2),_.push(new ma(w,T,function(e){return function(){return[e.pd]}}(v),S,A,t,0,0,1/0,[],"",null,null,b)))}}return s=d?n+Number(d.value.split(",")[0]):_[_.length-1].endTime,(e=Ed(u,"EXT-X-BYTERANGE"))?(p=(g=l(up(i,e.value))).next().value,g=g.next().value):_.length&&(p=_[0].Ba,g=_[_.length-1].ka),i="",e=null,"image"==o&&(i="1x1",o=Ed(u,"EXT-X-TILES"))&&(i=wd(o,"LAYOUT"),(o=bd(o,"DURATION"))&&(e=Number(o))),new ma(n,s,(function(){return c.length?[c]:[]}),p,g,t,0,0,1/0,_,i,e,f,m,h)}function up(e,t){var i=0,r=null;return t&&(i=t.split("@"),t=Number(i[0]),r=(i=i[1]?Number(i[1]):e.ka+1)+t-1),[i,r]}function lp(e,t,i,r,n){var s=t.segments,a=void 0,o=Id(t.g,"EXT-X-DISCONTINUITY-SEQUENCE"),h=Id(t.g,"EXT-X-MEDIA-SEQUENCE"),u=Ed(t.g,"EXT-X-SKIP"),c=h+(u=u?Number(bd(u,"SKIPPED-SEGMENTS")):0),d=0;fp(e)&&r.has(c)&&(d=r.get(c));for(var p=[],g=null,f=0;f<s.length;f++){var m=s[f],_=0==f?d:g.endTime;c=h+u+f,Ed(m.g,"EXT-X-DISCONTINUITY")&&o++;for(var v=l(m.g),y=v.next();!y.done;y=v.next())"EXT-X-KEY"==(y=y.value).name&&(a="AES-128"==wd(y,"METHOD")?np(e,y,t):void 0);r.set(c,_),v=op(e,t.h,m.g,n),!e.l&&e.i.isAutoLowLatencyMode()&&(e.i.enableLowLatencyMode(),e.l=e.i.isLowLatencyMode()),(g=m=hp(e,v,g,m,_,n,t.h,i,a))&&(m.m=o,e.g.hls.ignoreManifestProgramDateTime&&null!=e.B&&c<e.B||p.push(m))}if(t=p.some((function(e){return null!=e.g})))for(i={},r=0;r<p.length;i={Qb:i.Qb,Pb:i.Pb,Bc:i.Bc,Ta:i.Ta,Ob:i.Ob},r++)if(i.Ta=p[r],null==i.Ta.g)for(i.Pb=0,i.Qb=r,n=function(e){return function(){var t=p[e.Qb];if(t){if(null!=t.g)return t.g+e.Pb;e.Pb-=t.endTime-t.startTime,e.Qb+=1}return null}}(i),i.Ob=0,i.Bc=r,s=function(e){return function(){var t=p[e.Bc];if(t){if(t!=e.Ta&&(e.Ob+=t.endTime-t.startTime),null!=t.g)return t.g+e.Ob;--e.Bc}return null}}(i);null==i.Ta.g;)i.Ta.g=s(),null==i.Ta.g&&(i.Ta.g=n());if(t)for(r=(i=l(p)).next();!r.done;r=i.next())for(r=(n=r.value).g,s=(n=l(n.i)).next();!s.done;s=n.next())(s=s.value).g=r,r+=s.endTime-s.startTime;if(e=e.H,t&&1/0!=e)for(r=(t=l(p)).next();!r.done;r=t.next())r.value.oe(e);return p}function cp(e,t){var i=(e=String(e).replace(/%7B/g,"{").replace(/%7D/g,"}")).match(/{\$\w*}/g);if(i)for(var r=(i=l(i)).next();!r.done;r=i.next()){var n=(r=r.value).slice(2,r.length-1),s=t.get(n);if(!s)throw new Me(2,4,4039,n);e=e.replace(r,s)}return e}function dp(e,t){if(e==tt){if("vtt"==t||"wvtt"==t)return"text/vtt";if(t&&""!==t)return"application/mp4"}return"image"!=e||t&&"jpeg"!=t?"audio"==e&&"mp4a.40.34"==t?"audio/mpeg":null:"image/jpeg"}function pp(e){return e==tt?"text/vtt":bp[e].mp4}function gp(e,t){return t=Er([t],e.g.retryParameters),e.i.modifyManifestRequest(t,{format:"h"}),_p(e,t,0)}function fp(e){return e.ea!=Tp}function mp(e,t){e.ea=t,e.j&&e.j.yc(!fp(e)),fp(e)||e.m.stop()}function _p(e,t,i){if(!e.G)throw new Me(2,7,7001);return t=e.i.networkingEngine.request(i,t),Sr(e.G,t),t.promise}j("shaka.net.DataUriPlugin",zd),zd.parse=Bd,Cr("data",Bd),(n=Hd.prototype).configure=function(e){this.g=e},n.start=function(e,t){var i,r=this;return P((function(n){return 1==n.g?(r.i=t,r.l=t.isLowLatencyMode(),b(n,gp(r,e),2)):3!=n.g?(i=n.h,r.M=i.uri,b(n,function(e,t,i){var r,n,s,a,o,h,u,c,d,p,g,f,m,_,v,y,x,S,A,E,I,R,L,k,M,O,D,N,F,U,z;return P((function(B){switch(B.g){case 1:r=Dd(e.W,t,e.M);for(var j=l(Ad(r.g,"EXT-X-DEFINE")),H=j.next();!H.done;H=j.next()){var V=H.value;H=bd(V,"NAME"),V=bd(V,"VALUE"),H&&V&&(e.o.has(H)||e.o.set(H,V))}if(n=[],s=[],a=[],1==r.type)return A=e.g.hls.mediaPlaylistFullMimeType,r.segments.length&&(E=new Oe(r.segments[0].i),I=E.qa.split(".").pop(),(R=vp[I])?A=R:"ts"!==I&&"mp4"!==I&&(yp[I]?(R=yp[I],L=e.g.hls.defaultAudioCodec,A=R+'; codecs="'+L+'"'):xp[I]&&(R=xp[I],k=e.g.hls.defaultVideoCodec,A=R+'; codecs="'+k+'"'))),M=A.split(";")[0],O=M.split("/")[0],D=qt(A),N=new Map,b(B,tp(e,r,i,i,D,O,"",!0,"Media Playlist",null,N,null,!1,!1,M),5);for(o=Ad(r.g,"EXT-X-MEDIA"),h=Ad(r.g,"EXT-X-STREAM-INF"),u=Ad(r.g,"EXT-X-IMAGE-STREAM-INF"),c=Ad(r.g,"EXT-X-SESSION-KEY"),H=(j=l(h)).next();!H.done;H=j.next()){var W=H.value;V=bd(W,"AUDIO"),H=bd(W,"VIDEO");var G=bd(W,"SUBTITLES");if(W=Yd(e,W),G){var X=et(tt,W);e.s.set(G,X),ie(W,X)}V&&((G=et("audio",W))||(G=e.g.hls.defaultAudioCodec),e.s.set(V,G)),H&&((V=et("video",W))||(V=e.g.hls.defaultVideoCodec),e.s.set(H,V))}for(d=Ad(r.g,"EXT-X-SESSION-DATA"),p=l(d),g=p.next();!g.done;g=p.next())f=g.value,m=bd(f,"DATA-ID"),_=bd(f,"URI"),v=bd(f,"LANGUAGE"),y=bd(f,"VALUE"),x=(new Map).set("id",m),_&&x.set("uri",Rd(e.M,_)),v&&x.set("language",v),y&&x.set("value",y),S=new _r("sessiondata",x),e.i&&e.i.onEvent(S);for(function(e,t){t=t.filter((function(e){var t=bd(e,"URI")||"";return"SUBTITLES"!=bd(e,"TYPE")&&""!=t}));for(var i=(t=l(t)).next();!i.done;i=t.next())Kd(e,i.value)}(e,o),H=(j=l(j=Cd(o,"CLOSED-CAPTIONS"))).next();!H.done;H=j.next())H=$d(G=H.value),V=wd(G,"GROUP-ID"),G=wd(G,"INSTREAM-ID"),e.L.get(V)||e.L.set(V,new Map),e.L.get(V).set(G,H);return n=function(e,t,i){var r=[],n=new Set;if(0<i.length)for(var s=(i=l(i)).next();!s.done;s=i.next()){var a=wd(s=s.value,"METHOD");if("NONE"!=a&&"AES-128"!=a&&(a=bd(s,"KEYFORMAT")||"identity",s=(a=wp[a])?a(s,""):null)){if(s.keyIds)for(var o=(a=l(s.keyIds)).next();!o.done;o=a.next())n.add(o.value);r.push(s)}}return t=t.map((function(t){var i=bd(t,"FRAME-RATE"),s=Number(bd(t,"AVERAGE-BANDWIDTH"))||Number(wd(t,"BANDWIDTH")),a=bd(t,"RESOLUTION"),o=(a=l(a?a.split("x"):[null,null])).next().value,h=a.next().value,u=bd(t,"VIDEO-RANGE");t=function(e,t){var i=Yd(e,t),r=bd(t,"AUDIO"),n=bd(t,"VIDEO"),s=r||n;s=s&&e.u.has(s)?e.u.get(s):[],r={audio:r?s:[],video:n?s:[]},n=!1;var a=wd(t,"URI"),o=r.audio.find((function(e){return e&&e.Ac==a})),h=et("video",i),u=et("audio",i);return u&&!h?s="audio":!s.length&&u&&h?(s="video",i=[[h,u].join()]):r.audio.length&&o?(s="audio",n=!0):s=r.video.length&&!r.audio.length?"audio":"video",n||(e=function(e,t,i,r){var n=cp(wd(t,"URI"),e.o);return e.h.has(n)?e.h.get(n):(t=bd(t,"CLOSED-CAPTIONS"),t="video"==r&&t&&"NONE"!=t?e.L.get(t):null,i=Je(r,i),r=Zd(e,n,i,r,"und",!1,null,null,t,null,!1,!1),e.h.has(n)?e.h.get(n):(e.h.set(n,r),r))}(e,t,i,s),r[e.stream.type]=[e]),r}(e,t),a=t.audio;for(var c=l(t=t.video),d=c.next();!d.done;d=c.next())(d=d.value.stream)&&(d.width=Number(o)||void 0,d.height=Number(h)||void 0,d.frameRate=Number(i)||void 0,d.hdr=u||void 0);for(i=e.g.disableAudio,a.length&&!i||(a=[null]),i=e.g.disableVideo,t.length&&!i||(t=[null]),i=[],o=(a=l(a)).next();!o.done;o=a.next())for(o=o.value,u=(h=l(t)).next();!u.done;u=h.next()){var p=u.value;(u=o?o.stream:null)&&(u.drmInfos=r,u.keyIds=n),(c=p?p.stream:null)&&(c.drmInfos=r,c.keyIds=n),d=o?o.stream.drmInfos:null;var g=p?p.stream.drmInfos:null;p=(p?p.Ac:"")+" - "+(o?o.Ac:""),u&&c&&d.length&&g.length&&!(0<zn(d,g).length)||e.ua.has(p)||(u={id:e.Fa++,language:u?u.language:"und",primary:!!u&&u.primary||!!c&&c.primary,audio:u,video:c,bandwidth:s,allowedByApplication:!0,allowedByKeySystem:!0,decodingInfos:[]},i.push(u),e.ua.add(p))}return i})).reduce(Ye,[]),t=t.filter((function(e){return null!=e}))}(e,h,c),s=function(e,t){var i=Cd(t,"SUBTITLES");t=i.map((function(t){if(e.g.disableText)return null;try{return Kd(e,t).stream}catch(a){if(e.g.hls.ignoreTextStreamFailures)return null;throw a}}));for(var r=(i=l(i)).next();!r.done;r=i.next()){var n=wd(r.value,"GROUP-ID");if((r=e.s.get(n))&&(n=e.u.get(n)))for(var s=(n=l(n)).next();!s.done;s=n.next())(s=s.value).stream.codecs=r,s.stream.mimeType=dp(tt,r)||pp(tt)}return t.filter((function(e){return e}))}(e,o),b(B,function(e,t){var i,r;return P((function(n){return 1==n.g?(i=t.map((function(t){var i,r;return P((function(n){if(1==n.g)return e.g.disableThumbnails?n.return(null):(T(n,2),b(n,function(e,t){var i,r,n,s,a,o,h,u,l,c;return P((function(d){return 1==d.g?(i=cp(wd(t,"URI"),e.o),r=bd(t,"CODECS","jpeg")||"",e.h.has(i)?d.return(e.h.get(i)):(n=$d(t),s=bd(t,"NAME"),a=bd(t,"CHARACTERISTICS"),o=Zd(e,i,r,"image",n,!1,s,null,null,a,!1,!1),e.h.has(i)?d.return(e.h.get(i)):(h=bd(t,"RESOLUTION"))?b(d,o.stream.createSegmentIndex(),3):d.A(2))):(2!=d.g&&(u=o.stream.segmentIndex.get(0),l=u.tilesLayout)&&(o.stream.width=Number(h.split("x")[0])*Number(l.split("x")[0]),o.stream.height=Number(h.split("x")[1])*Number(l.split("x")[1])),(c=bd(t,"BANDWIDTH"))&&(o.stream.bandwidth=Number(c)),e.h.set(i,o),d.return(o))}))}(e,t),4));if(2!=n.g)return i=n.h,n.return(i.stream);if(r=C(n),e.g.hls.ignoreImageStreamFailures)return n.return(null);throw r}))})),b(n,Promise.all(i),2)):(r=n.h,n.return(r.filter((function(e){return e}))))}))}(e,u),4);case 4:a=B.h,B.A(3);break;case 5:F=B.h,e.h.set(i,F),n.push({id:0,language:"und",disabledUntilTime:0,primary:!0,audio:"audio"==O?F.stream:null,video:"video"==O?F.stream:null,bandwidth:0,allowedByApplication:!0,allowedByKeySystem:!0,decodingInfos:[]});case 3:if(!e.i)throw new Me(2,7,7001);e.j=new io(null,0),e.j.yc(!0),1==r.type&&(fp(e)&&(ap(e),U=e.O,e.m.N(U)),z=Array.from(e.h.values()),ep(e,z),Xd(e)),e.D={presentationTimeline:e.j,variants:n,textStreams:s,imageStreams:a,offlineSessionIds:[],minBufferTime:0,sequenceMode:!0},e.i.makeTextStreamsForClosedCaptions(e.D),w(B)}}))}(r,i.data,e),3)):n.return(r.D)}))},n.stop=function(){this.m&&(this.m.stop(),this.m=null);var e=[];return this.G&&(e.push(this.G.destroy()),this.G=null),this.g=this.i=null,this.ua.clear(),this.D=null,this.h.clear(),this.u.clear(),this.s.clear(),this.o.clear(),Promise.all(e)},n.update=function(){var e,t,i,r,n,s,a,o,h=this;return P((function(u){if(1==u.g){if(!fp(h))return u.return();for(e=[],t=Array.from(h.h.values()),i=t.filter((function(e){return e.stream.segmentIndex})),r=l(i),n=r.next();!n.done;n=r.next())s=n.value,e.push(Wd(h,s));return b(u,Promise.all(e),2)}Jd(h,i.map((function(e){return e.stream}))),a=i.some((function(e){return 0==e.mc})),i.length&&!a&&(mp(h,Cp.ff),o=i.map((function(e){return e.Ya})),h.j.Aa(Math.min.apply(Math,c(o))),h.i.updateDuration()),w(u)}))},n.onExpirationUpdated=function(){},j("shaka.hls.HlsParser",Hd);var vp={aac:"audio/aac",ac3:"audio/ac3",ec3:"audio/ec3",mp3:"audio/mpeg"},yp={mp4:"audio/mp4",mp4a:"audio/mp4",m4s:"audio/mp4",m4i:"audio/mp4",m4a:"audio/mp4",m4f:"audio/mp4",cmfa:"audio/mp4",ts:"video/mp2t",tsa:"video/mp2t"},xp={mp4:"video/mp4",mp4v:"video/mp4",m4s:"video/mp4",m4i:"video/mp4",m4v:"video/mp4",m4f:"video/mp4",cmfv:"video/mp4",ts:"video/mp2t",tsv:"video/mp2t"},bp={audio:yp,video:xp,text:{mp4:"application/mp4",m4s:"application/mp4",m4i:"application/mp4",m4f:"application/mp4",cmft:"application/mp4",vtt:"text/vtt",webvtt:"text/vtt",ttml:"application/ttml+xml"},image:{jpg:"image/jpeg",png:"image/png",svg:"image/svg+xml",webp:"image/webp",avif:"image/avif"}},wp={"com.apple.streamingkeydelivery":function(t,i){if("video/mp2t"==i)throw new Me(2,4,4040);if(e.shakaMediaKeysPolyfill)throw new Me(2,4,4041);return Qe("com.apple.fps",[{initDataType:"sinf",initData:new Uint8Array(0),keyId:null}])},"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":function(e){var t=wd(e,"METHOD");return["SAMPLE-AES","SAMPLE-AES-CTR"].includes(t)?(t=Qe("com.widevine.alpha",[{initDataType:"cenc",initData:t=Re((t=jd(t=wd(e,"URI"))).data)}]),(e=bd(e,"KEYID"))&&(t.keyIds=new Set([e.toLowerCase().substr(2)])),t):null},"com.microsoft.playready":function(e){var t=wd(e,"METHOD");return["SAMPLE-AES","SAMPLE-AES-CTR"].includes(t)?Qe("com.microsoft.playready",[{initDataType:"cenc",initData:e=nn(e=Re((e=jd(e=wd(e,"URI"))).data),t=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]),new Set,0)}]):null},identity:function(e){return e=wd(e,"METHOD"),["SAMPLE-AES","SAMPLE-AES-CTR"].includes(e)?Qe("org.w3.clearkey",null):null}},Tp="VOD",Sp="EVENT",Ap="LIVE",Cp={ff:Tp,Og:Sp,Sg:Ap};function Ep(e,t,i,r,n,s){if(200<=i&&299>=i&&202!=i)return{uri:n||r,Oe:r,data:t,status:i,headers:e,fromCache:!!e["x-shaka-from-cache"]};n=null;try{n=St(t)}catch(a){}throw new Me(401==i||403==i?2:1,1,1001,r,i,n,e,s)}function Ip(){}function Rp(e,t,i,r,n){var s=new Dp;Br(t.headers).forEach((function(e,t){s.append(t,e)}));var a=new Pp,o={ye:!1,bf:!1};if(e=function(e,t,i,r,n,s,a){var o,h,u,l,c,d,p,g,f,m,_,v;return P((function(y){switch(y.g){case 1:return o=Mp,h=Op,d=c=0,p=Date.now(),T(y,2),b(y,o(e,i),4);case 4:return u=y.h,s(Lp(u.headers)),g=u.clone().body.getReader(),m=(f=u.headers.get("Content-Length"))?parseInt(f,10):0,new h({start:function(e){function t(){var i,r;return P((function(s){switch(s.g){case 1:return T(s,2),b(s,g.read(),4);case 4:i=s.h,A(s,3);break;case 2:return C(s),s.return();case 3:if(i.done){s.A(5);break}if(c+=i.value.byteLength,!a){s.A(5);break}return b(s,a(i.value),5);case 5:(100<(r=Date.now())-p||i.done)&&(n(r-p,c-d,m-c),d=c,p=r),i.done?e.close():(e.enqueue(i.value),t()),w(s)}}))}t()}}),b(y,u.arrayBuffer(),5);case 5:l=y.h,A(y,3);break;case 2:if(_=C(y),r.ye)throw new Me(1,1,7001,e,t);if(r.bf)throw new Me(1,1,1003,e,t);throw new Me(1,1,1002,e,_,t);case 3:return v=Lp(u.headers),y.return(Ep(v,l,u.status,e,u.url,t))}}))}(e,i,{body:t.body||void 0,headers:s,method:t.method,signal:a.signal,credentials:t.allowCrossSiteCredentials?"include":void 0},o,r,n,t.streamDataCallback),e=new cr(e,(function(){return o.ye=!0,a.abort(),Promise.resolve()})),t=t.retryParameters.timeout){var h=new ot((function(){o.bf=!0,a.abort()}));h.N(t/1e3),e.finally((function(){h.stop()}))}return e}function Lp(e){var t={};return e.forEach((function(e,i){t[i.trim()]=e})),t}function kp(){if(!e.ReadableStream)return!1;try{new ReadableStream({})}catch(W_){return!1}return!(!e.fetch||!e.AbortController)}_t("Tizen 3")||_t("Tizen 2")||pt()||(Jn.m3u8=function(){return new Hd},Qn["application/x-mpegurl"]=function(){return new Hd},Qn["application/vnd.apple.mpegurl"]=function(){return new Hd}),j("shaka.net.HttpFetchPlugin",Ip),Ip.isSupported=kp,Ip.parse=Rp;var Mp=e.fetch,Pp=e.AbortController,Op=e.ReadableStream,Dp=e.Headers;function Np(){}function Fp(e,t,i,r,n){var s=new zp,a=Date.now(),o=0;return new cr(new Promise((function(h,u){s.open(t.method,e,!0),s.responseType="arraybuffer",s.timeout=t.retryParameters.timeout,s.withCredentials=t.allowCrossSiteCredentials,s.onabort=function(){u(new Me(1,1,7001,e,i))};var l=!1;for(var c in s.onreadystatechange=function(){if(2==s.readyState&&!l){var e=Up(s);n(e),l=!0}},s.onload=function(){var t=Up(s),r=s.response;try{var n=Ep(t,r,s.status,e,s.responseURL,i);h(n)}catch(a){u(a)}},s.onerror=function(t){u(new Me(1,1,1002,e,t,i))},s.ontimeout=function(){u(new Me(1,1,1003,e,i))},s.onprogress=function(e){var t=Date.now();(100<t-a||e.lengthComputable&&e.loaded==e.total)&&(r(t-a,e.loaded-o,e.total-e.loaded),o=e.loaded,a=t)},t.headers)s.setRequestHeader(c.toLowerCase(),t.headers[c]);s.send(t.body)})),(function(){return s.abort(),Promise.resolve()}))}function Up(e){var t=e.getAllResponseHeaders().trim().split("\r\n");e={};for(var i=(t=l(t)).next();!i.done;i=t.next())e[(i=i.value.split(": "))[0].toLowerCase()]=i.slice(1).join(": ");return e}kp()&&(Cr("http",Rp,2,!0),Cr("https",Rp,2,!0),Cr("blob",Rp,2,!0)),j("shaka.net.HttpXHRPlugin",Np),Np.parse=Fp;var zp=e.XMLHttpRequest;function Bp(e,t,i,r){this.g=e,this.i=t,this.groupId=i,this.h=r}function jp(e){return e.ya().map((function(e){return"{"+encodeURI(e)+"}"})).join("")+":"+e.Ba+":"+e.ka}function Hp(e,t){return zo(e.g.ya(),e.g.Ba,e.g.ka,t.streaming.retryParameters)}function Vp(){this.h=this.j=this.i=0,this.g=new Map,this.l=0}function Wp(e,t){e.i+=t;var i=e.l;return e.l++,e.g.set(i,t),i}function Gp(e){var t=this;this.o=e,this.j=new Map,this.i=new Or((function(){return Xp(t).catch((function(){}))})),this.h=[],this.m=function(){},this.l=function(){},this.g=new Vp}function Xp(e){var t=e.h.map((function(e){return e()}));return e.h=[],Promise.all(t)}function qp(e,t,i,r,n,s){Dr(e.i);var a=(e.j.get(t)||Promise.resolve()).then((function(){var t,a,o,h,u,l,c;return P((function(d){if(1==d.g)return b(d,function(e,t){var i,r,n,s;return P((function(a){return 1==a.g?(i=kr,r=e.o.request(i,t),n=function(){return r.abort()},e.h.push(n),b(a,r.promise,2)):(s=a.h,ie(e.h,n),a.return(s.data))}))}(e,i),2);if(t=d.h,e.i.g)throw new Me(2,9,7001);if(n)for(h in a=Re(t),(o=new rn(a)).data)u=Number(h),l=o.data[u],c=o.g[u],e.l(l,c);e.g.close(r,t.byteLength);var p=e.g;return e.m(0==p.i?0:p.j/p.i,e.g.h),d.return(s(t))}))}));e.j.set(t,a)}function Yp(e,t){var i=this;this.i=e,this.h=e.objectStore(t),this.g=new nt,e.onabort=function(e){e.preventDefault(),i.g.reject()},e.onerror=function(e){e.preventDefault(),i.g.reject()},e.oncomplete=function(){i.g.resolve()}}function $p(e,t){return new Promise((function(i,r){var n=e.h.openCursor();n.onerror=r,n.onsuccess=function(){var e;return P((function(r){if(1==r.g)return null==n.result?(i(),r.return()):(e=n.result,b(r,t(e.key,e.value,e),2));e.continue(),w(r)}))}}))}function Kp(e){this.h=e,this.g=[]}function Zp(e,t){return Qp(e,t,"readwrite")}function Qp(e,t,i){var r=new Yp(i=e.h.transaction([t],i),t);return e.g.push(r),r.promise().then((function(){ie(e.g,r)}),(function(){ie(e.g,r)})),r}function Jp(e,t,i){this.h=new Kp(e),this.i=t,this.g=i}function eg(e){return Promise.reject(new Me(2,9,9011,"Cannot add new value to "+e))}function tg(e,t,i,r){t=(e=Zp(e.h,t)).store();for(var n={},s=(i=l(i)).next();!s.done;n={Ec:n.Ec},s=i.next())n.Ec=s.value,t.delete(n.Ec).onsuccess=function(e){return function(){return r(e.Ec)}}(n);return e.promise()}function ig(e,t,i){var r,n,s,a,o,h,u;return P((function(c){if(1==c.g){for(r=Qp(e.h,t,"readonly"),n=r.store(),s={},a=[],o={},h=l(i),u=h.next();!u.done;o={Vb:o.Vb,Tb:o.Tb},u=h.next())o.Tb=u.value,o.Vb=n.get(o.Tb),o.Vb.onsuccess=function(e){return function(){null==e.Vb.result&&a.push(e.Tb),s[e.Tb]=e.Vb.result}}(o);return b(c,r.promise(),2)}if(a.length)throw new Me(2,9,9012,"Could not find values for "+a);return c.return(i.map((function(e){return s[e]})))}))}function rg(e){this.g=new Kp(e)}function ng(){this.g=new Map}function sg(e){var t=null;if(e.g.forEach((function(e,i){e.getCells().forEach((function(e,r){e.hasFixedKeySpace()||t||(t={path:{za:i,ja:r},ja:e})}))})),t)return t;throw new Me(2,9,9013,"Could not find a cell that supports add-operations")}function ag(e,t,i){if(!(e=e.g.get(t)))throw new Me(2,9,9013,"Could not find mechanism with name "+t);if(!(t=e.getCells().get(i)))throw new Me(2,9,9013,"Could not find cell with name "+i);return t}function og(e,t){hg.set(e,t)}Cr("http",Fp,1,!0),Cr("https",Fp,1,!0),Cr("blob",Fp,1,!0),Vp.prototype.close=function(e,t){if(this.g.has(e)){var i=this.g.get(e);this.g.delete(e),this.j+=i,this.h+=t}},Gp.prototype.destroy=function(){return this.i.destroy()},Yp.prototype.abort=function(){var e=this;return P((function(t){if(1==t.g){try{e.i.abort()}catch(i){}return T(t,2),b(t,e.g,4)}if(2!=t.g)return A(t,0);C(t),w(t)}))},Yp.prototype.store=function(){return this.h},Yp.prototype.promise=function(){return this.g},Kp.prototype.destroy=function(){return Promise.all(this.g.map((function(e){return e.abort()})))},(n=Jp.prototype).destroy=function(){return this.h.destroy()},n.hasFixedKeySpace=function(){return!0},n.addSegments=function(){return eg(this.i)},n.removeSegments=function(e,t){return tg(this,this.i,e,t)},n.getSegments=function(e){var t,i=this;return P((function(r){return 1==r.g?b(r,ig(i,i.i,e),2):(t=r.h,r.return(t.map((function(e){return i.ze(e)}))))}))},n.addManifests=function(){return eg(this.g)},n.updateManifest=function(){return Promise.reject(new Me(2,9,9016,"Cannot modify values in "+this.g))},n.updateManifestExpiration=function(e,t){var i=Zp(this.h,this.g),r=i.store();return r.get(e).onsuccess=function(i){(i=i.target.result)&&(i.expiration=t,r.put(i,e))},i.promise()},n.removeManifests=function(e,t){return tg(this,this.g,e,t)},n.getManifests=function(e){var t,i=this;return P((function(r){return 1==r.g?b(r,ig(i,i.g,e),2):(t=r.h,r.return(Promise.all(t.map((function(e){return i.bc(e)})))))}))},n.getAllManifests=function(){var e,t,i=this;return P((function(r){return 1==r.g?(e=Qp(i.h,i.g,"readonly"),t=new Map,b(r,$p(e,(function(e,r){var n;return P((function(s){if(1==s.g)return b(s,i.bc(r),2);n=s.h,t.set(e,n),w(s)}))})),2)):3!=r.g?b(r,e.promise(),3):r.return(t)}))},n.ze=function(e){return e},n.bc=function(e){return Promise.resolve(e)},n.add=function(e,t){var i,r,n,s,a,o,h,u=this;return P((function(c){if(1==c.g){for(i=Zp(u.h,e),r=i.store(),n=[],s={},a=l(t),o=a.next();!o.done;s={Fc:s.Fc},o=a.next())h=o.value,s.Fc=r.add(h),s.Fc.onsuccess=function(e){return function(){n.push(e.Fc.result)}}(s);return b(c,i.promise(),2)}return c.return(n)}))},rg.prototype.destroy=function(){return this.g.destroy()},rg.prototype.getAll=function(){var e,t,i=this;return P((function(r){return 1==r.g?(e=Qp(i.g,"session-ids","readonly"),t=[],b(r,$p(e,(function(e,i){t.push(i)})),2)):3!=r.g?b(r,e.promise(),3):r.return(t)}))},rg.prototype.add=function(e){for(var t=Zp(this.g,"session-ids"),i=t.store(),r=(e=l(e)).next();!r.done;r=e.next())i.add(r.value);return t.promise()},rg.prototype.remove=function(e){var t,i=this;return P((function(r){return 1==r.g?b(r,$p(t=Zp(i.g,"session-ids"),(function(t,i,r){e.includes(i.sessionId)&&r.delete()})),2):b(r,t.promise(),0)}))},ng.prototype.destroy=function(){for(var e=[],t=l(this.g.values()),i=t.next();!i.done;i=t.next())e.push(i.value.destroy());return this.g.clear(),Promise.all(e)},ng.prototype.init=function(){var e=this;hg.forEach((function(t,i){(t=t())&&e.g.set(i,t)}));for(var t=[],i=l(this.g.values()),r=i.next();!r.done;r=i.next())t.push(r.value.init());return Promise.all(t)},j("shaka.offline.StorageMuxer",ng),ng.unregister=function(e){hg.delete(e)},ng.register=og,ng.prototype.destroy=ng.prototype.destroy;var hg=new Map;function ug(){Jp.apply(this,arguments)}function lg(e,t){!function(e){var t=e.streams.filter((function(e){return"audio"==e.contentType}));if(e=e.streams.filter((function(e){return"video"==e.contentType})),!t.every((function(e){return e.variantIds}))||!e.every((function(e){return e.variantIds}))){for(var i=l(t),r=i.next();!r.done;r=i.next())r.value.variantIds=[];for(r=(i=l(e)).next();!r.done;r=i.next())r.value.variantIds=[];if(i=0,e.length&&!t.length){var n=i++,s=l(e);for(r=s.next();!r.done;r=s.next())r.value.variantIds.push(n)}if(!e.length&&t.length)for(n=i++,r=(s=l(t)).next();!r.done;r=s.next())r.value.variantIds.push(n);if(e.length&&t.length)for(r=(t=l(t)).next();!r.done;r=t.next())for(r=r.value,s=(n=l(e)).next();!s.done;s=n.next()){s=s.value;var a=i++;r.variantIds.push(a),s.variantIds.push(a)}}}(e);for(var i=l(e.streams),r=i.next();!r.done;r=i.next());return e.streams.map((function(i){return function(e,t,i){var r=e.initSegmentUri?cg(e.initSegmentUri):null,n=t+e.presentationTimeOffset,s=t+i;return{id:e.id,originalId:null,primary:e.primary,type:e.contentType,mimeType:e.mimeType,codecs:e.codecs,frameRate:e.frameRate,pixelAspectRatio:void 0,hdr:void 0,kind:e.kind,language:e.language,label:e.label,width:e.width,height:e.height,initSegmentKey:r,encrypted:e.encrypted,keyIds:new Set([e.keyId]),segments:e.segments.map((function(e){var i=cg(e.uri);return{startTime:t+e.startTime,endTime:t+e.endTime,dataKey:i,initSegmentKey:r,appendWindowStart:t,appendWindowEnd:s,timestampOffset:n,tilesLayout:""}})),variantIds:e.variantIds,roles:[],forced:!1,audioSamplingRate:null,channelsCount:null,spatialAudio:!1,closedCaptions:null,tilesLayout:void 0}}(i,e.startTime,t)}))}function cg(e){var t;if((t=/^offline:[0-9]+\/[0-9]+\/([0-9]+)$/.exec(e))||(t=/^offline:segment\/([0-9]+)$/.exec(e)))return Number(t[1]);throw new Me(2,9,9004,"Could not parse uri "+e)}function dg(){Jp.apply(this,arguments)}function pg(e,t,i){return{id:e.id,originalId:e.originalId,primary:e.primary,type:e.contentType,mimeType:e.mimeType,codecs:e.codecs,frameRate:e.frameRate,pixelAspectRatio:e.pixelAspectRatio,hdr:void 0,kind:e.kind,language:e.language,label:e.label,width:e.width,height:e.height,encrypted:e.encrypted,keyIds:new Set([e.keyId]),segments:e.segments.map((function(r){return{startTime:t+r.startTime,endTime:t+r.endTime,initSegmentKey:e.initSegmentKey,appendWindowStart:t,appendWindowEnd:i,timestampOffset:t-e.presentationTimeOffset,dataKey:r.dataKey,tilesLayout:""}})),variantIds:e.variantIds,roles:[],forced:!1,audioSamplingRate:null,channelsCount:null,spatialAudio:!1,closedCaptions:null,tilesLayout:void 0}}function gg(){Jp.apply(this,arguments)}function fg(){this.m=this.j=this.i=this.h=this.g=this.l=null}function mg(e,t,i,r){this.g=e,this.i=t,this.h=i,this.l=r,this.j=["offline:",e,"/",t,"/",i,"/",r].join("")}function _g(e){if(null==(e=/^offline:([a-z]+)\/([^/]+)\/([^/]+)\/([0-9]+)$/.exec(e)))return null;var t=e[1];if("manifest"!=t&&"segment"!=t)return null;var i=e[2];if(!i)return null;var r=e[3];return r&&null!=t?new mg(t,i,r,Number(e[4])):null}function vg(e,t){this.h=e,this.g=t}function yg(e,t){var i=new io(null,0);i.Aa(t.duration);var r=t.streams.filter((function(e){return"audio"==e.type})),n=t.streams.filter((function(e){return"video"==e.type}));r=function(e,t,i,r){for(var n=new Set,s=l(t),a=s.next();!a.done;a=s.next()){var o=l(a.value.variantIds);for(a=o.next();!a.done;a=o.next())n.add(a.value)}for(s=l(i),a=s.next();!a.done;a=s.next())for(o=l(a.value.variantIds),a=o.next();!a.done;a=o.next())n.add(a.value);for(s=new Map,n=l(n),a=n.next();!a.done;a=n.next())a=a.value,s.set(a,{id:a,language:"",disabledUntilTime:0,primary:!1,audio:null,video:null,bandwidth:0,allowedByApplication:!0,allowedByKeySystem:!0,decodingInfos:[]});for(t=l(t),n=t.next();!n.done;n=t.next())for(n=n.value,a=xg(e,n,r),o=l(n.variantIds),n=o.next();!n.done;n=o.next())(n=s.get(n.value)).language=a.language,n.primary=n.primary||a.primary,n.audio=a;for(i=l(i),t=i.next();!t.done;t=i.next())for(n=t.value,t=xg(e,n,r),a=l(n.variantIds),n=a.next();!n.done;n=a.next())(n=s.get(n.value)).primary=n.primary||t.primary,n.video=t;return s}(e,r,n,i),n=t.streams.filter((function(e){return e.type==tt})).map((function(t){return xg(e,t,i)}));var s=t.streams.filter((function(e){return"image"==e.type})).map((function(t){return xg(e,t,i)})),a=t.drmInfo?[t.drmInfo]:[];if(t.drmInfo)for(var o=l(r.values()),h=o.next();!h.done;h=o.next())(h=h.value).audio&&h.audio.encrypted&&(h.audio.drmInfos=a),h.video&&h.video.encrypted&&(h.video.drmInfos=a);return{presentationTimeline:i,minBufferTime:2,offlineSessionIds:t.sessionIds,variants:Array.from(r.values()),textStreams:n,imageStreams:s,sequenceMode:t.sequenceMode||!1}}function xg(e,t,i){var r=t.segments.map((function(t){return function(e,t){var i=new mg("segment",e.h,e.g,t.dataKey);return new ma(t.startTime,t.endTime,(function(){return[i.toString()]}),0,null,null!=t.initSegmentKey?function(e,t){var i=new mg("segment",e.h,e.g,t);return new fa((function(){return[i.toString()]}),0,null)}(e,t.initSegmentKey):null,t.timestampOffset,t.appendWindowStart,t.appendWindowEnd,[],t.tilesLayout||"")}(e,t)}));return i.Ib(r),{id:t.id,originalId:t.originalId,createSegmentIndex:function(){return Promise.resolve()},segmentIndex:new To(r),mimeType:t.mimeType,codecs:t.codecs,width:t.width||void 0,height:t.height||void 0,frameRate:t.frameRate,pixelAspectRatio:t.pixelAspectRatio,hdr:t.hdr,kind:t.kind,encrypted:t.encrypted,drmInfos:[],keyIds:t.keyIds,language:t.language,label:t.label,type:t.type,primary:t.primary,trickModeVideo:null,emsgSchemeIdUris:null,roles:t.roles,forced:t.forced,channelsCount:t.channelsCount,audioSamplingRate:t.audioSamplingRate,spatialAudio:t.spatialAudio,closedCaptions:t.closedCaptions,tilesLayout:t.tilesLayout}}function bg(){this.g=null}function wg(){}function Tg(e){var t=_g(e);return t&&"manifest"==t.g?e=gr(e={uri:e,Oe:e,data:new ArrayBuffer(0),headers:{"content-type":"application/x-offline-manifest"}}):e=t&&"segment"==t.g?function(e,t){var i=new ng;return gr(void 0).Y((function(){return i.init()})).Y((function(){return ag(i,t.za(),t.ja())})).Y((function(e){return e.getSegments([t.key()])})).Y((function(e){return{uri:t,data:e[0].data,headers:{}}})).finally((function(){return i.destroy()}))}(t.key(),t):dr(new Me(2,1,9004,e)),e}function Sg(e,t,i){var r,n,s,a,o,h;return P((function(u){switch(u.g){case 1:r=[];for(var c=[],d=l(i),p=d.next();!p.done;p=d.next()){p=p.value;for(var g=!1,f=l(c),m=f.next();!m.done;m=f.next())if(Ag((m=m.value).info,p)){m.sessionIds.push(p.sessionId),g=!0;break}g||c.push({info:p,sessionIds:[p.sessionId]})}n=l(c),s=n.next();case 2:if(s.done){u.A(4);break}return a=s.value,o=function(e,t,i){var r,n;return P((function(s){switch(s.g){case 1:return r=new An({kb:t,onError:function(){},cd:function(){},onExpirationUpdated:function(){},onEvent:function(){}}),T(s,2),r.configure(e),b(s,function(e,t,i,r,n,s){var a=new Map;return(n={audioCapabilities:n,videoCapabilities:s,distinctiveIdentifier:"optional",persistentState:"required",sessionTypes:["persistent-license"],label:t}).drmInfos=[{keySystem:t,licenseServerUri:i,distinctiveIdentifierRequired:!1,persistentStateRequired:!0,audioRobustness:"",videoRobustness:"",serverCertificate:r,serverCertificateUri:"",initData:null,keyIds:null}],a.set(t,n),On(e,a,[])}(r,i.info.keySystem,i.info.licenseUri,i.info.serverCertificate,i.info.audioCapabilities,i.info.videoCapabilities),4);case 4:A(s,3);break;case 2:return C(s),b(s,r.destroy(),5);case 5:case 9:return s.return([]);case 3:return T(s,6),b(s,Rn(r),8);case 8:A(s,7);break;case 6:return C(s),b(s,r.destroy(),9);case 7:return n=[],b(s,Promise.all(i.sessionIds.map((function(e){return P((function(t){return 1==t.g?(T(t,2),b(t,function(e,t){var i,r,n;return P((function(s){return 1==s.g?b(s,Dn(e,t),2):3!=s.g?(i=s.h)?(r=[],(n=e.i.get(i))&&(n.Ja=new nt,r.push(n.Ja)),r.push(i.remove()),b(s,Promise.all(r),3)):s.return():(e.i.delete(i),void w(s))}))}(r,e),4)):2!=t.g?(n.push(e),A(t,0)):(C(t),void w(t))}))}))),10);case 10:return b(s,r.destroy(),11);case 11:return s.return(n)}}))}(e,t,a),b(u,o,5);case 5:h=u.h,r=r.concat(h),s=n.next(),u.A(2);break;case 4:return u.return(r)}}))}function Ag(e,t){function i(e,t){return e.robustness==t.robustness&&e.contentType==t.contentType}return e.keySystem==t.keySystem&&e.licenseUri==t.licenseUri&&re(e.audioCapabilities,t.audioCapabilities,i)&&re(e.videoCapabilities,t.videoCapabilities,i)}function Cg(e,t){var i=yg(new vg(e.za(),e.ja()),t),r=t.appMetadata||{};return i=Eg(i),{offlineUri:e.toString(),originalManifestUri:t.originalManifestUri,duration:t.duration,size:t.size,expiration:t.expiration,tracks:i,appMetadata:r,isIncomplete:t.isIncomplete||!1}}function Eg(e){for(var t=[],i=function(e){return e.filter((function(e){return Mi(e)}))}(e.variants),r=(i=l(i)).next();!r.done;r=i.next())t.push(Ai(r.value));for(i=(e=l(e.textStreams)).next();!i.done;i=e.next())t.push(Ci(i.value));return t}function Ig(){this.g={}}function Rg(e,t){var i=t.audio,r=t.video;if(i&&!r&&(e.g[i.id]=i.bandwidth||t.bandwidth),!i&&r&&(e.g[r.id]=r.bandwidth||t.bandwidth),i&&r){var n=i.bandwidth||393216,s=r.bandwidth||t.bandwidth-n;0>=s&&(s=t.bandwidth),e.g[i.id]=n,e.g[r.id]=s}}function Lg(e,t){e.g[t.id]=t.bandwidth||2048}function kg(e,t){return null==(e=e.g[t])&&(e=0),e}function Mg(e){var t=this;if(e&&e.constructor!=$h)throw new Me(2,9,9008);this.g=this.h=null,e?(this.h=e.h,this.g=e.jc()):(this.h=jh(),this.g=new Ar),this.i=[],this.j=[];var i=!e;this.l=new Or((function(){var e,r,n,s,a;return P((function(o){switch(o.g){case 1:return b(o,Promise.all(t.j.map((function(e){return Xp(e)}))),2);case 2:for(e=function(){},r=[],n=l(t.i),s=n.next();!s.done;s=n.next())a=s.value,r.push(a.then(e,e));return b(o,Promise.all(r),3);case 3:if(!i){o.A(4);break}return b(o,t.g.destroy(),4);case 4:t.h=null,t.g=null,w(o)}}))}))}function Pg(){if(ht())e:{for(var e=l(hg.values()),t=e.next();!t.done;t=e.next())if(t=(t=t.value)()){t.destroy(),e=!0;break e}e=!1}else e=!1;return e}function Og(e){var t,i,r;return P((function(n){switch(n.g){case 1:return b(n,(t=new ng).init(),2);case 2:return b(n,sg(t),3);case 3:return i=n.h,r=new mg("manifest",i.path.za,i.path.ja,e),b(n,t.destroy(),4);case 4:return b(n,(new Mg).remove(r.toString()),0)}}))}function Dg(e,t,i,r,n,s){var a,o,h,u,c,d,p,g,f,m,_;return P((function(v){switch(v.g){case 1:for(a=!1,T(v,2),o=!0,h=l(i.streams),u=h.next();!u.done;u=h.next())for(c=u.value,d=l(c.segments),p=d.next();!p.done;p=d.next())g=p.value,null!=(f=g.pendingSegmentRefId?r[g.pendingSegmentRefId]:null)&&(g.dataKey=f,g.pendingSegmentRefId=void 0),null!=(f=g.pendingInitSegmentRefId?r[g.pendingInitSegmentRefId]:null)&&(g.initSegmentKey=f,g.pendingInitSegmentRefId=void 0),g.pendingSegmentRefId&&(o=!1),g.pendingInitSegmentRefId&&(o=!1);return i.size+=n,o&&(i.isIncomplete=!1),b(v,e.updateManifest(t,i),4);case 4:a=!0,s(),A(v,0);break;case 2:return m=C(v),b(v,Og(t),5);case 5:if(a){v.A(6);break}return _=Object.values(r),b(v,e.removeSegments(_,(function(){})),6);case 6:throw m}}))}function Ng(e){return e.variants.some((function(e){var t=e.audio&&e.audio.encrypted;return e.video&&e.video.encrypted||t}))}function Fg(e){return e.variants.some((function(e){return(e.video?e.video.drmInfos:[]).concat(e.audio?e.audio.drmInfos:[]).some((function(e){return e.initData&&e.initData.length}))}))}function Ug(e,t){for(var i=[],r=l(e.streams),n=r.next();!n.done;n=r.next())n=n.value,t&&"video"==n.type?i.push({contentType:Wt(n.mimeType,n.codecs),robustness:e.drmInfo.videoRobustness}):t||"audio"!=n.type||i.push({contentType:Wt(n.mimeType,n.codecs),robustness:e.drmInfo.audioRobustness});return i}function zg(e,t,i){return P((function(r){return b(r,function(e,t,i,r){var n,s,a;return P((function(o){return 1==o.g?r.drmInfo?(n=function(e){var t=Array.from(e.g.keys());if(!t.length)throw new Me(2,9,9e3,"No supported storage mechanisms found");return e.g.get(t[0]).getEmeSessionCell()}(i),s=r.sessionIds.map((function(e){return{sessionId:e,keySystem:r.drmInfo.keySystem,licenseUri:r.drmInfo.licenseServerUri,serverCertificate:r.drmInfo.serverCertificate,audioCapabilities:Ug(r,!1),videoCapabilities:Ug(r,!0)}})),b(o,Sg(t,e,s),2)):o.return():3!=o.g?(a=o.h,b(o,n.remove(a),3)):b(o,n.add(s.filter((function(e){return!a.includes(e.sessionId)}))),0)}))}(e.g,e.h.drm,i,t),0)}))}function Bg(e,t,i){function r(){}var n=function(e){for(var t=new Set,i=(e=l(e.streams)).next();!i.done;i=e.next())for(var r=(i=l(i.value.segments)).next();!r.done;r=i.next())null!=(r=r.value).initSegmentKey&&t.add(r.initSegmentKey),t.add(r.dataKey);return Array.from(t)}(i);return Cg(t,i),Promise.all([e.removeSegments(n,r),e.removeManifests([t.key()],r)])}function jg(e,t,i,r,n,s){var a={id:r.id,originalId:r.originalId,primary:r.primary,type:r.type,mimeType:r.mimeType,codecs:r.codecs,frameRate:r.frameRate,pixelAspectRatio:r.pixelAspectRatio,hdr:r.hdr,kind:r.kind,language:r.language,label:r.label,width:r.width||null,height:r.height||null,encrypted:r.encrypted,keyIds:r.keyIds,segments:[],variantIds:[],roles:r.roles,forced:r.forced,channelsCount:r.channelsCount,audioSamplingRate:r.audioSamplingRate,spatialAudio:r.spatialAudio,closedCaptions:r.closedCaptions,tilesLayout:r.tilesLayout},o=n.offline.numberOfParallelDownloads,h=0;return function(e,t,i){if(t=e.segmentIndex.find(t),null!=t)for(var r=e.segmentIndex.get(t);r;)i(r),r=e.segmentIndex.get(++t)}(r,i.presentationTimeline.Pa(),(function(i){var n=jp(i),u=void 0;if(!s.has(n)){var l=i.endTime-i.startTime;l=kg(t,r.id)*l,l=Wp(e.g,l),s.set(n,new Bp(i,l,h,!1))}i.h&&(u=jp(i.h),s.has(u)||(l=.5*kg(t,r.id),l=Wp(e.g,l),s.set(u,new Bp(i.h,l,h,!0)))),a.segments.push({pendingInitSegmentRefId:u,initSegmentKey:u?0:null,startTime:i.startTime,endTime:i.endTime,appendWindowStart:i.appendWindowStart,appendWindowEnd:i.appendWindowEnd,timestampOffset:i.timestampOffset,tilesLayout:i.tilesLayout,pendingSegmentRefId:n,dataKey:0}),h=(h+1)%o})),a}function Hg(e){if(e.l.g)throw new Me(2,9,7001)}function Vg(){if(!Pg())throw new Me(2,9,9e3)}function Wg(e,t){return P((function(i){return 1==i.g?(e.i.push(t),S(i),b(i,t,4)):2!=i.g?i.return(i.h):(E(i),ie(e.i,t),I(i,0))}))}function Gg(e){for(var t=new Set,i=l(e.textStreams),r=i.next();!r.done;r=i.next())t.add(r.value);for(r=(i=l(e.imageStreams)).next();!r.done;r=i.next())t.add(r.value);for(i=(e=l(e.variants)).next();!i.done;i=e.next())(i=i.value).audio&&t.add(i.audio),i.video&&t.add(i.video);return t}_(ug,Jp),ug.prototype.updateManifestExpiration=function(e,t){var i,r,n,s=this;return P((function(a){return i=Zp(s.h,s.g),r=i.store(),n=new nt,r.get(e).onsuccess=function(i){(i=i.target.result)?(i.expiration=t,r.put(i),n.resolve()):n.reject(new Me(2,9,9012,"Could not find values for "+e))},b(a,Promise.all([i.promise(),n]),0)}))},ug.prototype.bc=function(e){var t,i,r,n,s,a;return P((function(o){if(1==o.g){for(t=[],i=0;i<e.periods.length;++i)r=i==e.periods.length-1?e.duration:e.periods[i+1].startTime,n=r-e.periods[i].startTime,s=lg(e.periods[i],n),t.push(s);return b(o,zc(t),2)}return a=o.h,o.return({creationTime:0,originalManifestUri:e.originalManifestUri,duration:e.duration,size:e.size,expiration:null==e.expiration?1/0:e.expiration,streams:a,sessionIds:e.sessionIds,drmInfo:e.drmInfo,appMetadata:e.appMetadata,sequenceMode:!1})}))},ug.prototype.ze=function(e){return{data:e.data}},_(dg,Jp),dg.prototype.bc=function(e){var t,i,r,n,s,a;return P((function(o){if(1==o.g){for(t=[],i=0;i<e.periods.length;++i){r=i==e.periods.length-1?e.duration:e.periods[i+1].startTime,n=r-e.periods[i].startTime;for(var h=e.periods[i],u=[],c=l(h.streams),d=c.next();!d.done;d=c.next())0!=(d=d.value).variantIds.length&&u.push(pg(d,h.startTime,h.startTime+n));s=u,t.push(s)}return b(o,zc(t),2)}return a=o.h,o.return({appMetadata:e.appMetadata,creationTime:0,drmInfo:e.drmInfo,duration:e.duration,expiration:null==e.expiration?1/0:e.expiration,originalManifestUri:e.originalManifestUri,sessionIds:e.sessionIds,size:e.size,streams:a,sequenceMode:!1})}))},_(gg,Jp),(n=gg.prototype).hasFixedKeySpace=function(){return!1},n.addSegments=function(e){return this.add(this.i,e)},n.addManifests=function(e){return this.add(this.g,e)},n.updateManifest=function(e,t){return function(e,t,i){var r=(e=Zp(e.h,e.g)).store();return r.get(t).onsuccess=function(){r.put(i,t)},e.promise()}(this,e,t)},n.bc=function(e){return null==e.expiration&&(e.expiration=1/0),Promise.resolve(e)},(n=fg.prototype).init=function(){var t=this,i=new nt,r=!1,n=new ot((function(){r=!0,i.reject(new Me(2,9,9017))}));n.N(5);var s=e.indexedDB.open("shaka_offline_db",5);return s.onsuccess=function(){if(!r){var e=s.result;t.l=e;var a=e.objectStoreNames;a=a.contains("manifest")&&a.contains("segment")?new ug(e,"segment","manifest"):null,t.g=a,a=(a=e.objectStoreNames).contains("manifest-v2")&&a.contains("segment-v2")?new dg(e,"segment-v2","manifest-v2"):null,t.h=a,a=(a=e.objectStoreNames).contains("manifest-v3")&&a.contains("segment-v3")?new dg(e,"segment-v3","manifest-v3"):null,t.i=a,a=(a=e.objectStoreNames).contains("manifest-v5")&&a.contains("segment-v5")?new gg(e,"segment-v5","manifest-v5"):null,t.j=a,e=e.objectStoreNames.contains("session-ids")?new rg(e):null,t.m=e,n.stop(),i.resolve()}},s.onupgradeneeded=function(){for(var e=s.result,t=l(["segment-v5","manifest-v5","session-ids"]),i=t.next();!i.done;i=t.next())i=i.value,e.objectStoreNames.contains(i)||e.createObjectStore(i,{autoIncrement:!0})},s.onerror=function(e){r||(i.reject(new Me(2,9,9001,s.error)),n.stop(),e.preventDefault())},i},n.destroy=function(){var e=this;return P((function(t){switch(t.g){case 1:if(!e.g){t.A(2);break}return b(t,e.g.destroy(),2);case 2:if(!e.h){t.A(4);break}return b(t,e.h.destroy(),4);case 4:if(!e.i){t.A(6);break}return b(t,e.i.destroy(),6);case 6:if(!e.j){t.A(8);break}return b(t,e.j.destroy(),8);case 8:if(!e.m){t.A(10);break}return b(t,e.m.destroy(),10);case 10:e.l&&e.l.close(),w(t)}}))},n.getCells=function(){var e=new Map;return this.g&&e.set("v1",this.g),this.h&&e.set("v2",this.h),this.i&&e.set("v3",this.i),this.j&&e.set("v5",this.j),e},n.getEmeSessionCell=function(){return this.m},n.erase=function(){var t=this;return P((function(i){switch(i.g){case 1:if(!t.g){i.A(2);break}return b(i,t.g.destroy(),2);case 2:if(!t.h){i.A(4);break}return b(i,t.h.destroy(),4);case 4:if(!t.i){i.A(6);break}return b(i,t.i.destroy(),6);case 6:if(!t.j){i.A(8);break}return b(i,t.j.destroy(),8);case 8:return t.l&&t.l.close(),b(i,function(){var t=new nt,i=e.indexedDB.deleteDatabase("shaka_offline_db");return i.onblocked=function(){},i.onsuccess=function(){t.resolve()},i.onerror=function(e){t.reject(new Me(2,9,9001,i.error)),e.preventDefault()},t}(),10);case 10:return t.l=null,t.g=null,t.h=null,t.i=null,t.j=null,b(i,t.init(),0)}}))},og("idb",(function(){return _t("CrKey")||ct()||!e.indexedDB?null:new fg})),mg.prototype.za=function(){return this.i},mg.prototype.ja=function(){return this.h},mg.prototype.key=function(){return this.l},mg.prototype.toString=function(){return this.j},(n=bg.prototype).configure=function(){},n.start=function(e,t){var i,r,n,s,a,o,h=this;return P((function(u){switch(u.g){case 1:if(i=_g(e),h.g=i,null==i||"manifest"!=i.g)throw new Me(2,1,9004,e);return r=new ng,S(u),b(u,r.init(),4);case 4:return b(u,ag(r,i.za(),i.ja()),5);case 5:return b(u,u.h.getManifests([i.key()]),6);case 6:return n=u.h,s=n[0],a=new vg(i.za(),i.ja()),o=yg(a,s),t.makeTextStreamsForClosedCaptions(o),u.return(o);case 2:return E(u),b(u,r.destroy(),7);case 7:I(u,0)}}))},n.stop=function(){return Promise.resolve()},n.update=function(){},n.onExpirationUpdated=function(e,t){var i,r,n,s,a,o,h,u=this;return P((function(l){switch(l.g){case 1:return i=u.g,r=new ng,T(l,2,3),b(l,r.init(),5);case 5:return b(l,ag(r,i.za(),i.ja()),6);case 6:return b(l,(n=l.h).getManifests([i.key()]),7);case 7:if(s=l.h,a=s[0],o=a.sessionIds.includes(e),h=null==a.expiration||a.expiration>t,!o||!h){l.A(3);break}return b(l,n.updateManifestExpiration(i.key(),t),3);case 3:return E(l),b(l,r.destroy(),10);case 10:I(l,0);break;case 2:C(l),l.A(3)}}))},Qn["application/x-offline-manifest"]=function(){return new bg},j("shaka.offline.OfflineScheme",wg),wg.plugin=Tg,Cr("offline",Tg),(n=Mg.prototype).destroy=function(){return this.l.destroy()},n.configure=function(e,t){return 2==arguments.length&&"string"==typeof e&&(e=Dh(e,t)),Hh(this.h,e)},n.getConfiguration=function(){var e=jh();return Hh(e,this.h,jh()),e},n.jc=function(){return this.g},n.store=function(e,t,i){var r=this,n=this.getConfiguration(),s=new Gp(this.g);return this.j.push(s),t=function(e,t,i,r,n,s){var a,o,h,u,c,d,p,g,f,m,_,v,y;return P((function(x){switch(x.g){case 1:return Vg(),o=a=null,h=new ng,d=c=u=null,T(x,2,3),b(x,r(),5);case 5:return a=x.h,b(x,function(e,t,i,r){var n,s,a,o,h;return P((function(u){if(1==u.g)return n=null,s=e.g,a={networkingEngine:s,modifyManifestRequest:function(){},modifySegmentRequest:function(){},filter:function(){return Promise.resolve()},makeTextStreamsForClosedCaptions:function(){},onTimelineRegionAdded:function(){},onEvent:function(){},onError:function(e){n=e},isLowLatencyMode:function(){return!1},isAutoLowLatencyMode:function(){return!1},enableLowLatencyMode:function(){},updateDuration:function(){},newDrmInfo:function(){}},i.configure(r.manifest),Hg(e),b(u,i.start(t,a),2);if(3!=u.g)return o=u.h,Hg(e),h=Gg(o),b(u,Promise.all(zr(h,(function(e){return e.createSegmentIndex()}))),3);if(Hg(e),n)throw n;return u.return(o)}))}(e,t,a,n),6);case 6:if(p=x.h,Hg(e),!(!p.presentationTimeline.U()&&!p.presentationTimeline.jb()))throw new Me(2,9,9005,t);return b(x,function(e,t,i,r){var n;return P((function(s){switch(s.g){case 1:return(n=new An({kb:e.g,onError:i,cd:function(){},onExpirationUpdated:function(){},onEvent:function(){}})).configure(r.drm),b(s,function(e,t,i){return e.da=!0,e.B=[],e.L=i,En(e,t)}(n,t.variants,r.offline.usePersistentLicense),2);case 2:return b(s,Rn(n),3);case 3:return b(s,Ln(n),4);case 4:return s.return(n)}}))}(e,p,(function(e){d=d||e}),n),7);case 7:if(o=x.h,Hg(e),d)throw d;return b(x,function(e,t){var i,r,n,s,a,o,h,u,c,d,p,g,f,m,_,v,y,x,S,E,I,R,L,k,M,O,D,N;return P((function(P){switch(P.g){case 1:return i={width:1/0,height:1/0},function(e,t,i){e.variants=e.variants.filter((function(e){return fi(e,t,i)}))}(e,t.restrictions,i),b(P,vi(e,t.offline.usePersistentLicense),2);case 2:for(r=[],n=t.preferredAudioChannelCount,s=t.preferredDecodingAttributes,a=t.preferredVideoCodecs,o=t.preferredAudioCodecs,di(e,a,o,n,s),h=l(e.variants),u=h.next();!u.done;u=h.next())c=u.value,r.push(Ai(c));for(d=l(e.textStreams),p=d.next();!p.done;p=d.next())g=p.value,r.push(Ci(g));for(f=l(e.imageStreams),m=f.next();!m.done;m=f.next())_=m.value,r.push(Ei(_));return b(P,t.offline.trackSelectionCallback(r),3);case 3:for(v=P.h,y=e.presentationTimeline.getDuration(),x=0,S=l(v),E=S.next();!E.done;E=S.next())I=E.value,R=I.bandwidth*y/8,x+=R;return T(P,4),b(P,t.offline.downloadSizeCallback(x),6);case 6:if(!P.h)throw new Me(2,9,9014);A(P,5);break;case 4:if((L=C(P))instanceof Me)throw L;throw new Me(2,9,9015);case 5:for(k=new Set,M=new Set,O=new Set,D=l(v),E=D.next();!E.done;E=D.next())"variant"==(N=E.value).type&&k.add(N.id),"text"==N.type&&M.add(N.id),"image"==N.type&&O.add(N.id);e.variants=e.variants.filter((function(e){return k.has(e.id)})),e.textStreams=e.textStreams.filter((function(e){return M.has(e.id)})),e.imageStreams=e.imageStreams.filter((function(e){return O.has(e.id)})),function(e){e.variants.map((function(e){return e.video}));var t=new Set(e.variants.map((function(e){return e.audio})));e=e.textStreams;for(var i=l(t),r=i.next();!r.done;r=i.next())for(var n=(r=l(t)).next();!n.done;n=r.next());for(t=l(e),i=t.next();!i.done;i=t.next())for(i=l(e),r=i.next();!r.done;r=i.next());}(e),w(P)}}))}(p,n),8);case 8:return b(x,h.init(),9);case 9:return Hg(e),b(x,sg(h),10);case 10:return u=x.h,Hg(e),g=function(e,t,i,r,n,s){var a=function(e,t,i){return{offlineUri:null,originalManifestUri:e,duration:t.presentationTimeline.getDuration(),size:0,expiration:1/0,tracks:t=Eg(t),appMetadata:i,isIncomplete:!1}}(i,t,r),o=n.offline.progressCallback;!function(e,t,i){e.m=t,e.l=i}(s,(function(e,t){a.size=t,o(a,e)}),(function(t,i){h&&n.offline.usePersistentLicense&&u==i&&kn(e,"cenc",t)}));var h=Ng(t)&&!Fg(t),u=null;h&&(u=Xg.get(e.g.keySystem));for(var c=new Ig,d=l(t.textStreams),p=d.next();!p.done;p=d.next())c.g[p.value.id]=52;for(d=l(t.imageStreams),p=d.next();!p.done;p=d.next())Lg(c,p.value);for(p=l(t.variants),d=p.next();!d.done;d=p.next())Rg(c,d.value);return c=function(e,t,i,r){for(var n=new Map,s=Gg(i),a=new Map,o=(s=l(s)).next();!o.done;o=s.next()){var h=jg(e,t,i,o=o.value,r,n);a.set(o.id,h)}for(e=l(i.variants),t=e.next();!t.done;t=e.next())(t=t.value).audio&&a.get(t.audio.id).variantIds.push(t.id),t.video&&a.get(t.video.id).variantIds.push(t.id);return{streams:Array.from(a.values()),pe:Array.from(n.values())}}(s,c,t,n),s=c.streams,c=c.pe,p=e.g,d=n.offline.usePersistentLicense,p&&d&&(p.initData=[]),{ag:{creationTime:Date.now(),originalManifestUri:i,duration:t.presentationTimeline.getDuration(),size:0,expiration:e.ic(),streams:s,sessionIds:d?Pn(e):[],drmInfo:p,appMetadata:r,isIncomplete:!0,sequenceMode:t.sequenceMode},pe:c}}(o,p,t,i,n,s),f=g.ag,m=g.pe,b(x,u.ja.addManifests([f]),11);case 11:if(_=x.h,Hg(e),c=_[0],Hg(e),d)throw d;return b(x,function(e,t,i,r,n,s,a,o,h){var u,c,d,p,g,f,m,_,v,y;return P((function(x){switch(x.g){case 1:if(u={},c=0,d=function(t,d){var p,g,f,m,_,v,y;return P((function(x){if(1==x.g){for(p={},g=l(t),f=g.next();!f.done;p={cb:p.cb},f=g.next())p.cb=f.value,m=Hp(p.cb,s),_=p.cb.i,v=p.cb.h,y=function(t){return function(i){var r,n,s;return P((function(o){if(1==o.g)return b(o,a.addSegments([{data:i}]),2);r=o.h,Hg(e),n=t.cb.g,s=jp(n),u[s]=r[0],c+=i.byteLength,w(o)}))}}(p),qp(n,p.cb.groupId,m,_,v,y);return b(x,function(e){return P((function(t){return 1==t.g?b(t,Promise.all(e.j.values()),2):t.return(e.g.h)}))}(n),2)}return d?(Hg(e),function(e,t,i,r){if(t.expiration=i.ic(),i=Pn(i),t.sessionIds=r.offline.usePersistentLicense?i:[],Ng(e)&&r.offline.usePersistentLicense&&!i.length)throw new Me(2,9,9007)}(o,r,h,s),b(x,a.updateManifest(i,r),0)):x.A(0)}))},p=!1,T(x,2),!Ng(o)||!p||Fg(o)){x.A(4);break}return b(x,d(t.filter((function(e){return e.h})),!0),5);case 5:return Hg(e),t=t.filter((function(e){return!e.h})),g=u,f=c,u={},c=0,b(x,Dg(a,i,r,g,f,(function(){return Hg(e)})),6);case 6:Hg(e);case 4:if(p){x.A(7);break}return b(x,d(t,!1),8);case 8:return Hg(e),m=u,_=c,u={},c=0,b(x,Dg(a,i,r,m,_,(function(){return Hg(e)})),9);case 9:Hg(e);case 7:A(x,0);break;case 2:return v=C(x),y=Object.values(u),b(x,a.removeSegments(y,(function(){})),10);case 10:throw v}}))}(e,m,c,f,s,n,u.ja,p,o),12);case 12:return Hg(e),v=new mg("manifest",u.path.za,u.path.ja,c),x.return(Cg(v,f));case 3:return E(x),b(x,h.destroy(),13);case 13:if(!a){x.A(14);break}return b(x,a.stop(),14);case 14:if(!o){x.A(16);break}return b(x,o.destroy(),16);case 16:I(x,0);break;case 2:if(y=C(x),null==c){x.A(18);break}return b(x,Og(c),18);case 18:throw d||y}}))}(this,e,t||{},(function(){var t;return P((function(s){return 1==s.g?b(s,$n(e,r.g,n.manifest.retryParameters,i||null),2):(t=s.h,s.return(t()))}))}),n,s),(t=new cr(t,(function(){return Xp(s)}))).finally((function(){ie(r.j,s)})),function(e,t){var i=t.promise;return e.i.push(i),t.finally((function(){ie(e.i,i)}))}(this,t)},n.remove=function(e){return Wg(this,function(e,t){var i,r,n,s,a,o;return P((function(h){switch(h.g){case 1:if(Vg(),null==(i=_g(t))||"manifest"!=i.g)throw new Me(2,9,9004,t);return r=i,n=new ng,S(h),b(h,n.init(),4);case 4:return b(h,ag(n,r.za(),r.ja()),5);case 5:return b(h,(s=h.h).getManifests([r.key()]),6);case 6:return a=h.h,o=a[0],b(h,Promise.all([zg(e,o,n),Bg(s,r,o)]),2);case 2:return E(h),b(h,n.destroy(),8);case 8:I(h,0)}}))}(this,e))},n.pg=function(){return Wg(this,function(e){var t,i,r,n,s,a,o,h,u,c;return P((function(d){switch(d.g){case 1:return Vg(),t=e.g,i=e.h.drm,r=new ng,n=!1,S(d),b(d,r.init(),4);case 4:s=[],function(e,t){e.g.forEach((function(e){t(e.getEmeSessionCell())}))}(r,(function(e){return s.push(e)})),a=l(s),o=a.next();case 5:if(o.done){d.A(2);break}return b(d,(h=o.value).getAll(),8);case 8:return u=d.h,b(d,Sg(i,t,u),9);case 9:return c=d.h,b(d,h.remove(c),10);case 10:c.length!=u.length&&(n=!0),o=a.next(),d.A(5);break;case 2:return E(d),b(d,r.destroy(),11);case 11:I(d,3);break;case 3:return d.return(!n)}}))}(this))},n.list=function(){return Wg(this,P((function(r){switch(r.g){case 1:return Vg(),e=[],t=new ng,S(r),b(r,t.init(),4);case 4:return i=Promise.resolve(),function(e,t){e.g.forEach((function(e,i){e.getCells().forEach((function(e,r){t({za:i,ja:r},e)}))}))}(t,(function(t,r){i=i.then((function(){return P((function(i){if(1==i.g)return b(i,r.getAllManifests(),2);i.h.forEach((function(i,r){i=Cg(new mg("manifest",t.za,t.ja,r),i),e.push(i)})),w(i)}))}))})),b(r,i,2);case 2:return E(r),b(r,t.destroy(),6);case 6:I(r,3);break;case 3:return r.return(e)}})));var e,t,i},j("shaka.offline.Storage",Mg),Mg.deleteAll=function(){var e;return P((function(t){return 1==t.g?(e=new ng,S(t),b(t,function(e){var t,i;return P((function(r){return 1==r.g?(t=Array.from(e.g.values()),(i=0<t.length)||hg.forEach((function(e){(e=e())&&t.push(e)})),b(r,Promise.all(t.map((function(e){return e.erase()}))),2)):i?r.A(0):b(r,Promise.all(t.map((function(e){return e.destroy()}))),0)}))}(e),2)):5!=t.g?(E(t),b(t,e.destroy(),5)):I(t,0)}))},Mg.prototype.list=Mg.prototype.list,Mg.prototype.removeEmeSessions=Mg.prototype.pg,Mg.prototype.remove=Mg.prototype.remove,Mg.prototype.store=Mg.prototype.store,Mg.prototype.getNetworkingEngine=Mg.prototype.jc,Mg.prototype.getConfiguration=Mg.prototype.getConfiguration,Mg.prototype.configure=Mg.prototype.configure,Mg.prototype.destroy=Mg.prototype.destroy,Mg.support=Pg;var Xg=(new Map).set("org.w3.clearkey","1077efecc0b24d02ace33c1e52e2fb4b").set("com.widevine.alpha","edef8ba979d64acea3c827dcd51d21ed").set("com.microsoft.playready","9a04f07998404286ab92e65be0885f95").set("com.microsoft.playready.recommendation","9a04f07998404286ab92e65be0885f95").set("com.microsoft.playready.software","9a04f07998404286ab92e65be0885f95").set("com.microsoft.playready.hardware","9a04f07998404286ab92e65be0885f95").set("com.adobe.primetime","f239e769efa348509c16a903c6932efb");function qg(){}function Yg(e,t){for(e={priority:t||0,mf:e},t=0;t<$g.length;t++)if($g[t].priority<e.priority)return void $g.splice(t,0,e);$g.push(e)}Zu.offline=Pg,j("shaka.polyfill",qg),qg.register=Yg,qg.installAll=function(){for(var e=l($g),t=e.next();!t.done;t=e.next()){t=t.value;try{t.mf()}catch(i){q("Error installing polyfill!",i)}}};var $g=[];function Kg(){this.g=new Qg}function Zg(){e.AbortController||(e.AbortController=Kg,e.AbortSignal=Qg)}function Qg(){xr.call(this),this.h=!1,this.g=void 0,this.onabort=null}function Jg(){}function ef(){if(!Object.getOwnPropertyDescriptor(Element.prototype,"ariaHidden"))for(var e=l(["ariaHidden","ariaLabel","ariaPressed","ariaSelected"]),t=e.next();!t.done;t=e.next())tf(t.value)}function tf(e){var t="aria-"+e.toLowerCase().replace(/^aria/,"");Object.defineProperty(Element.prototype,e,{get:function(){return this.getAttribute(t)},set:function(e){null==e||null==e?this.removeAttribute(t):this.setAttribute(t,e)}})}function rf(){}function nf(){V_()}function sf(){}function af(){if(e.Document){var t=Element.prototype;t.requestFullscreen=t.requestFullscreen||t.mozRequestFullScreen||t.msRequestFullscreen||t.webkitRequestFullscreen,(t=Document.prototype).exitFullscreen=t.exitFullscreen||t.mozCancelFullScreen||t.msExitFullscreen||t.webkitCancelFullScreen,"fullscreenElement"in document||(Object.defineProperty(document,"fullscreenElement",{get:function(){return document.mozFullScreenElement||document.msFullscreenElement||document.webkitCurrentFullScreenElement||document.webkitFullscreenElement}}),Object.defineProperty(document,"fullscreenEnabled",{get:function(){return document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled}})),document.addEventListener("webkitfullscreenchange",of),document.addEventListener("webkitfullscreenerror",of),document.addEventListener("mozfullscreenchange",of),document.addEventListener("mozfullscreenerror",of),document.addEventListener("MSFullscreenChange",of),document.addEventListener("MSFullscreenError",of)}}function of(e){var t=e.type.replace(/^(webkit|moz|MS)/,"").toLowerCase(),i=document.createEvent("Event");i.initEvent(t,e.bubbles,e.cancelable),e.target.dispatchEvent(i)}function hf(){}function uf(){var e=!0;(gt()||_t("PlayStation 5")||ft()||_t("Web0S")||dt()||_t("CrKey")||_t("PC=EOS")||_t("Hisense")||_t("VIDAA"))&&(e=!1),e&&navigator.mediaCapabilities||(navigator.mediaCapabilities||(navigator.mediaCapabilities={}),_f=navigator.mediaCapabilities,navigator.mediaCapabilities.decodingInfo=lf)}function lf(t){var i,r,n,s,a,o,h,u,l,c,d,p,g;return P((function(f){switch(f.g){case 1:if(i={supported:!1,powerEfficient:!0,smooth:!0,keySystemAccess:null,configuration:t},!t)return f.return(i);if(r=t.video,n=t.audio,"media-source"==t.type){if(!ht())return f.return(i);if(r){if(_t("CrKey"))if(e.cast&&cast.__platform__&&cast.__platform__.canDisplayType){var m=r.contentType;r.width&&r.height&&(m+="; width="+r.width+"; height="+r.height),r.framerate&&(m+="; framerate="+r.framerate),"pq"===r.transferFunction&&(m+="; eotf=smpte2084"),m=cast.__platform__.canDisplayType(m)}else m=J(r.contentType);else m=J(r.contentType);if(!m)return f.return(i)}if(n&&(s=n.contentType,!J(s)))return f.return(i)}else{if("file"!=t.type)return f.return(i);if(r&&(a=r.contentType,!ut(a))||n&&(o=n.contentType,!ut(o)))return f.return(i)}return t.keySystemConfiguration?(h=t.keySystemConfiguration,u=[],l=[],h.audio&&(c={robustness:h.audio.robustness||"",contentType:t.audio.contentType},u.push(c)),h.video&&(d={robustness:h.video.robustness||"",contentType:t.video.contentType},l.push(d)),p={initDataTypes:[h.initDataType],distinctiveIdentifier:h.distinctiveIdentifier,persistentState:h.persistentState,sessionTypes:h.sessionTypes},u.length&&(p.audioCapabilities=u),l.length&&(p.videoCapabilities=l),T(f,3),b(f,navigator.requestMediaKeySystemAccess(h.keySystem,[p]),5)):(i.supported=!0,f.return(Promise.resolve(i)));case 5:g=f.h,A(f,4);break;case 3:C(f);case 4:g&&(i.supported=!0,i.keySystemAccess=g);case 2:return f.return(i)}}))}Kg.prototype.abort=function(e){var t=this.g;t.h||(t.h=!0,t.g=e,void 0===t.g&&(t.g=new DOMException("signal is aborted without reason","AbortError")),e=new _r("abort"),t.onabort&&t.onabort(e),t.dispatchEvent(e))},o.Object.defineProperties(Kg.prototype,{signal:{configurable:!0,enumerable:!0,get:function(){return this.g}}}),qg.AbortController=Kg,Kg.install=Zg,_(Qg,xr),o.Object.defineProperties(Qg.prototype,{aborted:{configurable:!0,enumerable:!0,get:function(){return this.h}},reason:{configurable:!0,enumerable:!0,get:function(){return this.g}}}),Yg(Zg),qg.Aria=Jg,Jg.install=ef,Yg(ef),qg.EncryptionScheme=rf,rf.install=nf,Yg(nf,-2),qg.Fullscreen=sf,sf.install=af,Yg(af),qg.MediaCapabilities=hf,hf.install=uf;var cf,df,pf,gf,ff,mf,_f=null;function vf(){}function yf(){var t=mt();e.MediaSource&&(e.cast&&cast.__platform__&&cast.__platform__.canDisplayType?function(){var e=MediaSource.isTypeSupported;MediaSource.isTypeSupported=function(t){var i=t.split(/ *; */);return i.shift(),i.some((function(e){return e.startsWith("codecs=")}))?cast.__platform__.canDisplayType(t):e(t)}}():t?12>=t?(xf(),function(){var e=SourceBuffer.prototype.remove;SourceBuffer.prototype.remove=function(t,i){return e.call(this,t,i-.001)}}()):15>=t&&xf():lt()?function(){var e=MediaSource.isTypeSupported;MediaSource.isTypeSupported=function(t){return"mp2t"!=t.split(";")[0].split("/")[1]&&e(t)}}():(_t("Tizen 2")||_t("Tizen 3")||_t("Tizen 4"))&&function(){var e=MediaSource.isTypeSupported;MediaSource.isTypeSupported=function(t){return"opus"!=Yt(t)[0]&&e(t)}}()),e.MediaSource&&MediaSource.isTypeSupported('video/webm; codecs="vp9"')&&!MediaSource.isTypeSupported('video/webm; codecs="vp09.00.10.08"')&&function(){var e=MediaSource.isTypeSupported;_t("Web0S")||(MediaSource.isTypeSupported=function(t){var i=t.split(/ *; */),r=i.findIndex((function(e){return e.startsWith("codecs=")}));if(0>r)return e(t);var n=i[r].replace("codecs=","").replace(/"/g,"").split(/\s*,\s*/),s=n.findIndex((function(e){return e.startsWith("vp09")}));return 0<=s&&(n[s]="vp9",i[r]='codecs="'+n.join(",")+'"',t=i.join("; ")),e(t)})}()}function xf(){var e=MediaSource.prototype.addSourceBuffer;MediaSource.prototype.addSourceBuffer=function(){var t=e.apply(this,O.apply(0,arguments));return t.abort=function(){},t}}function bf(){}function wf(){screen.orientation||null!=e.orientation&&function(){function t(){switch(e.orientation){case-90:i.type="landscape-secondary",i.angle=270;break;case 0:i.type="portrait-primary",i.angle=0;break;case 90:i.type="landscape-primary",i.angle=90;break;case 180:i.type="portrait-secondary",i.angle=180}}var i=new Tf;screen.orientation=i,t(),e.addEventListener("orientationchange",(function(){t();var e=new _r("change");i.dispatchEvent(e)}))}()}function Tf(){xr.call(this),this.type="",this.angle=0}function Sf(){}function Af(e,t){try{var i=new If(e,t);return Promise.resolve(i)}catch(r){return Promise.reject(r)}}function Cf(e){var t=this.mediaKeys;return t&&t!=e&&Lf(t,null),delete this.mediaKeys,(this.mediaKeys=e)?Lf(e,this):Promise.resolve()}function Ef(e){if(Le(e=Re(e.initData)).getUint32(0,!0)+4!=e.byteLength)throw new RangeError("Malformed FairPlay init data");e=At(e=Tt(e.subarray(4),!0));var t=new Event("encrypted");t.initDataType="skd",t.initData=Ie(e),this.dispatchEvent(t)}function If(e,t){if(this.keySystem=e,e.startsWith("com.apple.fps"))for(t=(e=l(t)).next();!t.done;t=e.next()){var i=t.value;if("required"==i.persistentState)t=null;else{t={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:i.initDataTypes,sessionTypes:["temporary"],label:i.label};var r=!1,n=!1;if(i.audioCapabilities)for(var s=l(i.audioCapabilities),a=s.next();!a.done;a=s.next())(a=a.value).contentType&&(r=!0,WebKitMediaKeys.isTypeSupported(this.keySystem,a.contentType.split(";")[0])&&(t.audioCapabilities.push(a),n=!0));if(i.videoCapabilities)for(a=(i=l(i.videoCapabilities)).next();!a.done;a=i.next())(s=a.value).contentType&&(r=!0,WebKitMediaKeys.isTypeSupported(this.keySystem,s.contentType.split(";")[0])&&(t.videoCapabilities.push(s),n=!0));r||(n=WebKitMediaKeys.isTypeSupported(this.keySystem,"video/mp4")),t=n?t:null}if(t)return void(this.g=t)}throw(e=Error("Unsupported keySystem")).name="NotSupportedError",e.code=DOMException.NOT_SUPPORTED_ERR,e}function Rf(e){this.h=new WebKitMediaKeys(e),this.g=new Nr}function Lf(e,t){if(e.g.nb(),!t)return Promise.resolve();e.g.C(t,"webkitneedkey",Ef);try{return ho(t,HTMLMediaElement.HAVE_METADATA,e.g,(function(){t.webkitSetMediaKeys(e.h)})),Promise.resolve()}catch(i){return Promise.reject(i)}}function kf(e){xr.call(this),this.i=null,this.l=e,this.g=this.h=null,this.j=new Nr,this.sessionId="",this.expiration=NaN,this.closed=new nt,this.keyStatuses=new Pf}function Mf(e,t){var i=e.keyStatuses;i.size=null==t?0:1,i.g=t,t=new _r("keystatuseschange"),e.dispatchEvent(t)}function Pf(){this.size=0,this.g=void 0}function Of(){}function Df(){!e.HTMLVideoElement||navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration||(navigator.requestMediaKeySystemAccess=Nf,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=Ff,e.MediaKeys=Uf,e.MediaKeySystemAccess=zf,e.shakaMediaKeysPolyfill=!0)}function Nf(){return Promise.reject(Error("The key system specified is not supported."))}function Ff(e){return null==e?Promise.resolve():Promise.reject(Error("MediaKeys not supported."))}function Uf(){throw new TypeError("Illegal constructor.")}function zf(){throw this.keySystem="",new TypeError("Illegal constructor.")}function Bf(){}function jf(){if(!(!e.HTMLVideoElement||navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration)){if(HTMLMediaElement.prototype.webkitGenerateKeyRequest)em="webkit";else if(!HTMLMediaElement.prototype.generateKeyRequest)return;navigator.requestMediaKeySystemAccess=Vf,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=Wf,e.MediaKeys=Xf,e.MediaKeySystemAccess=Gf,e.shakaMediaKeysPolyfill=!0}}function Hf(e){return em?em+e.charAt(0).toUpperCase()+e.slice(1):e}function Vf(e,t){try{var i=new Gf(e,t);return Promise.resolve(i)}catch(r){return Promise.reject(r)}}function Wf(e){var t=this.mediaKeys;return t&&t!=e&&qf(t,null),delete this.mediaKeys,(this.mediaKeys=e)&&qf(e,this),Promise.resolve()}function Gf(e,t){this.g=this.keySystem=e;var i=!1;"org.w3.clearkey"==e&&(this.g="webkit-org.w3.clearkey",i=!1);var r=!1,n=document.getElementsByTagName("video");n=n.length?n[0]:document.createElement("video");for(var s=(t=l(t)).next();!s.done;s=t.next()){var a={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:(s=s.value).initDataTypes,sessionTypes:["temporary"],label:s.label},o=!1;if(s.audioCapabilities)for(var h=l(s.audioCapabilities),u=h.next();!u.done;u=h.next())(u=u.value).contentType&&(o=!0,n.canPlayType(u.contentType.split(";")[0],this.g)&&(a.audioCapabilities.push(u),r=!0));if(s.videoCapabilities)for(u=(h=l(s.videoCapabilities)).next();!u.done;u=h.next())(u=u.value).contentType&&(o=!0,n.canPlayType(u.contentType,this.g)&&(a.videoCapabilities.push(u),r=!0));if(o||(r=n.canPlayType("video/mp4",this.g)||n.canPlayType("video/webm",this.g)),"required"==s.persistentState&&(i?(a.persistentState="required",a.sessionTypes=["persistent-license"]):r=!1),r)return void(this.h=a)}throw i="Unsupported keySystem","org.w3.clearkey"!=e&&"com.widevine.alpha"!=e||(i="None of the requested configurations were supported."),(e=Error(i)).name="NotSupportedError",e.code=DOMException.NOT_SUPPORTED_ERR,e}function Xf(e){this.l=e,this.h=null,this.g=new Nr,this.i=[],this.j=new Map}function qf(e,t){e.h=t,e.g.nb();var i=em;t&&(e.g.C(t,i+"needkey",(function(t){var i=new CustomEvent("encrypted");i.initDataType="cenc",i.initData=Ie(t.initData),e.h.dispatchEvent(i)})),e.g.C(t,i+"keymessage",(function(t){var i=Yf(e,t.sessionId);i&&(t=new _r("message",t=(new Map).set("messageType",null==i.keyStatuses.Eb()?"licenserequest":"licenserenewal").set("message",t.message)),i.h&&(i.h.resolve(),i.h=null),i.dispatchEvent(t))})),e.g.C(t,i+"keyadded",(function(t){(t=Yf(e,t.sessionId))&&(Qf(t,"usable"),t.g&&t.g.resolve(),t.g=null)})),e.g.C(t,i+"keyerror",(function(t){var i=Yf(e,t.sessionId);i&&i.handleError(t)})))}function Yf(e,t){var i=e.j.get(t);return i||((i=e.i.shift())?(i.sessionId=t,e.j.set(t,i),i):null)}function $f(e,t,i){xr.call(this),this.j=e,this.m=!1,this.g=this.h=null,this.i=t,this.l=i,this.sessionId="",this.expiration=NaN,this.closed=new nt,this.keyStatuses=new Jf}function Kf(e,t,i){if(e.m)return Promise.reject(Error("The session is already initialized."));e.m=!0;try{if("persistent-license"==e.l)if(i)var r=Re(At("LOAD_SESSION|"+i));else{var n=At("PERSISTENT|");r=Ot(n,t)}else r=Re(t)}catch(a){return Promise.reject(a)}e.h=new nt;var s=Hf("generateKeyRequest");try{e.j[s](e.i,r)}catch(a){if("InvalidStateError"!=a.name)return e.h=null,Promise.reject(a);new ot((function(){try{e.j[s](e.i,r)}catch(t){e.h.reject(t),e.h=null}})).N(.01)}return e.h}function Zf(e,t,i){if(e.g)e.g.then((function(){return Zf(e,t,i)})).catch((function(){return Zf(e,t,i)}));else{if(e.g=t,"webkit-org.w3.clearkey"==e.i){var r=wt(i),n=JSON.parse(r);"oct"!=n.keys[0].kty&&(e.g.reject(Error("Response is not a valid JSON Web Key Set.")),e.g=null),r=kt(n.keys[0].k),n=kt(n.keys[0].kid)}else r=Re(i),n=null;var s=Hf("addKey");try{e.j[s](e.i,r,n,e.sessionId)}catch(a){e.g.reject(a),e.g=null}}}function Qf(e,t){var i=e.keyStatuses;i.size=null==t?0:1,i.g=t,t=new _r("keystatuseschange"),e.dispatchEvent(t)}function Jf(){this.size=0,this.g=void 0}hf.originalMcap=_f,Yg(uf,-1),qg.MediaSource=vf,vf.install=yf,Yg(yf),qg.Orientation=bf,bf.install=wf,_(Tf,xr),Tf.prototype.lock=function(e){function t(e){return screen.lockOrientation?screen.lockOrientation(e):screen.mozLockOrientation?screen.mozLockOrientation(e):!!screen.msLockOrientation&&screen.msLockOrientation(e)}var i=!1;switch(e){case"natural":i=t("default");break;case"any":i=!0,this.unlock();break;default:i=t(e)}return i?Promise.resolve():((e=Error("screen.orientation.lock() is not available on this device")).name="NotSupportedError",e.code=DOMException.NOT_SUPPORTED_ERR,Promise.reject(e))},Tf.prototype.unlock=function(){screen.unlockOrientation?screen.unlockOrientation():screen.mozUnlockOrientation?screen.mozUnlockOrientation():screen.msUnlockOrientation&&screen.msUnlockOrientation()},Yg(wf),qg.PatchedMediaKeysApple=Sf,Sf.uninstall=function(){cf&&(cf=!1,Object.defineProperty(HTMLMediaElement.prototype,"mediaKeys",df),HTMLMediaElement.prototype.setMediaKeys=pf,e.MediaKeys=gf,e.MediaKeySystemAccess=ff,navigator.requestMediaKeySystemAccess=mf,df=mf=pf=ff=gf=null,e.shakaMediaKeysPolyfill=!1)},Sf.install=function(t){e.HTMLVideoElement&&e.WebKitMediaKeys&&(void 0!==t&&t&&(cf=!0,df=Object.getOwnPropertyDescriptor(HTMLMediaElement.prototype,"mediaKeys"),pf=HTMLMediaElement.prototype.setMediaKeys,gf=e.MediaKeys,ff=e.MediaKeySystemAccess,mf=navigator.requestMediaKeySystemAccess),delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=Cf,e.MediaKeys=Rf,e.MediaKeySystemAccess=If,navigator.requestMediaKeySystemAccess=Af,e.shakaMediaKeysPolyfill=!0)},If.prototype.createMediaKeys=function(){var e=new Rf(this.keySystem);return Promise.resolve(e)},If.prototype.getConfiguration=function(){return this.g},Rf.prototype.createSession=function(e){if("temporary"!=(e=e||"temporary"))throw new TypeError("Session type "+e+" is unsupported on this platform.");return new kf(this.h)},Rf.prototype.setServerCertificate=function(){return Promise.resolve(!1)},_(kf,xr),(n=kf.prototype).generateRequest=function(e,t){var i=this;this.h=new nt;try{var r=this.l.createSession("video/mp4",Re(t));this.i=r,this.sessionId=r.sessionId||"",this.j.C(this.i,"webkitkeymessage",(function(e){i.h&&(i.h.resolve(),i.h=null),e=new _r("message",e=(new Map).set("messageType",null==i.keyStatuses.Eb()?"license-request":"license-renewal").set("message",Ie(e.message))),i.dispatchEvent(e)})),this.j.C(r,"webkitkeyadded",(function(){i.g&&(Mf(i,"usable"),i.g.resolve(),i.g=null)})),this.j.C(r,"webkitkeyerror",(function(){var e=Error("EME PatchedMediaKeysApple key error");if(e.errorCode=i.i.error,null!=i.h)i.h.reject(e),i.h=null;else if(null!=i.g)i.g.reject(e),i.g=null;else switch(i.i.error.code){case WebKitMediaKeyError.MEDIA_KEYERR_OUTPUT:case WebKitMediaKeyError.MEDIA_KEYERR_HARDWARECHANGE:Mf(i,"output-not-allowed");break;default:Mf(i,"internal-error")}})),Mf(this,"status-pending")}catch(n){this.h.reject(n)}return this.h},n.load=function(){return Promise.reject(Error("MediaKeySession.load not yet supported"))},n.update=function(e){this.g=new nt;try{this.i.update(Re(e))}catch(t){this.g.reject(t)}return this.g},n.close=function(){try{this.i.close(),this.closed.resolve(),this.j.nb()}catch(W_){this.closed.reject(W_)}return this.closed},n.remove=function(){return Promise.reject(Error("MediaKeySession.remove is only applicable for persistent licenses, which are not supported on this platform"))},(n=Pf.prototype).Eb=function(){return this.g},n.forEach=function(e){this.g&&e(this.g,qn.value())},n.get=function(e){if(this.has(e))return this.g},n.has=function(e){var t=qn.value();return!(!this.g||!Ce(e,t))},n.entries=function(){},n.keys=function(){},n.values=function(){},qg.PatchedMediaKeysNop=Of,Of.install=Df,Uf.prototype.createSession=function(){},Uf.prototype.setServerCertificate=function(){},zf.prototype.getConfiguration=function(){},zf.prototype.createMediaKeys=function(){},Yg(Df,-10),qg.PatchedMediaKeysWebkit=Bf,Bf.install=jf,Gf.prototype.createMediaKeys=function(){var e=new Xf(this.g);return Promise.resolve(e)},Gf.prototype.getConfiguration=function(){return this.h},Xf.prototype.createSession=function(e){if("temporary"!=(e=e||"temporary")&&"persistent-license"!=e)throw new TypeError("Session type "+e+" is unsupported on this platform.");var t=this.h||document.createElement("video");return t.src||(t.src="about:blank"),e=new $f(t,this.l,e),this.i.push(e),e},Xf.prototype.setServerCertificate=function(){return Promise.resolve(!1)},_($f,xr),(n=$f.prototype).handleError=function(e){var t=Error("EME v0.1b key error"),i=e.errorCode;i.systemCode=e.systemCode,t.errorCode=i,!e.sessionId&&this.h?(45==e.systemCode&&(t.message="Unsupported session type."),this.h.reject(t),this.h=null):e.sessionId&&this.g?(this.g.reject(t),this.g=null):(t=e.systemCode,e.errorCode.code==MediaKeyError.MEDIA_KEYERR_OUTPUT?Qf(this,"output-restricted"):Qf(this,1==t?"expired":"internal-error"))},n.generateRequest=function(e,t){return Kf(this,t,null)},n.load=function(e){return"persistent-license"==this.l?Kf(this,null,e):Promise.reject(Error("Not a persistent session."))},n.update=function(e){var t=new nt;return Zf(this,t,e),t},n.close=function(){if("persistent-license"!=this.l){if(!this.sessionId)return this.closed.reject(Error("The session is not callable.")),this.closed;var e=Hf("cancelKeyRequest");try{this.j[e](this.i,this.sessionId)}catch(t){}}return this.closed.resolve(),this.closed},n.remove=function(){return"persistent-license"!=this.l?Promise.reject(Error("Not a persistent session.")):this.close()},(n=Jf.prototype).Eb=function(){return this.g},n.forEach=function(e){this.g&&e(this.g,qn.value())},n.get=function(e){if(this.has(e))return this.g},n.has=function(e){var t=qn.value();return!(!this.g||!Ce(e,t))},n.entries=function(){},n.keys=function(){},n.values=function(){};var em="";function tm(){}function im(){if(e.HTMLVideoElement){var t=HTMLVideoElement.prototype;t.requestPictureInPicture&&document.exitPictureInPicture||!t.webkitSupportsPresentationMode||(document.pictureInPictureEnabled=!0,document.pictureInPictureElement=null,t.requestPictureInPicture=nm,Object.defineProperty(t,"disablePictureInPicture",{get:am,set:om,enumerable:!0,configurable:!0}),document.exitPictureInPicture=sm,document.addEventListener("webkitpresentationmodechanged",rm,!0))}}function rm(e){if("picture-in-picture"==(e=e.target).webkitPresentationMode){document.pictureInPictureElement=e;var t=new Event("enterpictureinpicture");e.dispatchEvent(t)}else document.pictureInPictureElement==e&&(document.pictureInPictureElement=null),t=new Event("leavepictureinpicture"),e.dispatchEvent(t)}function nm(){return this.webkitSupportsPresentationMode("picture-in-picture")?(this.webkitSetPresentationMode("picture-in-picture"),document.pictureInPictureElement=this,Promise.resolve()):Promise.reject(Error("PiP not allowed by video element"))}function sm(){var e=document.pictureInPictureElement;return e?(e.webkitSetPresentationMode("inline"),document.pictureInPictureElement=null,Promise.resolve()):Promise.reject(Error("No picture in picture element found"))}function am(){return!!this.hasAttribute("disablePictureInPicture")||!this.webkitSupportsPresentationMode("picture-in-picture")}function om(e){e?this.setAttribute("disablePictureInPicture",""):this.removeAttribute("disablePictureInPicture")}function hm(){}function um(){e.crypto&&("randomUUID"in e.crypto||(e.crypto.randomUUID=lm))}function lm(){var e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.substr(t.lastIndexOf("/")+1)}function cm(){}function dm(){navigator.storage&&navigator.storage.estimate||!navigator.webkitTemporaryStorage||!navigator.webkitTemporaryStorage.queryUsageAndQuota||("storage"in navigator||(navigator.storage={}),navigator.storage.estimate=pm)}function pm(){return new Promise((function(e,t){navigator.webkitTemporaryStorage.queryUsageAndQuota((function(t,i){e({usage:t,quota:i})}),t)}))}function gm(){}function fm(){var e=Symbol.prototype;"description"in e||Object.defineProperty(e,"description",{get:mm})}function mm(){var e=/\((.*)\)/.exec(this.toString());return e?e[1]:void 0}function _m(){}function vm(){if(e.HTMLMediaElement){var t=HTMLMediaElement.prototype.play;HTMLMediaElement.prototype.play=function(){var e=t.apply(this);return e&&e.catch((function(){})),e}}}function ym(){}function xm(){if(e.HTMLVideoElement){var t=HTMLVideoElement.prototype;!t.getVideoPlaybackQuality&&("webkitDroppedFrameCount"in t||pt())&&(t.getVideoPlaybackQuality=bm)}}function bm(){return{droppedVideoFrames:this.webkitDroppedFrameCount,totalVideoFrames:this.webkitDecodedFrameCount,corruptedVideoFrames:0,creationTime:NaN,totalFrameDelay:0}}function wm(){}function Tm(){if(!e.VTTCue&&e.TextTrackCue){var t=null,i=TextTrackCue.length;if(3==i)t=Sm;else if(6==i)t=Am;else{try{var r=!!Sm(1,2,"")}catch(n){r=!1}r&&(t=Sm)}t&&(e.VTTCue=function(e,i,r){return t(e,i,r)})}}function Sm(t,i,r){return new e.TextTrackCue(t,i,r)}function Am(t,i,r){return new e.TextTrackCue(t+"-"+i+"-"+r,t,i,r)}function Cm(){}Yg(jf),qg.PiPWebkit=tm,tm.install=im,Yg(im),qg.RandomUUID=hm,hm.install=um,Yg(um),qg.StorageEstimate=cm,cm.install=dm,Yg(dm),qg.Symbol=gm,gm.install=fm,Yg(fm),qg.VideoPlayPromise=_m,_m.install=vm,Yg(vm),qg.VideoPlaybackQuality=ym,ym.install=xm,Yg(xm),qg.VTTCue=wm,wm.install=Tm,Yg(Tm),Cm.prototype.parseInit=function(){},Cm.prototype.setSequenceMode=function(){},Cm.prototype.parseMedia=function(e,t){for(var i=null,r=[],n=(e=l(e=wt(e).split(/\r?\n/))).next();!n.done;n=e.next())if((n=n.value)&&!/^\s+$/.test(n)&&(n=Em.exec(n))){var s=Im.exec(n[1]);n=new se(s=60*parseInt(s[1],10)+parseFloat(s[2].replace(",",".")),t.segmentEnd?t.segmentEnd:s+2,n[2]),i&&(i.endTime=s,r.push(i)),i=n}return i&&r.push(i),r},j("shaka.text.LrcTextParser",Cm),Cm.prototype.parseMedia=Cm.prototype.parseMedia,Cm.prototype.setSequenceMode=Cm.prototype.setSequenceMode,Cm.prototype.parseInit=Cm.prototype.parseInit;var Em=/^\[(\d{1,2}:\d{1,2}(?:[.,]\d{1,3})?)\](.*)/,Im=/^(\d+):(\d{1,2}(?:[.,]\d{1,3})?)$/;function Rm(){}function Lm(e,t,i,r,n,s,a,o,h,u,c){var d=e.parentNode;if(e.nodeType==Node.COMMENT_NODE)return null;if(e.nodeType==Node.TEXT_NODE){if(!c)return null;var p=document.createElement("span");p.textContent=e.textContent}else p=e;for(var g=null,f=l(i_),m=f.next();!m.done&&!(g=Nm(p,"backgroundImage",r,"#",m.value)[0]);m=f.next());if(f=c,("p"==e.nodeName||g)&&(c=!0),o="default"==(p.getAttribute("xml:space")||(o?"default":"preserve")),e=[],!(m=Array.from(p.childNodes).every((function(e){return e.nodeType==Node.TEXT_NODE}))))for(var _=l(p.childNodes),v=_.next();!v.done;v=_.next())(v=Lm(v.value,t,i,r,n,s,a,o,h,p,c))&&e.push(v);r=null!=u,_=/\S/.test(p.textContent);var y=p.hasAttribute("begin")||p.hasAttribute("end")||p.hasAttribute("dur");if(!(y||_||"br"==p.tagName||0!=e.length||r&&!o))return null;for(_=(v=Um(p,i)).start,v=v.end;d&&d.nodeType==Node.ELEMENT_NODE&&"tt"!=d.tagName;)_=(v=Fm(d,i,_,v)).start,v=v.end,d=d.parentNode;if(null==_&&(_=0),_+=t.periodStart,v=null==v?1/0:v+t.periodStart,_=Math.max(_,t.segmentStart),v=Math.min(v,t.segmentEnd),!y&&0<e.length)for(_=1/0,v=0,i=(t=l(e)).next();!i.done;i=t.next())i=i.value,_=Math.min(_,i.startTime),v=Math.max(v,i.endTime);if("br"==p.tagName)return(n=new se(_,v,"")).lineBreak=!0,n;if(t="",m&&(t=p.textContent,o&&(t=(t=t.trim()).replace(/\s+/g," "))),(t=new se(_,v,t)).nestedCues=e,c||(t.isContainer=!0),h&&(t.cellResolution=h),h=Nm(p,"region",s,"")[0],p.hasAttribute("region")&&h&&h.getAttribute("xml:id")){var x=h.getAttribute("xml:id");t.region=a.filter((function(e){return e.id==x}))[0]}return a=h,u&&r&&!p.getAttribute("region")&&!p.getAttribute("style")&&(a=Nm(u,"region",s,"")[0]),function(e,t,i,r,n,s,a){s=s||a,"rtl"==Mm(t,i,n,"direction",s)&&(e.direction="rtl"),a=Mm(t,i,n,"writingMode",s),"tb"==a||"tblr"==a?e.writingMode="vertical-lr":"tbrl"==a?e.writingMode="vertical-rl":"rltb"==a||"rl"==a?e.direction="rtl":a&&(e.direction=de),(a=Mm(t,i,n,"textAlign",!0))?(e.positionAlign=Jm[a],e.lineAlign=Qm[a],e.textAlign=ue[a.toUpperCase()]):e.textAlign=he,(a=Mm(t,i,n,"displayAlign",!0))&&(e.displayAlign=ce[a.toUpperCase()]);(a=Mm(t,i,n,"color",s))&&(e.color=a);(a=Mm(t,i,n,"backgroundColor",s))&&(e.backgroundColor=a);(a=Mm(t,i,n,"border",s))&&(e.border=a);if(a=Mm(t,i,n,"fontFamily",s))switch(a){case"monospaceSerif":e.fontFamily="Courier New,Liberation Mono,Courier,monospace";break;case"proportionalSansSerif":e.fontFamily="Arial,Helvetica,Liberation Sans,sans-serif";break;case"sansSerif":e.fontFamily="sans-serif";break;case"monospaceSansSerif":e.fontFamily="Consolas,monospace";break;case"proportionalSerif":e.fontFamily="serif";break;default:e.fontFamily=a}(a=Mm(t,i,n,"fontWeight",s))&&"bold"==a&&(e.fontWeight=700),a=Mm(t,i,n,"wrapOption",s),e.wrapLine=!a||"noWrap"!=a,(a=Mm(t,i,n,"lineHeight",s))&&a.match(Wm)&&(e.lineHeight=a),(a=Mm(t,i,n,"fontSize",s))&&(a.match(Wm)||a.match(Vm))&&(e.fontSize=a),(a=Mm(t,i,n,"fontStyle",s))&&(e.fontStyle=be[a.toUpperCase()]);if(r){a=r.getAttribute("imageType")||r.getAttribute("imagetype");var o=r.getAttribute("encoding");r=r.textContent.trim(),"PNG"==a&&"Base64"==o&&r&&(e.backgroundImage="data:image/png;base64,"+r)}(r=Mm(t,i,n,"textOutline",s))&&(r=r.split(" "),r[0].match(Wm)?e.textStrokeColor=e.color:(e.textStrokeColor=r[0],r.shift()),r[0]&&r[0].match(Wm)?e.textStrokeWidth=r[0]:e.textStrokeColor="");(r=Mm(t,i,n,"letterSpacing",s))&&r.match(Wm)&&(e.letterSpacing=r),(r=Mm(t,i,n,"linePadding",s))&&r.match(Wm)&&(e.linePadding=r),(s=Mm(t,i,n,"opacity",s))&&(e.opacity=parseFloat(s));(i=Pm(i,n,"textDecoration"))&&km(e,i),(t=Om(t,n,"textDecoration"))&&km(e,t)}(t,p,a,g,n,f,0==e.length),t}function km(e,t){for(var i=(t=l(t.split(" "))).next();!i.done;i=t.next())switch(i.value){case"underline":e.textDecoration.includes("underline")||e.textDecoration.push("underline");break;case"noUnderline":e.textDecoration.includes("underline")&&ie(e.textDecoration,"underline");break;case"lineThrough":e.textDecoration.includes("lineThrough")||e.textDecoration.push("lineThrough");break;case"noLineThrough":e.textDecoration.includes("lineThrough")&&ie(e.textDecoration,"lineThrough");break;case"overline":e.textDecoration.includes("overline")||e.textDecoration.push("overline");break;case"noOverline":e.textDecoration.includes("overline")&&ie(e.textDecoration,"overline")}}function Mm(e,t,i,r,n){return n=void 0===n||n,(e=Om(e,i,r))?e:n?Pm(t,i,r):null}function Pm(e,t,i){if(!e)return null;var r=ln(e,t_,i);return r||Dm(e,t,i)}function Om(e,t,i){var r=ln(e,t_,i);return r||Dm(e,t,i)}function Dm(e,t,i){e=Nm(e,"style",t,"");for(var r=null,n=0;n<e.length;n++){var s=un(e[n],"urn:ebu:tt:style",i);s||(s=ln(e[n],t_,i)),s||(s=Om(e[n],t,i)),s&&(r=s)}return r}function Nm(e,t,i,r,n){var s=[];if(!e||1>i.length)return s;var a=e;for(e=null;a&&!(e=n?un(a,n,t):a.getAttribute(t))&&(a=a.parentNode)instanceof Element;);if(t=e)for(n=(t=l(t.split(" "))).next();!n.done;n=t.next())for(n=n.value,a=(e=l(i)).next();!a.done;a=e.next())if(r+(a=a.value).getAttribute("xml:id")==n){s.push(a);break}return s}function Fm(e,t,i,r){return e=Um(e,t),null==i?i=e.start:null!=e.start&&(i+=e.start),null==r?r=e.end:null!=e.start&&(r+=e.start),{start:i,end:r}}function Um(e,t){var i=zm(e.getAttribute("begin"),t),r=zm(e.getAttribute("end"),t);return e=zm(e.getAttribute("dur"),t),null==r&&null!=e&&(r=i+e),{start:i,end:r}}function zm(e,t){var i=null;if(Xm.test(e)){e=Xm.exec(e),i=Number(e[1]);var r=Number(e[2]),n=Number(e[3]),s=Number(e[4]);i=(n+=(s+=(Number(e[5])||0)/t.h)/t.frameRate)+60*r+3600*i}else if(qm.test(e))i=Bm(qm,e);else if(Ym.test(e))i=Bm(Ym,e);else if($m.test(e))e=$m.exec(e),i=Number(e[1])/t.frameRate;else if(Km.test(e))e=Km.exec(e),i=Number(e[1])/t.g;else if(Zm.test(e))i=Bm(Zm,e);else if(e)throw new Me(2,2,2001,"Could not parse cue time range in TTML");return i}function Bm(e,t){return null==(e=e.exec(t))||""==e[0]?null:(Number(e[4])||0)/1e3+(Number(e[3])||0)+60*(Number(e[2])||0)+3600*(Number(e[1])||0)}function jm(e,t,i,r){this.frameRate=Number(e)||30,this.h=Number(t)||1,this.g=Number(r),0==this.g&&(this.g=e?this.frameRate*this.h:1),i&&(e=/^(\d+) (\d+)$/g.exec(i))&&(this.frameRate*=Number(e[1])/Number(e[2]))}ei["application/x-subtitle-lrc"]=function(){return new Cm},Rm.prototype.parseInit=function(){},Rm.prototype.setSequenceMode=function(){},Rm.prototype.parseMedia=function(e,t){var i=wt(e);if(e=[],""==i)return e;var r=wn(i,"tt");if(!r)throw new Me(2,2,2005,"Failed to parse TTML.");if(!(i=r.getElementsByTagName("body")[0]))return[];var n=ln(r,e_,"frameRate"),s=ln(r,e_,"subFrameRate"),a=ln(r,e_,"frameRateMultiplier"),o=ln(r,e_,"tickRate"),h=ln(r,e_,"cellResolution"),u=r.getAttribute("xml:space")||"default",c=ln(r,t_,"extent");if("default"!=u&&"preserve"!=u)throw new Me(2,2,2005,"Invalid xml:space value: "+u);u="default"==u,n=new jm(n,s,a,o),h=h&&(h=/^(\d+) (\d+)$/.exec(h))?{columns:parseInt(h[1],10),rows:parseInt(h[2],10)}:null,s=(s=r.getElementsByTagName("metadata")[0])?function(e){return Array.from(e.childNodes).filter((function(e){return e instanceof Element}))}(s):[],a=Array.from(r.getElementsByTagName("style")),o=[];for(var d=l(r=Array.from(r.getElementsByTagName("region"))),p=d.next();!p.done;p=d.next()){var g=p.value;p=new we;var f=g.getAttribute("xml:id");if(f){p.id=f;var m,_,v=null;c&&(v=Hm.exec(c)||Gm.exec(c)),f=v?Number(v[1]):null,v=v?Number(v[2]):null,(m=Pm(g,a,"extent"))&&(null!=(m=(_=Hm.exec(m))||Gm.exec(m))&&(p.width=Number(m[1]),p.height=Number(m[2]),_||(null!=f&&(p.width=100*p.width/f),null!=v&&(p.height=100*p.height/v)),p.widthUnits=_||null!=f?Te:0,p.heightUnits=_||null!=v?Te:0)),(g=Pm(g,a,"origin"))&&(null!=(m=(_=Hm.exec(g))||Gm.exec(g))&&(p.viewportAnchorX=Number(m[1]),p.viewportAnchorY=Number(m[2]),_||(null!=v&&(p.viewportAnchorY=100*p.viewportAnchorY/v),null!=f&&(p.viewportAnchorX=100*p.viewportAnchorX/f)),p.viewportAnchorUnits=_||null!=f?Te:0))}else p=null;p&&o.push(p)}if(on(i,"p").length)throw new Me(2,2,2001,"<p> can only be inside <div> in TTML");for(d=(c=l(on(i,"div"))).next();!d.done;d=c.next())if(on(d.value,"span").length)throw new Me(2,2,2001,"<span> can only be inside <p> in TTML");return(t=Lm(i,t,n,s,a,r,o,u,h,null,!1))&&(t.backgroundColor||(t.backgroundColor="transparent"),e.push(t)),e},j("shaka.text.TtmlTextParser",Rm),Rm.prototype.parseMedia=Rm.prototype.parseMedia,Rm.prototype.setSequenceMode=Rm.prototype.setSequenceMode,Rm.prototype.parseInit=Rm.prototype.parseInit;var Hm=/^(\d{1,2}(?:\.\d+)?|100(?:\.0+)?)% (\d{1,2}(?:\.\d+)?|100(?:\.0+)?)%$/,Vm=/^(\d{1,2}(?:\.\d+)?|100)%$/,Wm=/^(\d+px|\d+em|\d*\.?\d+c)$/,Gm=/^(\d+)px (\d+)px$/,Xm=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,qm=/^(?:(\d{2,}):)?(\d{2}):(\d{2})$/,Ym=/^(?:(\d{2,}):)?(\d{2}):(\d{2}\.\d{2,})$/,$m=/^(\d*(?:\.\d*)?)f$/,Km=/^(\d*(?:\.\d*)?)t$/,Zm=RegExp("^(?:(\\d*(?:\\.\\d*)?)h)?(?:(\\d*(?:\\.\\d*)?)m)?(?:(\\d*(?:\\.\\d*)?)s)?(?:(\\d*(?:\\.\\d*)?)ms)?$"),Qm={left:fe,center:"center",right:"end",start:fe,end:"end"},Jm={left:"line-left",center:"center",right:"line-right"},e_=["http://www.w3.org/ns/ttml#parameter","http://www.w3.org/2006/10/ttaf1#parameter"],t_=["http://www.w3.org/ns/ttml#styling","http://www.w3.org/2006/10/ttaf1#styling"],i_=["http://www.smpte-ra.org/schemas/2052-1/2010/smpte-tt","http://www.smpte-ra.org/schemas/2052-1/2013/smpte-tt"];function r_(){this.g=new Rm}function n_(){this.g=!1}function s_(e){for(var t=l(Object.entries(_e)),i=t.next();!i.done;i=t.next()){var r=l(i.value);i=r.next().value,r=r.next().value;var n=new se(0,0,"");n.color=r,e.set("."+i,n)}for(i=(t=l(Object.entries(ve))).next();!i.done;i=t.next())i=(r=l(i.value)).next().value,r=r.next().value,(n=new se(0,0,"")).backgroundColor=r,e.set("."+i,n)}function a_(e,t,i){0===i.size&&s_(i);e:{var r=e;e=[];for(var n=-1,s="",a=0;a<r.length;a++)if("/"===r[a]&&0<a&&"<"===r[a-1]){var o=r.indexOf(">",a);if(o<=a){e=r;break e}if((o=r.substring(a+1,o))&&"c"===o){var h=e.pop();h?h===o?(s+="/"+o+">",a+=o.length+1):h.startsWith("c.")?(a+=o.length+1,s+="/"+h+">"):s+=r[a]:s+=r[a]}else s+=r[a]}else"<"===r[a]?"c"!=r[n=a+1]&&(n=-1):">"===r[a]&&0<n&&(e.push(r.substr(n,a-n)),n=-1),s+=r[a];e=s}for(r=[],s=-1,n=0;n<e.length;n++)"<"===e[n]?s=n+1:">"===e[n]&&0<s&&((s=e.substr(s,n-s)).match(d_)&&r.push(s),s=-1);for(n=(r=l(r)).next();!n.done;n=r.next())n=n.value,e=e.replace("<"+n+">",'<div time="'+n+'">'),e+="</div>";e:{for(n=e,s=[],a=-1,r="",e=!1,o=0;o<n.length;o++)if("/"===n[o]){if(-1===(h=n.indexOf(">",o))){e=n;break e}if((h=n.substring(o+1,h))&&"v"==h){e=!0;var u=null;if(s.length&&(u=s[s.length-1]),u){if(u===h)r+="/"+h+">";else{if(!u.startsWith("v")){r+=n[o];continue}r+="/"+u+">"}o+=h.length+1}else r+=n[o]}else r+=n[o]}else"<"===n[o]?"v"!=n[a=o+1]&&(a=-1):">"===n[o]&&0<a&&(s.push(n.substr(a,o-a)),a=-1),r+=n[o];for(s=(n=l(s)).next();!s.done;s=n.next())a=(s=s.value).replace(" ",".voice-"),r=(r=r.replace("<"+s+">","<"+a+">")).replace("</"+s+">","</"+a+">"),e||(r+="</"+a+">");e=r}if(n=wn("<span>"+e+"</span>","span")){if(r=[],1==(n=n.childNodes).length&&((s=n[0]).nodeType==Node.TEXT_NODE||s.nodeType==Node.CDATA_SECTION_NODE))return void(t.payload=c_(e));for(n=(e=l(n)).next();!n.done;n=e.next())h_(n.value,t,r,i);t.nestedCues=r}else t.payload=c_(e)}function o_(e,t){return e&&0<e.length?e:t}function h_(e,t,i,r){var n=t.clone();if(e.nodeType===Node.ELEMENT_NODE&&e.nodeName)for(var s=l(e.nodeName.split(/(?=[ .])+/g)),a=s.next();!a.done;a=s.next()){var o=a=a.value;if(o.startsWith(".voice-")){var h=o.split("-").pop();o='v[voice="'+h+'"]',r.has(o)||(o="v[voice="+h+"]")}switch(r.has(o)&&(o=r.get(o))&&(n.backgroundColor=o_(o.backgroundColor,n.backgroundColor),n.color=o_(o.color,n.color),n.fontFamily=o_(o.fontFamily,n.fontFamily),n.fontSize=o_(o.fontSize,n.fontSize),n.fontWeight=o.fontWeight,n.fontStyle=o.fontStyle,n.opacity=o.opacity,n.wrapLine=o.wrapLine),a){case"br":(a=t.clone()).lineBreak=!0,i.push(a);break;case"b":n.fontWeight=700;break;case"i":n.fontStyle="italic";break;case"u":n.textDecoration.push("underline");break;case"div":(a=e.getAttribute("time"))&&(a=l_(new Ld(a)))&&(n.startTime=a)}}if(dn(e))for(s=!0,r=l(e.textContent.split("\n")),e=r.next();!e.done;e=r.next())e=e.value,s||((s=t.clone()).lineBreak=!0,i.push(s)),0<e.length&&((s=n.clone()).payload=c_(e),i.push(s)),s=!1;else for(e=(t=l(e.childNodes)).next();!e.done;e=t.next())h_(e.value,n,i,r)}function u_(e,t,i){var r;(r=/^align:(start|middle|center|end|left|right)$/.exec(t))?(t=r[1],e.textAlign="middle"==t?he:ue[t.toUpperCase()]):(r=/^vertical:(lr|rl)$/.exec(t))?e.writingMode="lr"==r[1]?"vertical-lr":"vertical-rl":(r=/^size:([\d.]+)%$/.exec(t))?e.size=Number(r[1]):(r=/^position:([\d.]+)%(?:,(line-left|line-right|center|start|end))?$/.exec(t))?(e.position=Number(r[1]),r[2]&&(t=r[2],e.positionAlign="line-left"==t||"start"==t?"line-left":"line-right"==t||"end"==t?"line-right":"center")):(r=/^region:(.*)$/.exec(t))?(t=function(e,t){return e=e.filter((function(e){return e.id==t})),e.length?e[0]:null}(i,r[1]))&&(e.region=t):(i=/^line:([\d.]+)%(?:,(start|end|center))?$/.exec(t))?(e.lineInterpretation=1,e.line=Number(i[1]),i[2]&&(e.lineAlign=me[i[2].toUpperCase()])):(i=/^line:(-?\d+)(?:,(start|end|center))?$/.exec(t))&&(e.lineInterpretation=ge,e.line=Number(i[1]),i[2]&&(e.lineAlign=me[i[2].toUpperCase()]))}function l_(e){if(null==(e=Md(e,d_)))return null;var t=Number(e[2]),i=Number(e[3]);return 59<t||59<i?null:Number(e[4])/1e3+i+60*t+3600*(Number(e[1])||0)}function c_(e){var t={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&nbsp;":" ","&lrm;":"‎","&rlm;":"‏"},i=/&(?:amp|lt|gt|quot|#(0+)?39|nbsp|lrm|rlm);/g,r=RegExp(i.source);return e&&r.test(e)?e.replace(i,(function(e){return t[e]||"'"})):e||""}ei["application/ttml+xml"]=function(){return new Rm},r_.prototype.parseInit=function(e){var t=!1;if((new Xr).box("moov",qr).box("trak",qr).box("mdia",qr).box("minf",qr).box("stbl",qr).P("stsd",Yr).box("stpp",(function(e){t=!0,e.parser.stop()})).parse(e),!t)throw new Me(2,2,2007)},r_.prototype.setSequenceMode=function(){},r_.prototype.parseMedia=function(e,t){var i=this,r=!1,n=[];if((new Xr).box("mdat",Kr((function(e){r=!0,n=n.concat(i.g.parseMedia(e,t))}))).parse(e,!1),!r)throw new Me(2,2,2007);return n},j("shaka.text.Mp4TtmlParser",r_),r_.prototype.parseMedia=r_.prototype.parseMedia,r_.prototype.setSequenceMode=r_.prototype.setSequenceMode,r_.prototype.parseInit=r_.prototype.parseInit,ei['application/mp4; codecs="stpp"']=function(){return new r_},ei['application/mp4; codecs="stpp.ttml"']=function(){return new r_},ei['application/mp4; codecs="stpp.ttml.im1t"']=function(){return new r_},ei['application/mp4; codecs="stpp.TTML.im1t"']=function(){return new r_},n_.prototype.parseInit=function(){},n_.prototype.setSequenceMode=function(e){this.g=e},n_.prototype.parseMedia=function(e,t){var i=(e=(e=wt(e)).replace(/\r\n|\r(?=[^\n]|$)/gm,"\n")).split(/\n{2,}/m);if(!/^WEBVTT($|[ \t\n])/m.test(i[0]))throw new Me(2,2,2e3);if(e=t.vttOffset,i[0].includes("X-TIMESTAMP-MAP")&&this.g){var r=i[0].match(/LOCAL:((?:(\d{1,}):)?(\d{2}):(\d{2})\.(\d{3}))/m),n=i[0].match(/MPEGTS:(\d+)/m);if(r&&n){if(null==(e=l_(new Ld(r[1]))))throw new Me(2,2,2e3);for(n=Number(n[1]),r=t.segmentStart-t.periodStart;95443.7176888889<=r;)r-=95443.7176888889,n+=8589934592;e=t.periodStart+n/9e4-e}}for(t=[],r=(n=l(i[0].split("\n"))).next();!r.done;r=n.next())if(r=r.value,/^Region:/.test(r)){r=new Ld(r);var s=new we;Pd(r),kd(r);for(var a=Pd(r);a;){var o=s,h=a;(a=/^id=(.*)$/.exec(h))?o.id=a[1]:(a=/^width=(\d{1,2}|100)%$/.exec(h))?o.width=Number(a[1]):(a=/^lines=(\d+)$/.exec(h))?(o.height=Number(a[1]),o.heightUnits=2):(a=/^regionanchor=(\d{1,2}|100)%,(\d{1,2}|100)%$/.exec(h))?(o.regionAnchorX=Number(a[1]),o.regionAnchorY=Number(a[2])):(a=/^viewportanchor=(\d{1,2}|100)%,(\d{1,2}|100)%$/.exec(h))?(o.viewportAnchorX=Number(a[1]),o.viewportAnchorY=Number(a[2])):/^scroll=up$/.exec(h)&&(o.scroll="up"),kd(r),a=Pd(r)}t.push(s)}for(s_(n=new Map),r=[],s=(i=l(i.slice(1))).next();!s.done;s=i.next()){if((1!=(s=s.value.split("\n")).length||s[0])&&!/^NOTE($|[ \t])/.test(s[0])&&"STYLE"==s[0]){for(o=[],a=-1,h=1;h<s.length;h++)s[h].includes("::cue")&&(o.push([]),a=o.length-1),-1!=a&&(o[a].push(s[h]),s[h].includes("}")&&(a=-1));for(a=(o=l(o)).next();!a.done;a=o.next()){var u=a.value;a="global",(h=u[0].match(/\((.*)\)/))&&(a=h.pop()),h=u.slice(1,-1),u[0].includes("}")&&(u=/\{(.*?)\}/.exec(u[0]))&&(h=u[1].split(";")),(u=n.get(a))||(u=new se(0,0,""));for(var c=!1,d=0;d<h.length;d++){var p=/^\s*([^:]+):\s*(.*)/.exec(h[d]);if(p){var g=p[2].trim().replace(";","");switch(p[1].trim()){case"background-color":case"background":c=!0,u.backgroundColor=g;break;case"color":c=!0,u.color=g;break;case"font-family":c=!0,u.fontFamily=g;break;case"font-size":c=!0,u.fontSize=g;break;case"font-weight":(700<=parseInt(g,10)||"bold"==g)&&(c=!0,u.fontWeight=700);break;case"font-style":switch(g){case"normal":c=!0,u.fontStyle=xe;break;case"italic":c=!0,u.fontStyle="italic";break;case"oblique":c=!0,u.fontStyle="oblique"}break;case"opacity":c=!0,u.opacity=parseFloat(g);break;case"text-shadow":c=!0,u.textShadow=g;break;case"white-space":c=!0,u.wrapLine="noWrap"!=g}}}c&&n.set(a,u)}}if(c=e,1==s.length&&!s[0]||/^NOTE($|[ \t])/.test(s[0])||"STYLE"==s[0]||"REGION"==s[0])s=null;else{if(o=null,s[0].includes("--\x3e")||(o=s[0],s.splice(0,1)),h=l_(a=new Ld(s[0])),d=Md(a,/[ \t]+--\x3e[ \t]+/g),u=l_(a),null==h||null==d||null==u)throw new Me(2,2,2001,"Could not parse cue time range in WebVTT");for(h+=c,u+=c,c=s.slice(1).join("\n").trim(),n.has("global")?((s=n.get("global").clone()).startTime=h,s.endTime=u,s.payload=""):s=new se(h,u,""),a_(c,s,n),kd(a),h=Pd(a);h;)u_(s,h,t),kd(a),h=Pd(a);null!=o&&(s.id=o)}s&&r.push(s)}return r},j("shaka.text.VttTextParser",n_),n_.prototype.parseMedia=n_.prototype.parseMedia,n_.prototype.setSequenceMode=n_.prototype.setSequenceMode,n_.prototype.parseInit=n_.prototype.parseInit;var d_=/(?:(\d{1,}):)?(\d{2}):(\d{2})\.(\d{2,3})/g;function p_(){this.g=null}function g_(e,t,i){var r,n,s;return(new Xr).box("payl",Kr((function(e){r=wt(e)}))).box("iden",Kr((function(e){n=wt(e)}))).box("sttg",Kr((function(e){s=wt(e)}))).parse(e),r?function(e,t,i,r,n){if(r=new se(r,n,""),a_(e,r,new Map),t&&(r.id=t),i)for(e=new Ld(i),t=Pd(e);t;)u_(r,t,[]),kd(e),t=Pd(e);return r}(r,n,s,t,i):null}function f_(){}function m_(e){if(null==(e=Md(e,/(?:(\d{1,}):)?(\d{2}):(\d{2})\.(\d{2,3})/g)))return null;var t=Number(e[2]),i=Number(e[3]);return 59<t||59<i?null:Number(e[4])/1e3+i+60*t+3600*(Number(e[1])||0)}function __(){this.g=new n_}function v_(e){var t="WEBVTT\n\n";if(""==e)return t;for(var i=(e=l((e=(e=e.replace(/\r+/g,"")).trim()).split("\n\n"))).next();!i.done;i=e.next())(i=i.value.split(/\n/))[0].match(/\d+/)&&i.shift(),i[0]=i[0].replace(/,/g,"."),t+=i.join("\n")+"\n\n";return t}function y_(){}function x_(e,t){var i=t.Fontname;if(i&&(e.fontFamily=i),(i=t.Fontsize)&&(e.fontSize=i+"px"),(i=t.PrimaryColour)&&(i=b_(i))&&(e.color=i),(i=t.BackColour)&&(i=b_(i))&&(e.backgroundColor=i),t.Bold&&(e.fontWeight=700),t.Italic&&(e.fontStyle="italic"),t.Underline&&e.textDecoration.push("underline"),(i=t.Spacing)&&(e.letterSpacing=i+"px"),i=t.Alignment)switch(parseInt(i,10)){case 1:e.displayAlign=le,e.textAlign="start";break;case 2:e.displayAlign=le,e.textAlign=he;break;case 3:e.displayAlign=le,e.textAlign="end";break;case 5:e.displayAlign="before",e.textAlign="start";break;case 6:e.displayAlign="before",e.textAlign=he;break;case 7:e.displayAlign="before",e.textAlign="end";break;case 9:e.displayAlign="center",e.textAlign="start";break;case 10:e.displayAlign="center",e.textAlign=he;break;case 11:e.displayAlign="center",e.textAlign="end"}(t=t.AlphaLevel)&&(e.opacity=parseFloat(t))}function b_(e){return 0<=(e=parseInt(e.replace("&H",""),16))?"rgba("+(255&e)+","+(e>>8&255)+","+(e>>16&255)+","+(e>>24&255^255)/255+")":null}function w_(e){return 3600*((e=I_.exec(e))[1]?parseInt(e[1].replace(":",""),10):0)+60*parseInt(e[2],10)+parseFloat(e[3])}ei["text/vtt"]=function(){return new n_},ei['text/vtt; codecs="vtt"']=function(){return new n_},ei['text/vtt; codecs="wvtt"']=function(){return new n_},p_.prototype.parseInit=function(e){var t=this,i=!1;if((new Xr).box("moov",qr).box("trak",qr).box("mdia",qr).P("mdhd",(function(e){e=aa(e.reader,e.version),t.g=e.timescale})).box("minf",qr).box("stbl",qr).P("stsd",Yr).box("wvtt",(function(){i=!0})).parse(e),!this.g)throw new Me(2,2,2008);if(!i)throw new Me(2,2,2008)},p_.prototype.setSequenceMode=function(){},p_.prototype.parseMedia=function(e,t){if(!this.g)throw new Me(2,2,2008);var i,r=0,n=[],s=[],a=!1,o=!1,h=!1,u=null;if((new Xr).box("moof",qr).box("traf",qr).P("tfdt",(function(e){a=!0,r=sa(e.reader,e.version).we})).P("tfhd",(function(e){u=na(e.reader,e.flags).Ce})).P("trun",(function(e){o=!0,n=oa(e.reader,e.version,e.flags).Re})).box("mdat",Kr((function(e){h=!0,i=e}))).parse(e,!1),!h&&!a&&!o)throw new Me(2,2,2008);e=r;for(var c=new Vr(i,0),d=l(n),p=d.next();!p.done;p=d.next()){var g=(p=p.value).ee||u,f=p.ed?r+p.ed:e;e=f+(g||0);var m=0;do{var _=c.K();m+=_;var v=null;"vttc"==Qr(c.K())?8<_&&(v=c.Za(_-8)):c.skip(_-8),g&&v&&(_=g_(v,t.periodStart+f/this.g,t.periodStart+e/this.g),s.push(_))}while(p.sampleSize&&m<p.sampleSize)}return s.filter(Ke)},j("shaka.text.Mp4VttParser",p_),p_.prototype.parseMedia=p_.prototype.parseMedia,p_.prototype.setSequenceMode=p_.prototype.setSequenceMode,p_.prototype.parseInit=p_.prototype.parseInit,ei['application/mp4; codecs="wvtt"']=function(){return new p_},f_.prototype.parseInit=function(){},f_.prototype.setSequenceMode=function(){},f_.prototype.parseMedia=function(e){var t=wt(e).replace(/\r+/g,"");if(e=[],""==(t=t.trim()))return e;for(var i=(t=l(t.split("\n\n"))).next();!i.done;i=t.next()){var r=new Ld((i=i.value.split("\n"))[0]),n=m_(r),s=Md(r,/,/g);if(r=m_(r),null==n||null==s||null==r)throw new Me(2,2,2001,"Could not parse cue time range in SubViewer");e.push(new se(n,r,i.slice(1).join("\n").trim()))}return e},j("shaka.text.SbvTextParser",f_),f_.prototype.parseMedia=f_.prototype.parseMedia,f_.prototype.setSequenceMode=f_.prototype.setSequenceMode,f_.prototype.parseInit=f_.prototype.parseInit,ei["text/x-subviewer"]=function(){return new f_},__.prototype.parseInit=function(){},__.prototype.setSequenceMode=function(){},__.prototype.parseMedia=function(e,t){return e=Re(At(e=v_(e=wt(e)))),this.g.parseMedia(e,t)},j("shaka.text.SrtTextParser",__),__.srt2webvtt=v_,__.prototype.parseMedia=__.prototype.parseMedia,__.prototype.setSequenceMode=__.prototype.setSequenceMode,__.prototype.parseInit=__.prototype.parseInit,ei["text/srt"]=function(){return new __},y_.prototype.parseInit=function(){},y_.prototype.setSequenceMode=function(){},y_.prototype.parseMedia=function(e){for(var t="",i="",r=(e=l(e=wt(e).split(/\r?\n\s*\r?\n/))).next();!r.done;r=e.next()){var n=A_.exec(r.value);n&&(r=n[1],n=n[2],"V4 Styles"==r||"V4+ Styles"==r?t=n:"Events"==r&&(i=n))}e=[],r=null;for(var s=(t=l(t.split(/\r?\n/))).next();!s.done;s=t.next())if(n=s.value,!/^\s*;/.test(n)&&(s=C_.exec(n)))if(n=s[1].trim(),s=s[2].trim(),"Format"==n)r=s.split(E_);else if("Style"==n){n=s.split(E_),s={};for(var a=0;a<r.length&&a<n.length;a++)s[r[a]]=n[a];e.push(s)}for(r=[],t=null,n={},s=(i=l(i.split(/\r?\n/))).next();!s.done;n={vd:n.vd},s=i.next())if(s=s.value,!/^\s*;/.test(s)&&(a=C_.exec(s)))if(s=a[1].trim(),a=a[2].trim(),"Format"==s)t=a.split(E_);else if("Dialogue"==s){a=a.split(E_),s={};for(var o=0;o<t.length&&o<a.length;o++)s[t[o]]=a[o];a=new se(o=w_(s.Start),w_(s.End),a.slice(t.length-1).join(",").replace(/\\N/g,"\n").replace(/\{[^}]+\}/g,"")),n.vd=s.Style,(s=e.find(function(e){return function(t){return t.Name==e.vd}}(n)))&&x_(a,s),r.push(a)}return r},j("shaka.text.SsaTextParser",y_),y_.prototype.parseMedia=y_.prototype.parseMedia,y_.prototype.setSequenceMode=y_.prototype.setSequenceMode,y_.prototype.parseInit=y_.prototype.parseInit;var T_,S_,A_=/^\s*\[([^\]]+)\]\r?\n([\s\S]*)/,C_=/^\s*([^:]+):\s*(.*)/,E_=/\s*,\s*/,I_=/^(\d+:)?(\d{1,2}):(\d{1,2}(?:[.]\d{1,3})?)?$/;
/*
            	 @license
            	 EME Encryption Scheme Polyfill
            	 Copyright 2019 Google LLC
            	 SPDX-License-Identifier: Apache-2.0
            	*/
function R_(){}function L_(){T_?console.debug("EmeEncryptionSchemePolyfill: Already installed."):navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration?(T_=navigator.requestMediaKeySystemAccess,console.debug("EmeEncryptionSchemePolyfill: Waiting to detect encryptionScheme support."),navigator.requestMediaKeySystemAccess=k_):console.debug("EmeEncryptionSchemePolyfill: EME not found")}function k_(e,t){var i,r=this;return P((function(n){return 1==n.g?(console.assert(r==navigator,'bad "this" for requestMediaKeySystemAccess'),b(n,T_.call(r,e,t),2)):j_(i=n.h)?(console.debug("EmeEncryptionSchemePolyfill: Native encryptionScheme support found."),navigator.requestMediaKeySystemAccess=T_,n.return(i)):(console.debug("EmeEncryptionSchemePolyfill: No native encryptionScheme support found. Patching encryptionScheme support."),navigator.requestMediaKeySystemAccess=M_,n.return(M_.call(r,e,t)))}))}function M_(e,t){var i,r,n,s,a,o,h,u,c,d,p=this;return P((function(g){if(1==g.g){for(console.assert(p==navigator,'bad "this" for requestMediaKeySystemAccess'),i=B_(e),r=[],n=l(t),s=n.next();!s.done;s=n.next())a=s.value,o=P_(a.videoCapabilities,i),h=P_(a.audioCapabilities,i),a.videoCapabilities&&a.videoCapabilities.length&&!o.length||a.audioCapabilities&&a.audioCapabilities.length&&!h.length||((u=Object.assign({},a)).videoCapabilities=o,u.audioCapabilities=h,r.push(u));if(!r.length)throw(c=Error("Unsupported keySystem or supportedConfigurations.")).name="NotSupportedError",c.code=DOMException.NOT_SUPPORTED_ERR,c;return b(g,T_.call(p,e,r),2)}return d=g.h,g.return(new z_(d,i))}))}function P_(e,t){return e?e.filter((function(e){return!e.encryptionScheme||e.encryptionScheme==t})):e}function O_(){}function D_(){S_?console.debug("McEncryptionSchemePolyfill: Already installed."):navigator.mediaCapabilities?(S_=navigator.mediaCapabilities.decodingInfo,console.debug("McEncryptionSchemePolyfill: Waiting to detect encryptionScheme support."),navigator.mediaCapabilities.decodingInfo=N_):console.debug("McEncryptionSchemePolyfill: MediaCapabilities not found")}function N_(e){var t,i,r,n=this;return P((function(s){switch(s.g){case 1:return console.assert(n==navigator.mediaCapabilities,'bad "this" for decodingInfo'),b(s,S_.call(n,e),2);case 2:if(t=s.h,!e.keySystemConfiguration)return s.return(t);if((i=t.keySystemAccess)&&j_(i))return console.debug("McEncryptionSchemePolyfill: Native encryptionScheme support found."),navigator.mediaCapabilities.decodingInfo=S_,s.return(t);if(console.debug("McEncryptionSchemePolyfill: No native encryptionScheme support found. Patching encryptionScheme support."),navigator.mediaCapabilities.decodingInfo=F_,i){s.A(3);break}return r=t,b(s,U_(e),4);case 4:return r.keySystemAccess=s.h,s.return(t);case 3:return s.return(F_.call(n,e))}}))}function F_(e){var t,i,r,n,s,a,o,h,u=this;return P((function(l){switch(l.g){case 1:return console.assert(u==navigator.mediaCapabilities,'bad "this" for decodingInfo'),t=null,e.keySystemConfiguration&&(i=e.keySystemConfiguration,r=i.keySystem,n=i.audio&&i.audio.encryptionScheme,s=i.video&&i.video.encryptionScheme,t=B_(r),a={powerEfficient:!1,smooth:!1,supported:!1,keySystemAccess:null,configuration:e},n&&n!=t||s&&s!=t)?l.return(a):b(l,S_.call(u,e),2);case 2:if((o=l.h).keySystemAccess){o.keySystemAccess=new z_(o.keySystemAccess,t),l.A(3);break}if(!e.keySystemConfiguration){l.A(3);break}return h=o,b(l,U_(e),5);case 5:h.keySystemAccess=l.h;case 3:return l.return(o)}}))}function U_(e){var t,i;return P((function(r){if(1==r.g){var n=e.keySystemConfiguration,s=[],a=[];return n.audio&&s.push({robustness:n.audio.robustness||"",contentType:e.audio.contentType}),n.video&&a.push({robustness:n.video.robustness||"",contentType:e.video.contentType}),n={initDataTypes:n.initDataType?[n.initDataType]:[],distinctiveIdentifier:n.distinctiveIdentifier,persistentState:n.persistentState,sessionTypes:n.sessionTypes},s.length&&(n.audioCapabilities=s),a.length&&(n.videoCapabilities=a),t=n,b(r,navigator.requestMediaKeySystemAccess(e.keySystemConfiguration.keySystem,[t]),2)}return i=r.h,r.return(i)}))}function z_(e,t){this.h=e,this.g=t,this.keySystem=e.keySystem}function B_(e){return e.startsWith("com.widevine")||e.startsWith("com.microsoft")||e.startsWith("com.chromecast")||e.startsWith("com.adobe")||e.startsWith("org.w3")?"cenc":e.startsWith("com.apple")?"cbcs-1-9":(console.warn("EmeEncryptionSchemePolyfill: Unknown key system:",e,"Please contribute!"),null)}function j_(e){var t=(e=e.getConfiguration()).audioCapabilities&&e.audioCapabilities[0];return!(!(e=e.videoCapabilities&&e.videoCapabilities[0]||t)||void 0===e.encryptionScheme)}function H_(){}function V_(){L_(),D_()}ei["text/x-ssa"]=function(){return new y_},j("EmeEncryptionSchemePolyfill",R_),R_.install=L_,j("McEncryptionSchemePolyfill",O_),O_.install=D_,z_.prototype.getConfiguration=function(){var e=this.h.getConfiguration();if(e.videoCapabilities)for(var t=l(e.videoCapabilities),i=t.next();!i.done;i=t.next())i.value.encryptionScheme=this.g;if(e.audioCapabilities)for(i=(t=l(e.audioCapabilities)).next();!i.done;i=t.next())i.value.encryptionScheme=this.g;return e},z_.prototype.createMediaKeys=function(){return this.h.createMediaKeys()},j("EncryptionSchemePolyfills",H_),H_.install=V_,void 0!==i&&i.exports&&(i.exports=H_)}.call(i,t,t,void 0),i.shaka)e[r]=i.shaka[r]}()}(Uo);var zo=wi(Uo);class Bo extends mt.Component{constructor(){var e;super(...arguments),e=this,this.videoUrl="http://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4",this.index=1,this.contentId="",this._isPlaying=!0,this._toggleUI=()=>{this.tag("Wrapper").setSmooth("alpha",1);var e=Ji.setTimeout((()=>{this.tag("Wrapper").setSmooth("alpha",0),Ji.clearTimeout(e)}),4e3)},this._loadPlayback=function(){var i=r(t().mark((function i(r,n){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e._setupShakaPlayer(n),t.next=3,e._player.load(r);case 3:e._toggleUI();case 4:case"end":return t.stop()}}),i)})));return function(e,t){return i.apply(this,arguments)}}(),this._unloadPlayback=r(t().mark((function i(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e._player.unload();case 2:case"end":return t.stop()}}),i)})))}static _template(){return{Wrapper:{alpha:1,BackButton:{x:40,y:40,zIndex:99,type:co},PlayPause:{type:go}}}}set params(e){var t=e.id;this.contentId=t}_firstActive(){gi.consumer(this),gi.loader(this._loadPlayback),gi.unloader(this._unloadPlayback),this._toggleUI()}_init(){}_active(){gi.open(this.videoUrl),this._toggleUI()}_inactive(){gi.close()}_handleUp(){this.index>0&&(this.index-=1),this._toggleUI()}_handleDown(){this.index<1&&(this.index+=1),this._toggleUI()}_handleEnter(){if(0===this.index)vs.navigate(`content/railItem/${this.contentId}`);else if(1===this.index){var e=this.tag("PlayPause");e.isPlaying=!e.isPlaying,e.isPlaying?gi.play():gi.pause()}this._toggleUI()}_getFocused(){return this.tag("Wrapper").children[this.index]}_setupShakaPlayer(e){e.autoplay=!0,this._player=new zo.Player(e),console.log(this._player)}}class jo extends mt.Component{constructor(){super(...arguments),this.data={}}static _template(){return{rect:!0,color:xs.primary,shader:{type:mt.shaders.RoundedRectangle,radius:20},Image:{shader:{type:mt.shaders.RoundedRectangle,radius:20}},Label:{x:10,y:435,w:e=>e,color:xs.accentGrey.light,text:{fontSize:30}}}}set item(e){var t=e.label,i=e.src,r=e.data;this.data=r,this.patch({Image:{src:i},Label:{text:null==t?void 0:t.toString()}})}_handleEnter(){vs.navigate(`content/gridItem/${this.data.uid}`,{contentData:this.data,from:"Grid"})}_focus(){this.patch({smooth:{color:xs.secondary,scale:1.1},Label:{smooth:{color:xs.white}},Rectangle:{color:xs.yellow,x:10,y:e=>e+72,w:e=>e-20,h:5,rect:!0}})}_unfocus(){this.patch({smooth:{color:xs.primary,scale:1},Label:{smooth:{color:xs.accentGrey.light}},Rectangle:void 0})}}class Ho extends mt.Component{constructor(){super(...arguments),this.index=1,this.data=[],this.dataLength=0,this.intervalSub=0,this.isLoading=!0}static _template(){return{w:1920,h:1080,color:xs.primaryLight,rect:!0,shader:{x:100,y:-100,pivot:.5,type:mt.shaders.RadialGradient,outerColor:xs.primaryLight,innerColor:xs.dark,radius:800},BackButton:{x:40,y:40,shader:null,type:co},Content:{Grid:{x:110,y:200,columns:5,spacing:160,crossSpacing:50,itemType:jo,type:Ao}}}}_init(){this.setLongRail()}setLongRail(){var e=this;return r(t().mark((function i(){var r,n,s,a,o,h,u;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.isLoading=!0,t.next=3,yr.get("longData");case 3:for(e.data=t.sent,e.dataLength=e.data.length,r=[],n=0;n<e.dataLength;n++)h=null===(s=e.data[n])||void 0===s?void 0:s.title,u=null===(a=e.data[n])||void 0===a||null===(o=a.images.find((e=>288===e.width)))||void 0===o?void 0:o.url,r.push({w:288,h:432,item:{label:h,src:u||"https://pmd205470tn-a.akamaihd.net/D2C_-_Content/191/249/oyPcsfGWL5Se6RGW1JCVgpHlASH_288x432_13635141800.jpg",data:e.data[n]}});e.tag("Grid").add(r.map((e=>e))),e.isLoading=!1;case 9:case"end":return t.stop()}}),i)})))()}_getFocused(){return 0===this.index?this.tag("BackButton"):this.tag("Grid")}_handleUp(){this.index>0&&(this.index-=1)}_handleDown(){this.index<1&&(this.index+=1)}_handleEnter(){0===this.index&&vs.navigate("home")}}var Vo={root:"home",routes:[{path:"home",component:yo},{path:"search",component:Oo},{path:"grid",component:Ho},{path:"settings",component:yo},{path:"content/:from/:id",component:Fo,options:{reuseInstance:!1}},{path:"player/:id",component:Bo}]};class Wo extends vs.App{_setup(){vs.startRouter(Vo,this)}}var Go=((e,t,r,n)=>{var s;((e,t)=>{i.app=e,i.platform=t,i.user={}})(t,r),s=r,Ui=Vi(Wi(window.location.pathname,s.path||"/")),s.proxyUrl&&(zi=Vi(s.proxyUrl)),gr=a.get("platform","id"),fr=new _r,r.plugins&&(r.plugins.profile&&(e=>{Wt=e.getInfo?e.getInfo:Wt,Gt=e.setInfo?e.setInfo:Gt})(r.plugins.profile),r.plugins.metrics&&(e=>{Nt=e.sendMetric})(r.plugins.metrics),r.plugins.mediaPlayer&&(e=>{e.mediaUrl&&e.mediaUrl})(r.plugins.mediaPlayer),r.plugins.mediaPlayer&&(e=>{e.mediaUrl&&(ti=e.mediaUrl)})(r.plugins.mediaPlayer),r.plugins.ads&&(e=>{e.getAds&&(fi=e.getAds)})(r.plugins.ads),r.plugins.router&&(e=>{e.getHash&&(fs=e.getHash),e.setHash&&(ms=e.setHash)})(r.plugins.router),r.plugins.tv&&(e=>{Zt={},e.getChannel&&"function"==typeof e.getChannel&&(Zt.getChannel=e.getChannel),e.getProgram&&"function"==typeof e.getProgram&&(Zt.getProgram=e.getProgram),e.setChannel&&"function"==typeof e.setChannel&&(Zt.setChannel=e.setChannel),e.emit&&"function"==typeof e.emit&&e.emit(Kt)})(r.plugins.tv),r.plugins.purchase&&(e=>{e.billingUrl&&e.billingUrl})(r.plugins.purchase),r.plugins.pin&&(e=>{e.submit&&"function"==typeof e.submit&&e.submit,e.check&&"function"==typeof e.check&&e.check})(r.plugins.pin));var o=dr(e,0,r);return Dt.log=u,Dt.settings=a,Dt.ads=xi,Dt.lightning=mt,is=new o(t),Dt.appInstance=is,is})(Wo,{stage:{pauseRafLoopOnIdle:!0,fontSharp:!0},debug:!0,enablePointer:!0,keys:{38:"Up",40:"Down",37:"Left",39:"Right",13:"Enter",8:"Back",27:"Exit"}},{}),Xo=Go.stage.getCanvas();document.body.appendChild(Xo)}}}))}();
//# sourceMappingURL=index-legacy-67a63862.js.map
