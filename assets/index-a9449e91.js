function nM(){import.meta.url,import("_").catch(()=>1);async function*c(){}}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))a(u);new MutationObserver(u=>{for(const f of u)if(f.type==="childList")for(const m of f.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&a(m)}).observe(document,{childList:!0,subtree:!0});function n(u){const f={};return u.integrity&&(f.integrity=u.integrity),u.referrerPolicy&&(f.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?f.credentials="include":u.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function a(u){if(u.ep)return;u.ep=!0;const f=n(u);fetch(u.href,f)}})();const To={},fi={},sb=(c,t)=>{To.app=c,To.platform=t,To.user={}},ob=(c,t)=>{fi[c]&&fi[c].forEach(n=>n(t))},ab=(c={},t)=>{if(c===null)return;const n=t.split(".");for(let a=0;a<n.length;a++)c=c[n[a]]=c[n[a]]!==void 0?c[n[a]]:{};return typeof c=="object"&&c!==null?Object.keys(c).length?c:void 0:c},gi={get(c,t,n=void 0){const a=ab(To[c],t);return a!==void 0?a:n},has(c,t){return!!this.get(c,t)},set(c,t){To.user[c]=t,ob(c,t)},subscribe(c,t){fi[c]=fi[c]||[],fi[c].push(t)},unsubscribe(c,t){if(t){const n=fi[c]&&fi[c].findIndex(a=>a===t);n>-1&&fi[c].splice(n,1)}else c in fi&&(fi[c]=[])},clearSubscribers(){for(const c of Object.getOwnPropertyNames(fi))delete fi[c]}},Rl=(c,t)=>{const n={Info:"green",Debug:"gray",Warn:"orange",Error:"red"};return t=Array.from(t),["%c"+(t.length>1&&typeof t[0]=="string"?t.shift():c),"background-color: "+n[c]+"; color: white; padding: 2px 4px; border-radius: 2px",t]},ge={info(){gi.get("platform","log")&&console.log.apply(console,Rl("Info",arguments))},debug(){gi.get("platform","log")&&console.debug.apply(console,Rl("Debug",arguments))},error(){gi.get("platform","log")&&console.error.apply(console,Rl("Error",arguments))},warn(){gi.get("platform","log")&&console.warn.apply(console,Rl("Warn",arguments))}};class ye{static mergeNumbers(t,n,a){return t*a+n*(1-a)}static rgb(t,n,a){return(t<<16)+(n<<8)+a+255*16777216}static rgba(t,n,a,u){return(t<<16)+(n<<8)+a+(u*255|0)*16777216}static getRgbString(t){let n=(t/65536|0)%256,a=(t/256|0)%256,u=t%256;return"rgb("+n+","+a+","+u+")"}static getRgbaString(t){let n=(t/65536|0)%256,a=(t/256|0)%256,u=t%256,f=(t/16777216|0)/255;return"rgba("+n+","+a+","+u+","+f.toFixed(4)+")"}static getRgbaStringFromArray(t){let n=Math.floor(t[0]*255),a=Math.floor(t[1]*255),u=Math.floor(t[2]*255),f=Math.floor(t[3]*255)/255;return"rgba("+n+","+a+","+u+","+f.toFixed(4)+")"}static getRgbaComponentsNormalized(t){let n=(t/65536|0)%256,a=(t/256|0)%256,u=t%256,f=t/16777216|0;return[n/255,a/255,u/255,f/255]}static getRgbComponentsNormalized(t){let n=(t/65536|0)%256,a=(t/256|0)%256,u=t%256;return[n/255,a/255,u/255]}static getRgbaComponents(t){let n=(t/65536|0)%256,a=(t/256|0)%256,u=t%256,f=t/16777216|0;return[n,a,u,f]}static getArgbNumber(t){t[0]=Math.max(0,Math.min(255,t[0])),t[1]=Math.max(0,Math.min(255,t[1])),t[2]=Math.max(0,Math.min(255,t[2])),t[3]=Math.max(0,Math.min(255,t[3]));let n=((t[3]|0)<<24)+((t[0]|0)<<16)+((t[1]|0)<<8)+(t[2]|0);return n<0&&(n=4294967295+n+1),n}static mergeColors(t,n,a){let u=(t/65536|0)%256,f=(t/256|0)%256,m=t%256,p=t/16777216|0,x=(n/65536|0)%256,T=(n/256|0)%256,A=n%256,b=n/16777216|0,I=u*a+x*(1-a),D=f*a+T*(1-a),v=m*a+A*(1-a),O=p*a+b*(1-a);return Math.round(O)*16777216+Math.round(I)*65536+Math.round(D)*256+Math.round(v)}static mergeMultiColors(t,n){let a=0,u=0,f=0,m=0,p=0,x=t.length;for(let T=0;T<x;T++){let A=(t[T]/65536|0)%256,b=(t[T]/256|0)%256,I=t[T]%256,D=t[T]/16777216|0;a+=A*n[T],u+=b*n[T],f+=I*n[T],m+=D*n[T],p+=n[T]}return p=1/p,Math.round(m*p)*16777216+Math.round(a*p)*65536+Math.round(u*p)*256+Math.round(f*p)}static mergeMultiColorsEqual(t){let n=0,a=0,u=0,f=0,m=0,p=t.length;for(let x=0;x<p;x++){let T=(t[x]/65536|0)%256,A=(t[x]/256|0)%256,b=t[x]%256,I=t[x]/16777216|0;n+=T,a+=A,u+=b,f+=I,m+=1}return m=1/m,Math.round(f*m)*16777216+Math.round(n*m)*65536+Math.round(a*m)*256+Math.round(u*m)}static mergeColorAlpha(t,n){let a=(t/16777216|0)*n|0;return((t>>16&255)*a/255&255)+((t&65280)*a/255&65280)+(((t&255)<<16)*a/255&16711680)+(a<<24)}static rad(t){return t*(Math.PI/180)}static getTimingBezier(t,n,a,u){let f=3*t,m=3*(a-t)-f,p=1-f-m,x=3*n,T=3*(u-n)-x,A=1-x-T;return function(b){if(b>=1)return 1;if(b<=0)return 0;let I=.5,D,v,O;for(let re=0;re<20;re++){if(D=I*(I*(I*p+m)+f),O=b-D,O>-1e-8&&O<1e-8)return I*(I*(I*A+T)+x);if(v=I*(I*(3*p)+2*m)+f,v>1e-10&&v<1e-10)break;I+=O/v}let W=0,Z=1;for(let re=0;re<20;re++){if(I=.5*(W+Z),D=I*(I*(I*p+m)+f),O=b-D,O>-1e-8&&O<1e-8)return I*(I*(I*A+T)+x);O<0?Z=I:W=I}}}static getTimingFunction(t){switch(t){case"linear":return function(a){return a};case"ease":return ye.getTimingBezier(.25,.1,.25,1);case"ease-in":return ye.getTimingBezier(.42,0,1,1);case"ease-out":return ye.getTimingBezier(0,0,.58,1);case"ease-in-out":return ye.getTimingBezier(.42,0,.58,1);case"step-start":return function(){return 1};case"step-end":return function(a){return a===1?1:0};default:let n="cubic-bezier(";if(t&&t.indexOf(n)===0){let a=t.substr(n.length,t.length-n.length-1).split(",");if(a.length!==4)return console.warn("[Lightning] Unknown timing function: "+t),function(x){return x};let u=parseFloat(a[0]),f=parseFloat(a[1]),m=parseFloat(a[2]),p=parseFloat(a[3]);return isNaN(u)||isNaN(f)||isNaN(m)||isNaN(p)?(console.warn("[Lightning] Unknown timing function: "+t),function(x){return x}):ye.getTimingBezier(u,f,m,p)}else return console.warn("[Lightning] Unknown timing function: "+t),function(a){return a}}}}let X=class Xt{static isFunction(t){return typeof t=="function"}static isNumber(t){return typeof t=="number"}static isInteger(t){return typeof t=="number"&&t%1===0}static isBoolean(t){return t===!0||t===!1}static isString(t){return typeof t=="string"}static clone(t){return Xt.isObjectLiteral(t)||Array.isArray(t)?Xt.getDeepClone(t):t}static cloneObjShallow(t){let n=Object.keys(t),a={};for(let u=0;u<n.length;u++)a[n[u]]=t[n[u]];return a}static merge(t,n){let a=Object.keys(n);for(let u=0;u<a.length;u++)t[a[u]]=n[a[u]];return t}static isObject(t){let n=typeof t;return!!t&&(n==="object"||n==="function")}static isPlainObject(t){return!!t&&typeof t==="object"}static isObjectLiteral(t){return typeof t=="object"&&t&&t.constructor===Object}static getArrayIndex(t,n){return Xt.getModuloIndex(t,n.length)}static getModuloIndex(t,n){if(n===0)return t;for(;t<0;)t+=Math.ceil(-t/n)*n;return t=t%n,t}static getDeepClone(t){let n,a;if(Xt.isFunction(t))return t;if(Array.isArray(t)){a=[];let u=Object.keys(t);for(n=0;n<u.length;n++)a[u[n]]=Xt.getDeepClone(t[u[n]]);return a}else if(Xt.isObject(t)){a={};let u=Object.keys(t);for(n=0;n<u.length;n++)a[u[n]]=Xt.getDeepClone(t[u[n]]);return a}else return t}static equalValues(t,n){return typeof t!=typeof n?!1:Xt.isObjectLiteral(t)?Xt.isObjectLiteral(n)&&Xt.equalObjectLiterals(t,n):Array.isArray(t)?Array.isArray(n)&&Xt.equalArrays(t,n):t===n}static equalObjectLiterals(t,n){let a=Object.keys(t),u=Object.keys(n);if(a.length!==u.length)return!1;for(let f=0,m=a.length;f<m;f++){const p=a[f],x=u[f];if(p!==x)return!1;const T=t[p],A=n[x];if(!Xt.equalValues(T,A))return!1}return!0}static equalArrays(t,n){if(t.length!==n.length)return!1;for(let a=0,u=t.length;a<u;a++)if(!this.equalValues(t[a],n[a]))return!1;return!0}static setToArray(t){let n=[];return t.forEach(function(a){n.push(a)}),n}static iteratorToArray(t){let n=[],a=t.next();for(;!a.done;)n.push(a.value),a=t.next();return n}static isUcChar(t){return t>=65&&t<=90}};X.isWeb=typeof window<"u"&&typeof sparkscene>"u";X.isWPE=X.isWeb&&navigator.userAgent.indexOf("WPE")!==-1;X.isSpark=typeof sparkscene<"u";X.isNode=typeof window>"u"||X.isSpark;X.isPS4=X.isWeb&&navigator.userAgent.indexOf("PlayStation 4")!==-1;X.isZiggo=X.isWeb&&(navigator.userAgent.indexOf("EOSSTB")!==-1||navigator.userAgent.indexOf("HZNSTB")!==-1);class Ct{static defaultSetter(t,n,a){t[n]=a}static patchObject(t,n){if(!X.isObjectLiteral(n))console.error("[Lightning] Settings must be object literal");else{let a=Object.keys(n);for(let u=0,f=a.length;u<f;u++){let m=a[u];this.patchObjectProperty(t,m,n[m])}}}static patchObjectProperty(t,n,a){let u=t.setSetting||Ct.defaultSetter;n.charAt(0)==="_"?n!=="__create"&&console.error("[Lightning] Patch of private property '"+n+"' is not allowed"):n!=="type"&&(X.isFunction(a)&&a.__local&&(a=a.__local(t)),u(t,n,a))}static local(t){t.__local=!0}}class Ov{static getSpacing(t,n,a){const u=n-1;let f,m,p;switch(t){case"flex-start":m=0,p=0;break;case"flex-end":m=a,p=0;break;case"center":m=a/2,p=0;break;case"space-between":m=0,p=Math.max(0,a)/u;break;case"space-around":if(a<0)return this.getSpacing("center",n,a);f=a/(u+1),m=.5*f,p=f;break;case"space-evenly":if(a<0)return this.getSpacing("center",n,a);f=a/(u+2),m=f,p=f;break;case"stretch":m=0,p=0;break;default:throw new Error("Unknown mode: "+t)}return{spacingBefore:m,spacingBetween:p}}}class lb{constructor(t){this._layout=t,this._totalCrossAxisSize=0}get _lines(){return this._layout._lines}init(){this._totalCrossAxisSize=this._getTotalCrossAxisSize()}align(){const n=this._layout.crossAxisSize-this._totalCrossAxisSize,{spacingBefore:a,spacingBetween:u}=this._getSpacing(n),f=this._lines,m=this._layout._flexContainer.alignContent;let p=0;m==="stretch"&&f.length&&n>0&&(p=n/f.length);let x=a;for(let T=0,A=f.length;T<A;T++){const b=x,I=f[T].createItemAligner();let D=f[T].crossAxisLayoutSize+p;I.setCrossAxisLayoutSize(D),I.setCrossAxisLayoutOffset(b),I.align(),I.recursiveResizeOccured&&f[T].setItemPositions(),x+=D,x+=u}}get totalCrossAxisSize(){return this._totalCrossAxisSize}_getTotalCrossAxisSize(){const t=this._lines;let n=0;for(let a=0,u=t.length;a<u;a++){const f=t[a];n+=f.crossAxisLayoutSize}return n}_getSpacing(t){const n=this._layout._flexContainer.alignContent,a=this._lines.length;return Ov.getSpacing(n,a,t)}}class Ce{static getParentAxisSizeWithPadding(t,n){const u=t.target.getParent();if(u){const f=t.flexParent;return f?this.getAxisLayoutSize(f,n)+this.getTotalPadding(f,n):n?u.w:u.h}else return 0}static getRelAxisSize(t,n){return n?t.funcW?this._allowRelAxisSizeFunction(t,!0)?t.funcW(this.getParentAxisSizeWithPadding(t,!0)):0:t.originalWidth:t.funcH?this._allowRelAxisSizeFunction(t,!1)?t.funcH(this.getParentAxisSizeWithPadding(t,!1)):0:t.originalHeight}static _allowRelAxisSizeFunction(t,n){const a=t.flexParent;return!(a&&a._flex._layout.isAxisFitToContents(n))}static isZeroAxisSize(t,n){return n?!t.originalWidth&&!t.funcW:!t.originalHeight&&!t.funcH}static getAxisLayoutPos(t,n){return n?t.x:t.y}static getAxisLayoutSize(t,n){return n?t.w:t.h}static setAxisLayoutPos(t,n,a){n?t.x=a:t.y=a}static setAxisLayoutSize(t,n,a){n?t.w=a:t.h=a}static getAxisMinSize(t,n){let a=this.getPlainAxisMinSize(t,n),u=0;return t.isFlexItemEnabled()&&(u=t._flexItem._getMinSizeSetting(n)),u>0&&(a=Math.max(a,u)),a}static getPlainAxisMinSize(t,n){return t.isFlexEnabled()?t._flex._layout.getAxisMinSize(n):t.flexItem.shrink!==0?0:this.getRelAxisSize(t,n)}static resizeAxis(t,n,a){t.isFlexEnabled()?t._flex._horizontal===n?t._flex._layout.resizeMainAxis(a):t._flex._layout.resizeCrossAxis(a):this.setAxisLayoutSize(t,n,a)}static getPaddingOffset(t,n){if(t.isFlexEnabled()){const a=t._flex;return n?a.paddingLeft:a.paddingTop}else return 0}static getTotalPadding(t,n){if(t.isFlexEnabled()){const a=t._flex;return n?a.paddingRight+a.paddingLeft:a.paddingTop+a.paddingBottom}else return 0}static getMarginOffset(t,n){const a=t.flexItem;return a?n?a.marginLeft:a.marginTop:0}static getTotalMargin(t,n){const a=t.flexItem;return a?n?a.marginRight+a.marginLeft:a.marginTop+a.marginBottom:0}}class ub{constructor(t){this._line=t,this._amountRemaining=0,this._shrunkSize=0}shrink(t){this._shrunkSize=0,this._amountRemaining=t;let n=this._getTotalShrinkAmount();if(n){const a=this._line.items;do{let u=this._amountRemaining/n;for(let f=this._line.startIndex;f<=this._line.endIndex;f++){const p=a[f].flexItem,x=p.shrink;if(x>0){let A=x*u;const b=p._getMainAxisMinSize(),I=p._getMainAxisLayoutSize();if(I>b){const D=I-b;A>=D&&(A=D,n-=x);const O=I-A;if(p._resizeMainAxis(O),this._shrunkSize+=A,this._amountRemaining-=A,Math.abs(this._amountRemaining)<1e-5)return}}}}while(n&&Math.abs(this._amountRemaining)>1e-5)}}_getTotalShrinkAmount(){let t=0;const n=this._line.items;for(let a=this._line.startIndex;a<=this._line.endIndex;a++){const f=n[a].flexItem;if(f.shrink){const m=f._getMainAxisMinSize();f._getMainAxisLayoutSize()>m&&(t+=f.shrink)}}return t}getShrunkSize(){return this._shrunkSize}}class hb{constructor(t){this._line=t,this._amountRemaining=0,this._grownSize=0}grow(t){this._grownSize=0,this._amountRemaining=t;let n=this._getTotalGrowAmount();if(n){const a=this._line.items;do{let u=this._amountRemaining/n;for(let f=this._line.startIndex;f<=this._line.endIndex;f++){const p=a[f].flexItem,x=p.grow;if(x>0){let A=x*u;const b=p._getMainAxisMaxSizeSetting(),I=p._getMainAxisLayoutSize();if(b>0)if(I>=b)A=0;else{const D=b-I;A>=D&&(A=D,n-=x)}if(A>0){const D=I+A;if(p._resizeMainAxis(D),this._grownSize+=A,this._amountRemaining-=A,Math.abs(this._amountRemaining)<1e-5)return}}}}while(n&&Math.abs(this._amountRemaining)>1e-5)}}_getTotalGrowAmount(){let t=0;const n=this._line.items;for(let a=this._line.startIndex;a<=this._line.endIndex;a++){const f=n[a].flexItem;if(f.grow){const m=f._getMainAxisMaxSizeSetting(),p=f._getMainAxisLayoutSize();(m===0||p<m)&&(t+=f.grow)}}return t}getGrownSize(){return this._grownSize}}class cb{constructor(t){this._line=t}get _layout(){return this._line._layout}position(){const{spacingBefore:t,spacingBetween:n}=this._getSpacing();let a=t;const u=this._line.items;for(let f=this._line.startIndex;f<=this._line.endIndex;f++){const m=u[f];m.flexItem._setMainAxisLayoutPos(a),a+=m.flexItem._getMainAxisLayoutSizeWithPaddingAndMargin(),a+=n}}_getSpacing(){const t=this._line._availableSpace;let n=this._layout._flexContainer.justifyContent;const a=this._line.numberOfItems;return Ov.getSpacing(n,a,t)}}class db{constructor(t){this._line=t,this._crossAxisLayoutSize=0,this._crossAxisLayoutOffset=0,this._alignItemsSetting=null,this._recursiveResizeOccured=!1,this._isCrossAxisFitToContents=!1}get _layout(){return this._line._layout}get _flexContainer(){return this._layout._flexContainer}setCrossAxisLayoutSize(t){this._crossAxisLayoutSize=t}setCrossAxisLayoutOffset(t){this._crossAxisLayoutOffset=t}align(){this._alignItemsSetting=this._flexContainer.alignItems,this._isCrossAxisFitToContents=this._layout.isAxisFitToContents(!this._flexContainer._horizontal),this._recursiveResizeOccured=!1;const t=this._line.items;for(let n=this._line.startIndex;n<=this._line.endIndex;n++){const a=t[n];this._alignItem(a)}}get recursiveResizeOccured(){return this._recursiveResizeOccured}_alignItem(t){const n=t.flexItem;let a=n.alignSelf||this._alignItemsSetting;switch(a==="stretch"&&this._preventStretch(n)&&(a="flex-start"),a!=="stretch"&&!this._isCrossAxisFitToContents&&n._hasRelCrossAxisSize()&&n._resetCrossAxisLayoutSize(),a){case"flex-start":this._alignItemFlexStart(n);break;case"flex-end":this._alignItemFlexEnd(n);break;case"center":this._alignItemFlexCenter(n);break;case"stretch":this._alignItemStretch(n);break}}_alignItemFlexStart(t){t._setCrossAxisLayoutPos(this._crossAxisLayoutOffset)}_alignItemFlexEnd(t){const n=t._getCrossAxisLayoutSizeWithPaddingAndMargin();t._setCrossAxisLayoutPos(this._crossAxisLayoutOffset+(this._crossAxisLayoutSize-n))}_alignItemFlexCenter(t){const n=t._getCrossAxisLayoutSizeWithPaddingAndMargin(),a=(this._crossAxisLayoutSize-n)/2;t._setCrossAxisLayoutPos(this._crossAxisLayoutOffset+a)}_alignItemStretch(t){t._setCrossAxisLayoutPos(this._crossAxisLayoutOffset);const n=t._getMainAxisLayoutSize();let a=this._crossAxisLayoutSize-t._getCrossAxisMargin()-t._getCrossAxisPadding();const u=t._getCrossAxisMinSizeSetting();u>0&&(a=Math.max(a,u));const f=t._getCrossAxisMaxSizeSetting();f>0&&(a=Math.min(a,f)),t._resizeCrossAxis(a),t._getMainAxisLayoutSize()!==n&&(this._recursiveResizeOccured=!0)}_preventStretch(t){const n=t._hasFixedCrossAxisSize(),a=t.alignSelf==="stretch";return n&&!a}}class fb{constructor(t,n,a,u){this._layout=t,this.items=t.items,this.startIndex=n,this.endIndex=a,this._availableSpace=u}performLayout(){this._setItemSizes(),this.setItemPositions(),this._calcLayoutInfo()}_setItemSizes(){this._availableSpace>0?this._growItemSizes(this._availableSpace):this._availableSpace<0&&this._shrinkItemSizes(-this._availableSpace)}_growItemSizes(t){const n=new hb(this);n.grow(t),this._availableSpace-=n.getGrownSize()}_shrinkItemSizes(t){const n=new ub(this);n.shrink(t),this._availableSpace+=n.getShrunkSize()}setItemPositions(){new cb(this).position()}createItemAligner(){return new db(this)}_calcLayoutInfo(){this._calcCrossAxisMaxLayoutSize()}getMainAxisMinSize(){let t=0;for(let n=this.startIndex;n<=this.endIndex;n++){const a=this.items[n];t+=a.flexItem._getMainAxisMinSizeWithPaddingAndMargin()}return t}get numberOfItems(){return this.endIndex-this.startIndex+1}get crossAxisLayoutSize(){const t=this._layout.isCrossAxisFitToContents()&&!this._layout.resizingCrossAxis;return this._layout.isWrapping()||t?this._crossAxisMaxLayoutSize:this._layout.crossAxisSize}_calcCrossAxisMaxLayoutSize(){this._crossAxisMaxLayoutSize=this._getCrossAxisMaxLayoutSize()}_getCrossAxisMaxLayoutSize(){let t=0;for(let n=this.startIndex;n<=this.endIndex;n++){const a=this.items[n];t=Math.max(t,a.flexItem._getCrossAxisLayoutSizeWithPaddingAndMargin())}return t}}class pb{constructor(t){this._layout=t,this._mainAxisMinSize=-1,this._crossAxisMinSize=-1,this._mainAxisContentSize=0}get lines(){return this._lines}get mainAxisMinSize(){return this._mainAxisMinSize===-1&&(this._mainAxisMinSize=this._getMainAxisMinSize()),this._mainAxisMinSize}get crossAxisMinSize(){return this._crossAxisMinSize===-1&&(this._crossAxisMinSize=this._getCrossAxisMinSize()),this._crossAxisMinSize}get mainAxisContentSize(){return this._mainAxisContentSize}layoutLines(){this._setup();const t=this._layout.items,n=this._layout.isWrapping();let a=0,u;const f=t.length;for(u=0;u<f;u++){const m=t[u];this._layoutFlexItem(m);const p=m.flexItem._getMainAxisLayoutSizeWithPaddingAndMargin();n&&u>a&&this._curMainAxisPos+p>this._mainAxisSize&&(this._layoutLine(a,u-1),this._curMainAxisPos=0,a=u),this._addToMainAxisPos(p)}a<u&&this._layoutLine(a,u-1)}_layoutFlexItem(t){t.isFlexEnabled()?t.flexLayout.updateTreeLayout():t.flexItem._resetLayoutSize()}_setup(){this._mainAxisSize=this._layout.mainAxisSize,this._curMainAxisPos=0,this._maxMainAxisPos=0,this._lines=[],this._mainAxisMinSize=-1,this._crossAxisMinSize=-1,this._mainAxisContentSize=0}_addToMainAxisPos(t){this._curMainAxisPos+=t,this._curMainAxisPos>this._maxMainAxisPos&&(this._maxMainAxisPos=this._curMainAxisPos)}_layoutLine(t,n){const a=this._getAvailableMainAxisLayoutSpace(),u=new fb(this._layout,t,n,a);u.performLayout(),this._lines.push(u),(this._mainAxisContentSize===0||this._curMainAxisPos>this._mainAxisContentSize)&&(this._mainAxisContentSize=this._curMainAxisPos)}_getAvailableMainAxisLayoutSpace(){return!this._layout.resizingMainAxis&&this._layout.isMainAxisFitToContents()?0:this._mainAxisSize-this._curMainAxisPos}_getCrossAxisMinSize(){let t=0;const n=this._layout.items;for(let a=0,u=n.length;a<u;a++){const m=n[a].flexItem._getCrossAxisMinSizeWithPaddingAndMargin();t=Math.max(t,m)}return t}_getMainAxisMinSize(){return this._lines.length===1?this._lines[0].getMainAxisMinSize():this._layout.mainAxisSize}}class Vl{constructor(t){this._layout=t,this._isReverse=this._flexContainer._reverse,this._horizontalPaddingOffset=this._layout._getHorizontalPaddingOffset(),this._verticalPaddingOffset=this._layout._getVerticalPaddingOffset()}get _flexContainer(){return this._layout._flexContainer}finalize(){const t=this._layout.getParentFlexContainer();t?new Vl(t._layout)._finalizeItemAndChildren(this._flexContainer.item):(this._finalizeRoot(),this._finalizeItems())}_finalizeRoot(){const t=this._flexContainer.item;let n=Ce.getAxisLayoutPos(t,!0),a=Ce.getAxisLayoutPos(t,!1),u=Ce.getAxisLayoutSize(t,!0),f=Ce.getAxisLayoutSize(t,!1);u+=this._layout._getHorizontalPadding(),f+=this._layout._getVerticalPadding(),t.clearRecalcFlag(),t.setLayout(n,a,u,f)}_finalizeItems(){const t=this._layout.items;for(let n=0,a=t.length;n<a;n++){const u=t[n],f=this._validateItemCache(u);this._finalizeItem(u),f||this._finalizeItemChildren(u)}}_validateItemCache(t){if(t.recalc===0&&t.isFlexEnabled()){const n=t._flex._layout;if(t.w===t.target.w&&t.h===t.target.h)return!0;{const u=n.crossAxisSize;n.performResizeMainAxis(n.mainAxisSize),n.performResizeCrossAxis(u)}}return!1}_finalizeItemAndChildren(t){this._finalizeItem(t),this._finalizeItemChildren(t)}_finalizeItem(t){this._isReverse&&this._reverseMainAxisLayoutPos(t);let n=Ce.getAxisLayoutPos(t,!0),a=Ce.getAxisLayoutPos(t,!1),u=Ce.getAxisLayoutSize(t,!0),f=Ce.getAxisLayoutSize(t,!1);n+=this._horizontalPaddingOffset,a+=this._verticalPaddingOffset,t.flex&&(u+=t._flex._layout._getHorizontalPadding(),f+=t._flex._layout._getVerticalPadding());const p=t.flexItem;p&&(n+=p._getHorizontalMarginOffset(),a+=p._getVerticalMarginOffset()),t.clearRecalcFlag(),t.setLayout(n,a,u,f)}_finalizeItemChildren(t){const n=t._flex;n&&new Vl(n._layout)._finalizeItems()}_reverseMainAxisLayoutPos(t){const n=t.flexItem._getMainAxisLayoutPos()+t.flexItem._getMainAxisLayoutSizeWithPaddingAndMargin(),a=this._layout.mainAxisSize-n;t.flexItem._setMainAxisLayoutPos(a)}}class gb{constructor(t){this._flexContainer=t,this._lineLayouter=new pb(this),this._resizingMainAxis=!1,this._resizingCrossAxis=!1,this._cachedMainAxisSizeAfterLayout=0,this._cachedCrossAxisSizeAfterLayout=0,this._shrunk=!1}get shrunk(){return this._shrunk}get recalc(){return this.item.recalc}layoutTree(){this.item.flexParent!==null?this._updateSubTreeLayout():this.updateTreeLayout(),this.updateItemCoords()}updateTreeLayout(){this.recalc?this._performUpdateLayoutTree():this._performUpdateLayoutTreeFromCache()}_performUpdateLayoutTree(){this._setInitialAxisSizes(),this._layoutAxes(),this._refreshLayoutCache()}_refreshLayoutCache(){this._cachedMainAxisSizeAfterLayout=this.mainAxisSize,this._cachedCrossAxisSizeAfterLayout=this.crossAxisSize}_performUpdateLayoutTreeFromCache(){this.item.funcW||this.item.funcH?(this.item.enableLocalRecalcFlag(),this._performUpdateLayoutTree()):(this.mainAxisSize=this._cachedMainAxisSizeAfterLayout,this.crossAxisSize=this._cachedCrossAxisSizeAfterLayout)}updateItemCoords(){new Vl(this).finalize()}_updateSubTreeLayout(){const t=this.crossAxisSize;this._layoutMainAxis(),this.performResizeCrossAxis(t)}_setInitialAxisSizes(){this.item.isFlexItemEnabled()?this.item.flexItem._resetLayoutSize():(this.mainAxisSize=this._getMainAxisBasis(),this.crossAxisSize=this._getCrossAxisBasis()),this._resizingMainAxis=!1,this._resizingCrossAxis=!1,this._shrunk=!1}_layoutAxes(){this._layoutMainAxis(),this._layoutCrossAxis()}_layoutMainAxis(){this._layoutLines(),this._fitMainAxisSizeToContents()}_layoutLines(){this._lineLayouter.layoutLines()}get _lines(){return this._lineLayouter.lines}_fitMainAxisSizeToContents(){this._resizingMainAxis||this.isMainAxisFitToContents()&&(this.mainAxisSize=this._lineLayouter.mainAxisContentSize)}_layoutCrossAxis(){const t=new lb(this);t.init(),this._totalCrossAxisSize=t.totalCrossAxisSize,this._fitCrossAxisSizeToContents(),t.align()}_fitCrossAxisSizeToContents(){this._resizingCrossAxis||this.isCrossAxisFitToContents()&&(this.crossAxisSize=this._totalCrossAxisSize)}isWrapping(){return this._flexContainer.wrap}isAxisFitToContents(t){return this._horizontal===t?this.isMainAxisFitToContents():this.isCrossAxisFitToContents()}isMainAxisFitToContents(){return!this.isWrapping()&&!this._hasFixedMainAxisBasis()}isCrossAxisFitToContents(){return!this._hasFixedCrossAxisBasis()}_hasFixedMainAxisBasis(){return!Ce.isZeroAxisSize(this.item,this._horizontal)}_hasFixedCrossAxisBasis(){return!Ce.isZeroAxisSize(this.item,!this._horizontal)}getAxisMinSize(t){return this._horizontal===t?this._getMainAxisMinSize():this._getCrossAxisMinSize()}_getMainAxisMinSize(){return this._lineLayouter.mainAxisMinSize}_getCrossAxisMinSize(){return this._lineLayouter.crossAxisMinSize}resizeMainAxis(t){this.mainAxisSize!==t&&(this.recalc>0?this.performResizeMainAxis(t):this._checkValidCacheMainAxisResize()?(this.mainAxisSize=t,this._fitCrossAxisSizeToContents()):(this.item.enableLocalRecalcFlag(),this.performResizeMainAxis(t)))}_checkValidCacheMainAxisResize(t){return t===this.targetMainAxisSize||!this.isCrossAxisFitToContents()}performResizeMainAxis(t){const n=t<this.mainAxisSize;this._shrunk=n,this.mainAxisSize=t,this._resizingMainAxis=!0,this._layoutAxes(),this._resizingMainAxis=!1}resizeCrossAxis(t){this.crossAxisSize!==t&&(this.recalc>0?this.performResizeCrossAxis(t):this.crossAxisSize=t)}performResizeCrossAxis(t){this.crossAxisSize=t,this._resizingCrossAxis=!0,this._layoutCrossAxis(),this._resizingCrossAxis=!1}get targetMainAxisSize(){return this._horizontal?this.item.target.w:this.item.target.h}get targetCrossAxisSize(){return this._horizontal?this.item.target.h:this.item.target.w}getParentFlexContainer(){return this.item.isFlexItemEnabled()?this.item.flexItem.ctr:null}_getHorizontalPadding(){return Ce.getTotalPadding(this.item,!0)}_getVerticalPadding(){return Ce.getTotalPadding(this.item,!1)}_getHorizontalPaddingOffset(){return Ce.getPaddingOffset(this.item,!0)}_getVerticalPaddingOffset(){return Ce.getPaddingOffset(this.item,!1)}_getMainAxisBasis(){return Ce.getRelAxisSize(this.item,this._horizontal)}_getCrossAxisBasis(){return Ce.getRelAxisSize(this.item,!this._horizontal)}get _horizontal(){return this._flexContainer._horizontal}get _reverse(){return this._flexContainer._reverse}get item(){return this._flexContainer.item}get items(){return this.item.items}get resizingMainAxis(){return this._resizingMainAxis}get resizingCrossAxis(){return this._resizingCrossAxis}get numberOfItems(){return this.items.length}get mainAxisSize(){return Ce.getAxisLayoutSize(this.item,this._horizontal)}get crossAxisSize(){return Ce.getAxisLayoutSize(this.item,!this._horizontal)}set mainAxisSize(t){Ce.setAxisLayoutSize(this.item,this._horizontal,t)}set crossAxisSize(t){Ce.setAxisLayoutSize(this.item,!this._horizontal,t)}}class $t{constructor(t){this._item=t,this._layout=new gb(this),this._horizontal=!0,this._reverse=!1,this._wrap=!1,this._alignItems="stretch",this._justifyContent="flex-start",this._alignContent="flex-start",this._paddingLeft=0,this._paddingTop=0,this._paddingRight=0,this._paddingBottom=0}get item(){return this._item}_changedDimensions(){this._item.changedDimensions()}_changedContents(){this._item.changedContents()}get direction(){return(this._horizontal?"row":"column")+(this._reverse?"-reverse":"")}set direction(t){this.direction!==t&&(this._horizontal=t==="row"||t==="row-reverse",this._reverse=t==="row-reverse"||t==="column-reverse",this._changedContents())}set wrap(t){this._wrap=t,this._changedContents()}get wrap(){return this._wrap}get alignItems(){return this._alignItems}set alignItems(t){if(this._alignItems!==t){if($t.ALIGN_ITEMS.indexOf(t)===-1)throw new Error("Unknown alignItems, options: "+$t.ALIGN_ITEMS.join(","));this._alignItems=t,this._changedContents()}}get alignContent(){return this._alignContent}set alignContent(t){if(this._alignContent!==t){if($t.ALIGN_CONTENT.indexOf(t)===-1)throw new Error("Unknown alignContent, options: "+$t.ALIGN_CONTENT.join(","));this._alignContent=t,this._changedContents()}}get justifyContent(){return this._justifyContent}set justifyContent(t){if(this._justifyContent!==t){if($t.JUSTIFY_CONTENT.indexOf(t)===-1)throw new Error("Unknown justifyContent, options: "+$t.JUSTIFY_CONTENT.join(","));this._justifyContent=t,this._changedContents()}}set padding(t){this.paddingLeft=t,this.paddingTop=t,this.paddingRight=t,this.paddingBottom=t}get padding(){return this.paddingLeft}set paddingLeft(t){this._paddingLeft=t,this._changedDimensions()}get paddingLeft(){return this._paddingLeft}set paddingTop(t){this._paddingTop=t,this._changedDimensions()}get paddingTop(){return this._paddingTop}set paddingRight(t){this._paddingRight=t,this._changedDimensions()}get paddingRight(){return this._paddingRight}set paddingBottom(t){this._paddingBottom=t,this._changedDimensions()}get paddingBottom(){return this._paddingBottom}patch(t){Ct.patchObject(this,t)}}$t.ALIGN_ITEMS=["flex-start","flex-end","center","stretch"];$t.ALIGN_CONTENT=["flex-start","flex-end","center","space-between","space-around","space-evenly","stretch"];$t.JUSTIFY_CONTENT=["flex-start","flex-end","center","space-between","space-around","space-evenly"];class Eo{constructor(t){this._ctr=null,this._item=t,this._grow=0,this._shrink=Eo.SHRINK_AUTO,this._alignSelf=void 0,this._minWidth=0,this._minHeight=0,this._maxWidth=0,this._maxHeight=0,this._marginLeft=0,this._marginTop=0,this._marginRight=0,this._marginBottom=0}get item(){return this._item}get grow(){return this._grow}set grow(t){this._grow!==t&&(this._grow=parseInt(t)||0,this._changed())}get shrink(){return this._shrink===Eo.SHRINK_AUTO?this._getDefaultShrink():this._shrink}_getDefaultShrink(){return this.item.isFlexEnabled()?1:0}set shrink(t){this._shrink!==t&&(this._shrink=parseInt(t)||0,this._changed())}get alignSelf(){return this._alignSelf}set alignSelf(t){if(this._alignSelf!==t){if(t===void 0)this._alignSelf=void 0;else{if($t.ALIGN_ITEMS.indexOf(t)===-1)throw new Error("Unknown alignSelf, options: "+$t.ALIGN_ITEMS.join(","));this._alignSelf=t}this._changed()}}get minWidth(){return this._minWidth}set minWidth(t){this._minWidth=Math.max(0,t),this._item.changedDimensions(!0,!1)}get minHeight(){return this._minHeight}set minHeight(t){this._minHeight=Math.max(0,t),this._item.changedDimensions(!1,!0)}get maxWidth(){return this._maxWidth}set maxWidth(t){this._maxWidth=Math.max(0,t),this._item.changedDimensions(!0,!1)}get maxHeight(){return this._maxHeight}set maxHeight(t){this._maxHeight=Math.max(0,t),this._item.changedDimensions(!1,!0)}set margin(t){this.marginLeft=t,this.marginTop=t,this.marginRight=t,this.marginBottom=t}get margin(){return this.marginLeft}set marginLeft(t){this._marginLeft=t,this._changed()}get marginLeft(){return this._marginLeft}set marginTop(t){this._marginTop=t,this._changed()}get marginTop(){return this._marginTop}set marginRight(t){this._marginRight=t,this._changed()}get marginRight(){return this._marginRight}set marginBottom(t){this._marginBottom=t,this._changed()}get marginBottom(){return this._marginBottom}_changed(){this.ctr&&this.ctr._changedContents()}set ctr(t){this._ctr=t}get ctr(){return this._ctr}patch(t){Ct.patchObject(this,t)}_resetLayoutSize(){this._resetHorizontalAxisLayoutSize(),this._resetVerticalAxisLayoutSize()}_resetCrossAxisLayoutSize(){this.ctr._horizontal?this._resetVerticalAxisLayoutSize():this._resetHorizontalAxisLayoutSize()}_resetHorizontalAxisLayoutSize(){let t=Ce.getRelAxisSize(this.item,!0);this._minWidth&&(t=Math.max(this._minWidth,t)),this._maxWidth&&(t=Math.min(this._maxWidth,t)),Ce.setAxisLayoutSize(this.item,!0,t)}_resetVerticalAxisLayoutSize(){let t=Ce.getRelAxisSize(this.item,!1);this._minHeight&&(t=Math.max(this._minHeight,t)),this._maxHeight&&(t=Math.min(this._maxHeight,t)),Ce.setAxisLayoutSize(this.item,!1,t)}_getCrossAxisMinSizeSetting(){return this._getMinSizeSetting(!this.ctr._horizontal)}_getCrossAxisMaxSizeSetting(){return this._getMaxSizeSetting(!this.ctr._horizontal)}_getMainAxisMaxSizeSetting(){return this._getMaxSizeSetting(this.ctr._horizontal)}_getMinSizeSetting(t){return t?this._minWidth:this._minHeight}_getMaxSizeSetting(t){return t?this._maxWidth:this._maxHeight}_getMainAxisMinSize(){return Ce.getAxisMinSize(this.item,this.ctr._horizontal)}_getCrossAxisMinSize(){return Ce.getAxisMinSize(this.item,!this.ctr._horizontal)}_getMainAxisLayoutSize(){return Ce.getAxisLayoutSize(this.item,this.ctr._horizontal)}_getMainAxisLayoutPos(){return Ce.getAxisLayoutPos(this.item,this.ctr._horizontal)}_setMainAxisLayoutPos(t){return Ce.setAxisLayoutPos(this.item,this.ctr._horizontal,t)}_setCrossAxisLayoutPos(t){return Ce.setAxisLayoutPos(this.item,!this.ctr._horizontal,t)}_getCrossAxisLayoutSize(){return Ce.getAxisLayoutSize(this.item,!this.ctr._horizontal)}_resizeCrossAxis(t){return Ce.resizeAxis(this.item,!this.ctr._horizontal,t)}_resizeMainAxis(t){return Ce.resizeAxis(this.item,this.ctr._horizontal,t)}_getMainAxisPadding(){return Ce.getTotalPadding(this.item,this.ctr._horizontal)}_getCrossAxisPadding(){return Ce.getTotalPadding(this.item,!this.ctr._horizontal)}_getMainAxisMargin(){return Ce.getTotalMargin(this.item,this.ctr._horizontal)}_getCrossAxisMargin(){return Ce.getTotalMargin(this.item,!this.ctr._horizontal)}_getHorizontalMarginOffset(){return Ce.getMarginOffset(this.item,!0)}_getVerticalMarginOffset(){return Ce.getMarginOffset(this.item,!1)}_getMainAxisMinSizeWithPaddingAndMargin(){return this._getMainAxisMinSize()+this._getMainAxisPadding()+this._getMainAxisMargin()}_getCrossAxisMinSizeWithPaddingAndMargin(){return this._getCrossAxisMinSize()+this._getCrossAxisPadding()+this._getCrossAxisMargin()}_getMainAxisLayoutSizeWithPaddingAndMargin(){return this._getMainAxisLayoutSize()+this._getMainAxisPadding()+this._getMainAxisMargin()}_getCrossAxisLayoutSizeWithPaddingAndMargin(){return this._getCrossAxisLayoutSize()+this._getCrossAxisPadding()+this._getCrossAxisMargin()}_hasFixedCrossAxisSize(){return!Ce.isZeroAxisSize(this.item,!this.ctr._horizontal)}_hasRelCrossAxisSize(){return!!(this.ctr._horizontal?this.item.funcH:this.item.funcW)}}Eo.SHRINK_AUTO=-1;class mb{constructor(t){this._target=t,this._recalc=0,this._enabled=!1,this.x=0,this.y=0,this.w=0,this.h=0,this._originalX=0,this._originalY=0,this._originalWidth=0,this._originalHeight=0,this._flex=null,this._flexItem=null,this._flexItemDisabled=!1,this._items=null}get flexLayout(){return this.flex?this.flex._layout:null}layoutFlexTree(){this.isFlexEnabled()&&this.isChanged()&&this.flexLayout.layoutTree()}get target(){return this._target}get flex(){return this._flex}set flex(t){t?(this.isFlexEnabled()||this._enableFlex(),this._flex.patch(t)):this.isFlexEnabled()&&this._disableFlex()}get flexItem(){return this._flexItemDisabled?!1:(this._ensureFlexItem(),this._flexItem)}set flexItem(t){if(t===!1){if(!this._flexItemDisabled){const n=this.flexParent;this._flexItemDisabled=!0,this._checkEnabled(),n&&(n._clearFlexItemsCache(),n.changedContents())}}else if(this._ensureFlexItem(),this._flexItem.patch(t),this._flexItemDisabled){this._flexItemDisabled=!1,this._checkEnabled();const n=this.flexParent;n&&(n._clearFlexItemsCache(),n.changedContents())}}_enableFlex(){this._flex=new $t(this),this._checkEnabled(),this.changedDimensions(),this._enableChildrenAsFlexItems()}_disableFlex(){this.changedDimensions(),this._flex=null,this._checkEnabled(),this._disableChildrenAsFlexItems()}_enableChildrenAsFlexItems(){const t=this._target._children;if(t)for(let n=0,a=t.length;n<a;n++)t[n].layout._enableFlexItem()}_disableChildrenAsFlexItems(){const t=this._target._children;if(t)for(let n=0,a=t.length;n<a;n++)t[n].layout._disableFlexItem()}_enableFlexItem(){this._ensureFlexItem();const t=this._target._parent._layout;this._flexItem.ctr=t._flex,t.changedContents(),this._checkEnabled()}_disableFlexItem(){this._flexItem&&(this._flexItem.ctr=null),this._checkEnabled(),this._resetOffsets()}_resetOffsets(){this.x=0,this.y=0}_ensureFlexItem(){this._flexItem||(this._flexItem=new Eo(this))}_checkEnabled(){const t=this.isEnabled();this._enabled!==t&&(t?this._enable():this._disable(),this._enabled=t)}_enable(){this._setupTargetForFlex(),this._target.enableFlexLayout()}_disable(){this._restoreTargetToNonFlex(),this._target.disableFlexLayout()}isEnabled(){return this.isFlexEnabled()||this.isFlexItemEnabled()}isFlexEnabled(){return this._flex!==null}isFlexItemEnabled(){return this.flexParent!==null}_restoreTargetToNonFlex(){const t=this._target;t.x=this._originalX,t.y=this._originalY,t.setDimensions(this._originalWidth,this._originalHeight)}_setupTargetForFlex(){const t=this._target;this._originalX=t._x,this._originalY=t._y,this._originalWidth=t._w,this._originalHeight=t._h}setParent(t,n){t&&t.isFlexContainer()&&t._layout._changedChildren(),n&&n.isFlexContainer()&&(this._enableFlexItem(),n._layout._changedChildren()),this._checkEnabled()}get flexParent(){if(this._flexItemDisabled)return null;const t=this._target._parent;return t&&t.isFlexContainer()?t._layout:null}setVisible(t){const n=this.flexParent;n&&n._changedChildren()}get items(){return this._items||(this._items=this._getFlexItems()),this._items}_getFlexItems(){const t=[],n=this._target._children;if(n)for(let a=0,u=n.length;a<u;a++){const f=n[a];f.visible&&f.isFlexItem()&&t.push(f.layout)}return t}_changedChildren(){this._clearFlexItemsCache(),this.changedContents()}_clearFlexItemsCache(){this._items=null}setLayout(t,n,a,u){let f=this._originalX,m=this._originalY;this.funcX&&(f=this.funcX(Ce.getParentAxisSizeWithPadding(this,!0))),this.funcY&&(m=this.funcY(Ce.getParentAxisSizeWithPadding(this,!1))),this.isFlexItemEnabled()?this.target.setLayout(t+f,n+m,a,u):this.target.setLayout(f,m,a,u)}changedDimensions(t=!0,n=!0){this._updateRecalc(t,n)}changedContents(){this._updateRecalc()}forceLayout(){this._updateRecalc()}isChanged(){return this._recalc>0}_updateRecalc(t=!1,n=!1){if(this.isFlexEnabled()){const f=this._flex._layout;t=t||f.isAxisFitToContents(!0),n=n||f.isAxisFitToContents(!1)}const a=1+(t?2:0)+(n?4:0),u=this.getNewRecalcFlags(a);this._recalc|=a,u>1?this.flexParent?this.flexParent._updateRecalcBottomUp(a):this._target.triggerLayout():this._target.triggerLayout()}getNewRecalcFlags(t){return 7-this._recalc&t}_updateRecalcBottomUp(t){const n=this._getRecalcFromChangedChildRecalc(t),a=this.getNewRecalcFlags(n);if(this._recalc|=n,a>1){const u=this.flexParent;u?u._updateRecalcBottomUp(n):this._target.triggerLayout()}else this._target.triggerLayout()}_getRecalcFromChangedChildRecalc(t){const n=this._flex._layout,a=n._horizontal?1:2,u=n._horizontal?2:1;t&u||t&a&&n.isWrapping()&&n.isCrossAxisFitToContents()&&(t+=u);let m=n.isAxisFitToContents(!0),p=n.isAxisFitToContents(!1);n.shrunk&&(n._horizontal?m=!0:p=!0);const x=1+(m?2:0)+(p?4:0);return t&x}get recalc(){return this._recalc}clearRecalcFlag(){this._recalc=0}enableLocalRecalcFlag(){this._recalc=1}get originalX(){return this._originalX}setOriginalXWithoutUpdatingLayout(t){this._originalX=t}get originalY(){return this._originalY}setOriginalYWithoutUpdatingLayout(t){this._originalY=t}get originalWidth(){return this._originalWidth}set originalWidth(t){this._originalWidth!==t&&(this._originalWidth=t,this.changedDimensions(!0,!1))}get originalHeight(){return this._originalHeight}set originalHeight(t){this._originalHeight!==t&&(this._originalHeight=t,this.changedDimensions(!1,!0))}get funcX(){return this._target.funcX}get funcY(){return this._target.funcY}get funcW(){return this._target.funcW}get funcH(){return this._target.funcH}}class us{constructor(t,n=null){this.id=us.id++,this.manager=t,this.stage=t.stage,this.textures=new Set,this._activeTextureCount=0,this.loader=n,this.lookupId=null,this._cancelCb=null,this.loadingSince=0,this.w=0,this.h=0,this._nativeTexture=null,this.permanent=!1,this.renderInfo=null,this._isResultTexture=!this.loader,this._loadError=null,this._imageRef=null,this._hasAlpha=!1}get hasAlpha(){return this._hasAlpha}get loadError(){return this._loadError}addTexture(t){this.textures.has(t)||this.textures.add(t)}removeTexture(t){this.textures.delete(t)}incActiveTextureCount(){this._activeTextureCount++,this._activeTextureCount===1&&this.becomesUsed()}decActiveTextureCount(){this._activeTextureCount--,this._activeTextureCount===0&&this.becomesUnused()}get isResultTexture(){return this._isResultTexture}set isResultTexture(t){this._isResultTexture=t}forEachEnabledElement(t){this.textures.forEach(n=>{n.elements.forEach(t)})}hasEnabledElements(){return this.textures.size>0}forEachActiveElement(t){this.textures.forEach(n=>{n.elements.forEach(a=>{a.active&&t(a)})})}getRenderWidth(){return this.w}getRenderHeight(){return this.h}allowCleanup(){return!this.permanent&&!this.isUsed()}becomesUsed(){this.load()}becomesUnused(){this.cancel()}cancel(){this.isLoading()&&(this._cancelCb&&(this._cancelCb(this),this._cancelCb=null),this.loadingSince=0)}isLoaded(){return!!this._nativeTexture}isLoading(){return this.loadingSince>0}isError(){return!!this._loadError}reload(){this.free(),this.isUsed()&&this.load()}load(t=!1){this.isResultTexture||!this._nativeTexture&&!this.isLoading()&&(this.loadingSince=new Date().getTime(),this._cancelCb=this.loader((n,a)=>{if(this.isLoading()){if(this._cancelCb=null,this.manager.stage.destroyed)return;if(n)this.onError(n);else if(a&&a.source)if(!this.stage.isUpdatingFrame()&&!t&&a.throttle!==!1){const u=this.stage.textureThrottler;this._cancelCb=u.genericCancelCb,u.add(this,a)}else this.processLoadedSource(a)}},this))}processLoadedSource(t){this.loadingSince=0,this.setSource(t)}setSource(t){const n=t.source;this._hasAlpha=t&&t.hasAlpha||!1,this.w=n.width||t&&t.w||0,this.h=n.height||t&&t.h||0,t&&t.renderInfo&&(this.renderInfo=t.renderInfo),this.permanent=!!t.permanent,t&&t.imageRef&&(this._imageRef=t.imageRef),t&&t.flipTextureY?this._flipTextureY=t.flipTextureY:this._flipTextureY=!1,this._isNativeTexture(n)?(this._nativeTexture=n,this.w=this.w||n.w,this.h=this.h||n.h,this.permanent=t.hasOwnProperty("permanent")?t.permanent:!0):this.manager.uploadTextureSource(this,t),this._loadError=null,this.onLoad()}isUsed(){return this._activeTextureCount>0}onLoad(){this.isUsed()&&this.textures.forEach(t=>{t.onLoad()})}forceRenderUpdate(){this._nativeTexture&&(this._nativeTexture.update=this.stage.frameCounter),this.forEachActiveElement(function(t){t.forceRenderUpdate()})}forceUpdateRenderCoords(){this.forEachActiveElement(function(t){t._updateTextureCoords()})}get nativeTexture(){return this._nativeTexture}clearNativeTexture(){this._nativeTexture=null,this._imageRef=null}replaceNativeTexture(t,n,a){let u=this._nativeTexture;this._nativeTexture=t,this.w=n,this.h=a,!u&&this._nativeTexture&&this.forEachActiveElement(f=>f.onTextureSourceLoaded()),this._nativeTexture||this.forEachActiveElement(f=>f._setDisplayedTexture(null)),this.forEachEnabledElement(f=>f._updateDimensions())}onError(t){this._loadError=t,this.loadingSince=0,console.error("[Lightning] texture load error",t,this.lookupId),this.forEachActiveElement(n=>n.onTextureSourceLoadError(t))}free(){this.isLoaded()&&this.manager.freeTextureSource(this)}_isNativeTexture(t){return X.isNode?t.constructor.name==="WebGLTexture":"WebGLTexture"in window?t instanceof WebGLTexture:!1}}us.prototype.isTextureSource=!0;us.id=1;class Fv{constructor(t){this._element=t.element,this._core=t,this.ctx=this._core.ctx,this._enabled=!1,this.lazy=!1,this._colorize=!1,this._renderTexture=null,this._renderTextureReused=!1,this._resultTextureSource=null,this._renderOffscreen=!1,this.empty=!1}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this._core.updateRenderToTextureEnabled()}get renderOffscreen(){return this._renderOffscreen}set renderOffscreen(t){this._renderOffscreen=t,this._core.setHasRenderUpdates(1),this._core._setRecalc(6)}get colorize(){return this._colorize}set colorize(t){this._colorize!==t&&(this._colorize=t,this._core.setHasRenderUpdates(1))}_getTextureSource(){return this._resultTextureSource||(this._resultTextureSource=new us(this._element.stage.textureManager),this.updateResultTexture()),this._resultTextureSource}hasResultTexture(){return!!this._resultTextureSource}resultTextureInUse(){return this._resultTextureSource&&this._resultTextureSource.hasEnabledElements()}updateResultTexture(){let t=this.getResultTexture();if(this._resultTextureSource){if(this._resultTextureSource.nativeTexture!==t){let n=t?t.w:0,a=t?t.h:0;this._resultTextureSource.replaceNativeTexture(t,n,a)}this._resultTextureSource.forEachEnabledElement(n=>{n._updateDimensions(),n.core.setHasRenderUpdates(3)})}}mustRenderToTexture(){return this._enabled&&!this.lazy?!0:!!(this._enabled&&this.lazy&&this._core._hasRenderUpdates<3)}deactivate(){this.release()}get renderTextureReused(){return this._renderTextureReused}release(){this.releaseRenderTexture()}releaseRenderTexture(){this._renderTexture&&(this._renderTextureReused||this.ctx.releaseRenderTexture(this._renderTexture),this._renderTexture=null,this._renderTextureReused=!1,this.updateResultTexture())}reuseTextureAsRenderTexture(t){this._renderTexture!==t&&(this.releaseRenderTexture(),this._renderTexture=t,this._renderTextureReused=!0)}hasRenderTexture(){return!!this._renderTexture}getRenderTexture(){return this._renderTexture||(this._renderTexture=this.ctx.allocateRenderTexture(this._core._w,this._core._h),this._renderTextureReused=!1),this._renderTexture}getResultTexture(){return this._renderTexture}}class fn{constructor(t){this._element=t,this.ctx=t.stage.ctx,this._recalc=0,this._parent=null,this._onUpdate=null,this._pRecalc=0,this._worldContext=new hn,this._hasUpdates=!1,this._localAlpha=1,this._onAfterCalcs=null,this._onAfterUpdate=null,this._localPx=0,this._localPy=0,this._localTa=1,this._localTb=0,this._localTc=0,this._localTd=1,this._isComplex=!1,this._dimsUnknown=!1,this._clipping=!1,this._zSort=!1,this._outOfBounds=0,this._displayedTextureSource=null,this._zContextUsage=0,this._children=null,this._hasRenderUpdates=0,this._zIndexedChildren=null,this._renderContext=this._worldContext,this.renderState=this.ctx.renderState,this._scissor=null,this._shaderOwner=null,this._updateTreeOrder=0,this._colorUl=this._colorUr=this._colorBl=this._colorBr=4294967295,this._x=0,this._y=0,this._w=0,this._h=0,this._optFlags=0,this._funcX=null,this._funcY=null,this._funcW=null,this._funcH=null,this._scaleX=1,this._scaleY=1,this._pivotX=.5,this._pivotY=.5,this._mountX=0,this._mountY=0,this._rotation=0,this._alpha=1,this._visible=!0,this._ulx=0,this._uly=0,this._brx=1,this._bry=1,this._zIndex=0,this._forceZIndexContext=!1,this._zParent=null,this._isRoot=!1,this._zIndexResort=!1,this._shader=null,this._renderToTextureEnabled=!1,this._texturizer=null,this._useRenderToTexture=!1,this._boundsMargin=null,this._recBoundsMargin=null,this._withinBoundsMargin=!1,this._viewport=null,this._clipbox=!0,this.render=this._renderSimple,this._layout=null}get offsetX(){return this._funcX?this._funcX:this.hasFlexLayout()?this._layout.originalX:this._x}set offsetX(t){X.isFunction(t)?this.funcX=t:(this._disableFuncX(),this.hasFlexLayout()?(this.x+=t-this._layout.originalX,this._layout.setOriginalXWithoutUpdatingLayout(t)):this.x=t)}get x(){return this._x}set x(t){t!==this._x&&(this._updateLocalTranslateDelta(t-this._x,0),this._x=t)}get funcX(){return this._optFlags&1?this._funcX:null}set funcX(t){this._funcX!==t&&(this._optFlags|=1,this._funcX=t,this.hasFlexLayout()?(this._layout.setOriginalXWithoutUpdatingLayout(0),this.layout.forceLayout()):(this._x=0,this._triggerRecalcTranslate()))}_disableFuncX(){this._optFlags=this._optFlags&65535-1,this._funcX=null}get offsetY(){return this._funcY?this._funcY:this.hasFlexLayout()?this._layout.originalY:this._y}set offsetY(t){X.isFunction(t)?this.funcY=t:(this._disableFuncY(),this.hasFlexLayout()?(this.y+=t-this._layout.originalY,this._layout.setOriginalYWithoutUpdatingLayout(t)):this.y=t)}get y(){return this._y}set y(t){t!==this._y&&(this._updateLocalTranslateDelta(0,t-this._y),this._y=t)}get funcY(){return this._optFlags&2?this._funcY:null}set funcY(t){this._funcY!==t&&(this._optFlags|=2,this._funcY=t,this.hasFlexLayout()?(this._layout.setOriginalYWithoutUpdatingLayout(0),this.layout.forceLayout()):(this._y=0,this._triggerRecalcTranslate()))}_disableFuncY(){this._optFlags=this._optFlags&65535-2,this._funcY=null}get funcW(){return this._optFlags&4?this._funcW:null}set funcW(t){this._funcW!==t&&(this._optFlags|=4,this._funcW=t,this.hasFlexLayout()?(this._layout._originalWidth=0,this.layout.changedDimensions(!0,!1)):(this._w=0,this._triggerRecalcTranslate()))}disableFuncW(){this._optFlags=this._optFlags&65535-4,this._funcW=null}get funcH(){return this._optFlags&8?this._funcH:null}set funcH(t){this._funcH!==t&&(this._optFlags|=8,this._funcH=t,this.hasFlexLayout()?(this._layout._originalHeight=0,this.layout.changedDimensions(!1,!0)):(this._h=0,this._triggerRecalcTranslate()))}disableFuncH(){this._optFlags=this._optFlags&65535-8,this._funcH=null}get w(){return this._w}getRenderWidth(){return this.hasFlexLayout()?this._layout.originalWidth:this._w}get h(){return this._h}getRenderHeight(){return this.hasFlexLayout()?this._layout.originalHeight:this._h}get scaleX(){return this._scaleX}set scaleX(t){this._scaleX!==t&&(this._scaleX=t,this._updateLocalTransform())}get scaleY(){return this._scaleY}set scaleY(t){this._scaleY!==t&&(this._scaleY=t,this._updateLocalTransform())}get scale(){return this.scaleX}set scale(t){(this._scaleX!==t||this._scaleY!==t)&&(this._scaleX=t,this._scaleY=t,this._updateLocalTransform())}get pivotX(){return this._pivotX}set pivotX(t){this._pivotX!==t&&(this._pivotX=t,this._updateLocalTranslate())}get pivotY(){return this._pivotY}set pivotY(t){this._pivotY!==t&&(this._pivotY=t,this._updateLocalTranslate())}get pivot(){return this._pivotX}set pivot(t){(this._pivotX!==t||this._pivotY!==t)&&(this._pivotX=t,this._pivotY=t,this._updateLocalTranslate())}get mountX(){return this._mountX}set mountX(t){this._mountX!==t&&(this._mountX=t,this._updateLocalTranslate())}get mountY(){return this._mountY}set mountY(t){this._mountY!==t&&(this._mountY=t,this._updateLocalTranslate())}get mount(){return this._mountX}set mount(t){(this._mountX!==t||this._mountY!==t)&&(this._mountX=t,this._mountY=t,this._updateLocalTranslate())}get rotation(){return this._rotation}set rotation(t){this._rotation!==t&&(this._rotation=t,this._updateLocalTransform())}get alpha(){return this._alpha}set alpha(t){if(t=t>1?1:t<1e-14?0:t,this._alpha!==t){let n=this._alpha;this._alpha=t,this._updateLocalAlpha(),n===0!=(t===0)&&this._element._updateEnabledFlag()}}get visible(){return this._visible}set visible(t){this._visible!==t&&(this._visible=t,this._updateLocalAlpha(),this._element._updateEnabledFlag(),this.hasFlexLayout()&&this.layout.setVisible(t))}_updateLocalTransform(){if(this._rotation!==0&&this._rotation%(2*Math.PI)){let t=Math.sin(this._rotation),n=Math.cos(this._rotation);this._setLocalTransform(n*this._scaleX,-t*this._scaleY,t*this._scaleX,n*this._scaleY)}else this._setLocalTransform(this._scaleX,0,0,this._scaleY);this._updateLocalTranslate()}_updateLocalTranslate(){this._recalcLocalTranslate(),this._triggerRecalcTranslate()}_recalcLocalTranslate(){let t=this._pivotX*this._w,n=this._pivotY*this._h,a=this._x-(t*this._localTa+n*this._localTb)+t,u=this._y-(t*this._localTc+n*this._localTd)+n;a-=this._mountX*this._w,u-=this._mountY*this._h,this._localPx=a,this._localPy=u}_updateLocalTranslateDelta(t,n){this._addLocalTranslate(t,n)}_updateLocalAlpha(){this._setLocalAlpha(this._visible?this._alpha:0)}setHasRenderUpdates(t){if(this._worldContext.alpha){let n=this;for(n._hasRenderUpdates=Math.max(t,n._hasRenderUpdates);(n=n._parent)&&n._hasRenderUpdates!==3;)n._hasRenderUpdates=3}}_setRecalc(t){this._recalc|=t,this._setHasUpdates(),this._parent&&this._parent.setHasRenderUpdates(3)}_setHasUpdates(){let t=this;for(;t&&!t._hasUpdates;)t._hasUpdates=!0,t=t._parent}getParent(){return this._parent}setParent(t){if(t!==this._parent){let n=this.isZContext(),a=this._parent;if(this._parent=t,(this._layout||t&&t.isFlexContainer())&&this.layout.setParent(a,t),a&&a.setHasRenderUpdates(3),this._setRecalc(1+2+4),this._parent&&this._parent._setHasUpdates(),this._zIndex===0?this.setZParent(t):this.setZParent(t?t.findZContext():null),n!==this.isZContext()&&(this.isZContext()?this.enableZContext(a.findZContext()):this.disableZContext()),this._zIndexResort=!0,this._zParent&&this._zParent.enableZSort(),!this._shader){let u=t&&!t._renderToTextureEnabled?t._shaderOwner:null;u!==this._shaderOwner&&(this.setHasRenderUpdates(1),this._setShaderOwnerRecursive(u))}}}enableZSort(t=!1){!this._zSort&&this._zContextUsage>0&&(this._zSort=!0,t&&this.ctx.forceZSort(this))}addChildAt(t,n){this._children||(this._children=[]),this._children.splice(t,0,n),n.setParent(this)}setChildAt(t,n){this._children||(this._children=[]),this._children[t].setParent(null),this._children[t]=n,n.setParent(this)}removeChildAt(t){let n=this._children[t];this._children.splice(t,1),n.setParent(null)}removeChildren(){if(this._children){for(let t=0,n=this._children.length;t<n;t++)this._children[t].setParent(null);this._children.splice(0),this._zIndexedChildren&&this._zIndexedChildren.splice(0)}}syncChildren(t,n,a){this._children=a;for(let u=0,f=t.length;u<f;u++)t[u].setParent(null);for(let u=0,f=n.length;u<f;u++)n[u].setParent(this)}moveChild(t,n){let a=this._children[t];this._children.splice(t,1),this._children.splice(n,0,a),this._zIndexResort=!0,this._zParent&&this._zParent.enableZSort()}_setLocalTransform(t,n,a,u){this._setRecalc(4),this._localTa=t,this._localTb=n,this._localTc=a,this._localTd=u,this._isComplex=n!==0||a!==0||t<0||u<0}_addLocalTranslate(t,n){this._localPx+=t,this._localPy+=n,this._triggerRecalcTranslate()}_setLocalAlpha(t){!this._worldContext.alpha&&this._parent&&this._parent._worldContext.alpha&&t?this._setRecalc(1+128):this._setRecalc(1),t<1e-14&&(t=0),this._localAlpha=t}setDimensions(t,n,a=this._dimsUnknown){if(this._dimsUnknown=a,this.hasFlexLayout())this._layout.originalWidth=t,this._layout.originalHeight=n;else if(this._w!==t||this._h!==n)return this._updateDimensions(t,n),!0;return!1}_updateDimensions(t,n){(this._w!==t||this._h!==n)&&(this._w=t,this._h=n,this._triggerRecalcTranslate(),this._texturizer&&(this._texturizer.releaseRenderTexture(),this._texturizer.updateResultTexture()),this._updateLocalTranslate())}setTextureCoords(t,n,a,u){this.setHasRenderUpdates(3),this._ulx=t,this._uly=n,this._brx=a,this._bry=u}get displayedTextureSource(){return this._displayedTextureSource}setDisplayedTextureSource(t){this.setHasRenderUpdates(3),this._displayedTextureSource=t}get isRoot(){return this._isRoot}setAsRoot(){this._parent=new fn(this._element),this._parent._hasRenderUpdates=3,this._parent._hasUpdates=!0,this._isRoot=!0,this.ctx.root=this,this._parent._viewport=[0,0,this.ctx.stage.coordsWidth,this.ctx.stage.coordsHeight],this._parent._scissor=this._parent._viewport,this._parent._recBoundsMargin=null,this._setRecalc(1+2+4)}isAncestorOf(t){let n=t;for(;n=n._parent;)if(this===n)return!0;return!1}isZContext(){return this._forceZIndexContext||this._renderToTextureEnabled||this._zIndex!==0||this._isRoot||!this._parent}findZContext(){return this.isZContext()?this:this._parent.findZContext()}setZParent(t){if(this._zParent!==t){if(this._zParent!==null&&(this._zIndex!==0&&this._zParent.decZContextUsage(),this._zParent.enableZSort()),t!==null){let n=t._zContextUsage>0;this._zIndex!==0&&t.incZContextUsage(),t._zContextUsage>0&&(!n&&this._parent===t||t._zIndexedChildren.push(this),t.enableZSort())}this._zParent=t,this._zIndexResort=!0}}incZContextUsage(){if(this._zContextUsage++,this._zContextUsage===1&&(this._zIndexedChildren||(this._zIndexedChildren=[]),this._children)){for(let t=0,n=this._children.length;t<n;t++)this._zIndexedChildren.push(this._children[t]);this._zSort=!1}}decZContextUsage(){this._zContextUsage--,this._zContextUsage===0&&(this._zSort=!1,this._zIndexedChildren.splice(0))}get zIndex(){return this._zIndex}set zIndex(t){if(this._zIndex!==t){this.setHasRenderUpdates(1);let n=this._zParent,a=this.isZContext();t===0&&this._zIndex!==0?this._parent===this._zParent?this._zParent&&this._zParent.decZContextUsage():n=this._parent:t!==0&&this._zIndex===0?(n=this._parent?this._parent.findZContext():null,n===this._zParent&&this._zParent&&(this._zParent.incZContextUsage(),this._zParent.enableZSort())):t!==this._zIndex&&this._zParent&&this._zParent._zContextUsage&&this._zParent.enableZSort(),n!==this._zParent&&this.setZParent(null),this._zIndex=t,n!==this._zParent&&this.setZParent(n),a!==this.isZContext()&&(this.isZContext()?this.enableZContext(this._parent.findZContext()):this.disableZContext()),this._zIndexResort=!0,this._zParent&&this._zParent.enableZSort()}}get forceZIndexContext(){return this._forceZIndexContext}set forceZIndexContext(t){this.setHasRenderUpdates(1);let n=this.isZContext();this._forceZIndexContext=t,n!==this.isZContext()&&(this.isZContext()?this.enableZContext(this._parent.findZContext()):this.disableZContext())}enableZContext(t){t&&t._zContextUsage>0&&this._getZIndexedDescs().forEach(a=>{this.isAncestorOf(a)&&a._zIndex!==0&&a.setZParent(this)})}_getZIndexedDescs(){const t=[];if(this._children)for(let n=0,a=this._children.length;n<a;n++)this._children[n]._getZIndexedDescsRec(t);return t}_getZIndexedDescsRec(t){if(this._zIndex)t.push(this);else if(this._children&&!this.isZContext())for(let n=0,a=this._children.length;n<a;n++)this._children[n]._getZIndexedDescsRec(t)}disableZContext(){if(this._zContextUsage>0){let t=this._parent.findZContext();this._zSort&&this.sortZIndexedChildren(),this._zIndexedChildren.slice().forEach(function(n){n._zIndex!==0&&n.setZParent(t)})}}get colorUl(){return this._colorUl}set colorUl(t){this._colorUl!==t&&(this.setHasRenderUpdates(this._displayedTextureSource?3:1),this._colorUl=t)}get colorUr(){return this._colorUr}set colorUr(t){this._colorUr!==t&&(this.setHasRenderUpdates(this._displayedTextureSource?3:1),this._colorUr=t)}get colorBl(){return this._colorBl}set colorBl(t){this._colorBl!==t&&(this.setHasRenderUpdates(this._displayedTextureSource?3:1),this._colorBl=t)}get colorBr(){return this._colorBr}set colorBr(t){this._colorBr!==t&&(this.setHasRenderUpdates(this._displayedTextureSource?3:1),this._colorBr=t)}set onUpdate(t){this._onUpdate=t,this._setRecalc(7)}set onAfterUpdate(t){this._onAfterUpdate=t,this._setRecalc(7)}set onAfterCalcs(t){this._onAfterCalcs=t,this._setRecalc(7)}get shader(){return this._shader}set shader(t){this.setHasRenderUpdates(1);let n=this._shader;if(this._shader=t,!t&&n){let a=this._parent&&!this._parent._renderToTextureEnabled?this._parent._shaderOwner:null;this._setShaderOwnerRecursive(a)}else t&&this._setShaderOwnerRecursive(this)}get activeShader(){return this._shaderOwner?this._shaderOwner.shader:this.renderState.defaultShader}get activeShaderOwner(){return this._shaderOwner}get clipping(){return this._clipping}set clipping(t){this._clipping!==t&&(this._clipping=t,this._setRecalc(1+2))}get clipbox(){return this._clipbox}set clipbox(t){this._clipbox=t}_setShaderOwnerRecursive(t){if(this._shaderOwner=t,this._children&&!this._renderToTextureEnabled)for(let n=0,a=this._children.length;n<a;n++){let u=this._children[n];u._shader||(u._setShaderOwnerRecursive(t),u._hasRenderUpdates=3)}}_setShaderOwnerChildrenRecursive(t){if(this._children)for(let n=0,a=this._children.length;n<a;n++){let u=this._children[n];u._shader||(u._setShaderOwnerRecursive(t),u._hasRenderUpdates=3)}}_hasRenderContext(){return this._renderContext!==this._worldContext}get renderContext(){return this._renderContext}updateRenderToTextureEnabled(){this.texturizer._enabled?this._enableRenderToTexture():(this._disableRenderToTexture(),this._texturizer.releaseRenderTexture())}_enableRenderToTexture(){if(!this._renderToTextureEnabled){let t=this.isZContext();this._renderToTextureEnabled=!0,this._renderContext=new hn,this._setShaderOwnerChildrenRecursive(null),t||this.enableZContext(this._parent?this._parent.findZContext():null),this.setHasRenderUpdates(3),this._setRecalc(7),this.render=this._renderAdvanced}}_disableRenderToTexture(){this._renderToTextureEnabled&&(this._renderToTextureEnabled=!1,this._setShaderOwnerChildrenRecursive(this._shaderOwner),this._renderContext=this._worldContext,this.isZContext()||this.disableZContext(),this._setRecalc(7),this.setHasRenderUpdates(3),this.render=this._renderSimple)}isWhite(){return this._colorUl===4294967295&&this._colorUr===4294967295&&this._colorBl===4294967295&&this._colorBr===4294967295}hasSimpleTexCoords(){return this._ulx===0&&this._uly===0&&this._brx===1&&this._bry===1}_stashTexCoords(){this._stashedTexCoords=[this._ulx,this._uly,this._brx,this._bry],this._ulx=0,this._uly=0,this._brx=1,this._bry=1}_unstashTexCoords(){this._ulx=this._stashedTexCoords[0],this._uly=this._stashedTexCoords[1],this._brx=this._stashedTexCoords[2],this._bry=this._stashedTexCoords[3],this._stashedTexCoords=null}_stashColors(){this._stashedColors=[this._colorUl,this._colorUr,this._colorBr,this._colorBl],this._colorUl=4294967295,this._colorUr=4294967295,this._colorBr=4294967295,this._colorBl=4294967295}_unstashColors(){this._colorUl=this._stashedColors[0],this._colorUr=this._stashedColors[1],this._colorBr=this._stashedColors[2],this._colorBl=this._stashedColors[3],this._stashedColors=null}isVisible(){return this._localAlpha>1e-14}get outOfBounds(){return this._outOfBounds}set boundsMargin(t){this._boundsMargin=t?t.slice():null,this._triggerRecalcTranslate()}get boundsMargin(){return this._boundsMargin}update(){this._recalc|=this._parent._pRecalc,this._layout&&this._layout.isEnabled()?this._recalc&256&&this._layout.layoutFlexTree():this._recalc&2&&this._optFlags&&this._applyRelativeDimFuncs(),this._onUpdate&&(this._hasUpdates=!0,this._onUpdate(this.element,this));const t=this._parent._worldContext;let n=this._worldContext;const a=t.alpha&&this._localAlpha;if(this._hasUpdates||this._recalc&&a||n.alpha&&!a){let u=this._recalc;u&1&&(!n.alpha&&a&&(this._hasRenderUpdates=3),n.alpha=t.alpha*this._localAlpha,n.alpha<1e-14&&(n.alpha=0)),u&6&&(n.px=t.px+this._localPx*t.ta,n.py=t.py+this._localPy*t.td,t.tb!==0&&(n.px+=this._localPy*t.tb),t.tc!==0&&(n.py+=this._localPx*t.tc)),u&4&&(n.ta=this._localTa*t.ta,n.tb=this._localTd*t.tb,n.tc=this._localTa*t.tc,n.td=this._localTd*t.td,this._isComplex&&(n.ta+=this._localTc*t.tb,n.tb+=this._localTb*t.ta,n.tc+=this._localTc*t.td,n.td+=this._localTb*t.tc));const f=this._parent._renderContext;if(this._parent._hasRenderContext()){const O=this._renderContext===this._worldContext;O&&(this._renderContext=new hn);const W=this._renderContext;(O||u&1)&&(W.alpha=f.alpha*this._localAlpha,W.alpha<1e-14&&(W.alpha=0)),(O||u&6)&&(W.px=f.px+this._localPx*f.ta,W.py=f.py+this._localPy*f.td,f.tb!==0&&(W.px+=this._localPy*f.tb),f.tc!==0&&(W.py+=this._localPx*f.tc)),O&&(u|=2),(O||u&4)&&(W.ta=this._localTa*f.ta,W.tb=this._localTd*f.tb,W.tc=this._localTa*f.tc,W.td=this._localTd*f.td,this._isComplex&&(W.ta+=this._localTc*f.tb,W.tb+=this._localTb*f.ta,W.tc+=this._localTc*f.td,W.td+=this._localTb*f.tc))}else this._renderContext=this._worldContext;this.ctx.updateTreeOrder===-1?this.ctx.updateTreeOrder=this._updateTreeOrder+1:this._updateTreeOrder=this.ctx.updateTreeOrder++;const m=this._renderToTextureEnabled&&this._texturizer.mustRenderToTexture();this._useRenderToTexture!==m&&(this._recalc|=2+4,u|=2,this._useRenderToTexture||this._texturizer.release()),this._useRenderToTexture=m;const p=this._renderContext,x=this._dimsUnknown?2048:this._w,T=this._dimsUnknown?2048:this._h;let A,b,I,D;const v=p.tb!==0||p.tc!==0||p.ta<0||p.td<0;if(v?(A=Math.min(0,x*p.ta,x*p.ta+T*p.tb,T*p.tb)+p.px,I=Math.max(0,x*p.ta,x*p.ta+T*p.tb,T*p.tb)+p.px,b=Math.min(0,x*p.tc,x*p.tc+T*p.td,T*p.td)+p.py,D=Math.max(0,x*p.tc,x*p.tc+T*p.td,T*p.td)+p.py):(A=p.px,I=p.px+p.ta*x,b=p.py,D=p.py+p.td*T),this._dimsUnknown&&(v||this._localTa<1||this._localTb<1)){const O=this._x*f.ta+this._y*f.tb+f.px,W=this._x*f.tc+this._y*f.td+f.py;O<A&&(A=O),W<b&&(b=W),O>I&&(I=O),W>D&&(D=W)}if(u&6||!this._scissor)if(this._clipping&&p.isSquare()){const O=this._parent._useRenderToTexture?this._parent._viewport:this._parent._scissor;if(O){const W=Math.max(O[0],A),Z=Math.max(O[1],b);this._scissor=[W,Z,Math.min(O[2]+O[0],I)-W,Math.min(O[3]+O[1],D)-Z]}else this._scissor=[A,b,I-A,D-b]}else this._scissor=this._parent._useRenderToTexture?this._parent._viewport:this._parent._scissor;if(this._boundsMargin?this._recBoundsMargin=this._boundsMargin:this._recBoundsMargin=this._parent._recBoundsMargin,this._onAfterCalcs&&this._onAfterCalcs(this.element)&&(v?(A=Math.min(0,x*p.ta,x*p.ta+T*p.tb,T*p.tb)+p.px,I=Math.max(0,x*p.ta,x*p.ta+T*p.tb,T*p.tb)+p.px,b=Math.min(0,x*p.tc,x*p.tc+T*p.td,T*p.td)+p.py,D=Math.max(0,x*p.tc,x*p.tc+T*p.td,T*p.td)+p.py):(A=p.px,I=p.px+p.ta*x,b=p.py,D=p.py+p.td*T),this._dimsUnknown&&(v||this._localTa<1||this._localTb<1))){const O=this._x*f.ta+this._y*f.tb+f.px,W=this._x*f.tc+this._y*f.td+f.py;O<A&&(A=O),W<b&&(b=W),O>I&&(I=O),W>D&&(D=W)}if(this._parent._outOfBounds===2)this._outOfBounds=2,this._withinBoundsMargin&&(this._withinBoundsMargin=!1,this.element._disableWithinBoundsMargin());else if(u&6){this._outOfBounds=0;let O=!0;if((!this._renderToTextureEnabled||!this._texturizer||!this._texturizer.renderOffscreen)&&(this._scissor&&(this._scissor[2]<=0||this._scissor[3]<=0)?this._outOfBounds=2:((this._scissor[0]>I||this._scissor[1]>D||A>this._scissor[0]+this._scissor[2]||b>this._scissor[1]+this._scissor[3])&&(this._outOfBounds=1),this._outOfBounds&&(this._clipping||this._useRenderToTexture||this._clipbox&&x&&T)&&(this._outOfBounds=2)),O=this._outOfBounds===0,O||(this._recBoundsMargin?O=!(I<this._scissor[0]-this._recBoundsMargin[2]||D<this._scissor[1]-this._recBoundsMargin[3]||A>this._scissor[0]+this._scissor[2]+this._recBoundsMargin[0]||b>this._scissor[1]+this._scissor[3]+this._recBoundsMargin[1]):O=!(I<this._scissor[0]-100||D<this._scissor[1]-100||A>this._scissor[0]+this._scissor[2]+100||b>this._scissor[1]+this._scissor[3]+100),O&&this._outOfBounds===2&&(this._outOfBounds=1))),this._withinBoundsMargin!==O)if(this._withinBoundsMargin=O,this._withinBoundsMargin){this._hasUpdates=!0;const W=this._recalc;if(this._recalc=0,this.element._enableWithinBoundsMargin(),this._recalc)return this.update();this._recalc=W}else this.element._disableWithinBoundsMargin()}if(this._useRenderToTexture&&(this._viewport?(this._viewport[2]=x,this._viewport[3]=T):this._viewport=[0,0,x,T]),this._pRecalc=this._recalc&135,this._recalc=0,this._hasUpdates=!1,this._outOfBounds<2){if(this._useRenderToTexture&&(this._worldContext.isIdentity()?this._renderContext=this._worldContext:this._renderContext=hn.IDENTITY),this._children)for(let O=0,W=this._children.length;O<W;O++)this._children[O].update();this._useRenderToTexture&&(this._renderContext=p)}else if(this._children)for(let O=0,W=this._children.length;O<W;O++)this._children[O]._hasUpdates?this._children[O].update():(this._children[O]._recalc|=this._pRecalc,this._children[O].updateOutOfBounds());this._onAfterUpdate&&this._onAfterUpdate(this.element)}else this.ctx.updateTreeOrder===-1||this._updateTreeOrder>=this.ctx.updateTreeOrder?this.ctx.updateTreeOrder=-1:this.updateTreeOrder()}_applyRelativeDimFuncs(){if(this._optFlags&1){const n=this._funcX(this._parent.w);n!==this._x&&(this._localPx+=n-this._x,this._x=n)}if(this._optFlags&2){const n=this._funcY(this._parent.h);n!==this._y&&(this._localPy+=n-this._y,this._y=n)}let t=!1;if(this._optFlags&4){const n=this._funcW(this._parent.w);n!==this._w&&(this._w=n,t=!0)}if(this._optFlags&8){const n=this._funcH(this._parent.h);n!==this._h&&(this._h=n,t=!0)}t&&(this._recalcLocalTranslate(),this.element.onDimensionsChanged(this._w,this._h))}updateOutOfBounds(){if(this._outOfBounds!==2&&this._renderContext.alpha>0&&(this._outOfBounds=2,this._withinBoundsMargin&&(this._withinBoundsMargin=!1,this.element._disableWithinBoundsMargin()),this._children))for(let t=0,n=this._children.length;t<n;t++)this._children[t].updateOutOfBounds()}updateTreeOrder(){if(this._localAlpha&&this._outOfBounds!==2&&(this._updateTreeOrder=this.ctx.updateTreeOrder++,this._children))for(let t=0,n=this._children.length;t<n;t++)this._children[t].updateTreeOrder()}_renderSimple(){if(this._hasRenderUpdates=0,this._zSort&&this.sortZIndexedChildren(),this._outOfBounds<2&&this._renderContext.alpha){let t=this.renderState;if(this._outOfBounds===0&&this._displayedTextureSource&&(t.setShader(this.activeShader,this._shaderOwner),t.setScissor(this._scissor),this.renderState.addQuad(this)),this._children)if(this._zContextUsage)for(let n=0,a=this._zIndexedChildren.length;n<a;n++)this._zIndexedChildren[n].render();else for(let n=0,a=this._children.length;n<a;n++)this._children[n]._zIndex===0&&this._children[n].render()}}_renderAdvanced(){const t=this._hasRenderUpdates;if(this._hasRenderUpdates=0,this._zSort&&this.sortZIndexedChildren(),this._outOfBounds<2&&this._renderContext.alpha){let n=this.renderState,a=!0,u,f;if(this._useRenderToTexture){if(this._w===0||this._h===0)return;if(!this._texturizer.hasRenderTexture()||t>=3){if(this.ctx.renderToTextureCount++,n.setShader(n.defaultShader,this),f=n.renderTextureInfo,u={nativeTexture:null,offset:0,w:this._w,h:this._h,empty:!0,cleared:!1,ignore:!1,cache:!1},(this._texturizer.hasResultTexture()||!n.isCachingTexturizer&&t<3)&&(u.cache=!0,n.isCachingTexturizer=!0),this._texturizer.hasResultTexture()||this._texturizer.releaseRenderTexture(),n.setRenderTextureInfo(u),n.setScissor(null),this._displayedTextureSource){let m=this._renderContext;this._renderContext=hn.IDENTITY,this.renderState.addQuad(this),this._renderContext=m}}else a=!1}else this._outOfBounds===0&&this._displayedTextureSource&&(n.setShader(this.activeShader,this._shaderOwner),n.setScissor(this._scissor),this.renderState.addQuad(this));if(a&&this._children)if(this._zContextUsage)for(let m=0,p=this._zIndexedChildren.length;m<p;m++)this._zIndexedChildren[m].render();else for(let m=0,p=this._children.length;m<p;m++)this._children[m]._zIndex===0&&this._children[m].render();if(this._useRenderToTexture){let m=!1;if(a&&(n.finishedRenderTexture(),this._texturizer.empty=u.empty,u.empty?this._texturizer.releaseRenderTexture():u.nativeTexture?(this._texturizer.reuseTextureAsRenderTexture(u.nativeTexture),u.ignore=!0):(this._texturizer.renderTextureReused&&this._texturizer.releaseRenderTexture(),u.nativeTexture=this._texturizer.getRenderTexture()),n.setRenderTextureInfo(f),m=!0),!this._texturizer.empty){let p=this._texturizer.getResultTexture();if(m&&(p&&(p.update=n.stage.frameCounter),this._texturizer.updateResultTexture()),!this._texturizer.renderOffscreen){n.setShader(this.activeShader,this._shaderOwner),n.setScissor(this._scissor);const x=!u||u.cache;n.setTexturizer(this._texturizer,x),this._stashTexCoords(),this._texturizer.colorize||this._stashColors(),this.renderState.addQuad(this,!0),this._texturizer.colorize||this._unstashColors(),this._unstashTexCoords(),n.setTexturizer(null)}}}u&&u.cache&&(n.isCachingTexturizer=!1)}}get zSort(){return this._zSort}sortZIndexedChildren(){const t=this._zIndexedChildren.length;let n=0;const a=this._zIndexedChildren,u=[];for(let m=0;m<t;m++)a[m]._zParent===this&&(a[m]._zIndexResort?u.push(a[m]):(n!==m&&(a[n]=a[m]),n++));const f=u.length;if(f){for(let p=0;p<f;p++)u[p]._zIndexResort=!1;u.sort(fn.sortZIndexedChildren);const m=n;if(m){n=0;let p=0,x=0;const T=[];do{const b=(a[p]._zIndex===u[x]._zIndex?a[p]._updateTreeOrder-u[x]._updateTreeOrder:a[p]._zIndex-u[x]._zIndex)>0?u[x++]:a[p++];if((n===0||T[n-1]!==b)&&(T[n++]=b),p>=m){do{const I=u[x++];(n===0||T[n-1]!==I)&&(T[n++]=I)}while(x<f);break}else if(x>=f){do{const I=a[p++];(n===0||T[n-1]!==I)&&(T[n++]=I)}while(p<m);break}}while(!0);this._zIndexedChildren=T}else{n=0;let p=0;do a[n++]=u[p++];while(p<f);a.length>n&&a.splice(n)}}else a.length>n&&a.splice(n);this._zSort=!1}get localTa(){return this._localTa}get localTb(){return this._localTb}get localTc(){return this._localTc}get localTd(){return this._localTd}get element(){return this._element}get renderUpdates(){return this._hasRenderUpdates}get texturizer(){return this._texturizer||(this._texturizer=new Fv(this)),this._texturizer}getCornerPoints(){let t=this._worldContext;return[t.px,t.py,t.px+this._w*t.ta,t.py+this._w*t.tc,t.px+this._w*t.ta+this._h*t.tb,t.py+this._w*t.tc+this._h*t.td,t.px+this._h*t.tb,t.py+this._h*t.td]}getRenderTextureCoords(t,n){let a=this._renderContext;return[a.px+a.ta*t+a.tb*n,a.py+a.tc*t+a.td*n]}getAbsoluteCoords(t,n){let a=this._renderContext;return[a.px+a.ta*t+a.tb*n,a.py+a.tc*t+a.td*n]}collectAtCoord(t,n,a){if(this._renderContext.alpha!==0){if(this.inBound(t,n)&&(this._scissor?this.inScissor()&&a.push(this):a.push(this)),this._children){const u=this._children.length;for(let f=0;f<u;f++)this._children[f].collectAtCoord(t,n,a)}return a.sort(fn.sortZIndexedChildren)}}inBound(t,n){const a=this.getCornerPoints();return t>a[0]&&t<a[2]&&n>a[1]&&n<a[7]}inScissor(){const t=this._scissor,n=this.getCornerPoints();return n[2]>=t[0]&&n[0]<=t[0]+t[2]&&n[7]>=t[1]&&n[1]<=t[1]+t[3]}get layout(){return this._ensureLayout(),this._layout}get flex(){return this._layout?this._layout.flex:null}set flex(t){this.layout.flex=t}get flexItem(){return this._layout?this._layout.flexItem:null}set flexItem(t){this.layout.flexItem=t}isFlexItem(){return!!this._layout&&this._layout.isFlexItemEnabled()}isFlexContainer(){return!!this._layout&&this._layout.isFlexEnabled()}enableFlexLayout(){this._ensureLayout()}_ensureLayout(){this._layout||(this._layout=new mb(this))}disableFlexLayout(){this._triggerRecalcTranslate()}hasFlexLayout(){return this._layout&&this._layout.isEnabled()}setLayout(t,n,a,u){this.x=t,this.y=n,this._updateDimensions(a,u)}triggerLayout(){this._setRecalc(256)}_triggerRecalcTranslate(){this._setRecalc(2)}}class hn{constructor(){this.alpha=1,this.px=0,this.py=0,this.ta=1,this.tb=0,this.tc=0,this.td=1}isIdentity(){return this.alpha===1&&this.px===0&&this.py===0&&this.ta===1&&this.tb===0&&this.tc===0&&this.td===1}isSquare(){return this.tb===0&&this.tc===0}}hn.IDENTITY=new hn;fn.sortZIndexedChildren=function(c,t){return c._zIndex===t._zIndex?c._updateTreeOrder-t._updateTreeOrder:c._zIndex-t._zIndex};class at{constructor(){this._hasEventListeners=!1}on(t,n){this._hasEventListeners||(this._eventFunction={},this._eventListeners={},this._hasEventListeners=!0),this._eventFunction[t]?this._eventFunction[t]!==at.combiner?(this._eventListeners[t]=[this._eventFunction[t],n],this._eventFunction[t]=at.combiner):this._eventListeners[t].push(n):this._eventFunction[t]=n}once(t,n){const a=(u,f,m)=>{n(u,f,m),this.off(t,a)};a.__originalFunc=n,this.on(t,a)}has(t,n){if(this._hasEventListeners){const a=this._eventFunction[t];if(a){if(a===at.combiner){const u=this._eventListeners[t];for(const f of u)if(f===n||f.__originalFunc==n)return!0}else if(this._eventFunction[t]===n||this._eventFunction[t].__originalFunc===n)return!0}}return!1}off(t,n){if(this._hasEventListeners){const a=this._eventFunction[t];if(a)if(a===at.combiner){const u=this._eventListeners[t];let f=u.indexOf(n);f>=0&&u.splice(f,1),f=u.map(m=>m.__originalFunc).indexOf(n),f>=0&&u.splice(f,1),u.length===1&&(this._eventFunction[t]=u[0],this._eventListeners[t]=void 0)}else(this._eventFunction[t]===n||this._eventFunction[t].__originalFunc===n)&&(this._eventFunction[t]=void 0)}}removeListener(t,n){this.off(t,n)}emit(t,n,a,u){if(this._hasEventListeners){const f=this._eventFunction[t];f&&(f===at.combiner?f(this,t,n,a,u):f(n,a,u))}}listenerCount(t){if(this._hasEventListeners){const n=this._eventFunction[t];if(n)return n===at.combiner?this._eventListeners[t].length:1}return 0}removeAllListeners(t){this._hasEventListeners&&(delete this._eventFunction[t],delete this._eventListeners[t])}}at.combiner=function(c,t,n,a,u){const f=c._eventListeners[t];if(f)for(const m of[...f])m(n,a,u)};at.addAsMixin=function(c){c.prototype.on=at.prototype.on,c.prototype.once=at.prototype.once,c.prototype.has=at.prototype.has,c.prototype.off=at.prototype.off,c.prototype.removeListener=at.prototype.removeListener,c.prototype.emit=at.prototype.emit,c.prototype.listenerCount=at.prototype.listenerCount,c.prototype.removeAllListeners=at.prototype.removeAllListeners};class ko{constructor(t){this._initialized=!1,this.ctx=t,this._elements=new Set}static create(t,n){let a;if(X.isObjectLiteral(n))n.type?a=t.renderer.createShader(t.ctx,n):a=this.shader,a&&Ct.patchObject(a,n);else if(n===null)a=t.ctx.renderState.defaultShader;else if(n===void 0)a=null;else if(n.isShader)t.renderer.isValidShaderType(n.constructor)||(console.error("[Lightning] Invalid shader type"),n=null),a=n;else{console.error("[Lightning] Please specify a shader type.");return}return a}static getWebGL(){}static getC2d(){}addElement(t){this._elements.add(t)}removeElement(t){this._elements.delete(t),this._elements||this.cleanup()}redraw(){this._elements.forEach(t=>{t.setHasRenderUpdates(2)})}patch(t){Ct.patchObject(this,t)}useDefault(){return!1}addEmpty(){return!1}cleanup(){}get isShader(){return!0}}class Zt{constructor(t){this.stage=t,this.manager=this.stage.textureManager,this.id=Zt.id++,this.elements=new Set,this._activeCount=0,this._source=null,this._resizeMode=null,this._x=0,this._y=0,this._w=0,this._h=0,this._precision=1,this.mw=0,this.mh=0,this.clipping=!1,this._mustUpdate=!0}get source(){return(this._mustUpdate||this.stage.hasUpdateSourceTexture(this))&&(this._performUpdateSource(!0),this.stage.removeUpdateSourceTexture(this)),this._source}addElement(t){this.elements.has(t)||(this.elements.add(t),this.elements.size===1&&this._source&&this._source.addTexture(this),t.active&&this.incActiveCount())}removeElement(t){this.elements.delete(t)&&(this.elements.size===0&&this._source&&this._source.removeTexture(this),t.active&&this.decActiveCount())}incActiveCount(){this.source&&this._checkForNewerReusableTextureSource(),this._activeCount++,this._activeCount===1&&this.becomesUsed()}decActiveCount(){this.source,this._activeCount--,this._activeCount||this.becomesUnused()}becomesUsed(){this.source&&this.source.incActiveTextureCount()}onLoad(){this._resizeMode&&this._applyResizeMode(),this.elements.forEach(t=>{t.active&&t.onTextureSourceLoaded()})}_checkForNewerReusableTextureSource(){const t=this.source;if(t.isLoaded())this._resizeMode&&this._applyResizeMode();else{const n=this._getReusableTextureSource();n&&n.isLoaded()&&n!==t&&this._replaceTextureSource(n)}}becomesUnused(){this.source&&this.source.decActiveTextureCount()}isUsed(){return this._activeCount>0}_getLookupId(){return null}_getSourceLoader(){throw new Error("Texture.generate must be implemented.")}get isValid(){return this._getIsValid()}_getIsValid(){return!0}_changed(){this.isUsed()?this._updateSource():this._mustUpdate=!0}_updateSource(){this.stage.addUpdateSourceTexture(this)}_performUpdateSource(t=!1){if(t||this.isUsed()){this._mustUpdate=!1;let n=this._getTextureSource();this._replaceTextureSource(n)}}_getTextureSource(){let t=null;if(this._getIsValid()){const n=this._getLookupId();t=this._getReusableTextureSource(n),t||(t=this.manager.getTextureSource(this._getSourceLoader(),n))}return t}_getReusableTextureSource(t=this._getLookupId()){return this._getIsValid()&&t?this.manager.getReusableTextureSource(t):null}_replaceTextureSource(t=null){let n=this._source;if(this._source=t,this.elements.size&&(n&&(this._activeCount&&n.decActiveTextureCount(),n.removeTexture(this),this.text&&!n.isUsed()&&this.manager.freeTextureSource(n)),t&&(t.addTexture(this),this._activeCount&&t.incActiveTextureCount())),this.isUsed())if(t)if(t.isLoaded())this._resizeMode&&this._applyResizeMode(),this.elements.forEach(a=>{a.active&&a._setDisplayedTexture(this)});else{const a=t.loadError;a&&this.elements.forEach(u=>{u.active&&u.onTextureSourceLoadError(a)})}else this.elements.forEach(a=>{a.active&&a._setDisplayedTexture(null)})}load(){this.source&&(this.isLoaded()||this.source.load(!0))}isLoaded(){return this._source&&this._source.isLoaded()}get loadError(){return this._source&&this._source.loadError}free(){this._source&&this._source.free()}set resizeMode({type:t="cover",w:n=0,h:a=0,clipX:u=.5,clipY:f=.5}){this._resizeMode={type:t,w:n,h:a,clipX:u,clipY:f},this.isLoaded()&&this._applyResizeMode()}get resizeMode(){return this._resizeMode}_clearResizeMode(){this._resizeMode=null}_applyResizeMode(){this._resizeMode.type==="cover"?this._applyResizeCover():this._resizeMode.type==="contain"&&this._applyResizeContain(),this._updatePrecision(),this._updateClipping()}_applyResizeCover(){const t=this._resizeMode.w/this._source.w,n=this._resizeMode.h/this._source.h;let a=Math.max(t,n);if(a){if(this._precision=1/a,t&&t<a){const u=this._precision*this._resizeMode.w,f=this._source.w-u;this._x=f*this._resizeMode.clipX,this._w=this._source.w-f}if(n&&n<a){const u=this._precision*this._resizeMode.h,f=this._source.h-u;this._y=f*this._resizeMode.clipY,this._h=this._source.h-f}}}_applyResizeContain(){const t=this._resizeMode.w/this._source.w,n=this._resizeMode.h/this._source.h;let a=t;(!a||n<a)&&(a=n),a&&(this._precision=1/a)}enableClipping(t,n,a,u){this._clearResizeMode(),t*=this._precision,n*=this._precision,a*=this._precision,u*=this._precision,(this._x!==t||this._y!==n||this._w!==a||this._h!==u)&&(this._x=t,this._y=n,this._w=a,this._h=u,this._updateClipping(!0))}disableClipping(){this._clearResizeMode(),(this._x||this._y||this._w||this._h)&&(this._x=0,this._y=0,this._w=0,this._h=0,this._updateClipping())}_updateClipping(){this.clipping=!!(this._x||this._y||this._w||this._h);let t=this;this.elements.forEach(function(n){n.displayedTexture===t&&n.onDisplayedTextureClippingChanged()})}_updatePrecision(){let t=this;this.elements.forEach(function(n){n.displayedTexture===t&&n.onPrecisionChanged()})}getNonDefaults(){let t={};return t.type=this.constructor.name,this.x!==0&&(t.x=this.x),this.y!==0&&(t.y=this.y),this.w!==0&&(t.w=this.w),this.h!==0&&(t.h=this.h),this.precision!==1&&(t.precision=this.precision),t}get px(){return this._x}get py(){return this._y}get pw(){return this._w}get ph(){return this._h}get x(){return this._x/this._precision}set x(t){this._clearResizeMode(),t=t*this._precision,this._x!==t&&(this._x=t,this._updateClipping())}get y(){return this._y/this._precision}set y(t){this._clearResizeMode(),t=t*this._precision,this._y!==t&&(this._y=t,this._updateClipping())}get w(){return this._w/this._precision}set w(t){this._clearResizeMode(),t=t*this._precision,this._w!==t&&(this._w=t,this._updateClipping())}get h(){return this._h/this._precision}set h(t){this._clearResizeMode(),t=t*this._precision,this._h!==t&&(this._h=t,this._updateClipping())}get precision(){return this._precision}set precision(t){this._clearResizeMode(),this._precision!==t&&(this._precision=t,this._updatePrecision())}isAutosizeTexture(){return!0}getRenderWidth(){return this.isAutosizeTexture()?(this._w||(this._source?this._source.getRenderWidth()-this._x:0))/this._precision:0}getRenderHeight(){return this.isAutosizeTexture()?(this._h||(this._source?this._source.getRenderHeight()-this._y:0))/this._precision:0}patch(t){Ct.patchObject(this,t)}}Zt.prototype.isTexture=!0;Zt.id=0;class Td extends Zt{constructor(t){super(t),this._src=void 0,this._hasAlpha=!1}get src(){return this._src}set src(t){this._src!==t&&(this._src=t,this._changed())}get hasAlpha(){return this._hasAlpha}set hasAlpha(t){this._hasAlpha!==t&&(this._hasAlpha=t,this._changed())}_getIsValid(){return!!this._src}_getLookupId(){return this._src}_getSourceLoader(){let t=this._src,n=this._hasAlpha;if(this.stage.getOption("srcBasePath")){var a=t.charCodeAt(0);t.indexOf("//")===-1&&(a>=65&&a<=90||a>=97&&a<=122||a==46)&&(t=this.stage.getOption("srcBasePath")+t)}return u=>this.stage.platform.loadSrcTexture({src:t,hasAlpha:n},u)}getNonDefaults(){const t=super.getNonDefaults();return this._src&&(t.src=this._src),t}}function Wl(c,t,n,a,u){let f=c;Array.isArray(f)||(f=[f]);let m=[];for(let p=0,x=f.length;p<x;p++){let T=f[p];T===null&&(T=u),T==="serif"||T==="sans-serif"?m.push(T):m.push(`"${T}"`)}return`${t} ${n*a}px ${m.join(",")}`}class $x{constructor(t,n,a){this._stage=t,this._canvas=n,this._context=this._canvas.getContext("2d"),this._settings=a}getPrecision(){return this._settings.precision}setFontProperties(){this._context.font=Wl(this._settings.fontFace,this._settings.fontStyle,this._settings.fontSize,this.getPrecision(),this._stage.getOption("defaultFontFace")),this._context.textBaseline=this._settings.textBaseline}_load(){if(X.isWeb&&document.fonts){const t=Wl(this._settings.fontFace,this._settings.fontStyle,this._settings.fontSize,this.getPrecision(),this._stage.getOption("defaultFontFace"));try{if(!document.fonts.check(t,this._settings.text))return document.fonts.load(t,this._settings.text).catch(n=>{console.warn("[Lightning] Font load error",n,t)}).then(()=>{document.fonts.check(t,this._settings.text)||console.warn("[Lightning] Font not found",t)})}catch(n){console.warn("[Lightning] Can't check font loading for "+t)}}}draw(){const t=this._load();return t?t.then(()=>X.isSpark?this._stage.platform.drawText(this):this._draw()):X.isSpark?this._stage.platform.drawText(this):this._draw()}_calculateRenderInfo(){let t={};const n=this.getPrecision(),a=this._settings.paddingLeft*n,u=this._settings.paddingRight*n,f=this._settings.fontSize*n;let m=this._settings.offsetY===null?null:this._settings.offsetY*n,p=this._settings.lineHeight*n;const x=this._settings.w*n,T=this._settings.h*n;let A=this._settings.wordWrapWidth*n;const b=this._settings.cutSx*n,I=this._settings.cutEx*n,D=this._settings.cutSy*n,v=this._settings.cutEy*n,O=(this._settings.letterSpacing||0)*n,W=this._settings.textIndent*n;this.setFontProperties();let Z=x||2048/this.getPrecision(),re=Z-a;if(re<10&&(Z+=10-re,re=10),A||(A=re),this._settings.textOverflow&&!this._settings.wordWrap){let _e;switch(this._settings.textOverflow){case"clip":_e="";break;case"ellipsis":_e=this._settings.maxLinesSuffix;break;default:_e=this._settings.textOverflow}this._settings.text=this.wrapWord(this._settings.text,A-W,_e)}let Q;if(this._settings.wordWrap)Q=this.wrapText(this._settings.text,A,O,W);else{Q={l:this._settings.text.split(/(?:\r\n|\r|\n)/),n:[]};let _e=Q.l.length;for(let ce=0;ce<_e-1;ce++)Q.n.push(ce)}let q=Q.l;if(this._settings.maxLines&&q.length>this._settings.maxLines){let _e=q.slice(0,this._settings.maxLines),ce=null;if(this._settings.maxLinesSuffix){let Ae=this._settings.maxLinesSuffix?this.measureText(this._settings.maxLinesSuffix):0,oe=this.wrapText(_e[_e.length-1],A-Ae,O,W);_e[_e.length-1]=oe.l[0]+this._settings.maxLinesSuffix,ce=[oe.l.length>1?oe.l[1]:""]}else ce=[""];let C,K=q.length,de=0,lt=Q.n.length;for(C=this._settings.maxLines;C<K;C++)ce[de]+=(ce[de]?" ":"")+q[C],C+1<lt&&Q.n[C+1]&&de++;t.remainingText=ce.join(`
`),t.moreTextLines=!0,q=_e}else t.moreTextLines=!1,t.remainingText="";let xe=0,me=[];for(let _e=0;_e<q.length;_e++){let ce=this.measureText(q[_e],O)+(_e===0?W:0);me.push(ce),xe=Math.max(xe,ce)}t.lineWidths=me,x||(Z=xe+a+u,re=xe),p=p||f;let He;if(T)He=T;else{const _e=this._settings.textBaseline!="bottom"?.5*f:0;He=p*(q.length-1)+_e+Math.max(p,f)+m}return m===null&&(m=f),t.w=Z,t.h=He,t.lines=q,t.precision=n,Z||(Z=1),He||(He=1),(b||I)&&(Z=Math.min(Z,I-b)),(D||v)&&(He=Math.min(He,v-D)),t.width=Z,t.innerWidth=re,t.height=He,t.fontSize=f,t.cutSx=b,t.cutSy=D,t.cutEx=I,t.cutEy=v,t.lineHeight=p,t.lineWidths=me,t.offsetY=m,t.paddingLeft=a,t.paddingRight=u,t.letterSpacing=O,t.textIndent=W,t}_draw(){const t=this._calculateRenderInfo(),n=this.getPrecision();this._canvas.width=Math.ceil(t.width+this._stage.getOption("textRenderIssueMargin")),this._canvas.height=Math.ceil(t.height),this.setFontProperties(),t.fontSize>=128&&(this._context.globalAlpha=.01,this._context.fillRect(0,0,.01,.01),this._context.globalAlpha=1),(t.cutSx||t.cutSy)&&this._context.translate(-t.cutSx,-t.cutSy);let a,u,f=[];for(let p=0,x=t.lines.length;p<x;p++)a=p===0?t.textIndent:0,u=p*t.lineHeight+t.offsetY,this._settings.verticalAlign=="middle"?u+=(t.lineHeight-t.fontSize)/2:this._settings.verticalAlign=="bottom"&&(u+=t.lineHeight-t.fontSize),this._settings.textAlign==="right"?a+=t.innerWidth-t.lineWidths[p]:this._settings.textAlign==="center"&&(a+=(t.innerWidth-t.lineWidths[p])/2),a+=t.paddingLeft,f.push({text:t.lines[p],x:a,y:u,w:t.lineWidths[p]});if(this._settings.highlight){let p=this._settings.highlightColor||0,x=this._settings.highlightHeight*n||t.fontSize*1.5;const T=this._settings.highlightOffset*n,A=this._settings.highlightPaddingLeft!==null?this._settings.highlightPaddingLeft*n:t.paddingLeft,b=this._settings.highlightPaddingRight!==null?this._settings.highlightPaddingRight*n:t.paddingRight;this._context.fillStyle=ye.getRgbaString(p);for(let I=0;I<f.length;I++){let D=f[I];this._context.fillRect(D.x-A,D.y-t.offsetY+T,D.w+b+A,x)}}let m=null;this._settings.shadow&&(m=[this._context.shadowColor,this._context.shadowOffsetX,this._context.shadowOffsetY,this._context.shadowBlur],this._context.shadowColor=ye.getRgbaString(this._settings.shadowColor),this._context.shadowOffsetX=this._settings.shadowOffsetX*n,this._context.shadowOffsetY=this._settings.shadowOffsetY*n,this._context.shadowBlur=this._settings.shadowBlur*n),this._context.fillStyle=ye.getRgbaString(this._settings.textColor);for(let p=0,x=f.length;p<x;p++){let T=f[p];if(t.letterSpacing===0)this._context.fillText(T.text,T.x,T.y);else{const A=T.text.split("");let b=T.x;for(let I=0,D=A.length;I<D;I++)this._context.fillText(A[I],b,T.y),b+=this.measureText(A[I],t.letterSpacing)}}m&&(this._context.shadowColor=m[0],this._context.shadowOffsetX=m[1],this._context.shadowOffsetY=m[2],this._context.shadowBlur=m[3]),(t.cutSx||t.cutSy)&&this._context.translate(t.cutSx,t.cutSy),this.renderInfo=t}wrapWord(t,n,a){const u=this._context.measureText(a).width,f=t.length,m=this._context.measureText(t).width;if(m<=n)return t;let p=Math.floor(n*f/m),x=this._context.measureText(t.substring(0,p)).width+u;if(x>n)for(;p>0&&(x=this._context.measureText(t.substring(0,p)).width+u,x>n);)p-=1;else for(;p<f;)if(x=this._context.measureText(t.substring(0,p)).width+u,x<n)p+=1;else{p-=1;break}return t.substring(0,p)+(n>=u?a:"")}wrapText(t,n,a,u=0){let f=t.split(/\r?\n/g),m=[],p=[];for(let x=0;x<f.length;x++){let T=[],A="",b=n-u,I=f[x].split(" ");for(let D=0;D<I.length;D++){const v=this.measureText(I[D],a),O=v+this.measureText(" ",a);D===0||O>b?(D>0&&(T.push(A),A=""),A+=I[D],b=n-v-(D===0?u:0)):(b-=O,A+=" "+I[D])}T.push(A),A="",m=m.concat(T),x<f.length-1&&p.push(m.length)}return{l:m,n:p}}measureText(t,n=0){return n?t.split("").reduce((a,u)=>a+this._context.measureText(u).width+n,0):this._context.measureText(t).width}}class Yx{constructor(t,n,a){this._stage=t,this._canvas=n,this._context=this._canvas.getContext("2d"),this._settings=a}getPrecision(){return this._settings.precision}setFontProperties(){const t=Wl(this._settings.fontFace,this._settings.fontStyle,this._settings.fontSize,this.getPrecision(),this._stage.getOption("defaultFontFace"));return this._context.font=t,this._context.textBaseline=this._settings.textBaseline,t}_load(){if(X.isWeb&&document.fonts){const t=Wl(this._settings.fontFace,this._settings.fontStyle,this._settings.fontSize,this.getPrecision(),this._stage.getOption("defaultFontFace"));try{if(!document.fonts.check(t,this._settings.text))return document.fonts.load(t,this._settings.text).catch(n=>{console.warn("Font load error",n,t)}).then(()=>{document.fonts.check(t,this._settings.text)||console.warn("Font not found",t)})}catch(n){console.warn("Can't check font loading for "+t)}}}draw(){const t=this._load();return t?t.then(()=>X.isSpark?this._stage.platform.drawText(this):this._draw()):X.isSpark?this._stage.platform.drawText(this):this._draw()}_calculateRenderInfo(){let t={};const n=this.getPrecision(),a=this._settings.paddingLeft*n,u=this._settings.paddingRight*n,f=this._settings.fontSize*n,m=this._settings.lineHeight*n||f,p=this._settings.w!=0?this._settings.w*n:2048/n,x=this._settings.wordWrapWidth*n,T=this._settings.cutSx*n,A=this._settings.cutEx*n,b=this._settings.cutSy*n,I=this._settings.cutEy*n,D=this._settings.letterSpacing||0;t.baseFont=this.setFontProperties(),t.w=p,t.width=p,t.text=this._settings.text,t.precision=n,t.fontSize=f,t.fontBaselineRatio=this._settings.fontBaselineRatio,t.lineHeight=m,t.letterSpacing=D,t.textAlign=this._settings.textAlign,t.textColor=this._settings.textColor,t.verticalAlign=this._settings.verticalAlign,t.highlight=this._settings.highlight,t.highlightColor=this._settings.highlightColor,t.highlightHeight=this._settings.highlightHeight,t.highlightPaddingLeft=this._settings.highlightPaddingLeft,t.highlightPaddingRight=this._settings.highlightPaddingRight,t.highlightOffset=this._settings.highlightOffset,t.paddingLeft=this._settings.paddingLeft,t.paddingRight=this._settings.paddingRight,t.maxLines=this._settings.maxLines,t.maxLinesSuffix=this._settings.maxLinesSuffix,t.textOverflow=this._settings.textOverflow,t.wordWrap=this._settings.wordWrap,t.wordWrapWidth=x,t.shadow=this._settings.shadow,t.shadowColor=this._settings.shadowColor,t.shadowOffsetX=this._settings.shadowOffsetX,t.shadowOffsetY=this._settings.shadowOffsetY,t.shadowBlur=this._settings.shadowBlur,t.cutSx=T,t.cutEx=A,t.cutSy=b,t.cutEy=I,t.textIndent=this._settings.textIndent*n,t.wordBreak=this._settings.wordBreak;let v=t.text,O=t.wordWrap&&t.wordWrapWidth||t.width;if(t.textOverflow&&!t.wordWrap){let q;switch(this._settings.textOverflow){case"clip":q="";break;case"ellipsis":q=this._settings.maxLinesSuffix;break;default:q=this._settings.textOverflow}v=this.wrapWord(v,x||t.w,q)}v=this.tokenize(v),v=this.parse(v),v=this.measure(v,D,t.baseFont),t.textIndent&&(v=this.indent(v,t.textIndent)),t.wordBreak&&(v=v.reduce((q,xe)=>q.concat(this.wordBreak(xe,O,t.baseFont)),[]),this.resetFontStyle());let W=a,Z=0;for(const q of v)(t.wordWrap&&W+q.width>O||q.text==`
`)&&(W=a,Z+=1),q.lineNo=Z,q.text!=`
`&&(q.x=W,W+=q.width);t.lineNum=Z+1,this._settings.h?t.h=this._settings.h:t.maxLines&&t.maxLines<t.lineNum?t.h=t.maxLines*t.lineHeight+f/2:t.h=t.lineNum*t.lineHeight+f/2;const re=t.fontBaselineRatio*t.fontSize;let Q=0;t.verticalAlign=="top"&&this._context.textBaseline=="alphabetic"?Q=-re:t.verticalAlign=="middle"?Q=(t.lineHeight-t.fontSize-re)/2:this._settings.verticalAlign=="bottom"&&(Q=t.lineHeight-t.fontSize),t.lines=[];for(let q=0;q<t.lineNum;q++)t.lines[q]={width:0,x:0,y:t.lineHeight*q+Q,text:[]};for(let q of v)t.lines[q.lineNo].text.push(q);for(const q of t.lines){if(q.text.length==0)continue;const xe=q.text[0].text,me=q.text[q.text.length-1].text;xe==`
`&&q.text.shift(),(me==" "||me==`
`)&&q.text.pop()}for(let q of t.lines)q.width=q.text.reduce((xe,me)=>xe+me.width,0);if(t.width=this._settings.w!=0?this._settings.w*n:Math.max(...t.lines.map(q=>q.width))+u,t.w=t.width,t.maxLines&&t.lineNum>t.maxLines&&t.maxLinesSuffix){const q=t.maxLines-1;let xe=v.filter(ce=>ce.lineNo==q),me=t.maxLinesSuffix;me=this.tokenize(me),me=this.parse(me),me=this.measure(me,t.letterSpacing,t.baseFont);for(const ce of me)ce.lineNo=q,ce.x=0,xe.push(ce);const He=me.length+1;let _e=xe.reduce((ce,C)=>ce+C.width,0);for(;(_e>t.width||xe[xe.length-He].text==" ")&&(xe.splice(xe.length-He,1),_e=xe.reduce((ce,C)=>ce+C.width,0),!(xe.length<He)););this.alignLine(xe,xe[0].x),t.lines[q].text=xe,t.lines[q].width=_e}if(t.textAlign=="center")for(let q of t.lines)q.x=(t.width-q.width-a)/2;else if(t.textAlign=="right")for(let q of t.lines)q.x=t.width-q.width-a;return t}_draw(){const t=this._calculateRenderInfo(),n=this.getPrecision(),a=t.paddingLeft*n;let u=t.w||t.width;(t.cutSx||t.cutEx)&&(u=Math.min(t.w,t.cutEx-t.cutSx));let f=t.h;if((t.cutSy||t.cutEy)&&(f=Math.min(t.h,t.cutEy-t.cutSy)),this._canvas.width=Math.ceil(u+this._stage.getOption("textRenderIssueMargin")),this._canvas.height=Math.ceil(f),this.setFontProperties(),t.fontSize>=128&&(this._context.globalAlpha=.01,this._context.fillRect(0,0,.01,.01),this._context.globalAlpha=1),(t.cutSx||t.cutSy)&&this._context.translate(-t.cutSx,-t.cutSy),t.highlight){const T=t.highlightColor||0,A=t.highlightHeight?t.highlightHeight*n:t.fontSize*1.5,b=t.highlightOffset?t.highlightOffset*n:0,I=t.highlightPaddingLeft!==null?t.highlightPaddingLeft*n:t.paddingLeft,D=t.highlightPaddingRight!==null?t.highlightPaddingRight*n:t.paddingRight;this._context.fillStyle=ye.getRgbaString(T);const v=t.maxLines?Math.min(t.maxLines,t.lineNum):t.lineNum;for(let O=0;O<v;O++){const W=t.lines[O];this._context.fillRect(W.x-I+a,W.y+b,W.width+I+D,A)}}let m=null;this._settings.shadow&&(m=[this._context.shadowColor,this._context.shadowOffsetX,this._context.shadowOffsetY,this._context.shadowBlur],this._context.shadowColor=ye.getRgbaString(this._settings.shadowColor),this._context.shadowOffsetX=this._settings.shadowOffsetX*n,this._context.shadowOffsetY=this._settings.shadowOffsetY*n,this._context.shadowBlur=this._settings.shadowBlur*n);const p=ye.getRgbaString(this._settings.textColor);let x=p;this._context.fillStyle=p;for(const T of t.lines)for(const A of T.text){let b=0;if(A.text!=`
`&&!(t.maxLines&&A.lineNo>=t.maxLines))if(A.color!=x&&(x=A.color,this._context.fillStyle=x),this._context.font=A.fontStyle,A.letters)for(let I of A.letters){const D=t.lines[A.lineNo].x+A.x+b;this._context.fillText(I.text,D,t.lines[A.lineNo].y+t.fontSize),b+=I.width}else{const I=t.lines[A.lineNo].x+A.x;this._context.fillText(A.text,I,t.lines[A.lineNo].y+t.fontSize)}}m&&(this._context.shadowColor=m[0],this._context.shadowOffsetX=m[1],this._context.shadowOffsetY=m[2],this._context.shadowBlur=m[3]),(t.cutSx||t.cutSy)&&this._context.translate(t.cutSx,t.cutSy),t.lines=t.lines.map(T=>T.text.reduce((A,b)=>A+b.text,"")),t.maxLines&&(t.lines=t.lines.slice(0,t.maxLines)),this.renderInfo=t}measureText(t,n=0){return n?t.split("").reduce((a,u)=>a+this._context.measureText(u).width+n,0):this._context.measureText(t).width}tokenize(t){const n=/ |\n|<i>|<\/i>|<b>|<\/b>|<color=0[xX][0-9a-fA-F]{8}>|<\/color>/g,a=t.match(n)||[],u=t.split(n)||[];let f=[];for(let m=0;m<u.length;m++)f.push(u[m],a[m]);return f.pop(),f.filter(m=>m!="")}parse(t){let n=0,a=0,u=[ye.getRgbaString(this._settings.textColor)],f=0;const m=/<color=(0[xX][0-9a-fA-F]{8})>/;return t.map(p=>{if(p=="<i>")n+=1,p="";else if(p=="</i>"&&n>0)n-=1,p="";else if(p=="<b>")a+=1,p="";else if(p=="</b>"&&a>0)a-=1,p="";else if(p=="</color>")u.length>1&&(f-=1,u.pop()),p="";else if(m.test(p)){const x=m.exec(p);u.push(ye.getRgbaString(parseInt(x[1]))),f+=1,p=""}return{text:p,italic:n,bold:a,color:u[f]}}).filter(p=>p.text!="")}applyFontStyle(t,n){let a=n;t.bold&&(a="bold "+a),t.italic&&(a="italic "+a),this._context.font=a,t.fontStyle=a}resetFontStyle(t){this._context.font=t}measure(t,n=0,a){for(const u of t)if(this.applyFontStyle(u,a),u.width=this.measureText(u.text,n),n>0){u.letters=u.text.split("").map(f=>({text:f}));for(let f of u.letters)f.width=this.measureText(f.text,n)}return this.resetFontStyle(a),t}indent(t,n){return t.splice(0,0,{text:"",width:n}),t}wrapWord(t,n,a){const u=this._context.measureText(a).width,f=t.length,m=this._context.measureText(t).width;if(m<=n)return t;let p=Math.floor(n*f/m),x=this._context.measureText(t.substring(0,p)).width+u;if(x>n)for(;p>0&&(x=this._context.measureText(t.substring(0,p)).width+u,x>n);)p-=1;else for(;p<f;)if(x=this._context.measureText(t.substring(0,p)).width+u,x<n)p+=1;else{p-=1;break}return t.substring(0,p)+(n>=u?a:"")}_getBreakIndex(t,n){const a=t.length,u=this.measureText(t);if(u<=n)return{breakIndex:t.length,truncWordWidth:u};let f=Math.floor(n*a/u),m=this.measureText(t.substring(0,f));if(m>n)for(;f>0&&(m=this.measureText(t.substring(0,f)),m>n);)f-=1;else for(;f<a;)if(m=this.measureText(t.substring(0,f)),m<n)f+=1;else{f-=1,m=this.measureText(t.substring(0,f));break}return{breakIndex:f,truncWordWidth:m}}wordBreak(t,n,a){if(!t.text)return t;this.applyFontStyle(t,a);const u=[];let f=t.text;if(t.letters){let m=0,p=[],x=0;for(const T of t.letters)m+T.width>=n?(u.push({...t}),u[u.length-1].text=f.slice(0,x),u[u.length-1].width=m,u[u.length-1].letters=p,f=f.slice(x),m=0,p=[],x=0):(x+=1,p.push(T),m+=T.width);m>0&&(u.push({...t}),u[u.length-1].text=f.slice(0,x),u[u.length-1].width=m,u[u.length-1].letters=p)}else for(;;){const{breakIndex:m,truncWordWidth:p}=this._getBreakIndex(f,n);if(u.push({...t}),u[u.length-1].text=f.slice(0,m),u[u.length-1].width=p,m===f.length)break;f=f.slice(m)}return u}alignLine(t,n=0){let a=0,u=n;for(const f of t)f.text!=`
`&&(f.x=u+a,u=f.x,a=f.width)}}class cn extends Zt{constructor(t){super(t),this._precision=this.stage.getOption("precision")}static renderer(t,n,a){return this.advancedRenderer?new Yx(t,n,a):new $x(t,n,a)}get text(){return this._text}set text(t){this._text!==t&&(this._text=""+t,this._changed())}get w(){return this._w}set w(t){this._w!==t&&(this._w=t,this._changed())}get h(){return this._h}set h(t){this._h!==t&&(this._h=t,this._changed())}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle!==t&&(this._fontStyle=t,this._changed())}get fontBaselineRatio(){return this._fontBaselineRatio}set fontBaselineRatio(t){this._fontBaselineRatio!==t&&(this._fontBaselineRatio=t,this._changed())}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this._changed())}get fontFace(){return this._fontFace}set fontFace(t){this._fontFace!==t&&(this._fontFace=t,this._changed())}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap!==t&&(this._wordWrap=t,this._changed())}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this._changed())}get wordBreak(){return this._wordBreak}set wordBreak(t){this._wordBreak!==t&&(this._wordBreak=t,this._changed())}get textOverflow(){return this._textOverflow}set textOverflow(t){t!=this._textOverflow&&(this._textOverflow=t,this._changed())}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight!==t&&(this._lineHeight=t,this._changed())}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline!==t&&(this._textBaseline=t,this._changed())}get textAlign(){return this._textAlign}set textAlign(t){this._textAlign!==t&&(this._textAlign=t,this._changed())}get verticalAlign(){return this._verticalAlign}set verticalAlign(t){this._verticalAlign!==t&&(this._verticalAlign=t,this._changed())}get offsetY(){return this._offsetY}set offsetY(t){this._offsetY!==t&&(this._offsetY=t,this._changed())}get maxLines(){return this._maxLines}set maxLines(t){this._maxLines!==t&&(this._maxLines=t,this._changed())}get maxLinesSuffix(){return this._maxLinesSuffix}set maxLinesSuffix(t){this._maxLinesSuffix!==t&&(this._maxLinesSuffix=t,this._changed())}get textColor(){return this._textColor}set textColor(t){this._textColor!==t&&(this._textColor=t,this._changed())}get paddingLeft(){return this._paddingLeft}set paddingLeft(t){this._paddingLeft!==t&&(this._paddingLeft=t,this._changed())}get paddingRight(){return this._paddingRight}set paddingRight(t){this._paddingRight!==t&&(this._paddingRight=t,this._changed())}get shadow(){return this._shadow}set shadow(t){this._shadow!==t&&(this._shadow=t,this._changed())}get shadowColor(){return this._shadowColor}set shadowColor(t){this._shadowColor!==t&&(this._shadowColor=t,this._changed())}get shadowOffsetX(){return this._shadowOffsetX}set shadowOffsetX(t){this._shadowOffsetX!==t&&(this._shadowOffsetX=t,this._changed())}get shadowOffsetY(){return this._shadowOffsetY}set shadowOffsetY(t){this._shadowOffsetY!==t&&(this._shadowOffsetY=t,this._changed())}get shadowBlur(){return this._shadowBlur}set shadowBlur(t){this._shadowBlur!==t&&(this._shadowBlur=t,this._changed())}get highlight(){return this._highlight}set highlight(t){this._highlight!==t&&(this._highlight=t,this._changed())}get highlightHeight(){return this._highlightHeight}set highlightHeight(t){this._highlightHeight!==t&&(this._highlightHeight=t,this._changed())}get highlightColor(){return this._highlightColor}set highlightColor(t){this._highlightColor!==t&&(this._highlightColor=t,this._changed())}get highlightOffset(){return this._highlightOffset}set highlightOffset(t){this._highlightOffset!==t&&(this._highlightOffset=t,this._changed())}get highlightPaddingLeft(){return this._highlightPaddingLeft}set highlightPaddingLeft(t){this._highlightPaddingLeft!==t&&(this._highlightPaddingLeft=t,this._changed())}get highlightPaddingRight(){return this._highlightPaddingRight}set highlightPaddingRight(t){this._highlightPaddingRight!==t&&(this._highlightPaddingRight=t,this._changed())}get cutSx(){return this._cutSx}set cutSx(t){this._cutSx!==t&&(this._cutSx=t,this._changed())}get cutEx(){return this._cutEx}set cutEx(t){this._cutEx!==t&&(this._cutEx=t,this._changed())}get cutSy(){return this._cutSy}set cutSy(t){this._cutSy!==t&&(this._cutSy=t,this._changed())}get cutEy(){return this._cutEy}set cutEy(t){this._cutEy!==t&&(this._cutEy=t,this._changed())}get advancedRenderer(){return this._advancedRenderer}set advancedRenderer(t){this._advancedRenderer!==t&&(this._advancedRenderer=t,this._changed())}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this._changed())}get letterSpacing(){return this._letterSpacing}set textIndent(t){this._textIndent!==t&&(this._textIndent=t,this._changed())}get textIndent(){return this._textIndent}get precision(){return super.precision}set precision(t){this.precision!==t&&(super.precision=t,this._changed())}_getIsValid(){return!!this.text}_getLookupId(){let t=[];return this.w!==0&&t.push("w "+this.w),this.h!==0&&t.push("h "+this.h),this.fontStyle!=="normal"&&t.push("fS"+this.fontStyle),this.fontSize!==40&&t.push("fs"+this.fontSize),this.fontBaselineRatio!==0&&t.push("fb"+this.fontBaselineRatio),this.fontFace!==null&&t.push("ff"+(Array.isArray(this.fontFace)?this.fontFace.join(","):this.fontFace)),this.wordWrap!==!0&&t.push("wr"+(this.wordWrap?1:0)),this.wordWrapWidth!==0&&t.push("ww"+this.wordWrapWidth),this.wordBreak!==!1&&t.push("wb"+this.wordBreak?1:0),this.textOverflow!=""&&t.push("to"+this.textOverflow),this.lineHeight!==null&&t.push("lh"+this.lineHeight),this.textBaseline!=="alphabetic"&&t.push("tb"+this.textBaseline),this.textAlign!=="left"&&t.push("ta"+this.textAlign),this.verticalAlign!=="top"&&t.push("va"+this.verticalAlign),this.offsetY!==null&&t.push("oy"+this.offsetY),this.maxLines!==0&&t.push("ml"+this.maxLines),this.maxLinesSuffix!==".."&&t.push("ms"+this.maxLinesSuffix),t.push("pc"+this.precision),this.textColor!==4294967295&&t.push("co"+this.textColor.toString(16)),this.paddingLeft!==0&&t.push("pl"+this.paddingLeft),this.paddingRight!==0&&t.push("pr"+this.paddingRight),this.shadow!==!1&&t.push("sh"+(this.shadow?1:0)),this.shadowColor!==4278190080&&t.push("sc"+this.shadowColor.toString(16)),this.shadowOffsetX!==0&&t.push("sx"+this.shadowOffsetX),this.shadowOffsetY!==0&&t.push("sy"+this.shadowOffsetY),this.shadowBlur!==5&&t.push("sb"+this.shadowBlur),this.highlight!==!1&&t.push("hL"+(this.highlight?1:0)),this.highlightHeight!==0&&t.push("hh"+this.highlightHeight),this.highlightColor!==4278190080&&t.push("hc"+this.highlightColor.toString(16)),this.highlightOffset!==null&&t.push("ho"+this.highlightOffset),this.highlightPaddingLeft!==null&&t.push("hl"+this.highlightPaddingLeft),this.highlightPaddingRight!==null&&t.push("hr"+this.highlightPaddingRight),this.letterSpacing!==null&&t.push("ls"+this.letterSpacing),this.textIndent!==null&&t.push("ti"+this.textIndent),this.cutSx&&t.push("csx"+this.cutSx),this.cutEx&&t.push("cex"+this.cutEx),this.cutSy&&t.push("csy"+this.cutSy),this.cutEy&&t.push("cey"+this.cutEy),this.advancedRenderer&&t.push("aR"+this.advancedRenderer?1:0),"TX$"+t.join("|")+":"+this.text}_getSourceLoader(){const t=this.cloneArgs(),n=this.stage.gl;return function(a){const u=this.stage.platform.getDrawingCanvas(),f=t.advancedRenderer?new Yx(this.stage,u,t):new $x(this.stage,u,t),m=f.draw(),p={},x=this.stage.getOption("fontSharp");let T=!1;X.isBoolean(x)?T=x:X.isObject(x)&&(T=this.stage.getRenderPrecision()<=x.precision&&t.fontSize<=x.fontSize),n&&T&&(p[n.TEXTURE_MAG_FILTER]=n.NEAREST),m?m.then(()=>{a(null,Object.assign({renderInfo:f.renderInfo,throttle:!1,texParams:p},this.stage.platform.getTextureOptionsForDrawingCanvas(u)))}).catch(A=>{a(A)}):a(null,Object.assign({renderInfo:f.renderInfo,throttle:!1,texParams:p},this.stage.platform.getTextureOptionsForDrawingCanvas(u)))}}getNonDefaults(){const t=super.getNonDefaults();return this.text!==""&&(t.text=this.text),this.w!==0&&(t.w=this.w),this.h!==0&&(t.h=this.h),this.fontStyle!=="normal"&&(t.fontStyle=this.fontStyle),this.fontSize!==40&&(t.fontSize=this.fontSize),this.fontBaselineRatio!==0&&(t.fontBaselineRatio=this.fontBaselineRatio),this.fontFace!==null&&(t.fontFace=this.fontFace),this.wordWrap!==!0&&(t.wordWrap=this.wordWrap),this.wordWrapWidth!==0&&(t.wordWrapWidth=this.wordWrapWidth),this.wordBreak!==!1&&(t.wordBreak=this.wordBreak),this.textOverflow!=""&&(t.textOverflow=this.textOverflow),this.lineHeight!==null&&(t.lineHeight=this.lineHeight),this.textBaseline!=="alphabetic"&&(t.textBaseline=this.textBaseline),this.textAlign!=="left"&&(t.textAlign=this.textAlign),this.verticalAlign!=="top"&&(t.verticalAlign=this.verticalAlign),this.offsetY!==null&&(t.offsetY=this.offsetY),this.maxLines!==0&&(t.maxLines=this.maxLines),this.maxLinesSuffix!==".."&&(t.maxLinesSuffix=this.maxLinesSuffix),this.precision!==this.stage.getOption("precision")&&(t.precision=this.precision),this.textColor!==4294967295&&(t.textColor=this.textColor),this.paddingLeft!==0&&(t.paddingLeft=this.paddingLeft),this.paddingRight!==0&&(t.paddingRight=this.paddingRight),this.shadow!==!1&&(t.shadow=this.shadow),this.shadowColor!==4278190080&&(t.shadowColor=this.shadowColor),this.shadowOffsetX!==0&&(t.shadowOffsetX=this.shadowOffsetX),this.shadowOffsetY!==0&&(t.shadowOffsetY=this.shadowOffsetY),this.shadowBlur!==5&&(t.shadowBlur=this.shadowBlur),this.highlight!==!1&&(t.highlight=this.highlight),this.highlightHeight!==0&&(t.highlightHeight=this.highlightHeight),this.highlightColor!==4278190080&&(t.highlightColor=this.highlightColor),this.highlightOffset!==0&&(t.highlightOffset=this.highlightOffset),this.highlightPaddingLeft!==0&&(t.highlightPaddingLeft=this.highlightPaddingLeft),this.highlightPaddingRight!==0&&(t.highlightPaddingRight=this.highlightPaddingRight),this.letterSpacing!==0&&(t.letterSpacing=this.letterSpacing),this.textIndent!==0&&(t.textIndent=this.textIndent),this.cutSx&&(t.cutSx=this.cutSx),this.cutEx&&(t.cutEx=this.cutEx),this.cutSy&&(t.cutSy=this.cutSy),this.cutEy&&(t.cutEy=this.cutEy),this.advancedRenderer&&(t.renderer=this.advancedRenderer),t}cloneArgs(){let t={};return t.text=this._text,t.w=this._w,t.h=this._h,t.fontStyle=this._fontStyle,t.fontSize=this._fontSize,t.fontBaselineRatio=this._fontBaselineRatio,t.fontFace=this._fontFace,t.wordWrap=this._wordWrap,t.wordWrapWidth=this._wordWrapWidth,t.wordBreak=this._wordBreak,t.textOverflow=this._textOverflow,t.lineHeight=this._lineHeight,t.textBaseline=this._textBaseline,t.textAlign=this._textAlign,t.verticalAlign=this._verticalAlign,t.offsetY=this._offsetY,t.maxLines=this._maxLines,t.maxLinesSuffix=this._maxLinesSuffix,t.precision=this._precision,t.textColor=this._textColor,t.paddingLeft=this._paddingLeft,t.paddingRight=this._paddingRight,t.shadow=this._shadow,t.shadowColor=this._shadowColor,t.shadowOffsetX=this._shadowOffsetX,t.shadowOffsetY=this._shadowOffsetY,t.shadowBlur=this._shadowBlur,t.highlight=this._highlight,t.highlightHeight=this._highlightHeight,t.highlightColor=this._highlightColor,t.highlightOffset=this._highlightOffset,t.highlightPaddingLeft=this._highlightPaddingLeft,t.highlightPaddingRight=this._highlightPaddingRight,t.letterSpacing=this._letterSpacing,t.textIndent=this._textIndent,t.cutSx=this._cutSx,t.cutEx=this._cutEx,t.cutSy=this._cutSy,t.cutEy=this._cutEy,t.advancedRenderer=this._advancedRenderer,t}}let Re=cn.prototype;Re._text="";Re._w=0;Re._h=0;Re._fontStyle="normal";Re._fontSize=40;Re._fontFace=null;Re._wordWrap=!0;Re._wordWrapWidth=0;Re._wordBreak=!1;Re._textOverflow="";Re._lineHeight=null;Re._textBaseline="alphabetic";Re._textAlign="left";Re._verticalAlign="top";Re._offsetY=null;Re._maxLines=0;Re._maxLinesSuffix="..";Re._textColor=4294967295;Re._paddingLeft=0;Re._paddingRight=0;Re._shadow=!1;Re._shadowColor=4278190080;Re._shadowOffsetX=0;Re._shadowOffsetY=0;Re._shadowBlur=5;Re._highlight=!1;Re._highlightHeight=0;Re._highlightColor=4278190080;Re._highlightOffset=0;Re._highlightPaddingLeft=0;Re._highlightPaddingRight=0;Re._letterSpacing=0;Re._textIndent=0;Re._cutSx=0;Re._cutEx=0;Re._cutSy=0;Re._cutEy=0;Re._advancedRenderer=!1;Re._fontBaselineRatio=0;class Nv extends Zt{constructor(t){super(t),this._textureSource=void 0}get textureSource(){return this._textureSource}set textureSource(t){t!==this._textureSource&&(t.isResultTexture&&(this._precision=this.stage.getRenderPrecision()),this._textureSource=t,this._changed())}_getTextureSource(){return this._textureSource}}class Sd extends at{constructor(t,n,a,u){super(),this.manager=t,this._settings=n,this._element=a,this._getter=a.constructor.getGetter(u),this._setter=a.constructor.getSetter(u),this._merger=n.merger,this._merger||(this._merger=a.constructor.getMerger(u)),this._startValue=this._getter(this._element),this._targetValue=this._startValue,this._p=1,this._delayLeft=0}start(t){this._startValue=this._getter(this._element),this.isAttached()?t===this._startValue?this.reset(t,1):(this._targetValue=t,this._p=0,this._delayLeft=this._settings.delay,this.emit("start"),this.add()):(this._targetValue=t,this._p=1,this._updateDrawValue())}finish(){this._p<1&&(this._p=1)}stop(){this.emit("stop"),this.manager.removeActive(this)}pause(){this.stop()}play(){this.manager.addActive(this)}reset(t,n){this.isAttached()?(this._startValue=this._getter(this._element),this._targetValue=t,this._p=n,this.add()):(this._startValue=this._getter(this._element),this._targetValue=t,this._p=1,this._updateDrawValue())}_updateDrawValue(){this._setter(this._element,this.getDrawValue())}add(){this.manager.addActive(this)}isAttached(){return this._element.attached}isRunning(){return this._p<1}progress(t){if(this.isAttached()||(this._p=1),this.p<1){if(this.delayLeft>0)if(this._delayLeft-=t,this.delayLeft<0)t=-this.delayLeft,this._delayLeft=0,this.emit("delayEnd");else return;this._settings.duration==0?this._p=1:this._p+=t/this._settings.duration,this._p>=1&&(this._p=1)}this._updateDrawValue(),this.invokeListeners()}invokeListeners(){this.emit("progress",this.p),this.p===1&&this.emit("finish")}updateTargetValue(t){let n=this._settings.timingFunctionImpl(this.p);n===1?this._targetValue=t:n===0?(this._startValue=this._targetValue,this._targetValue=t):(this._startValue=t-(t-this._targetValue)/(1-n),this._targetValue=t)}getDrawValue(){if(this.p>=1)return this.targetValue;{let t=this._settings._timingFunctionImpl(this.p);return this._merger(this.targetValue,this.startValue,t)}}skipDelay(){this._delayLeft=0}get startValue(){return this._startValue}get targetValue(){return this._targetValue}get p(){return this._p}get delayLeft(){return this._delayLeft}get element(){return this._element}get settings(){return this._settings}set settings(t){this._settings=t}}Sd.prototype.isTransition=!0;class Uv{constructor(){this._items=[],this._refs={}}get(){return this._items}get first(){return this._items[0]}get last(){return this._items.length?this._items[this._items.length-1]:void 0}add(t){this.addAt(t,this._items.length)}addAt(t,n){if(n>=0&&n<=this._items.length){let a=this._items.indexOf(t);if(a===n)return t;if(X.isObjectLiteral(t)){const u=t;t=this.createItem(u),t.patch(u)}a!=-1?this.setAt(t,n):(t.ref&&(this._refs[t.ref]=t),this._items.splice(n,0,t),this.onAdd(t,n))}else throw new Error("addAt: The index "+n+" is out of bounds "+this._items.length)}replaceByRef(t){if(t.ref){const n=this.getByRef(t.ref);if(!n)throw new Error("replaceByRef: no item found with reference: "+t.ref);this.replace(t,n)}else throw new Error("replaceByRef: no ref specified in item");this.addAt(t,this._items.length)}replace(t,n){const a=this.getIndex(n);if(a===-1)throw new Error("replace: The previous item does not exist");this.setAt(t,a)}setAt(t,n){if(n>=0&&n<this._items.length){if(X.isObjectLiteral(t)){const u=t;t=this.createItem(u),t.patch(u)}let a=this._items.indexOf(t);if(a!=-1){if(a!==n){const u=a;u!==n&&(this._items.splice(u,1),this._items.splice(n,0,t),this.onMove(t,u,n))}}else{n<this._items.length&&this._items[n].ref&&(this._refs[this._items[n].ref]=void 0);const u=this._items[n];this._items[n]=t,t.ref&&(this._refs[t.ref]=t),this.onSet(t,n,u)}}else throw new Error("setAt: The index "+n+" is out of bounds "+this._items.length)}getAt(t){return this._items[t]}getIndex(t){return this._items.indexOf(t)}remove(t){let n=this._items.indexOf(t);n!==-1&&this.removeAt(n)}removeAt(t){if(t>=0&&t<this._items.length){const n=this._items[t];return n.ref&&(this._refs[n.ref]=void 0),this._items.splice(t,1),this.onRemove(n,t),n}else throw new Error(`removeAt: The index ${t} is out of bounds ${this._items.length-1}`)}clear(){if(this._items.length){let n=this._items;this._items=[],this._refs={},this.onSync(n,[],[])}}a(t){if(X.isObjectLiteral(t)){let n=this.createItem(t);return n.patch(t),this.add(n),n}else if(Array.isArray(t)){for(let n=0,a=t.length;n<a;n++)this.a(t[n]);return null}else if(this.isItem(t))return this.add(t),t}get length(){return this._items.length}_getRefs(){return this._refs}getByRef(t){return this._refs[t]}clearRef(t){delete this._refs[t]}setRef(t,n){this._refs[t]=n}patch(t){X.isObjectLiteral(t)?this._setByObject(t):Array.isArray(t)&&this._setByArray(t)}_setByObject(t){let n=this._getRefs(),a=Object.keys(t);for(let u=0,f=a.length;u<f;u++){let m=a[u],p=t[m],x=n[m];if(!x)this.isItem(p)?(p.ref=m,this.add(p)):(x=this.createItem(p),x.ref=m,x.patch(p),this.add(x));else if(this.isItem(p)){if(x!==p){let T=this.getIndex(x);p.ref=m,this.setAt(p,T)}}else x.patch(p)}}_equalsArray(t){let n=!0;if(t.length===this._items.length)for(let a=0,u=this._items.length;a<u&&n;a++)n=n&&this._items[a]===t[a];else n=!1;return n}_setByArray(t){if(this._equalsArray(t))return;for(let u=0,f=this._items.length;u<f;u++)this._items[u].marker=!0;let n,a=[];for(let u=0,f=t.length;u<f;u++){let m=t[u];if(this.isItem(m))m.marker=!1,a.push(m);else{let p=m.ref,x;p&&(n||(n=this._getRefs()),x=n[p]),x?x.marker=!1:x=this.createItem(m),X.isObjectLiteral(m)&&x.patch(m),a.push(x)}}this._setItems(a)}_setItems(t){let n=this._items;this._items=t;let a=n.filter(f=>{let m=f.marker;return delete f.marker,m}),u=t.filter(f=>n.indexOf(f)===-1);if(a.length||u.length){this._refs={};for(let f=0,m=this._items.length;f<m;f++){let p=this._items[f].ref;p&&(this._refs[p]=this._items[f])}}this.onSync(a,u,t)}sort(t){const n=this._items.slice();n.sort(t),this._setByArray(n)}onAdd(t,n){}onRemove(t,n){}onSync(t,n,a){}onSet(t,n,a){}onMove(t,n,a){}createItem(t){throw new Error("ObjectList.createItem must create and return a new object")}isItem(t){return!1}forEach(t){this.get().forEach(t)}}class _b extends Uv{constructor(t){super(),this._element=t}_connectParent(t){const n=t.parent;if(n&&n!==this._element){const a=t.parent.childList,u=a.getIndex(t);t.ref&&(a._refs[t.ref]=void 0),a._items.splice(u,1),n.core.removeChildAt(u)}t._setParent(this._element)}onAdd(t,n){this._connectParent(t),this._element.core.addChildAt(n,t.core)}onRemove(t,n){t._setParent(null),this._element.core.removeChildAt(n)}onSync(t,n,a){for(let f=0,m=t.length;f<m;f++)t[f]._setParent(null);for(let f=0,m=n.length;f<m;f++)this._connectParent(n[f]);let u=f=>f.core;this._element.core.syncChildren(t.map(u),n.map(u),a.map(u))}onSet(t,n,a){a._setParent(null),this._connectParent(t),this._element.core.setChildAt(n,t.core)}onMove(t,n,a){this._element.core.moveChild(n,a)}createItem(t){return t.type?new t.type(this._element.stage):this._element.stage.createElement()}isItem(t){return t.isElement}}let Yt=class qt{constructor(t){this.stage=t,this.__id=qt.id++,this.__start(),this._hasEventListeners=!1,this.__core=new fn(this),this.__ref=null,this.__attached=!1,this.__enabled=!1,this.__active=!1,this.__parent=null,this.__texture=null,this.__displayedTexture=null,this.__tags=null,this.__treeTags=null,this.__tagRoot=!1,this.__childList=null,this._w=0,this._h=0}__start(){}get id(){return this.__id}set ref(t){if(this.__ref!==t){const n=t.charCodeAt(0);X.isUcChar(n)||this._throwError("Ref must start with an upper case character: "+t),this.__ref!==null&&(this.removeTag(this.__ref),this.__parent&&this.__parent.__childList.clearRef(this.__ref)),this.__ref=t,this.__ref&&(this._addTag(this.__ref),this.__parent&&this.__parent.__childList.setRef(this.__ref,this))}}get ref(){return this.__ref}get core(){return this.__core}setAsRoot(){this.__core.setAsRoot(),this._updateAttachedFlag(),this._updateEnabledFlag()}get isRoot(){return this.__core.isRoot}_setParent(t){this.__parent!==t&&(this.__parent&&this._unsetTagsParent(),this.__parent=t,t&&this._setTagsParent(),this._updateAttachedFlag(),this._updateEnabledFlag(),this._updateCollision(),this.isRoot&&t&&this._throwError("Root should not be added as a child! Results are unspecified!"))}getDepth(){let t=0,n=this.__parent;for(;n;)t++,n=n.__parent;return t}getAncestor(t){let n=this;for(;t>0&&n.__parent;)n=n.__parent,t--;return n}getAncestors(){const t=[];let n=this;for(;n;)t.push(n),n=n.__parent;return t}getAncestorAtDepth(t){let n=this.getDepth()-t;return n<0?null:this.getAncestor(n)}isAncestorOf(t){let n=t;for(;n=n.parent;)if(this===n)return!0;return!1}getSharedAncestor(t){let n=this,a=t,u=n.getDepth(),f=a.getDepth();u>f?n=n.getAncestor(u-f):f>u&&(a=a.getAncestor(f-u));do{if(n===a)return n;n=n.__parent,a=a.__parent}while(n&&a);return null}get attached(){return this.__attached}get enabled(){return this.__enabled}get active(){return this.__active}_isAttached(){return this.__parent?this.__parent.__attached:this.stage.root===this}_isEnabled(){return this.__core.visible&&this.__core.alpha>0&&(this.__parent?this.__parent.__enabled:this.stage.root===this)}_isActive(){return this._isEnabled()&&this.withinBoundsMargin}_updateAttachedFlag(){let t=this._isAttached();if(this.__attached!==t){this.__attached=t,t&&this._onSetup();let n=this._children.get();if(n){let a=n.length;if(a>0)for(let u=0;u<a;u++)n[u]._updateAttachedFlag()}t?this._onAttach():this._onDetach()}}_updateEnabledFlag(){let t=this._isEnabled();if(this.__enabled!==t){t?(this._onEnabled(),this._setEnabledFlag()):(this._onDisabled(),this._unsetEnabledFlag());let n=this._children.get();if(n){let a=n.length;if(a>0)for(let u=0;u<a;u++)n[u]._updateEnabledFlag()}}}_setEnabledFlag(){this.__enabled=!0,this._updateDimensions(),this._updateTextureCoords(),this.__texture&&this.__texture.addElement(this),this.withinBoundsMargin&&this._setActiveFlag(),this.__core.shader&&this.__core.shader.addElement(this.__core)}_unsetEnabledFlag(){this.__active&&this._unsetActiveFlag(),this.__texture&&this.__texture.removeElement(this),this.__core.shader&&this.__core.shader.removeElement(this.__core),this._texturizer&&this.texturizer.filters.forEach(t=>t.removeElement(this.__core)),this.__enabled=!1}_setActiveFlag(){this.__active=!0,this.__texture&&this.__texture.incActiveCount(),this.__texture&&this._enableTexture(),this._onActive()}_unsetActiveFlag(){this.__texture&&this.__texture.decActiveCount(),this.__active=!1,this.__texture&&this._disableTexture(),this._hasTexturizer()&&this.texturizer.deactivate(),this._onInactive()}_onSetup(){}_onAttach(){}_onDetach(){}_onEnabled(){}_onDisabled(){}_onActive(){}_onInactive(){}_onResize(){}_getRenderWidth(){return this._w?this._w:this.__displayedTexture?this.__displayedTexture.getRenderWidth():this.__texture?this.__texture.getRenderWidth():0}_getRenderHeight(){return this._h?this._h:this.__displayedTexture?this.__displayedTexture.getRenderHeight():this.__texture?this.__texture.getRenderHeight():0}get renderWidth(){return this.__enabled?this.__core.getRenderWidth():this._getRenderWidth()}get renderHeight(){return this.__enabled?this.__core.getRenderHeight():this._getRenderHeight()}get finalX(){return this.__core.x}get finalY(){return this.__core.y}get finalW(){return this.__core.w}get finalH(){return this.__core.h}textureIsLoaded(){return this.__texture&&this.__texture.isLoaded()}loadTexture(){this.__texture&&(this.__texture.load(),(!this.__texture.isUsed()||!this._isEnabled())&&this._updateDimensions())}_enableTextureError(){const t=this.__texture.loadError;t&&this.emit("txError",t,this.__texture._source)}_enableTexture(){this.__texture.isLoaded()?this._setDisplayedTexture(this.__texture):(this._setDisplayedTexture(null),this._enableTextureError())}_disableTexture(){this._setDisplayedTexture(null)}get texture(){return this.__texture}set texture(t){let n;if(X.isObjectLiteral(t))t.type?n=new t.type(this.stage):n=this.texture,n&&Ct.patchObject(n,t);else if(!t)n=null;else if(t.isTexture)n=t;else if(t.isTextureSource)n=new Nv(this.stage),n.textureSource=t;else{console.error("[Lightning] Please specify a texture type.");return}const a=this.__texture;n!==a&&(this.__texture=n,this.__texture?this.__enabled&&(this.__texture.addElement(this),this.withinBoundsMargin&&(this.__texture.isLoaded()?this._setDisplayedTexture(this.__texture):this._enableTextureError())):this._setDisplayedTexture(null),a&&a!==this.__displayedTexture&&a.removeElement(this),this._updateDimensions())}get displayedTexture(){return this.__displayedTexture}_setDisplayedTexture(t){let n=this.__displayedTexture;n&&t!==n&&this.__texture!==n&&n.removeElement(this);const a=this.__core.displayedTextureSource?this.__core.displayedTextureSource._source:null,u=(t?t._source:null)!==a;this.__displayedTexture=t,this._updateDimensions(),this.__displayedTexture?u&&(this._updateTextureCoords(),this.__core.setDisplayedTextureSource(this.__displayedTexture._source)):this.__core.setDisplayedTextureSource(null),u&&(this.__displayedTexture?this.emit("txLoaded",this.__displayedTexture):this.emit("txUnloaded",this.__displayedTexture))}onTextureSourceLoaded(){this.active&&this._setDisplayedTexture(this.__texture)}onTextureSourceLoadError(t){this.emit("txError",t,this.__texture._source)}forceRenderUpdate(){this.__core.setHasRenderUpdates(3)}onDisplayedTextureClippingChanged(){this._updateDimensions(),this._updateTextureCoords()}onPrecisionChanged(){this._updateDimensions()}onDimensionsChanged(t,n){this.texture instanceof cn&&(this.texture.w=t,this.texture.h=n,this.w=t,this.h=n)}_updateDimensions(){let t=this._getRenderWidth(),n=this._getRenderHeight(),a=!1;(!t||!n)&&!this.__displayedTexture&&this.__texture&&(t=t||this.__texture.mw,n=n||this.__texture.mh,(!t||!n)&&this.__texture.isAutosizeTexture()&&(a=!0)),this.__core.setDimensions(t,n,a)&&this._onResize()}_updateTextureCoords(){if(this.displayedTexture&&this.displayedTexture._source){let t=this.displayedTexture,n=this.displayedTexture._source,a=0,u=0,f=1,m=1;if(t.clipping){let p=n.getRenderWidth(),x=n.getRenderHeight(),T,A,b,I;T=1/p,A=1/x,t.pw?b=t.pw*T:b=(p-t.px)*T,t.ph?I=t.ph*A:I=(x-t.py)*A,T*=t.px,A*=t.py,a=T,u=A,f=f*b+T,m=m*I+A,a=Math.max(0,a),u=Math.max(0,u),f=Math.min(1,f),m=Math.min(1,m)}if(n._flipTextureY){let p=m;m=u,u=p}this.__core.setTextureCoords(a,u,f,m)}}getCornerPoints(){return this.__core.getCornerPoints()}_unsetTagsParent(){this.__tags&&this.__tags.forEach(a=>{let u=this;for(;(u=u.__parent)&&(u.__treeTags.get(a).delete(this),!u.__tagRoot););});let t=null,n=0;if(this.__treeTags&&!this.__tagRoot&&(t=X.iteratorToArray(this.__treeTags.keys()),n=t.length,n>0))for(let a=0;a<n;a++){let u=this.__treeTags.get(t[a]),f=this;for(;f=f.__parent;){let m=f.__treeTags.get(t[a]);if(u.forEach(function(p){m.delete(p)}),f.__tagRoot)break}}}_setTagsParent(){this.__tags&&this.__tags.forEach(t=>{let n=this;for(;n=n.__parent;){n.__treeTags||(n.__treeTags=new Map);let a=n.__treeTags.get(t);if(a||(a=new Set,n.__treeTags.set(t,a)),a.add(this),n.__tagRoot)break}}),this.__treeTags&&this.__treeTags.size&&(this.__tagRoot||this.__treeTags.forEach((t,n)=>{let a=this;for(;!a.__tagRoot&&(a=a.__parent);){a.__tagRoot,a.__treeTags||(a.__treeTags=new Map);let u=a.__treeTags.get(n);u||(u=new Set,a.__treeTags.set(n,u)),t.forEach(function(f){u.add(f)})}}))}_getByTag(t){if(!this.__treeTags)return[];let n=this.__treeTags.get(t);return n?X.setToArray(n):[]}getTags(){return this.__tags?this.__tags:[]}setTags(t){t=t.reduce((p,x)=>p.concat(x.split(" ")),[]),this.__ref&&t.push(this.__ref);let n,a=t.length,u=[],f=[];for(n=0;n<a;n++)this.hasTag(t[n])||f.push(t[n]);let m=this.tags||[];for(a=m.length,n=0;n<a;n++)t.indexOf(m[n])==-1&&u.push(m[n]);for(n=0;n<u.length;n++)this.removeTag(u[n]);for(n=0;n<f.length;n++)this.addTag(f[n])}addTag(t){if(t.indexOf(" ")===-1)X.isUcChar(t.charCodeAt(0))&&this._throwError("Tag may not start with an upper case character."),this._addTag(t);else{const n=t.split(" ");for(let a=0,u=n.length;a<u;a++){const f=n[a];X.isUcChar(f.charCodeAt(0))&&this._throwError("Tag may not start with an upper case character."),this._addTag(f)}}}_addTag(t){if(this.__tags||(this.__tags=[]),this.__tags.indexOf(t)===-1){this.__tags.push(t);let n=this.__parent;if(n)do{n.__treeTags||(n.__treeTags=new Map);let a=n.__treeTags.get(t);a||(a=new Set,n.__treeTags.set(t,a)),a.add(this)}while(!n.__tagRoot&&(n=n.__parent))}}removeTag(t){let n=this.__tags.indexOf(t);if(n!==-1){this.__tags.splice(n,1);let a=this.__parent;if(a)do{let u=a.__treeTags.get(t);u&&u.delete(this)}while(!a.__tagRoot&&(a=a.__parent))}}hasTag(t){return this.__tags&&this.__tags.indexOf(t)!==-1}_tag(t){if(t.indexOf(".")!==-1)return this.mtag(t)[0];if(this.__treeTags){let n=this.__treeTags.get(t);if(n){const a=n.values().next();return a?a.value:void 0}}}get tag(){return this._tag}set tag(t){this.tags=t}mtag(t){if(t.indexOf(".")>=0){let a=t.split("."),u=this._getByTag(a[0]),f=1,m=a.length;for(;u.length&&f<m;){let p=[];for(let x=0,T=u.length;x<T;x++)p=p.concat(u[x]._getByTag(a[f]));u=p,f++}return u}else return this._getByTag(t)}stag(t,n){let a=this.mtag(t),u=a.length;for(let f=0;f<u;f++)Ct.patchObject(a[f],n)}get tagRoot(){return this.__tagRoot}set tagRoot(t){this.__tagRoot!==t&&(t?this._unsetTagsParent():this._setTagsParent(),this.__tagRoot=t)}sel(t){const n=this.select(t);if(n.length)return n[0]}select(t){if(t.indexOf(",")!==-1){let n=t.split(","),a=[];for(let u=0;u<n.length;u++)a=a.concat(this._select(n[u]));return a}else return this._select(t)}_select(t){if(t==="")return[this];let n=t.indexOf("."),a=t.indexOf(">");if(n===-1&&a===-1)return this.mtag(t);let u;return a===0?(u=!0,t=t.substr(1)):n===0?(u=!1,t=t.substr(1)):u=!1,this._selectChilds(t,u)}_selectChilds(t,n){const a=t.indexOf("."),u=t.indexOf(">");if(a===-1&&u===-1)if(n){const f=this.getByRef(t);return f?[f]:[]}else return this.mtag(t);if(u===-1||a!==-1&&a<u){let f;const m=t.substr(0,a);if(n){const T=this.getByRef(m);f=T?[T]:[]}else f=this.mtag(m);let p=[];const x=t.substr(a+1);for(let T=0,A=f.length;T<A;T++)p=p.concat(f[T]._selectChilds(x,!1));return p}else{let f;const m=t.substr(0,u);if(n){const T=this.getByRef(m);f=T?[T]:[]}else f=this.mtag(m);let p=[];const x=t.substr(u+1);for(let T=0,A=f.length;T<A;T++)p=p.concat(f[T]._selectChilds(x,!0));return p}}getByRef(t){return this.childList.getByRef(t)}getLocationString(){let t;t=this.__parent?this.__parent._children.getIndex(this):"R";let n=this.getTags(),a=this.__parent?this.__parent.getLocationString():"";return this.ref?a+=":["+t+"]"+this.ref:n.length?a+=":["+t+"]"+n.join(","):a+=":["+t+"]#"+this.id,a}toString(){let t=this.getSettings();return qt.getPrettyString(t,"")}static getPrettyString(t,n){let a=t.children;delete t.children;let u=["color","colorUl","colorUr","colorBl","colorBr"],f=JSON.stringify(t,function(m,p){return u.indexOf(m)!==-1?"COLOR["+p.toString(16)+"]":p});if(f=f.replace(/"COLOR\[([a-f0-9]{1,8})\]"/g,"0x$1"),a){let m="";if(X.isObjectLiteral(a)){let p=Object.keys(a);m="";for(let T=0,A=p.length;T<A;T++)m+=`
${n}  "${p[T]}":`,delete a[p[T]].ref,m+=qt.getPrettyString(a[p[T]],n+"  ")+(T<A-1?",":"");let x=f==="{}";f=f.substr(0,f.length-1)+(x?"":",")+m+`
`+n+"}"}else{let p=a.length;m="[";for(let T=0;T<p;T++)m+=qt.getPrettyString(a[T],n+"  ")+(T<p-1?",":"")+`
`;m+=n+"]}";let x=f==="{}";f=f.substr(0,f.length-1)+(x?"":",")+`"children":
`+n+m+"}"}}return f}getSettings(){let t=this.getNonDefaults(),n=this._children.get();if(n){let a=n.length;if(a){const u=[];let f=!1;for(let m=0;m<a;m++)u.push(n[m].getSettings()),f=f||!n[m].ref;f?t.children=u:(t.children={},u.forEach(m=>{t.children[m.ref]=m}))}}return t.id=this.id,t}getNonDefaults(){let t={};if(this.constructor!==qt&&(t.type=this.constructor.name),this.__ref&&(t.ref=this.__ref),this.__tags&&this.__tags.length&&(t.tags=this.__tags),this.x!==0&&(t.x=this.x),this.y!==0&&(t.y=this.y),this.w!==0&&(t.w=this.w),this.h!==0&&(t.h=this.h),this.scaleX===this.scaleY?this.scaleX!==1&&(t.scale=this.scaleX):(this.scaleX!==1&&(t.scaleX=this.scaleX),this.scaleY!==1&&(t.scaleY=this.scaleY)),this.pivotX===this.pivotY?this.pivotX!==.5&&(t.pivot=this.pivotX):(this.pivotX!==.5&&(t.pivotX=this.pivotX),this.pivotY!==.5&&(t.pivotY=this.pivotY)),this.mountX===this.mountY?this.mountX!==0&&(t.mount=this.mountX):(this.mountX!==0&&(t.mountX=this.mountX),this.mountY!==0&&(t.mountY=this.mountY)),this.alpha!==1&&(t.alpha=this.alpha),this.visible||(t.visible=!1),this.rotation!==0&&(t.rotation=this.rotation),this.colorUl===this.colorUr&&this.colorBl===this.colorBr&&this.colorUl===this.colorBl?this.colorUl!==4294967295&&(t.color=this.colorUl.toString(16)):(this.colorUl!==4294967295&&(t.colorUl=this.colorUl.toString(16)),this.colorUr!==4294967295&&(t.colorUr=this.colorUr.toString(16)),this.colorBl!==4294967295&&(t.colorBl=this.colorBl.toString(16)),this.colorBr!==4294967295&&(t.colorBr=this.colorBr.toString(16))),this.zIndex&&(t.zIndex=this.zIndex),this.forceZIndexContext&&(t.forceZIndexContext=!0),this.clipping&&(t.clipping=this.clipping),this.clipbox||(t.clipbox=this.clipbox),this.__texture){let n=this.__texture.getNonDefaults();Object.keys(n).length&&(t.texture=n)}if(this.shader&&X.isFunction(this.shader.getNonDefaults)){let n=this.shader.getNonDefaults();Object.keys(n).length&&(t.shader=n)}return this._hasTexturizer()&&(this.texturizer.enabled&&(t.renderToTexture=this.texturizer.enabled),this.texturizer.lazy&&(t.renderToTextureLazy=this.texturizer.lazy),this.texturizer.colorize&&(t.colorizeResultTexture=this.texturizer.colorize),this.texturizer.renderOffscreen&&(t.renderOffscreen=this.texturizer.renderOffscreen)),t}static getGetter(t){let n=qt.PROP_GETTERS.get(t);return n||(n=new Function("obj","return obj."+t),qt.PROP_GETTERS.set(t,n)),n}static getSetter(t){let n=qt.PROP_SETTERS.get(t);return n||(n=new Function("obj","v","obj."+t+" = v"),qt.PROP_SETTERS.set(t,n)),n}get withinBoundsMargin(){return this.__core._withinBoundsMargin}_enableWithinBoundsMargin(){this.__enabled&&this._setActiveFlag()}_disableWithinBoundsMargin(){this.__active&&this._unsetActiveFlag()}set boundsMargin(t){if(!Array.isArray(t)&&t!==null)throw new Error("boundsMargin should be an array of left-top-right-bottom values or null (inherit margin)");this.__core.boundsMargin=t}get boundsMargin(){return this.__core.boundsMargin}get x(){return this.__core.offsetX}set x(t){this.__core.offsetX=t}get y(){return this.__core.offsetY}set y(t){this.__core.offsetY=t}get w(){return this._w}set w(t){X.isFunction(t)?(this._w=0,this.__core.funcW=t):(t=Math.max(t,0),this._w!==t&&(this.__core.disableFuncW(),this._w=t,this._updateDimensions()))}get h(){return this._h}set h(t){X.isFunction(t)?(this._h=0,this.__core.funcH=t):(t=Math.max(t,0),this._h!==t&&(this.__core.disableFuncH(),this._h=t,this._updateDimensions()))}get collision(){return this._collision}set collision(t){this._collision=t}_updateCollision(){this.collision&&this.__parent&&this.__parent.collision===void 0&&(this.__parent.collision=2)}get scaleX(){return this.__core.scaleX}set scaleX(t){this.__core.scaleX=t}get scaleY(){return this.__core.scaleY}set scaleY(t){this.__core.scaleY=t}get scale(){return this.__core.scale}set scale(t){this.__core.scale=t}get pivotX(){return this.__core.pivotX}set pivotX(t){this.__core.pivotX=t}get pivotY(){return this.__core.pivotY}set pivotY(t){this.__core.pivotY=t}get pivot(){return this.__core.pivot}set pivot(t){this.__core.pivot=t}get mountX(){return this.__core.mountX}set mountX(t){this.__core.mountX=t}get mountY(){return this.__core.mountY}set mountY(t){this.__core.mountY=t}get mount(){return this.__core.mount}set mount(t){this.__core.mount=t}get rotation(){return this.__core.rotation}set rotation(t){this.__core.rotation=t}get alpha(){return this.__core.alpha}set alpha(t){this.__core.alpha=t}get visible(){return this.__core.visible}set visible(t){this.__core.visible=t}get colorUl(){return this.__core.colorUl}set colorUl(t){this.__core.colorUl=t}get colorUr(){return this.__core.colorUr}set colorUr(t){this.__core.colorUr=t}get colorBl(){return this.__core.colorBl}set colorBl(t){this.__core.colorBl=t}get colorBr(){return this.__core.colorBr}set colorBr(t){this.__core.colorBr=t}get color(){return this.__core.colorUl}set color(t){(this.colorUl!==t||this.colorUr!==t||this.colorBl!==t||this.colorBr!==t)&&(this.colorUl=t,this.colorUr=t,this.colorBl=t,this.colorBr=t)}get colorTop(){return this.colorUl}set colorTop(t){(this.colorUl!==t||this.colorUr!==t)&&(this.colorUl=t,this.colorUr=t)}get colorBottom(){return this.colorBl}set colorBottom(t){(this.colorBl!==t||this.colorBr!==t)&&(this.colorBl=t,this.colorBr=t)}get colorLeft(){return this.colorUl}set colorLeft(t){(this.colorUl!==t||this.colorBl!==t)&&(this.colorUl=t,this.colorBl=t)}get colorRight(){return this.colorUr}set colorRight(t){(this.colorUr!==t||this.colorBr!==t)&&(this.colorUr=t,this.colorBr=t)}get zIndex(){return this.__core.zIndex}set zIndex(t){this.__core.zIndex=t}get forceZIndexContext(){return this.__core.forceZIndexContext}set forceZIndexContext(t){this.__core.forceZIndexContext=t}get clipping(){return this.__core.clipping}set clipping(t){this.__core.clipping=t}get clipbox(){return this.__core.clipbox}set clipbox(t){this.__core.clipbox=t}get tags(){return this.getTags()}set tags(t){Array.isArray(t)||(t=[t]),this.setTags(t)}set t(t){this.tags=t}get _children(){return this.__childList||(this.__childList=new _b(this,!1)),this.__childList}get childList(){return this._allowChildrenAccess()||this._throwError("Direct access to children is not allowed in "+this.getLocationString()),this._children}hasChildren(){return this._allowChildrenAccess()&&this.__childList&&this.__childList.length>0}_allowChildrenAccess(){return!0}get children(){return this.childList.get()}set children(t){this.childList.patch(t)}add(t){return this.childList.a(t)}get p(){return this.__parent}get parent(){return this.__parent}get src(){if(this.texture&&this.texture instanceof Td)return this.texture._src}set src(t){const n=new Td(this.stage);n.src=t,this.texture=n}set mw(t){this.texture?(this.texture.mw=t,this._updateDimensions()):this._throwError("Please set mw after setting a texture.")}set mh(t){this.texture?(this.texture.mh=t,this._updateDimensions()):this._throwError("Please set mh after setting a texture.")}get rect(){return this.texture===this.stage.rectangleTexture}set rect(t){t?this.texture=this.stage.rectangleTexture:this.texture=null}enableTextTexture(){return(!this.texture||!(this.texture instanceof cn))&&(this.texture=new cn(this.stage),!this.texture.w&&!this.texture.h&&(this.texture.w=this.w,this.texture.h=this.h)),this.texture}get text(){return this.texture&&this.texture instanceof cn?this.texture:null}set text(t){(!this.texture||!(this.texture instanceof cn))&&this.enableTextTexture(),X.isString(t)?this.texture.text=t:this.texture.patch(t)}set onUpdate(t){this.__core.onUpdate=t}set onAfterCalcs(t){this.__core.onAfterCalcs=t}set onAfterUpdate(t){this.__core.onAfterUpdate=t}forceUpdate(){this.__core._setHasUpdates()}get shader(){return this.__core.shader}set shader(t){if(X.isObjectLiteral(t)&&!t.type)this.shader&&this.shader.patch(t);else{const n=ko.create(this.stage,t);this.__enabled&&this.__core.shader&&this.__core.shader.removeElement(this.__core),this.__core.shader=n,this.__enabled&&this.__core.shader&&this.__core.shader.addElement(this.__core)}}_hasTexturizer(){return!!this.__core._texturizer}get renderToTexture(){return this.rtt}set renderToTexture(t){this.rtt=t}get rtt(){return this._hasTexturizer()&&this.texturizer.enabled}set rtt(t){this.texturizer.enabled=t}get rttLazy(){return this._hasTexturizer()&&this.texturizer.lazy}set rttLazy(t){this.texturizer.lazy=t}get renderOffscreen(){return this._hasTexturizer()&&this.texturizer.renderOffscreen}set renderOffscreen(t){this.texturizer.renderOffscreen=t}get colorizeResultTexture(){return this._hasTexturizer()&&this.texturizer.colorize}set colorizeResultTexture(t){this.texturizer.colorize=t}getTexture(){return this.texturizer._getTextureSource()}get texturizer(){return this.__core.texturizer}patch(t){let n=Object.keys(t);for(let a=0,u=n.length;a<u;a++){let f=n[a];const m=t[f],p=f.charCodeAt(0);if(X.isUcChar(p)){const x=this.getByRef(f);if(x)m===void 0?x.parent&&x.parent.childList.remove(x):X.isObjectLiteral(m)?x.patch(m):m.isElement?(m.ref=f,this.childList.replace(m,x)):this._throwError("Unexpected value for path: "+f);else if(m!==void 0){let T;X.isObjectLiteral(m)?(T=this.childList.createItem(m),T.patch(m)):X.isObject(m)&&(T=m),T.isElement&&(T.ref=f),this.childList.a(T)}}else Ct.patchObjectProperty(this,f,m)}}_throwError(t){throw new Error(this.constructor.name+" ("+this.getLocationString()+"): "+t)}animation(t){return this.stage.animations.createAnimation(this,t)}transition(t,n=null){return n===null?this._getTransition(t):(this._setTransition(t,n),null)}set transitions(t){Object.keys(t).forEach(a=>{this.transition(a,t[a])})}set smooth(t){Object.keys(t).forEach(a=>{let u=t[a];Array.isArray(u)?this.setSmooth(a,u[0],u[1]):this.setSmooth(a,u)})}fastForward(t){if(this._transitions){let n=this._transitions[t];n&&n.isTransition&&n.finish()}}_getTransition(t){this._transitions||(this._transitions={});let n=this._transitions[t];return n?n.isTransitionSettings&&(n=new Sd(this.stage.transitions,n,this,t)):n=new Sd(this.stage.transitions,this.stage.transitions.defaultTransitionSettings,this,t),this._transitions[t]=n,n}_setTransition(t,n){if(!n)this._removeTransition(t);else{X.isObjectLiteral(n)&&(n=this.stage.transitions.createSettings(n)),this._transitions||(this._transitions={});let a=this._transitions[t];if(a&&a.isTransition)return a.settings=n,a;this._transitions[t]=n}}_removeTransition(t){this._transitions&&delete this._transitions[t]}getSmooth(t,n){let a=this._getTransition(t);return a&&a.isAttached()?a.targetValue:n}setSmooth(t,n,a){a&&this._setTransition(t,a);let u=this._getTransition(t);return u.start(n),u}get flex(){return this.__core.flex}set flex(t){this.__core.flex=t}get flexItem(){return this.__core.flexItem}set flexItem(t){this.__core.flexItem=t}static isColorProperty(t){return t.toLowerCase().indexOf("color")>=0}static getMerger(t){return qt.isColorProperty(t)?ye.mergeColors:ye.mergeNumbers}toJSON(){const t=[`${this.constructor.name}`],n={};return n[t]={},this.hasChildren()?qt.collectChildren(n[t],this.__childList):n[t]={...qt.getProperties(this)},n}static collectChildren(t,n){const a=n;for(let u=0,f=a.length;u<f;u++){const m=a.getAt(u),p=`${m.__ref||`Element-${m.id}`}`,x=this.getProperties(m);t[p]={...x},m.hasChildren()&&(t[p].children={},this.collectChildren(t[p].children,m.__childList))}}static getProperties(t){const n={},a=["alpha","active","attached","boundsMargin","color","clipping","enabled","h","id","isComponent","mount","mountY","mountX","pivot","pivotX","pivotY","ref","renderOfScreen","renderToTexture","scale","scaleX","scaleY","state","tag","visible","w","x","y","zIndex","!!flex","!!flexItem","hasFocus()","hasFinalFocus()"];let u=a.length;for(;u--;){let f=a[u];const m=/^!{2}/,p=/\(\)$/;m.test(f)?(f=f.substring(2,f.length),n[f]=!!t[f]):p.test(f)?(f=f.substring(0,f.length-2),typeof t[f]=="function"&&(n[f]=t[f]())):n[f]=t[f]}return{...n,...t.getNonDefaults()}}};at.addAsMixin(Yt);Yt.prototype.isElement=1;Yt.id=1;Yt.PROP_GETTERS=new Map;Yt.PROP_SETTERS=new Map;class pi{constructor(){pi.setupStateMachine(this)}static setupStateMachine(t){const n=t.constructor,a=pi.create(n);Object.setPrototypeOf(t,a.prototype),t.constructor=n,t._initStateMachine()}static create(t){if(!t.hasOwnProperty("_sm")){const n=new lr(t);t._sm=n}return t._sm.router}fire(t,...n){if(this._hasMethod(t))return this[t](...n)}_getState(){return this._state.__path}_inState(t,n=this._state.__path){const a=this._sm.getStateByPath(t),u=this._sm.getStateByPath(n),f=a.__level;return pi._getStateAtLevel(u,f)===a}_hasMember(t){return!!this.constructor.prototype[t]}_hasMethod(t){const n=this.constructor.prototype[t];return!!n&&typeof n=="function"}_setState(t,n){const a=++this._setStateCounter;if(this._setStateId=a,this._state.__path!==t){let u=this._sm._stateMap[t];u||(u=this._sm.getStateByPath(t));const f=this._state,m=u.prototype.$enter!==this._state.prototype.$enter,p=u.prototype.$exit!==this._state.prototype.$exit;if(m||p){const x=pi._getSharedState(this._state,u),T={newState:u.__path,prevState:f.__path,sharedState:x.__path},A=x.__level;if(p){const b=pi._getStatesUntilLevel(this._state,A);for(let I=0,D=b.length;I<D;I++)if(this.__setState(b[I]),this._callExit(this._state,n,T),this._setStateId!==a)return}if(m){const b=pi._getStatesUntilLevel(u,A).reverse();for(let I=0,D=b.length;I<D;I++)if(this.__setState(b[I]),this._callEnter(this._state,n,T),this._setStateId!==a)return}}if(this.__setState(u),this._changedState){const x={newState:u.__path,prevState:f.__path};n?this._changedState(x,...n):this._changedState(x)}if(this._onStateChange){const x={newState:u.__path,prevState:f.__path};this._onStateChange(x)}}}_callEnter(t,n=[],a){const u=!!t.__parent;t.prototype.$enter&&(!u||t.__parent.prototype.$enter!==t.prototype.$enter)&&t.prototype.$enter.apply(this,[a,...n])}_callExit(t,n=[],a){const u=!!t.__parent;t.prototype.$exit&&(!u||t.__parent.prototype.$exit!==t.prototype.$exit)&&t.prototype.$exit.apply(this,[a,...n])}__setState(t){this._state=t,this._stateIndex=t.__index,this.constructor=t}_initStateMachine(){this._state=null,this._stateIndex=0,this._setStateCounter=0,this._sm=this._routedType._sm,this.__setState(this._sm.getStateByPath(""));const t={newState:"",prevState:void 0,sharedState:void 0};this._callEnter(this._state,[],t),this._onStateChange=void 0}_getMostSpecificHandledMember(t){let n=this._state;do{for(let a=0,u=t.length;a<u;a++){const f=t[a];if(n.__parent){const m=lr.getStateMemberAlias(n.__path,f);if(this[m])return f}else if(n.prototype[f])return f}n=n.__parent}while(n)}static _getStatesUntilLevel(t,n){const a=[];for(;t.__level>n;)a.push(t),t=t.__parent;return a}static _getSharedState(t,n){const a=pi._getAncestorStates(t),u=pi._getAncestorStates(n),f=Math.min(a.length,u.length);for(let m=0;m<f;m++)if(a[m]!==u[m])return a[m-1];return a[f-1]}static _getAncestorStates(t){const n=[];do n.push(t);while(t=t.__parent);return n.reverse()}static _getStateAtLevel(t,n){if(!(n>t.__level)){for(;n<t.__level;)t=t.__parent;return t}}}class lr{constructor(t){this._type=t,this._router=null,this.init()}get router(){return this._router}init(){this._router=this._createRouter(),this._stateMap=this._getStateMap(),this._addStateMemberDelegatorsToRouter()}_createRouter(){const t=this._type,n=class extends t{constructor(){if(super(...arguments),!this.constructor.hasOwnProperty("_isRouter"))throw new Error(`You need to extend ${t.name}.original instead of ${t.name}.`)}};return n._isRouter=!0,n.prototype._routedType=t,n.original=t,this._mixinStateMachineMethods(n),n}_mixinStateMachineMethods(t){const n=Object.getOwnPropertyNames(pi.prototype);for(let a=0,u=n.length;a<u;a++){const f=n[a];if(f!=="constructor"){const m=Object.getOwnPropertyDescriptor(pi.prototype,f);Object.defineProperty(t.prototype,f,m)}}}_addStateMemberDelegatorsToRouter(){this._getAllMemberNames().forEach(n=>{this._addMemberRouter(n)})}_addMemberRouter(t){const n=Object.keys(this._stateMap),a=[],u=[];n.forEach((m,p)=>{const x=this._stateMap[m],T=this._getDescriptor(x,t);if(T){a[p]=T;const A=lr.getStateMemberAlias(T._source.__path,t);u[p]=A,this._router.prototype.hasOwnProperty(A)||Object.defineProperty(this._router.prototype,A,T)}else a[p]=null,u[p]=null});let f;switch(a.forEach(m=>{if(m){const p=this._getDescriptorType(m);if(f&&f!==p){console.warn(`[Lightning] Member ${t} in ${this._type.name} has inconsistent types.`);return}f=p}}),f){case"method":this._addMethodRouter(t,a,u);break;case"getter":this._addGetterSetterRouters(t);break;case"property":console.warn("[Lightning] Fixed properties are not supported; please use a getter instead!");break}}_getDescriptor(t,n,a=()=>!0){let u=t,f=t;do{const m=Object.getOwnPropertyDescriptor(u.prototype,n);if(m&&a(m))return m._source=f,m;u=Object.getPrototypeOf(u),u&&u.hasOwnProperty("__state")&&(f=u)}while(u&&u.prototype)}_getDescriptorType(t){return t.get||t.set?"getter":typeof t.value=="function"?"method":"property"}static _supportsSpread(){if(this.__supportsSpread===void 0){this.__supportsSpread=!1;try{new Function("return [].concat(...arguments);")(),this.__supportsSpread=!0}catch(t){}}return this.__supportsSpread}_addMethodRouter(t,n,a){const u=["//@ sourceURL=StateMachineRouter.js","var i = this._stateIndex;"];let f=a[0];const m=lr._supportsSpread();for(let A=1,b=a.length;A<b;A++){const I=a[A];I!==f&&(f?m?u.push(`if (i < ${A}) return this["${f}"](...arguments); else`):u.push(`if (i < ${A}) return this["${f}"].apply(this, arguments); else`):u.push(`if (i < ${A}) return ; else`)),f=I}f?m?u.push(`return this["${f}"](...arguments);`):u.push(`return this["${f}"].apply(this, arguments);`):u.push(";");const p=u.join(`
`),T={value:new Function([],p)};Object.defineProperty(this._router.prototype,t,T)}_addGetterSetterRouters(t){const n=this._getGetterRouter(t),a=this._getSetterRouter(t),u={get:n,set:a};Object.defineProperty(this._router.prototype,t,u)}_getGetterRouter(t){const n=Object.keys(this._stateMap),a=[];n.forEach((x,T)=>{const A=this._stateMap[x],b=this._getDescriptor(A,t,I=>I.get);if(b){const I=lr.getStateMemberAlias(b._source.__path,t);a[T]=I,this._router.prototype.hasOwnProperty(I)||Object.defineProperty(this._router.prototype,I,b)}else a[T]=null});const u=["//@ sourceURL=StateMachineRouter.js","var i = this._stateIndex;"];let f=a[0];for(let x=1,T=a.length;x<T;x++){const A=a[x];A!==f&&(f?u.push(`if (i < ${x}) return this["${f}"]; else`):u.push(`if (i < ${x}) return ; else`)),f=A}f?u.push(`return this["${f}"];`):u.push(";");const m=u.join(`
`);return new Function([],m)}_getSetterRouter(t){const n=Object.keys(this._stateMap),a=[];n.forEach((x,T)=>{const A=this._stateMap[x],b=this._getDescriptor(A,t,I=>I.set);if(b){const I=lr.getStateMemberAlias(b._source.__path,t);a[T]=I,this._router.prototype.hasOwnProperty(I)||Object.defineProperty(this._router.prototype,I,b)}else a[T]=null});const u=["//@ sourceURL=StateMachineRouter.js","var i = this._stateIndex;"];let f=a[0];for(let x=1,T=a.length;x<T;x++){const A=a[x];A!==f&&(f?u.push(`if (i < ${x}) this["${f}"] = arg; else`):u.push(`if (i < ${x}) ; else`)),f=A}f?u.push(`this["${f}"] = arg;`):u.push(";");const m=u.join(`
`);return new Function(["arg"],m)}static getStateMemberAlias(t,n){return"$"+(t?t+".":"")+n}_getAllMemberNames(){const t=this._stateMap,n=Object.keys(t);let a=new Set;return n.forEach(u=>{if(u==="")return;const f=t[u];this._getStateMemberNames(f).forEach(p=>{a.add(p)})}),[...a]}_getStateMemberNames(t){let n=t,a=new Set;const u=this._type===t;do this._getStateMemberNamesForType(n).forEach(m=>{a.add(m)}),n=Object.getPrototypeOf(n);while(n&&n.prototype&&(!n.hasOwnProperty("__state")||u));return a}_getStateMemberNamesForType(t){return Object.getOwnPropertyNames(t.prototype).filter(a=>a!=="constructor"&&!lr._isStateLocalMember(a))}static _isStateLocalMember(t){return t==="$enter"||t==="$exit"}getStateByPath(t){if(this._stateMap[t])return this._stateMap[t];const n=t.split(".");for(;n.pop();){const a=n.join(".");if(this._stateMap[a])return this._stateMap[a]}}_getStateMap(){return this._stateMap||(this._stateMap=this._createStateMap()),this._stateMap}_createStateMap(){const t={};return this._addState(this._type,null,"",t),t}_addState(t,n,a,u){t.__state=!0,t.__name=a,this._addStaticStateProperty(t,n);const f=n?n.__path:"";let m=(f?f+".":"")+a;t.__path=m,t.__level=n?n.__level+1:0,t.__parent=n,t.__index=Object.keys(u).length,u[m]=t;const p=t._states;p&&(n&&n._states===p||t._states().forEach(A=>{const b=lr._getStateName(A);this._addState(A,t,b,u)}))}static _getStateName(t){const n=t.name,a=n.indexOf("$");return a>0?n.substr(0,a):n}_addStaticStateProperty(t,n){n&&(n&&!n.__parent?this._router[t.__name]=t:n[t.__name]=t)}}class mt extends Yt{constructor(t,n){super(t),this.tagRoot=!0,X.isObjectLiteral(n)&&Object.assign(this,n),this.__initialized=!1,this.__firstActive=!1,this.__firstEnable=!1,this.__signals=void 0,this.__passSignals=void 0,this.__construct();const a=this.constructor.getTemplateFunc(this);a.f(this,a.a),this._build()}__start(){pi.setupStateMachine(this),this._onStateChange=mt.prototype.__onStateChange}get state(){return this._getState()}__onStateChange(){this.application&&this.application.updateFocusPath()}_refocus(){this.application&&this.application.updateFocusPath()}static bindProp(t,n=null){return{__propertyBinding:!0,__name:t,__func:n}}__bindProperty(t,n,a){const u=n,f=a,m=Array.isArray(t.__name)?t.__name:[t.__name];for(let p=0;p<m.length;p++){const x=m[p],T=t.__func?t.__func:A=>A[x];this.hasOwnProperty(x)?this[`__prop_bindings_${x}`].push({__obj:u,__prop:f,__func:T}):(this[`__prop_bindings_${x}`]=[{__obj:u,__prop:f,__func:T}],Object.defineProperty(this,x,{set:A=>{this[`__prop_${x}`]=A;for(const{__obj:b,__prop:I,__func:D}of this[`__prop_bindings_${x}`])b[I]=D(this)},get:()=>this[`__prop_${x}`]}))}}static getTemplateFunc(t){const n="_templateFunc",a="__has"+n;return this[a]!==this&&(this[a]=this,this[n]=this.parseTemplate(this._template(t))),this[n]}static parseTemplate(t){const n={loc:[],store:[],rid:0};this.parseTemplateRec(t,n,"element");const a=n.loc.join(`;
`);return{f:new Function("element","store",a),a:n.store}}static parseTemplateRec(t,n,a){const u=n.store,f=n.loc;Object.keys(t).forEach(p=>{let x=t[p];if(X.isUcChar(p.charCodeAt(0)))if(X.isObjectLiteral(x)){const T=`r${p.replace(/[^a-z0-9]/gi,"")+n.rid}`;let A=x.type?x.type:Yt;A===Yt?f.push(`var ${T} = element.stage.createElement()`):(u.push(A),f.push(`var ${T} = new store[${u.length-1}](${a}.stage)`)),f.push(`${T}.ref = "${p}"`),n.rid++,this.parseTemplateRec(x,n,T),f.push(`${a}.childList.add(${T})`)}else X.isObject(x)&&(u.push(x),f.push(`${a}.childList.add(store[${u.length-1}])`));else if(p==="text"){const T=a+"__text";f.push(`var ${T} = ${a}.enableTextTexture()`),x.__propertyBinding===!0?(u.push(x),f.push(`element.__bindProperty(store[${u.length-1}], ${a}, "${p}")`)):this.parseTemplatePropRec(x,n,T)}else if(p==="shader"&&X.isObjectLiteral(x)){const T=`${a}["shader"]`;u.push(x),f.push(`${a}["${p}"] = store[${u.length-1}]`),this.parsePropertyBindings(x,n,T)}else if(p==="texture"&&X.isObjectLiteral(x)){const T=a+"__texture",A=x.type;A?(u.push(A),f.push(`var ${T} = new store[${u.length-1}](${a}.stage)`),this.parseTemplatePropRec(x,n,T),f.push(`${a}["${p}"] = ${T}`)):(f.push(`${T} = ${a}.texture`),this.parseTemplatePropRec(x,n,T))}else X.isObjectLiteral(x)&&x.__propertyBinding===!0?(u.push(x),f.push(`element.__bindProperty(store[${u.length-1}], ${a}, "${p}")`)):X.isNumber(x)?f.push(`${a}["${p}"] = ${x}`):X.isBoolean(x)?f.push(`${a}["${p}"] = ${x?"true":"false"}`):X.isObject(x)||Array.isArray(x)?(u.push(x),f.push(`${a}["${p}"] = store[${u.length-1}]`)):f.push(`${a}["${p}"] = ${JSON.stringify(x)}`)})}static parseTemplatePropRec(t,n,a){const u=n.store,f=n.loc;Object.keys(t).forEach(p=>{if(p!=="type"){const x=t[p];X.isNumber(x)?f.push(`${a}["${p}"] = ${x}`):X.isBoolean(x)?f.push(`${a}["${p}"] = ${x?"true":"false"}`):X.isObject(x)&&x.__propertyBinding===!0?(u.push(x),f.push(`element.__bindProperty(store[${u.length-1}], ${a}, "${p}")`)):X.isObject(x)||Array.isArray(x)?(u.push(x),f.push(`${a}["${p}"] = store[${u.length-1}]`)):f.push(`${a}["${p}"] = ${JSON.stringify(x)}`)}})}static parsePropertyBindings(t,n,a){const u=n.store,f=n.loc;Object.keys(t).forEach(p=>{if(p!=="type"){const x=t[p];X.isObjectLiteral(x)&&x.__propertyBinding===!0&&(u.push(x),f.push(`element.__bindProperty(store[${u.length-1}], ${a}, "${p}")`))}})}_onSetup(){this.__initialized||this._setup()}_setup(){}_onAttach(){this.__initialized||(this.__init(),this.__initialized=!0),this._attach()}_attach(){}_onDetach(){this._detach()}_detach(){}_onEnabled(){this.__firstEnable||(this._firstEnable(),this.__firstEnable=!0),this._enable()}_firstEnable(){}_enable(){}_onDisabled(){this._disable()}_disable(){}_onActive(){this.__firstActive||(this._firstActive(),this.__firstActive=!0),this._active()}_firstActive(){}_active(){}_onInactive(){this._inactive()}_inactive(){}get application(){return this.stage.application}__construct(){this._construct()}_construct(){}_build(){}__init(){this._init()}_init(){}_focus(t,n){}_unfocus(t){}_focusChange(t,n){}_getFocused(){return this}_setFocusSettings(t){}_handleFocusSettings(t){}static _template(){return{}}hasFinalFocus(){let t=this.application._focusPath;return t&&t.length&&t[t.length-1]===this}hasFocus(){let t=this.application._focusPath;return t&&t.indexOf(this)>=0}get cparent(){return mt.getParent(this)}seekAncestorByType(t){let n=this.cparent;for(;n;){if(n.constructor===t)return n;n=n.cparent}}getSharedAncestorComponent(t){let n=this.getSharedAncestor(t);for(;n&&!n.isComponent;)n=n.parent;return n}get signals(){return this.__signals}set signals(t){X.isObjectLiteral(t)||this._throwError("Signals: specify an object with signal-to-fire mappings"),this.__signals=t}set alterSignals(t){X.isObjectLiteral(t)||this._throwError("Signals: specify an object with signal-to-fire mappings"),this.__signals||(this.__signals={});for(let n in t)t[n]===void 0?delete this.__signals[n]:this.__signals[n]=t}get passSignals(){return this.__passSignals||{}}set passSignals(t){this.__passSignals=Object.assign(this.__passSignals||{},t)}set alterPassSignals(t){X.isObjectLiteral(t)||this._throwError("Signals: specify an object with signal-to-fire mappings"),this.__passSignals||(this.__passSignals={});for(let n in t)t[n]===void 0?delete this.__passSignals[n]:this.__passSignals[n]=t}signal(t,...n){return this._signal(t,n)}_signal(t,n){const a=this._getParentSignalHandler();if(a){if(this.__signals){let f=this.__signals[t];if(f===!1)return;if(f){if(f===!0&&(f=t),X.isFunction(f))return f(...n);if(a._hasMethod(f))return a[f](...n)}}let u=this.__passSignals&&this.__passSignals[t];if(u)return u&&u!==!0&&(t=u),a._signal(t,n)}}_getParentSignalHandler(){return this.cparent?this.cparent._getSignalHandler():null}_getSignalHandler(){return this._signalProxy?this.cparent?this.cparent._getSignalHandler():null:this}get _signalProxy(){return!1}fireAncestors(t,...n){if(!t.startsWith("$"))throw new Error("Ancestor event name must be prefixed by dollar sign.");const a=this._getParentSignalHandler();if(a)return a._doFireAncestors(t,n)}_doFireAncestors(t,n){if(this._hasMethod(t))return this.fire(t,...n);{const a=this._getParentSignalHandler();if(a)return a._doFireAncestors(t,n)}}static collectSubComponents(t,n){if(n.hasChildren()){const a=n.__childList;for(let u=0,f=a.length;u<f;u++){const m=a.getAt(u);m.isComponent?t.push(m):mt.collectSubComponents(t,m)}}}static getComponent(t){let n=t;for(;n&&!n.isComponent;)n=n.parent;return n}static getParent(t){return mt.getComponent(t.parent)}}mt.prototype.isComponent=!0;class zv{constructor(t){this.ctx=t,this.quadTextures=[],this.quadElements=[]}get length(){return this.quadTextures.length}reset(){this.quadTextures=[],this.quadElements=[],this.dataLength=0}getElement(t){return this.quadElements[t]._element}getElementCore(t){return this.quadElements[t]}getTexture(t){return this.quadTextures[t]}getTextureWidth(t){let n=this.quadTextures[t];return n.w?n.w:this.quadElements[t]._displayedTextureSource.w}getTextureHeight(t){let n=this.quadTextures[t];return n.h?n.h:this.quadElements[t]._displayedTextureSource.h}}class yb extends zv{constructor(t){super(t);const n=t.stage.getOption("bufferMemory");this.dataLength=0,this.data=new ArrayBuffer(n),this.floats=new Float32Array(this.data),this.uints=new Uint32Array(this.data)}getAttribsDataByteOffset(t){return t*80}getQuadContents(){let t=this.floats,n=this.uints,a=[];for(let u=1;u<=this.length;u++){let f="entry "+u+": ";for(let m=0;m<4;m++){let p=u*20+m*4;f+=t[p]+","+t[p+1]+":"+t[p+2]+","+t[p+3]+"["+n[p+4].toString(16)+"] "}a.push(f)}return a}}class Bv{constructor(t,n,a,u,f,m){this.ctx=t,this.shader=n,this.shaderOwner=a,this.renderTextureInfo=u,this.scissor=f,this.index=m,this.length=0}get quads(){return this.ctx.renderState.quads}getTexture(t){return this.quads.getTexture(this.index+t)}getElementCore(t){return this.quads.getElementCore(this.index+t)}getElement(t){return this.quads.getElement(this.index+t)}getElementWidth(t){return this.getElement(t).renderWidth}getElementHeight(t){return this.getElement(t).renderHeight}getTextureWidth(t){return this.quads.getTextureWidth(this.index+t)}getTextureHeight(t){return this.quads.getTextureHeight(this.index+t)}getRenderWidth(){return this.renderTextureInfo?this.renderTextureInfo.w:this.ctx.stage.w}getRenderHeight(){return this.renderTextureInfo?this.renderTextureInfo.h:this.ctx.stage.h}}class xb extends Bv{constructor(t,n,a,u,f,m){super(t,n,a,u,f,m),this.extraAttribsDataByteOffset=0}getAttribsDataByteOffset(t){return this.quads.getAttribsDataByteOffset(this.index+t)}getNormalRenderTextureCoords(t,n){let a=this.shaderOwner.getRenderTextureCoords(t,n);return a[0]/=this.getRenderWidth(),a[1]/=this.getRenderHeight(),a[0]=a[0]*2-1,a[1]=1-a[1]*2,a}getProjection(){return this.renderTextureInfo===null?this.ctx.renderExec._projection:this.renderTextureInfo.nativeTexture.projection}}class jv{constructor(t){this.ctx=t,this.renderState=t.renderState,this.gl=this.ctx.stage.gl}destroy(){}_reset(){this._bindRenderTexture(null),this._setScissor(null),this._clearRenderTexture()}execute(){this._reset();let t=this.renderState.quadOperations,n=0,a=t.length;for(;n<a;)this._processQuadOperation(t[n]),n++}_processQuadOperation(t){t.renderTextureInfo&&t.renderTextureInfo.ignore||(this._setupQuadOperation(t),this._execQuadOperation(t))}_setupQuadOperation(t){}_execQuadOperation(t){let n=t.renderTextureInfo?t.renderTextureInfo.nativeTexture:null;this._renderTexture!==n&&this._bindRenderTexture(n),t.renderTextureInfo&&!t.renderTextureInfo.cleared?(this._setScissor(null),this._clearRenderTexture(),t.renderTextureInfo.cleared=!0,this._setScissor(t.scissor)):this._setScissor(t.scissor),this._renderQuadOperation(t)}_renderQuadOperation(t){}_bindRenderTexture(t){this._renderTexture=t}_clearRenderTexture(t){}_setScissor(t){}}class vb extends jv{constructor(t){super(t),this.gl=this.ctx.stage.gl,this.init()}init(){let t=this.gl;this._attribsBuffer=t.createBuffer();let n=Math.floor(this.renderState.quads.data.byteLength/80),a=new Uint16Array(n*6);for(let u=0,f=0;u<n;u+=6,f+=4)a[u]=f,a[u+1]=f+1,a[u+2]=f+2,a[u+3]=f,a[u+4]=f+2,a[u+5]=f+3;this._quadsBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._quadsBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,a,t.STATIC_DRAW),this._projection=new Float32Array([2/this.ctx.stage.coordsWidth,-2/this.ctx.stage.coordsHeight])}destroy(){super.destroy(),this.gl.deleteBuffer(this._attribsBuffer),this.gl.deleteBuffer(this._quadsBuffer)}_reset(){super._reset();let t=this.gl;t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),t.enable(t.BLEND),t.disable(t.DEPTH_TEST),this._stopShaderProgram(),this._setupBuffers()}_setupBuffers(){let t=this.gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._quadsBuffer);let n=new Float32Array(this.renderState.quads.data,0,this.renderState.quads.dataLength);t.bindBuffer(t.ARRAY_BUFFER,this._attribsBuffer),t.bufferData(t.ARRAY_BUFFER,n,t.DYNAMIC_DRAW)}_setupQuadOperation(t){super._setupQuadOperation(t),this._useShaderProgram(t.shader,t)}_renderQuadOperation(t){let n=t.shader;(t.length||t.shader.addEmpty())&&(n.beforeDraw(t),n.draw(t),n.afterDraw(t))}_useShaderProgram(t,n){t.hasSameProgram(this._currentShaderProgram)||(this._currentShaderProgram&&this._currentShaderProgram.stopProgram(),t.useProgram(),this._currentShaderProgram=t),t.setupUniforms(n)}_stopShaderProgram(){this._currentShaderProgram&&(this._currentShaderProgram.stopProgram(),this._currentShaderProgram=null)}_bindRenderTexture(t){super._bindRenderTexture(t);let n=this.gl;this._renderTexture?(n.bindFramebuffer(n.FRAMEBUFFER,this._renderTexture.framebuffer),n.viewport(0,0,this._renderTexture.w,this._renderTexture.h)):(n.bindFramebuffer(n.FRAMEBUFFER,null),n.viewport(0,0,this.ctx.stage.w,this.ctx.stage.h))}_clearRenderTexture(){super._clearRenderTexture();let t=this.gl;if(this._renderTexture)t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT);else{let n=this.ctx.stage.getClearColor();n&&(t.clearColor(n[0]*n[3],n[1]*n[3],n[2]*n[3],n[3]),t.clear(t.COLOR_BUFFER_BIT))}}_setScissor(t){if(super._setScissor(t),this._scissor===t)return;this._scissor=t;let n=this.gl;if(!t)n.disable(n.SCISSOR_TEST);else{n.enable(n.SCISSOR_TEST);let a=this.ctx.stage.getRenderPrecision(),u=t[1];this._renderTexture===null&&(u=this.ctx.stage.h/a-(t[1]+t[3])),n.scissor(Math.round(t[0]*a),Math.round(u*a),Math.round(t[2]*a),Math.round(t[3]*a))}}}class Hv{constructor(t){this.ctx=t,this.stage=t.stage,this.defaultShader=this.stage.renderer.getDefaultShader(t),this.renderer=t.stage.renderer,this.quads=this.renderer.createCoreQuadList(t)}reset(){this._renderTextureInfo=null,this._scissor=null,this._shader=null,this._shaderOwner=null,this._realShader=null,this._check=!1,this.quadOperations=[],this._texturizer=null,this._texturizerTemporary=!1,this._quadOperation=null,this.quads.reset(),this._temporaryTexturizers=[],this._isCachingTexturizer=!1}get length(){return this.quads.quadTextures.length}setShader(t,n){(this._shaderOwner!==n||this._realShader!==t)&&(this._realShader=t,t.useDefault()&&(t=this.defaultShader),(this._shader!==t||this._shaderOwner!==n)&&(this._shader=t,this._shaderOwner=n,this._check=!0))}get renderTextureInfo(){return this._renderTextureInfo}setScissor(t){this._scissor!==t&&(t?this._scissor=t:this._scissor=null,this._check=!0)}getScissor(){return this._scissor}setRenderTextureInfo(t){this._renderTextureInfo!==t&&(this._renderTextureInfo=t,this._scissor=null,this._check=!0)}setTexturizer(t,n=!1){this._texturizer=t,this._cacheTexturizer=n}set isCachingTexturizer(t){this._isCachingTexturizer=t}get isCachingTexturizer(){return this._isCachingTexturizer}addQuad(t){this._quadOperation?this._check&&this._hasChanges()&&(this._finishQuadOperation(),this._check=!1):this._createQuadOperation();let n=null;this._texturizer&&(n=this._texturizer.getResultTexture(),this._cacheTexturizer||this._temporaryTexturizers.push(this._texturizer)),n||(n=t._displayedTextureSource.nativeTexture),this._renderTextureInfo&&(this._shader===this.defaultShader&&this._renderTextureInfo.empty?(this._renderTextureInfo.nativeTexture=n,this._renderTextureInfo.offset=this.length):this._renderTextureInfo.nativeTexture=null,this._renderTextureInfo.empty=!1),this.quads.quadTextures.push(n),this.quads.quadElements.push(t),this._quadOperation.length++,this.renderer.addQuad(this,this.quads,this.length-1)}finishedRenderTexture(){this._renderTextureInfo.nativeTexture&&(this._isRenderTextureReusable()||(this._renderTextureInfo.nativeTexture=null))}_isRenderTextureReusable(){const t=this._renderTextureInfo.offset;return this.quads.quadTextures[t].w===this._renderTextureInfo.w&&this.quads.quadTextures[t].h===this._renderTextureInfo.h&&this.renderer.isRenderTextureReusable(this,this._renderTextureInfo)}_hasChanges(){let t=this._quadOperation;return this._shader!==t.shader||this._shaderOwner!==t.shaderOwner||this._renderTextureInfo!==t.renderTextureInfo||this._scissor!==t.scissor&&(this._scissor[0]!==t.scissor[0]||this._scissor[1]!==t.scissor[1]||this._scissor[2]!==t.scissor[2]||this._scissor[3]!==t.scissor[3])}_finishQuadOperation(t=!0){if(this._quadOperation){if((this._quadOperation.length||this._shader.addEmpty())&&(!this._quadOperation.scissor||this._quadOperation.scissor[2]>0&&this._quadOperation.scissor[3]>0)&&this.quadOperations.push(this._quadOperation),this._temporaryTexturizers.length){for(let n=0,a=this._temporaryTexturizers.length;n<a;n++)this._temporaryTexturizers[n].releaseRenderTexture();this._temporaryTexturizers=[]}this._quadOperation=null}t&&this._createQuadOperation()}_createQuadOperation(){this._quadOperation=this.renderer.createCoreQuadOperation(this.ctx,this._shader,this._shaderOwner,this._renderTextureInfo,this._scissor,this.length),this._check=!1}finish(){this._quadOperation&&this._finishQuadOperation(!1),this.renderer.finishRenderState(this)}}class Tb{constructor(t,n){this.vertexShaderSource=t,this.fragmentShaderSource=n,this._program=null,this._uniformLocations=new Map,this._attributeLocations=new Map,this._currentUniformValues={}}compile(t){if(this._program)return;this.gl=t,this._program=t.createProgram();let n=this._glCompile(t.VERTEX_SHADER,this.vertexShaderSource),a=this._glCompile(t.FRAGMENT_SHADER,this.fragmentShaderSource);t.attachShader(this._program,n),t.attachShader(this._program,a),t.linkProgram(this._program),t.getProgramParameter(this._program,t.LINK_STATUS)||(console.error("[Lightning] Error: Could not initialize shader."),console.error("[Lightning] gl.VALIDATE_STATUS",t.getProgramParameter(this._program,t.VALIDATE_STATUS)),console.error("[Lightning] gl.getError()",t.getError()),t.getProgramInfoLog(this._program)!==""&&console.warn("[Lightning] Warning: gl.getProgramInfoLog()",t.getProgramInfoLog(this._program)),t.deleteProgram(this._program),this._program=null),t.deleteShader(n),t.deleteShader(a)}_glCompile(t,n){let a=this.gl.createShader(t);if(this.gl.shaderSource(a,n),this.gl.compileShader(a),!this.gl.getShaderParameter(a,this.gl.COMPILE_STATUS)){console.error("[Lightning]",this.constructor.name,"Type: "+(t===this.gl.VERTEX_SHADER?"vertex shader":"fragment shader")),console.error("[Lightning]",this.gl.getShaderInfoLog(a));let u=0;return console.error("[Lightning]",`========== source ==========
`+n.split(`
`).map(f=>""+ ++u+": "+f).join(`
`)),null}return a}getUniformLocation(t){let n=this._uniformLocations.get(t);return n===void 0&&(n=this.gl.getUniformLocation(this._program,t),this._uniformLocations.set(t,n)),n}getAttribLocation(t){let n=this._attributeLocations.get(t);return n===void 0&&(n=this.gl.getAttribLocation(this._program,t),this._attributeLocations.set(t,n)),n}destroy(){this._program&&(this.gl.deleteProgram(this._program),this._program=null)}get glProgram(){return this._program}get compiled(){return!!this._program}_valueEquals(t,n){if(t.length&&n.length){for(let a=0,u=t.length;a<u;a++)if(t[a]!==n[a])return!1;return!0}else return t===n}_valueClone(t){return t.length?t.slice(0):t}setUniformValue(t,n,a){let u=this._currentUniformValues[t];if(u===void 0||!this._valueEquals(u,n)){let f=this._valueClone(n);this._currentUniformValues[t]=f;let m=this.getUniformLocation(t);m&&(a===this.gl.uniformMatrix2fv||a===this.gl.uniformMatrix3fv||a===this.gl.uniformMatrix4fv?a.call(this.gl,m,!1,f):a.call(this.gl,m,f))}}}class eu extends ko{constructor(t){super(t);const n=t.stage;this._program=n.renderer.shaderPrograms.get(this.constructor),this._program||(this._program=new Tb(this.constructor.vertexShaderSource,this.constructor.fragmentShaderSource),n.renderer.shaderPrograms.set(this.constructor,this._program)),this.gl=n.gl}get glProgram(){return this._program.glProgram}_init(){this._initialized||(this.initialize(),this._initialized=!0)}initialize(){this._program.compile(this.gl)}get initialized(){return this._initialized}_uniform(t){return this._program.getUniformLocation(t)}_attrib(t){return this._program.getAttribLocation(t)}_setUniform(t,n,a){this._program.setUniformValue(t,n,a)}useProgram(){this._init(),this.gl.useProgram(this.glProgram),this.beforeUsage(),this.enableAttribs()}stopProgram(){this.afterUsage(),this.disableAttribs()}hasSameProgram(t){return t&&(t===this||t._program===this._program)}beforeUsage(){}afterUsage(){}enableAttribs(){}disableAttribs(){}getExtraAttribBytesPerVertex(){return 0}getVertexAttribPointerOffset(t){return t.extraAttribsDataByteOffset-t.index*4*this.getExtraAttribBytesPerVertex()}setExtraAttribsInBuffer(t){}setupUniforms(t){}_getProjection(t){return t.getProjection()}getFlipY(t){return this._getProjection(t)[1]<0}beforeDraw(t){}draw(t){}afterDraw(t){}cleanup(){this._initialized=!1}}let Xe=class extends eu{enableAttribs(){let t=this.gl;t.vertexAttribPointer(this._attrib("aVertexPosition"),2,t.FLOAT,!1,20,0),t.enableVertexAttribArray(this._attrib("aVertexPosition")),this._attrib("aTextureCoord")!==-1&&(t.vertexAttribPointer(this._attrib("aTextureCoord"),2,t.FLOAT,!1,20,2*4),t.enableVertexAttribArray(this._attrib("aTextureCoord"))),this._attrib("aColor")!==-1&&(t.vertexAttribPointer(this._attrib("aColor"),4,t.UNSIGNED_BYTE,!0,20,4*4),t.enableVertexAttribArray(this._attrib("aColor")))}disableAttribs(){let t=this.gl;t.disableVertexAttribArray(this._attrib("aVertexPosition")),this._attrib("aTextureCoord")!==-1&&t.disableVertexAttribArray(this._attrib("aTextureCoord")),this._attrib("aColor")!==-1&&t.disableVertexAttribArray(this._attrib("aColor"))}setupUniforms(t){this._setUniform("projection",this._getProjection(t),this.gl.uniform2fv,!1)}draw(t){let n=this.gl,a=t.length;if(a){let u=t.getTexture(0),f=0;for(let m=0;m<a;m++){let p=t.getTexture(m);u!==p&&(n.bindTexture(n.TEXTURE_2D,u),n.drawElements(n.TRIANGLES,6*(m-f),n.UNSIGNED_SHORT,(f+t.index)*6*2),u=p,f=m)}f<a&&(n.bindTexture(n.TEXTURE_2D,u),n.drawElements(n.TRIANGLES,6*(a-f),n.UNSIGNED_SHORT,(f+t.index)*6*2))}}};Xe.vertexShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    attribute vec2 aVertexPosition;
    attribute vec2 aTextureCoord;
    attribute vec4 aColor;
    uniform vec2 projection;
    varying vec2 vTextureCoord;
    varying vec4 vColor;
    void main(void){
        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);
        vTextureCoord = aTextureCoord;
        vColor = aColor;
        gl_Position.y = -sign(projection.y) * gl_Position.y;
    }
`;Xe.fragmentShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    varying vec2 vTextureCoord;
    varying vec4 vColor;
    uniform sampler2D uSampler;
    void main(void){
        gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor;
    }
`;class Vv{constructor(t){this.stage=t,this._defaultShader=void 0}gc(t){}destroy(){}getDefaultShader(t=this.stage.ctx){return this._defaultShader||(this._defaultShader=this._createDefaultShader(t)),this._defaultShader}_createDefaultShader(t){}isValidShaderType(t){return t.prototype instanceof this._getShaderBaseType()}createShader(t,n){const a=n.type;if(this.isValidShaderType(a)){const u=new a(t);return Ct.patchObject(this,n),u}else{const u=this._getShaderAlternative(a);return u?new u(t):(console.warn("[Lightning] Shader has no implementation for render target: "+a.name),this._createDefaultShader(t))}}_getShaderBaseType(){}_getShaderAlternative(t){return this.getDefaultShader()}copyRenderTexture(t,n,a){console.warn("[Lightning] copyRenderTexture not supported by renderer")}}class Wv extends Vv{constructor(t){super(t),this.shaderPrograms=new Map,this._compressedTextureExtensions={astc:t.gl.getExtension("WEBGL_compressed_texture_astc"),etc1:t.gl.getExtension("WEBGL_compressed_texture_etc1"),s3tc:t.gl.getExtension("WEBGL_compressed_texture_s3tc"),pvrtc:t.gl.getExtension("WEBGL_compressed_texture_pvrtc")}}getCompressedTextureExtensions(){return this._compressedTextureExtensions}destroy(){this.shaderPrograms.forEach(t=>t.destroy())}_createDefaultShader(t){return new Xe(t)}_getShaderBaseType(){return eu}_getShaderAlternative(t){return t.getWebGL&&t.getWebGL()}createCoreQuadList(t){return new yb(t)}createCoreQuadOperation(t,n,a,u,f,m){return new xb(t,n,a,u,f,m)}createCoreRenderExecutor(t){return new vb(t)}createCoreRenderState(t){return new Hv(t)}createRenderTexture(t,n,a,u){const f=this.stage.gl,m=f.createTexture();return f.bindTexture(f.TEXTURE_2D,m),f.texImage2D(f.TEXTURE_2D,0,f.RGBA,a,u,0,f.RGBA,f.UNSIGNED_BYTE,null),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE),m.params={},m.params[f.TEXTURE_MAG_FILTER]=f.LINEAR,m.params[f.TEXTURE_MIN_FILTER]=f.LINEAR,m.params[f.TEXTURE_WRAP_S]=f.CLAMP_TO_EDGE,m.params[f.TEXTURE_WRAP_T]=f.CLAMP_TO_EDGE,m.options={format:f.RGBA,internalFormat:f.RGBA,type:f.UNSIGNED_BYTE},m.framebuffer=f.createFramebuffer(),m.projection=new Float32Array([2/t,2/n]),f.bindFramebuffer(f.FRAMEBUFFER,m.framebuffer),f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,m,0),m}freeRenderTexture(t){let n=this.stage.gl;n.deleteFramebuffer(t.framebuffer),n.deleteTexture(t)}_getBytesPerPixel(t,n){const a=this.stage.gl;if(t===a.RGBA)switch(n){case a.UNSIGNED_BYTE:return 4;case a.UNSIGNED_SHORT_4_4_4_4:return 2;case a.UNSIGNED_SHORT_5_5_5_1:return 2;default:throw new Error("Invalid type specified for GL_RGBA format")}else if(t===a.RGB)switch(n){case a.UNSIGNED_BYTE:return 3;case a.UNSIGNED_BYTE_5_6_5:return 2;default:throw new Error("Invalid type specified for GL_RGB format")}else throw new Error("Invalid format specified in call to _getBytesPerPixel()")}uploadTextureSource(t,n){const a=this.stage.gl,u=n.source;let f=!1;n.renderInfo&&(f=n.renderInfo.compressed||!1);const m={premultiplyAlpha:!0,hasAlpha:!0};n&&n.hasOwnProperty("premultiplyAlpha")&&(m.premultiplyAlpha=n.premultiplyAlpha),n&&n.hasOwnProperty("flipBlueRed")&&(m.flipBlueRed=n.flipBlueRed),n&&n.hasOwnProperty("hasAlpha")&&(m.hasAlpha=n.hasAlpha),m.hasAlpha||(m.premultiplyAlpha=!1),m.texParams=n.texParams||{},m.texOptions=n.texOptions||{};let p=a.createTexture();a.bindTexture(a.TEXTURE_2D,p),a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,m.premultiplyAlpha),X.isNode&&a.pixelStorei(a.UNPACK_FLIP_BLUE_RED,!!m.flipBlueRed);const x=m.texParams;if(x[a.TEXTURE_MAG_FILTER]||(x[a.TEXTURE_MAG_FILTER]=a.LINEAR),x[a.TEXTURE_MIN_FILTER]||(x[a.TEXTURE_MIN_FILTER]=a.LINEAR),x[a.TEXTURE_WRAP_S]||(x[a.TEXTURE_WRAP_S]=a.CLAMP_TO_EDGE),x[a.TEXTURE_WRAP_T]||(x[a.TEXTURE_WRAP_T]=a.CLAMP_TO_EDGE),Object.keys(x).forEach(A=>{const b=x[A];a.texParameteri(a.TEXTURE_2D,parseInt(A),b)}),f)return this.stage.platform.uploadCompressedGlTexture(a,t,u),p;const T=m.texOptions;return T.format=T.format||(m.hasAlpha?a.RGBA:a.RGB),T.type=T.type||a.UNSIGNED_BYTE,T.internalFormat=T.internalFormat||T.format,n&&n.imageRef&&(T.imageRef=n.imageRef),this.stage.platform.uploadGlTexture(a,t,u,T),p.params=X.cloneObjShallow(x),p.options=X.cloneObjShallow(T),p.bytesPerPixel=this._getBytesPerPixel(T.format,T.type),p}freeTextureSource(t){this.stage.gl.deleteTexture(t.nativeTexture)}addQuad(t,n,a){let u=a*20;const f=n.quadElements[a];let m=f._renderContext,p=t.quads.floats,x=t.quads.uints;const T=ye.mergeColorAlpha;if(m.tb!==0||m.tc!==0)p[u++]=m.px,p[u++]=m.py,p[u++]=f._ulx,p[u++]=f._uly,x[u++]=T(f._colorUl,m.alpha),p[u++]=m.px+f._w*m.ta,p[u++]=m.py+f._w*m.tc,p[u++]=f._brx,p[u++]=f._uly,x[u++]=T(f._colorUr,m.alpha),p[u++]=m.px+f._w*m.ta+f._h*m.tb,p[u++]=m.py+f._w*m.tc+f._h*m.td,p[u++]=f._brx,p[u++]=f._bry,x[u++]=T(f._colorBr,m.alpha),p[u++]=m.px+f._h*m.tb,p[u++]=m.py+f._h*m.td,p[u++]=f._ulx,p[u++]=f._bry,x[u]=T(f._colorBl,m.alpha);else{let A=m.px+f._w*m.ta,b=m.py+f._h*m.td;p[u++]=m.px,p[u++]=m.py,p[u++]=f._ulx,p[u++]=f._uly,x[u++]=T(f._colorUl,m.alpha),p[u++]=A,p[u++]=m.py,p[u++]=f._brx,p[u++]=f._uly,x[u++]=T(f._colorUr,m.alpha),p[u++]=A,p[u++]=b,p[u++]=f._brx,p[u++]=f._bry,x[u++]=T(f._colorBr,m.alpha),p[u++]=m.px,p[u++]=b,p[u++]=f._ulx,p[u++]=f._bry,x[u]=T(f._colorBl,m.alpha)}}isRenderTextureReusable(t,n){let a=t._renderTextureInfo.offset*80/4,u=t.quads.floats,f=t.quads.uints;return u[a]===0&&u[a+1]===0&&u[a+2]===0&&u[a+3]===0&&f[a+4]===4294967295&&u[a+5]===n.w&&u[a+6]===0&&u[a+7]===1&&u[a+8]===0&&f[a+9]===4294967295&&u[a+10]===n.w&&u[a+11]===n.h&&u[a+12]===1&&u[a+13]===1&&f[a+14]===4294967295&&u[a+15]===0&&u[a+16]===n.h&&u[a+17]===0&&u[a+18]===1&&f[a+19]===4294967295}finishRenderState(t){let n=t.length*80;for(let a=0,u=t.quadOperations.length;a<u;a++){t.quadOperations[a].extraAttribsDataByteOffset=n;let f=t.quadOperations[a].shader.getExtraAttribBytesPerVertex()*4*t.quadOperations[a].length;n+=f,f&&t.quadOperations[a].shader.setExtraAttribsInBuffer(t.quadOperations[a],t.quads)}t.quads.dataLength=n}copyRenderTexture(t,n,a){const u=this.stage.gl;u.bindTexture(u.TEXTURE_2D,n),u.bindFramebuffer(u.FRAMEBUFFER,t.framebuffer);const f=t.precision;u.copyTexSubImage2D(u.TEXTURE_2D,0,f*(a.sx||0),f*(a.sy||0),f*(a.x||0),f*(a.y||0),f*(a.w||t.ow),f*(a.h||t.oh))}}class Sb extends zv{constructor(t){super(t),this.renderContexts=[],this.modes=[]}setRenderContext(t,n){this.renderContexts[t]=n}setSimpleTc(t,n){n?this.modes[t]|=1:this.modes[t]-=this.modes[t]&1}setWhite(t,n){n?this.modes[t]|=2:this.modes[t]-=this.modes[t]&2}getRenderContext(t){return this.renderContexts[t]}getSimpleTc(t){return this.modes[t]&1}getWhite(t){return this.modes[t]&2}}class wb extends Bv{getRenderContext(t){return this.quads.getRenderContext(this.index+t)}getSimpleTc(t){return this.quads.getSimpleTc(this.index+t)}getWhite(t){return this.quads.getWhite(this.index+t)}}class Bd extends jv{init(){this._mainRenderTexture=this.ctx.stage.getCanvas()}_renderQuadOperation(t){let n=t.shader;if(t.length||t.shader.addEmpty()){const a=this._renderTexture||this._mainRenderTexture;n.beforeDraw(t,a),n.draw(t,a),n.afterDraw(t,a)}}_clearRenderTexture(){const t=this._getContext();let n=[0,0,0,0];this._mainRenderTexture.ctx===t&&(n=this.ctx.stage.getClearColor());const a=t.canvas;t.setTransform(1,0,0,1,0,0),!n[0]&&!n[1]&&!n[2]&&!n[3]?t.clearRect(0,0,a.width,a.height):(t.fillStyle=ye.getRgbaStringFromArray(n),t.globalCompositeOperation="copy",t.beginPath(),t.rect(0,0,a.width,a.height),t.closePath(),t.fill(),t.globalCompositeOperation="source-over")}_getContext(){return this._renderTexture?this._renderTexture.ctx:this._mainRenderTexture.ctx}_restoreContext(){const t=this._getContext();t.restore(),t.save(),t._scissor=null}_setScissor(t){const n=this._getContext();if(!Bd._equalScissorAreas(n.canvas,n._scissor,t)){this._restoreContext();let a=this.ctx.stage.getRenderPrecision();t&&(n.beginPath(),n.rect(Math.round(t[0]*a),Math.round(t[1]*a),Math.round(t[2]*a),Math.round(t[3]*a)),n.closePath(),n.clip()),n._scissor=t}}static _equalScissorAreas(t,n,a){return n||(n=[0,0,t.width,t.height]),a||(a=[0,0,t.width,t.height]),X.equalValues(n,a)}}class jd extends ko{beforeDraw(t){}draw(t){}afterDraw(t){}}class tu extends jd{constructor(t){super(t),this._rectangleTexture=t.stage.rectangleTexture.source.nativeTexture,this._tintManager=this.ctx.stage.renderer.tintManager}draw(t,n){const a=n.ctx;let u=t.length;for(let f=0;f<u;f++){const m=t.getTexture(f),p=t.getElementCore(f),x=t.getRenderContext(f),T=t.getWhite(f),A=t.getSimpleTc(f),b=this.ctx.stage.getRenderPrecision();a.setTransform(x.ta*b,x.tc*b,x.tb*b,x.td*b,x.px*b,x.py*b);const I=m===this._rectangleTexture,D={operation:t,target:n,index:f,rect:I};if(I)T?a.fillStyle="white":this._setColorGradient(a,p),a.globalAlpha=x.alpha,this._beforeDrawEl(D),a.fillRect(0,0,p.w,p.h),this._afterDrawEl(D),a.globalAlpha=1;else{a.globalAlpha=x.alpha,this._beforeDrawEl(D);const v=A?0:p._ulx*m.w,O=A?0:p._uly*m.h,W=(A?1:p._brx-p._ulx)*m.w,Z=(A?1:p._bry-p._uly)*m.h;if(!T){let Q=p._colorUl;(p._colorUl!==p._colorUr||p._colorUr!==p._colorBl||p._colorBr!==p._colorBl)&&(Q=ye.mergeMultiColorsEqual([p._colorUl,p._colorUr,p._colorBl,p._colorBr]));const q=(Q/16777216|0)/255;a.globalAlpha*=q;const xe=Q&16777215,me=this._tintManager.getTintTexture(m,xe);a.fillStyle="white",a.drawImage(me,v,O,W,Z,0,0,p.w,p.h)}else a.fillStyle="white",a.drawImage(m,v,O,W,Z,0,0,p.w,p.h);this._afterDrawEl(D),a.globalAlpha=1}}}_setColorGradient(t,n,a=n.w,u=n.h,f=!0){let m=n._colorUl,p;n._colorUl===n._colorUr?n._colorBl===n._colorBr&&(n._colorUl===n.colorBl||(p=t.createLinearGradient(0,0,0,u),f?(p.addColorStop(0,ye.getRgbaString(n._colorUl)),p.addColorStop(1,ye.getRgbaString(n._colorBl))):(p.addColorStop(0,ye.getRgbString(n._colorUl)),p.addColorStop(1,ye.getRgbString(n._colorBl))))):n._colorUl===n._colorBl&&n._colorUr===n._colorBr&&(p=t.createLinearGradient(0,0,a,0),f?(p.addColorStop(0,ye.getRgbaString(n._colorUl)),p.addColorStop(1,ye.getRgbaString(n._colorBr))):(p.addColorStop(0,ye.getRgbString(n._colorUl)),p.addColorStop(1,ye.getRgbString(n._colorBr)))),p?t.fillStyle=p:t.fillStyle=f?ye.getRgbaString(m):ye.getRgbString(m)}_beforeDrawEl(t){}_afterDrawEl(t){}}class Ab{constructor(t){this.stage=t,this._usedMemory=0,this._cachedNativeTextures=new Set}destroy(){this.gc(!0)}_addMemoryUsage(t){this._usedMemory+=t,this.stage.addMemoryUsage(t)}delete(t){if(this._hasCache(t)){const n=this._getCache(t),a=n.memoryUsage;n.clear(),this._cachedNativeTextures.delete(t),this._addMemoryUsage(n.memoryUsage-a)}}getTintTexture(t,n){const a=this.stage.frameCounter;this._cachedNativeTextures.add(t);const u=this._getCache(t),f=u.get(n);if(f.lf=a,f.tx)return t.update>f.u&&this._tintTexture(f.tx,t,n),f.tx;{const m=u.memoryUsage;let p=u.reuseTexture(a);p?p.ctx.clearRect(0,0,p.width,p.height):(p=document.createElement("canvas"),p.width=t.w,p.height=t.h,p.ctx=p.getContext("2d")),this._tintTexture(p,t,n),u.set(n,p,a);const x=u.memoryUsage;return x!==m&&this._addMemoryUsage(x-m),p}}_tintTexture(t,n,a){let u=a.toString(16);for(;u.length<6;)u="0"+u;t.ctx.fillStyle="#"+u,t.ctx.globalCompositeOperation="copy",t.ctx.fillRect(0,0,n.w,n.h),t.ctx.globalCompositeOperation="multiply",t.ctx.drawImage(n,0,0,n.w,n.h,0,0,t.width,t.height),t.ctx.globalCompositeOperation="destination-in",t.ctx.drawImage(n,0,0,n.w,n.h,0,0,t.width,t.height)}_hasCache(t){return!!t._tintCache}_getCache(t){return t._tintCache||(t._tintCache=new Eb(t)),t._tintCache}gc(t=!1){const n=this.stage.frameCounter;let a=0;this._cachedNativeTextures.forEach(u=>{const f=this._getCache(u);if(t)a+=f.memoryUsage,f.clear();else{const m=f.memoryUsage;f.cleanup(n),f.releaseBlancoTextures(),a+=f.memoryUsage-m}}),t&&this._cachedNativeTextures.clear(),a&&this._addMemoryUsage(a)}}class Eb{constructor(t){this._tx=t,this._colors=new Map,this._blancoTextures=null,this._lastCleanupFrame=0,this._memTextures=0}get memoryUsage(){return this._memTextures*this._tx.w*this._tx.h}releaseBlancoTextures(){this._memTextures-=this._blancoTextures.length,this._blancoTextures=[]}clear(){this._blancoTextures=null,this._colors.clear(),this._memTextures=0}get(t){let n=this._colors.get(t);return n||(n={lf:-1,tx:void 0,u:-1},this._colors.set(t,n)),n}set(t,n,a){const u=this.get(t);u.lf=a,u.tx=n,u.u=a,this._memTextures++}cleanup(t){this._lastCleanupFrame!==t&&(this._blancoTextures=[],this._colors.forEach((n,a)=>{n.lf<t-1&&(n.tx&&this._blancoTextures.push(n.tx),this._colors.delete(a))}),this._lastCleanupFrame=t)}reuseTexture(t){if(this.cleanup(t),this._blancoTextures&&this._blancoTextures.length)return this._memTextures--,this._blancoTextures.pop()}}class Cb extends Vv{constructor(t){super(t),this.tintManager=new Ab(t),this.setupC2d(this.stage.c2d.canvas)}destroy(){this.tintManager.destroy()}_createDefaultShader(t){return new tu(t)}_getShaderBaseType(){return jd}_getShaderAlternative(t){return t.getC2d&&t.getC2d()}createCoreQuadList(t){return new Sb(t)}createCoreQuadOperation(t,n,a,u,f,m){return new wb(t,n,a,u,f,m)}createCoreRenderExecutor(t){return new Bd(t)}createCoreRenderState(t){return new Hv(t)}createRenderTexture(t,n,a,u){const f=document.createElement("canvas");return f.width=a,f.height=u,this.setupC2d(f),f}freeRenderTexture(t){this.tintManager.delete(t)}gc(t){this.tintManager.gc(t)}uploadTextureSource(t,n){if(n.source.buffer){const a=document.createElement("canvas");a.width=n.w,a.height=n.h;const u=new ImageData(new Uint8ClampedArray(n.source.buffer),n.w,n.h);return a.getContext("2d").putImageData(u,0,0),a}return n.source}freeTextureSource(t){this.tintManager.delete(t.nativeTexture)}addQuad(t,n,a){const u=n.quadElements[a];n.setRenderContext(a,u._renderContext),n.setWhite(a,u.isWhite()),n.setSimpleTc(a,u.hasSimpleTexCoords())}isRenderTextureReusable(t,n){return!1}finishRenderState(t){}setupC2d(t){const n=t.getContext("2d");t.ctx=n,n._scissor=null,t.ctx.save()}}class Hd extends eu{enableAttribs(){let t=this.gl;t.vertexAttribPointer(this._attrib("aVertexPosition"),2,t.FLOAT,!1,20,0),t.enableVertexAttribArray(this._attrib("aVertexPosition")),this._attrib("aTextureCoord")!==-1&&(t.vertexAttribPointer(this._attrib("aTextureCoord"),2,t.FLOAT,!1,20,2*4),t.enableVertexAttribArray(this._attrib("aTextureCoord"))),this._attrib("aColor")!==-1&&(t.vertexAttribPointer(this._attrib("aColor"),4,t.UNSIGNED_BYTE,!0,20,4*4),t.enableVertexAttribArray(this._attrib("aColor")))}disableAttribs(){let t=this.gl;t.disableVertexAttribArray(this._attrib("aVertexPosition")),this._attrib("aTextureCoord")!==-1&&t.disableVertexAttribArray(this._attrib("aTextureCoord")),this._attrib("aColor")!==-1&&t.disableVertexAttribArray(this._attrib("aColor"))}setupUniforms(t){this._setUniform("projection",this._getProjection(t),this.gl.uniform2fv,!1)}draw(t){let n=this.gl,a=t.length;if(a){let u=t.getTexture(0),f=0;for(let m=0;m<a;m++){let p=t.getTexture(m);if(u!==p){if(u.options&&u.options.imageRef){let x=m>0?m-1:m;const T=this.ctx.stage.getOption("precision");let A=t.getElementCore(x);this.ctx.stage.platform.paint(n,u.options.imageRef,A._worldContext.px*T,A._worldContext.py*T,A._colorUl,A)}else n.bindTexture(n.TEXTURE_2D,u),n.drawElements(n.TRIANGLES,6*(m-f),n.UNSIGNED_SHORT,(f+t.index)*6*2);u=p,f=m}}if(f<a)if(u.options&&u.options.imageRef){const m=this.ctx.stage.getOption("precision");let p=t.getElementCore(f);this.ctx.stage.platform.paint(n,u.options.imageRef,p._worldContext.px*m,p._worldContext.py*m,p._colorUl,p)}else n.bindTexture(n.TEXTURE_2D,u),n.drawElements(n.TRIANGLES,6*(a-f),n.UNSIGNED_SHORT,(f+t.index)*6*2)}}}Hd.vertexShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    attribute vec2 aVertexPosition;
    attribute vec2 aTextureCoord;
    attribute vec4 aColor;
    uniform vec2 projection;
    varying vec2 vTextureCoord;
    varying vec4 vColor;
    void main(void){
        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);
        vTextureCoord = aTextureCoord;
        vColor = aColor;
        gl_Position.y = -sign(projection.y) * gl_Position.y;
    }
`;Hd.fragmentShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    varying vec2 vTextureCoord;
    varying vec4 vColor;
    uniform sampler2D uSampler;
    void main(void){
        gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor;
    }
`;class bb extends Wv{constructor(t){super(t)}_createDefaultShader(t){return new Hd(t)}createCoreRenderExecutor(t){global.beginDrawing();let n=super.createCoreRenderExecutor(t);return global.endDrawing(),n}}class Ib{constructor(t={}){this._items=new Map,this._id=0,this._initWorker()}destroy(){this._worker&&this._worker.terminate()}_initWorker(){const t=`(${Lb.toString()})()`,n=new Blob([t.replace('"use strict";',"")]),a=(window.URL?URL:webkitURL).createObjectURL(n,{type:"application/javascript; charset=utf-8"});this._worker=new Worker(a),this._worker.postMessage({type:"config",config:{path:window.location.href,protocol:window.location.protocol}}),this._worker.onmessage=u=>{if(u.data&&u.data.id){const f=u.data.id,m=this._items.get(f);m&&(u.data.type=="data"?this.finish(m,u.data.info):this.error(m,u.data.info))}}}create(t){const n=++this._id,a=new Rb(this,n,t);return this._items.set(n,a),this._worker.postMessage({type:"add",id:n,src:t}),a}cancel(t){this._worker.postMessage({type:"cancel",id:t.id}),this._items.delete(t.id)}error(t,n){t.error(n),this._items.delete(t.id)}finish(t,n){t.load(n),this._items.delete(t.id)}}class Rb{constructor(t,n,a){this._manager=t,this._id=n,this._src=a,this._onError=null,this._onLoad=null}get id(){return this._id}get src(){return this._src}set onError(t){this._onError=t}set onLoad(t){this._onLoad=t}cancel(){this._manager.cancel(this)}load(t){this._onLoad&&this._onLoad(t)}error(t){this._onError&&this._onError(t)}}const Lb=function(){function c(){this.items=new Map;var n=this;onmessage=function(a){n._receiveMessage(a)}}c.isPathAbsolute=function(n){return/^(?:\/|[a-z]+:\/\/)/.test(n)||n.substr(0,5)=="data:"},c.prototype._receiveMessage=function(n){if(n.data.type==="config"){this.config=n.data.config;var a=this.config.path,u=/#.*?\//;u.test(a)&&(a=a.replace(/#.*$/,""));var f=a.split("/");f.pop(),this._relativeBase=f.join("/")+"/"}else n.data.type==="add"?this.add(n.data.id,n.data.src):n.data.type==="cancel"&&this.cancel(n.data.id)},c.prototype.add=function(n,a){c.isPathAbsolute(a)||(a=this._relativeBase+a),a.substr(0,2)==="//"&&(a=this.config.protocol+a);var u=new t(n,a),f=this;u.onFinish=function(m){f.finish(u,m)},u.onError=function(m){f.error(u,m)},this.items.set(n,u),u.start()},c.prototype.cancel=function(n){var a=this.items.get(n);a&&(a.cancel(),this.items.delete(n))},c.prototype.finish=function(n,{imageBitmap:a,hasAlphaChannel:u}){postMessage({type:"data",id:n.id,info:{imageBitmap:a,hasAlphaChannel:u}},[a]),this.items.delete(n.id)},c.prototype.error=function(n,{type:a,message:u}){postMessage({type:"error",id:n.id,info:{type:a,message:u}}),this.items.delete(n.id)},c.isWPEBrowser=function(){return navigator.userAgent.indexOf("WPE")!==-1};function t(n,a){this._onError=void 0,this._onFinish=void 0,this._id=n,this._src=a,this._xhr=void 0,this._mimeType=void 0,this._canceled=!1}Object.defineProperty(t.prototype,"id",{get:function(){return this._id}}),Object.defineProperty(t.prototype,"onFinish",{get:function(){return this._onFinish},set:function(n){this._onFinish=n}}),Object.defineProperty(t.prototype,"onError",{get:function(){return this._onError},set:function(n){this._onError=n}}),t.prototype.start=function(){this._xhr=new XMLHttpRequest,this._xhr.open("GET",this._src,!0),this._xhr.responseType="blob";var n=this;this._xhr.onerror=function(a){n.error({type:"connection",message:"Connection error"})},this._xhr.onload=function(a){var u=n._xhr.response;n._mimeType=u.type,n._createImageBitmap(u)},this._xhr.send()},t.prototype._createImageBitmap=function(n){var a=this;createImageBitmap(n,{premultiplyAlpha:"premultiply",colorSpaceConversion:"none",imageOrientation:"none"}).then(function(u){a.finish({imageBitmap:u,hasAlphaChannel:a._hasAlphaChannel()})}).catch(function(u){a.error({type:"parse",message:"Error parsing image data"})})},t.prototype._hasAlphaChannel=function(){return c.isWPEBrowser()?!0:this._mimeType.indexOf("image/png")!==-1},t.prototype.cancel=function(){this._canceled||(this._xhr&&this._xhr.abort(),this._canceled=!0)},t.prototype.error=function(n,a){!this._canceled&&this._onError&&this._onError({type:n,message:a})},t.prototype.finish=function(n){!this._canceled&&this._onFinish&&this._onFinish(n)},new c};class Mb{init(t){this.stage=t,this._looping=!1,this._awaitingLoop=!1,this._loopHandler=null,this._idleLoopCounter=0,this._idleLoopDelay=60,this.stage.getOption("useImageWorker")&&(!window.createImageBitmap||!window.Worker?console.warn("[Lightning] Can't use image worker because browser does not have createImageBitmap and Web Worker support"):this._imageWorker=new Ib),this._registerVisibilityChangeHandler()}destroy(){this._imageWorker&&this._imageWorker.destroy(),this._removeKeyHandler(),this._removeClickHandler(),this._removeHoverHandler(),this._removeScrollWheelHandler(),this._removeVisibilityChangeHandler()}startLoop(){this._looping=!0,this._awaitingLoop||this.loop()}stopLoop(){this._looping=!1}switchLoop(){if(this._idleLoopCounter<this._idleLoopDelay){this._idleLoopCounter++;return}this.stage.ctx.hasRenderUpdates()?this._idleLoopCounter=0:(this.stopLoop(),this._loopHandler=setInterval(()=>{this.stage.updateFrame(),this.stage.idleFrame(),this.stage.ctx.hasRenderUpdates()&&(clearInterval(this._loopHandler),this.startLoop())},1e3/60))}loop(){let t=this,n=function(){t._awaitingLoop=!1,t._looping&&(t.stage.updateFrame(),t.stage.getOption("pauseRafLoopOnIdle")&&t.switchLoop(),t.stage.renderFrame(),requestAnimationFrame(n),t._awaitingLoop=!0)};requestAnimationFrame(n)}uploadCompressedGlTexture(t,n,a,u){const f=a.pvr?a.mipmaps[0]:new DataView(a.mipmaps[0]);t.compressedTexImage2D(t.TEXTURE_2D,0,a.glInternalFormat,a.pixelWidth,a.pixelHeight,0,f),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR)}uploadGlTexture(t,n,a,u){if(a instanceof ImageData||a instanceof HTMLImageElement||a instanceof HTMLVideoElement||window.ImageBitmap&&a instanceof ImageBitmap)t.texImage2D(t.TEXTURE_2D,0,u.internalFormat,u.format,u.type,a);else if(a instanceof HTMLCanvasElement){if(X.isZiggo||this.stage.getOption("forceTxCanvasSource"))t.texImage2D(t.TEXTURE_2D,0,u.internalFormat,u.format,u.type,a);else if(a.width>0&&a.height>0){const f=a.getContext("2d");t.texImage2D(t.TEXTURE_2D,0,u.internalFormat,u.format,u.type,f.getImageData(0,0,a.width,a.height))}}else t.texImage2D(t.TEXTURE_2D,0,u.internalFormat,n.w,n.h,0,u.format,u.type,a)}handleKtxLoad(t,n){var a=this;return function(){var u=this.response,f=new DataView(u),m=3632701469;m!==f.getUint32(0)+f.getUint32(4)+f.getUint32(8)&&t("Parsing failed: identifier ktx mismatch:",n);var p=f.getUint32(12)===16909060,x={glType:f.getUint32(16,p),glTypeSize:f.getUint32(20,p),glFormat:f.getUint32(24,p),glInternalFormat:f.getUint32(28,p),glBaseInternalFormat:f.getUint32(32,p),pixelWidth:f.getUint32(36,p),pixelHeight:f.getUint32(40,p),pixelDepth:f.getUint32(44,p),numberOfArrayElements:f.getUint32(48,p),numberOfFaces:f.getUint32(52,p),numberOfMipmapLevels:f.getUint32(56,p),bytesOfKeyValueData:f.getUint32(60,p),kvps:[],mipmaps:[],get width(){return this.pixelWidth},get height(){return this.pixelHeight}};const T=v=>{const O=[];for(let W in v)O.push(v[W]);return O};Object.values(a.stage.renderer.getCompressedTextureExtensions()).filter(v=>v!=null).map(v=>T(v)).reduce((v,O)=>v.concat(O)).includes(x.glInternalFormat)||console.warn("[Lightning] Unrecognized texture extension format:",n,x.glInternalFormat,a.stage.renderer.getCompressedTextureExtensions());var b=64;b+=x.bytesOfKeyValueData;for(var I=0;I<x.numberOfMipmapLevels;I++){var D=f.getUint32(b);b+=4,x.mipmaps.push(f.buffer.slice(b,D)),b+=D}t(null,{source:x,renderInfo:{src:n,compressed:!0}})}}handlePvrLoad(t,n){return function(){const T=this.response,A=new Int32Array(T,0,13),b=A[12]+52,I=new Uint8Array(T,b);var D={glInternalFormat:36196,pixelWidth:A[7],pixelHeight:A[6],numberOfMipmapLevels:A[11],mipmaps:[],pvr:!0,get width(){return this.pixelWidth},get height(){return this.pixelHeight}};let v=0,O=D.pixelWidth,W=D.pixelHeight;for(var Z=0;Z<D.numberOfMipmapLevels;Z++){const re=(O+3>>2)*(W+3>>2)*8,Q=new Uint8Array(T,I.byteOffset+v,re);D.mipmaps.push(Q),v+=re,O=O>>1,W=W>>1}t(null,{source:D,renderInfo:{src:n,compressed:!0}})}}loadSrcTexture({src:t,hasAlpha:n},a){let u,f=t.indexOf(".png")>=0||t.substr(0,21)=="data:image/png;base64",m=t.indexOf(".ktx")>=0,p=t.indexOf(".pvr")>=0;if(m||p){let x=new XMLHttpRequest;x.addEventListener("load",m?this.handleKtxLoad(a,t):this.handlePvrLoad(a,t)),x.open("GET",t),x.responseType="arraybuffer",x.send(),u=function(){x.abort()}}else if(this._imageWorker){const x=this._imageWorker.create(t);x.onError=function(T){return a("Image load error")},x.onLoad=function({imageBitmap:T,hasAlphaChannel:A}){a(null,{source:T,renderInfo:{src:t,compressed:!1},hasAlpha:A,premultiplyAlpha:!0})},u=function(){x.cancel()}}else{let x=new Image;t.substr(0,5)!="data:"&&!X.isPS4&&(x.crossOrigin="Anonymous"),x.onerror=function(T){if(x.src)return a("Image load error")},x.onload=function(){a(null,{source:x,renderInfo:{src:t,compressed:!1},hasAlpha:f||n})},x.src=t,u=function(){x.onerror=null,x.onload=null,x.removeAttribute("src")}}return u}createWebGLContext(t,n){let a=this.stage.getOption("canvas")||document.createElement("canvas");t&&n&&(a.width=t,a.height=n);let u={alpha:!0,antialias:!1,premultipliedAlpha:!0,stencil:!0,preserveDrawingBuffer:!1},f=a.getContext("webgl",u)||a.getContext("experimental-webgl",u);if(!f)throw new Error("This browser does not support webGL.");return f}createCanvasContext(t,n){let a=this.stage.getOption("canvas")||document.createElement("canvas");t&&n&&(a.width=t,a.height=n);let u=a.getContext("2d");if(!u)throw new Error("This browser does not support 2d canvas.");return u}getHrTime(){return window.performance?window.performance.now():new Date().getTime()}getDrawingCanvas(){return document.createElement("canvas")}getTextureOptionsForDrawingCanvas(t){let n={};return n.source=t,n}nextFrame(t){}registerKeydownHandler(t){this._keydownListener=n=>{t(n)},window.addEventListener("keydown",this._keydownListener)}registerKeyupHandler(t){this._keyupListener=n=>{t(n)},window.addEventListener("keyup",this._keyupListener)}_removeKeyHandler(){this._keydownListener&&window.removeEventListener("keydown",this._keydownListener),this._keyupListener&&window.removeEventListener("keyup",this._keyupListener)}registerClickHandler(t){this._clickListener=n=>{t(n)},window.addEventListener("mousedown",this._clickListener)}_removeClickHandler(){this._clickListener&&window.removeEventListener("mousedown",this._clickListener)}registerHoverHandler(t){this._hoverListener=n=>{t(n)},window.addEventListener("mousemove",this._hoverListener)}_removeHoverHandler(){this._hoverListener&&window.removeEventListener("mousemove",this._hoverListener)}registerScrollWheelHandler(t){this._scrollWheelListener=n=>{t(n)},window.addEventListener("wheel",this._scrollWheelListener)}_removeScrollWheelHandler(){this._scrollWheelListener&&window.removeEventListener("wheel",this._scrollWheelListener)}_registerVisibilityChangeHandler(){this._visibilityChangeHandler=()=>{document.visibilityState==="visible"&&(this.stage.root.core.setHasRenderUpdates(2),this.stage.renderFrame())},document.addEventListener("visibilitychange",this._visibilityChangeHandler)}_removeVisibilityChangeHandler(){this._visibilityChangeHandler&&document.removeEventListener("visibilitychange",this._visibilityChangeHandler)}}class Pb{static load(t){return t.platform?t.platform:Mb}}let Ll=class an{static isFunction(t){return typeof t=="function"}static isNumber(t){return typeof t=="number"}static isInteger(t){return typeof t=="number"&&t%1===0}static isBoolean(t){return t===!0||t===!1}static isString(t){return typeof t=="string"}static isObject(t){let n=typeof t;return!!t&&(n=="object"||n=="function")}static isPlainObject(t){return!!t&&typeof t=="object"}static isObjectLiteral(t){return typeof t=="object"&&t&&t.constructor===Object}static getArrayIndex(t,n){return an.getModuloIndex(t,n.length)}static equalValues(t,n){return typeof t!=typeof n?!1:an.isObjectLiteral(t)?an.isObjectLiteral(n)&&an.equalObjectLiterals(t,n):Array.isArray(t)?Array.isArray(n)&&an.equalArrays(t,n):t===n}static equalObjectLiterals(t,n){let a=Object.keys(t),u=Object.keys(n);if(a.length!==u.length)return!1;for(let f=0,m=a.length;f<m;f++){const p=a[f],x=u[f];if(p!==x)return!1;const T=t[p],A=n[x];if(!an.equalValues(T,A))return!1}return!0}static equalArrays(t,n){if(t.length!==n.length)return!1;for(let a=0,u=t.length;a<u;a++)if(!this.equalValues(t[a],n[a]))return!1;return!0}};class or{constructor(t,n){this._id=t,this._gl=n,this._program=void 0,this._buffers=new Map,this._framebuffers=new Map,this._renderbuffers=new Map,this._vertexAttribs=new Array(16),this._nonDefaultFlags=new Set,this._settings=new Map,this._textures=new Array(8),this._maxTexture=0,this._activeTexture=n.TEXTURE0,this._pixelStorei=new Array(5)}_getDefaultFlag(t){return t===this._gl.DITHER}setFlag(t,n){const a=this._getDefaultFlag(t);return n===a?this._nonDefaultFlags.delete(t):this._nonDefaultFlags.has(t)?!1:(this._nonDefaultFlags.add(t),!0)}setBuffer(t,n){const a=this._buffers.get(t)!==n;return this._buffers.set(t,n),a&&t===this._gl.ARRAY_BUFFER&&(this._vertexAttribs=[]),a}setFramebuffer(t,n){const a=this._framebuffers.get(t)!==n;return this._framebuffers.set(t,n),a}setRenderbuffer(t,n){const a=this._renderbuffers.get(t)!==n;return this._renderbuffers.set(t,n),a}setProgram(t){const n=this._program!==t;return this._program=t,n}setSetting(t,n){const a=this._settings.get(t),u=!a||!Ll.equalValues(a,n);return this._settings.set(t,n),u}disableVertexAttribArray(t){const n=this._vertexAttribs[t];return n&&n[5]?(n[5]=!1,!0):!1}enableVertexAttribArray(t){const n=this._vertexAttribs[t];if(n){if(!n[0])return n[0]=!0,!0}else return this._vertexAttribs[t]=[0,0,0,0,0,!0],!0;return!1}vertexAttribPointer(t,n){let a=this._vertexAttribs[t],u=!1;return a&&(u=a[0]===n[0]&&a[1]===n[1]&&a[2]===n[2]&&a[3]===n[3]&&a[4]===n[4]),u?!1:(n[5]=a?a[5]:!1,!0)}setActiveTexture(t){const n=this._activeTexture!==t;return this._activeTexture=t,n}bindTexture(t,n){const a=or._getTextureIndex(this._activeTexture);this._maxTexture=Math.max(this._maxTexture,a+1);const u=this._textures[a],f=or._getTextureTargetIndex(t);return u?u[f]===n?!1:(u[f]=n,!0):n?(this._textures[a]=[],this._textures[a][f]=n,!0):!1}setPixelStorei(t,n){const a=or._getPixelStoreiIndex(t),u=!Ll.equalValues(this._pixelStorei[a],n);return this._pixelStorei[a]=n,u}migrate(t){const n=this;this._migrateFlags(n,t),t._program!==n._program&&this._gl._useProgram(t._program),this._migrateFramebuffers(n,t),this._migrateRenderbuffers(n,t);const a=this._migrateBuffers(n,t);this._migrateAttributes(n,t,a),this._migrateFlags(n,t),this._migrateSettings(n,t),this._migratePixelStorei(n,t),this._migrateTextures(n,t)}_migratePixelStorei(t,n){for(let a=0,u=t._pixelStorei.length;a<u;a++)if(t._pixelStorei[a]!==n._pixelStorei[a]){const f=n._pixelStorei[a]!==void 0?n._pixelStorei[a]:or._getDefaultPixelStoreiByIndex(a);this._gl._pixelStorei(or._getPixelStoreiByIndex(a),f)}}_migrateTextures(t,n){const a=Math.max(t._maxTexture,n._maxTexture);let u=t._activeTexture;for(let f=0;f<a;f++){const m=n._textures[f],p=t._textures[f],x=or._getTextureByIndex(f),T=Math.max(p?p.length:0,m?m.length:0);for(let A=0,b=T;A<b;A++){const I=or._getTextureTargetByIndex(A);u!==x&&(this._gl._activeTexture(x),u=x);const D=m&&m[A]||null;this._gl._bindTexture(I,D)}}n._activeTexture!==u&&this._gl._activeTexture(n._activeTexture)}_migrateBuffers(t,n){return n._buffers.forEach((a,u)=>{t._buffers.get(u)!==a&&this._gl._bindBuffer(u,a)}),t._buffers.forEach((a,u)=>{n._buffers.get(u)===void 0&&this._gl._bindBuffer(u,null)}),n._buffers.get(this._gl.ARRAY_BUFFER)!==t._buffers.get(this._gl.ARRAY_BUFFER)}_migrateFramebuffers(t,n){n._framebuffers.forEach((a,u)=>{t._framebuffers.get(u)!==a&&this._gl._bindFramebuffer(u,a)}),t._framebuffers.forEach((a,u)=>{n._framebuffers.get(u)===void 0&&this._gl._bindFramebuffer(u,null)})}_migrateRenderbuffers(t,n){n._renderbuffers.forEach((a,u)=>{t._renderbuffers.get(u)!==a&&this._gl._bindRenderbuffer(u,a)}),t._renderbuffers.forEach((a,u)=>{n._renderbuffers.get(u)===void 0&&this._gl._bindRenderbuffer(u,null)})}_migrateAttributes(t,n,a){a?n._vertexAttribs.forEach((u,f)=>{u[0]&&this._gl._vertexAttribPointer(f,u[0],u[1],u[2],u[3],u[4]),u[5]&&this._gl._enableVertexAttribArray(f)}):(t._vertexAttribs.forEach((u,f)=>{n._vertexAttribs[f]||this._gl._disableVertexAttribArray(f)}),n._vertexAttribs.forEach((u,f)=>{this._gl._vertexAttribPointer(f,u[0],u[1],u[2],u[4]),u[5]?this._gl._enableVertexAttribArray(f):this._gl._disableVertexAttribArray(f)}))}_migrateSettings(t,n){const a=this.constructor.getDefaultSettings();t._settings.forEach((u,f)=>{const m=f.name||f.xname;if(!n._settings.has(f)){let p=a.get(m);Ll.isFunction(p)&&(p=p(this._gl)),n._settings.set(f,p),f.apply(this._gl,p)}}),n._settings.forEach((u,f)=>{const m=t._settings.get(f);(!m||!Ll.equalValues(m,u))&&f.apply(this._gl,u)})}_migrateFlags(t,n){t._nonDefaultFlags.forEach(a=>{n._nonDefaultFlags.has(a)||(this._getDefaultFlag(a)?this._gl._enable(a):this._gl._disable(a))}),n._nonDefaultFlags.forEach(a=>{t._nonDefaultFlags.has(a)||(this._getDefaultFlag(a)?this._gl._disable(a):this._gl._enable(a))})}static getDefaultSettings(){if(!this._defaultSettings){this._defaultSettings=new Map;const t=this._defaultSettings,n=WebGLRenderingContext.prototype;t.set("viewport",function(a){return[0,0,a.canvas.width,a.canvas.height]}),t.set("scissor",function(a){return[0,0,a.canvas.width,a.canvas.height]}),t.set("blendColor",[0,0,0,0]),t.set("blendEquation",[n.FUNC_ADD]),t.set("blendEquationSeparate",[n.FUNC_ADD,n.FUNC_ADD]),t.set("blendFunc",[n.ONE,n.ZERO]),t.set("blendFuncSeparate",[n.ONE,n.ZERO,n.ONE,n.ZERO]),t.set("clearColor",[0,0,0,0]),t.set("clearDepth",[1]),t.set("clearStencil",[0]),t.set("colorMask",[!0,!0,!0,!0]),t.set("cullFace",[n.BACK]),t.set("depthFunc",[n.LESS]),t.set("depthMask",[!0]),t.set("depthRange",[0,1]),t.set("frontFace",[n.CCW]),t.set("lineWidth",[1]),t.set("polygonOffset",[0,0]),t.set("sampleCoverage",[1,!1]),t.set("stencilFunc",[n.ALWAYS,0,1]),t.set("_stencilFuncSeparateFront",[n.ALWAYS,0,1]),t.set("_stencilFuncSeparateBack",[n.ALWAYS,0,1]),t.set("_stencilFuncSeparateFrontAndBack",[n.ALWAYS,0,1]),t.set("stencilMask",[1]),t.set("_stencilMaskSeparateFront",[1]),t.set("_stencilMaskSeparateBack",[1]),t.set("_stencilMaskSeparateFrontAndBack",[1]),t.set("stencilOp",[n.KEEP,n.KEEP,n.KEEP]),t.set("_stencilOpSeparateFront",[n.KEEP,n.KEEP,n.KEEP]),t.set("_stencilOpSeparateBack",[n.KEEP,n.KEEP,n.KEEP]),t.set("_stencilOpSeparateFrontAndBack",[n.KEEP,n.KEEP,n.KEEP]),t.set("vertexAttrib1f",[]),t.set("vertexAttrib1fv",[]),t.set("vertexAttrib2f",[]),t.set("vertexAttrib2fv",[]),t.set("vertexAttrib3f",[]),t.set("vertexAttrib3fv",[]),t.set("vertexAttrib4f",[]),t.set("vertexAttrib4fv",[])}return this._defaultSettings}static _getTextureTargetIndex(t){switch(t){case 3553:return 0;case 34067:return 1;default:throw new Error("Unknown texture target: "+t)}}static _getTextureTargetByIndex(t){return this._textureTargetIndices||(this._textureTargetIndices=[3553,34067]),this._textureTargetIndices[t]}static _getTextureIndex(t){return t-33984}static _getTextureByIndex(t){return t+33984}static _getPixelStoreiIndex(t){switch(t){case 3333:return 0;case 3317:return 1;case 37440:return 2;case 37441:return 3;case 37443:return 4;case 37445:return 5;default:throw new Error("Unknown pixelstorei: "+t)}}static _getPixelStoreiByIndex(t){return this._pixelStoreiIndices||(this._pixelStoreiIndices=[3333,3317,37440,37441,37443]),this._pixelStoreiIndices[t]}static _getDefaultPixelStoreiByIndex(t){return this._pixelStoreiDefaults||(this._pixelStoreiDefaults=[4,4,!1,!1,WebGLRenderingContext.prototype.BROWSER_DEFAULT_WEBGL]),this._pixelStoreiDefaults[t]}}class So{_initStateManager(t="default"){this._states={},this._state=this._getState(t)}_getState(t){return this._states[t]||(this._states[t]=new or(t,this)),this._states[t]}switchState(t="default"){if(this._state._id!==t){const n=this._getState(t);this._state.migrate(n),this._state=n}}$useProgram(t){this._state.setProgram(t)&&this._useProgram(t)}$bindBuffer(t,n){this._state.setBuffer(t,n)&&this._bindBuffer(t,n)}$bindFramebuffer(t,n){this._state.setFramebuffer(t,n)&&this._bindFramebuffer(t,n)}$bindRenderbuffer(t,n){this._state.setRenderbuffer(t,n)&&this._bindRenderbuffer(t,n)}$enable(t){this._state.setFlag(t,!0)&&this._enable(t)}$disable(t){this._state.setFlag(t,!1)&&this._disable(t)}$viewport(t,n,a,u){this._state.setSetting(this._viewport,[t,n,a,u])&&this._viewport(t,n,a,u)}$scissor(t,n,a,u){this._state.setSetting(this._scissor,[t,n,a,u])&&this._scissor(t,n,a,u)}$disableVertexAttribArray(t){this._state.disableVertexAttribArray(t)&&this._disableVertexAttribArray(t)}$enableVertexAttribArray(t){this._state.enableVertexAttribArray(t)&&this._enableVertexAttribArray(t)}$vertexAttribPointer(t,n,a,u,f,m){this._state.vertexAttribPointer(t,[n,a,u,f,m])&&this._vertexAttribPointer(t,n,a,u,f,m)}$activeTexture(t){this._state.setActiveTexture(t)&&this._activeTexture(t)}$bindTexture(t,n){this._state.bindTexture(t,n)&&this._bindTexture(t,n)}$pixelStorei(t,n){this._state.setPixelStorei(t,n)&&this._pixelStorei(t,n)}$stencilFuncSeparate(t,n,a,u){let f;switch(t){case this.FRONT:f=this._stencilFuncSeparateFront;break;case this.BACK:f=this._stencilFuncSeparateBack;break;case this.FRONT_AND_BACK:f=this._stencilFuncSeparateFrontAndBack;break}this._state.setSetting(f,[n,a,u])&&f.apply(this,[n,a,u])}_stencilFuncSeparateFront(t,n,a){this._stencilFuncSeparate(this.FRONT,t,n,a)}_stencilFuncSeparateBack(t,n,a){this._stencilFuncSeparate(this.BACK,t,n,a)}_stencilFuncSeparateFrontAndBack(t,n,a){this._stencilFuncSeparate(this.FRONT_AND_BACK,t,n,a)}$stencilMaskSeparate(t,n){let a;switch(t){case this.FRONT:a=this._stencilMaskSeparateFront;break;case this.BACK:a=this._stencilMaskSeparateBack;break;case this.FRONT_AND_BACK:a=this._stencilMaskSeparateFrontAndBack;break}this._state.setSetting(a,[n])&&a.apply(this,[n])}_stencilMaskSeparateFront(t){this._stencilMaskSeparate(this.FRONT,t)}_stencilMaskSeparateBack(t){this._stencilMaskSeparate(this.BACK,t)}_stencilMaskSeparateFrontAndBack(t){this._stencilMaskSeparate(this.FRONT_AND_BACK,t)}$stencilOpSeparate(t,n,a,u){let f;switch(t){case this.FRONT:f=this._stencilOpSeparateFront;break;case this.BACK:f=this._stencilOpSeparateBack;break;case this.FRONT_AND_BACK:f=this._stencilOpSeparateFrontAndBack;break}this._state.setSetting(f,[n,a,u])&&f.apply(this,[n,a,u])}_stencilOpSeparateFront(t,n,a){this._stencilOpSeparate(this.FRONT,t,n,a)}_stencilOpSeparateBack(t,n,a){this._stencilOpSeparate(this.BACK,t,n,a)}_stencilOpSeparateFrontAndBack(t,n,a){this._stencilOpSeparate(this.FRONT_AND_BACK,t,n,a)}$blendColor(t,n,a,u){this._state.setSetting(this._blendColor,[t,n,a,u])&&this._blendColor(t,n,a,u)}$blendEquation(t){this._state.setSetting(this._blendEquation,[t])&&this._blendEquation(t)}$blendEquationSeparate(t,n){this._state.setSetting(this._blendEquationSeparate,[t,n])&&this._blendEquationSeparate(t,n)}$blendFunc(t,n){this._state.setSetting(this._blendFunc,[t,n])&&this._blendFunc(t,n)}$blendFuncSeparate(t,n,a,u){this._state.setSetting(this._blendFuncSeparate,[t,n,a,u])&&this._blendFuncSeparate(t,n,a,u)}$clearColor(t,n,a,u){this._state.setSetting(this._clearColor,[t,n,a,u])&&this._clearColor(t,n,a,u)}$clearDepth(t){this._state.setSetting(this._clearDepth,[t])&&this._clearDepth(t)}$clearStencil(t){this._state.setSetting(this._clearStencil,[t])&&this._clearStencil(t)}$colorMask(t,n,a,u){this._state.setSetting(this._colorMask,[t,n,a,u])&&this._colorMask(t,n,a,u)}$cullFace(t){this._state.setSetting(this._cullFace,[t])&&this._cullFace(t)}$depthFunc(t){this._state.setSetting(this._depthFunc,[t])&&this._depthFunc(t)}$depthMask(t){this._state.setSetting(this._depthMask,[t])&&this._depthMask(t)}$depthRange(t,n){this._state.setSetting(this._depthRange,[t,n])&&this._depthRange(t,n)}$frontFace(t){this._state.setSetting(this._frontFace,[t])&&this._frontFace(t)}$lineWidth(t){this._state.setSetting(this._lineWidth,[t])&&this._lineWidth(t)}$polygonOffset(t,n){this._state.setSetting(this._polygonOffset,[t,n])&&this._polygonOffset(t,n)}$sampleCoverage(t,n){this._state.setSetting(this._sampleCoverage,[t,n])&&this._sampleCoverage(t,n)}$stencilFunc(t,n,a){this._state.setSetting(this._stencilFunc,[t,n,a])&&this._stencilFunc(t,n,a)}$stencilMask(t){this._state.setSetting(this._stencilMask,[t])&&this._stencilMask(t)}$stencilOp(t,n,a){this._state.setSetting(this._stencilOp,[t,n,a])&&this._stencilOp(t,n,a)}$vertexAttrib1f(t,n){this._state.setSetting(this._vertexAttrib1f,[t,n])&&this._vertexAttrib1f(t,n)}$vertexAttrib1fv(t,n){this._state.setSetting(this._vertexAttrib1fv,[t,n])&&this._vertexAttrib1fv(t,n)}$vertexAttrib2f(t,n,a){this._state.setSetting(this._vertexAttrib2f,[t,n,a])&&this._vertexAttrib2f(t,n,a)}$vertexAttrib2fv(t,n){this._state.setSetting(this._vertexAttrib2fv,[t,n])&&this._vertexAttrib2fv(t,n)}$vertexAttrib3f(t,n,a,u){this._state.setSetting(this._vertexAttrib3f,[t,n,a,u])&&this._vertexAttrib3f(t,n,a,u)}$vertexAttrib3fv(t,n){this._state.setSetting(this._vertexAttrib3fv,[t,n])&&this._vertexAttrib3fv(t,n)}$vertexAttrib4f(t,n,a,u,f){this._state.setSetting(this._vertexAttrib4f,[t,n,a,u,f])&&this._vertexAttrib4f(t,n,a,u,f)}$vertexAttrib4fv(t,n){this._state.setSetting(this._vertexAttrib4fv,[t,n])&&this._vertexAttrib4fv(t,n)}static enable(t,n="default"){const a=Object.getOwnPropertyNames(So.prototype);return t.__proto__,a.forEach(u=>{if(u!=="constructor"){const f=So.prototype[u];u.charAt(0)==="$"&&(u=u.substr(1)),t[u]!==f&&(t[u]&&(t[u].name||(t[u].xname=u),t["_"+u]=t[u]),t[u]=f)}}),So.prototype._initStateManager.call(t,n),t}}class kb{constructor(t){this.stage=t,this._usedMemory=0,this._uploadedTextureSources=[],this.textureSourceHashmap=new Map}get usedMemory(){return this._usedMemory}destroy(){for(let t=0,n=this._uploadedTextureSources.length;t<n;t++)this._nativeFreeTextureSource(this._uploadedTextureSources[t]);this.textureSourceHashmap.clear(),this._usedMemory=0}getReusableTextureSource(t){return this.textureSourceHashmap.get(t)}getTextureSource(t,n){let a=n?this.textureSourceHashmap.get(n):null;return a||(a=new us(this,t),n&&(a.lookupId=n,this.textureSourceHashmap.set(n,a))),a}uploadTextureSource(t,n){if(t.isLoaded())return;this._addMemoryUsage(t.w*t.h);const a=this._nativeUploadTextureSource(t,n);t._nativeTexture=a,a.w=t.w,a.h=t.h,a.update=this.stage.frameCounter,this._uploadedTextureSources.push(t),this.addToLookupMap(t),this._updateVramUsage(t,1)}_addMemoryUsage(t){this._usedMemory+=t,this.stage.addMemoryUsage(t)}_updateVramUsage(t,n){const a=t.nativeTexture;var u;pn.isWebglSupported()&&t.isLoaded()&&(!a.hasOwnProperty("bytesPerPixel")||isNaN(a.bytesPerPixel)||(u=n*(t.w*t.h*a.bytesPerPixel),this.stage.addVramUsage(u,t.hasAlpha)))}addToLookupMap(t){const n=t.lookupId;n&&(this.textureSourceHashmap.has(n)||this.textureSourceHashmap.set(n,t))}gc(){this.freeUnusedTextureSources(),this._cleanupLookupMap()}freeUnusedTextureSources(){let t=[];for(let n=0,a=this._uploadedTextureSources.length;n<a;n++){let u=this._uploadedTextureSources[n];u.allowCleanup()?this._freeManagedTextureSource(u):t.push(u)}this._uploadedTextureSources=t,this._cleanupLookupMap()}_freeManagedTextureSource(t){t.isLoaded()&&(this._nativeFreeTextureSource(t),this._addMemoryUsage(-t.w*t.h),this._updateVramUsage(t,-1)),t.loadingSince=null}_cleanupLookupMap(){this.textureSourceHashmap.forEach((t,n)=>{!(t.isLoaded()||t.isLoading())&&!t.isUsed()&&this.textureSourceHashmap.delete(n)})}freeTextureSource(t){const n=this._uploadedTextureSources.indexOf(t),a=n!==-1;t.isLoaded()&&(a&&(this._addMemoryUsage(-t.w*t.h),this._uploadedTextureSources.splice(n,1)),this._nativeFreeTextureSource(t)),t.loadingSince=null}_nativeUploadTextureSource(t,n){return this.stage.renderer.uploadTextureSource(t,n)}_nativeFreeTextureSource(t){this.stage.renderer.freeTextureSource(t),t.clearNativeTexture()}}class iu{constructor(t){this.stage=t,this.genericCancelCb=n=>{this._remove(n)},this._sources=[],this._data=[]}destroy(){this._sources=[],this._data=[]}processSome(){if(this._sources.length){const t=Date.now();do this._processItem();while(this._sources.length&&Date.now()-t<iu.MAX_UPLOAD_TIME_PER_FRAME)}}_processItem(){const t=this._sources.pop(),n=this._data.pop();t.isLoading()&&t.processLoadedSource(n)}add(t,n){this._sources.push(t),this._data.push(n)}_remove(t){const n=this._sources.indexOf(t);n>=0&&(this._sources.splice(n,1),this._data.splice(n,1))}}iu.MAX_UPLOAD_TIME_PER_FRAME=10;class Db{constructor(t){this.stage=t,this.root=null,this.updateTreeOrder=0,this.renderState=this.stage.renderer.createCoreRenderState(this),this.renderExec=this.stage.renderer.createCoreRenderExecutor(this),this.renderExec.init(),this._usedMemory=0,this._renderTexturePool=[],this._renderTextureId=1,this._zSorts=[],this.renderToTextureCount=0}get usedMemory(){return this._usedMemory}destroy(){this._renderTexturePool.forEach(t=>this._freeRenderTexture(t)),this._usedMemory=0}hasRenderUpdates(){return!!this.root._parent._hasRenderUpdates}render(){this.root._parent._hasRenderUpdates=0,this._render()}update(){this._update(),this.root._hasUpdates&&this._update(),this._performForcedZSorts()}_performForcedZSorts(){if(this._zSorts.length){for(let n=0,a=this._zSorts.length;n<a;n++)this._zSorts[n].zSort&&this._zSorts[n].sortZIndexedChildren();this._zSorts=[]}}_update(){this.updateTreeOrder=0,this.root.update()}_render(){const t=this.stage.getOption("debugFrame");this._fillRenderState(),this.stage.getOption("readPixelsBeforeDraw")&&this._readPixels(),this._performRender(),t&&console.log(`[Lightning] RTT Renders in frame: ${this.renderToTextureCount}`),this.stage.getOption("readPixelsAfterDraw")&&this.renderToTextureCount>=this.stage.getOption("readPixelsAfterDrawThreshold")&&(t&&console.log("[Lightning] readPixelsAfterDraw behavior triggered"),this._readPixels()),this.renderToTextureCount=0}_readPixels(){const t=new Uint8Array(4),n=this.stage.gl;n.readPixels(0,0,1,1,n.RGBA,n.UNSIGNED_BYTE,t)}_fillRenderState(){this.renderState.reset(),this.root.render(),this.renderState.finish()}_performRender(){this.renderExec.execute()}_addMemoryUsage(t){this._usedMemory+=t,this.stage.addMemoryUsage(t)}allocateRenderTexture(t,n){let a=this.stage.getRenderPrecision(),u=Math.max(1,Math.round(t*a)),f=Math.max(1,Math.round(n*a));const m=this._renderTexturePool.length;for(let x=m-1;x>=0;x--){const T=this._renderTexturePool[x];if(T.w===u&&T.h===f&&T.update!==this.stage.frameCounter)return T.f=this.stage.frameCounter,this._renderTexturePool.splice(x,1),T}const p=this._createRenderTexture(t,n,u,f);return p.precision=a,p}releaseRenderTexture(t){this._renderTexturePool.push(t)}freeUnusedRenderTextures(t=60){let n=this.stage.frameCounter-t;this._renderTexturePool=this._renderTexturePool.filter(a=>a.f<=n?(this._freeRenderTexture(a),!1):!0)}_createRenderTexture(t,n,a,u){this._addMemoryUsage(a*u);const f=this.stage.renderer.createRenderTexture(t,n,a,u);return f.id=this._renderTextureId++,f.f=this.stage.frameCounter,f.ow=t,f.oh=n,f.w=a,f.h=u,f}_freeRenderTexture(t){this.stage.renderer.freeRenderTexture(t),this._addMemoryUsage(-t.w*t.h)}copyRenderTexture(t,n,a){this.stage.renderer.copyRenderTexture(t,n,a)}forceZSort(t){this._zSorts.push(t)}}class wd{constructor(t){this.stage=t,this._timingFunction="ease",this._timingFunctionImpl=ye.getTimingFunction(this._timingFunction),this.delay=0,this.duration=.2,this.merger=null}get timingFunction(){return this._timingFunction}set timingFunction(t){this._timingFunction=t,this._timingFunctionImpl=ye.getTimingFunction(t)}get timingFunctionImpl(){return this._timingFunctionImpl}patch(t){Ct.patchObject(this,t)}}wd.prototype.isTransitionSettings=!0;class Ob{constructor(t){this.stage=t,this.stage.on("frameStart",()=>this.progress()),this.active=new Set,this.defaultTransitionSettings=new wd(this.stage)}progress(){if(this.active.size){let t=this.stage.dt,n=!1;this.active.forEach(function(a){a.progress(t),a.isRunning()||(n=!0)}),n&&(this.active=new Set([...this.active].filter(a=>a.isRunning())))}}createSettings(t){const n=new wd;return Ct.patchObject(n,t),n}addActive(t){this.active.add(t)}removeActive(t){this.active.delete(t)}}class ct{constructor(){this._clear()}_clear(){this._p=[],this._pe=[],this._idp=[],this._f=[],this._v=[],this._lv=[],this._sm=[],this._s=[],this._ve=[],this._sme=[],this._se=[],this._length=0}parse(t,n){let a,u;X.isObjectLiteral(n)||(n={0:n});let f=.5,m=[];for(let p in n)if(n.hasOwnProperty(p)){let x=n[p];X.isObjectLiteral(x)||(x={v:x});let T=parseFloat(p);p==="sm"?f=x.v:!isNaN(T)&&T>=0&&T<=2&&(x.p=T,x.f=X.isFunction(x.v),x.lv=x.f?x.v(0,0):x.v,m.push(x))}for(m=m.sort(function(p,x){return p.p-x.p}),u=m.length,a=0;a<u;a++){let p=a===u-1;if(!m[a].hasOwnProperty("pe"))m[a].pe=p?m[a].p<=1?1:2:m[a+1].p;else{const x=a<u-1?m[a+1].p:1;m[a].pe>x&&(m[a].pe=x)}m[a].pe===m[a].p?m[a].idp=0:m[a].idp=1/(m[a].pe-m[a].p)}for(a=0;a<u;a++)if(m[a].hasOwnProperty("sm")||(m[a].sm=f),!m[a].hasOwnProperty("s"))if(a===0||a===u-1||m[a].p===1)m[a].s=t?[0,0,0,0]:0;else{const p=m[a-1],x=m[a+1];if(p.p===x.p)m[a].s=t?[0,0,0,0]:0;else if(t){const T=ct.getRgbaComponents(x.lv),A=ct.getRgbaComponents(p.lv),b=1/(x.p-p.p);m[a].s=[b*(T[0]-A[0]),b*(T[1]-A[1]),b*(T[2]-A[2]),b*(T[3]-A[3])]}else m[a].s=(x.lv-p.lv)/(x.p-p.p)}for(a=0;a<u-1;a++)if(!m[a].f){let p=a===u-1;m[a].hasOwnProperty("ve")||(m[a].ve=p?m[a].lv:m[a+1].lv),X.isNumber(m[a].v)&&X.isNumber(m[a].lv)&&(m[a].hasOwnProperty("sme")||(m[a].sme=p?f:m[a+1].sm),m[a].hasOwnProperty("se")||(m[a].se=p?t?[0,0,0,0]:0:m[a+1].s),t?m[a].v=ct.getSplineRgbaValueFunction(m[a].v,m[a].ve,m[a].p,m[a].pe,m[a].sm,m[a].sme,m[a].s,m[a].se):m[a].v=ct.getSplineValueFunction(m[a].v,m[a].ve,m[a].p,m[a].pe,m[a].sm,m[a].sme,m[a].s,m[a].se),m[a].f=!0)}for(this.length&&this._clear(),a=0,u=m.length;a<u;a++)this._add(m[a])}_add(t){this._p.push(t.p||0),this._pe.push(t.pe||0),this._idp.push(t.idp||0),this._f.push(t.f||!1),this._v.push(t.hasOwnProperty("v")?t.v:0),this._lv.push(t.lv||0),this._sm.push(t.sm||0),this._s.push(t.s||0),this._ve.push(t.ve||0),this._sme.push(t.sme||0),this._se.push(t.se||0),this._length++}_getItem(t){const n=this._length;if(!n)return-1;if(t<this._p[0])return 0;for(let a=0;a<n;a++)if(this._p[a]<=t&&t<this._pe[a])return a;return n-1}getValue(t){const n=this._getItem(t);if(n!==-1)if(this._f[n]){const a=Math.min(1,Math.max(0,(t-this._p[n])*this._idp[n]));return this._v[n](a)}else return this._v[n]}get length(){return this._length}static getRgbaComponents(t){let n=(t/65536|0)%256,a=(t/256|0)%256,u=t%256,f=t/16777216|0;return[n,a,u,f]}static getSplineValueFunction(t,n,a,u,f,m,p,x){let T=u-a;p*=T,x*=T;let A=ct.getSplineHelpers(t,n,f,m,p,x);return A?function(b){return b===0?t:b===1?n:ct.calculateSpline(A,b)}:function(b){return b===0?t:b===1?n:n*b+t*(1-b)}}static getSplineRgbaValueFunction(t,n,a,u,f,m,p,x){let T=u-a;p[0]*=T,p[1]*=T,p[2]*=T,p[3]*=T,x[0]*=T,x[1]*=T,x[2]*=T,x[3]*=T;let A=ct.getRgbaComponents(t),b=ct.getRgbaComponents(n),I=[ct.getSplineHelpers(A[0],b[0],f,m,p[0],x[0]),ct.getSplineHelpers(A[1],b[1],f,m,p[1],x[1]),ct.getSplineHelpers(A[2],b[2],f,m,p[2],x[2]),ct.getSplineHelpers(A[3],b[3],f,m,p[3],x[3])];return I[0]?function(D){return D===0?t:D===1?n:ct.getArgbNumber([Math.min(255,ct.calculateSpline(I[0],D)),Math.min(255,ct.calculateSpline(I[1],D)),Math.min(255,ct.calculateSpline(I[2],D)),Math.min(255,ct.calculateSpline(I[3],D))])}:function(D){return D===0?t:D===1?n:ct.mergeColors(n,t,D)}}static getSplineHelpers(t,n,a,u,f,m){if(!a&&!u)return null;let p=a,x=t+f*a,T=1-u,A=n-m*u,b=3*p-3*T+1,I=-6*p+3*T,D=3*p,v=3*x-3*A+n-t,O=3*(A+t)-6*x,W=3*(x-t);return[b,I,D,v,O,W,t]}static calculateSpline(t,n){let a=t[0],u=t[1],f=t[2],m=t[3],p=t[4],x=t[5],T=t[6];if(a===-2&&m===-2&&f===0&&x===0)return n;let A=.5,b,I;for(let O=0;O<20;O++){if(b=A*(A*(A*a+u)+f),I=n-b,I>-1e-8&&I<1e-8)return A*(A*(A*m+p)+x)+T;let W=A*(A*(3*a)+2*u)+f;if(W>1e-10&&W<1e-10)break;A+=I/W}let D=0,v=1;for(let O=0;O<20;O++){if(A=.5*(D+v),b=A*(A*(A*a+u)+f),I=n-b,I>-1e-8&&I<1e-8)return A*(A*(A*m+p)+x)+T;I<0?v=A:D=A}return A}static mergeColors(t,n,a){let u=(t/65536|0)%256,f=(t/256|0)%256,m=t%256,p=t/16777216|0,x=(n/65536|0)%256,T=(n/256|0)%256,A=n%256,b=n/16777216|0,I=u*a+x*(1-a),D=f*a+T*(1-a),v=m*a+A*(1-a),O=p*a+b*(1-a);return Math.round(O)*16777216+Math.round(I)*65536+Math.round(D)*256+Math.round(v)}static getArgbNumber(t){t[0]=Math.max(0,Math.min(255,t[0])),t[1]=Math.max(0,Math.min(255,t[1])),t[2]=Math.max(0,Math.min(255,t[2])),t[3]=Math.max(0,Math.min(255,t[3]));let n=((t[3]|0)<<24)+((t[0]|0)<<16)+((t[1]|0)<<8)+(t[2]|0);return n<0&&(n=4294967295+n+1),n}}class Gv{constructor(t){this.animationSettings=t,this._selector="",this._items=new ct,this._props=[],this._propSetters=[],this._resetValue=void 0,this._hasResetValue=!1,this._hasColorProperty=void 0}getResetValue(){return this._hasResetValue?this._resetValue:this._items.getValue(0)}apply(t,n,a){const u=this.getAnimatedElements(t);let f=this._items.getValue(n);if(f===void 0||!u.length)return;if(a!==1){let x=this.getResetValue();X.isNumber(f)&&X.isNumber(x)&&(this.hasColorProperty()?f=ye.mergeColors(f,x,a):f=ye.mergeNumbers(f,x,a))}const m=this._propSetters.length,p=u.length;for(let x=0;x<p;x++)for(let T=0;T<m;T++)this._propSetters[T](u[x],f)}getAnimatedElements(t){return t.select(this._selector)}reset(t){const n=this.getAnimatedElements(t);let a=this.getResetValue();if(a===void 0||!n.length)return;const u=this._propSetters.length,f=n.length;for(let m=0;m<f;m++)for(let p=0;p<u;p++)this._propSetters[p](n[m],a)}set selector(t){this._selector=t}set t(t){this.selector=t}get resetValue(){return this._resetValue}set resetValue(t){this._resetValue=t,this._hasResetValue=t!==void 0}set rv(t){this.resetValue=t}set value(t){this._items.parse(this.hasColorProperty(),t)}set v(t){this.value=t}set properties(t){Array.isArray(t)||(t=[t]),this._props=[],t.forEach(n=>{this._props.push(n),this._propSetters.push(Yt.getSetter(n))})}set property(t){this._hasColorProperty=void 0,this.properties=t}set p(t){this.properties=t}patch(t){Ct.patchObject(this,t)}hasColorProperty(){return this._hasColorProperty===void 0&&(this._hasColorProperty=this._props.length?Yt.isColorProperty(this._props[0]):!1),this._hasColorProperty}}Gv.prototype.isAnimationActionSettings=!0;class zt{constructor(){this._actions=[],this.delay=0,this.duration=1,this.repeat=0,this.repeatOffset=0,this.repeatDelay=0,this.autostop=!1,this.stopMethod=zt.STOP_METHODS.FADE,this._stopTimingFunction="ease",this._stopTimingFunctionImpl=ye.getTimingFunction(this._stopTimingFunction),this.stopDuration=0,this.stopDelay=0}get actions(){return this._actions}set actions(t){this._actions=[];for(let n=0,a=t.length;n<a;n++){const u=t[n];if(u.isAnimationActionSettings)this._actions.push(u);else{const f=new Gv(this);f.patch(u),this._actions.push(f)}}}apply(t,n,a=1){this._actions.forEach(function(u){u.apply(t,n,a)})}reset(t){this._actions.forEach(function(n){n.reset(t)})}get stopTimingFunction(){return this._stopTimingFunction}set stopTimingFunction(t){this._stopTimingFunction=t,this._stopTimingFunctionImpl=ye.getTimingFunction(t)}get stopTimingFunctionImpl(){return this._stopTimingFunctionImpl}patch(t){Ct.patchObject(this,t)}}zt.STOP_METHODS={FADE:"fade",REVERSE:"reverse",FORWARD:"forward",IMMEDIATE:"immediate",ONETOTWO:"onetotwo"};class Ie extends at{constructor(t,n,a){super(),this.manager=t,this._settings=n,this._element=a,this._state=Ie.STATES.IDLE,this._p=0,this._delayLeft=0,this._repeatsLeft=0,this._stopDelayLeft=0,this._stopP=0}start(){this._element&&this._element.attached?(this._p=0,this._delayLeft=this.settings.delay,this._repeatsLeft=this.settings.repeat,this._state=Ie.STATES.PLAYING,this.emit("start"),this.checkActive()):console.warn("[Lightning] Element must be attached before starting animation")}play(){this._state===Ie.STATES.PAUSED?(this._state=Ie.STATES.PLAYING,this.checkActive(),this.emit("resume")):this._state==Ie.STATES.STOPPING&&this.settings.stopMethod==zt.STOP_METHODS.REVERSE?(this._state=Ie.STATES.PLAYING,this.emit("stopContinue")):this._state!=Ie.STATES.PLAYING&&this._state!=Ie.STATES.FINISHED&&this.start()}pause(){this._state===Ie.STATES.PLAYING&&(this._state=Ie.STATES.PAUSED,this.emit("pause"))}replay(){this._state==Ie.STATES.FINISHED?this.start():this.play()}skipDelay(){this._delayLeft=0,this._stopDelayLeft=0}finish(){this._state===Ie.STATES.PLAYING?(this._delayLeft=0,this._p=1):this._state===Ie.STATES.STOPPING&&(this._stopDelayLeft=0,this._p=0)}stop(){this._state===Ie.STATES.STOPPED||this._state===Ie.STATES.IDLE||(this._stopDelayLeft=this.settings.stopDelay||0,this.settings.stopMethod===zt.STOP_METHODS.IMMEDIATE&&!this._stopDelayLeft||this._delayLeft>0?(this._state=Ie.STATES.STOPPING,this.emit("stop")):(this.settings.stopMethod===zt.STOP_METHODS.FADE&&(this._stopP=0),this._state=Ie.STATES.STOPPING,this.emit("stop")),this.checkActive())}stopNow(){(this._state!==Ie.STATES.STOPPED||this._state!==Ie.STATES.IDLE)&&(this._state=Ie.STATES.STOPPING,this._p=0,this.emit("stop"),this.reset(),this._state=Ie.STATES.STOPPED,this.emit("stopFinish"))}isPaused(){return this._state===Ie.STATES.PAUSED}isPlaying(){return this._state===Ie.STATES.PLAYING}isStopping(){return this._state===Ie.STATES.STOPPING}isFinished(){return this._state===Ie.STATES.FINISHED}checkActive(){this.isActive()&&this.manager.addActive(this)}isActive(){return(this._state==Ie.STATES.PLAYING||this._state==Ie.STATES.STOPPING)&&this._element&&this._element.attached}progress(t){this._element&&(this._progress(t),this.apply())}_progress(t){if(this._state==Ie.STATES.STOPPING){this._stopProgress(t);return}if(this._state==Ie.STATES.PLAYING){if(this._delayLeft>0)if(this._delayLeft-=t,this._delayLeft<0)t=-this._delayLeft,this._delayLeft=0,this.emit("delayEnd");else return;this.settings.duration===0?this._p=1:this.settings.duration>0&&(this._p+=t/this.settings.duration),this._p>=1?this.settings.repeat==-1||this._repeatsLeft>0?(this._repeatsLeft>0&&this._repeatsLeft--,this._p=this.settings.repeatOffset,this.emit("progress",this._p),this.settings.repeatDelay&&(this._delayLeft=this.settings.repeatDelay),this.emit("repeat",this._repeatsLeft)):(this._p=1,this.emit("progress",this._p),this._state=Ie.STATES.FINISHED,this.emit("finish"),this.settings.autostop&&this.stop()):this.emit("progress",this._p)}}_stopProgress(t){let n=this._getStopDuration();if(this._stopDelayLeft>0)if(this._stopDelayLeft-=t,this._stopDelayLeft<0)t=-this._stopDelayLeft,this._stopDelayLeft=0,this.emit("stopDelayEnd");else return;this.settings.stopMethod==zt.STOP_METHODS.IMMEDIATE?(this._state=Ie.STATES.STOPPED,this.emit("stopFinish")):this.settings.stopMethod==zt.STOP_METHODS.REVERSE?(n===0?this._p=0:n>0&&(this._p-=t/n),this._p<=0&&(this._p=0,this._state=Ie.STATES.STOPPED,this.emit("stopFinish"))):this.settings.stopMethod==zt.STOP_METHODS.FADE?(this._progressStopTransition(t),this._stopP>=1&&(this._p=0,this._state=Ie.STATES.STOPPED,this.emit("stopFinish"))):this.settings.stopMethod==zt.STOP_METHODS.ONETOTWO?this._p<2&&(n===0?this._p=2:n>0&&(this._p<1?this._p+=t/this.settings.duration:this._p+=t/n),this._p>=2?(this._p=2,this._state=Ie.STATES.STOPPED,this.emit("stopFinish")):this.emit("progress",this._p)):this.settings.stopMethod==zt.STOP_METHODS.FORWARD&&this._p<1&&(this.settings.duration==0?this._p=1:this._p+=t/this.settings.duration,this._p>=1?this.settings.stopMethod==zt.STOP_METHODS.FORWARD?(this._p=1,this._state=Ie.STATES.STOPPED,this.emit("stopFinish")):this._repeatsLeft>0?(this._repeatsLeft--,this._p=0,this.emit("repeat",this._repeatsLeft)):(this._p=1,this._state=Ie.STATES.STOPPED,this.emit("stopFinish")):this.emit("progress",this._p))}_progressStopTransition(t){if(this._stopP<1){if(this._stopDelayLeft>0)if(this._stopDelayLeft-=t,this._stopDelayLeft<0)t=-this._stopDelayLeft,this._stopDelayLeft=0,this.emit("delayEnd");else return;const n=this._getStopDuration();n==0?this._stopP=1:this._stopP+=t/n,this._stopP>=1&&(this._stopP=1)}}_getStopDuration(){return this.settings.stopDuration||this.settings.duration}apply(){if(this._state===Ie.STATES.STOPPED)this.reset();else{let t=1;this._state===Ie.STATES.STOPPING&&this.settings.stopMethod===zt.STOP_METHODS.FADE&&(t=1-this.settings.stopTimingFunctionImpl(this._stopP)),this._settings.apply(this._element,this._p,t)}}reset(){this._settings.reset(this._element)}get state(){return this._state}get p(){return this._p}get delayLeft(){return this._delayLeft}get element(){return this._element}get frame(){return Math.round(this._p*this._settings.duration*60)}get settings(){return this._settings}}Ie.STATES={IDLE:0,PLAYING:1,STOPPING:2,STOPPED:3,FINISHED:4,PAUSED:5};class Fb{constructor(t){this.stage=t,this.stage.on("frameStart",()=>this.progress()),this.active=new Set}progress(){if(this.active.size){let t=this.stage.dt,n=!1;this.active.forEach(function(a){a.isActive()?a.progress(t):n=!0}),n&&(this.active=new Set([...this.active].filter(a=>a.isActive())))}}createAnimation(t,n){return X.isObjectLiteral(n)&&(n=this.createSettings(n)),new Ie(this,n,t)}createSettings(t){const n=new zt;return Ct.patchObject(n,t),n}addActive(t){this.active.add(t)}}class Xv extends Zt{_getLookupId(){return"__whitepix"}_getSourceLoader(){return function(t){var n=new Uint8Array([255,255,255,255]);t(null,{source:n,w:1,h:1,permanent:!0})}}isAutosizeTexture(){return!1}}class pn extends at{constructor(t={}){super(),this._setOptions(t),this._usedMemory=0,this._lastGcFrame=0,this._usedVramAlpha=0,this._usedVramNonAlpha=0;const n=pn.platform?pn.platform:Pb.load(t);this.platform=new n,this.platform.init&&this.platform.init(this),this.gl=null,this.c2d=null;const a=this.getOption("context");a?a.useProgram?this.gl=a:this.c2d=a:X.isWeb&&(!pn.isWebglSupported()||this.getOption("canvas2d"))?this.c2d=this.platform.createCanvasContext(this.getOption("w"),this.getOption("h")):this.gl=this.platform.createWebGLContext(this.getOption("w"),this.getOption("h")),this.gl&&So.enable(this.gl,"lightning"),this._mode=this.gl?0:1,this.getCanvas()&&(this._options.w=this.getCanvas().width,this._options.h=this.getCanvas().height),this._mode===0?X.isSpark?this._renderer=new bb(this):this._renderer=new Wv(this):this._renderer=new Cb(this),this.setClearColor(this.getOption("clearColor")),this.frameCounter=0,this.transitions=new Ob(this),this.animations=new Fb(this),this.textureManager=new kb(this),this.textureThrottler=new iu(this),this.startTime=0,this.currentTime=0,this.dt=0,this.rectangleTexture=new Xv(this),this.rectangleTexture.load(),this.rectangleTexture.source.permanent=!0,this.ctx=new Db(this),this._updateSourceTextures=new Set}get renderer(){return this._renderer}static isWebglSupported(){if(X.isNode)return!0;try{return!!window.WebGLRenderingContext}catch(t){return!1}}get mode(){return this._mode}isWebgl(){return this.mode===0}isC2d(){return this.mode===1}getOption(t){return this._options[t]}_setOptions(t){this._options={};let n=(a,u)=>{let f=t[a];f===void 0?this._options[a]=u:this._options[a]=f};n("canvas",null),n("context",null),n("w",1920),n("h",1080),n("srcBasePath",null),n("memoryPressure",24e6),n("bufferMemory",2e6),n("textRenderIssueMargin",0),n("fontSharp",{precision:.6666666667,fontSize:24}),n("clearColor",[0,0,0,0]),n("defaultFontFace","sans-serif"),n("fixedDt",0),n("useImageWorker",!0),n("autostart",!0),n("precision",1),n("canvas2d",!1),n("platform",null),n("readPixelsBeforeDraw",!1),n("readPixelsAfterDraw",!1),n("readPixelsAfterDrawThreshold",0),n("debugFrame",!1),n("forceTxCanvasSource",!1),n("pauseRafLoopOnIdle",!1)}setApplication(t){this.application=t}init(){this.application.getOption("debug")&&this.platform._imageWorker&&console.log("[Lightning] Using image worker!"),this.application.getOption("debug")&&this.c2d&&console.log("[Lightning] Using canvas2d renderer"),this.application.setAsRoot(),this.getOption("autostart")&&this.platform.startLoop()}destroy(){this.platform.stopLoop(),this.platform.destroy(),this.ctx.destroy(),this.textureManager.destroy(),this._renderer.destroy()}stop(){this.platform.stopLoop()}resume(){this.platform.startLoop()}get root(){return this.application}getCanvas(){return this._mode?this.c2d.canvas:this.gl.canvas}getRenderPrecision(){return this._options.precision}addUpdateSourceTexture(t){this._updatingFrame?t._performUpdateSource():this._updateSourceTextures.add(t)}removeUpdateSourceTexture(t){this._updateSourceTextures&&this._updateSourceTextures.delete(t)}hasUpdateSourceTexture(t){return this._updateSourceTextures&&this._updateSourceTextures.has(t)}_performUpdateSource(){this._updateSourceTextures.size&&(this._updateSourceTextures.forEach(t=>{t._performUpdateSource()}),this._updateSourceTextures=new Set)}_calculateDt(){this.startTime=this.currentTime,this.currentTime=this.platform.getHrTime(),this._options.fixedDt?this.dt=this._options.fixedDt:this.dt=this.startTime?.001*(this.currentTime-this.startTime):.02}updateFrame(){this._calculateDt(),this.emit("frameStart"),this._performUpdateSource(),this.emit("update")}idleFrame(){this.textureThrottler.processSome(),this.emit("frameEnd"),this.frameCounter++}renderFrame(){const t=this.ctx.hasRenderUpdates();this.textureThrottler.processSome(),t&&(this._updatingFrame=!0,this.ctx.update(),this.ctx.render(),this._updatingFrame=!1),this.platform.nextFrame(t),this.emit("frameEnd"),this.frameCounter++}isUpdatingFrame(){return this._updatingFrame}drawFrame(){this.updateFrame(),this.renderFrame()}forceRenderUpdate(){this.root&&this.root.core._parent.setHasRenderUpdates(1)}setClearColor(t){this.forceRenderUpdate(),t===null?this._clearColor=null:Array.isArray(t)?this._clearColor=t:this._clearColor=ye.getRgbaComponentsNormalized(t)}getClearColor(){return this._clearColor}createElement(t){return t?this.element(t):new Yt(this)}createShader(t){return ko.create(this,t)}element(t){if(t.isElement)return t;let n;return t.type?n=new t.type(this):n=new Yt(this),n.patch(t),n}c(t){return this.element(t)}get w(){return this._options.w}get h(){return this._options.h}get coordsWidth(){return this.w/this._options.precision}get coordsHeight(){return this.h/this._options.precision}addMemoryUsage(t){this._usedMemory+=t,this._lastGcFrame!==this.frameCounter&&this._usedMemory>this.getOption("memoryPressure")&&(this.gc(!1),this._usedMemory>this.getOption("memoryPressure")-2e6&&this.gc(!0))}get usedMemory(){return this._usedMemory}addVramUsage(t,n){n?this._usedVramAlpha+=t:this._usedVramNonAlpha+=t}get usedVramAlpha(){return this._usedVramAlpha}get usedVramNonAlpha(){return this._usedVramNonAlpha}get usedVram(){return this._usedVramAlpha+this._usedVramNonAlpha}gc(t){if(this._lastGcFrame!==this.frameCounter){this._lastGcFrame=this.frameCounter;const n=this._usedMemory;if(this.gcTextureMemory(t),this.gcRenderTextureMemory(t),this.renderer.gc(t),this.application.getOption("debug")){console.log(`[Lightning] GC${t?"[aggressive]":""}! Frame ${this._lastGcFrame} Freed ${((n-this._usedMemory)/1e6).toFixed(2)}MP from GPU memory. Remaining: ${(this._usedMemory/1e6).toFixed(2)}MP`);const a=this._usedMemory-this.textureManager.usedMemory-this.ctx.usedMemory;console.log(`[Lightning] Textures: ${(this.textureManager.usedMemory/1e6).toFixed(2)}MP, Render Textures: ${(this.ctx.usedMemory/1e6).toFixed(2)}MP, Renderer caches: ${(a/1e6).toFixed(2)}MP`)}}}gcTextureMemory(t=!1){t&&this.ctx.root.visible?(this.ctx.root.visible=!1,this.textureManager.gc(),this.ctx.root.visible=!0):this.textureManager.gc()}gcRenderTextureMemory(t=!1){t&&this.root.visible?(this.root.visible=!1,this.ctx.freeUnusedRenderTextures(0),this.root.visible=!0):this.ctx.freeUnusedRenderTextures(0)}getDrawingCanvas(){return this.platform.getDrawingCanvas()}update(){this.ctx.update()}addServiceProvider(t){X.isSpark&&this.platform.addServiceProvider(t)}getChildrenByPosition(t,n){const a=[];return this.root.core.update(),this.root.core.collectAtCoord(t,n,a),a}}let Nb=class ln extends mt{constructor(t={},n){ln._temp_options=t,ln.booting=!0;const a=new pn(t.stage);super(a,n),ln.booting=!1,this.__updateFocusCounter=0,this.__keypressTimers=new Map,this.__hoveredChild=null,this.stage.init(),this.updateFocusSettings(),this.__keymap=this.getOption("keys"),this.__keymap&&(this.stage.platform.registerKeydownHandler(u=>{this._receiveKeydown(u)}),this.stage.platform.registerKeyupHandler(u=>{this._receiveKeyup(u)})),this.getOption("enablePointer")&&(this.stage.platform.registerClickHandler(u=>{this._receiveClick(u)}),this.stage.platform.registerHoverHandler(u=>{this._receiveHover(u)}),this.stage.platform.registerScrollWheelHandler(u=>{this._recieveScrollWheel(u)}),this.cursor="default")}getOption(t){return this.__options[t]}_setOptions(t){this.__options={};let n=(a,u)=>{let f=t[a];f===void 0?this.__options[a]=u:this.__options[a]=f};n("debug",!1),n("keys",{38:"Up",40:"Down",37:"Left",39:"Right",13:"Enter",8:"Back",27:"Exit"}),n("enablePointer",!1)}__construct(){this.stage.setApplication(this),this._setOptions(ln._temp_options),delete ln._temp_options,super.__construct()}__init(){super.__init(),this.__updateFocus()}updateFocusPath(){this.__updateFocus()}__updateFocus(){const t=this.__updateFocusRec();!ln.booting&&t&&this.updateFocusSettings()}__updateFocusRec(){const t=++this.__updateFocusCounter;this.__updateFocusId=t;const n=this.__getFocusPath(),a=n[n.length-1],u=this._focusPath?this._focusPath[this._focusPath.length-1]:void 0;if(u){let f=Math.min(this._focusPath.length,n.length),m;for(m=0;m<f&&this._focusPath[m]===n[m];m++);if(this._focusPath.length!==n.length||m!==n.length){this.getOption("debug")&&console.log("[Lightning] Focus changed: "+a.getLocationString());for(let p=this._focusPath.length-1;p>=m;p--)if(this._focusPath.pop()._unfocus(a,u),this.__updateFocusId!==t)return!1;for(let p=m,x=n.length;p<x;p++)if(this._focusPath.push(n[p]),this._focusPath[p]._focus(a,u),this.__updateFocusId!==t)return!1;for(let p=0;p<m;p++)this._focusPath[p]._focusChange(a,u)}}else{this._focusPath=[];for(let f=0,m=n.length;f<m;f++)if(this._focusPath.push(n[f]),this._focusPath[f]._focus(a,void 0),this.__updateFocusId!==t)return!1;return!0}return!0}updateFocusSettings(){const t=this._focusPath[this._focusPath.length-1],n={},a=mt.prototype._setFocusSettings;for(let f=0,m=this._focusPath.length;f<m;f++)this._focusPath[f]._setFocusSettings!==a&&this._focusPath[f]._setFocusSettings(n);const u=mt.prototype._handleFocusSettings;for(let f=0,m=this._focusPath.length;f<m;f++)this._focusPath[f]._handleFocusSettings!==u&&this._focusPath[f]._handleFocusSettings(n,this.__prevFocusSettings,t);this.__prevFocusSettings=n}_handleFocusSettings(t,n,a,u){}__getFocusPath(){const t=[this];let n=this;do{const a=n._getFocused();if(!a||a===n)break;let u=a.cparent;if(u===n)t.push(a);else{const f=[a];do u||n._throwError("Return value for _getFocused must be an attached descendant component but its '"+a.getLocationString()+"'"),f.push(u),u=u.cparent;while(u!==n);for(let m=0,p=f.length;m<p;m++)t.push(f[p-m-1])}n=a}while(!0);return t}get focusPath(){return this._focusPath}focusTopDownEvent(t,...n){const a=this.focusPath,u=a.length;for(let f=0;f<u;f++){const m=a[f]._getMostSpecificHandledMember(t);if(m!==void 0&&a[f][m](...n)!==!1)return!0}return!1}focusBottomUpEvent(t,...n){const a=this.focusPath,u=a.length;for(let f=u-1;f>=0;f--){const m=a[f]._getMostSpecificHandledMember(t);if(m!==void 0&&a[f][m](...n)!==!1)return!0}return!1}_receiveKeydown(t){const n=t,a=this.__keymap[t.keyCode],u=this.focusPath;let f;if(a&&(f=Array.isArray(a)?a:[a]),f)for(let p=0,x=f.length;p<x;p++){const T=this.__keypressTimers.has(f[p]);if(u[u.length-1].longpress&&T)return;this.stage.application.focusTopDownEvent([`_capture${f[p]}`,"_captureKey"],n)||this.stage.application.focusBottomUpEvent([`_handle${f[p]}`,"_handleKey"],n)}else this.stage.application.focusTopDownEvent(["_captureKey"],n)||this.stage.application.focusBottomUpEvent(["_handleKey"],n);this.updateFocusPath();const m=u[u.length-1];if(f&&m.longpress)for(let p=0,x=f.length;p<x;p++)this._startLongpressTimer(f[p],m)}_receiveKeyup(t){const n=t,a=this.__keymap[t.keyCode];let u;if(a&&(u=Array.isArray(a)?a:[a]),u)for(let f=0,m=u.length;f<m;f++)this.stage.application.focusTopDownEvent([`_capture${u[f]}Release`,"_captureKeyRelease"],n)||this.stage.application.focusBottomUpEvent([`_handle${u[f]}Release`,"_handleKeyRelease"],n);else this.stage.application.focusTopDownEvent(["_captureKeyRelease"],n)||this.stage.application.focusBottomUpEvent(["_handleKeyRelease"],n);if(this.updateFocusPath(),u)for(let f=0,m=u.length;f<m;f++)this.__keypressTimers.has(u[f])&&(clearTimeout(this.__keypressTimers.get(u[f])),this.__keypressTimers.delete(u[f]))}_startLongpressTimer(t,n){const a=n.longpress,u=t.toLowerCase();if(a[u]){const f=a[u];X.isNumber(f)?this.__keypressTimers.set(t,setTimeout(()=>{this.stage.application.focusTopDownEvent([`_capture${t}Long`,"_captureKey"],{})||this.stage.application.focusBottomUpEvent([`_handle${t}Long`,"_handleKey"],{}),this.__keypressTimers.delete(t)},f||500)):n._throwError("config value for longpress must be a number")}}_recieveScrollWheel(t){const n=t,{clientX:a,clientY:u}=n;a<=this.stage.w&&u<=this.stage.h&&(this.fireTopDownScrollWheelHandler("_captureScroll",n)||this.fireBottomUpScrollWheelHandler("_handleScroll",n))}fireTopDownScrollWheelHandler(t,n){let a=this.stage.application.children,u=this._findChildren([],a).reverse(),f=u.length;for(;f--;){const m=u[f];if(m&&m[t])return m._captureScroll(n),!0}return!1}fireBottomUpScrollWheelHandler(t,n){const{clientX:a,clientY:u}=n;let m=this._getTargetChild(a,u);for(;m!==null;){if(m&&m[t])return m._handleScroll(n),!0;m=m.parent}return!1}_receiveClick(t){const n=t,{clientX:a,clientY:u}=n;a<=this.stage.w&&u<=this.stage.h&&this.stage.application.fireBottomUpClickHandler(n)}fireBottomUpClickHandler(t){const{clientX:n,clientY:a}=t,u=this._getTargetChild(n,a);let f=u;for(;f!==null;){if(f&&f._handleClick){f._handleClick(u);break}f=f.parent}}_receiveHover(t){const n=t,{clientX:a,clientY:u}=n;a<=this.stage.w&&u<=this.stage.h&&this.stage.application.fireBottomUpHoverHandler(n)}fireBottomUpHoverHandler(t){const{clientX:n,clientY:a}=t,u=this._getTargetChild(n,a);if(u!==this.__hoveredChild){let f=new Set,m=new Set;if(u&&(m=new Set(u.getAncestors())),this.__hoveredChild){f=new Set(this.__hoveredChild.getAncestors());for(const T of[...f].filter(A=>!m.has(A))){const A=mt.getComponent(T);A._handleUnhover&&A._handleUnhover(T),T.parent&&T.parent.cursor&&(this.stage.getCanvas().style.cursor=T.parent.cursor)}}this.__hoveredChild=u;const p=[...m].filter(T=>!f.has(T));for(const T of p){const A=mt.getComponent(T);A._handleHover&&A._handleHover(T)}const x=p[0];if(x&&x.cursor&&(this.stage.getCanvas().style.cursor=x.cursor),p.length===0&&u){const T=mt.getComponent(u);T._handleHover&&T._handleHover(u)}}}_getTargetChild(t,n){let a=this.stage.application.children,u=this._findChildren([],a),f=this._withinClickableRange(u,t,n);return f.sort((m,p)=>m.zIndex>p.zIndex?1:m.zIndex<p.zIndex?-1:m.id>p.id?1:-1),f.length?f.slice(-1)[0]:null}_findChildren(t,n){let a=n.length;for(;a--;){const u=n[a];u.__active&&u.collision&&(u.collision===!0&&t.push(u),u.hasChildren()&&this._findChildren(t,u.children))}return t}_withinClickableRange(t,n,a){let u=t.length;const f=[];for(;u--;){const m=t[u],p=this.stage.getRenderPrecision(),x=m.core._worldContext,T=x.px*p,A=x.py*p,b=m.finalW*x.ta*p,I=m.finalH*x.td*p;if(!(T>this.stage.w||A>this.stage.h)){if(m.parent.core._scissor){const D=m.parent.core._scissor.map(v=>v*p);if(!this._testCollision(n,a,...D))continue}this._testCollision(n,a,T,A,b,I)&&f.push(m)}}return f}_testCollision(t,n,a,u,f,m){return t>=a&&t<=a+f&&n>=u&&n<=u+m}destroy(){this._destroyed||(this._destroy(),this.stage.destroy(),this._destroyed=!0)}_destroy(){if(this.stage.setApplication(void 0),this._updateAttachedFlag(),this._updateEnabledFlag(),this.__keypressTimers.size){for(const t of this.__keypressTimers.values())clearTimeout(t);this.__keypressTimers.clear()}}getCanvas(){return this.stage.getCanvas()}};class qv extends Zt{constructor(t){super(t),this._factory=void 0,this._lookupId=void 0}set content({factory:t,lookupId:n=void 0}){this._factory=t,this._lookupId=n,this._changed()}_getIsValid(){return!!this._factory}_getLookupId(){return this._lookupId}_getSourceLoader(){const t=this._factory;return n=>t((a,u)=>{if(a)return n(a);n(null,this.stage.platform.getTextureOptionsForDrawingCanvas(u))},this.stage)}}class wo{static getCanvasTexture(t,n){return{type:qv,content:{factory:t,lookupId:n}}}static getRoundRect(t,n,a,u,f,m,p){Array.isArray(a)||(a=[a,a,a,a]);let x=(A,b)=>{X.isSpark?b.platform.createRoundRect(A,b,t,n,a,u,f,m,p):A(null,this.createRoundRect(b,t,n,a,u,f,m,p))},T="rect"+[t,n,u,f,m?1:0,p].concat(a).join(",");return wo.getCanvasTexture(x,T)}static createRoundRect(t,n,a,u,f,m,p,x){p===void 0&&(p=!0),f===void 0&&(f=0);let T=t.platform.getDrawingCanvas(),A=T.getContext("2d");A.imageSmoothingEnabled=!0,T.width=n+f+2,T.height=a+f+2,A.beginPath();let b=.5*f+1,I=.5*f+1;return A.moveTo(b+u[0],I),A.lineTo(b+n-u[1],I),A.arcTo(b+n,I,b+n,I+u[1],u[1]),A.lineTo(b+n,I+a-u[2]),A.arcTo(b+n,I+a,b+n-u[2],I+a,u[2]),A.lineTo(b+u[3],I+a),A.arcTo(b,I+a,b,I+a-u[3],u[3]),A.lineTo(b,I+u[0]),A.arcTo(b,I,b+u[0],I,u[0]),A.closePath(),p&&(X.isNumber(x)?A.fillStyle=ye.getRgbaString(x):A.fillStyle="white",A.fill()),f&&(X.isNumber(m)?A.strokeStyle=ye.getRgbaString(m):A.strokeStyle="white",A.lineWidth=f,A.stroke()),T}static getShadowRect(t,n,a=0,u=5,f=u*2){Array.isArray(a)||(a=[a,a,a,a]);let m=(x,T)=>{X.isSpark?T.platform.createShadowRect(x,T,t,n,a,u,f):x(null,this.createShadowRect(T,t,n,a,u,f))},p="shadow"+[t,n,u,f].concat(a).join(",");return wo.getCanvasTexture(m,p)}static createShadowRect(t,n,a,u,f,m){let p=t.platform.getDrawingCanvas(),x=p.getContext("2d");x.imageSmoothingEnabled=!0,p.width=n+m*2,p.height=a+m*2,x.globalAlpha=.01,x.fillRect(0,0,.01,.01),x.globalAlpha=1,x.shadowColor=ye.getRgbaString(4294967295),x.fillStyle=ye.getRgbaString(4294967295),x.shadowBlur=f,x.shadowOffsetX=n+10+m,x.shadowOffsetY=m,x.beginPath();const T=-(n+10),A=0;return x.moveTo(T+u[0],A),x.lineTo(T+n-u[1],A),x.arcTo(T+n,A,T+n,A+u[1],u[1]),x.lineTo(T+n,A+a-u[2]),x.arcTo(T+n,A+a,T+n-u[2],A+a,u[2]),x.lineTo(T+u[3],A+a),x.arcTo(T,A+a,T,A+a-u[3],u[3]),x.lineTo(T,A+u[0]),x.arcTo(T,A,T+u[0],A,u[0]),x.closePath(),x.fill(),p}static getSvgTexture(t,n,a){let u=(m,p)=>{X.isSpark?p.platform.createSvg(m,p,t,n,a):this.createSvg(m,p,t,n,a)},f="svg"+[n,a,t].join(",");return wo.getCanvasTexture(u,f)}static createSvg(t,n,a,u,f){let m=n.platform.getDrawingCanvas(),p=m.getContext("2d");p.imageSmoothingEnabled=!0;let x=new Image;x.onload=()=>{m.width=u,m.height=f,p.drawImage(x,0,0,m.width,m.height),t(null,m)},x.onError=T=>{t(T)},X.isPS4||(x.crossOrigin="Anonymous"),x.src=a}}class Vd{static isMf(t){return X.isFunction(t)&&t.__mf}static mf(t){return t.__mf=!0,t}static merge(t,n){const a=Object.keys(t),u=Object.keys(n);if(!u.length)return t;const f={},m={};for(let A=0,b=u.length;A<b;A++){const I=u[A];f[I]=-1,m[I]=A}for(let A=0,b=a.length;A<b;A++){const I=a[A];f[I]=A,m[I]===void 0&&(m[I]=-1)}const p=a.length,x={};for(let A=0,b=u.length;A<b;A++){const I=u[A],D=f[I];let v=D;for(;--v>=0;){const re=a[v];if(m[re]!==-1)break}for(;++v<D;){const re=a[v];x[re]=t[re]}const O=n[I],W=t[I];let Z;this.isMf(O)?Z=O(W):!X.isObjectLiteral(W)||!X.isObjectLiteral(O)?Z=O:Z=Vd.merge(W,O),Z!==void 0&&(x[I]=Z)}let T=p;for(;--T>=0;){const A=a[T];if(m[A]!==-1)break}for(;++T<p;){const A=a[T];x[A]=t[A]}return x}}class $v extends Uv{constructor(t){super(),this._target=t}onAdd(t,n){this._target.addAt(t,n)}onRemove(t,n){this._target.removeAt(n)}onSync(t,n,a){this._target._setByArray(a)}onSet(t,n){this._target.setAt(t,n)}onMove(t,n,a){this._target.setAt(t,a)}createItem(t){return this._target.createItem(t)}isItem(t){return this._target.isItem(t)}}class Yv extends $v{constructor(t,n){super(t),this._wrap=n}wrap(t){let n=this._wrap(t);return t._wrapper=n,n}onAdd(t,n){t=this.wrap(t),super.onAdd(t,n)}onRemove(t,n){super.onRemove(t,n)}onSync(t,n,a){n.forEach(u=>this.wrap(u)),a=a.map(u=>u._wrapper),super.onSync(t,n,a)}onSet(t,n){t=this.wrap(t),super.onSet(t,n)}onMove(t,n,a){super.onMove(t,n,a)}}class Kv extends Zt{_getLookupId(){return"__noise"}_getSourceLoader(){const t=this.stage.gl;return function(n){const a=new Uint8Array(65536);for(let f=0;f<128*128*4;f+=4){const m=Math.floor(Math.random()*256);a[f]=m,a[f+1]=m,a[f+2]=m,a[f+3]=255}const u={};t&&(u[t.TEXTURE_WRAP_S]=t.REPEAT,u[t.TEXTURE_WRAP_T]=t.REPEAT,u[t.TEXTURE_MIN_FILTER]=t.NEAREST,u[t.TEXTURE_MAG_FILTER]=t.NEAREST),n(null,{source:a,w:128,h:128,texParams:u})}}}class Wd extends Zt{constructor(t){super(t),this._htmlElement=void 0,this._scale=1}set htmlElement(t){this._htmlElement=t,this._changed()}get htmlElement(){return this._htmlElement}set scale(t){this._scale=t,this._changed()}get scale(){return this._scale}set html(t){if(!t)this.htmlElement=void 0;else{const n=document.createElement("div");n.innerHTML="<div>"+t+"</div>",this.htmlElement=n.firstElementChild}}get html(){return this._htmlElement.innerHTML}_getIsValid(){return this.htmlElement}_getLookupId(){return this._scale+":"+this._htmlElement.innerHTML}_getSourceLoader(){const t=this._htmlElement,n=this._scale;return function(a){if(!window.html2canvas)return a(new Error("Please include html2canvas (https://html2canvas.hertzen.com/)"));const u=Wd.getPreloadArea();u.appendChild(t),html2canvas(t,{backgroundColor:null,scale:n}).then(function(f){if(u.removeChild(t),f.height===0)return a(new Error("Canvas height is 0"));a(null,{source:f,width:f.width,height:f.height})}).catch(f=>{console.error("[Lightning]",f)})}}static getPreloadArea(){return this._preloadArea||(this._preloadArea=document.createElement("div"),this._preloadArea.attachShadow&&this._preloadArea.attachShadow({mode:"closed"}),this._preloadArea.style.opacity=0,this._preloadArea.style.pointerEvents="none",this._preloadArea.style.position="fixed",this._preloadArea.style.display="block",this._preloadArea.style.top="100vh",this._preloadArea.style.overflow="hidden",document.body.appendChild(this._preloadArea)),this._preloadArea}}class Ub extends Zt{constructor(t,n){super(t),this._options=n}set options(t){this._options!==t&&(this._options=t,this._changed())}get options(){return this._options}_getIsValid(){return!!this._options}_getSourceLoader(){return t=>{t(null,this._options)}}}class zb extends mt{constructor(t){super(t),this._wrapper=super._children.a({}),this._reloadVisibleElements=!1,this._visibleItems=new Set,this._index=0,this._started=!1,this._scrollTransitionSettings=this.stage.transitions.createSettings({}),this._itemSize=100,this._viewportScrollOffset=0,this._itemScrollOffset=0,this._roll=!1,this._rollMin=0,this._rollMax=0,this._progressAnimation=null,this._invertDirection=!1,this._horizontal=!0,this.itemList=new Bb(this)}_allowChildrenAccess(){return!1}get items(){return this.itemList.get()}set items(t){this.itemList.patch(t)}start(){this._wrapper.transition(this.property,this._scrollTransitionSettings),this._scrollTransition=this._wrapper.transition(this.property),this._scrollTransition.on("progress",t=>this.update()),this.setIndex(0,!0,!0),this._started=!0,this.update()}setIndex(t,n=!1,a=!1){let u=this.length;if(!u)return;if(this.emit("unfocus",this.getElement(this.realIndex),this._index,this.realIndex),a){let p=X.getModuloIndex(t,u),x=X.getModuloIndex(this.index,u),T=p-x;T>.5*u?T-=u:T<-.5*u&&(T+=u),this._index+=T}else this._index=t;(this._roll||this.viewportSize>this._itemSize*u)&&(this._index=X.getModuloIndex(this._index,u));let f=this._horizontal^this._invertDirection?-1:1,m=f*this._index*this._itemSize;if(this._roll){let p,x,T;if(f==1)x=(u-1)*this._itemSize,T=this._viewportScrollOffset*this.viewportSize-this._itemScrollOffset*this._itemSize,x-=T,p=this.viewportSize-(this._itemSize+T),this._rollMin&&(p-=this._rollMin),this._rollMax&&(x+=this._rollMax),m=Math.max(Math.min(m,x),p);else{x=u*this._itemSize-this.viewportSize,T=this._viewportScrollOffset*this.viewportSize-this._itemScrollOffset*this._itemSize,x+=T;let A=T;this._rollMin&&(A-=this._rollMin),this._rollMax&&(x+=this._rollMax),m=Math.min(Math.max(-x,m),-A)}}this._scrollTransition.start(m),n&&this._scrollTransition.finish(),this.emit("focus",this.getElement(this.realIndex),this._index,this.realIndex)}getAxisPosition(){let t=-this._scrollTransition._targetValue,a=-(this._horizontal^this._invertDirection?-1:1)*this._index*this._itemSize;return this._viewportScrollOffset*this.viewportSize+(a-t)}update(){if(!this._started)return;let t=this.length;if(!t)return;let n=this._horizontal^this._invertDirection?-1:1,a=this._horizontal?this._wrapper.x:this._wrapper.y,u=this.viewportSize,f=this._viewportScrollOffset*u-this._itemScrollOffset*this._itemSize;a+=f;let m,p,x,T;n==-1?(m=Math.floor(-a/this._itemSize),x=1-(-a/this._itemSize-m),p=Math.floor((u-a)/this._itemSize),T=(u-a)/this._itemSize-p):(m=Math.ceil(a/this._itemSize),x=1+a/this._itemSize-m,p=Math.ceil((a-u)/this._itemSize),T=p-(a-u)/this._itemSize),(this._roll||u>this._itemSize*t)&&(p>=t&&(p=t-1,T=1),m>=t&&(m=t-1,x=1),p<=-1&&(p=0,T=1),m<=-1&&(m=0,x=1));let A=-n*m*this._itemSize,b;for(let D=m;n==-1?D<=p:D>=p;n==-1?D++:D--){let v=X.getModuloIndex(D,t),O=this.getElement(v);b=O.parent,this._visibleItems.delete(b),this._horizontal?b.x=A+f:b.y=A+f;let W=b.visible;if(b.visible=!0,(!W||this._reloadVisibleElements)&&this.emit("visible",D,v),this._progressAnimation){let Z=1;D==m?Z=x:D==p&&(Z=T),this._progressAnimation.apply(O,Z)}A+=this._itemSize}let I=this;this._visibleItems.forEach(function(D){D.visible=!1,I._visibleItems.delete(D)});for(let D=m;n==-1?D<=p:D>=p;n==-1?D++:D--){let v=X.getModuloIndex(D,t);this._visibleItems.add(this.getWrapper(v))}this._reloadVisibleElements=!1}setPrevious(){this.setIndex(this._index-1)}setNext(){this.setIndex(this._index+1)}getWrapper(t){return this._wrapper.children[t]}getElement(t){let n=this._wrapper.children[t];return n?n.children[0]:null}reload(){this._reloadVisibleElements=!0,this.update()}get element(){let t=this._wrapper.children[this.realIndex];return t?t.children[0]:null}get length(){return this._wrapper.children.length}get property(){return this._horizontal?"x":"y"}get viewportSize(){return this._horizontal?this.w:this.h}get index(){return this._index}get realIndex(){return X.getModuloIndex(this._index,this.length)}get itemSize(){return this._itemSize}set itemSize(t){this._itemSize=t,this.update()}get viewportScrollOffset(){return this._viewportScrollOffset}set viewportScrollOffset(t){this._viewportScrollOffset=t,this.update()}get itemScrollOffset(){return this._itemScrollOffset}set itemScrollOffset(t){this._itemScrollOffset=t,this.update()}get scrollTransitionSettings(){return this._scrollTransitionSettings}set scrollTransitionSettings(t){this._scrollTransitionSettings.patch(t)}set scrollTransition(t){this._scrollTransitionSettings.patch(t)}get scrollTransition(){return this._scrollTransition}get progressAnimation(){return this._progressAnimation}set progressAnimation(t){X.isObjectLiteral(t)?this._progressAnimation=this.stage.animations.createSettings(t):this._progressAnimation=t,this.update()}get roll(){return this._roll}set roll(t){this._roll=t,this.update()}get rollMin(){return this._rollMin}set rollMin(t){this._rollMin=t,this.update()}get rollMax(){return this._rollMax}set rollMax(t){this._rollMax=t,this.update()}get invertDirection(){return this._invertDirection}set invertDirection(t){this._started||(this._invertDirection=t)}get horizontal(){return this._horizontal}set horizontal(t){t!==this._horizontal&&(this._started||(this._horizontal=t))}}class Bb extends Yv{constructor(t){let n=a=>{let u=a.stage.createElement();return u.add(a),u.visible=!1,u};super(t._wrapper._children,n),this.list=t}onAdd(t,n){super.onAdd(t,n),this.checkStarted(n)}checkStarted(t){this.list._reloadVisibleElements=!0,this.list._started?(this.list.length===1?this.list.setIndex(0,!0,!0):this.list._index>=this.list.length&&this.list.setIndex(0),this.list.update()):this.list.start()}onRemove(t,n){super.onRemove(t,n);let a=this.list.realIndex;a===n?(a===this.list.length&&a--,a>=0&&this.list.setIndex(a)):a>n&&this.list.setIndex(a-1),this.list._reloadVisibleElements=!0}onSet(t,n){super.onSet(t,n),this.checkStarted(n)}onSync(t,n,a){super.onSync(t,n,a),this.checkStarted(0)}get _signalProxy(){return!0}}class ru extends Xe{constructor(t){super(t),this._direction=new Float32Array([1,0]),this._kernelRadius=1}get x(){return this._direction[0]}set x(t){this._direction[0]=t,this.redraw()}get y(){return this._direction[1]}set y(t){this._direction[1]=t,this.redraw()}get kernelRadius(){return this._kernelRadius}set kernelRadius(t){this._kernelRadius=t,this.redraw()}useDefault(){return this._kernelRadius===0}setupUniforms(t){super.setupUniforms(t),this._setUniform("direction",this._direction,this.gl.uniform2fv),this._setUniform("kernelRadius",this._kernelRadius,this.gl.uniform1i);const n=t.getRenderWidth(),a=t.getRenderHeight();this._setUniform("resolution",new Float32Array([n,a]),this.gl.uniform2fv)}}ru.fragmentShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    uniform vec2 resolution;
    varying vec2 vTextureCoord;
    varying vec4 vColor;
    uniform sampler2D uSampler;
    uniform vec2 direction;
    uniform int kernelRadius;
    
    vec4 blur1(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
        vec4 color = vec4(0.0);
        vec2 off1 = vec2(1.3333333333333333) * direction;
        color += texture2D(image, uv) * 0.29411764705882354;
        color += texture2D(image, uv + (off1 / resolution)) * 0.35294117647058826;
        color += texture2D(image, uv - (off1 / resolution)) * 0.35294117647058826;
        return color; 
    }
    
    vec4 blur2(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
        vec4 color = vec4(0.0);
        vec2 off1 = vec2(1.3846153846) * direction;
        vec2 off2 = vec2(3.2307692308) * direction;
        color += texture2D(image, uv) * 0.2270270270;
        color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
        color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
        color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
        color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
        return color;
    }
    
    vec4 blur3(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
        vec4 color = vec4(0.0);
        vec2 off1 = vec2(1.411764705882353) * direction;
        vec2 off2 = vec2(3.2941176470588234) * direction;
        vec2 off3 = vec2(5.176470588235294) * direction;
        color += texture2D(image, uv) * 0.1964825501511404;
        color += texture2D(image, uv + (off1 / resolution)) * 0.2969069646728344;
        color += texture2D(image, uv - (off1 / resolution)) * 0.2969069646728344;
        color += texture2D(image, uv + (off2 / resolution)) * 0.09447039785044732;
        color += texture2D(image, uv - (off2 / resolution)) * 0.09447039785044732;
        color += texture2D(image, uv + (off3 / resolution)) * 0.010381362401148057;
        color += texture2D(image, uv - (off3 / resolution)) * 0.010381362401148057;
        return color;
    }    

    void main(void){
        if (kernelRadius == 1) {
            gl_FragColor = blur1(uSampler, vTextureCoord, resolution, direction) * vColor;
        } else if (kernelRadius == 2) {
            gl_FragColor = blur2(uSampler, vTextureCoord, resolution, direction) * vColor;
        } else {
            gl_FragColor = blur3(uSampler, vTextureCoord, resolution, direction) * vColor;
        }
    }
`;class Ri extends Xe{setupUniforms(t){super.setupUniforms(t);const n=1/t.getTextureWidth(0),a=1/t.getTextureHeight(0);this._setUniform("stepTextureCoord",new Float32Array([n,a]),this.gl.uniform2fv)}}Ri.vertexShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    uniform vec2 stepTextureCoord;
    attribute vec2 aVertexPosition;
    attribute vec2 aTextureCoord;
    attribute vec4 aColor;
    uniform vec2 projection;
    varying vec4 vColor;
    varying vec2 vTextureCoordUl;
    varying vec2 vTextureCoordUr;
    varying vec2 vTextureCoordBl;
    varying vec2 vTextureCoordBr;
    void main(void){
        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);
        vTextureCoordUl = aTextureCoord - stepTextureCoord;
        vTextureCoordBr = aTextureCoord + stepTextureCoord;
        vTextureCoordUr = vec2(vTextureCoordBr.x, vTextureCoordUl.y);
        vTextureCoordBl = vec2(vTextureCoordUl.x, vTextureCoordBr.y);
        vColor = aColor;
        gl_Position.y = -sign(projection.y) * gl_Position.y;
    }
`;Ri.fragmentShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    varying vec2 vTextureCoordUl;
    varying vec2 vTextureCoordUr;
    varying vec2 vTextureCoordBl;
    varying vec2 vTextureCoordBr;
    varying vec4 vColor;
    uniform sampler2D uSampler;
    void main(void){
        vec4 color = 0.25 * (texture2D(uSampler, vTextureCoordUl) + texture2D(uSampler, vTextureCoordUr) + texture2D(uSampler, vTextureCoordBl) + texture2D(uSampler, vTextureCoordBr));
        gl_FragColor = color * vColor;
    }
`;class Zv extends tu{constructor(t){super(t),this._kernelRadius=1}get kernelRadius(){return this._kernelRadius}set kernelRadius(t){this._kernelRadius=t,this.redraw()}useDefault(){return this._amount===0}_beforeDrawEl({target:t}){t.ctx.filter="blur("+this._kernelRadius+"px)"}_afterDrawEl({target:t}){t.ctx.filter="none"}}class jb extends mt{static _template(){return{}}get wrap(){return this.tag("Wrap")}set content(t){return this.wrap.content=t}get content(){return this.wrap.content}set padding(t){this.wrap._paddingX=t,this.wrap._paddingY=t,this.wrap._updateBlurSize()}set paddingX(t){this.wrap._paddingX=t,this.wrap._updateBlurSize()}set paddingY(t){this.wrap._paddingY=t,this.wrap._updateBlurSize()}set amount(t){return this.wrap.amount=t}get amount(){return this.wrap.amount}_onResize(){this.wrap.w=this.renderWidth,this.wrap.h=this.renderHeight}get _signalProxy(){return!0}_build(){this.patch({Wrap:{type:this.stage.gl?Hb:Gl}})}}class Gl extends mt{static _template(){return{forceZIndexContext:!0,rtt:!0,Textwrap:{shader:{type:Zv},Content:{}}}}constructor(t){super(t),this._textwrap=this.sel("Textwrap"),this._wrapper=this.sel("Textwrap>Content"),this._amount=0,this._paddingX=0,this._paddingY=0}static getSpline(){return this._multiSpline||(this._multiSpline=new ct,this._multiSpline.parse(!1,{0:0,.25:1.5,.5:5.5,.75:18,1:39})),this._multiSpline}get content(){return this.sel("Textwrap>Content")}set content(t){this.sel("Textwrap>Content").patch(t,!0)}set padding(t){this._paddingX=t,this._paddingY=t,this._updateBlurSize()}set paddingX(t){this._paddingX=t,this._updateBlurSize()}set paddingY(t){this._paddingY=t,this._updateBlurSize()}_updateBlurSize(){let t=this.renderWidth,n=this.renderHeight,a=this._paddingX,u=this._paddingY;this._wrapper.x=a,this._textwrap.x=-a,this._wrapper.y=u,this._textwrap.y=-u,this._textwrap.w=t+a*2,this._textwrap.h=n+u*2}get amount(){return this._amount}set amount(t){this._amount=t,this._textwrap.shader.kernelRadius=Gl._amountToKernelRadius(t)}static _amountToKernelRadius(t){return Gl.getSpline().getValue(Math.min(1,t*.25))}get _signalProxy(){return!0}}class Hb extends mt{static _template(){const t=function(n,a){if(a._recalc&130){const u=a.w,f=a.h;let m=a;do m=m._children[0],m._element.w=u,m._element.h=f;while(m._children)}};return{Textwrap:{rtt:!0,forceZIndexContext:!0,renderOffscreen:!0,Content:{}},Layers:{L0:{rtt:!0,onUpdate:t,renderOffscreen:!0,visible:!1,Content:{shader:{type:Ri}}},L1:{rtt:!0,onUpdate:t,renderOffscreen:!0,visible:!1,Content:{shader:{type:Ri}}},L2:{rtt:!0,onUpdate:t,renderOffscreen:!0,visible:!1,Content:{shader:{type:Ri}}},L3:{rtt:!0,onUpdate:t,renderOffscreen:!0,visible:!1,Content:{shader:{type:Ri}}}},Result:{shader:{type:Qv},visible:!1}}}get _signalProxy(){return!0}constructor(t){super(t),this._textwrap=this.sel("Textwrap"),this._wrapper=this.sel("Textwrap>Content"),this._layers=this.sel("Layers"),this._output=this.sel("Result"),this._amount=0,this._paddingX=0,this._paddingY=0}_buildLayers(){const n=[{x:1,y:0,kernelRadius:1},{x:0,y:1,kernelRadius:1},{x:1.5,y:0,kernelRadius:1},{x:0,y:1.5,kernelRadius:1}].map(a=>ko.create(this.stage,Object.assign({type:ru},a)));this._setLayerTexture(this.getLayerContents(0),this._textwrap.getTexture(),[]),this._setLayerTexture(this.getLayerContents(1),this.getLayer(0).getTexture(),[n[0],n[1]]),this._setLayerTexture(this.getLayerContents(2),this.getLayer(1).getTexture(),[n[0],n[1],n[2],n[3]]),this._setLayerTexture(this.getLayerContents(3),this.getLayer(2).getTexture(),[n[0],n[1],n[2],n[3]])}_setLayerTexture(t,n,a){if(!a.length)t.texture=n;else{const u=a.pop(),f=t.stage.c({rtt:!0,shader:u});this._setLayerTexture(f,n,a),t.childList.add(f)}return t}get content(){return this.sel("Textwrap>Content")}set content(t){this.sel("Textwrap>Content").patch(t,!0)}set padding(t){this._paddingX=t,this._paddingY=t,this._updateBlurSize()}set paddingX(t){this._paddingX=t,this._updateBlurSize()}set paddingY(t){this._paddingY=t,this._updateBlurSize()}getLayer(t){return this._layers.sel("L"+t)}getLayerContents(t){return this.getLayer(t).sel("Content")}_onResize(){this._updateBlurSize()}_updateBlurSize(){let t=this.renderWidth,n=this.renderHeight,a=this._paddingX,u=this._paddingY,f=t+a*2,m=n+u*2;this._textwrap.w=f,this._wrapper.x=a,this.getLayer(0).w=this.getLayerContents(0).w=f/2,this.getLayer(1).w=this.getLayerContents(1).w=f/4,this.getLayer(2).w=this.getLayerContents(2).w=f/8,this.getLayer(3).w=this.getLayerContents(3).w=f/16,this._output.x=-a,this._textwrap.x=-a,this._output.w=f,this._textwrap.h=m,this._wrapper.y=u,this.getLayer(0).h=this.getLayerContents(0).h=m/2,this.getLayer(1).h=this.getLayerContents(1).h=m/4,this.getLayer(2).h=this.getLayerContents(2).h=m/8,this.getLayer(3).h=this.getLayerContents(3).h=m/16,this._output.y=-u,this._textwrap.y=-u,this._output.h=m,this.w=t,this.h=n}set amount(t){this._amount=t,this._update()}get amount(){return this._amount}_update(){let t=Math.min(4,Math.max(0,this._amount));t===0?(this._textwrap.renderToTexture=!1,this._output.shader.otherTextureSource=null,this._output.visible=!1):(this._textwrap.renderToTexture=!0,this._output.visible=!0,this.getLayer(0).visible=t>0,this.getLayer(1).visible=t>1,this.getLayer(2).visible=t>2,this.getLayer(3).visible=t>3,t<=1?(this._output.texture=this._textwrap.getTexture(),this._output.shader.otherTextureSource=this.getLayer(0).getTexture(),this._output.shader.a=t):t<=2?(this._output.texture=this.getLayer(0).getTexture(),this._output.shader.otherTextureSource=this.getLayer(1).getTexture(),this._output.shader.a=t-1):t<=3?(this._output.texture=this.getLayer(1).getTexture(),this._output.shader.otherTextureSource=this.getLayer(2).getTexture(),this._output.shader.a=t-2):t<=4&&(this._output.texture=this.getLayer(2).getTexture(),this._output.shader.otherTextureSource=this.getLayer(3).getTexture(),this._output.shader.a=t-3))}set shader(t){super.shader=t,this.renderToTexture||console.warn("[Lightning] Please enable renderToTexture to use with a shader.")}_firstActive(){this._buildLayers()}}class Qv extends Xe{constructor(t){super(t),this._a=0,this._otherTextureSource=null}get a(){return this._a}set a(t){this._a=t,this.redraw()}set otherTextureSource(t){this._otherTextureSource=t,this.redraw()}setupUniforms(t){super.setupUniforms(t),this._setUniform("a",this._a,this.gl.uniform1f),this._setUniform("uSampler2",1,this.gl.uniform1i)}beforeDraw(t){let n=this._otherTextureSource?this._otherTextureSource.nativeTexture:null,a=this.gl;a.activeTexture(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,n),a.activeTexture(a.TEXTURE0)}}Qv.fragmentShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    varying vec2 vTextureCoord;
    varying vec4 vColor;
    uniform sampler2D uSampler;
    uniform sampler2D uSampler2;
    uniform float a;
    void main(void){
        if (a == 1.0) {
            gl_FragColor = texture2D(uSampler2, vTextureCoord) * vColor;
        } else {
            gl_FragColor = ((1.0 - a) * texture2D(uSampler, vTextureCoord) + (a * texture2D(uSampler2, vTextureCoord))) * vColor;
        }
    }
`;class Vb extends mt{static _template(){const t=function(n,a){if(a._recalc&130){const u=a.w,f=a.h;let m=a;do m=m._children[0],m._element.w=u,m._element.h=f;while(m._children)}};return{Textwrap:{rtt:!0,forceZIndexContext:!0,renderOffscreen:!0,BloomBase:{shader:{type:Jv},Content:{}}},Layers:{L0:{rtt:!0,onUpdate:t,scale:2,pivot:0,visible:!1,Content:{shader:{type:Ri}}},L1:{rtt:!0,onUpdate:t,scale:4,pivot:0,visible:!1,Content:{shader:{type:Ri}}},L2:{rtt:!0,onUpdate:t,scale:8,pivot:0,visible:!1,Content:{shader:{type:Ri}}},L3:{rtt:!0,onUpdate:t,scale:16,pivot:0,visible:!1,Content:{shader:{type:Ri}}}}}}get _signalProxy(){return!0}constructor(t){super(t),this._textwrap=this.sel("Textwrap"),this._wrapper=this.sel("Textwrap.Content"),this._layers=this.sel("Layers"),this._amount=0,this._paddingX=0,this._paddingY=0}_build(){const n=[{x:1,y:0,kernelRadius:3},{x:0,y:1,kernelRadius:3},{x:1.5,y:0,kernelRadius:3},{x:0,y:1.5,kernelRadius:3}].map(a=>this.stage.createShader(Object.assign({type:ru},a)));this._setLayerTexture(this.getLayerContents(0),this._textwrap.getTexture(),[]),this._setLayerTexture(this.getLayerContents(1),this.getLayer(0).getTexture(),[n[0],n[1]]),this._setLayerTexture(this.getLayerContents(2),this.getLayer(1).getTexture(),[n[0],n[1],n[2],n[3]]),this._setLayerTexture(this.getLayerContents(3),this.getLayer(2).getTexture(),[n[0],n[1],n[2],n[3]])}_setLayerTexture(t,n,a){if(!a.length)t.texture=n;else{const u=a.pop(),f=t.stage.c({rtt:!0,shader:u});this._setLayerTexture(f,n,a),t.childList.add(f)}return t}get content(){return this.sel("Textwrap.Content")}set content(t){this.sel("Textwrap.Content").patch(t)}set padding(t){this._paddingX=t,this._paddingY=t,this._updateBlurSize()}set paddingX(t){this._paddingX=t,this._updateBlurSize()}set paddingY(t){this._paddingY=t,this._updateBlurSize()}getLayer(t){return this._layers.sel("L"+t)}getLayerContents(t){return this.getLayer(t).sel("Content")}_onResize(){this._updateBlurSize()}_updateBlurSize(){let t=this.renderWidth,n=this.renderHeight,a=this._paddingX,u=this._paddingY,f=t+a*2,m=n+u*2;this._textwrap.w=f,this._wrapper.x=a,this.getLayer(0).w=this.getLayerContents(0).w=f/2,this.getLayer(1).w=this.getLayerContents(1).w=f/4,this.getLayer(2).w=this.getLayerContents(2).w=f/8,this.getLayer(3).w=this.getLayerContents(3).w=f/16,this._textwrap.x=-a,this._textwrap.h=m,this._wrapper.y=u,this.getLayer(0).h=this.getLayerContents(0).h=m/2,this.getLayer(1).h=this.getLayerContents(1).h=m/4,this.getLayer(2).h=this.getLayerContents(2).h=m/8,this.getLayer(3).h=this.getLayerContents(3).h=m/16,this._textwrap.y=-u,this.w=t,this.h=n}set amount(t){this._amount=t,this._update()}get amount(){return this._amount}_update(){let t=Math.min(4,Math.max(0,this._amount));t>0&&(this.getLayer(0).visible=t>0,this.getLayer(1).visible=t>1,this.getLayer(2).visible=t>2,this.getLayer(3).visible=t>3)}set shader(t){super.shader=t,this.renderToTexture||console.warn("[Lightning] Please enable renderToTexture to use with a shader.")}_firstActive(){this._build()}}class Jv extends Xe{}Jv.fragmentShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    varying vec2 vTextureCoord;
    varying vec4 vColor;
    uniform sampler2D uSampler;
    void main(void){
        vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
        float m = max(max(color.r, color.g), color.b);
        float c = max(0.0, (m - 0.80)) * 5.0;
        color = color * c;
        gl_FragColor = color;
    }
`;class Xl extends mt{static _template(){return{ContentWrap:{renderOffscreen:!0,forceZIndexContext:!0,onAfterUpdate:Xl._updateDimensions,Content:{}},Scale:{visible:!1}}}constructor(t){super(t),this._smoothScale=1,this._iterations=0}get content(){return this.tag("Content")}set content(t){this.tag("Content").patch(t,!0)}get smoothScale(){return this._smoothScale}set smoothScale(t){if(this._smoothScale!==t){let n=0;for(;t<.5&&n<12;)n++,t=t*2;this.scale=t,this._setIterations(n),this._smoothScale=t}}_setIterations(t){if(this._iterations!==t){const n=this.sel("Scale").childList,a=this.sel("ContentWrap");for(;n.length<t;){const m=n.length===0?a.getTexture():n.last.getTexture();n.a({rtt:!0,renderOffscreen:!0,texture:m})}Xl._updateDimensions(this.tag("ContentWrap"),!0);const u=t>0;this.patch({ContentWrap:{renderToTexture:u},Scale:{visible:u}});for(let f=0,m=n.length;f<m;f++)n.getAt(f).patch({visible:f<t,renderOffscreen:f!==t-1});this._iterations=t}}static _updateDimensions(t,n){const a=t.children[0];let u=a.renderWidth,f=a.renderHeight;if(u!==t.w||f!==t.h||n){t.w=u,t.h=f;const m=t.parent.tag("Scale").children;for(let p=0,x=m.length;p<x;p++)u=u*.5,f=f*.5,m[p].w=u,m[p].h=f}}get _signalProxy(){return!0}}class Wb extends mt{static _template(){return{Content:{},Borders:{Top:{rect:!0,visible:!1,mountY:1},Right:{rect:!0,visible:!1},Bottom:{rect:!0,visible:!1},Left:{rect:!0,visible:!1,mountX:1}}}}get _signalProxy(){return!0}constructor(t){super(t),this._borderTop=this.tag("Top"),this._borderRight=this.tag("Right"),this._borderBottom=this.tag("Bottom"),this._borderLeft=this.tag("Left"),this.onAfterUpdate=function(n){const a=n.childList.first;let u=n.core.w||a.renderWidth,f=n.core.h||a.renderHeight;n._borderTop.w=u,n._borderBottom.y=f,n._borderBottom.w=u,n._borderLeft.h=f+n._borderTop.h+n._borderBottom.h,n._borderLeft.y=-n._borderTop.h,n._borderRight.x=u,n._borderRight.h=f+n._borderTop.h+n._borderBottom.h,n._borderRight.y=-n._borderTop.h},this.borderWidth=1}get content(){return this.sel("Content")}set content(t){this.sel("Content").patch(t,!0)}get borderWidth(){return this.borderWidthTop}get borderWidthTop(){return this._borderTop.h}get borderWidthRight(){return this._borderRight.w}get borderWidthBottom(){return this._borderBottom.h}get borderWidthLeft(){return this._borderLeft.w}set borderWidth(t){this.borderWidthTop=t,this.borderWidthRight=t,this.borderWidthBottom=t,this.borderWidthLeft=t}set borderWidthTop(t){this._borderTop.h=t,this._borderTop.visible=t>0}set borderWidthRight(t){this._borderRight.w=t,this._borderRight.visible=t>0}set borderWidthBottom(t){this._borderBottom.h=t,this._borderBottom.visible=t>0}set borderWidthLeft(t){this._borderLeft.w=t,this._borderLeft.visible=t>0}get colorBorder(){return this.colorBorderTop}get colorBorderTop(){return this._borderTop.color}get colorBorderRight(){return this._borderRight.color}get colorBorderBottom(){return this._borderBottom.color}get colorBorderLeft(){return this._borderLeft.color}set colorBorder(t){this.colorBorderTop=t,this.colorBorderRight=t,this.colorBorderBottom=t,this.colorBorderLeft=t}set colorBorderTop(t){this._borderTop.color=t}set colorBorderRight(t){this._borderRight.color=t}set colorBorderBottom(t){this._borderBottom.color=t}set colorBorderLeft(t){this._borderLeft.color=t}get borderTop(){return this._borderTop}set borderTop(t){this.borderTop.patch(t)}get borderRight(){return this._borderRight}set borderRight(t){this.borderRight.patch(t)}get borderBottom(){return this._borderBottom}set borderBottom(t){this.borderBottom.patch(t)}get borderLeft(){return this._borderLeft}set borderLeft(t){this.borderLeft.patch(t)}set borders(t){this.borderTop=t,this.borderLeft=t,this.borderBottom=t,this.borderRight=t}}class Gd extends Xe{constructor(t){super(t),this._amount=1}static getC2d(){return e0}set amount(t){this._amount=t,this.redraw()}get amount(){return this._amount}useDefault(){return this._amount===0}setupUniforms(t){super.setupUniforms(t),this._setUniform("amount",this._amount,this.gl.uniform1f)}}Gd.fragmentShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    varying vec2 vTextureCoord;
    varying vec4 vColor;
    uniform sampler2D uSampler;
    uniform float amount;
    void main(void){
        vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
        float grayness = 0.2 * color.r + 0.6 * color.g + 0.2 * color.b;
        gl_FragColor = vec4(amount * vec3(grayness, grayness, grayness) + (1.0 - amount) * color.rgb, color.a);
    }
`;class e0 extends tu{constructor(t){super(t),this._amount=1}static getWebGL(){return Gd}set amount(t){this._amount=t,this.redraw()}get amount(){return this._amount}useDefault(){return this._amount===0}_beforeDrawEl({target:t}){t.ctx.filter="grayscale("+this._amount+")"}_afterDrawEl({target:t}){t.ctx.filter="none"}}class Xd extends Xe{constructor(t){super(t),this._noiseTexture=new Kv(t.stage),this._graining=1/256,this._random=!1}set graining(t){this._graining=t,this.redraw()}set random(t){this._random=t,this.redraw()}setExtraAttribsInBuffer(t){this._noiseTexture.load();let n=t.extraAttribsDataByteOffset/4,a=t.quads.floats,u=t.length;for(let f=0;f<u;f++){let m=t.getElementWidth(f)/this._noiseTexture.getRenderWidth(),p=t.getElementHeight(f)/this._noiseTexture.getRenderHeight(),x=0,T=0;if(this._random){if(x=Math.random(),T=Math.random(),m+=x,p+=T,Math.random()<.5){const A=x;x=m,m=A}if(Math.random()<.5){const A=T;T=p,p=A}}a[n]=x,a[n+1]=T,a[n+2]=m,a[n+3]=T,a[n+4]=m,a[n+5]=p,a[n+6]=x,a[n+7]=p,n+=8}}beforeDraw(t){let n=this.gl;n.vertexAttribPointer(this._attrib("aNoiseTextureCoord"),2,n.FLOAT,!1,8,this.getVertexAttribPointerOffset(t));let a=this._noiseTexture.source.nativeTexture;n.activeTexture(n.TEXTURE1),n.bindTexture(n.TEXTURE_2D,a),n.activeTexture(n.TEXTURE0)}getExtraAttribBytesPerVertex(){return 8}setupUniforms(t){super.setupUniforms(t),this._setUniform("uNoiseSampler",1,this.gl.uniform1i),this._setUniform("graining",2*this._graining,this.gl.uniform1f)}enableAttribs(){super.enableAttribs(),this.gl.enableVertexAttribArray(this._attrib("aNoiseTextureCoord"))}disableAttribs(){super.disableAttribs(),this.gl.disableVertexAttribArray(this._attrib("aNoiseTextureCoord"))}useDefault(){return this._graining===0}afterDraw(t){this._random&&this.redraw()}}Xd.vertexShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    attribute vec2 aVertexPosition;
    attribute vec2 aTextureCoord;
    attribute vec2 aNoiseTextureCoord;
    attribute vec4 aColor;
    uniform vec2 projection;
    varying vec2 vTextureCoord;
    varying vec2 vNoiseTextureCoord;
    varying vec4 vColor;
    void main(void){
        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);
        vTextureCoord = aTextureCoord;
        vNoiseTextureCoord = aNoiseTextureCoord;
        vColor = aColor;
        gl_Position.y = -sign(projection.y) * gl_Position.y;
    }
`;Xd.fragmentShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    varying vec2 vTextureCoord;
    varying vec2 vNoiseTextureCoord;
    varying vec4 vColor;
    uniform sampler2D uSampler;
    uniform sampler2D uNoiseSampler;
    uniform float graining;
    void main(void){
        vec4 noise = texture2D(uNoiseSampler, vNoiseTextureCoord);
        vec4 color = texture2D(uSampler, vTextureCoord);
        gl_FragColor = (color * vColor) + graining * (noise.r - 0.5);
    }
`;class qd extends Xe{constructor(t){super(t),this._inputValue=0,this._maxDerivative=.01,this._normalizedValue=0,this._offset=0,this._amount=.1,this._aspectRatio=1,this._offsetX=0,this._offsetY=0,this.buckets=100}get aspectRatio(){return this._aspectRatio}set aspectRatio(t){this._aspectRatio=t,this.redraw()}get offsetX(){return this._offsetX}set offsetX(t){this._offsetX=t,this.redraw()}get offsetY(){return this._offsetY}set offsetY(t){this._offsetY=t,this.redraw()}set amount(t){this._amount=t,this.redraw()}get amount(){return this._amount}set inputValue(t){this._inputValue=t}get inputValue(){return this._inputValue}set maxDerivative(t){this._maxDerivative=t}get maxDerivative(){return this._maxDerivative}set buckets(t){t>100&&(console.warn("[Lightning] CircularPushShader: supports max 100 buckets"),t=100),this._buckets=t,this._values=new Uint8Array(this._getValues(t)),this.redraw()}get buckets(){return this._buckets}_getValues(t){const n=[];for(let a=0;a<t;a++)n.push(this._inputValue);return n}progress(t){this._offset+=t*this._buckets;const n=Math.floor(this._offset);this._offset-=n,this._shiftBuckets(n),this.redraw()}_shiftBuckets(t){for(let n=this._buckets-1;n>=0;n--){const a=n-t;a<0?(this._normalizedValue=Math.min(this._normalizedValue+this._maxDerivative,Math.max(this._normalizedValue-this._maxDerivative,this._inputValue)),this._values[n]=255*this._normalizedValue):this._values[n]=this._values[a]}}set offset(t){this._offset=t,this.redraw()}setupUniforms(t){super.setupUniforms(t),this._setUniform("aspectRatio",this._aspectRatio,this.gl.uniform1f),this._setUniform("offsetX",this._offsetX,this.gl.uniform1f),this._setUniform("offsetY",this._offsetY,this.gl.uniform1f),this._setUniform("amount",this._amount,this.gl.uniform1f),this._setUniform("offset",this._offset,this.gl.uniform1f),this._setUniform("buckets",this._buckets,this.gl.uniform1f),this._setUniform("uValueSampler",1,this.gl.uniform1i)}useDefault(){return this._amount===0}beforeDraw(t){const n=this.gl;n.activeTexture(n.TEXTURE1),this._valuesTexture?n.bindTexture(n.TEXTURE_2D,this._valuesTexture):(this._valuesTexture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,this._valuesTexture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),X.isNode&&n.pixelStorei(n.UNPACK_FLIP_BLUE_RED,!1),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1)),n.texImage2D(n.TEXTURE_2D,0,n.ALPHA,this._buckets,1,0,n.ALPHA,n.UNSIGNED_BYTE,this._values),n.activeTexture(n.TEXTURE0)}cleanup(){this._valuesTexture&&this.gl.deleteTexture(this._valuesTexture)}}qd.vertexShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    attribute vec2 aVertexPosition;
    attribute vec2 aTextureCoord;
    attribute vec4 aColor;
    uniform vec2 projection;
    uniform float offsetX;
    uniform float offsetY;
    uniform float aspectRatio;
    varying vec2 vTextureCoord;
    varying vec2 vPos;
    varying vec4 vColor;
    void main(void){
        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);
        vTextureCoord = aTextureCoord;
        vPos = vTextureCoord * 2.0 - 1.0;
        vPos.y = vPos.y * aspectRatio;
        vPos.y = vPos.y + offsetY;
        vPos.x = vPos.x + offsetX;
        vColor = aColor;
        gl_Position.y = -sign(projection.y) * gl_Position.y;
    }
`;qd.fragmentShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    varying vec2 vTextureCoord;
    varying vec4 vColor;
    varying vec2 vPos;
    uniform float amount;
    uniform float offset;
    uniform float values[100];
    uniform float buckets;
    uniform sampler2D uSampler;
    uniform sampler2D uValueSampler;
    void main(void){
        float l = length(vPos);
        float m = (l * buckets * 0.678 - offset) / buckets;
        float f = texture2D(uValueSampler, vec2(m, 0.0)).a * amount;
        vec2 unit = vPos / l;
        gl_FragColor = texture2D(uSampler, vTextureCoord - f * unit) * vColor;
    }
`;class t0 extends Xe{constructor(t){super(t),this._amount=1}set amount(t){this._amount=t,this.redraw()}get amount(){return this._amount}useDefault(){return this._amount===0}setupUniforms(t){super.setupUniforms(t),this._setUniform("amount",this._amount,this.gl.uniform1f)}}t0.fragmentShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    varying vec2 vTextureCoord;
    varying vec4 vColor;
    uniform sampler2D uSampler;
    uniform float amount;
    void main(void){
        vec4 color = texture2D(uSampler, vTextureCoord);
        color.rgb = color.rgb * (1.0 - amount) + amount * (1.0 * color.a - color.rgb); 
        gl_FragColor = color * vColor;
    }
`;class $d extends Xe{constructor(t){super(t),this._width=5,this._col=4294967295,this._color=[1,1,1,1]}set width(t){this._width=t,this.redraw()}get color(){return this._col}set color(t){if(this._col!==t){const n=ye.getRgbaComponentsNormalized(t);n[0]=n[0]*n[3],n[1]=n[1]*n[3],n[2]=n[2]*n[3],this._color=n,this.redraw(),this._col=t}}useDefault(){return this._width===0||this._col[3]===0}setupUniforms(t){super.setupUniforms(t);let n=this.gl;this._setUniform("color",new Float32Array(this._color),n.uniform4fv)}enableAttribs(){super.enableAttribs(),this.gl.enableVertexAttribArray(this._attrib("aCorner"))}disableAttribs(){super.disableAttribs(),this.gl.disableVertexAttribArray(this._attrib("aCorner"))}setExtraAttribsInBuffer(t){let n=t.extraAttribsDataByteOffset/4,a=t.quads.floats,u=t.length;for(let f=0;f<u;f++){const m=t.getElementCore(f),p=this._width/m.w,x=p/(1-2*p),T=this._width/m.h,A=T/(1-2*T);a[n]=-x,a[n+1]=-A,a[n+2]=1+x,a[n+3]=-A,a[n+4]=1+x,a[n+5]=1+A,a[n+6]=-x,a[n+7]=1+A,n+=8}}beforeDraw(t){let n=this.gl;n.vertexAttribPointer(this._attrib("aCorner"),2,n.FLOAT,!1,8,this.getVertexAttribPointerOffset(t))}getExtraAttribBytesPerVertex(){return 8}}$d.vertexShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    attribute vec2 aVertexPosition;
    attribute vec2 aTextureCoord;
    attribute vec4 aColor;
    attribute vec2 aCorner;
    uniform vec2 projection;
    varying vec2 vTextureCoord;
    varying vec2 vCorner;
    varying vec4 vColor;
    void main(void){
        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);
        vTextureCoord = aTextureCoord;
        vCorner = aCorner;
        vColor = aColor;
        gl_Position.y = -sign(projection.y) * gl_Position.y;
    }
`;$d.fragmentShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    varying vec2 vTextureCoord;
    varying vec4 vColor;
    varying vec2 vCorner;
    uniform vec4 color;
    uniform sampler2D uSampler;
    void main(void){
        vec2 m = min(vCorner, 1.0 - vCorner);
        float value = step(0.0, min(m.x, m.y));
        gl_FragColor = mix(color, texture2D(uSampler, vTextureCoord) * vColor, value);
    }
`;class Yd extends Xe{constructor(t){super(t),this._size=new Float32Array([4,4])}get x(){return this._size[0]}set x(t){this._size[0]=t,this.redraw()}get y(){return this._size[1]}set y(t){this._size[1]=t,this.redraw()}get size(){return this._size[0]}set size(t){this._size[0]=t,this._size[1]=t,this.redraw()}useDefault(){return this._size[0]===0&&this._size[1]===0}static getWebGLImpl(){return WebGLPixelateShaderImpl}setupUniforms(t){super.setupUniforms(t);let n=this.gl;this._setUniform("size",new Float32Array(this._size),n.uniform2fv)}getExtraAttribBytesPerVertex(){return 8}enableAttribs(){super.enableAttribs(),this.gl.enableVertexAttribArray(this._attrib("aTextureRes"))}disableAttribs(){super.disableAttribs(),this.gl.disableVertexAttribArray(this._attrib("aTextureRes"))}setExtraAttribsInBuffer(t){let n=t.extraAttribsDataByteOffset/4,a=t.quads.floats,u=t.length;for(let f=0;f<u;f++){let m=t.quads.getTextureWidth(t.index+f),p=t.quads.getTextureHeight(t.index+f);a[n]=m,a[n+1]=p,a[n+2]=m,a[n+3]=p,a[n+4]=m,a[n+5]=p,a[n+6]=m,a[n+7]=p,n+=8}}beforeDraw(t){let n=this.gl;n.vertexAttribPointer(this._attrib("aTextureRes"),2,n.FLOAT,!1,this.getExtraAttribBytesPerVertex(),this.getVertexAttribPointerOffset(t))}}Yd.vertexShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    attribute vec2 aVertexPosition;
    attribute vec2 aTextureCoord;
    attribute vec4 aColor;
    attribute vec2 aTextureRes;
    uniform vec2 projection;
    varying vec2 vTextureCoord;
    varying vec4 vColor;
    varying vec2 vTextureRes;
    void main(void){
        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);
        vTextureCoord = aTextureCoord;
        vColor = aColor;
        vTextureRes = aTextureRes;
        gl_Position.y = -sign(projection.y) * gl_Position.y;
    }
`;Yd.fragmentShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    varying vec2 vTextureCoord;
    varying vec4 vColor;
    varying vec2 vTextureRes;

    uniform vec2 size;
    uniform sampler2D uSampler;
    
    vec2 mapCoord( vec2 coord )
    {
        coord *= vTextureRes.xy;
        return coord;
    }
    
    vec2 unmapCoord( vec2 coord )
    {
        coord /= vTextureRes.xy;
        return coord;
    }
    
    vec2 pixelate(vec2 coord, vec2 size)
    {
        return floor( coord / size ) * size;
    }
    
    void main(void)
    {
        vec2 coord = mapCoord(vTextureCoord);
        coord = pixelate(coord, size);
        coord = unmapCoord(coord);
        gl_FragColor = texture2D(uSampler, coord) * vColor;
    }
`;class Kd extends Xe{constructor(t){super(t),this._radius=0,this._cutoff=1}set radius(t){this._radius=t,this.redraw()}get radius(){return this._radius}set cutoff(t){this._cutoff=t,this.redraw()}get cutoff(){return this._cutoff}useDefault(){return this._radius===0}setupUniforms(t){super.setupUniforms(t),this._setUniform("radius",2*(this._radius-.5)/t.getRenderWidth(),this.gl.uniform1f),this._setUniform("cutoff",.5*t.getRenderWidth()/this._cutoff,this.gl.uniform1f)}}Kd.vertexShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    attribute vec2 aVertexPosition;
    attribute vec2 aTextureCoord;
    attribute vec4 aColor;
    uniform vec2 projection;
    varying vec2 pos;
    varying vec2 vTextureCoord;
    varying vec4 vColor;
    void main(void){
        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);
        vTextureCoord = aTextureCoord;
        vColor = aColor;
        gl_Position.y = -sign(projection.y) * gl_Position.y;
        pos = gl_Position.xy;
    }
`;Kd.fragmentShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    varying vec2 vTextureCoord;
    varying vec2 pos;
    varying vec4 vColor;
    uniform sampler2D uSampler;
    uniform float radius;
    uniform float cutoff;
    void main(void){
        vec4 color = texture2D(uSampler, vTextureCoord);
        float f = max(0.0, min(1.0, 1.0 - (length(pos) - radius) * cutoff));
        gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor * f;
    }
`;class Zd extends Xe{constructor(t){super(t),this._blend=0,this._radius=[1,1,1,1],this._stroke=0,this._fc=16777215,this._fillColor=this._getNormalizedColor(4294967295),this._strokeColor=this._getNormalizedColor(16777215)}set blend(t){this._blend=Math.min(Math.max(t,0),1)}set radius(t){Array.isArray(t)?t.length===2?this._radius=[t[0],t[1],t[0],t[1]]:t.length===3?this._radius=[t[0],t[1],t[2],this._radius[3]]:t.length===4?this._radius=t:this._radius=[t[0],t[0],t[0],t[0]]:this._radius=[t,t,t,t],this.redraw()}get radius(){return this._radius}set topLeft(t){this._radius[0]=t,this.redraw()}get topLeft(){return this._radius[0]}set topRight(t){this._radius[1]=t,this.redraw()}get topRight(){return this._radius[1]}set bottomRight(t){this._radius[2]=t,this.redraw()}get bottomRight(){return this._radius[2]}set bottomLeft(t){this._radius[3]=t,this.redraw()}get bottomLeft(){return this._radius[4]}set strokeColor(t){this._sc=t,this._strokeColor=this._getNormalizedColor(t),this.redraw()}get strokeColor(){return this._sc}set fillColor(t){this._fc=t,this._fillColor=this._getNormalizedColor(t),this.redraw()}get fillColor(){return this._fc}set stroke(t){this._stroke=t,this.redraw()}get stroke(){return this._stroke}_getNormalizedColor(t){const n=ye.getRgbaComponentsNormalized(t);return n[0]*=n[3],n[1]*=n[3],n[2]*=n[3],new Float32Array(n)}setupUniforms(t){super.setupUniforms(t);const n=t.shaderOwner,a=this.ctx.stage.getRenderPrecision(),u=this._radius.map(f=>(f+.5)*a);this._setUniform("radius",new Float32Array(u),this.gl.uniform4fv),this._setUniform("alpha",t.getElementCore(0).renderContext.alpha,this.gl.uniform1f),this._setUniform("blend",this._blend,this.gl.uniform1f),this._setUniform("strokeColor",this._strokeColor,this.gl.uniform4fv),this._setUniform("fillColor",this._fillColor,this.gl.uniform4fv),this._setUniform("stroke",this._stroke*a,this.gl.uniform1f),this._setUniform("resolution",new Float32Array([n._w*a,n._h*a]),this.gl.uniform2fv)}}Zd.vertexShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    attribute vec2 aVertexPosition;
    attribute vec2 aTextureCoord;

    attribute vec4 aColor;
    uniform vec2 projection;
    varying vec2 vTextureCoord;
    varying vec4 vColor;

    void main(void){
        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);
        vTextureCoord = aTextureCoord;
        vColor = aColor;
        gl_Position.y = -sign(projection.y) * gl_Position.y;
    }
`;Zd.fragmentShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif

    #define PI 3.14159265359

    varying vec2 vTextureCoord;
    varying vec4 vColor;

    uniform sampler2D uSampler;
    uniform vec2 resolution;
    uniform vec4 radius;
    uniform float stroke;
    uniform vec4 strokeColor;
    uniform vec4 fillColor;
    uniform float alpha;
    uniform float fill;
    uniform float blend;
    
    float boxDist(vec2 p, vec2 size, float radius){
        size -= vec2(radius);
        vec2 d = abs(p) - size;
        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0)) - radius;
    }
    
    float fillMask(float dist){
        return clamp(-dist, 0.0, 1.0);
    }
    
    float innerBorderMask(float dist, float width){
        float alpha1 = clamp(dist + width, 0.0, 1.0);
        float alpha2 = clamp(dist, 0.0, 1.0);
        return alpha1 - alpha2;
    }

    void main() {
        vec2 halfRes = 0.5 * resolution.xy;
        float r = 0.0;
        if (vTextureCoord.x < 0.5 && vTextureCoord.y < 0.5) {
            r = radius[0];
        } else if (vTextureCoord.x >= 0.5 && vTextureCoord.y < 0.5) {
            r = radius[1];
        } else if (vTextureCoord.x >= 0.5 && vTextureCoord.y >= 0.5) {
            r = radius[2];
        } else {
            r = radius[3];
        }
        
        float b = boxDist(vTextureCoord.xy * resolution - halfRes, halfRes - 0.005, r);
        vec4 tex = texture2D(uSampler, vTextureCoord) * vColor;
        vec4 blend = mix(vec4(1.0) * alpha, tex, blend);     
        vec4 layer1 = mix(vec4(0.0), tex * fillColor, fillMask(b));
        gl_FragColor = mix(layer1, blend * strokeColor, innerBorderMask(b, stroke));
    }
`;class i0 extends Xe{constructor(t){super(t),this._fade=[0,0,0,0]}set top(t){this._fade[0]=t,this.redraw()}get top(){return this._fade[0]}set right(t){this._fade[1]=t,this.redraw()}get right(){return this._fade[1]}set bottom(t){this._fade[2]=t,this.redraw()}get bottom(){return this._fade[2]}set left(t){this._fade[3]=t,this.redraw()}get left(){return this._fade[3]}set fade(t){Array.isArray(t)?t.length===2?this._fade=[t[0],t[1],t[0],t[1]]:t.length===3?this._fade=[t[0],t[1],t[2],this._fade[3]]:t.length===4?this._fade=t:this._fade=[t[0],t[0],t[0],t[0]]:this._fade=[t,t,t,t],this.redraw()}get fade(){return this._fade}setupUniforms(t){super.setupUniforms(t);const n=t.shaderOwner,a=this.ctx.stage.getRenderPrecision(),u=this._fade.map(f=>f*a);this._setUniform("fade",new Float32Array(u),this.gl.uniform4fv),this._setUniform("resolution",new Float32Array([n._w*a,n._h*a]),this.gl.uniform2fv)}}i0.fragmentShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    varying vec2 vTextureCoord;
    varying vec4 vColor;
    uniform sampler2D uSampler;
    uniform vec2 resolution;
    uniform vec4 fade;
    
    void main() {
        vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
        vec2 halfRes = 0.5 * resolution.xy;
        vec2 point = vTextureCoord.xy * resolution.xy;
        
        vec2 pos1;
        vec2 pos2;
        vec2 d;
        float c;
        float t = 0.0;
             
        if(fade[0] > 0.0) {
            pos1 = vec2(point.x, point.y);
            pos2 = vec2(point.x, point.y + fade[0]);
            d = pos2 - pos1;
            c = dot(pos1, d) / dot(d, d);
            t = smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0));
            color = mix(vec4(0.0), color, t);
        }
        
        if(fade[1] > 0.0) {
            vec2 pos1 = vec2(point.x - resolution.x - fade[1], vTextureCoord.y);
            vec2 pos2 = vec2(point.x - resolution.x, vTextureCoord.y);
            d = pos1 - pos2;
            c = dot(pos2, d) / dot(d, d);
            t = smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0));
            color = mix(vec4(0.0), color, t);
        }
        
        if(fade[2] > 0.0) {
            vec2 pos1 = vec2(vTextureCoord.x, point.y - resolution.y - fade[2]);
            vec2 pos2 = vec2(vTextureCoord.x, point.y - resolution.y);
            d = pos1 - pos2;
            c = dot(pos2, d) / dot(d, d);
            t = smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0));
            color = mix(vec4(0.0), color, t);
        }
        
        if(fade[3] > 0.0) {
            pos1 = vec2(point.x, point.y);
            pos2 = vec2(point.x + fade[3], point.y);
            d = pos2 - pos1;
            c = dot(pos1, d) / dot(d, d);
            t = smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0));
            color = mix(vec4(0.0), color, t);
        }
        
        gl_FragColor = color;
    }
`;class Qd extends Xe{constructor(t){super(t),this._magnitude=1.3,this._intensity=.7,this._pivot=[.5,.5]}setupUniforms(t){super.setupUniforms(t),this._setUniform("magnitude",this._magnitude,this.gl.uniform1f),this._setUniform("intensity",this._intensity,this.gl.uniform1f),this._setUniform("pivot",new Float32Array(this._pivot),this.gl.uniform2fv),this.redraw()}set pivot(t){Array.isArray(t)?this._pivot=t:this._pivot=[t,t],this.redraw()}get pivotX(){return this._pivot[0]}set pivotX(t){this._pivot[0]=t,this.redraw()}get pivotY(){return this._pivot[1]}set pivotY(t){this._pivot[1]=t,this.redraw()}get intensity(){return this._intensity}set intensity(t){this._intensity=t,this.redraw()}get magnitude(){return this._magnitude}set magnitude(t){this._magnitude=t,this.redraw()}}Qd.vertexShaderSource=Xe.vertexShaderSource;Qd.fragmentShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    varying vec2 vTextureCoord;
    varying vec4 vColor;
    uniform sampler2D uSampler;

    uniform float magnitude;
    uniform float intensity;
    uniform vec2 pivot;

    void main() {
        vec2 uv = vTextureCoord.xy - pivot + vec2(0.5);
        uv.x = clamp(uv.x, 0.0, 1.0);
        uv.y = clamp(uv.y, 0.0, 1.0);
   
        uv *=  1.00 - uv.yx;
        float vig = uv.x * uv.y * 25.0 * intensity;
        vig = pow(vig, 0.45 * magnitude);
        vec4 fragColor = vec4(vig) * vColor;
        gl_FragColor = texture2D(uSampler, vTextureCoord) * fragColor;

    }
`;class Jd extends Xe{constructor(t){super(t),this._radius=100,this._width=50,this._period=1,this._angle=.5,this._smooth=.005,this._color=4294967295,this._backgroundColor=4278190080,this._time=Date.now()}set radius(t){this._radius=t,this.redraw()}set width(t){this._width=t,this.redraw()}set period(t){this._period=t,this.redraw()}set angle(t){this._angle=t,this.redraw()}set smooth(t){this._smooth=t,this.redraw()}set color(t){this._color=t,this.redraw()}set backgroundColor(t){this._backgroundColor=t,this.redraw()}setupUniforms(t){super.setupUniforms(t);const n=t.shaderOwner;this._setUniform("iTime",Date.now()-this._time,this.gl.uniform1f);const a=this.ctx.stage.getRenderPrecision();this._setUniform("radius",this._radius*a,this.gl.uniform1f),this._setUniform("width",this._width*a,this.gl.uniform1f),this._setUniform("period",this._period,this.gl.uniform1f),this._setUniform("angle",this._angle,this.gl.uniform1f),this._setUniform("smooth",this._smooth,this.gl.uniform1f),this._setUniform("color",new Float32Array(ye.getRgbaComponentsNormalized(this._color)),this.gl.uniform4fv),this._setUniform("backgroundColor",new Float32Array(ye.getRgbaComponentsNormalized(this._backgroundColor)),this.gl.uniform4fv),this._setUniform("resolution",new Float32Array([n._w*a,n._h*a]),this.gl.uniform2fv),this.redraw()}}Jd.vertexShaderSource=Xe.vertexShaderSource;Jd.fragmentShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    varying vec2 vTextureCoord;
    varying vec4 vColor;
    uniform sampler2D uSampler;

    uniform float iTime;
    uniform float radius;
    uniform float width;
    uniform float period;
    uniform float angle;
    uniform float smooth;
    uniform vec2 resolution;

    uniform vec4 color;
    uniform vec4 backgroundColor;

    float ratio = resolution.y / resolution.x;

    vec2 transpose_pos(vec2 pos) {
        if (ratio < 1.) {
            float diff = 0.5 - pos.x;
            pos.x = 0.5 - diff / ratio;
        } else {
            float diff = 0.5 - pos.y;
            pos.y = 0.5 - diff * ratio;
        }
        return pos;
    }

    float get_angle(vec2 pos) {
        pos = transpose_pos(pos);
        float a = atan(pos.y - 0.5, pos.x - 0.5);
        a = (1.0+a/3.14159)/2.0;
        
        return a;
    }

    float dist(vec2 pos1, vec2 pos2) {
        pos1 = transpose_pos(pos1);
        return distance(pos1, pos2);
    }

    void main()
    {
        vec2 fragCoord = vTextureCoord;
        vec4 fragColor = vColor;
        
        vec2 st = vTextureCoord;
        float pct = dist(st, vec2(0.5));

        float a = get_angle(st);
        float t = iTime / 1000.0 / period;

        float inner = max((radius - width) / resolution.x, (radius - width) / resolution.y);
        float outer = max(radius / resolution.x, radius / resolution.y);

        float x1 = mod(t, 1.0);
        float x2 = mod(t + angle, 1.0);

        if (x1 < x2) {
            if (a > x1 && a < x2) {
                float val = (1.0 - (x2 - a) / angle) * smoothstep(0.0, 3. * smooth, (x2 - a));
                fragColor = mix(backgroundColor, color, val);
            } else {
                fragColor = backgroundColor;
            }
        } else {
            if (a < x2) {
                float val = (1.0 - (x2 - a) / angle) * smoothstep(0.0, 3. * smooth, (x2 - a));
                fragColor = mix(backgroundColor, color, val);
            } else if (a > x1) {
                float val = (1.0 - (1.0 + x2 - a) / angle) * smoothstep(0.0, 3. * smooth, (1.0 + x2 - a));
                fragColor = mix(backgroundColor, color, val);
            } else {
                fragColor = backgroundColor;
            }
        }

        float s = smoothstep(inner, inner + smooth + 0.00001, pct) * (1.0 - smoothstep(outer, outer + smooth + 0.00001, pct));
        gl_FragColor = texture2D(uSampler, fragCoord) * vColor * (1. - s * fragColor.a) + fragColor * s;
    }
`;class ef extends Xe{constructor(t){super(t),this._x=0,this._y=0,this._w=0,this._h=0,this._radius=0}get x(){return this._x}set x(t){this._x=t,this.redraw()}get y(){return this._y}set y(t){this._y=t,this.redraw()}get w(){return this._w}set w(t){this._w=t,this.redraw()}get h(){return this._h}set h(t){this._h=t,this.redraw()}get radius(){return this._radius}set radius(t){this._radius=t,this.redraw()}setupUniforms(t){super.setupUniforms(t);const n=t.shaderOwner,a=this.ctx.stage.getRenderPrecision();this._setUniform("x",this._x*a,this.gl.uniform1f),this._setUniform("y",this._y*a,this.gl.uniform1f),this._setUniform("w",this._w*a,this.gl.uniform1f),this._setUniform("h",this._h*a,this.gl.uniform1f),this._setUniform("radius",(this._radius+.5)*a,this.gl.uniform1f),this._setUniform("resolution",new Float32Array([n._w*a,n._h*a]),this.gl.uniform2fv)}useDefault(){return this._x===0&&this._y===0&&this._w===0&&this._h===0}}ef.vertexShaderSource=Xe.vertexShaderSource;ef.fragmentShaderSource=`
   #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    varying vec2 vTextureCoord;
    varying vec4 vColor;
    uniform sampler2D uSampler;
    uniform float x;
    uniform float y;
    uniform float w;
    uniform float h;
    uniform vec2 resolution;
    uniform float radius;

    float roundBox(vec2 p, vec2 b, float r) {
        float d = length(max(abs(p)-b+r, 0.1))-r;
        return smoothstep(1.0, 0.0, d);
    }

    void main(void){
        vec4 color = texture2D(uSampler, vTextureCoord);
        vec2 pos = vTextureCoord.xy * resolution - vec2(x, y) - vec2(w, h) / 2.0;
        vec2 size = vec2(w, h) / 2.0;
        float b = roundBox(pos, size, radius);
        gl_FragColor = mix(color, vec4(0.0), b);
    }
`;class r0 extends Xe{constructor(t){super(t),this._pivot=[0,0],this._ic=4294967295,this._normalizedIC=this._getNormalizedColor(this._ic),this._oc=16777215,this._normalizedOC=this._getNormalizedColor(this._oc),this._radius=0}set radiusX(t){this.radius=t}get radiusX(){return this._radius}set radiusY(t){this._radiusY=t,this.redraw()}get radiusY(){return this._radiusY}set radius(t){this._radius=t,this.redraw()}set innerColor(t){this._ic=t,this._normalizedIC=this._getNormalizedColor(t),this.redraw()}get innerColor(){return this._ic}set outerColor(t){this._oc=t,this._normalizedOC=this._getNormalizedColor(t),this.redraw()}set color(t){this.innerColor=t}get color(){return this.innerColor}get outerColor(){return this._ic}set x(t){this._x=t,this.redraw()}set y(t){this._y=t,this.redraw()}set pivot(t){Array.isArray(t)&&t.length===2?this._pivot=t:Array.isArray(t)?this._pivot=[t[0],t[1]||t[0]]:this._pivot=[t,t],this.redraw()}get pivot(){return this._pivot[0]}set pivotY(t){this._pivot[1]=t,this.redraw()}get pivotY(){return this._pivot[1]}set pivotX(t){this._pivot[0]=t,this.redraw()}get pivotX(){return this._pivot[0]}_getNormalizedColor(t){const n=ye.getRgbaComponentsNormalized(t);return n[0]*=n[3],n[1]*=n[3],n[2]*=n[3],new Float32Array(n)}setupUniforms(t){super.setupUniforms(t);const n=t.shaderOwner;this._x&&(this._pivot[0]=this._x/n.w),this._y&&(this._pivot[1]=this._y/n.h),this._radius===0&&(this._radius=n.w*.5),this._setUniform("innerColor",this._normalizedIC,this.gl.uniform4fv),this._setUniform("fill",ye.getRgbaComponentsNormalized(this._oc)[3],this.gl.uniform1f),this._setUniform("outerColor",this._normalizedOC,this.gl.uniform4fv),this._setUniform("pivot",new Float32Array(this._pivot),this.gl.uniform2fv),this._setUniform("resolution",new Float32Array([n._w,n._h]),this.gl.uniform2fv),this._setUniform("alpha",t.getElementCore(0).renderContext.alpha,this.gl.uniform1f),this._setUniform("radius",this._radius,this.gl.uniform1f),this._setUniform("radiusY",this._radiusY||this._radius,this.gl.uniform1f)}}r0.fragmentShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    
    #define PI 3.14159265359
    
    varying vec2 vTextureCoord;
    varying vec4 vColor;
    uniform sampler2D uSampler;
    uniform vec2 resolution;
    uniform vec2 pivot;
    uniform vec4 innerColor;
    uniform vec4 outerColor;
    uniform float radius;
    uniform float radiusY;
    uniform float alpha;
    uniform float fill;
    uniform float aspectRatio;
    
    void main() {
        vec2 point = vTextureCoord.xy * resolution;
        vec2 projection = vec2(pivot.x * resolution.x, pivot.y * resolution.y);
        float d = length((point - projection) / vec2(radius * 2.0, radiusY * 2.0));
        vec4 color = mix(texture2D(uSampler, vTextureCoord) * vColor, outerColor * alpha, fill);
        gl_FragColor = mix(innerColor * alpha, color, smoothstep(0.0, 1.0, d));
    }
`;class tf extends Xe{constructor(t){super(t),this._strength=.5,this._ambient=.5,this._fudge=.4,this._rx=0,this._ry=0,this._z=0,this._pivotX=NaN,this._pivotY=NaN,this._pivotZ=0,this._lightY=0,this._lightZ=0}setupUniforms(t){super.setupUniforms(t);let n=t.shaderOwner,a=n.element,u=isNaN(this._pivotX)?a.pivotX*n.w:this._pivotX,f=isNaN(this._pivotY)?a.pivotY*n.h:this._pivotY,m=n.getRenderTextureCoords(u,f),p=-Math.atan2(n._renderContext.tc,n._renderContext.ta),x=this.gl;this._setUniform("pivot",new Float32Array([m[0],m[1],this._pivotZ]),x.uniform3fv),this._setUniform("rot",new Float32Array([this._rx,this._ry,p]),x.uniform3fv),this._setUniform("z",this._z,x.uniform1f),this._setUniform("lightY",this.lightY,x.uniform1f),this._setUniform("lightZ",this.lightZ,x.uniform1f),this._setUniform("strength",this._strength,x.uniform1f),this._setUniform("ambient",this._ambient,x.uniform1f),this._setUniform("fudge",this._fudge,x.uniform1f)}set strength(t){this._strength=t,this.redraw()}get strength(){return this._strength}set ambient(t){this._ambient=t,this.redraw()}get ambient(){return this._ambient}set fudge(t){this._fudge=t,this.redraw()}get fudge(){return this._fudge}get rx(){return this._rx}set rx(t){this._rx=t,this.redraw()}get ry(){return this._ry}set ry(t){this._ry=t,this.redraw()}get z(){return this._z}set z(t){this._z=t,this.redraw()}get pivotX(){return this._pivotX}set pivotX(t){this._pivotX=t+1,this.redraw()}get pivotY(){return this._pivotY}set pivotY(t){this._pivotY=t+1,this.redraw()}get lightY(){return this._lightY}set lightY(t){this._lightY=t,this.redraw()}get pivotZ(){return this._pivotZ}set pivotZ(t){this._pivotZ=t,this.redraw()}get lightZ(){return this._lightZ}set lightZ(t){this._lightZ=t,this.redraw()}useDefault(){return this._rx===0&&this._ry===0&&this._z===0&&this._strength===0&&this._ambient===1}}tf.vertexShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    attribute vec2 aVertexPosition;
    attribute vec2 aTextureCoord;
    attribute vec4 aColor;
    uniform vec2 projection;
    varying vec2 vTextureCoord;
    varying vec4 vColor;

    uniform float fudge;
    uniform float strength;
    uniform float ambient;
    uniform float z;
    uniform float lightY;
    uniform float lightZ;
    uniform vec3 pivot;
    uniform vec3 rot;
    varying vec3 pos;

    void main(void) {
        pos = vec3(aVertexPosition.xy, z);
        
        pos -= pivot;
        
        // Undo XY rotation
        mat2 iRotXy = mat2( cos(rot.z), sin(rot.z), 
                           -sin(rot.z), cos(rot.z));
        pos.xy = iRotXy * pos.xy;
        
        // Perform 3d rotations
        gl_Position.x = cos(rot.x) * pos.x - sin(rot.x) * pos.z;
        gl_Position.y = pos.y;
        gl_Position.z = sin(rot.x) * pos.x + cos(rot.x) * pos.z;
        
        pos.x = gl_Position.x;
        pos.y = cos(rot.y) * gl_Position.y - sin(rot.y) * gl_Position.z;
        pos.z = sin(rot.y) * gl_Position.y + cos(rot.y) * gl_Position.z;
        
        // Redo XY rotation
        iRotXy[0][1] = -iRotXy[0][1];
        iRotXy[1][0] = -iRotXy[1][0];
        pos.xy = iRotXy * pos.xy; 

        // Undo translate to pivot position
        pos.xyz += pivot;

        pos = vec3(pos.x * projection.x - 1.0, pos.y * -abs(projection.y) + 1.0, pos.z * projection.x);
        
        // Set depth perspective
        float perspective = 1.0 + fudge * pos.z;

        pos.z += lightZ * projection.x;

        // Map coords to gl coordinate space.
        // Set z to 0 because we don't want to perform z-clipping
        gl_Position = vec4(pos.xy, 0.0, perspective);

        // Correct light source position.
        pos.y += lightY * abs(projection.y);

        vTextureCoord = aTextureCoord;
        vColor = aColor;
        
        gl_Position.y = -sign(projection.y) * gl_Position.y;
    }
`;tf.fragmentShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    varying vec2 vTextureCoord;
    varying vec4 vColor;
    varying vec3 pos;
    uniform sampler2D uSampler;
    uniform float ambient;
    uniform float strength;
    void main(void){
        vec4 rgba = texture2D(uSampler, vTextureCoord);
        float d = length(pos);
        float n = 1.0 / max(0.1, d);
        rgba.rgb = rgba.rgb * (strength * n + ambient);
        gl_FragColor = rgba * vColor;
    }
`;class rf extends Xe{constructor(t){super(t),this._fudge=.2,this._rx=0,this._ry=0,this._z=1}setupUniforms(t){super.setupUniforms(t);const n=t.shaderOwner,a=n.element,u=a.pivotX*n.w,f=a.pivotY*n.h,m=n.getRenderTextureCoords(u,f),p=-Math.atan2(n._renderContext.tc,n._renderContext.ta),x=this.gl;this._setUniform("pivot",new Float32Array([m[0],m[1],0]),x.uniform3fv),this._setUniform("rot",new Float32Array([this._rx,this._ry,p]),x.uniform3fv),this._setUniform("z",this._z,x.uniform1f),this._setUniform("fudge",this._fudge,x.uniform1f)}set fudge(t){this._fudge=t,this.redraw()}get fudge(){return this._fudge}get rx(){return this._rx}set rx(t){this._rx=t,this.redraw()}get ry(){return this._ry}set ry(t){this._ry=t,this.redraw()}get z(){return this._z}set z(t){this._z=t,this.redraw()}useDefault(){return this._rx===0&&this._ry===0&&this._z===0}}rf.vertexShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    attribute vec2 aVertexPosition;
    attribute vec2 aTextureCoord;
    attribute vec4 aColor;
    uniform vec2 projection;
    varying vec2 vTextureCoord;
    varying vec4 vColor;

    uniform float z;
    uniform vec3 pivot;
    uniform vec3 rot;
    varying vec3 pos;

    void main(void) {
        pos = vec3(aVertexPosition.xy, z);
        
        pos -= pivot;
        
        // Undo XY rotation
        mat2 iRotXy = mat2( cos(rot.z), sin(rot.z), 
                           -sin(rot.z), cos(rot.z));
        pos.xy = iRotXy * pos.xy;
        
        // Perform 3d rotations
        gl_Position.x = cos(rot.x) * pos.x - sin(rot.x) * pos.z;
        gl_Position.y = pos.y;
        gl_Position.z = sin(rot.x) * pos.x + cos(rot.x) * pos.z;
        
        pos.x = gl_Position.x;
        pos.y = cos(rot.y) * gl_Position.y - sin(rot.y) * gl_Position.z;
        pos.z = sin(rot.y) * gl_Position.y + cos(rot.y) * gl_Position.z;
        
        // Redo XY rotation
        iRotXy[0][1] = -iRotXy[0][1];
        iRotXy[1][0] = -iRotXy[1][0];
        pos.xy = iRotXy * pos.xy; 

        // Undo translate to pivot position
        pos.xyz += pivot;

        pos = vec3(pos.x * projection.x - 1.0, pos.y * -abs(projection.y) + 1.0, pos.z * projection.x);
        
        // Map coords to gl coordinate space.
        // Set z to 0 because we don't want to perform z-clipping
        gl_Position = vec4(pos.xy, 0.0, z);

        vTextureCoord = aTextureCoord;
        vColor = aColor;
        
        gl_Position.y = -sign(projection.y) * gl_Position.y;
    }
`;rf.fragmentShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    varying vec2 vTextureCoord;
    varying vec4 vColor;
    uniform sampler2D uSampler;

    uniform vec3 rot;
    uniform float fudge;

    void main(void) {
        vec2 coords = vTextureCoord;

        coords.xy -= vec2(0.5);
        coords.y = coords.y + (sign(rot[0]) * 0.5 - coords.x) * sin(rot[0]) * fudge * coords.y;
        coords.x = coords.x + (sign(rot[1]) * 0.5 - coords.y) * sin(rot[1]) * fudge * coords.x;
        coords.xy += vec2(0.5);

        if (coords.x < 0.0 || coords.x > 1.0 || coords.y < 0.0 || coords.y > 1.0) {
            gl_FragColor = vec4(0.0);
        } else {
            gl_FragColor = texture2D(uSampler, coords) * vColor;
        }
    }
`;class nf extends Xe{constructor(t){super(t),this._x=0,this._y=0,this._w=0,this._h=0,this._radius=0,this._magnification=.6}get x(){return this._x}set x(t){this._x=t,this.redraw()}get y(){return this._y}set y(t){this._y=t,this.redraw()}get w(){return this._w}set w(t){this._w=t,this.redraw()}get h(){return this._h}set h(t){this._h=t,this.redraw()}get magnification(){return this._magnification}set magnification(t){this._magnification=t,this.redraw()}get radius(){return this._radius}set radius(t){this._radius=t,this.redraw()}setupUniforms(t){super.setupUniforms(t);const n=t.shaderOwner,a=this.ctx.stage.getRenderPrecision();this._setUniform("x",this._x*a,this.gl.uniform1f),this._setUniform("y",this._y*a,this.gl.uniform1f),this._setUniform("w",this._w*a,this.gl.uniform1f),this._setUniform("h",this._h*a,this.gl.uniform1f),this._setUniform("magnification",this._magnification,this.gl.uniform1f),this._setUniform("radius",(this._radius+.5)*a,this.gl.uniform1f),this._setUniform("resolution",new Float32Array([n._w*a,n._h*a]),this.gl.uniform2fv)}useDefault(){return this._w===0&&this._h===0}}nf.vertexShaderSource=Xe.vertexShaderSource;nf.fragmentShaderSource=`
	  #ifdef GL_ES
		# ifdef GL_FRAGMENT_PRECISION_HIGH
		precision highp float;
		# else
		precision lowp float;
		# endif
	  #endif

	  varying vec2 vTextureCoord;
	  varying vec4 vColor;
	  uniform sampler2D uSampler;
	  uniform float x;
	  uniform float y;
	  uniform float w;
	  uniform float h;
	  uniform vec2 resolution;
	  uniform float radius;
	  uniform float magnification;
  
	  float roundBox(vec2 p, vec2 b, float r) {
		  float d = length(max(abs(p)-b+r, 0.1))-r;
		  return smoothstep(1.0, 0.0, d);
	  }

	  float inside(vec2 v) {
		vec2 s = step(vec2(0.0, 0.0), v) - step(vec2(1.0, 1.0), v);
		return s.x * s.y;   
      }
  
	  void main(void) {
		vec4 color = texture2D(uSampler, vTextureCoord);
		vec2 pos = vTextureCoord.xy * resolution - vec2(x, y) - vec2(w, h) / 2.0;
		vec2 size = vec2(w, h) / 2.0;
		float b = roundBox(pos, size, radius);
		vec2 pos2 = (vTextureCoord.xy * magnification * resolution + vec2(x, y) * magnification) / resolution;
		gl_FragColor = mix(color, texture2D(uSampler, pos2) * inside(pos2), b) * vColor;
	  }
  `;class Do extends Xe{constructor(t){super(t),this._period=1,this._stroke=0,this._showDot=!0,this._clockwise=!0,this._bc=4278190080,this._normalizedBC=this._getNormalizedColor(this._bc),this._c=4294967295,this._normalizedC=this._getNormalizedColor(this._c)}set radius(t){t===0&&(t=1),this._radius=t}set stroke(t){this._stroke=Math.abs(t)}get stroke(){return this._stroke}set color(t){this._c=t,this._normalizedC=this._getNormalizedColor(t)}get color(){return this._c}set backgroundColor(t){this._bc=t,this._normalizedBC=this._getNormalizedColor(t)}get backgroundColor(){return this._sc}set showDot(t){this._showDot=t}get showDot(){return this._showDot}set clockwise(t){this._clockwise=t}get clockwise(){return this._clockwise}set period(t){this._period=t}get period(){return this._period}_getNormalizedColor(t){const n=ye.getRgbaComponentsNormalized(t);return n[0]*=n[3],n[1]*=n[3],n[2]*=n[3],new Float32Array(n)}setupUniforms(t){super.setupUniforms(t);const n=t.shaderOwner,a=this._radius||n._w/2;this._stroke===0&&(this._stroke=a*.33),this._setUniform("resolution",new Float32Array([n._w,n._h]),this.gl.uniform2fv),this._setUniform("color",this._normalizedC,this.gl.uniform4fv),this._setUniform("backgroundColor",this._normalizedBC,this.gl.uniform4fv),this._setUniform("stroke",this._stroke,this.gl.uniform1f),this._setUniform("radius",a,this.gl.uniform1f),this._setUniform("direction",this._clockwise?-1:1,this.gl.uniform1f),this._setUniform("showDot",!!this._showDot,this.gl.uniform1f),this._setUniform("time",Date.now()-Do.spinSync,this.gl.uniform1f),this._setUniform("period",this._period,this.gl.uniform1f),this._setUniform("alpha",t.getElementCore(0).renderContext.alpha,this.gl.uniform1f),(this._sc!==this._bc||this._stroke!==a*.5)&&this.redraw()}}Do.spinSync=Date.now();Do.fragmentShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    
    #define PI 3.14159265359
    
    varying vec2 vTextureCoord;
    varying vec4 vColor;
    
    uniform sampler2D uSampler;
    uniform vec2 resolution;
    uniform vec4 color;
    uniform vec4 backgroundColor;
    uniform float direction;
    uniform float radius;
    uniform float time;
    uniform float stroke;
    uniform float showDot;
    uniform float period;
    uniform float alpha;
    
    float circleDist(vec2 p, float radius){
        return length(p) - radius;
    }
    
    float fillMask(float dist){
        return clamp(-dist, 0.0, 1.0);
    }
    
    void main() {
        vec2 halfRes = 0.5 * resolution.xy;
        vec2 center = vTextureCoord.xy * resolution - halfRes;
        
        float c = max(-circleDist(center, radius - stroke), circleDist(center, radius));
        float rot = -(time / 1000.0 / period) * 6.0 * direction;
        center *= mat2(cos(rot), sin(rot), -sin(rot), cos(rot));
        
        float a = direction * atan(center.x, center.y) * PI * 0.05 + 0.45;
        
        float strokeRad = stroke * 0.5;
        a = mix(a, max(a, fillMask(circleDist(vec2(center.x, center.y + (radius - strokeRad)), strokeRad))), showDot);
        vec4 base = mix(vec4(0.0), backgroundColor * alpha, fillMask(c));
        gl_FragColor = mix(base, color * alpha, fillMask(c) * a);
    }
`;const J={Application:Nb,Component:mt,Base:Ct,Utils:X,StageUtils:ye,Element:Yt,Tools:wo,Stage:pn,ElementCore:fn,ElementTexturizer:Fv,Texture:Zt,EventEmitter:at,shaders:{Grayscale:Gd,BoxBlur:Ri,Dithering:Xd,CircularPush:qd,Inversion:t0,LinearBlur:ru,Outline:$d,Pixelate:Yd,RadialFilter:Kd,RoundedRectangle:Zd,Spinner2:Do,FadeOut:i0,Hole:ef,Vignette:Qd,Spinner:Jd,RadialGradient:r0,Light3d:tf,Perspective:rf,Magnifier:nf,WebGLShader:eu,WebGLDefaultShader:Xe,C2dShader:jd,C2dDefaultShader:tu,c2d:{Grayscale:e0,Blur:Zv}},textures:{RectangleTexture:Xv,NoiseTexture:Kv,TextTexture:cn,ImageTexture:Td,HtmlTexture:Wd,StaticTexture:Ub,StaticCanvasTexture:qv,SourceTexture:Nv},components:{FastBlurComponent:jb,BloomComponent:Vb,SmoothScaleComponent:Xl,BorderComponent:Wb,ListComponent:zb},tools:{ObjMerger:Vd,ObjectListProxy:$v,ObjectListWrapper:Yv}};X.isWeb&&(window.lng=J);let It=class extends J.shaders.WebGLDefaultShader{set brightness(t){this._brightness=(t-50)/100,this.redraw()}set contrast(t){this._contrast=(t+50)/100,this.redraw()}set gamma(t){this._gamma=(t+50)/100,this.redraw()}setupUniforms(t){super.setupUniforms(t);const n=this.gl;this._setUniform("colorAdjust",[this._brightness||0,this._contrast||1,this._gamma||1],n.uniform3fv)}};It.before=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
        
    varying vec2 vTextureCoord;
    varying vec4 vColor;
    uniform sampler2D uSampler;
    uniform vec3 colorAdjust;
    
    const mat3 RGBtoOpponentMat = mat3(0.2814, -0.0971, -0.0930, 0.6938, 0.1458,-0.2529, 0.0638, -0.0250, 0.4665);
    const mat3 OpponentToRGBMat = mat3(1.1677, 0.9014, 0.7214, -6.4315, 2.5970, 0.1257, -0.5044, 0.0159, 2.0517);    
`;It.after=`    
    vec3 brightnessContrast(vec3 value, float brightness, float contrast)
    {
        return (value - 0.5) * contrast + 0.5 + brightness;
    }   
    
    vec3 updateGamma(vec3 value, float param)
    {
        return vec3(pow(abs(value.r), param),pow(abs(value.g), param),pow(abs(value.b), param));
    } 
       
    void main(void){
        vec4 fragColor = texture2D(uSampler, vTextureCoord);        
        vec4 color = filter(fragColor) * vColor;       
        
        vec3 bc = brightnessContrast(color.rgb,colorAdjust[0],colorAdjust[1]);        
        vec3 ga = updateGamma(bc.rgb, colorAdjust[2]);  
              
        gl_FragColor = vec4(ga.rgb, color.a);          
    }    
`;class n0 extends It{}n0.fragmentShaderSource=`
    ${It.before}    
    vec4 vision(vec4 color)
    {
        vec4 r = vec4( 0.20,  0.99, -0.19, 0.0);
        vec4 g = vec4( 0.16,  0.79,  0.04, 0.0);
        vec4 b = vec4( 0.01, -0.01,  1.00, 0.0);
       
        return vec4(dot(color, r), dot(color, g), dot(color, b), color.a);	
    }
    
    vec4 filter( vec4 color )
    {   
        vec3 opponentColor = RGBtoOpponentMat * vec3(color.r, color.g, color.b);
        opponentColor.x -= opponentColor.y * 1.5; 
        vec3 rgbColor = OpponentToRGBMat * opponentColor;
        return vision(vec4(rgbColor.r, rgbColor.g, rgbColor.b, color.a));      
    }    
    ${It.after} 
`;class s0 extends It{}s0.fragmentShaderSource=`
    ${It.before}
    vec4 vision(vec4 color)
    {
        vec4 r = vec4( 0.43,  0.72, -0.15, 0.0 );
        vec4 g = vec4( 0.34,  0.57,  0.09, 0.0 );
        vec4 b = vec4(-0.02,  0.03,  1.00, 0.0 );
       
        return vec4(dot(color, r), dot(color, g), dot(color, b), color.a);	
    }
       
    vec4 filter( vec4 color )
    {   
        vec3 opponentColor = RGBtoOpponentMat * vec3(color.r, color.g, color.b);
        opponentColor.x -= opponentColor.y * 1.5; 
        vec3 rgbColor = OpponentToRGBMat * opponentColor;
        return vision(vec4(rgbColor.r, rgbColor.g, rgbColor.b, color.a));    
    }
    ${It.after}    
`;class o0 extends It{}o0.fragmentShaderSource=`
    ${It.before}    
    vec4 vision(vec4 color)
    {
        vec4 r = vec4( 0.97,  0.11, -0.08, 0.0 );
        vec4 g = vec4( 0.02,  0.82,  0.16, 0.0 );
        vec4 b = vec4(-0.06,  0.88,  0.18, 0.0 );
       
        return vec4(dot(color, r), dot(color, g), dot(color, b), color.a);	
    }   
    
    vec4 filter( vec4 color )
    {   
        vec3 opponentColor = RGBtoOpponentMat * vec3(color.r, color.g, color.b);
        opponentColor.x -= ((3.0 * opponentColor.z) - opponentColor.y) * 0.25;
        vec3 rgbColor = OpponentToRGBMat * opponentColor;
        return vision(vec4(rgbColor.r, rgbColor.g, rgbColor.b, color.a));
    }   
    ${It.after} 
`;class a0 extends It{}a0.fragmentShaderSource=`
    ${It.before}
    vec4 filter( vec4 color )
    {
        return color;
    }
    ${It.after}
`;class l0 extends It{}l0.fragmentShaderSource=`
    ${It.before}
    vec4 filter( vec4 color )
    {   
        float grey = dot(color.rgb, vec3(0.299, 0.587, 0.114));
        return vec4(vec3(grey, grey, grey), 1.0 ); 
    }
    ${It.after}
`;const Gb=c=>{const t={normal:a0,monochromacy:l0,deuteranopia:s0,tritanopia:o0,protanopia:n0};return c=typeof c=="string"&&c.toLowerCase()||null,Object.keys(t).indexOf(c)>-1?t[c]:!1},Xb={colorshift(c,t=!1,n={brightness:50,contrast:50,gamma:50}){n={brightness:50,contrast:50,gamma:50,...n};const a=t&&Gb(t);a?(ge.info("Accessibility Colorshift",t,n),c.rtt=!0,c.shader={type:a,...n}):(ge.info("Accessibility Colorshift","Disabled"),c.rtt=!1,c.shader=null)}};let Oo,hr,Cr,Pl,Ad;const po={set log(c){Oo=c},set settings(c){hr=c},set ads(c){Pl=c},set lightning(c){Ad=c},set appInstance(c){Cr=c}},qb=c=>{Co=c.sendMetric};let Co=(c,t,n)=>{Oo.info("Sending metric",c,t,n)};const $b={app:["launch","loaded","ready","close"],page:["view","leave"],user:["click","input"],media:["abort","canplay","ended","pause","play","volumechange","waiting","seeking","seeked"]},u0=(c,t,n,a,u={})=>{u={params:u,message:t,code:n,visible:a},Co(c,"error",u)},Kx=(c,t,n={})=>t.reduce((a,u)=>(a[u]=(f,m={})=>{m={...n,...f?{name:f}:{},...m},Co(c,u,m)},a),{error(a,u,f){u0(c,a,u,f)},event(a,u){Co(c,a,u)}}),Yb=c=>Object.keys(c).reduce((t,n)=>(n==="media"?t[n]=a=>Kx(n,c[n],{url:a}):t[n]=Kx(n,c[n]),t),{error:u0,event:Co}),sf=Yb($b),of=c=>c&&c.length===2?`${c.toLowerCase()}-${c.toUpperCase()}`:c,Kb=c=>{if("language"in navigator){const t=of(navigator.language);return Promise.resolve(t)}else return Promise.resolve(c)},Zb=c=>{if("language"in navigator){const t=of(navigator.language).slice(0,2);return Promise.resolve(t)}else return Promise.resolve(c)},Qb=c=>{if("language"in navigator){const t=of(navigator.language).slice(3,5);return Promise.resolve(t)}else return Promise.resolve(c)},Jb=()=>new Promise(c=>{hr.get("platform","forceBrowserGeolocation")===!0&&c(!0),"permissions"in navigator&&typeof navigator.permissions.query=="function"?navigator.permissions.query({name:"geolocation"}).then(t=>{c(t.state==="granted"||t.status==="granted")}):c(!1)}),eI=c=>new Promise(t=>{Jb().then(n=>{if(n===!0)if("geolocation"in navigator)navigator.geolocation.getCurrentPosition(a=>a&&a.coords&&t([a.coords.latitude,a.coords.longitude]),()=>t(c),{enableHighAccuracy:!0,timeout:5e3,maximumAge:0});else return Zx().then(a=>t(a||c));else return Zx().then(a=>t(a||c))})}),Zx=()=>new Promise(c=>{fetch("https://geolocation-db.com/json/").then(t=>t.json()).then(({latitude:t,longitude:n})=>c(t&&n?[t,n]:!1)).catch(()=>c(!1))}),Ed={ageRating:"adult",city:"New York",zipCode:"27505",countryCode:()=>Qb("US"),ip:"127.0.0.1",household:"b2244e9d4c04826ccd5a7b2c2a50e7d4",language:()=>Zb("en"),latlon:()=>eI([40.7128,74.006]),locale:()=>Kb("en-US"),mac:"00:00:00:00:00:00",operator:"metrological",platform:"metrological",packages:[],uid:"ee6723b8-7ab3-462c-8d93-dbf61227998e",stbType:"metrological"};let Qx=c=>{const t={...Ed,...hr.get("platform","profile")};return Promise.resolve(typeof t[c]=="function"?t[c]():t[c])},Jx=(c,t)=>{if(c in Ed)return Ed[c]=t};const tI=c=>{Qx=c.getInfo?c.getInfo:Qx,Jx=c.setInfo?c.setInfo:Jx},iI=c=>{c.billingUrl&&c.billingUrl},rI=[{number:1,name:"Metro News 1",description:"New York Cable News Channel",entitled:!0,program:{title:"The Morning Show",description:"New York's best morning show",startTime:new Date(new Date-60*5*1e3).toUTCString(),duration:60*30,ageRating:0}},{number:2,name:"MTV",description:"Music Television",entitled:!0,program:{title:"Beavis and Butthead",description:"American adult animated sitcom created by Mike Judge",startTime:new Date(new Date-60*20*1e3).toUTCString(),duration:60*45,ageRating:18}},{number:3,name:"NBC",description:"NBC TV Network",entitled:!1,program:{title:"The Tonight Show Starring Jimmy Fallon",description:"Late-night talk show hosted by Jimmy Fallon on NBC",startTime:new Date(new Date-60*10*1e3).toUTCString(),duration:60*60,ageRating:10}}],Cd=()=>hr.get("platform","tv",rI),ev=()=>Cd()[~~(Cd.length*Math.random())];let zi;const tv={},h0=(c,...t)=>{tv[c]&&tv[c].forEach(n=>{n.apply(null,t)})};let Ml={getChannel(){return zi||(zi=ev()),new Promise((c,t)=>{if(zi){const n={...zi};delete n.program,c(n)}else t("No channel found")})},getProgram(){return zi||(zi=ev()),new Promise((c,t)=>{zi.program?c(zi.program):t("No program found")})},setChannel(c){return new Promise((t,n)=>{if(c){const a=Cd().find(u=>u.number===c);if(a){zi=a;const u={...zi};delete u.program,h0("channelChange",u),t(u)}else n("Channel not found")}else n("No channel number supplied")})}};const nI=c=>{Ml={},c.getChannel&&typeof c.getChannel=="function"&&(Ml.getChannel=c.getChannel),c.getProgram&&typeof c.getProgram=="function"&&(Ml.getProgram=c.getProgram),c.setChannel&&typeof c.setChannel=="function"&&(Ml.setChannel=c.setChannel),c.emit&&typeof c.emit=="function"&&c.emit(h0)},sI=c=>{c.submit&&typeof c.submit=="function"&&c.submit,c.check&&typeof c.check=="function"&&c.check},oI=(c,t=null,n=null)=>{let a;if(c&&typeof c=="function")try{a=c.apply(n,t)}catch(u){a=u}else a=c;return a!==null&&typeof a=="object"&&a.then&&typeof a.then=="function"?a:new Promise((u,f)=>{a instanceof Error?f(a):u(a)})},iv={abort:"Abort",canplay:"CanPlay",canplaythrough:"CanPlayThrough",durationchange:"DurationChange",emptied:"Emptied",encrypted:"Encrypted",ended:"Ended",error:"Error",interruptbegin:"InterruptBegin",interruptend:"InterruptEnd",loadeddata:"LoadedData",loadedmetadata:"LoadedMetadata",loadstart:"LoadStart",pause:"Pause",play:"Play",playing:"Playing",progress:"Progress",ratechange:"Ratechange",seeked:"Seeked",seeking:"Seeking",stalled:"Stalled",timeupdate:"TimeUpdate",volumechange:"VolumeChange",waiting:"Waiting"},aI=(c,t=()=>{})=>{let n=!1;const a=()=>{n===!1&&(t(),n=!0)};return Object.keys(c).reduce((u,f)=>(typeof c[f]=="function"?u[f]=function(){return a(),c[f].apply(c,arguments)}:typeof Object.getOwnPropertyDescriptor(c,f).get=="function"?u.__defineGetter__(f,function(){return a(),Object.getOwnPropertyDescriptor(c,f).get.apply(c)}):typeof Object.getOwnPropertyDescriptor(c,f).set=="function"?u.__defineSetter__(f,function(){return a(),Object.getOwnPropertyDescriptor(c,f).set.sourceObject[f].apply(c,arguments)}):u[f]=c[f],u),{})};let rv=null;const lI=(c,t)=>{clearTimeout(rv),rv=setTimeout(()=>{c()},t)},uI=()=>class extends Ad.Component{static _template(){return{Video:{alpha:1,visible:!1,pivot:.5,texture:{type:Ad.textures.StaticTexture,options:{}}}}}set videoEl(t){this._videoEl=t}get videoEl(){return this._videoEl}get videoView(){return this.tag("Video")}get videoTexture(){return this.videoView.texture}get isVisible(){return this.videoView.alpha===1&&this.videoView.visible===!0}_init(){this._createVideoTexture()}_createVideoTexture(){const n=this.stage.gl,a=n.createTexture();n.bindTexture(n.TEXTURE_2D,a),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),this.videoTexture.options={source:a,w:this.videoEl.width,h:this.videoEl.height},this.videoView.w=this.videoEl.width/this.stage.getRenderPrecision(),this.videoView.h=this.videoEl.height/this.stage.getRenderPrecision()}start(){const t=this.stage;this._lastTime=0,this._updateVideoTexture||(this._updateVideoTexture=()=>{if(this.videoTexture.options.source&&this.videoEl.videoWidth&&this.active){const n=t.gl,a=new Date().getTime(),u=this.videoEl.getVideoPlaybackQuality(),f=u?u.totalVideoFrames:this.videoEl.webkitDecodedFrameCount;if(f?this._lastFrame!==f:this._lastTime<a-30){this._lastTime=a,this._lastFrame=f;try{n.bindTexture(n.TEXTURE_2D,this.videoTexture.options.source),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,this.videoEl),this._lastFrame=this.videoEl.webkitDecodedFrameCount,this.videoView.visible=!0,this.videoTexture.options.w=this.videoEl.width,this.videoTexture.options.h=this.videoEl.height;const p=this.videoView.w/this.videoView.h,x=this.videoEl.width/this.videoEl.height;p>x?(this.videoView.scaleX=x/p,this.videoView.scaleY=1):(this.videoView.scaleY=p/x,this.videoView.scaleX=1)}catch(p){Oo.error("texImage2d video",p),this.stop()}this.videoTexture.source.forceRenderUpdate()}}}),this._updatingVideoTexture||(t.on("frameStart",this._updateVideoTexture),this._updatingVideoTexture=!0)}stop(){const t=this.stage;if(t.removeListener("frameStart",this._updateVideoTexture),this._updatingVideoTexture=!1,this.videoView.visible=!1,this.videoTexture.options.source){const n=t.gl;n.bindTexture(n.TEXTURE_2D,this.videoTexture.options.source),n.clearColor(0,0,0,1),n.clear(n.COLOR_BUFFER_BIT)}}position(t,n){this.videoView.patch({smooth:{x:n,y:t}})}size(t,n){this.videoView.patch({smooth:{w:t,h:n}})}show(){this.videoView.setSmooth("alpha",1)}hide(){this.videoView.setSmooth("alpha",0)}};let af=c=>c,ie,Er,xo,rs,bd=1,ar=!1;const hI=c=>{c.mediaUrl&&(af=c.mediaUrl)};let kl={};const dt={adsEnabled:!1,playing:!1,_playingAds:!1,get playingAds(){return this._playingAds},set playingAds(c){this._playingAds!==c&&(this._playingAds=c,Ao(c===!0?"AdStart":"AdEnd"))},skipTime:!1,playAfterSeek:null},ud={play(){dt.playing=!0},pause(){dt.playing=!1},seeked(){dt.playAfterSeek===!0&&c0.play(),dt.playAfterSeek=null},abort(){Id()}},ji=c=>Math.round(bd*c)+"px",Ao=(c,t)=>{rs&&(rs.fire("$videoPlayer"+c,t,ie.currentTime),rs.fire("$videoPlayerEvent",c,t,ie.currentTime))},cI=(c,t)=>{ud[c]&&typeof ud[c]=="function"&&ud[c].call(null,c,t)};let Dl=null,Ol=null;const dI=(c,t,n)=>Dl&&typeof Dl=="function"?Dl(c,t,n):new Promise(a=>{c=af(c),t.setAttribute("src",c),t.load(),a()}),fI=c=>Ol&&typeof Ol=="function"?Ol(c):new Promise(t=>{c.removeAttribute("src"),c.load(),t()}),pI=()=>{const c=document.getElementsByTagName("video");if(c&&c.length)return c[0];{const t=document.createElement("video"),n=hr.get("platform","width")?hr.get("platform","width"):1920,a=hr.get("platform","height")?hr.get("platform","height"):1080;return t.setAttribute("id","video-player"),t.setAttribute("width",ji(n)),t.setAttribute("height",ji(a)),t.style.position="absolute",t.style.zIndex="1",t.style.display="none",t.style.visibility="hidden",t.style.top=ji(0),t.style.left=ji(0),t.style.width=ji(n),t.style.height=ji(a),document.body.appendChild(t),t}},gI=()=>{if(!Cr.tag("VideoTexture")){const c=Cr.stage.c({type:uI(),ref:"VideoTexture",zIndex:0,videoEl:ie});Cr.childList.addAt(c,0)}return Cr.tag("VideoTexture")},mI=()=>{Oo.info("VideoPlayer","Registering event listeners"),Object.keys(iv).forEach(c=>{const t=n=>{xo&&xo[c]&&typeof xo[c]=="function"&&xo[c]({currentTime:ie.currentTime}),cI(c,{videoElement:ie,event:n}),Ao(iv[c],{videoElement:ie,event:n})};kl[c]=t,ie.addEventListener(c,t)})},Id=()=>{Oo.info("VideoPlayer","Deregistering event listeners"),Object.keys(kl).forEach(c=>{ie.removeEventListener(c,kl[c])}),kl={}},c0={consumer(c){rs=c},loader(c){Dl=c},unloader(c){Ol=c},position(c=0,t=0){ie.style.left=ji(t),ie.style.top=ji(c),ar===!0&&Er.position(c,t)},size(c=1920,t=1080){ie.style.width=ji(c),ie.style.height=ji(t),ie.width=parseFloat(ie.style.width),ie.height=parseFloat(ie.style.height),ar===!0&&Er.size(c,t)},area(c=0,t=1920,n=1080,a=0){this.position(c,a),this.size(t-a,n-c)},open(c,t={}){if(this.canInteract)if(xo=sf.media(c),this.hide(),Id(),this.src==c)this.clear().then(this.open(c,t));else{const n={enabled:dt.adsEnabled,duration:300};t.videoId&&(n.caid=t.videoId),Pl.get(n,rs).then(a=>{dt.playingAds=!0,a.prerolls().then(()=>{dt.playingAds=!1,dI(c,ie,t).then(()=>{mI(),this.show(),this.play()}).catch(u=>{Ao("error",{videoElement:ie,event:u})})})})}},reload(){if(!this.canInteract)return;const c=ie.getAttribute("src");this.close(),this.open(c)},close(){Pl.cancel(),dt.playingAds&&(dt.playingAds=!1,Pl.stop(),setTimeout(()=>{this.close()})),this.canInteract&&(this.clear(),this.hide(),Id())},clear(){if(this.canInteract)return this.pause(),ar===!0&&Er.stop(),fI(ie).then(()=>{Ao("Clear",{videoElement:ie})})},play(){this.canInteract&&(ar===!0&&Er.start(),oI(ie.play,null,ie).catch(c=>{Ao("error",{videoElement:ie,event:c})}))},pause(){this.canInteract&&ie.pause()},playPause(){this.canInteract&&(this.playing===!0?this.pause():this.play())},mute(c=!0){this.canInteract&&(ie.muted=c)},loop(c=!0){ie.loop=c},seek(c){this.canInteract&&this.src&&(dt.playAfterSeek===null&&(dt.playAfterSeek=!!dt.playing),this.pause(),ie.currentTime=Math.max(0,Math.min(c,this.duration-.1)))},skip(c){this.canInteract&&this.src&&(dt.skipTime=(dt.skipTime||ie.currentTime)+c,lI(()=>{this.seek(dt.skipTime),dt.skipTime=!1},300))},show(){this.canInteract&&(ar===!0?Er.show():(ie.style.display="block",ie.style.visibility="visible"))},hide(){this.canInteract&&(ar===!0?Er.hide():(ie.style.display="none",ie.style.visibility="hidden"))},enableAds(c=!0){dt.adsEnabled=c},get duration(){return ie&&(isNaN(ie.duration)?1/0:ie.duration)},get currentTime(){return ie&&ie.currentTime},get muted(){return ie&&ie.muted},get looped(){return ie&&ie.loop},get src(){return ie&&ie.getAttribute("src")},get playing(){return dt.playing},get playingAds(){return dt.playingAds},get canInteract(){return dt.playingAds===!1},get top(){return ie&&parseFloat(ie.style.top)},get left(){return ie&&parseFloat(ie.style.left)},get bottom(){return ie&&parseFloat(ie.style.top-ie.style.height)},get right(){return ie&&parseFloat(ie.style.left-ie.style.width)},get width(){return ie&&parseFloat(ie.style.width)},get height(){return ie&&parseFloat(ie.style.height)},get visible(){return ar===!0?Er.isVisible:ie&&ie.style.display==="block"},get adsEnabled(){return dt.adsEnabled},get _videoEl(){return ie},get _consumer(){return rs}},sn=aI(c0,()=>{bd=Cr&&Cr.stage&&Cr.stage.getRenderPrecision()||bd,ie=pI(),ar=hr.get("platform","textureMode",!1),ar===!0&&(ie.setAttribute("crossorigin","anonymous"),Er=gI())});let Fl,d0=()=>Promise.resolve({prerolls:[],midrolls:[],postrolls:[]});const _I=c=>{c.getAds&&(d0=c.getAds)},vo={active:!1},yI=(c=[])=>c.reduce((t,n)=>t.then(()=>xI(n)),Promise.resolve(null)),xI=c=>new Promise(t=>{if(vo.active===!1)return ge.info("Ad","Skipping add due to inactive state"),t();const n=document.getElementsByTagName("video")[0];n.style.display="block",n.style.visibility="visible",n.src=af(c.url),n.load();let a=null,u;const f=()=>{Object.keys(m).forEach(p=>n.removeEventListener(p,m[p])),t()},m={play(){ge.info("Ad","Play ad",c.url),Ii("Play",c),dn(c.callbacks,"defaultImpression")},ended(){Ii("Ended",c),dn(c.callbacks,"complete"),f()},timeupdate(){!a&&n.duration&&(a={firstQuartile:n.duration/4,midPoint:n.duration/2,thirdQuartile:n.duration/4*3},ge.info("Ad","Calculated quartiles times",{timeEvents:a})),a&&a.firstQuartile&&n.currentTime>=a.firstQuartile&&(Ii("FirstQuartile",c),delete a.firstQuartile,dn(c.callbacks,"firstQuartile")),a&&a.midPoint&&n.currentTime>=a.midPoint&&(Ii("MidPoint",c),delete a.midPoint,dn(c.callbacks,"midPoint")),a&&a.thirdQuartile&&n.currentTime>=a.thirdQuartile&&(Ii("ThirdQuartile",c),delete a.thirdQuartile,dn(c.callbacks,"thirdQuartile"))},stalled(){Ii("Stalled",c),u=setTimeout(()=>{f()},5e3)},canplay(){u&&clearTimeout(u)},error(){Ii("Error",c),f()},abort(){f()}};Object.keys(m).forEach(p=>n.addEventListener(p,m[p])),n.play()}),dn=(c,t)=>{if(c&&c[t])return ge.info("Ad","Sending beacon",t,c[t]),c[t].reduce((n,a)=>n.then(()=>fetch(a).then(u=>{u.status===200?Ii("Beacon"+t+"Sent"):Ii("Beacon"+t+"Failed"+u.status),Promise.resolve(null)}).catch(()=>{Promise.resolve(null)})),Promise.resolve(null));ge.info("Ad","No callback found for "+t)},Ii=(c,t)=>{Fl&&(Fl.fire("$ad"+c,t),Fl.fire("$adEvent",c,t))},vI={get(c,t){return c.enabled===!1?Promise.resolve({prerolls(){return Promise.resolve()}}):(Fl=t,new Promise(n=>{ge.info("Ad","Starting session"),d0(c).then(a=>{ge.info("Ad","API result",a),n({prerolls(){return a.preroll?(vo.active=!0,Ii("PrerollSlotImpression",a),dn(a.preroll.callbacks,"slotImpression"),yI(a.preroll.ads).then(()=>{Ii("PrerollSlotEnd",a),dn(a.preroll.callbacks,"slotEnd"),vo.active=!1})):Promise.resolve()},midrolls(){return Promise.resolve()},postrolls(){return Promise.resolve()}})})}))},cancel(){ge.info("Ad","Cancel Ad"),vo.active=!1},stop(){ge.info("Ad","Stop Ad"),vo.active=!1;const c=document.getElementsByTagName("video")[0];c.pause(),c.removeAttribute("src")}};var TI=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function f0(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var SI=function(t){return wI(t)&&!AI(t)};function wI(c){return!!c&&typeof c=="object"}function AI(c){var t=Object.prototype.toString.call(c);return t==="[object RegExp]"||t==="[object Date]"||bI(c)}var EI=typeof Symbol=="function"&&Symbol.for,CI=EI?Symbol.for("react.element"):60103;function bI(c){return c.$$typeof===CI}function II(c){return Array.isArray(c)?[]:{}}function bo(c,t){return t.clone!==!1&&t.isMergeableObject(c)?ss(II(c),c,t):c}function RI(c,t,n){return c.concat(t).map(function(a){return bo(a,n)})}function LI(c,t){if(!t.customMerge)return ss;var n=t.customMerge(c);return typeof n=="function"?n:ss}function MI(c){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(c).filter(function(t){return Object.propertyIsEnumerable.call(c,t)}):[]}function nv(c){return Object.keys(c).concat(MI(c))}function p0(c,t){try{return t in c}catch(n){return!1}}function PI(c,t){return p0(c,t)&&!(Object.hasOwnProperty.call(c,t)&&Object.propertyIsEnumerable.call(c,t))}function kI(c,t,n){var a={};return n.isMergeableObject(c)&&nv(c).forEach(function(u){a[u]=bo(c[u],n)}),nv(t).forEach(function(u){PI(c,u)||(p0(c,u)&&n.isMergeableObject(t[u])?a[u]=LI(u,n)(c[u],t[u],n):a[u]=bo(t[u],n))}),a}function ss(c,t,n){n=n||{},n.arrayMerge=n.arrayMerge||RI,n.isMergeableObject=n.isMergeableObject||SI,n.cloneUnlessOtherwiseSpecified=bo;var a=Array.isArray(t),u=Array.isArray(c),f=a===u;return f?a?n.arrayMerge(c,t,n):kI(c,t,n):bo(t,n)}ss.all=function(t,n){if(!Array.isArray(t))throw new Error("first argument should be an array");return t.reduce(function(a,u){return ss(a,u,n)},{})};var DI=ss,OI=DI;const FI=f0(OI);let sv=!1;const hd=(c=!1)=>{(c===!0||sv===!1)&&console.warn(["The 'Locale'-plugin in the Lightning-SDK is deprecated and will be removed in future releases.","Please consider using the new 'Language'-plugin instead.","https://rdkcentral.github.io/Lightning-SDK/#/plugins/language"].join(`

`)),sv=!0};class NI{constructor(){this.__enabled=!1}async load(t){this.__enabled&&await fetch(t).then(n=>n.json()).then(n=>{this.loadFromObject(n)})}setLanguage(t){hd(),this.__enabled=!0,this.language=t}get tr(){return hd(!0),this.__trObj[this.language]}loadFromObject(t){hd();const n="en";if(Object.keys(t).indexOf(this.language)===-1)if(ge.warn("No translations found for: "+this.language),Object.keys(t).indexOf(n)>-1)ge.warn("Using fallback language: "+n),this.language=n;else{const a="No translations found for fallback language: "+n;throw ge.error(a),Error(a)}this.__trObj=t;for(const a of Object.values(this.__trObj))for(const u of Object.keys(a))a[u]=new lf(a[u])}}class lf extends String{format(...t){const n=t.reduce((a,u,f)=>a.split(`{${f}}`).join(u),this);return new lf(n)}}const UI=new NI;class zI extends J.Component{static _template(){return{rect:!0,color:3137370284,h:40,w:100,x:t=>t-50,y:t=>t-50,mount:1,Text:{w:t=>t,h:t=>t,y:5,x:20,text:{fontSize:22,lineHeight:26}}}}_firstActive(){this.tag("Text").text=`APP - v${this.version}
SDK - v${this.sdkVersion}`,this.tag("Text").loadTexture(),this.w=this.tag("Text").renderWidth+40,this.h=this.tag("Text").renderHeight+5}}class BI extends J.Component{static _template(){return{rect:!0,color:4294967295,texture:J.Tools.getRoundRect(80,80,40),h:80,w:80,x:100,y:100,mount:1,Background:{x:3,y:3,texture:J.Tools.getRoundRect(72,72,36),color:4278222848},Counter:{w:t=>t,h:t=>t,y:10,text:{fontSize:32,textAlign:"center"}},Text:{w:t=>t,h:t=>t,y:48,text:{fontSize:15,textAlign:"center",text:"FPS"}}}}_setup(){this.config={log:!1,interval:500,threshold:1,...gi.get("platform","showFps")},this.fps=0,this.lastFps=this.fps-this.config.threshold;const t=()=>{this.fps=~~(1/this.stage.dt)};this.stage.on("frameStart",t),this.stage.off("framestart",t),this.interval=setInterval(this.showFps.bind(this),this.config.interval)}_firstActive(){this.showFps()}_detach(){clearInterval(this.interval)}showFps(){if(Math.abs(this.lastFps-this.fps)<=this.config.threshold)return;this.lastFps=this.fps;let t=4278222848;this.fps<=40&&this.fps>20?t=4294944e3:this.fps<=20&&(t=4294901760),this.tag("Background").setSmooth("color",t),this.tag("Counter").text=`${this.fps}`,this.config.log&&ge.info("FPS",this.fps)}}const uf=c=>new Promise((t,n)=>{var a=new XMLHttpRequest;a.onreadystatechange=function(){a.readyState==XMLHttpRequest.DONE&&(a.status===0||a.status===200?t(JSON.parse(a.responseText)):n(a.statusText))},a.open("GET",c),a.send(null)});let g0,Rd;const jI=c=>{g0=Ld(HI(window.location.pathname,c.path||"/")),c.proxyUrl&&(Rd=Ld(c.proxyUrl))},Io={asset(c){return g0+c},proxyUrl(c,t={}){return Rd?Rd+"?"+ov(c,t):c},makeQueryString(){return ov(...arguments)},ensureUrlWithProtocol(){return Ld(...arguments)}},Ld=c=>/^\/[^/]/i.test(c)&&/^(?:file:)/i.test(window.location.protocol)?window.location.protocol+"//"+c:/^\/\//.test(c)?window.location.protocol+c:/^(?:https?:)/i.test(c)?c:window.location.origin+c,HI=(c="/",t)=>(t=t.charAt(t.length-1)!=="/"?t+"/":t,/^(?:https?:)?(?:\/\/)/.test(t)||t.charAt(0)==="/"?t:(c=VI(c),t=t.charAt(0)==="."?t.substr(1):t,t=t.charAt(0)!=="/"?"/"+t:t,c+t)),VI=c=>{if(c.slice(-1)==="/")return c.slice(0,-1);const t=c.split("/");return t[t.length-1].indexOf(".")>-1&&t.pop(),t.join("/")},ov=(c,t={},n="url")=>(t.operator="metrological",t[n]=c,Object.keys(t).map(a=>encodeURIComponent(a)+"="+encodeURIComponent(""+t[a])).join("&"));let sr={},is={},Bi=null;const WI=(c,t=null)=>new Promise((n,a)=>{uf(c).then(u=>{GI(u),typeof t=="object"&&"then"in t&&typeof t.then=="function"?t.then(f=>av(f).then(n).catch(a)).catch(f=>{ge.error(f),a(f)}):av(t).then(n).catch(a)}).catch(()=>{const u="Language file "+c+" not found";ge.error(u),a(u)})}),GI=c=>{"meta"in c&&(sr={...c.meta},delete c.meta),is=c},av=c=>(Bi=null,new Promise((t,n)=>{if(c in is)Bi=c;else if("map"in sr&&c in sr.map&&sr.map[c]in is)Bi=sr.map[c];else if("default"in sr&&sr.default in is){const a="Translations for Language "+Bi+" not found. Using default language "+sr.default;ge.warn(a),Bi=sr.default}else{const a="Translations for Language "+Bi+" not found.";ge.error(a),n(a)}if(Bi){ge.info("Setting language to",Bi);const a=is[Bi];if(typeof a=="object")t();else if(typeof a=="string"){const u=Io.asset(a);uf(u).then(f=>{is[Bi]=f,t()}).catch(f=>{const m="Error while fetching "+u;ge.error(m,f),n(m)})}}})),ke={eventListeners:[],timeouts:[],intervals:[],targets:[]},hf={setTimeout(c,t,...n){const a=setTimeout(()=>{ke.timeouts=ke.timeouts.filter(u=>u!==a),c.apply(null,n)},t,n);return ge.info("Set Timeout","ID: "+a),ke.timeouts.push(a),a},clearTimeout(c){ke.timeouts.indexOf(c)>-1?(ke.timeouts=ke.timeouts.filter(t=>t!==c),ge.info("Clear Timeout","ID: "+c),clearTimeout(c)):ge.error("Clear Timeout","ID "+c+" not found")},clearTimeouts(){ke.timeouts.forEach(c=>{this.clearTimeout(c)})},setInterval(c,t,...n){const a=setInterval(()=>{ke.intervals.filter(u=>u!==a),c.apply(null,n)},t,n);return ge.info("Set Interval","ID: "+a),ke.intervals.push(a),a},clearInterval(c){ke.intervals.indexOf(c)>-1?(ke.intervals=ke.intervals.filter(t=>t!==c),ge.info("Clear Interval","ID: "+c),clearInterval(c)):ge.error("Clear Interval","ID "+c+" not found")},clearIntervals(){ke.intervals.forEach(c=>{this.clearInterval(c)})},addEventListener(c,t,n){c.addEventListener(t,n);const a=ke.targets.indexOf(c)>-1?ke.targets.indexOf(c):ke.targets.push(c)-1;ke.eventListeners[a]=ke.eventListeners[a]||{},ke.eventListeners[a][t]=ke.eventListeners[a][t]||[],ke.eventListeners[a][t].push(n),ge.info("Add eventListener","Target:",c,"Event: "+t,"Handler:",n.toString())},removeEventListener(c,t,n){const a=ke.targets.indexOf(c);a>-1&&ke.eventListeners[a]&&ke.eventListeners[a][t]&&ke.eventListeners[a][t].indexOf(n)>-1?(ke.eventListeners[a][t]=ke.eventListeners[a][t].filter(u=>u!==n),ge.info("Remove eventListener","Target:",c,"Event: "+t,"Handler:",n.toString()),c.removeEventListener(t,n)):ge.error("Remove eventListener","Not found","Target",c,"Event: "+t,"Handler",n.toString())},removeEventListeners(c,t){if(c&&t){const n=ke.targets.indexOf(c);n>-1&&ke.eventListeners[n][t].forEach(a=>{this.removeEventListener(c,t,a)})}else if(c){const n=ke.targets.indexOf(c);n>-1&&Object.keys(ke.eventListeners[n]).forEach(a=>{this.removeEventListeners(c,a)})}else Object.keys(ke.eventListeners).forEach(n=>{this.removeEventListeners(ke.targets[n])})},clear(){this.clearTimeouts(),this.clearIntervals(),this.removeEventListeners(),ke.eventListeners=[],ke.timeouts=[],ke.intervals=[],ke.targets=[]}},XI=c=>typeof c=="object"&&c!==null,m0=c=>typeof c=="string",qI=c=>({r:(c/65536|0)%256,g:(c/256|0)%256,b:c*1%256,a:c/16777216|0}),$I=(c,t,n)=>{let a=(c/65536|0)%256,u=(c/256|0)%256,f=c%256,m=c/16777216|0,p=(t/65536|0)%256,x=(t/256|0)%256,T=t%256,A=t/16777216|0,b=a*n+p*(1-n),I=u*n+x*(1-n),D=f*n+T*(1-n),v=m*n+A*(1-n);return Math.round(v)*16777216+Math.round(b)*65536+Math.round(I)*256+Math.round(D)},YI=(c,t)=>{t>1?t/=100:t<0&&(t=0);let n=(c/65536|0)%256,a=(c/256|0)%256,u=c%256;return(n<<16)+(a<<8)+u+(Math.round(t*255)|0)*16777216},KI=c=>{c[0]=Math.max(0,Math.min(255,c[0])),c[1]=Math.max(0,Math.min(255,c[1])),c[2]=Math.max(0,Math.min(255,c[2])),c[3]=Math.max(0,Math.min(255,c[3]));let t=((c[3]|0)<<24)+((c[0]|0)<<16)+((c[1]|0)<<8)+(c[2]|0);return t<0&&(t=4294967295+t+1),t},go=c=>{const t=qI(c),n=t.r/255,a=t.g/255,u=t.b/255,f=Math.max(n,a,u),m=Math.min(n,a,u);let p=0,x=0;const T=(m+f)*.5;if(T>0){const A=f-m;if(A>0){const b=(f-n)/A,I=(f-a)/A,D=(f-u)/A;T<.5?x=f+m:x=2-f-m,n===f&&a===m?p=5+D:n===f?p=1-I:a===f&&u===m?p=1+b:a===f?p=3-D:u===f?p=3+I:p=5-b,p=p/6}}return{h:p%1,s:x,l:T,a:t.a}},mo=c=>{let t=1,n=1,a=1,u=c.h,f=c.s,m=c.l;u<0&&(u+=1);let p=0;if(m<=.5?p=m*(1+f):p=m+f-m*f,p>0){u*=6;const x=m+m-p,T=(p-x)/p,A=Math.floor(u),b=u-A,I=p*T*b,D=x+I,v=p-I;A===0&&(t=p,n=D,a=x),A===1&&(t=v,n=p,a=x),A===2&&(t=x,n=p,a=D),A===3&&(t=x,n=v,a=p),A===4&&(t=D,n=x,a=p),A===5&&(t=p,n=x,a=v)}return KI([Math.floor(t*255),Math.floor(n*255),Math.floor(a*255),c.a])};let Nl={white:"#ffffff",black:"#000000",red:"#ff0000",green:"#00ff00",blue:"#0000ff",yellow:"#feff00",cyan:"#00feff",magenta:"#ff00ff"};const gn={},lv=(c,t)=>{XI(c)?(Object.keys(c).forEach(n=>uv(n)),Nl=Object.assign({},Nl,c)):m0(c)&&t&&(uv(c),Nl[c]=t)},uv=c=>{for(let t in gn)t.indexOf(c)>-1&&delete gn[t]},ZI=c=>new Promise((t,n)=>{if(typeof c=="object")return lv(c),t();uf(c).then(a=>(lv(a),t())).catch(()=>{const a="Colors file "+c+" not found";return ge.error(a),n(a)})}),QI=c=>{let t=gn[c]||Nl[c]||c;t||(t=c);const n=/^#([0-9A-F]{3}|[0-9A-F]{6})$/i;if(m0(t)&&n.test(t)){let a=n.exec(t)[1];a.length===3&&(a=a.split("").map(u=>u+u).join("")),t=`0xff${a}`*1}return gn[c]||(gn[c]=t),t||4294967295},br=c=>JI.generate(c),JI={color:null,generate:function(c=this.color){return gn[c]?this.color=gn[c]:this.color=QI(c),this},get(){return this.color},alpha:function(c){return this.color=YI(this.color,Math.abs(c)),this},darker(c){const t=go(this.color);return t.l=t.l*(1-c),this.color=mo(t),this},lighter(c){const t=go(this.color);return t.l=t.l+(1-t.l)*c,this.color=mo(t),this},saturation(c){const t=go(this.color);return t.s=c,this.color=mo(t),this},lightness(c){const t=go(this.color);return t.l=c,this.color=mo(t),this},hue(c){const t=go(this.color);return t.h=c,this.color=mo(t),this},mix(c,t){return this.color=$I(this.color,c,t),this}},e2="@lightningjs/sdk",t2="5.3.1",i2="Apache-2.0",r2="index.d.ts",n2={postinstall:"node ./scripts/postinstall.js",lint:"eslint '**/*.js'",release:"npm publish --access public",typedoc:"typedoc --tsconfig tsconfig.typedoc.json",tsd:"tsd"},s2={hooks:{"pre-commit":"lint-staged"}},o2={"@babel/polyfill":"^7.11.5","@lightningjs/core":"^2.7.0","@metrological/sdk":"^1.0.0","@michieljs/execute-as-promise":"^1.0.0",deepmerge:"^4.2.2",localcookies:"^2.0.0",shelljs:"^0.8.5","url-polyfill":"^1.1.10","whatwg-fetch":"^3.0.0"},a2={"@babel/core":"^7.11.6","@babel/plugin-transform-parameters":"^7.10.5 ","@babel/plugin-transform-spread":"^7.11.0","@babel/preset-env":"^7.11.5","babel-eslint":"^10.1.0",eslint:"^7.10.0","eslint-config-prettier":"^6.12.0","eslint-plugin-prettier":"^3.1.4",husky:"^4.3.0","lint-staged":"^10.4.0",prettier:"^1.19.1",rollup:"^1.32.1","rollup-plugin-babel":"^4.4.0",tsd:"^0.22.0",typedoc:"^0.23.9"},l2={type:"git",url:"git@github.com:rdkcentral/Lightning-SDK.git"},u2={url:"https://github.com/rdkcentral/Lightning-SDK/issues"},hv={name:e2,version:t2,license:i2,types:r2,scripts:n2,"lint-staged":{"*.js":["eslint --fix"],"src/startApp.js":["rollup -c ./rollup.config.js"]},husky:s2,dependencies:o2,devDependencies:a2,repository:l2,bugs:u2};let Md;const on={stage:{w:1920,h:1080,precision:1,clearColor:0,canvas2d:!1},debug:!1,defaultFontFace:"RobotoRegular",keys:{8:"Back",13:"Enter",27:"Menu",37:"Left",38:"Up",39:"Right",40:"Down",174:"ChannelDown",175:"ChannelUp",178:"Stop",250:"PlayPause",191:"Search",409:"Search"}},cd=[],h2=(c,t)=>new Promise((n,a)=>{c.map(({family:u,url:f,urls:m,descriptors:p})=>()=>{const x=m?m.map(A=>"url("+A+")"):"url("+f+")",T=new FontFace(u,x,p||{});return t.push(T),ge.info("Loading font",u),document.fonts.add(T),T.load()}).reduce((u,f)=>u.then(()=>f()),Promise.resolve(null)).then(n).catch(a)});function c2(c,t,n){const{width:a,height:u}=n;return a&&u&&(on.stage.w=a,on.stage.h=u,on.stage.precision=a/1920),!a&&!u&&window.innerHeight===720&&(on.stage.w=1280,on.stage.h=720,on.stage.precision=1280/1920),class extends J.Application{constructor(m){const p=FI(on,m);m.stage.canvas&&(p.stage.canvas=m.stage.canvas),super(p),this.config=p}static _template(){return{w:1920,h:1080}}colorshift(m=!1,p={}){Xb.colorshift(this,m,p)}get keymapping(){return this.stage.application.config.keys}overrideKeyMap(m,p=!1){const x=this.stage.application.config.keys;return Object.keys(m).reduce((T,A)=>(p||Object.keys(x).forEach(b=>{b!=A&&x[b]==m[A]&&delete T[b]}),T[A]=m[A],T),x),x}_setup(){Promise.all([this.loadFonts(c.config&&c.config.fonts||c.getFonts&&c.getFonts()||[]),UI.load(c.config&&c.config.locale||c.getLocale&&c.getLocale()),c.language&&this.loadLanguage(c.language()),c.colors&&this.loadColors(c.colors())]).then(()=>{sf.app.loaded(),this.w=this.config.stage.w/this.config.stage.precision,this.h=this.config.stage.h/this.config.stage.precision,Md=this.stage.c({ref:"App",type:c,zIndex:1,forceZIndexContext:!!n.showVersion||!!n.showFps}),this.childList.a(Md),this._refocus(),ge.info("App version",this.config.version),ge.info("SDK version",hv.version),n.showVersion&&this.childList.a({ref:"VersionLabel",type:zI,version:this.config.version,sdkVersion:hv.version,zIndex:1}),n.showFps&&this.childList.a({ref:"FpsCounter",type:BI,zIndex:1}),super._setup()}).catch(console.error)}_handleBack(){this.closeApp()}_handleExit(){this.closeApp()}closeApp(){ge.info("Signaling App Close"),n.onClose&&typeof n.onClose=="function"?n.onClose(...arguments):this.close()}close(){ge.info("Closing App"),gi.clearSubscribers(),hf.clear(),this.childList.remove(this.tag("App")),this.cleanupFonts(),this.stage.gc(),this.destroy()}loadFonts(m){return n.fontLoader&&typeof n.fontLoader=="function"?n.fontLoader(m,cd):h2(m,cd)}cleanupFonts(){"delete"in document.fonts?cd.forEach(m=>{ge.info("Removing font",m.family),document.fonts.delete(m)}):ge.info("No support for removing manually-added fonts")}loadLanguage(m){let p=Io.asset("translations.json"),x=m;return typeof x=="object"&&(x=m.language||null,p=m.file||p),WI(p,x)}loadColors(m){let p=Io.asset("colors.json");return m&&(typeof m=="string"||typeof m=="object")&&(p=m),ZI(p)}set focus(m){this._focussed=m,this._refocus()}_getFocused(){return this._focussed||this.tag("App")}}}class hM extends J.textures.ImageTexture{constructor(t){super(t),this._scalingOptions=void 0}set options(t){this.resizeMode=this._scalingOptions=t}_getLookupId(){return`${this._src}-${this._scalingOptions.type}-${this._scalingOptions.w}-${this._scalingOptions.h}`}getNonDefaults(){const t=super.getNonDefaults();return this._src&&(t.src=this._src),t}}const cv=["timeupdate","error","ended","loadeddata","canplay","play","playing","pause","loadstart","seeking","seeked","encrypted"];let _0=c=>c;const d2=c=>{c.mediaUrl&&(_0=c.mediaUrl)};class cM extends J.Component{_construct(){this._skipRenderToTexture=!1,this._metrics=null,this._textureMode=gi.get("platform","textureMode")||!1,ge.info("Texture mode: "+this._textureMode),console.warn(["The 'MediaPlayer'-plugin in the Lightning-SDK is deprecated and will be removed in future releases.","Please consider using the new 'VideoPlayer'-plugin instead.","https://rdkcentral.github.io/Lightning-SDK/#/plugins/videoplayer"].join(`

`))}static _template(){return{Video:{VideoWrap:{VideoTexture:{visible:!1,pivot:.5,texture:{type:J.textures.StaticTexture,options:{}}}}}}}set skipRenderToTexture(t){this._skipRenderToTexture=t}get textureMode(){return this._textureMode}get videoView(){return this.tag("Video")}_init(){const t=document.getElementsByTagName("video");t&&t.length>0?this.videoEl=t[0]:(this.videoEl=document.createElement("video"),this.videoEl.setAttribute("id","video-player"),this.videoEl.style.position="absolute",this.videoEl.style.zIndex="1",this.videoEl.style.display="none",this.videoEl.setAttribute("width","100%"),this.videoEl.setAttribute("height","100%"),this.videoEl.style.visibility=this.textureMode?"hidden":"visible",document.body.appendChild(this.videoEl)),this.textureMode&&!this._skipRenderToTexture&&this._createVideoTexture(),this.eventHandlers=[]}_registerListeners(){cv.forEach(t=>{const n=a=>{this._metrics&&this._metrics[t]&&typeof this._metrics[t]=="function"&&this._metrics[t]({currentTime:this.videoEl.currentTime}),this.fire(t,{videoElement:this.videoEl,event:a})};this.eventHandlers.push(n),this.videoEl.addEventListener(t,n)})}_deregisterListeners(){ge.info("Deregistering event listeners MediaPlayer"),cv.forEach((t,n)=>{this.videoEl.removeEventListener(t,this.eventHandlers[n])}),this.eventHandlers=[]}_attach(){this._registerListeners()}_detach(){this._deregisterListeners(),this.close()}_createVideoTexture(){const n=this.stage.gl,a=n.createTexture();n.bindTexture(n.TEXTURE_2D,a),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),this.videoTexture.options={source:a,w:this.videoEl.width,h:this.videoEl.height}}_startUpdatingVideoTexture(){if(this.textureMode&&!this._skipRenderToTexture){const t=this.stage;this._updateVideoTexture||(this._updateVideoTexture=()=>{if(this.videoTexture.options.source&&this.videoEl.videoWidth&&this.active){const n=t.gl,a=new Date().getTime(),u=this.videoEl.webkitDecodedFrameCount;if(u?this._lastFrame!==u:this._lastTime<a-30){this._lastTime=a,this._lastFrame=u;try{n.bindTexture(n.TEXTURE_2D,this.videoTexture.options.source),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,this.videoEl),this._lastFrame=this.videoEl.webkitDecodedFrameCount,this.videoTextureView.visible=!0,this.videoTexture.options.w=this.videoEl.videoWidth,this.videoTexture.options.h=this.videoEl.videoHeight;const m=this.videoTextureView.w/this.videoTextureView.h,p=this.videoEl.videoWidth/this.videoEl.videoHeight;m>p?(this.videoTextureView.scaleX=p/m,this.videoTextureView.scaleY=1):(this.videoTextureView.scaleY=m/p,this.videoTextureView.scaleX=1)}catch(m){ge.error("texImage2d video",m),this._stopUpdatingVideoTexture(),this.videoTextureView.visible=!1}this.videoTexture.source.forceRenderUpdate()}}}),this._updatingVideoTexture||(t.on("frameStart",this._updateVideoTexture),this._updatingVideoTexture=!0)}}_stopUpdatingVideoTexture(){if(this.textureMode){const t=this.stage;if(t.removeListener("frameStart",this._updateVideoTexture),this._updatingVideoTexture=!1,this.videoTextureView.visible=!1,this.videoTexture.options.source){const n=t.gl;n.bindTexture(n.TEXTURE_2D,this.videoTexture.options.source),n.clearColor(0,0,0,1),n.clear(n.COLOR_BUFFER_BIT)}}}updateSettings(t={}){this._consumer=t.consumer,this._consumer&&this._consumer.getMediaplayerSettings&&(t=Object.assign(t,this._consumer.getMediaplayerSettings())),J.Utils.equalValues(this._stream,t.stream)||(t.stream&&t.stream.keySystem?navigator.requestMediaKeySystemAccess(t.stream.keySystem.id,t.stream.keySystem.config).then(n=>n.createMediaKeys()).then(n=>this.videoEl.setMediaKeys(n)).then(()=>{t.stream&&t.stream.src&&this.open(t.stream.src)}).catch(()=>{console.error("Failed to set up MediaKeys")}):t.stream&&t.stream.src?gi.get("app","hls")?(window.Hls||(window.Hls=class{static isSupported(){return console.warn("hls-light not included"),!1}}),window.Hls.isSupported()&&(this._hls||(this._hls=new window.Hls({liveDurationInfinity:!0})),this._hls.loadSource(t.stream.src),this._hls.attachMedia(this.videoEl),this.videoEl.style.display="block")):this.open(t.stream.src):this.close(),this._stream=t.stream),this._setHide(t.hide),this._setVideoArea(t.videoPos)}_setHide(t){this.textureMode?this.tag("Video").setSmooth("alpha",t?0:1):this.videoEl.style.visibility=t?"hidden":"visible"}open(t,n={hide:!1,videoPosition:null}){if(t=_0(t),this._metrics=sf.media(t),ge.info("Playing stream",t),this.application.noVideo){ge.info("noVideo option set, so ignoring: "+t);return}this.videoEl.getAttribute("src")===t&&this.close(),this.videoEl.setAttribute("src",t),this.videoEl.style.visibility="hidden",this.videoEl.style.display="none",setTimeout(()=>{this.videoEl.style.display="block",this.videoEl.style.visibility="visible"}),this._setHide(n.hide),this._setVideoArea(n.videoPosition||[0,0,1920,1080])}close(){this.videoEl.pause(),this.videoEl.removeAttribute("src"),this.videoEl.load(),this._clearSrc(),this.videoEl.style.display="none"}playPause(){this.isPlaying()?this.doPause():this.doPlay()}get muted(){return this.videoEl.muted}set muted(t){this.videoEl.muted=t}get loop(){return this.videoEl.loop}set loop(t){this.videoEl.loop=t}isPlaying(){return this._getState()==="Playing"}doPlay(){this.videoEl.play()}doPause(){this.videoEl.pause()}reload(){var t=this.videoEl.getAttribute("src");this.close(),this.videoEl.src=t}getPosition(){return Promise.resolve(this.videoEl.currentTime)}setPosition(t){this.videoEl.currentTime=t}getDuration(){return Promise.resolve(this.videoEl.duration)}seek(t,n=!1){n?this.videoEl.currentTime=t:this.videoEl.currentTime+=t}get videoTextureView(){return this.tag("Video").tag("VideoTexture")}get videoTexture(){return this.videoTextureView.texture}_setVideoArea(t){if(!J.Utils.equalValues(this._videoPos,t))if(this._videoPos=t,this.textureMode)this.videoTextureView.patch({smooth:{x:t[0],y:t[1],w:t[2]-t[0],h:t[3]-t[1]}});else{const n=this.stage.getRenderPrecision();this.videoEl.style.left=Math.round(t[0]*n)+"px",this.videoEl.style.top=Math.round(t[1]*n)+"px",this.videoEl.style.width=Math.round((t[2]-t[0])*n)+"px",this.videoEl.style.height=Math.round((t[3]-t[1])*n)+"px"}}_fireConsumer(t,n){this._consumer&&this._consumer.fire(t,n)}_equalInitData(t,n){if(!t||!n||t.byteLength!=n.byteLength)return!1;const a=new Int8Array(t),u=new Int8Array(n);for(let f=0;f!=t.byteLength;f++)if(a[f]!=u[f])return!1;return!0}error(t){return this._fireConsumer("$mediaplayerError",t),this._setState(""),""}loadeddata(t){this._fireConsumer("$mediaplayerLoadedData",t)}play(t){this._fireConsumer("$mediaplayerPlay",t)}playing(t){this._fireConsumer("$mediaplayerPlaying",t),this._setState("Playing")}canplay(t){this.videoEl.play(),this._fireConsumer("$mediaplayerStart",t)}loadstart(t){this._fireConsumer("$mediaplayerLoad",t)}seeked(){this._fireConsumer("$mediaplayerSeeked",{currentTime:this.videoEl.currentTime,duration:this.videoEl.duration||1})}seeking(){this._fireConsumer("$mediaplayerSeeking",{currentTime:this.videoEl.currentTime,duration:this.videoEl.duration||1})}durationchange(t){this._fireConsumer("$mediaplayerDurationChange",t)}encrypted(t){const n=t.videoElement,a=t.event;n.mediaKeys&&!this._equalInitData(this._previousInitData,a.initData)&&(this._previousInitData=a.initData,this._fireConsumer("$mediaplayerEncrypted",t))}static _states(){return[class extends this{$enter(){this._startUpdatingVideoTexture()}$exit(){this._stopUpdatingVideoTexture()}timeupdate(){this._fireConsumer("$mediaplayerProgress",{currentTime:this.videoEl.currentTime,duration:this.videoEl.duration||1})}ended(n){this._fireConsumer("$mediaplayerEnded",n),this._setState("")}pause(n){this._fireConsumer("$mediaplayerPause",n),this._setState("Playing.Paused")}_clearSrc(){this._fireConsumer("$mediaplayerStop",{}),this._setState("")}static _states(){return[class extends this{}]}}]}}class f2{constructor(t){return t=t||{},this.forceCookies=t.forceCookies||!1,this._checkIfLocalStorageWorks()===!0&&t.forceCookies!==!0?{getItem:this._getItemLocalStorage,setItem:this._setItemLocalStorage,removeItem:this._removeItemLocalStorage,clear:this._clearLocalStorage,keys:this._getLocalStorageKeys}:{getItem:this._getItemCookie,setItem:this._setItemCookie,removeItem:this._removeItemCookie,clear:this._clearCookies,keys:this._getCookieKeys}}_checkIfLocalStorageWorks(){if(typeof localStorage>"u")return!1;try{return localStorage.setItem("feature_test","yes"),localStorage.getItem("feature_test")==="yes"&&(localStorage.removeItem("feature_test"),!0)}catch(t){return!1}}_getItemLocalStorage(t){return window.localStorage.getItem(t)}_setItemLocalStorage(t,n){return window.localStorage.setItem(t,n)}_removeItemLocalStorage(t){return window.localStorage.removeItem(t)}_clearLocalStorage(){return window.localStorage.clear()}_getLocalStorageKeys(){return Object.keys(window.localStorage)}_getItemCookie(t){var n=document.cookie.match(RegExp("(?:^|;\\s*)"+function(a){return a.replace(/([.*+?\^${}()|\[\]\/\\])/g,"\\$1")}(t)+"=([^;]*)"));return n&&n[1]===""&&(n[1]=null),n?n[1]:null}_setItemCookie(t,n){var a=new Date,u=new Date(a.getTime()+15768e7);document.cookie=`${t}=${n}; expires=${u.toUTCString()};`}_removeItemCookie(t){document.cookie=`${t}=;Max-Age=-99999999;`}_clearCookies(){document.cookie.split(";").forEach(t=>{document.cookie=t.replace(/^ +/,"").replace(/=.*/,"=;expires=Max-Age=-99999999")})}_getCookieKeys(){return document.cookie.split(";").map(t=>t.split("=")[0])}}let Ro,un;const p2=()=>{Ro=gi.get("platform","id"),un=new f2},dd=c=>Ro?[Ro,c].join("."):c,cf={get(c){try{return JSON.parse(un.getItem(dd(c)))}catch(t){return null}},set(c,t){try{return un.setItem(dd(c),JSON.stringify(t)),!0}catch(n){return!1}},remove(c){un.removeItem(dd(c))},clear(){Ro?un.keys().forEach(c=>{c.indexOf(Ro+".")===0&&un.removeItem(c)}):un.clear()}},ql=/\{\/(.*?)\/([igm]{0,3})\}/g,df=/^[!*$]$/,dv=/\/:\w+?@@([0-9]+?)@@/,fv=/^\/:/,nu=(c,t="R")=>(ql.test(c)&&(c=c.replace(ql,t)),c),g2=c=>{const t=new Map;return[...Object.keys(c),...Object.getOwnPropertySymbols(c)].forEach(n=>{t.set(n,c[n])}),t};class m2{constructor(t="",n,a){this._hash=t,this._storeCaller=a,this._register=new Map,this._isCreated=!1,this._isSharedInstance=!1,this._cancelled=!1,this._copiedHistoryState=null,Li(n)?this._register=g2(n):Wi(n)&&(this._storeCaller=n),this._register.set(xt.store,this._storeCaller)}cancel(){ge.debug("[router]:",`cancelled ${this._hash}`),this._cancelled=!0}get url(){return this._hash}get register(){return this._register}get hash(){return this._hash}set hash(t){this._hash=t}get route(){return this._route}set route(t){this._route=t}get provider(){return this._provider}set provider(t){this._provider=t}get providerType(){return this._providerType}set providerType(t){this._providerType=t}set page(t){this._page=t}get page(){return this._page}set isCreated(t){this._isCreated=t}get isCreated(){return this._isCreated}get isSharedInstance(){return this._isSharedInstance}set isSharedInstance(t){this._isSharedInstance=t}get isCancelled(){return this._cancelled}set copiedHistoryState(t){this._copiedHistoryState=t}get copiedHistoryState(){return this._copiedHistoryState}}class _2{constructor(t={}){let n=["on","before","after"].reduce((a,u)=>bt(t[u])?u:a,void 0);this._cfg=t,n&&(this._provider={type:n,request:t[n]})}get path(){return this._cfg.path}get name(){return this._cfg.name}get component(){return this._cfg.component}get options(){return this._cfg.options}get widgets(){return this._cfg.widgets}get cache(){return this._cfg.cache}get hook(){return this._cfg.hook}get beforeNavigate(){return this._cfg.beforeNavigate}get provider(){return this._provider}}const ff=c=>nu(c).split("/").length,y2=c=>{const t=[];for(let[n]of dr.entries())ff(n)===c&&t.push(n);return t},su=c=>{c=c.replace(/^#/,"");const t=/(\/?:?[^/]+)/g,n=y2(ff(c)),a=c.match(t)||[];let u=[],f=n.filter(m=>{let p=!0;if(ql.test(m)){const T=m.match(ql);T&&T.length&&(m=T.reduce((A,b)=>{const I=u.length;return A=A.replace(b,`@@${I}@@`),u.push(b.substring(1,b.length-1)),A},m))}const x=m.match(t)||[];for(let T=0,A=x.length;T<A;T++){const b=x[T],I=a[T];if(dv.test(b)){const v=dv.exec(b)[1],O=u[v],W=/\/([^\/]+)\/([igm]{0,3})/.exec(O);if(W&&W.length){const Z=W[1],re=W[2];new RegExp(`^/${Z}$`,re).test(I)||(p=!1)}}else{if(fv.test(b))continue;I&&b.toLowerCase()!==I.toLowerCase()&&(p=!1)}}return p});if(f.length){if(f.indexOf(c)!==-1){const m=f[f.indexOf(c)];return dr.get(m)}else if(f=f.sort(m=>fv.test(m)?-1:1),Lr(f[0]))return dr.get(f[0])}return!1},y0=(c="",t)=>{t=nu(t,"");const n=/(\/?:?[\w%\s:.-]+)/g,a=c.match(n)||[],u=t.match(n)||[],f=/^\/:([\w-]+)\/?/;return u.reduce((m,p,x)=>{const T=f.exec(p);return T&&T.length&&m.set(T[1],decodeURIComponent(a[x].replace(/^\//,""))),m},new Map)},ou=(c,t)=>{if(c&&c.hasOwnProperty(t))return c[t]},x2=c=>{if(c.path==="$"){let t={preventStorage:!0};Li(c.options)&&(t={...c.options,...t}),c.options=t,Lo&&(c.after=Lo)}return new _2(c)},v2=(c,t,n)=>new m2(c,t,n),T2=c=>{if(!c.to&&!c.name)return!1;const t=S2(c.to||c.name),n=/\/:([\w-]+)\/?/;let a=t;return n.test(t)&&(c.params&&(a=Object.keys(c.params).reduce((f,m)=>f.replace(`:${m}`,c.params[m]),t)),c.query)?`${a}${X2(c.query)}`:a},S2=c=>{for(let[t,n]of dr.entries())if(n.name===c)return t;return!1},w2=(c,t)=>{if(xn(c)){const u=V2();if(u.has(c))c=u.get(c);else return!1}const n=t.register,a=c.options;return n.has("keepAlive")?n.get("keepAlive"):a&&a.keepAlive?a.keepAlive:!1},os=(c,t=[],n={})=>{yf(t)||(t=[t]),t.forEach(a=>{const u=`_on${D0(a)}`;bt(c[u])&&c[u](n)})};let mn=null;const A2=()=>{if(yn)return yn.get().reduce((c,t)=>{const n=t.ref.toLowerCase();return c[n]=t,c},{})},E2=(c,t)=>{const n=(c||[]).map(a=>a.toLowerCase());yn.forEach(a=>{a.visible=n.indexOf(a.ref.toLowerCase())!==-1,a.visible&&os(a,["activated"],t)}),Je.state==="Widgets"&&mn&&!mn.visible&&Je._setState("")},C2=c=>(c=D0(c),yn.getByRef(c)||!1),b2=c=>{const t=C2(c);t&&(I2(t),Je.state==="Widgets"?Je.reload(mn):Je._setState("Widgets",[mn]))},pv=()=>{mn=null,Je._setState("")},x0=()=>mn,I2=c=>{mn=c},v0=(c,t)=>c.c({type:t,visible:!1,widgets:A2()});let Bt=[];const T0=c=>{const t=as();if(!t)return;const a=c.register.get(xt.store),u=su(t),f=ou(u.options,"preventStorage");if(Wi(a)?a:!f){const p=t.replace(/^\//,""),x=$l(p),T=M2(Ir(),c),A=k0();if(x===-1||A.get("storeSameHash"))Bt.push({hash:p,state:T});else{const b=Bt.splice(x,1)[0];Bt.push({hash:b.hash,state:T})}}},$l=c=>{for(let t=0;t<Bt.length;t++)if(Bt[t].hash===c)return t;return-1},R2=c=>{let t=null;return Bt.length&&(c?$l(c)!==-1&&(t=Bt[$l(c)].state):t=Bt[Bt.length-1].state),t},L2=(c=null,t)=>{if(!Bt.length)return;const n=t?$l(t):Bt.length-1;n!==-1&&Li(c)&&(Bt[n].state=c)},M2=(c,t)=>{if(t.isSharedInstance){if(t.copiedHistoryState)return t.copiedHistoryState}else if(c&&bt(c.historyState))return c.historyState();return null},S0=()=>Bt.slice(0),au=(c=[])=>{yf(c)&&(Bt=c)};let gv,Je,_n,lu,mi,yn,w0,Lo,Pd=!0,A0=async(c,t)=>!0,E0=()=>{},dr=new Map,Mo=new Map,C0=!1,pf=null,b0,Yl,I0,R0;const P2=c=>{c.pages&&(_n=c.pages.childList),c.widgets&&c.widgets.children&&(yn=c.widgets.childList,yn.forEach(t=>t.visible=!1)),c._handleBack=t=>{Ul(-1),t.preventDefault()}},k2=(c,t)=>{let{appInstance:n,routes:a}=c;t&&mf(t)&&(Je=t),Je||(Je=n||Md),gv=Je.application,_n=gv.childList,lu=Je.stage,mi=G2(),P2(Je),yf(a)?D2(c):bt(a)&&(console.warn("[Router]: Calling Router.route() directly is deprecated."),console.warn("Use object config: https://rdkcentral.github.io/Lightning-SDK/#/plugins/router/configuration"))},D2=c=>{C0||O2(c),c.routes.forEach(t=>{const n=xf(t.path);if(Lr(n))console.error(`${n} already exists in routes configuration`);else{const a=x2(t);if(dr.set(n,a),a.component){let u=a.component;_f(u)&&(mi.get("lazyCreate")||(u=v0(lu,u),_n.a(u))),Mo.set(n,u)}}})},O2=c=>{w0=c.root,bt(c.boot)&&(Lo=c.boot),Wi(c.updateHash)&&(Pd=c.updateHash),bt(c.beforeEachRoute)&&(A0=c.beforeEachRoute),bt(c.afterEachRoute)&&(E0=c.afterEachRoute),c.bootComponent&&(console.warn("[Router]: Boot Component is now available as a special router: https://rdkcentral.github.io/Lightning-SDK/#/plugins/router/configuration?id=special-routes"),console.warn("[Router]: setting { bootComponent } property will be deprecated in a future release"),mf(c.bootComponent)?c.routes.push({path:"$",component:c.bootComponent,after:Lo||null,options:{preventStorage:!0}}):console.error(`[Router]: ${c.bootComponent} is not a valid boot component`)),c.routes.forEach(t=>{const n=nu(t.path);if(/.*\/:.*?\?$/u.test(n)){const u=t.path.substring(0,t.path.lastIndexOf("/")),f=t.path.substring(0,t.path.lastIndexOf("?"));t.path=f;let m={...t};m.path=u,c.routes.push(m)}}),C0=!0},gf=(c,t)=>{Mo.has(c)&&Mo.set(c,t)},L0=c=>Mo.has(c)?Mo.get(c):null,kd=()=>{if(!mi||!mi.size)return!1;const c=mi.get("updateHash");return!(Wi(c)&&!c||Wi(Pd)&&!Pd)},F2=c=>{const t=c.hash,n=c.route,a=c.register,u=c.page;ou(n.options,"clearHistory")?au([]):t&&!df.test(n.path)&&T0(c),gf(n.path,u),c.isSharedInstance||!c.isCreated?os(u,"changed"):c.isCreated&&os(u,"mounted"),yn&&E2(n.widgets,u),Ir()&&!c.isSharedInstance&&N2(pf,c),a.get(xt.historyState)&&bt(u.historyState)&&u.historyState(a.get(xt.historyState)),U2(u),b0=c.hash,Yl=n.path;for(let f of Kt.values())f.isCancelled&&f.hash&&Kt.delete(f.hash);E0(c),ge.info("[route]:",n.path),ge.info("[hash]:",t)},N2=(c,t)=>{const n=Yl,a=t.register,u=mi.get("lazyDestroy"),f=mi.get("destroyOnHistoryBack"),m=a.get("keepAlive"),p=a.get(xt.backtrack);let x=!1;p&&(f||u)&&(x=!0),u&&!m&&(x=!0),Yl===t.route.path&&(x=!0),x?(gf(n,c._routedType||c.constructor),_n.remove(c),mi.get("gcOnUnload")&&lu.gc()):c.patch({x:0,y:0,scale:1,alpha:1,visible:!1})},as=()=>b0,U2=c=>{pf=c},Ir=()=>pf,Dd=()=>Yl,M0=()=>I0,z2=c=>{I0=c},B2=c=>{R0=c},j2=()=>R0,Lr=c=>dr.has(c),P0=()=>w0,H2=()=>Lo,k0=()=>mi,V2=()=>dr,bt=c=>typeof c=="function",Li=c=>typeof c=="object"&&c!==null,Wi=c=>typeof c=="boolean",mf=c=>!!(c instanceof J.Element||_f(c)),_f=c=>c.prototype&&"isComponent"in c.prototype,yf=c=>Array.isArray(c),D0=c=>`${c.charAt(0).toUpperCase()}${c.slice(1)}`,xn=c=>typeof c=="string",W2=c=>{let t;if(bt(c))try{t=c.apply(null)}catch(n){t=n}else t=c;return Li(t)&&bt(t.then)},xf=(c="")=>c.replace(/^#/,"").replace(/\/+$/,""),G2=()=>{const c=gi.get("platform","router"),t=Li(c);return["backtrack","gcOnUnload","destroyOnHistoryBack","lazyCreate","lazyDestroy","reuseInstance","autoRestoreRemote","numberNavigation","updateHash","storeSameHash"].reduce((n,a)=>(n.set(a,t?c[a]:gi.get("platform",a)),n),new Map)},vf=(c=as())=>{const t=fR();(c==="$"||!c)&&t&&xn(t)&&(c=t);let n="";const u=/([?&].*)/.exec(c),f={};if(document.location&&document.location.search&&(n=document.location.search),u&&u.length){let m=u[1];n?(m=m.replace(/^\?/,""),n=`${n}&${m}`):n=m}if(n){const m=new URLSearchParams(n);for(const[p,x]of m.entries())f[p]=x;return f}else return!1},X2=c=>Li(c)?"?"+Object.keys(c).map(t=>`${t}=${c[t]}`).join("&"):"",xt={route:Symbol("route"),hash:Symbol("hash"),store:Symbol("store"),fromHistory:Symbol("fromHistory"),expires:Symbol("expires"),resume:Symbol("resume"),backtrack:Symbol("backtrack"),historyState:Symbol("historyState"),queryParams:Symbol("queryParams")},q2={on:c=>(B2(Je.state||""),Je._setState("Loading"),fd(c)),before:c=>fd(c),after:c=>{try{fd(c,!0)}catch(t){}return Promise.resolve()}},fd=(c,t)=>{const n=c.route,a=n.provider,u=n.cache?n.cache*1e3:0,f=O0(c);return a.request(c.page,{...f}).then(()=>{c.page[xt.expires]=Date.now()+u,t&&os(c.page,"dataProvided")}).catch(m=>{throw c.page[xt.expires]=Date.now(),m})},O0=({page:c,route:t,hash:n,register:a=new Map})=>{const u=y0(n,t.path),f=vf(n),m=new Map([...u,...a]),p={};for(let[x,T]of m)p[x]=T;if(f&&(p[xt.queryParams]=f),a.size){const x={};for(let[T,A]of a)x[T]=A;c.persist=x}return c.params=p,os(c,["urlParams"],p),p},$2=c=>{if(!c[xt.expires])return!1;const t=c[xt.expires];return Date.now()>=t},mv=c=>Lr(c)?!!dr.get(c).provider:!1,Y2=c=>{if(Lr(c.path)){const{provider:t}=dr.get(c.path);return{type:t.type,provider:t.request}}},K2=(c,t)=>new Promise(n=>{c.patch({alpha:0,visible:!0,smooth:{alpha:[1,{duration:.5,delay:.1}]}}),c.transition("alpha").on("finish",()=>{t&&(t.visible=!1),n()})}),Z2=(c,t)=>new Promise(n=>{c.patch({alpha:0,visible:!0,smooth:{alpha:[1,{duration:.5,delay:.1}]}}),t&&t.patch({smooth:{alpha:[0,{duration:.5,delay:.3}]}}),c.transition("alpha").on("finish",()=>{n()})}),uu=(c,t,n,a)=>{const u=c==="x"?1920:1080;return new Promise(f=>{n.patch({[`${c}`]:t?u*-1:u,visible:!0,smooth:{[`${c}`]:[0,{duration:.4,delay:.2}]}}),a&&a.patch({[`${c}`]:0,smooth:{[`${c}`]:[t?u:u*-1,{duration:.4,delay:.2}]}}),n.transition(c).on("finish",()=>{f()})})},Q2=(c,t)=>uu("y",0,c,t),J2=(c,t)=>uu("y",1,c,t),eR=(c,t)=>uu("x",0,c,t),tR=(c,t)=>uu("x",1,c,t),_v={fade:K2,crossFade:Z2,up:Q2,down:J2,left:eR,right:tR},iR=(c,t=null)=>{const n=c.pageTransition||c.easing,a=!!(c.smoothIn||c.smoothInOut||n),u=k0().get("disableTransitions");if(c.easing&&console.warn("easing() method is deprecated and will be removed. Use pageTransition()"),!a||u)return c.visible=!0,t&&(t.visible=!1),Promise.resolve();if(n){let f;try{f=n.call(c,c,t)}catch(m){f="crossFade"}if(W2(f))return f;if(xn(f)){const m=_v[f];if(m)return m(c,t)}if(c.smoothIn){const m=(p,x,T={})=>new Promise(A=>{c.visible=!0,c.setSmooth(p,x,T),c.transition(p).on("finish",()=>{A()})});return c.smoothIn({pageIn:c,smooth:m})}}return _v.crossFade(c,t)},yv=async c=>{let t=!1;try{if(c=await rR(c),c&&!c.isCancelled?(Je.state==="Loading"&&(j2()==="Widgets"?Je._setState("Widgets",[x0()]):Je._setState("")),!c.isSharedInstance&&!c.isCancelled&&await iR(c.page,Ir())):t=!0,t||c.isCancelled)ge.debug("[router]:",`Rejected ${c.hash} because route to ${M0()} started`),c.isCreated&&!c.isSharedInstance&&_n.remove(c.page);else return F2(c),c.page}catch(n){if(!n.route)console.error(n);else if(!t){const{route:a}=n;ou(a.options,"clearHistory")?au([]):df.test(a.path)||T0(n),n.isCreated&&!n.isSharedInstance&&_n.remove(n.page),nR(n)}}},rR=async c=>{const t=c.route,n=c.hash,a=c.register;let u=L0(t.path),f=_f(u),m=!1;if(!f&&!a.get(xt.backtrack)&&(sR(t)||(u=u.constructor,f=!0)),f)c.page=v0(lu,u),_n.a(c.page),mv(t.path)&&(m=!0),c.isCreated=!0;else{c.page=u,mv(t.path)&&($2(u)||u[xt.hash]!==n)&&(m=!0);let p=Ir()&&Ir()[xt.route];t.path===p&&(c.isSharedInstance=!0,bt(c.page.historyState)&&(c.copiedHistoryState=c.page.historyState()))}c.page[xt.hash]=n,c.page[xt.route]=t.path;try{if(m){const{type:p,provider:x}=Y2(t);return c.provider=x,c.providerType=p,await q2[p](c),n!==M0()?!1:(c.providerType!=="after"&&os(c.page,"dataProvided"),c)}else return O0(c),c}catch(p){return c.error=p,Promise.reject(c)}},nR=c=>{c&&c.error?console.error(c.error):c&&ge.error(c),c.page&&Lr("!")&&_t("!",{request:c},!1)},sR=c=>{const t=ou(c.options,"reuseInstance"),n=mi.get("reuseInstance");return Wi(t)?t:!(Wi(n)&&n===!1)};class oR extends J.Component{static _template(){return{Pages:{forceZIndexContext:!0},Loading:{rect:!0,w:1920,h:1080,color:4278190080,visible:!1,zIndex:99,Label:{mount:.5,x:960,y:540,text:{text:"Loading.."}}}}}static _states(){return[class extends this{$enter(){this.tag("Loading").visible=!0}$exit(){this.tag("Loading").visible=!1}},class extends this{$enter(n,a){this._widget=a,this._refocus()}_getFocused(){return this._widget}reload(n){this._widget=n,this._refocus()}_handleKey(){const n=mi.get("autoRestoreRemote");(!Wi(n)||n===!0)&&Pt.focusPage()}}]}get pages(){return this.tag("Pages")}get widgets(){return this.tag("Widgets")}_handleBack(){}_getFocused(){return Pt.getActivePage()}}let Kt=new Map,pd="",ur="";const aR=(c,t)=>{k2(c,t),gR(),lR()},lR=()=>{let c=(Fo()||"").replace(/^#/,"");const t="$",n=vf(c),a=H2(),u=P0(),f=c.indexOf(t)!==-1;df.test(c)&&c!==t&&(c=""),ur=f?u:c||u;const m=()=>{!c&&u?xn(u)?_t(u):bt(u)&&u().then(p=>{Li(p)?_t(p.path,p.params):_t(p)}):(Kl(c),Zl().then(()=>{Je._refocus()}).catch(p=>{console.error(p)}))};if(Lr(t)){if(c&&!f&&!su(c)){_t("*",{failedHash:c});return}_t(t,{resume:ur,reload:t===c},!1)}else bt(a)?a(n).then(()=>{m()}).catch(p=>{uR(p)}):m()},uR=c=>{Lr("!")?_t("!",{request:{error:c}}):console.error(c)},_t=(c,t={},n)=>{if(Li(c)&&(c=T2(c),!c))return;let a=Fo();!kd()&&pd&&(a=pd),a.replace(/^#/,"")!==c?(Kl(c,t,n),kd()?N0(c):(pd=c,Zl(c).then(()=>{Je._refocus()}).catch(u=>{console.error(u)}))):t.reload&&(Kl(c,t,n),Zl(c).then(()=>{Je._refocus()}).catch(u=>{console.error(u)}))},Kl=(c,t={},n)=>{if(c=xf(c),!Kt.has(c)){for(let u of Kt.values())u.cancel();const a=v2(c,t,n);return Kt.set(decodeURIComponent(c),a),a}return!1},Zl=async c=>{const t=xf(c||Fo()),n=decodeURIComponent(t);let a=Kt.get(n);!a&&!Kt.size&&(a=Kl(t));const u=su(t);if(!u){Lr("*")?_t("*",{failedHash:t}):console.error(`Unable to navigate to: ${t}`);return}a.hash=t,a.route=u;let f=await A0(as(),a);if(f&&u.beforeNavigate&&(f=await u.beforeNavigate(as(),a)),Wi(f)){if(f)return hR(a)}else if(a.cancel(),Kt.delete(n),xn(f))_t(f);else if(Li(f)){let m=!0;Wi(f.store)&&(m=f.store),_t(f.path,f.params,m)}},hR=c=>{const t=c.hash,n=c.route,a=decodeURIComponent(t);if(z2(t),n.path){const u=L0(n.path);if(bt(n.hook)){const f=y0(t,n.path),m={};for(const p of f.keys())m[p]=f.get(p);n.hook(Je,{...m})}if(u){const f=Ir();if(f){const m=w2(Dd(),c);f&&n.path===Dd()&&!m&&f._setState("")}mf(u)?yv(c).then(()=>{Je._refocus(),Kt.delete(a)}):u().then(m=>m.default).then(m=>(gf(n.path,m),yv(c))).then(()=>{Je._refocus(),Kt.delete(a)})}else Kt.delete(a)}},Ul=(c=0)=>{if(!c||isNaN(c))return!1;const t=S0();if(c=Math.abs(c),c>t.length)return bt(Je._handleAppClose)?Je._handleAppClose():Je.application.closeApp();if(t.length){const n=t.splice(t.length-c,c)[0];return au(t),_t(n.hash,{[xt.backtrack]:!0,[xt.historyState]:n.state},!1)}else if(mi.get("backtrack")){const n=/(\/:?[\w%\s-]+)$/;let a=nu(Fo()),u=ff(a);if(u>1){for(;u--;)if(a=a.replace(n,""),su(a))return _t(a,{[xt.backtrack]:!0},!1)}}return!1},cR=()=>{xn(ur)?(_t(ur,!1),ur=""):bt(ur)?ur().then(c=>{ur="",Li(c)?_t(c.path,c.params):_t(c)}):console.warn("[Router]: resume() called but no hash found")},dR=()=>{if(!F0()){const c=as();_t(c,{reload:!0},!1)}},F0=()=>{if(Kt.size){let c=!1;for(let t of Kt.values())t.isCancelled||(c=!0);return c}return!1},fR=()=>ur;let Fo=()=>document.location.hash,N0=c=>{document.location.hash=c};const pR=c=>{c.getHash&&(Fo=c.getHash),c.setHash&&(N0=c.setHash)},gR=()=>{hf.addEventListener(window,"hashchange",async()=>{if(kd())try{await Zl()}catch(c){console.error(c)}})},mR=()=>{const c=P0();xn(c)?_t(c):bt(c)&&c().then(t=>{Li(t)?_t(t.path,t.params):_t(t)})},Pt={startRouter:aR,navigate:_t,resume:cR,step:Ul,go:Ul,back:Ul.bind(null,-1),activePage:Ir,getActivePage(){return Ir()},getActiveRoute:Dd,getActiveHash:as,focusWidget:b2,getActiveWidget:x0,restoreFocus:pv,isNavigating:F0,getHistory:S0,setHistory:au,getHistoryState:R2,replaceHistoryState:L2,getQueryStringParams:vf,reload:dR,symbols:xt,App:oR,focusPage:pv,root:mR,setupRoutes(){console.warn("Router: setupRoutes is deprecated, consolidate your configuration"),console.warn("https://rdkcentral.github.io/Lightning-SDK/#/plugins/router/configuration")},on(){console.warn("Router.on() is deprecated, consolidate your configuration"),console.warn("https://rdkcentral.github.io/Lightning-SDK/#/plugins/router/configuration")},before(){console.warn("Router.before() is deprecated, consolidate your configuration"),console.warn("https://rdkcentral.github.io/Lightning-SDK/#/plugins/router/configuration")},after(){console.warn("Router.after() is deprecated, consolidate your configuration"),console.warn("https://rdkcentral.github.io/Lightning-SDK/#/plugins/router/configuration")}};let gd;const _R=(c,t,n,a)=>{sb(t,n),jI(n),p2(),n.plugins&&(n.plugins.profile&&tI(n.plugins.profile),n.plugins.metrics&&qb(n.plugins.metrics),n.plugins.mediaPlayer&&d2(n.plugins.mediaPlayer),n.plugins.mediaPlayer&&hI(n.plugins.mediaPlayer),n.plugins.ads&&_I(n.plugins.ads),n.plugins.router&&pR(n.plugins.router),n.plugins.tv&&nI(n.plugins.tv),n.plugins.purchase&&iI(n.plugins.purchase),n.plugins.pin&&sI(n.plugins.pin));const u=c2(c,a,n);return po.log=ge,po.settings=gi,po.ads=vI,po.lightning=J,gd=new u(t),po.appInstance=gd,gd};class _M extends J.Component{static _template(){return{visible:!1,rect:!0,color:2415919104,shader:{type:J.shaders.RoundedRectangle,radius:5},Text:{y:5,x:20,text:{textColor:4294967295,fontSize:38,lineHeight:38*1.4,textAlign:"center",wordWrap:!0,maxLines:3,shadow:!0,shadowColor:4281545523}}}}_init(){this._textTextureDefaults=new J.textures.TextTexture(this.stage).cloneArgs(),this.tag("Text").on("txLoaded",({_source:t})=>{this.w=t.w+this.tag("Text").x*2,this.h=t.h,this.position()})}get textFormat(){const t=this.tag("Text").text;return{fontFace:t.fontFace||"sans-serif",fontSize:t.fontSize,lineHeight:t.lineHeight,textAlign:t.textAlign,wordWrap:!0,maxLines:t.maxLines}}show(){this.visible=!0}hide(){this.visible=!1}position(){this.x=this._calculateX(this.xPos),this.y=this._calculateY(this.yPos)}set viewportW(t){this._viewportW=t,this.x=this._calculateX(this.xPos)}get viewportW(){return this._viewportW||this.application.finalW}set viewportH(t){this._viewportH=t,this.y=this._calculateY(this.yPos)}get viewportH(){return this._viewportH||this.application.finalH}_calculateX(t){return t==="center"?t=(this.viewportW-this.finalW)/2:t==="left"?t=60:t==="right"&&(t=this.viewportW-this.finalW-60),t}set xPos(t){this._x=t,this.x=this._calculateX(t)}get xPos(){return this._x||"center"}_calculateY(t){return t==="center"?(this.viewportH-this.finalH)/2:t==="top"?60:t==="bottom"?this.viewportH-this.finalH-60:t}set yPos(t){this._y=t,this.y=this._calculateY(t)}get yPos(){return this._y||"bottom"}set fontFamily(t){this.tag("Text").text.fontFace=t}set fontSize(t){this.tag("Text").text.fontSize=t,this.tag("Text").text.lineHeight=t*1.3}set fontColor(t){this.tag("Text").color=t}set backgroundColor(t){this.color=t}_defineBreakpoint(t,n){if(n>=this.maxWidth)return this.maxWidth;const a=J.textures.TextTexture.renderer(this.stage,this.stage.platform.getDrawingCanvas(),{...this._textTextureDefaults,...this.textFormat,wordWrapWidth:n,text:t})._calculateRenderInfo();return a.width<=n&&a.lines.length<=2?n:this._defineBreakpoint(t,n*1.25)}set text(t){if(this.alpha=0,t&&t.length){const n=this._defineBreakpoint(t,640);this.tag("Text").text.wordWrapWidth=n,this.tag("Text").text=t,this.alpha=1}}set textAlign(t){this._textAlign=t,this.tag("Text").text.textAlign=t}set maxWidth(t){this._maxWidth=t}get maxWidth(){return(this._maxWidth||1200)-this.tag("Text").x*2}set maxLines(t){this.tag("Text").text.maxLines=t}}const ee={colors:{background:4279639853,primary:4279509822,primaryLight:4280169822,secondary:4283596540,tertiary:4284586236,accent:4291485694,error:4281685370,warning:4281685370,info:4281685370,white:4294046193,yellow:4294105945,accentGrey:{light:4288784562,dark:4282732896},dark:4278584867,black:4278190080}},Ql=["/filters/dgnlsl30-movies-action?page=1&language=en&size=50","/filters/dgnlsl30-movies-comedy?page=1&language=en&size=50","/filters/marvel-movies?page=1&language=en&size=50","/filters/gNAaDQJl13GS?page=1&language=en&size=100","/filters/dgnlsl30-movies-action?page=1&language=en&size=50","/filters/dgnlsl30-movies-comedy?page=1&language=en&size=50","/filters/marvel-movies?page=1&language=en&size=50","/filters/gNAaDQJl13GS?page=1&language=en&size=100","/filters/dgnlsl30-movies-action?page=1&language=en&size=50","/filters/dgnlsl30-movies-comedy?page=1&language=en&size=50","/filters/marvel-movies?page=1&language=en&size=50","/filters/gNAaDQJl13GS?page=1&language=en&size=100","/filters/dgnlsl30-movies-action?page=1&language=en&size=50","/filters/dgnlsl30-movies-comedy?page=1&language=en&size=50","/filters/marvel-movies?page=1&language=en&size=50","/filters/gNAaDQJl13GS?page=1&language=en&size=100"],xv=["Action Movies","Only on Enlight","Marvel Movies","Drama Movies","Romantic Comdey Movies","Trending Now","Comdey Movies","Thriller Movies","Action Movies","Only on Enlight","Marvel Movies","Drama Movies","Romantic Comdey Movies","Trending Now","Comdey Movies","Thriller Movies","Long Rail"],Od={regular:{w:216,h:324,margin:30,minimumCardsInViewport:7},wide:{w:324,h:216,margin:30,minimumCardsInViewport:5}};class vv extends J.Component{constructor(){super(...arguments),this.data={},this.index=0,this.totalElements=0,this.cardSize=Od.regular,this.focused=!1,this.railIndex=0}static _template(){return{rect:!0,color:ee.colors.primary,shader:{type:J.shaders.RoundedRectangle,radius:20},Image:{w:t=>t,h:t=>t,shader:{type:J.shaders.RoundedRectangle,radius:20}},Label:{x:10,w:t=>t,color:ee.colors.accentGrey.light,text:{fontSize:22.5,fontFace:"Saira Regular",fontStyle:"400"}}}}set item(t){const{label:n,src:a,data:u,index:f,totalElements:m,cardSize:p,railIndex:x}=t;this.data=u,this.index=f,this.totalElements=m,this.cardSize=p,this.railIndex=x,this.patch({Image:{src:a},w:this.cardSize.w,h:this.cardSize.h,Label:{text:n==null?void 0:n.toString(),y:this.cardSize.h+4}})}_handleEnter(){Pt.navigate(`content/railItem/${this.data.uid}`,{from:"Home",data:this.data})}_focus(){this.focused=!0;const t={cardWidth:this.w,cardHeight:this.h,cardIndex:this.index,railTotalElements:this.totalElements,cardSize:this.cardSize,railIndex:this.railIndex};this.fireAncestors("$changeItemOnFocus",this.data,t),this.patch({Label:{smooth:{color:ee.colors.white}},Rectangle:{color:ee.colors.yellow,x:10,y:n=>n+54,w:n=>n-20,h:5,rect:!0}})}_unfocus(){this.focused=!1,this.patch({smooth:{color:ee.colors.primary,scale:1},Label:{smooth:{color:ee.colors.accentGrey.light}},Rectangle:void 0})}}function U0(c,t){return function(){return c.apply(t,arguments)}}const{toString:z0}=Object.prototype,{getPrototypeOf:Tf}=Object,Sf=(c=>t=>{const n=z0.call(t);return c[n]||(c[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),fr=c=>(c=c.toLowerCase(),t=>Sf(t)===c),hu=c=>t=>typeof t===c,{isArray:hs}=Array,Po=hu("undefined");function yR(c){return c!==null&&!Po(c)&&c.constructor!==null&&!Po(c.constructor)&&Rr(c.constructor.isBuffer)&&c.constructor.isBuffer(c)}const B0=fr("ArrayBuffer");function xR(c){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(c):t=c&&c.buffer&&B0(c.buffer),t}const vR=hu("string"),Rr=hu("function"),j0=hu("number"),wf=c=>c!==null&&typeof c=="object",TR=c=>c===!0||c===!1,zl=c=>{if(Sf(c)!=="object")return!1;const t=Tf(c);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in c)&&!(Symbol.iterator in c)},SR=fr("Date"),wR=fr("File"),AR=fr("Blob"),ER=fr("FileList"),CR=c=>wf(c)&&Rr(c.pipe),bR=c=>{const t="[object FormData]";return c&&(typeof FormData=="function"&&c instanceof FormData||z0.call(c)===t||Rr(c.toString)&&c.toString()===t)},IR=fr("URLSearchParams"),RR=c=>c.trim?c.trim():c.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function No(c,t,{allOwnKeys:n=!1}={}){if(c===null||typeof c>"u")return;let a,u;if(typeof c!="object"&&(c=[c]),hs(c))for(a=0,u=c.length;a<u;a++)t.call(null,c[a],a,c);else{const f=n?Object.getOwnPropertyNames(c):Object.keys(c),m=f.length;let p;for(a=0;a<m;a++)p=f[a],t.call(null,c[p],p,c)}}function H0(c,t){t=t.toLowerCase();const n=Object.keys(c);let a=n.length,u;for(;a-- >0;)if(u=n[a],t===u.toLowerCase())return u;return null}const V0=(()=>typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global)(),W0=c=>!Po(c)&&c!==V0;function Fd(){const{caseless:c}=W0(this)&&this||{},t={},n=(a,u)=>{const f=c&&H0(t,u)||u;zl(t[f])&&zl(a)?t[f]=Fd(t[f],a):zl(a)?t[f]=Fd({},a):hs(a)?t[f]=a.slice():t[f]=a};for(let a=0,u=arguments.length;a<u;a++)arguments[a]&&No(arguments[a],n);return t}const LR=(c,t,n,{allOwnKeys:a}={})=>(No(t,(u,f)=>{n&&Rr(u)?c[f]=U0(u,n):c[f]=u},{allOwnKeys:a}),c),MR=c=>(c.charCodeAt(0)===65279&&(c=c.slice(1)),c),PR=(c,t,n,a)=>{c.prototype=Object.create(t.prototype,a),c.prototype.constructor=c,Object.defineProperty(c,"super",{value:t.prototype}),n&&Object.assign(c.prototype,n)},kR=(c,t,n,a)=>{let u,f,m;const p={};if(t=t||{},c==null)return t;do{for(u=Object.getOwnPropertyNames(c),f=u.length;f-- >0;)m=u[f],(!a||a(m,c,t))&&!p[m]&&(t[m]=c[m],p[m]=!0);c=n!==!1&&Tf(c)}while(c&&(!n||n(c,t))&&c!==Object.prototype);return t},DR=(c,t,n)=>{c=String(c),(n===void 0||n>c.length)&&(n=c.length),n-=t.length;const a=c.indexOf(t,n);return a!==-1&&a===n},OR=c=>{if(!c)return null;if(hs(c))return c;let t=c.length;if(!j0(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=c[t];return n},FR=(c=>t=>c&&t instanceof c)(typeof Uint8Array<"u"&&Tf(Uint8Array)),NR=(c,t)=>{const a=(c&&c[Symbol.iterator]).call(c);let u;for(;(u=a.next())&&!u.done;){const f=u.value;t.call(c,f[0],f[1])}},UR=(c,t)=>{let n;const a=[];for(;(n=c.exec(t))!==null;)a.push(n);return a},zR=fr("HTMLFormElement"),BR=c=>c.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(n,a,u){return a.toUpperCase()+u}),Tv=(({hasOwnProperty:c})=>(t,n)=>c.call(t,n))(Object.prototype),jR=fr("RegExp"),G0=(c,t)=>{const n=Object.getOwnPropertyDescriptors(c),a={};No(n,(u,f)=>{t(u,f,c)!==!1&&(a[f]=u)}),Object.defineProperties(c,a)},HR=c=>{G0(c,(t,n)=>{if(Rr(c)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const a=c[n];if(Rr(a)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")})}})},VR=(c,t)=>{const n={},a=u=>{u.forEach(f=>{n[f]=!0})};return hs(c)?a(c):a(String(c).split(t)),n},WR=()=>{},GR=(c,t)=>(c=+c,Number.isFinite(c)?c:t),md="abcdefghijklmnopqrstuvwxyz",Sv="0123456789",X0={DIGIT:Sv,ALPHA:md,ALPHA_DIGIT:md+md.toUpperCase()+Sv},XR=(c=16,t=X0.ALPHA_DIGIT)=>{let n="";const{length:a}=t;for(;c--;)n+=t[Math.random()*a|0];return n};function qR(c){return!!(c&&Rr(c.append)&&c[Symbol.toStringTag]==="FormData"&&c[Symbol.iterator])}const $R=c=>{const t=new Array(10),n=(a,u)=>{if(wf(a)){if(t.indexOf(a)>=0)return;if(!("toJSON"in a)){t[u]=a;const f=hs(a)?[]:{};return No(a,(m,p)=>{const x=n(m,u+1);!Po(x)&&(f[p]=x)}),t[u]=void 0,f}}return a};return n(c,0)},G={isArray:hs,isArrayBuffer:B0,isBuffer:yR,isFormData:bR,isArrayBufferView:xR,isString:vR,isNumber:j0,isBoolean:TR,isObject:wf,isPlainObject:zl,isUndefined:Po,isDate:SR,isFile:wR,isBlob:AR,isRegExp:jR,isFunction:Rr,isStream:CR,isURLSearchParams:IR,isTypedArray:FR,isFileList:ER,forEach:No,merge:Fd,extend:LR,trim:RR,stripBOM:MR,inherits:PR,toFlatObject:kR,kindOf:Sf,kindOfTest:fr,endsWith:DR,toArray:OR,forEachEntry:NR,matchAll:UR,isHTMLForm:zR,hasOwnProperty:Tv,hasOwnProp:Tv,reduceDescriptors:G0,freezeMethods:HR,toObjectSet:VR,toCamelCase:BR,noop:WR,toFiniteNumber:GR,findKey:H0,global:V0,isContextDefined:W0,ALPHABET:X0,generateString:XR,isSpecCompliantForm:qR,toJSONObject:$R};function Fe(c,t,n,a,u){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=c,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),a&&(this.request=a),u&&(this.response=u)}G.inherits(Fe,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:G.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const q0=Fe.prototype,$0={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(c=>{$0[c]={value:c}});Object.defineProperties(Fe,$0);Object.defineProperty(q0,"isAxiosError",{value:!0});Fe.from=(c,t,n,a,u,f)=>{const m=Object.create(q0);return G.toFlatObject(c,m,function(x){return x!==Error.prototype},p=>p!=="isAxiosError"),Fe.call(m,c.message,t,n,a,u),m.cause=c,m.name=c.name,f&&Object.assign(m,f),m};const YR=null;function Nd(c){return G.isPlainObject(c)||G.isArray(c)}function Y0(c){return G.endsWith(c,"[]")?c.slice(0,-2):c}function wv(c,t,n){return c?c.concat(t).map(function(u,f){return u=Y0(u),!n&&f?"["+u+"]":u}).join(n?".":""):t}function KR(c){return G.isArray(c)&&!c.some(Nd)}const ZR=G.toFlatObject(G,{},null,function(t){return/^is[A-Z]/.test(t)});function cu(c,t,n){if(!G.isObject(c))throw new TypeError("target must be an object");t=t||new FormData,n=G.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(O,W){return!G.isUndefined(W[O])});const a=n.metaTokens,u=n.visitor||A,f=n.dots,m=n.indexes,x=(n.Blob||typeof Blob<"u"&&Blob)&&G.isSpecCompliantForm(t);if(!G.isFunction(u))throw new TypeError("visitor must be a function");function T(v){if(v===null)return"";if(G.isDate(v))return v.toISOString();if(!x&&G.isBlob(v))throw new Fe("Blob is not supported. Use a Buffer instead.");return G.isArrayBuffer(v)||G.isTypedArray(v)?x&&typeof Blob=="function"?new Blob([v]):Buffer.from(v):v}function A(v,O,W){let Z=v;if(v&&!W&&typeof v=="object"){if(G.endsWith(O,"{}"))O=a?O:O.slice(0,-2),v=JSON.stringify(v);else if(G.isArray(v)&&KR(v)||(G.isFileList(v)||G.endsWith(O,"[]"))&&(Z=G.toArray(v)))return O=Y0(O),Z.forEach(function(Q,q){!(G.isUndefined(Q)||Q===null)&&t.append(m===!0?wv([O],q,f):m===null?O:O+"[]",T(Q))}),!1}return Nd(v)?!0:(t.append(wv(W,O,f),T(v)),!1)}const b=[],I=Object.assign(ZR,{defaultVisitor:A,convertValue:T,isVisitable:Nd});function D(v,O){if(!G.isUndefined(v)){if(b.indexOf(v)!==-1)throw Error("Circular reference detected in "+O.join("."));b.push(v),G.forEach(v,function(Z,re){(!(G.isUndefined(Z)||Z===null)&&u.call(t,Z,G.isString(re)?re.trim():re,O,I))===!0&&D(Z,O?O.concat(re):[re])}),b.pop()}}if(!G.isObject(c))throw new TypeError("data must be an object");return D(c),t}function Av(c){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(c).replace(/[!'()~]|%20|%00/g,function(a){return t[a]})}function Af(c,t){this._pairs=[],c&&cu(c,this,t)}const K0=Af.prototype;K0.append=function(t,n){this._pairs.push([t,n])};K0.toString=function(t){const n=t?function(a){return t.call(this,a,Av)}:Av;return this._pairs.map(function(u){return n(u[0])+"="+n(u[1])},"").join("&")};function QR(c){return encodeURIComponent(c).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Z0(c,t,n){if(!t)return c;const a=n&&n.encode||QR,u=n&&n.serialize;let f;if(u?f=u(t,n):f=G.isURLSearchParams(t)?t.toString():new Af(t,n).toString(a),f){const m=c.indexOf("#");m!==-1&&(c=c.slice(0,m)),c+=(c.indexOf("?")===-1?"?":"&")+f}return c}class JR{constructor(){this.handlers=[]}use(t,n,a){return this.handlers.push({fulfilled:t,rejected:n,synchronous:a?a.synchronous:!1,runWhen:a?a.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){G.forEach(this.handlers,function(a){a!==null&&t(a)})}}const Ev=JR,Q0={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},eL=typeof URLSearchParams<"u"?URLSearchParams:Af,tL=typeof FormData<"u"?FormData:null,iL=typeof Blob<"u"?Blob:null,rL=(()=>{let c;return typeof navigator<"u"&&((c=navigator.product)==="ReactNative"||c==="NativeScript"||c==="NS")?!1:typeof window<"u"&&typeof document<"u"})(),nL=(()=>typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),Hi={isBrowser:!0,classes:{URLSearchParams:eL,FormData:tL,Blob:iL},isStandardBrowserEnv:rL,isStandardBrowserWebWorkerEnv:nL,protocols:["http","https","file","blob","url","data"]};function sL(c,t){return cu(c,new Hi.classes.URLSearchParams,Object.assign({visitor:function(n,a,u,f){return Hi.isNode&&G.isBuffer(n)?(this.append(a,n.toString("base64")),!1):f.defaultVisitor.apply(this,arguments)}},t))}function oL(c){return G.matchAll(/\w+|\[(\w*)]/g,c).map(t=>t[0]==="[]"?"":t[1]||t[0])}function aL(c){const t={},n=Object.keys(c);let a;const u=n.length;let f;for(a=0;a<u;a++)f=n[a],t[f]=c[f];return t}function J0(c){function t(n,a,u,f){let m=n[f++];const p=Number.isFinite(+m),x=f>=n.length;return m=!m&&G.isArray(u)?u.length:m,x?(G.hasOwnProp(u,m)?u[m]=[u[m],a]:u[m]=a,!p):((!u[m]||!G.isObject(u[m]))&&(u[m]=[]),t(n,a,u[m],f)&&G.isArray(u[m])&&(u[m]=aL(u[m])),!p)}if(G.isFormData(c)&&G.isFunction(c.entries)){const n={};return G.forEachEntry(c,(a,u)=>{t(oL(a),u,n,0)}),n}return null}const lL={"Content-Type":void 0};function uL(c,t,n){if(G.isString(c))try{return(t||JSON.parse)(c),G.trim(c)}catch(a){if(a.name!=="SyntaxError")throw a}return(n||JSON.stringify)(c)}const du={transitional:Q0,adapter:["xhr","http"],transformRequest:[function(t,n){const a=n.getContentType()||"",u=a.indexOf("application/json")>-1,f=G.isObject(t);if(f&&G.isHTMLForm(t)&&(t=new FormData(t)),G.isFormData(t))return u&&u?JSON.stringify(J0(t)):t;if(G.isArrayBuffer(t)||G.isBuffer(t)||G.isStream(t)||G.isFile(t)||G.isBlob(t))return t;if(G.isArrayBufferView(t))return t.buffer;if(G.isURLSearchParams(t))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let p;if(f){if(a.indexOf("application/x-www-form-urlencoded")>-1)return sL(t,this.formSerializer).toString();if((p=G.isFileList(t))||a.indexOf("multipart/form-data")>-1){const x=this.env&&this.env.FormData;return cu(p?{"files[]":t}:t,x&&new x,this.formSerializer)}}return f||u?(n.setContentType("application/json",!1),uL(t)):t}],transformResponse:[function(t){const n=this.transitional||du.transitional,a=n&&n.forcedJSONParsing,u=this.responseType==="json";if(t&&G.isString(t)&&(a&&!this.responseType||u)){const m=!(n&&n.silentJSONParsing)&&u;try{return JSON.parse(t)}catch(p){if(m)throw p.name==="SyntaxError"?Fe.from(p,Fe.ERR_BAD_RESPONSE,this,null,this.response):p}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Hi.classes.FormData,Blob:Hi.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};G.forEach(["delete","get","head"],function(t){du.headers[t]={}});G.forEach(["post","put","patch"],function(t){du.headers[t]=G.merge(lL)});const Ef=du,hL=G.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),cL=c=>{const t={};let n,a,u;return c&&c.split(`
`).forEach(function(m){u=m.indexOf(":"),n=m.substring(0,u).trim().toLowerCase(),a=m.substring(u+1).trim(),!(!n||t[n]&&hL[n])&&(n==="set-cookie"?t[n]?t[n].push(a):t[n]=[a]:t[n]=t[n]?t[n]+", "+a:a)}),t},Cv=Symbol("internals");function _o(c){return c&&String(c).trim().toLowerCase()}function Bl(c){return c===!1||c==null?c:G.isArray(c)?c.map(Bl):String(c)}function dL(c){const t=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let a;for(;a=n.exec(c);)t[a[1]]=a[2];return t}function fL(c){return/^[-_a-zA-Z]+$/.test(c.trim())}function _d(c,t,n,a,u){if(G.isFunction(a))return a.call(this,t,n);if(u&&(t=n),!!G.isString(t)){if(G.isString(a))return t.indexOf(a)!==-1;if(G.isRegExp(a))return a.test(t)}}function pL(c){return c.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,n,a)=>n.toUpperCase()+a)}function gL(c,t){const n=G.toCamelCase(" "+t);["get","set","has"].forEach(a=>{Object.defineProperty(c,a+n,{value:function(u,f,m){return this[a].call(this,t,u,f,m)},configurable:!0})})}class fu{constructor(t){t&&this.set(t)}set(t,n,a){const u=this;function f(p,x,T){const A=_o(x);if(!A)throw new Error("header name must be a non-empty string");const b=G.findKey(u,A);(!b||u[b]===void 0||T===!0||T===void 0&&u[b]!==!1)&&(u[b||x]=Bl(p))}const m=(p,x)=>G.forEach(p,(T,A)=>f(T,A,x));return G.isPlainObject(t)||t instanceof this.constructor?m(t,n):G.isString(t)&&(t=t.trim())&&!fL(t)?m(cL(t),n):t!=null&&f(n,t,a),this}get(t,n){if(t=_o(t),t){const a=G.findKey(this,t);if(a){const u=this[a];if(!n)return u;if(n===!0)return dL(u);if(G.isFunction(n))return n.call(this,u,a);if(G.isRegExp(n))return n.exec(u);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,n){if(t=_o(t),t){const a=G.findKey(this,t);return!!(a&&this[a]!==void 0&&(!n||_d(this,this[a],a,n)))}return!1}delete(t,n){const a=this;let u=!1;function f(m){if(m=_o(m),m){const p=G.findKey(a,m);p&&(!n||_d(a,a[p],p,n))&&(delete a[p],u=!0)}}return G.isArray(t)?t.forEach(f):f(t),u}clear(t){const n=Object.keys(this);let a=n.length,u=!1;for(;a--;){const f=n[a];(!t||_d(this,this[f],f,t,!0))&&(delete this[f],u=!0)}return u}normalize(t){const n=this,a={};return G.forEach(this,(u,f)=>{const m=G.findKey(a,f);if(m){n[m]=Bl(u),delete n[f];return}const p=t?pL(f):String(f).trim();p!==f&&delete n[f],n[p]=Bl(u),a[p]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const n=Object.create(null);return G.forEach(this,(a,u)=>{a!=null&&a!==!1&&(n[u]=t&&G.isArray(a)?a.join(", "):a)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,n])=>t+": "+n).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...n){const a=new this(t);return n.forEach(u=>a.set(u)),a}static accessor(t){const a=(this[Cv]=this[Cv]={accessors:{}}).accessors,u=this.prototype;function f(m){const p=_o(m);a[p]||(gL(u,m),a[p]=!0)}return G.isArray(t)?t.forEach(f):f(t),this}}fu.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);G.freezeMethods(fu.prototype);G.freezeMethods(fu);const cr=fu;function yd(c,t){const n=this||Ef,a=t||n,u=cr.from(a.headers);let f=a.data;return G.forEach(c,function(p){f=p.call(n,f,u.normalize(),t?t.status:void 0)}),u.normalize(),f}function eT(c){return!!(c&&c.__CANCEL__)}function Uo(c,t,n){Fe.call(this,c==null?"canceled":c,Fe.ERR_CANCELED,t,n),this.name="CanceledError"}G.inherits(Uo,Fe,{__CANCEL__:!0});function mL(c,t,n){const a=n.config.validateStatus;!n.status||!a||a(n.status)?c(n):t(new Fe("Request failed with status code "+n.status,[Fe.ERR_BAD_REQUEST,Fe.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}const _L=Hi.isStandardBrowserEnv?function(){return{write:function(n,a,u,f,m,p){const x=[];x.push(n+"="+encodeURIComponent(a)),G.isNumber(u)&&x.push("expires="+new Date(u).toGMTString()),G.isString(f)&&x.push("path="+f),G.isString(m)&&x.push("domain="+m),p===!0&&x.push("secure"),document.cookie=x.join("; ")},read:function(n){const a=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return a?decodeURIComponent(a[3]):null},remove:function(n){this.write(n,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}();function yL(c){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(c)}function xL(c,t){return t?c.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):c}function tT(c,t){return c&&!yL(t)?xL(c,t):t}const vL=Hi.isStandardBrowserEnv?function(){const t=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");let a;function u(f){let m=f;return t&&(n.setAttribute("href",m),m=n.href),n.setAttribute("href",m),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:n.pathname.charAt(0)==="/"?n.pathname:"/"+n.pathname}}return a=u(window.location.href),function(m){const p=G.isString(m)?u(m):m;return p.protocol===a.protocol&&p.host===a.host}}():function(){return function(){return!0}}();function TL(c){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(c);return t&&t[1]||""}function SL(c,t){c=c||10;const n=new Array(c),a=new Array(c);let u=0,f=0,m;return t=t!==void 0?t:1e3,function(x){const T=Date.now(),A=a[f];m||(m=T),n[u]=x,a[u]=T;let b=f,I=0;for(;b!==u;)I+=n[b++],b=b%c;if(u=(u+1)%c,u===f&&(f=(f+1)%c),T-m<t)return;const D=A&&T-A;return D?Math.round(I*1e3/D):void 0}}function bv(c,t){let n=0;const a=SL(50,250);return u=>{const f=u.loaded,m=u.lengthComputable?u.total:void 0,p=f-n,x=a(p),T=f<=m;n=f;const A={loaded:f,total:m,progress:m?f/m:void 0,bytes:p,rate:x||void 0,estimated:x&&m&&T?(m-f)/x:void 0,event:u};A[t?"download":"upload"]=!0,c(A)}}const wL=typeof XMLHttpRequest<"u",AL=wL&&function(c){return new Promise(function(n,a){let u=c.data;const f=cr.from(c.headers).normalize(),m=c.responseType;let p;function x(){c.cancelToken&&c.cancelToken.unsubscribe(p),c.signal&&c.signal.removeEventListener("abort",p)}G.isFormData(u)&&(Hi.isStandardBrowserEnv||Hi.isStandardBrowserWebWorkerEnv)&&f.setContentType(!1);let T=new XMLHttpRequest;if(c.auth){const D=c.auth.username||"",v=c.auth.password?unescape(encodeURIComponent(c.auth.password)):"";f.set("Authorization","Basic "+btoa(D+":"+v))}const A=tT(c.baseURL,c.url);T.open(c.method.toUpperCase(),Z0(A,c.params,c.paramsSerializer),!0),T.timeout=c.timeout;function b(){if(!T)return;const D=cr.from("getAllResponseHeaders"in T&&T.getAllResponseHeaders()),O={data:!m||m==="text"||m==="json"?T.responseText:T.response,status:T.status,statusText:T.statusText,headers:D,config:c,request:T};mL(function(Z){n(Z),x()},function(Z){a(Z),x()},O),T=null}if("onloadend"in T?T.onloadend=b:T.onreadystatechange=function(){!T||T.readyState!==4||T.status===0&&!(T.responseURL&&T.responseURL.indexOf("file:")===0)||setTimeout(b)},T.onabort=function(){T&&(a(new Fe("Request aborted",Fe.ECONNABORTED,c,T)),T=null)},T.onerror=function(){a(new Fe("Network Error",Fe.ERR_NETWORK,c,T)),T=null},T.ontimeout=function(){let v=c.timeout?"timeout of "+c.timeout+"ms exceeded":"timeout exceeded";const O=c.transitional||Q0;c.timeoutErrorMessage&&(v=c.timeoutErrorMessage),a(new Fe(v,O.clarifyTimeoutError?Fe.ETIMEDOUT:Fe.ECONNABORTED,c,T)),T=null},Hi.isStandardBrowserEnv){const D=(c.withCredentials||vL(A))&&c.xsrfCookieName&&_L.read(c.xsrfCookieName);D&&f.set(c.xsrfHeaderName,D)}u===void 0&&f.setContentType(null),"setRequestHeader"in T&&G.forEach(f.toJSON(),function(v,O){T.setRequestHeader(O,v)}),G.isUndefined(c.withCredentials)||(T.withCredentials=!!c.withCredentials),m&&m!=="json"&&(T.responseType=c.responseType),typeof c.onDownloadProgress=="function"&&T.addEventListener("progress",bv(c.onDownloadProgress,!0)),typeof c.onUploadProgress=="function"&&T.upload&&T.upload.addEventListener("progress",bv(c.onUploadProgress)),(c.cancelToken||c.signal)&&(p=D=>{T&&(a(!D||D.type?new Uo(null,c,T):D),T.abort(),T=null)},c.cancelToken&&c.cancelToken.subscribe(p),c.signal&&(c.signal.aborted?p():c.signal.addEventListener("abort",p)));const I=TL(A);if(I&&Hi.protocols.indexOf(I)===-1){a(new Fe("Unsupported protocol "+I+":",Fe.ERR_BAD_REQUEST,c));return}T.send(u||null)})},jl={http:YR,xhr:AL};G.forEach(jl,(c,t)=>{if(c){try{Object.defineProperty(c,"name",{value:t})}catch(n){}Object.defineProperty(c,"adapterName",{value:t})}});const EL={getAdapter:c=>{c=G.isArray(c)?c:[c];const{length:t}=c;let n,a;for(let u=0;u<t&&(n=c[u],!(a=G.isString(n)?jl[n.toLowerCase()]:n));u++);if(!a)throw a===!1?new Fe(`Adapter ${n} is not supported by the environment`,"ERR_NOT_SUPPORT"):new Error(G.hasOwnProp(jl,n)?`Adapter '${n}' is not available in the build`:`Unknown adapter '${n}'`);if(!G.isFunction(a))throw new TypeError("adapter is not a function");return a},adapters:jl};function xd(c){if(c.cancelToken&&c.cancelToken.throwIfRequested(),c.signal&&c.signal.aborted)throw new Uo(null,c)}function Iv(c){return xd(c),c.headers=cr.from(c.headers),c.data=yd.call(c,c.transformRequest),["post","put","patch"].indexOf(c.method)!==-1&&c.headers.setContentType("application/x-www-form-urlencoded",!1),EL.getAdapter(c.adapter||Ef.adapter)(c).then(function(a){return xd(c),a.data=yd.call(c,c.transformResponse,a),a.headers=cr.from(a.headers),a},function(a){return eT(a)||(xd(c),a&&a.response&&(a.response.data=yd.call(c,c.transformResponse,a.response),a.response.headers=cr.from(a.response.headers))),Promise.reject(a)})}const Rv=c=>c instanceof cr?c.toJSON():c;function ls(c,t){t=t||{};const n={};function a(T,A,b){return G.isPlainObject(T)&&G.isPlainObject(A)?G.merge.call({caseless:b},T,A):G.isPlainObject(A)?G.merge({},A):G.isArray(A)?A.slice():A}function u(T,A,b){if(G.isUndefined(A)){if(!G.isUndefined(T))return a(void 0,T,b)}else return a(T,A,b)}function f(T,A){if(!G.isUndefined(A))return a(void 0,A)}function m(T,A){if(G.isUndefined(A)){if(!G.isUndefined(T))return a(void 0,T)}else return a(void 0,A)}function p(T,A,b){if(b in t)return a(T,A);if(b in c)return a(void 0,T)}const x={url:f,method:f,data:f,baseURL:m,transformRequest:m,transformResponse:m,paramsSerializer:m,timeout:m,timeoutMessage:m,withCredentials:m,adapter:m,responseType:m,xsrfCookieName:m,xsrfHeaderName:m,onUploadProgress:m,onDownloadProgress:m,decompress:m,maxContentLength:m,maxBodyLength:m,beforeRedirect:m,transport:m,httpAgent:m,httpsAgent:m,cancelToken:m,socketPath:m,responseEncoding:m,validateStatus:p,headers:(T,A)=>u(Rv(T),Rv(A),!0)};return G.forEach(Object.keys(c).concat(Object.keys(t)),function(A){const b=x[A]||u,I=b(c[A],t[A],A);G.isUndefined(I)&&b!==p||(n[A]=I)}),n}const iT="1.3.4",Cf={};["object","boolean","number","function","string","symbol"].forEach((c,t)=>{Cf[c]=function(a){return typeof a===c||"a"+(t<1?"n ":" ")+c}});const Lv={};Cf.transitional=function(t,n,a){function u(f,m){return"[Axios v"+iT+"] Transitional option '"+f+"'"+m+(a?". "+a:"")}return(f,m,p)=>{if(t===!1)throw new Fe(u(m," has been removed"+(n?" in "+n:"")),Fe.ERR_DEPRECATED);return n&&!Lv[m]&&(Lv[m]=!0,console.warn(u(m," has been deprecated since v"+n+" and will be removed in the near future"))),t?t(f,m,p):!0}};function CL(c,t,n){if(typeof c!="object")throw new Fe("options must be an object",Fe.ERR_BAD_OPTION_VALUE);const a=Object.keys(c);let u=a.length;for(;u-- >0;){const f=a[u],m=t[f];if(m){const p=c[f],x=p===void 0||m(p,f,c);if(x!==!0)throw new Fe("option "+f+" must be "+x,Fe.ERR_BAD_OPTION_VALUE);continue}if(n!==!0)throw new Fe("Unknown option "+f,Fe.ERR_BAD_OPTION)}}const Ud={assertOptions:CL,validators:Cf},Ar=Ud.validators;class Jl{constructor(t){this.defaults=t,this.interceptors={request:new Ev,response:new Ev}}request(t,n){typeof t=="string"?(n=n||{},n.url=t):n=t||{},n=ls(this.defaults,n);const{transitional:a,paramsSerializer:u,headers:f}=n;a!==void 0&&Ud.assertOptions(a,{silentJSONParsing:Ar.transitional(Ar.boolean),forcedJSONParsing:Ar.transitional(Ar.boolean),clarifyTimeoutError:Ar.transitional(Ar.boolean)},!1),u!==void 0&&Ud.assertOptions(u,{encode:Ar.function,serialize:Ar.function},!0),n.method=(n.method||this.defaults.method||"get").toLowerCase();let m;m=f&&G.merge(f.common,f[n.method]),m&&G.forEach(["delete","get","head","post","put","patch","common"],v=>{delete f[v]}),n.headers=cr.concat(m,f);const p=[];let x=!0;this.interceptors.request.forEach(function(O){typeof O.runWhen=="function"&&O.runWhen(n)===!1||(x=x&&O.synchronous,p.unshift(O.fulfilled,O.rejected))});const T=[];this.interceptors.response.forEach(function(O){T.push(O.fulfilled,O.rejected)});let A,b=0,I;if(!x){const v=[Iv.bind(this),void 0];for(v.unshift.apply(v,p),v.push.apply(v,T),I=v.length,A=Promise.resolve(n);b<I;)A=A.then(v[b++],v[b++]);return A}I=p.length;let D=n;for(b=0;b<I;){const v=p[b++],O=p[b++];try{D=v(D)}catch(W){O.call(this,W);break}}try{A=Iv.call(this,D)}catch(v){return Promise.reject(v)}for(b=0,I=T.length;b<I;)A=A.then(T[b++],T[b++]);return A}getUri(t){t=ls(this.defaults,t);const n=tT(t.baseURL,t.url);return Z0(n,t.params,t.paramsSerializer)}}G.forEach(["delete","get","head","options"],function(t){Jl.prototype[t]=function(n,a){return this.request(ls(a||{},{method:t,url:n,data:(a||{}).data}))}});G.forEach(["post","put","patch"],function(t){function n(a){return function(f,m,p){return this.request(ls(p||{},{method:t,headers:a?{"Content-Type":"multipart/form-data"}:{},url:f,data:m}))}}Jl.prototype[t]=n(),Jl.prototype[t+"Form"]=n(!0)});const Hl=Jl;class bf{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Promise(function(f){n=f});const a=this;this.promise.then(u=>{if(!a._listeners)return;let f=a._listeners.length;for(;f-- >0;)a._listeners[f](u);a._listeners=null}),this.promise.then=u=>{let f;const m=new Promise(p=>{a.subscribe(p),f=p}).then(u);return m.cancel=function(){a.unsubscribe(f)},m},t(function(f,m,p){a.reason||(a.reason=new Uo(f,m,p),n(a.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const n=this._listeners.indexOf(t);n!==-1&&this._listeners.splice(n,1)}static source(){let t;return{token:new bf(function(u){t=u}),cancel:t}}}const bL=bf;function IL(c){return function(n){return c.apply(null,n)}}function RL(c){return G.isObject(c)&&c.isAxiosError===!0}const zd={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(zd).forEach(([c,t])=>{zd[t]=c});const LL=zd;function rT(c){const t=new Hl(c),n=U0(Hl.prototype.request,t);return G.extend(n,Hl.prototype,t,{allOwnKeys:!0}),G.extend(n,t,null,{allOwnKeys:!0}),n.create=function(u){return rT(ls(c,u))},n}const vt=rT(Ef);vt.Axios=Hl;vt.CanceledError=Uo;vt.CancelToken=bL;vt.isCancel=eT;vt.VERSION=iT;vt.toFormData=cu;vt.AxiosError=Fe;vt.Cancel=vt.CanceledError;vt.all=function(t){return Promise.all(t)};vt.spread=IL;vt.isAxiosError=RL;vt.mergeConfig=ls;vt.AxiosHeaders=cr;vt.formToJSON=c=>J0(G.isHTMLForm(c)?new FormData(c):c);vt.HttpStatusCode=LL;vt.default=vt;const ML=vt;class nT{constructor(){this.AxiosAPI=ML.create({baseURL:"https://api-entertainment.enlight.diagnal.com/v1b3/content"})}async fetch(t){try{return[await this.AxiosAPI.get(t),void 0]}catch(n){return[void 0,n]}}}class sT extends J.Component{constructor(){super(...arguments),this.index=-1,this.dataLength=0,this.railIndex=0,this.axiosRequester=new nT,this.responseData={},this.data=[],this.Wrapper=this.tag("Slider.Wrapper")}static _template(){return{Header:{x:50,y:20,color:ee.colors.white,text:{text:"",fontSize:35,fontFace:"Saira Regular",fontStyle:"600"}},Slider:{w:1920,h:400,y:105,mount:0,rect:!0,clipping:!0,color:br("transparent").get(),Wrapper:{x:80}}}}_init(){const t=[];this.railIndex<Ql.length?this.axiosRequester.fetch(Ql[this.railIndex]).then(n=>{var a,u,f,m,p,x,T;if(n){this.responseData=(a=n[0])==null?void 0:a.data,this.dataLength=this.responseData.totalElements||0,this.data=this.responseData.content||[];for(let A=0;A<this.dataLength;A++){let b=Od.regular,I=(f=(u=this.data[A])==null?void 0:u.images.find(O=>O.width===288))==null?void 0:f.url;(this.dataLength===10||this.dataLength===31)&&(b=Od.wide,I=(p=(m=this.data[A])==null?void 0:m.images.find(O=>O.width===526))==null?void 0:p.url);let D=(x=this.data[A])==null?void 0:x.title;console.log((T=this.data[A])==null?void 0:T.images);let v=b.w+b.margin;t.push({type:vv,x:A*v,item:{label:D,src:I||"https://pmd205470tn-a.akamaihd.net/D2C_-_Content/191/249/oyPcsfGWL5Se6RGW1JCVgpHlASH_288x432_13635141800.jpg",data:this.data[A],index:A,totalElements:this.dataLength,cardSize:b,railIndex:this.railIndex}})}}this.patch({Header:{text:xv[this.railIndex]}}),this.tag("Wrapper").children=t,this.index=0,this._setState("RowItem")}):this.setLongRail()}async setLongRail(){var n,a,u;console.log("je"),this.data=await cf.get("longData"),this.dataLength=this.data.length,console.log(this.data.length);const t=[];for(let f=0;f<this.dataLength;f++){let m=(n=this.data[f])==null?void 0:n.title,p=(u=(a=this.data[f])==null?void 0:a.images.find(x=>x.width===288))==null?void 0:u.url;t.push({type:vv,x:f*(216+30),item:{label:m,src:p||"https://pmd205470tn-a.akamaihd.net/D2C_-_Content/191/249/oyPcsfGWL5Se6RGW1JCVgpHlASH_288x432_13635141800.jpg",data:this.data[f]}})}this.patch({Header:{text:xv[this.railIndex]}}),this.tag("Wrapper").children=t,this.index=0}repositionWrapper(){const t=this.tag("Wrapper"),a=t.children[this.index].cardSize;this.index<this.dataLength-(a.minimumCardsInViewport-1)&&t.setSmooth("x",-(a.w+a.margin)*this.index+80,{duration:.1})}_handleLeft(){this.index>0&&(this.index-=1,this.repositionWrapper())}_handleRight(){this.index<this.dataLength-1&&(this.index+=1,this.repositionWrapper())}_getFocused(){return this.tag("Slider.Wrapper").children[this.index]}}class vd extends J.Component{static _template(){return{NavText:{w:120,color:ee.colors.accentGrey.light,text:{fontSize:35}}}}set navtext(t){this.patch({NavText:{text:t==null?void 0:t.toString()}})}_focus(){this.patch({smooth:{scale:1.1},NavText:{smooth:{color:ee.colors.white}},Rectangle:{color:ee.colors.yellow,x:2,y:t=>t+50,w:100,h:5,rect:!0}})}_unfocus(){this.patch({smooth:{color:ee.colors.primary,scale:1},NavText:{smooth:{color:ee.colors.accentGrey.light}},Rectangle:void 0})}}class PL extends J.Component{static _template(){return{w:50,h:50,src:"https://pmd205470tn-a.akamaihd.net/D2C_-_Content/808/289/5qtySjfuJfOLvVrVXuwNo2BIVPH.jpg",shader:{type:J.shaders.RoundedRectangle,radius:10,stroke:5,strokeColor:ee.colors.white}}}set navtext(t){this.patch({NavText:{text:t==null?void 0:t.toString()}})}_focus(){this.patch({smooth:{scale:1.1},shader:{strokeColor:ee.colors.yellow}})}_unfocus(){this.patch({smooth:{scale:1},shader:{strokeColor:ee.colors.white}})}}class yM extends J.Component{constructor(){super(...arguments),this.index=0}static _template(){return{Navbar:{w:1920,h:1080,rect:!0,zIndex:1,shader:{x:100,y:-100,pivot:.5,type:J.shaders.RadialGradient,outerColor:ee.colors.primaryLight,innerColor:ee.colors.dark,radius:800},NavItems:{x:10,y:10,NavMenu:{shader:null}}}}}_init(){var n;const t={Home:{type:vd,x:20,y:12,navtext:"Home"},Search:{type:vd,x:140,y:12,navtext:"Search"},Gridlayout:{type:vd,x:280,y:12,navtext:"Grids"},Profile:{x:1840,y:15,type:PL}};this.tag("Navbar.NavItems.NavMenu").children=t,(n=this.tag("Navbar"))==null||n.animation({duration:8,repeat:-1,delay:2,actions:[{p:"shader.radius",v:{0:{v:800},.5:{v:400},1:{v:800}}}]}).start()}_handleLeft(){this.index>0&&(this.index-=1)}_handleRight(){this.index<3&&(this.index+=1)}_handleEnter(){this.index===0?Pt.navigate("home"):this.index===1?Pt.navigate("search"):this.index===2?Pt.navigate("grid"):Pt.navigate("settings")}_getFocused(){return this.tag("Navbar.NavItems.NavMenu").children[this.index]}_focus(){}_unfocus(){this.index=0}}class pu extends J.Component{static _template(){return{Back:{w:80,color:ee.colors.accentGrey.light,text:{text:"Back",fontSize:35}}}}_focus(){this.patch({smooth:{scale:1.1},Back:{smooth:{color:ee.colors.white}},Rectangle:{color:ee.colors.yellow,x:2,y:t=>t+50,w:80,h:5,rect:!0}})}_unfocus(){this.patch({smooth:{color:ee.colors.primary,scale:1},Back:{smooth:{color:ee.colors.accentGrey.light}},Rectangle:void 0})}}class ns extends J.Component{static _template(){return{VideoSpec:{w:120,h:80,shader:{type:J.shaders.RoundedRectangle,radius:20,stroke:8,strokeColor:ee.colors.accentGrey.light},color:ee.colors.accentGrey.light,Spec:{mount:.5,color:ee.colors.accentGrey.light,text:{fontSize:22,fontFace:"Saira Regular",fontStyle:"400"}}}}}set specData(t){this.patch({VideoSpec:{Spec:{text:t}}})}}class kL extends J.Component{constructor(){super(...arguments),this._isPlaying=!1}static _template(){return{mount:.5,x:1920/2,y:1080/2,rect:!0,w:150,h:150,color:0,Background:{rect:!0,w:150,h:150,color:4289440683,shader:{type:J.shaders.RoundedRectangle,radius:75}},Text:{mount:.5,x:75,y:75,text:{textColor:4294967295,text:"Pause"}}}}_setup(){this._isPlaying=!0}set isPlaying(t){this._isPlaying=t,this.tag("Text").patch({text:{text:t?"Pause":"Play"}})}get isPlaying(){return this._isPlaying}}class Mv extends J.Component{static _template(){return{Button:{w:500,h:100,color:0,rect:!0,shader:{type:J.shaders.RadialGradient,innerColor:ee.colors.accentGrey.dark},Label:{shader:null,h:t=>t,text:{fontSize:35,textColor:ee.colors.white,textAlign:"left",textIndent:20,textBaseline:"hanging"}}}}}set label(t){this.patch({Button:{Label:{text:t}}})}_focus(){this.patch({smooth:{scale:1.1},Button:{shader:{innerColor:2868042585},Label:{text:{textColor:ee.colors.white}}}})}_unfocus(){this.patch({smooth:{scale:1},Button:{shader:{innerColor:ee.colors.accentGrey.dark}}})}}class Pv extends J.Component{constructor(){super(...arguments),this.firstActive=!0,this.Thumbnail=this.tag("ContentView.Thumbnail"),this.ContentDetails=this.tag("ContentView.ContentDetails")}static _template(){return{ContentView:{Thumbnail:{alpha:0,x:1e3,y:110,scale:1.5,shader:{type:J.shaders.FadeOut,innerColor:ee.colors.black,left:200,bottom:200}},ContentDetails:{ContentData:{shader:null,zIndex:2,Title:{x:40,y:165,shader:null,text:{fontSize:80,fontFace:"Saira Regular",fontStyle:"600"},color:ee.colors.white},Description:{x:40,y:270,w:900,shader:null,text:{wordWrap:!0,maxLines:3,maxLinesSuffix:"...",fontSize:30,fontFace:"Saira Regular",fontStyle:"400"},color:ee.colors.accentGrey.light},Genre:{x:40,y:380,w:900,shader:null,text:{fontSize:24,fontFace:"Saira Regular",fontStyle:"400"},color:ee.colors.accentGrey.light},Info:{visible:!1,Director:{x:40,y:440,w:100,shader:null,text:{text:"Director : ",fontSize:24,fontFace:"Saira Regular",fontStyle:"600"},color:ee.colors.accentGrey.light},Starring:{x:40,y:470,w:100,shader:null,text:{text:"Staring  : ",fontSize:24,fontFace:"Saira Regular",fontStyle:"600"},color:ee.colors.accentGrey.light},DirectorList:{x:150,y:440,w:800,shader:null,text:{fontSize:24},color:ee.colors.accentGrey.light},StarringList:{x:150,y:470,w:800,shader:null,text:{fontSize:24,wordWrap:!0,maxLines:1,maxLinesSuffix:"..."},color:ee.colors.accentGrey.light}},VideoSpec:{visible:!1,VideoSpec1:{x:70,y:140,shader:null,type:ns,specData:"  16+  "},VideoSpec2:{x:135,y:140,shader:null,type:ns,specData:"  4k  "},VideoSpec3:{x:193,y:140,shader:null,type:ns,specData:"  cc  "}}}}}}}set data(t){console.log(t);const{imgSrc:n,title:a,description:u,genre:f,directorsList:m,actorsList:p}=t;this.tag("ContentView.Thumbnail").patch({smooth:{src:n}}),this.tag("ContentView.Thumbnail").transition("src").on("finish",()=>{this.tag("ContentView.Thumbnail").setSmooth("alpha",1,{duration:.5})});const x=this.tag("ContentView.ContentDetails").animation({duration:.5,delay:0,actions:[{p:"alpha",v:{0:0,.8:0,1:1}},{p:"x",v:{0:10,.6:-100,.65:10}},{p:"y",v:{0:0,.6:0,.65:-30,1:0}}]});if(this.patch({ContentView:{shader:{type:J.shaders.RadialGradient,x:300,y:300,innerColor:4278190080,radius:1500},ContentDetails:{x:10,ContentData:{Title:{text:{text:a}},Description:{text:{text:u}},Genre:{text:{text:f}},Info:{visible:!0,DirectorList:{text:{text:m}},StarringList:{text:{text:p}}},VideoSpec:{visible:!0}}}}}),this.firstActive){this.firstActive=!1,this.tag("ContentView.ContentDetails").animation({duration:1,delay:0,repeat:0,actions:[{p:"alpha",v:{0:0,1:1}},{p:"y",v:{0:-30,1:0}}]}).start();return}x.start()}animate(){this.tag("ContentView.ContentDetails").animation({duration:2,delay:0,actions:[{p:"alpha",v:{0:1,.5:0}},{p:"y",v:{0:0,.5:-30,1:0}}]}).start()}_init(){this.tag("ContentView.Thumbnail").on("txError",()=>{console.error("texture failed to load: "+this.tag("ContentView.Thumbnail").src)})}}class xM extends J.Component{static _template(){return{Box:{x:0,y:0,w:216,h:324,rect:!0,color:0,shader:{type:J.shaders.RoundedRectangle,radius:20}}}}}class kv extends J.Component{constructor(){super(...arguments),this.index=0,this.rowLength=Ql.length,this.hideNav=!1,this.eventData={},this.Wrapper=this.tag("Background.Slider.Wrapper")}static _template(){return{Background:{w:1920,h:1080,color:ee.colors.black,rect:!0,Version:{x:50,y:25,w:100,h:100,alpha:.3,text:{text:"V: 0.0.1",fontSize:20}},Box:{x:80,y:665,InnerBox:{zIndex:3,rect:!0,shader:{type:J.shaders.RoundedRectangle,radius:20,stroke:5,strokeColor:ee.colors.yellow},color:br("transparent")}},ContentDetails:{type:Pv},Slider:{zIndex:2,clipping:!0,color:br("transparent").get(),w:1920,h:540,x:1920,y:0,mount:1,rect:!0,Wrapper:{}}}}}$changeItemOnFocus(t,n){var re,Q;let a=(re=t.images.find(q=>q.width===828))==null?void 0:re.url,u=t.title,f=t.description,m=t.genre.join(" . "),p=t.director.map(q=>q.personName).join(", "),x=t.actor.map(q=>q.personName).join(", ");const{railTotalElements:T,cardIndex:A,cardSize:b,railIndex:I}=n,{minimumCardsInViewport:D,w:v,h:O,margin:W}=b;this.tag("Background.ContentDetails").Thumbnail.setSmooth("alpha",0,{duration:.5}),this.tag("Background.ContentDetails").ContentDetails.setSmooth("alpha",0,{duration:.5}),hf.setTimeout(()=>{if(I===this.index&&this.Wrapper.children[this.index].Wrapper.children[n.cardIndex].focused){const q={type:Pv,data:{imgSrc:a,title:u,description:f,genre:m,directorsList:p,actorsList:x}};this.tag("Background.ContentDetails").patch(q)}},500),(Q=this.tag("Box"))==null||Q.patch({InnerBox:{w:v,h:O}});const Z=this.tag("Box");A>=T-(D-1)?Z.setSmooth("x",(v+W)*(D-(T-A))+80,{duration:.1}):Z.setSmooth("x",80,{duration:.1})}_init(){this.backgroundFetchAndSave();const t=[];for(let n=0;n<this.rowLength;n++)t.push({type:sT,x:0,y:n*(500+50),railIndex:n});this.tag("Background.Slider.Wrapper").children=t}async backgroundFetchAndSave(){let t=new nT,n=[];for(let a of Ql)await t.fetch(a).then(u=>{var f;if(u){let p=((f=u[0])==null?void 0:f.data).content||[];n=[...n,...p]}});await cf.set("longData",n)}repositionWrapper(){this.tag("Background.Slider.Wrapper").setSmooth("y",(-540-10)*this.index,{duration:.1})}_active(){const t=this.tag("Background.Slider").animation({duration:1,delay:0,actions:[{p:"alpha",v:{0:0,1:1}},{p:"y",v:{0:1400,1:1100}}]}),n=this.tag("Background.Box").animation({duration:1,delay:0,actions:[{p:"alpha",v:{0:0,1:1}},{p:"y",v:{0:965,1:665}}]});t.start(),n.start()}_handleUp(){this.index>0&&(this.index-=1,this.index>=0&&this.repositionWrapper())}_handleDown(){this.index<this.rowLength-1&&(this.index+=1,this.repositionWrapper())}_getFocused(){return this.index<=0?this.patch({Navbar:{visible:!0}}):this.patch({Navbar:{visible:!1}}),this.index>=0?this.tag("Background.Slider.Wrapper").children[this.index]:this.tag("Navbar")}pageTransitionOut(t){return new Promise((n,a)=>{this.tag("Background.Slider").patch({smooth:{y:[1300,{duration:1,delay:0,timingFunction:"ease"}],alpha:0}}),this.tag("Background.Box").patch({smooth:{y:[865,{duration:1,delay:0,timingFunction:"ease"}],alpha:0}}),this.tag("Background.ContentDetails").animate(),this.tag("Background.Slider").transition("y").on("finish",()=>{n()})})}}class Vi extends J.Component{static _template(){return{Wrapper:{}}}_construct(){this._direction=Vi.DIRECTION.row,this._scrollTransitionSettings=this.stage.transitions.createSettings({}),this._spacing=0,this._autoResize=!1,this._requestingItems=!1,this._requestThreshold=1,this._requestsEnabled=!1,this._gcThreshold=5,this._gcIncrement=0,this._forceLoad=!1,this.clear()}_setup(){this._updateScrollTransition()}_updateScrollTransition(){const t=this._direction===1?"y":"x";this.wrapper.transition(t,this._scrollTransitionSettings),this._scrollTransition=this.wrapper.transition(t)}_indexChanged(t){let{previousIndex:n,index:a,dataLength:u,mainIndex:f,previousMainIndex:m,lines:p}=t;!isNaN(m)&&!isNaN(f)&&!isNaN(p)&&(n=m,a=f,u=p),this._requestsEnabled&&!this._requestingItems&&a+this._requestThreshold>=u&&this.requestItems(!1,t),this._refocus(),this.scrollCollectionWrapper(t),t.previousIndex!==t.index&&this.signal("onIndexChanged",t)}requestItems(t=!1,n=void 0){n===void 0&&(n={previous:0,index:0,max:0}),this._requestingItems=!0,this.signal("onRequestItems",n).then(a=>{a===!1&&(this.enableRequests=!1),this._requestingItems=!1,t&&this.clear();const u=typeof a;(Array.isArray(a)||u==="object"||u==="string"||u==="number")&&this.add(a)})}setIndex(t){const n=aT(t,0,this._items.length-1),a=this._index;return this._index=n,this._indexChanged({previousIndex:a,index:n,dataLength:this._items.length}),a!==n}clear(){if(this._uids=[],this._items=[],this._index=0,this._scrollTransition&&this._scrollTransition.reset(0,1),this.wrapper){const t=this.wrapper.children>0;this.wrapper.patch({x:0,y:0,children:[]}),t&&this._collectGarbage(!0)}}add(t){this.addAt(t)}addAt(t,n=this._items.length){if(n>=0&&n<=this._items.length){Array.isArray(t)||(t=[t]);const a=this._normalizeDataItems(t);this._items.splice(n,0,...a),this.plotItems(),this.setIndex(this._index)}else throw new Error("addAt: The index "+n+" is out of bounds "+this._items.length)}remove(t){if(this.hasItems&&t.assignedID){const n=this.itemWrappers;for(let a=0;a<this._items.length;a++){let u=this._items[a];if(n[a]&&n[a].component.isAlive&&(u=n[a].component),t.assignedID===u.assignedID)return this.removeAt(a)}}else throw new Error("remove: item not found")}removeAt(t,n=1){if(t<0&&t>=this._items.length)throw new Error("removeAt: The index "+t+" is out of bounds "+this._items.length);const a=this._items[t];return this._items.splice(t,n),this.plotItems(),a}reload(t){this.clear(),this.add(t)}plotItems(t,n){}reposition(t=70){this._repositionDebounce&&clearTimeout(this._repositionDebounce),this._repositionDebounce=setTimeout(()=>{this.repositionItems()},t)}repositionItems(){this.signal("onItemsRepositioned")}up(){return this._attemptNavigation(-1,1)}down(){return this._attemptNavigation(1,1)}left(){return this._attemptNavigation(-1,0)}right(){return this._attemptNavigation(1,0)}first(){return this.setIndex(0)}last(){return this.setIndex(this._items.length-1)}next(){return this.setIndex(this._index+1)}previous(){return this.setIndex(this._index-1)}_attemptNavigation(t,n){return this.hasItems?this.navigate(t,n):!1}navigate(t,n=this._direction){return n!==this._direction?!1:this.setIndex(this._index+t)}scrollCollectionWrapper(t){let{previousIndex:n,index:a,dataLength:u,mainIndex:f,previousMainIndex:m,lines:p}=t;!isNaN(m)&&!isNaN(f)&&!isNaN(p)&&(n=m,a=f,u=p);const{directionIsRow:x,main:T,mainDim:A,mainMarginFrom:b,mainMarginTo:I}=this._getPlotProperties(this._direction),D=this.currentItemWrapper;let v=this[A];v===0&&(v=x?1920:1080);const O=Math.min(this.wrapper[T],this._scrollTransition&&this._scrollTransition.targetValue||0),W=this._getItemSizes(D),Z=W[b]||W.margin||0,re=W[I]||W.margin||0;let Q=this._scroll;if(!isNaN(Q))Q>=0&&Q<=1?Q=v*Q-(D[T]+D[A]*Q):Q=Q-D[T];else if(typeof Q=="function")Q=Q.apply(this,[D,t]);else if(typeof Q=="object"){const{jump:q=!1,after:xe=!1,backward:me=0,forward:He=1}=Q;if(q){let _e=a%q;if(_e===0&&(Q=Z-D[T]),_e===q-1){const ce=Z+D[A]+re;Q=_e*ce+Z-D[T]}}else if(xe){if(Q=0,a>=xe-1){const _e=Z+D[A]+re;Q=(xe-1)*_e+Z-D[T]}}else{const _e=v*this._normalizePixelToPercentage(me,v),ce=v*this._normalizePixelToPercentage(He,v);a<u-1&&n<a&&O+D[T]+D[A]>ce?Q=ce-(D[T]+D[A]):a>0&&a<n&&O+D[T]<_e?Q=_e-D[T]:a===u-1?Q=v-(D[T]+D[A]):a===0&&(Q=Z-D[T])}}else isNaN(Q)&&(n<a&&O+D[T]+D[A]>v?Q=v-(D[T]+D[A]):a<n&&O+D[T]<0&&(Q=Z-D[T]));this.active&&!isNaN(Q)&&this._scrollTransition?this._scrollTransition.isRunning()?this._scrollTransition.reset(Q,.05):this._scrollTransition.start(Q):isNaN(Q)||(this.wrapper[T]=Q)}$childInactive({child:t}){if(typeof t=="object"){const n=t.componentIndex;for(let a in this._items[n])t.component[a]!==void 0&&(this._items[n][a]=t.component[a])}this._collectGarbage()}$getChildComponent({index:t}){return this._items[t]}_resizeWrapper(t){let n=t;if(!isNaN(t)){const{main:a,mainDim:u,crossDim:f}=this._getPlotProperties(this._direction),m=this.wrapper.childList.last;n={[u]:m[a]+m[u],[f]:t}}this.wrapper.patch(n),this._autoResize&&this.patch(n)}_generateUniqueID(){let t="";for(;this._uids[t]||t==="";)t=Math.random().toString(36).substr(2,9);return this._uids[t]=!0,t}_getPlotProperties(t){const n=t===0;return{directionIsRow:!!n,mainDirection:n?"rows":"columns",main:n?"x":"y",mainDim:n?"w":"h",mainMarginTo:n?"marginRight":"marginBottom",mainMarginFrom:n?"marginLeft":"marginTop",crossDirection:n?"rows":"columns",cross:n?"y":"x",crossDim:n?"h":"w",crossMarginTo:n?"marginBottom":"marginRight",crossMarginFrom:n?"marginTop":"marginLeft"}}_getItemSizes(t){const n=t.type;return t.component&&t.component.__attached&&(t=t.component),{w:t.w||n&&n.width,h:t.h||n&&n.height,margin:t.margin||n&&n.margin||0,marginLeft:t.marginLeft||n&&n.marginLeft,marginRight:t.marginRight||n&&n.marginRight,marginTop:t.marginTop||n&&n.marginTop,marginBottom:t.marginBottom||n&&n.marginBottom}}_collectGarbage(t){this._gcIncrement++,(t||this.active&&this._gcThreshold!==0&&this._gcIncrement>=this._gcThreshold)&&(this._gcIncrement=0,this.stage.gc())}_normalizeDataItems(t){return t.map((n,a)=>this._normalizeDataItem(n)||a).filter(n=>isNaN(n)?!0:(console.warn(`Item at index: ${n}, is not a valid item. Removing it from dataset`),!1))}_normalizeDataItem(t,n){return(typeof t=="string"||typeof t=="number")&&(t={label:t.toString()}),typeof t=="object"?{assignedID:this._generateUniqueID(),type:this.itemType,collectionWrapper:this,isAlive:!1,...t}:n}_normalizePixelToPercentage(t,n){return t&&t>1?t/n:t||0}_getFocused(){return this.hasItems?this.currentItemWrapper:this}_handleRight(){return this.right()}_handleLeft(){return this.left()}_handleUp(){return this.up()}_handleDown(){return this.down()}_inactive(){this._repositionDebounce&&clearTimeout(this._repositionDebounce),this._collectGarbage(!0)}static get itemType(){}set forceLoad(t){this._forceLoad=t}get forceLoad(){return this._forceLoad}get requestingItems(){return this._requestingItems}set requestThreshold(t){this._requestThreshold=t}get requestThreshold(){return this._requestThreshold}set enableRequests(t){this._requestsEnabled=t}get enableRequests(){return this._requestsEnabled}set gcThreshold(t){this._gcThreshold=t}get gcThreshold(){return this._gcThreshold}get wrapper(){return this.tag("Wrapper")}get hasItems(){return this.wrapper&&this.wrapper.children&&this.wrapper.children.length>0}get currentItemWrapper(){return this.wrapper.children[this._index]}get currentItem(){return this.currentItemWrapper&&this.currentItemWrapper.component||void 0}set direction(t){this._direction=Vi.DIRECTION[t]||Vi.DIRECTION.row}get direction(){return Object.keys(Vi.DIRECTION)[this._direction]}set items(t){this.clear(),this.add(t)}get items(){const t=this.itemWrappers;return this._items.map((n,a)=>t[a]&&t[a].component.isAlive?t[a].component:n)}get length(){return this._items.length}set index(t){this.setIndex(t)}get itemWrappers(){return this.wrapper.children}get index(){return this._index}set scrollTransition(t){this._scrollTransitionSettings.patch(t),this.active&&this._updateScrollTransition()}get scrollTransition(){return this._scrollTransition}set scroll(t){this._scroll=t}get scroll(){return this._scroll}set autoResize(t){this._autoResize=t}get autoResize(){return this._autoResize}set spacing(t){this._spacing=t}get spacing(){return this._spacing}}Vi.DIRECTION={row:0,column:1};class DL extends J.Component{static _template(){return{alpha:0}}_construct(){this._blink=!0}_init(){this._blinkAnimation=this.animation({duration:1,repeat:-1,actions:[{p:"alpha",v:{0:0,.5:1,1:0}}]})}show(){this._blink?this._blinkAnimation.start():this.alpha=1}hide(){this._blink?this._blinkAnimation.stop():this.alpha=0}set blink(t){this._blink=t,this.active&&(t?this.show():this.hide())}get blink(){return this._blink}}class oT extends J.Component{static _template(){return{clipbox:!0}}create(){if(this.children.length>0)return;const t=this.fireAncestors("$getChildComponent",{index:this.componentIndex});t.isAlive=!0;const{w:n,h:a,margin:u,marginTop:f,marginBottom:m,marginRight:p,marginLeft:x}=this;this.children=[{...t,w:n,h:a,margin:u,marginTop:f,marginRight:p,marginLeft:x,marginBottom:m}],this.hasFocus()&&this._refocus()}get component(){return this.children[0]||this.fireAncestors("$getChildComponent",{index:this.componentIndex})}_setup(){this.forceLoad&&this.create()}_active(){this.create()}_inactive(){this.forceLoad||(this.children[0].isAlive=!1,this.fireAncestors("$childInactive",{child:this}),this.childList.clear())}_getFocused(){return this.children&&this.children[0]||this}}class OL extends J.Component{static _template(){return{clipbox:!0}}_update(){let t=this.children&&this.children[0];t&&t.action===this._key.data.action?t.patch({...this._key}):this.children=[{type:this._key.keyType,...this._key}],this.hasFocus()&&this._refocus()}set key(t){this._key=t,this.active&&this._update()}get key(){return this._key}_active(){this._update()}_inactive(){this.childList.clear()}_getFocused(){return this.children&&this.children[0]||this}}const aT=(c,t,n)=>Math.min(Math.max(c,t),n),gu=(c,t)=>{t.forEach(n=>{Object.defineProperty(c,n,{set:function(a){c[`_${n}`]=a},get:function(){return c[`_${n}`]}})})},Dv=(c,t,n)=>{for(let a=0;a<c.length;a++)if(c[a][n]===t)return a;return-1};class FL extends Vi{_construct(){this._crossSpacing=5,this._mainSpacing=5,this._rows=0,this._columns=0,super._construct()}clear(){super.clear(),this._mainIndex=0,this._crossIndex=0,this._previous=void 0}setIndex(t){const n=aT(t,0,this._items.length-1),a=this._index,{mainIndex:u,crossIndex:f}=this._findLocationOfIndex(this._index),{mainIndex:m,crossIndex:p}=this._findLocationOfIndex(n);this._mainIndex=m,this._crossIndex=p,this._previous={mainIndex:m,crossIndex:p,realIndex:a},this._index=n,this._indexChanged({previousIndex:a,index:n,mainIndex:m,previousMainIndex:u,crossIndex:p,previousCrossIndex:f,lines:this._lines.length,dataLength:this._items.length})}_findLocationOfIndex(t){for(let n=0;n<this._lines.length;n++)if(this._lines[n].includes(t))return{mainIndex:n,crossIndex:this._lines[n].indexOf(t)};return{mainIndex:-1,crossIndex:-1}}plotItems(){const t=this._items,n=this.wrapper,{directionIsRow:a,mainDirection:u,main:f,mainDim:m,mainMarginTo:p,mainMarginFrom:x,cross:T,crossDim:A,crossMarginTo:b,crossMarginFrom:I}=this._getPlotProperties(this._direction),D=this[A];let v=0,O=0,W=0;const Z=[],re=a?1920:1080,Q=a?1080:1920,q=this.core.renderContext;this._lines=[[]];let xe=[];const me=t.map((_e,ce)=>{const C=this._getItemSizes(_e),K=C[I]||C.margin||0;if(ce===0&&(v+=C[x]||C.margin||0),xe.length>0&&(this[u]>0&&this[u]===xe.length||this[u]===0&&O+K+C[A]>D)){const St=this._getBiggestInLine(xe);v=St[f]+St[m]+(St[p]||St.margin||this._mainSpacing),O=K,this._lines.push([]),xe=[],W++}else O+=K;const de=`IW-${_e.assignedID}`;let lt=v,Ae=O;const oe=n.tag(de);oe&&(oe.active&&(O!==oe[T]||v!==oe[f])||!oe.active&&(q[`p${f}`]+n[f]+v<=re||q[`p${T}`]+n[T]+O<=Q))&&(lt=oe[f],Ae=oe[T],Z.push(ce));const Dt={ref:de,type:oT,componentIndex:ce,forceLoad:this._forceLoad,...C,[`assigned${f.toUpperCase()}`]:v,[`assigned${T.toUpperCase()}`]:O,[f]:lt,[T]:Ae};return O+=C[A]+(C[b]||C.margin||this._crossSpacing),this._lines[W].push(ce),xe.push(Dt),Dt});n.children=me,Z.forEach(_e=>{const ce=n.children[_e];ce.patch({smooth:{x:ce.assignedX,y:ce.assignedY}})});const He=this._getBiggestInLine(xe);this._resizeWrapper({[m]:He[f]+He[m],[A]:D})}repositionItems(){const t=this.wrapper;if(!t&&t.children.length)return!0;const{main:n,mainDim:a,mainMarginTo:u,mainMarginFrom:f,cross:m,crossDim:p,crossMarginTo:x,crossMarginFrom:T}=this._getPlotProperties(this._direction),A=this[p];let b=0,I=0,D=0,v=[];this.lines=[[]],t.children.forEach((W,Z)=>{const re=this._getItemSizes(W),Q=re[T]||re.margin||0;if(Z===0&&(b+=re[f]||re.margin||0),v.length>0&&(this[mainDirection]>0&&this[mainDirection]===v.length||this[mainDirection]===0&&I+Q+re[p]>A)){const q=this._getBiggestInLine(v);b=q[n]+q[a]+(q[u]||q.margin||this._mainSpacing),I=Q,this._lines.push([]),v=[],D++}else I+=Q;W.patch({[`assigned${n.toUpperCase()}`]:b,[`assigned${m.toUpperCase()}`]:I,[n]:b,[m]:I}),I+=re[p]+(re[x]||re.margin||this._crossSpacing),this._lines[D].push(Z),v.push(newItem)});const O=this._getBiggestInLine(v);this._resizeWrapper({[a]:O[n]+O[a],[p]:A}),super.repositionItems()}_getBiggestInLine(t){const{mainDim:n}=this._getPlotProperties(this._direction);return t.reduce((a,u)=>u[n]>a[n]?u:a)}navigate(t,n){const{directionIsRow:a,cross:u,crossDim:f}=this._getPlotProperties(this._direction),m=a&&n===Vi.DIRECTION.column||!a&&n===Vi.DIRECTION.row;let p=this._mainIndex+!m*t,x=this._crossIndex+!!m*t,T=this._index;if(m&&x>-1&&x<=this._lines[p].length)this._lines[p][x]!==void 0&&(T=this._lines[p][x],this._previous=void 0);else if(!m&&p<this._lines.length&&p>-1){const A=this._lines[p];if(this._previous&&this._previous.mainIndex===p)T=this._previous.realIndex,x=this._previous.crossIndex;else if(A){const b=this.currentItemWrapper,I=A.map(O=>{const W=this.wrapper.children[O];return W[u]<=b[u]&&b[u]<=W[u]+W[f]?W[u]+W[f]-b[u]:W[u]>=b[u]&&W[u]<=b[u]+b[f]?b[u]+b[f]-W[u]:-1});let D=-1,v=-1;for(let O=0;O<I.length&&!(I[O]===-1&&D>-1);O++)I[O]>D&&(D=I[O],v=O);v>-1&&(x=v,T=A[v])}this._previous={mainIndex:this._mainIndex,crossIndex:this._crossIndex,realIndex:this._index}}return this._index!==T?(this.setIndex(T),!0):!1}set rows(t){this._rows=t,this.direction="row"}get rows(){return this._rows}set columns(t){this._columns=t,this.direction="column"}get columns(){return this._columns}set crossSpacing(t){this._crossSpacing=t}get crossSpacing(){return this._crossSpacing}set mainSpacing(t){this._mainSpacing=t}get mainSpacing(){return this._mainSpacing}set spacing(t){this._spacing=t,this._mainSpacing=t,this._crossSpacing=t}}class NL extends J.Component{static _template(){return{PreLabel:{renderOffscreen:!0},PostLabel:{renderOffscreen:!0},Cursor:{type:DL,rect:!0,w:4,h:54,x:0,y:0}}}_construct(){this._input="",this._previousInput="",this._description="",this._cursorX=0,this._cursorIndex=0,this._passwordMask="*",this._passwordMode=!1,this._autoHideCursor=!0,this._labelPositionStatic=!0,this._maxLabelWidth=0}_init(){this.tag("PreLabel").on("txLoaded",()=>{this._labelTxLoaded()}),this.tag("PostLabel").on("txLoaded",()=>{this._labelTxLoaded})}onInputChanged({input:t=""}){let n=Math.max(t.length-this._input.length+this._cursorIndex,0);this._input=t,this._update(n)}toggleCursor(t=!this._cursorVisible){this._cursorVisible=t,this.cursor[t?"show":"hide"]()}_labelTxLoaded(){const t=this.tag("PreLabel"),n=this.tag("Cursor"),a=this.tag("PostLabel");this.h=t.renderHeight||a.renderHeight,n.x=t.renderWidth+this._cursorX,a.x=n.x+n.w*(1-n.mountX),this.setSmooth("x",this._labelOffset),this.autoHideCursor||this.toggleCursor(!0)}_update(t=0){const n=this._input.length>0;let a=this._description+"",u="";n?(a=this._input.substring(0,t),u=this._input.substring(t,this._input.length),this._passwordMode&&(a=this._passwordMask.repeat(a.length),u=this._passwordMask.repeat(u.length)),this.toggleCursor(!0)):this._autoHideCursor&&this.toggleCursor(!1),this.patch({PreLabel:{text:{text:a}},PostLabel:{text:{text:u}}}),this.h===0&&(this.tag("PreLabel").loadTexture(),this.h=this.tag("PreLabel").renderHeight),this._cursorIndex=t}_handleRight(){this._update(Math.min(this._input.length,this._cursorIndex+1))}_handleLeft(){this._update(Math.max(0,this._cursorIndex-1))}_firstActive(){this._labelTxLoaded(),this._update()}get input(){return this._input}get hasInput(){return this._input.length>0}get cursorIndex(){return this._cursorIndex}set inputText(t){this._inputText=t,this.tag("PreLabel").patch({text:t}),this.tag("PostLabel").patch({text:t})}get inputText(){return this._inputText}set description(t){this._description=t}get description(){return this._description}set cursor(t){t.x&&(this._cursorX=t.x,delete t.x),this.tag("Cursor").patch(t)}get cursor(){return this.tag("Cursor")}get cursorVisible(){return this._cursorVisible}set autoHideCursor(t){this._autoHideCursor=t}get autoHideCursor(){return this._autoHideCursor}set passwordMode(t){this._passwordMode=t}get passwordMode(){return this._passwordMode}set passwordMask(t){this._passwordMask=t}get passwordmask(){return this._passwordMask}set maxLabelWidth(t){this._maxLabelWidth=t}get maxLabelWidth(){return this._maxLabelWidth}set labelPositionStatic(t){this._labelPositionStatic=t}get labelPositionStatic(){return this._labelPositionStatic}get _labelOffset(){if(this._labelPositionStatic)return 0;let t=this.maxLabelWidth-this.tag("Cursor").x;return t<0?t:0}}let If=class extends J.Component{static _template(){return{Background:{w:t=>t,h:t=>t,rect:!0},Label:{mount:.5,x:t=>t/2,y:t=>t/2}}}_construct(){this._backgroundColors={},this._labelColors={}}set data(t){this._data=t,this._update()}get data(){return this._data}set labelText(t){this._labelText=t,this.tag("Label").patch({text:t})}get labelText(){return this._labelText}set label(t){this.tag("Label").patch(t)}get label(){return this.tag("Label")}set labelColors(t){this._labelColors=t,this._update()}get labelColors(){return this._labelColors}set backgroundColors(t){this._backgroundColors=t,this._update()}get backgroundColors(){return this._backgroundColors}set background(t){this.tag("Background").patch(t)}get background(){return this.tag("Background")}_update(){if(!this.active)return;const{label:t=""}=this._data,n=this.hasFocus();let{focused:a,unfocused:u=4278190080}=this._backgroundColors,{focused:f,unfocused:m=4294967295}=this._labelColors;this.patch({Background:{color:n&&a?a:u},Label:{text:{text:t},color:n&&f?f:m}})}_firstActive(){this._update()}_focus(){let{focused:t,unfocused:n=4278190080}=this._backgroundColors,{focused:a,unfocused:u=4294967295}=this._labelColors;this.patch({Background:{smooth:{color:t||n}},Label:{smooth:{color:a||u}}})}_unfocus(){let{unfocused:t=4278190080}=this._backgroundColors,{unfocused:n=4294967295}=this._labelColors;this.patch({Background:{smooth:{color:t}},Label:{smooth:{color:n}}})}static get width(){return 80}static get height(){return 80}};class UL extends J.Component{static _template(){return{Keys:{w:t=>t}}}_construct(){this._input="",this._inputField=void 0,this._maxCharacters=56,this.navigationWrapAround=!1,this.resetFocus()}resetFocus(){this._columnIndex=0,this._rowIndex=0,this._previousKey=null}_setup(){this._keys=this.tag("Keys"),this._update()}_update(){const{layouts:t,buttonTypes:n={},styling:a={}}=this._config;(!this._layout||this._layout&&t[this._layout]===void 0)&&(console.error(`Configured layout "${this._layout}" does not exist. Picking first available: "${Object.keys(t)[0]}"`),this._layout=Object.keys(t)[0]);const{horizontalSpacing:u=0,verticalSpacing:f=0,align:m="left"}=a;let p=0;const x=/^[A-Z][A-Za-z0-9]{1}/,T=/\:/;n.default===void 0&&(n.default=If),this._keys.children=t[this._layout].map((A,b)=>{const{x:I=0,margin:D=0,marginRight:v,marginLeft:O,marginTop:W,marginBottom:Z,spacing:re=u||0,align:Q=m}=a[`Row${b+1}`]||{};let q=0,xe=0;const me=A.map((C,K)=>{const de=C;let lt=n.default,Ae="Input",oe=C;x.test(C)&&(T.test(C)&&(C=C.split(":"),oe=C[1].toString(),C=C[0]),n[C]&&(lt=n[C],Ae=C.action||C));const Dt=lt.margin||lt.type.margin,{w:St=lt.type.width||0,h:vn=lt.type.height||0,marginLeft:zo=lt.type.marginLeft||Dt||0,marginRight:cs=lt.type.marginRight||Dt||re}=lt;xe=vn>xe?vn:xe;const Mr=q+zo;return q+=zo+St+cs,{ref:`Key-{${K+1}}`,type:OL,keyboard:this,x:Mr,w:St,h:vn,key:{data:{origin:de,key:C,label:oe,action:Ae},w:St,h:vn,...lt}}});let He=I+(O||D),_e=0;this.w&&Q==="center"&&(He=this.w/2,_e=.5),this.w&&Q==="right"&&(He=this.w-(v||D),_e=1);const ce=p+(W||D);return p=ce+xe+(Z||D||f),{ref:`Row-${b+1}`,x:He,mountX:_e,w:q,y:ce,children:me}}),this._refocus()}_getFocused(){return this.currentKeyWrapper||this}_handleRight(){return this.navigate("row",1)}_handleLeft(){return this.navigate("row",-1)}_handleUp(){return this.navigate("column",-1)}_handleDown(){return this.navigate("column",1)}_handleKey({key:t,code:n="CustomKey"}){if(n==="Backspace"&&this._input.length===0)return!1;t===" "&&(t="Space");const a=this._findKey(t);return a&&this._handleEnter(),a}_findKey(t){const n=this._config.layouts[this._layout];let a=0,u=0;for(;a<n.length;a++)for(u=0;u<n[a].length;u++){let f=n[a][u];if(t.length>1&&f.indexOf(t)>-1||f.toUpperCase()===t.toUpperCase())return this._rowIndex=a,this._columnIndex=u,!0}return!1}_handleEnter(){const{origin:t,action:n}=this.currentKey.data,a={index:this._input.length,key:t};if(this._inputField&&this._inputField.cursorIndex&&(a.index=this._inputField.cursorIndex),n!=="Input"){const u=a.key.split(":"),f=`on${u[0]}`,m=this[f];a.key=u[1],m&&m.apply&&m.call&&m.call(this,a),this.signal(f,{input:this._input,keyboard:this,...a})}else this.addAt(a.key,a.index)}_changeInput(t){if(t.length>this._maxCharacters)return;const n={previousInput:this._input,input:this._input=t};this._inputField&&this._inputField.onInputChanged&&this._inputField.onInputChanged(n),this.signal("onInputChanged",n)}focus(t){this._findKey(t)}add(t){this._changeInput(this._input+t)}addAt(t,n){n>this._input.length-1?this.add(t):n>-1&&this._changeInput(this._input.substring(0,n)+t+this._input.substring(n,this._input.length))}remove(){this._changeInput(this._input.substring(0,this._input.length-1))}removeAt(t){t>this._input.length-1?this.remove():t>-1&&this._changeInput(this._input.substring(0,t-1)+this._input.substring(t,this._input.length))}clear(){this._changeInput("")}layout(t){t!==this._layout&&(this._layout=t,this.attached&&(this.resetFocus(),this._update()))}inputField(t){t&&t.isComponent?(this._rowIndex=0,this._columnIndex=0,this._input=t.input!==void 0?t.input:"",this._inputField=t):(this._rowIndex=0,this._columnIndex=0,this._input="",this._inputField=void 0)}navigate(t,n){const a=(t==="row"?this._columnIndex:this._rowIndex)+n,u=this.rows[this._rowIndex];if(t==="row"&&a>-1&&a<u.children.length)return this._previous=null,this._columnIndex=a;if(t==="row"&&this.navigationWrapAround){this._previous=null;let f=u.children.length;return this._columnIndex=(a%f+f)%f}if(t==="column"&&a>-1&&a<this.rows.length){const f=this._rowIndex,m=this._columnIndex;if(this._previous&&this._previous.row===a){const p=this._previous.column;this._previous.column=this._columnIndex,this._columnIndex=p,this._rowIndex=this._previous.row}else{const p=this.rows[a],x=this.currentKeyWrapper,T=this.rows[this._rowIndex],A=T.x-T.w*T.mountX+x.x,b=p.children.map(v=>{const O=p.x-p.w*p.mountX+v.x;return O<=A&&A<O+v.w?O+v.w-A:O>=A&&O<=A+x.w?A+x.w-O:-1});let I=-1,D=-1;for(let v=0;v<b.length&&!(b[v]===-1&&I>-1);v++)b[v]>I&&(I=b[v],D=v);if(D>-1)this._rowIndex=a,this._columnIndex=D;else if(this.navigationWrapAround)return this._columnIndex=Math.min(this.rows[0].children.length-1,this._columnIndex),this._rowIndex=0}if(this._rowIndex!==f)return this._previous={column:m,row:f},this._rowIndex=a}else if(t==="column"&&this.navigationWrapAround){this._previous={column:this._columnIndex,row:this._rowIndex};let f=this.rows.length;this._rowIndex=(a%f+f)%f,this._columnIndex=Math.min(this.rows[this._rowIndex].children.length-1,this._columnIndex)}return!1}onSpace({index:t}){this.addAt(" ",t)}onBackspace({index:t}){this.removeAt(t)}onClear(){this.clear()}onLayout({key:t}){this.layout(t)}set config(t){this._config=t,this.active&&this._update()}get config(){return this._config}set currentInputField(t){this.inputField(t)}get currentInputField(){return this._inputField}set currentLayout(t){this.layout(t)}get currentLayout(){return this._layout}set maxCharacters(t){this._maxCharacters=t}get maxCharacters(){return this._maxCharacters}get rows(){return this._keys&&this._keys.children}get currentKeyWrapper(){return this.rows&&this.rows[this._rowIndex].children[this._columnIndex]}get currentKey(){return this.currentKeyWrapper&&this.currentKeyWrapper.key}}class zL extends Vi{plotItems(){const t=this._items,n=this.wrapper,{directionIsRow:a,main:u,mainDim:f,mainMarginTo:m,mainMarginFrom:p,cross:x,crossDim:T}=this._getPlotProperties(this._direction);let A=0,b=0,I=0;const D=[],v=a?1920:1080,O=a?1080:1920,W=this.core.renderContext,Z=t.map((re,Q)=>{const q=this._getItemSizes(re);I+=q[p]||q.margin||0,b<q[T]&&(b=q[T]);const xe=`IW-${re.assignedID}`;let me=I;A=re[x]||A;let He=me,_e=A;const ce=n.tag(xe);return ce&&(ce.active&&(A!==ce[x]||me!==ce[u])||!ce.active&&(W[`p${u}`]+n[u]+me<=v||W[`p${x}`]+n[x]+A<=O))&&(He=ce[u],_e=ce[x],D.push(Q)),I+=q[f]+(q[m]||q.margin||this._spacing),{ref:xe,type:oT,componentIndex:Q,forceLoad:this._forceLoad,...q,[`assigned${u.toUpperCase()}`]:me,[`assigned${x.toUpperCase()}`]:A,[u]:He,[x]:_e}});n.children=Z,D.forEach(re=>{const Q=n.children[re];Q.patch({smooth:{x:Q.assignedX,y:Q.assignedY}})}),this._resizeWrapper(b)}repositionItems(){const t=this.wrapper;if(!t&&t.children.length)return!0;const{main:n,mainDim:a,mainMarginTo:u,mainMarginFrom:f,cross:m,crossDim:p}=this._getPlotProperties(this._direction);let x=0,T=0,A=0;t.children.forEach(b=>{const I=this._getItemSizes(b);A+=I[f]||I.margin||0,x=b[m]||x,T<I[p]&&(T=I[p]);const D=A;A+=I[a]+(I[u]||I.margin||this.spacing),b.patch({[`assigned${n.toUpperCase()}`]:D,[`assigned${m.toUpperCase()}`]:0,[n]:D,[m]:x,...I})}),this._resizeWrapper(T),super.repositionItems()}}class Rf extends J.Component{static _template(){return{LabelClipper:{w:t=>t,rtt:!0,shader:{type:J.shaders.FadeOut},LabelWrapper:{Label:{renderOffscreen:!0},LabelCopy:{renderOffscreen:!0}}}}}_construct(){this._autoStart=!0,this._scrollAnimation=!1,this._fade=30,this._spacing=30,this._label={},this._align="left",this._animationSettings={delay:.7,repeat:-1,stopMethod:"immediate"}}_init(){const t=this.tag("Label");t.on("txLoaded",()=>{this._update(t),this._updateAnimation(t),this._autoStart&&this.start()})}_update(t=this.tag("Label")){const n=t.renderWidth,a=n<=this.renderWidth;let u=0;a&&this._align!=="left"&&(u=(this.renderWidth-n)*Rf.ALIGN[this._align]),this.tag("LabelClipper").patch({h:t.renderHeight,shader:{right:a?0:this._fade},LabelWrapper:{x:0,Label:{x:u},LabelCopy:{x:n+this._spacing}}})}_updateAnimation(t=this.tag("Label")){this._scrollAnimation&&this._scrollAnimation.stopNow(),t.renderWidth>this.renderWidth&&(this._animationSettings.duration||(this._animationSettings.duration=t.renderWidth/50),this._scrollAnimation=this.animation({...this._animationSettings,actions:[{t:"LabelWrapper",p:"x",v:{sm:0,0:0,1:-(t.renderWidth+this._spacing)}},{t:"LabelClipper",p:"shader.left",v:{0:0,.2:this._fade,.8:this._fade,1:0}}]}))}start(){this._scrollAnimation&&(this._scrollAnimation.stopNow(),this.tag("LabelCopy").patch({text:this._label}),this._scrollAnimation.start())}stop(){this._scrollAnimation&&(this._scrollAnimation.stopNow(),this.tag("LabelCopy").text="")}set label(t){typeof t=="string"&&(t={text:t}),this._label={...this._label,...t},this.tag("Label").patch({text:t})}get label(){return this.tag("Label")}set align(t){this._align=t}get align(){return this._align}set autoStart(t){this._autoStart=t}get autoStart(){return this._autoStart}set repeat(t){this.animationSettings={repeat:t}}get repeat(){return this._animationSettings.repeat}set delay(t){this.animationSettings={delay:t}}get delay(){return this._animationSettings.delay}set duration(t){this.animationSettings={duration:t}}get duration(){return this._animationSettings.duration}set animationSettings(t){this._animationSettings={...this._animationSettings,...t},this._scrollAnimation&&this._updateAnimation()}get animationSettings(){return this._animationSettings}}Rf.ALIGN={left:0,center:.5,right:1};const BL=(c,t,n,a)=>{let u=t+c;return u<n&&(u=a),u>a&&(u=n),u};class jL extends J.Component{static _template(){return{h:80,w:574,Focus:{alpha:0,w:t=>t,h:t=>t,rect:!0},Label:{x:30,y:t=>t*.5,mountY:.5,text:{text:"",fontSize:22}},ValueWrapper:{x:t=>t-30,w:200,h:t=>t,mountX:1,Value:{x:t=>t*.5,y:t=>t*.5,mountX:.5,mountY:.5,text:{text:"",fontSize:22}}}}}_construct(){this._focusColor=4278227525,this._labelColor=4288519581,this._labelColorFocused=4294967295,this._padding=30,this._max=100,this._min=0,this._value=50,this._options=void 0,this._label="label",this._focusAnimation=null,gu(this,["focusColor","labelColor","labelColorFocused","padding","max","min","focusAnimation"])}_update(){this.patch({Focus:{color:this._focusColor},Label:{x:this._padding,color:this._labelColor,text:{text:this._label}},ValueWrapper:{x:t=>t-this._padding,Value:{color:this._labelColor,text:{text:this.optionValue||this.value}}}}),this.hasFocus()&&this._focus()}_createFocusAnimation(){this._focusAnimation=this.animation({duration:.2,stopMethod:"reverse",actions:[{t:"Focus",p:"alpha",v:{0:0,1:1}},{t:"Label",p:"color",v:{0:this._labelColor,1:this._labelColorFocused}},{t:"ValueWrapper.Value",p:"color",v:{0:this._labelColor,1:this._labelColorFocused}}]})}_firstActive(){this._focusAnimation||this._createFocusAnimation(),this._update()}_navigate(t){this.value=BL(t,this._value,this._min,this._max);const n={value:this._value};this._options&&(n.options=this._options),this.fireAncestors("$onValueChanged",n),this.signal("onValueChanged",n)}_handleLeft(){this._navigate(-1)}_handleRight(){this._navigate(1)}_focus(){this._focusAnimation&&this._focusAnimation.start()}_unfocus(){this._focusAnimation&&this._focusAnimation.stop()}set label(t){this._label=t,this.active&&(this.tag("Label").text.text=t)}get label(){return this._label}set value(t){this._value=t,this.active&&(this.tag("Value").text.text=this.optionValue||this._value)}get value(){return this._value}get optionValue(){return this._options&&this._options[this._value]&&this._options[this._value].label||void 0}set options(t){const n=t.map(a=>typeof a=="string"?{label:a}:a);this._value=0,this._options=n,this._max=n.length-1,this._update()}get options(){return this._options}}class HL extends jL{static _template(){return{...super._template(),ValueWrapper:{x:t=>t-30,w:200,h:t=>t,mountX:1,ArrowLeft:{y:t=>t*.5,mountY:.5},Value:{x:t=>t*.5,y:t=>t*.5,mountX:.5,mountY:.5,text:{text:"",fontSize:22}},ArrowRight:{y:t=>t*.5,x:t=>t,mountY:.5,mountX:1}}}}_update(){this.patch({Focus:{color:this._focusColor},Label:{x:this._padding,color:this._labelColor,text:{text:this._label}},ValueWrapper:{x:t=>t-this._padding,ArrowLeft:{color:this._labelColor},Value:{color:this._labelColor,text:{text:this.optionValue||this.value}},ArrowRight:{color:this._labelColor}}}),this.hasFocus()&&this._focus()}_createFocusAnimation(){this._focusAnimation=this.animation({duration:.2,stopMethod:"reverse",actions:[{t:"Focus",p:"alpha",v:{0:0,1:1}},{t:"ValueWrapper.ArrowLeft",p:"color",v:{0:this._labelColor,1:this._labelColorFocused}},{t:"ValueWrapper.Value",p:"color",v:{0:this._labelColor,1:this._labelColorFocused}},{t:"ValueWrapper.ArrowRight",p:"color",v:{0:this._labelColor,1:this._labelColorFocused}}]})}_firstActive(){this._focusAnimation||this._createFocusAnimation();const t=this.tag("ArrowLeft"),n=this.tag("ArrowRight");t.src!==void 0&&t.text!==null||(t.text={text:"",fontSize:18}),n.src!==void 0&&n.text!==null||(n.text={text:"",fontSize:18}),this._update()}}class TM extends J.Component{static _template(){return{w:574,h:240,List:{type:zL,w:t=>t,h:t=>t,forceLoad:!0,spacing:0,direction:"column"}}}_construct(){this._autoColorShift=!0,this._focusColor=4278227525,this._labelColor=4288519581,this._labelColorFocused=4294967295,this._options=[{type:"neutral",label:"normal"},{type:"protanopia",label:"Protanopia"},{type:"deuteranopia",label:"Deuteranopia"},{type:"tritanopia",label:"Tritanopia"},{type:"monochromacy",label:"Achromatopsia"}],gu(this,["focusColor","labelColor","labelColorFocused","options","autoColorShift"])}_getFocused(){return this.tag("List")}_shiftColors(){this._autoColorShift&&this.application&&this.application.colorshift&&this.application.colorshift(this._settings.correction,this._settings)}$onValueChanged(){const t=this.tag("List").items,n=t[0];this._settings={correction:n.options[n.value].type,brightness:t[1].value,contrast:t[2].value,gamma:t[3].value},this._currentCorrection&&this._settings.correction!==this._currentCorrection&&t.slice(1).forEach(u=>{u.value=50}),this._currentCorrection=this._settings.correction,this._shiftColors(),this.signal("onColorShift",this._settings)}_update(){const t=this.tag("List"),n=["Brightness","Contrast","Gamma"],a=this._options,u=this._settings,f={focusColor:this._focusColor,labelColor:this._labelColor,labelColorFocused:this._labelColorFocused};this._shiftColors();const m=n.map(p=>{const x=p.toLocaleLowerCase();return{type:this[`${x}Component`],label:p,value:u[x],w:this.finalW,h:80,...f}});m.unshift({type:this.correctionComponent,options:a,value:Dv(a,u.correction,"type"),label:"Color adjustment",w:this.finalW,h:80,...f}),t.clear(),t.add(m)}_firstActive(){this._settings||(this._settings={correction:"neutral",brightness:50,contrast:50,gamma:50}),this._update()}set settings(t){if(this._settings=t,this.active){const n=this.tag("List").items;n[0]=Dv(this._options,t.correction,"type"),n[1]=t.brightness||50,n[2]=t.contrast||50,n[3]=t.gamma||50}}get settings(){return this._settings}get correctionTag(){return this.tag("List").items[0]}get brightnessTag(){return this.tag("List").items[1]}get contrastTag(){return this.tag("List").items[2]}get gammaTag(){return this.tag("List").items[3]}get adjustmentTags(){return this.tag("List").items}set stepperComponent(t){this._stepperComponent=t}get stepperComponent(){return this._stepperComponent||HL}set correctionComponent(t){this._correctionComponent=t}get correctionComponent(){return this._correctionComponent||this.stepperComponent}set brightnessComponent(t){this._brightnessComponent=t}get brightnessComponent(){return this._brightnessComponent||this.stepperComponent}set contrastComponent(t){this._contrastComponent=t}get contrastComponent(){return this._contrastComponent||this.stepperComponent}set gammaComponent(t){this._gammaComponent=t}get gammaComponent(){return this._gammaComponent||this.stepperComponent}}class SM extends J.Component{static _template(){return{Focus:{alpha:0,x:t=>t*.5,y:t=>t*.5,mount:.5,w:120,h:50,rect:!0,shader:{type:J.shaders.RoundedRectangle,radius:25}},Label:{x:t=>t*.5,y:t=>t*.5,mount:.5,renderOffscreen:!0,text:{text:"",fontSize:22}}}}_construct(){this._focusColor=4278227525,this._labelColor=4288519581,this._labelColorFocused=4294967295,this._padding=40,gu(this,["focusColor","labelColor","labelColorFocused","padding"])}set label(t){this.tag("Label").text.text=t,this._label=t}get label(){return this._label}_init(){const t=this.tag("Label");t.on("txLoaded",()=>{this.patch({w:t.renderWidth,Focus:{w:t.renderWidth+this._padding*2}}),this.collectionWrapper&&this.collectionWrapper.reposition()})}_focus(){this.patch({Focus:{smooth:{alpha:1}},Label:{smooth:{color:this._labelColorFocused}}})}_unfocus(t){t.isCarouselItem===!0&&this.patch({Focus:{smooth:{alpha:0}},Label:{smooth:{color:this._labelColor}}})}_firstActive(){this.patch({Focus:{color:this._focusColor},Label:{color:this._labelColor}}),this.cparent.componentIndex===this.collectionWrapper.currentItemWrapper.componentIndex&&this._focus()}get isCarouselItem(){return!0}static get width(){return 120}static get height(){return 50}}class wM extends J.Component{static _template(){return{w:300,h:10,Background:{w:t=>t,h:t=>t,rect:!0,rtt:!0,shader:{type:J.shaders.RoundedRectangle,radius:5},Progress:{h:t=>t,w:10,rect:!0,shader:{type:J.shaders.RoundedRectangle,radius:0}}}}}_construct(){this._progressColor=4278227525,this._progressColorFocused=void 0,this._backgroundColor=4288519581,this._backgroundColorFocused=void 0,this._backgroundRadius=5,this._progressRadius=0,this.value=.5,gu(this,["progressColor","backgroundColor","progressColorFocused","backgroundColorFocused"])}progress(t){t>1&&(t=t/100),this._value=t,this.tag("Progress").w=this.w*t}_createFocusAnimation(){this._focusAnimation=this.animation({duration:.2,stopMethod:"reverse",actions:[{t:"Background",p:"color",v:{0:this._backgroundColor,1:this._backgroundColorFocused||this._backgroundColor}},{t:"Background.Progress",p:"color",v:{0:this._progressColor,1:this._progressColorFocused||this._progressColor}}]})}_firstActive(){this._focusAnimation||this._createFocusAnimation(),this.patch({Background:{color:this._backgroundColor,shader:{radius:this._backgroundRadius},Progress:{color:this._progressColor,shader:{radius:this._progressRadius}}}}),this.progress(this._value),this.hasFocus()&&this._focus()}_focus(){this._focusAnimation&&this._focusAnimation.start()}_unfocus(){this._focusAnimation&&this._focusAnimation.stop()}set value(t){this._value=t,this.active&&this.progress(t)}get value(){return this._value}set backgroundRadius(t){this._backgroundRadius=t,this.active&&(this.tag("Background").shader.radius=t)}get progressRadius(){return this._progressRadius}set progressRadius(t){this._progressRadius=t,this.active&&(this.tag("Progress").shader.radius=t)}get progressRadius(){return this._progressRadius}get backgroundTag(){return this.tag("Background")}get progressTag(){return this.tag("Progress")}}class VL extends J.Component{constructor(){super(...arguments),this.index=2,this.intervalSub=0}static _template(){return{w:1920,h:1080,color:ee.colors.primaryLight,rect:!0,shader:{x:100,y:-100,pivot:.5,type:J.shaders.RadialGradient,outerColor:ee.colors.primaryLight,innerColor:ee.colors.dark,radius:800},SearchComponent:{x:40,y:40,shader:null,SearchBox:{x:0,y:60,w:950,h:60,rect:!0,color:ee.colors.accentGrey.light,shader:{type:J.shaders.RoundedRectangle,radius:30},InputWrapper:{x:20,color:ee.colors.dark,InputField:{y:20,type:NL}}},BackButton:{type:pu},Keyboard:{x:0,y:140,type:UL,config:GL,currentLayout:"abc",maxCharacters:24,signals:{onSearch:!0}}}}}_setup(){const t=this.tag("SearchComponent.SearchBox.InputWrapper.InputField");this.tag("Keyboard").inputField(t)}onSearch(t){console.log("search",t.input)}_active(){super._active(),this.tag("SearchComponent.SearchBox.InputWrapper.InputField").color=ee.colors.accentGrey.dark;const t={type:sT,x:-30,y:380,railIndex:16};this.tag("SearchComponent").patch({LongRail:t})}_getFocused(){return this.tag("Keyboard")}_handleUp(){this.index>1&&(this.index-=1)}_handleDown(){this.index<3&&(this.index+=1)}_handleEnter(){this.index===1&&Pt.navigate("home")}_getFocused(){return this.tag("SearchComponent").children[this.index]}}class WL extends If{_firstActive(){this.label={mountY:.45},this.labelColors={unfocused:br("white").get(),focused:ee.colors.dark},this.backgroundColors={unfocused:br("white").alpha(0).get(),focused:ee.colors.white},this.hasFocus()&&this._focus()}static get width(){return 90}static get height(){return 40}}class yo extends If{_active(){this.label={mountY:.45},this.labelColors={unfocused:br("black").get(),focused:br("white").get()},this.backgroundColors={unfocused:br("white").get(),focused:ee.colors.accentGrey.light},this.hasFocus()&&this._focus()}static get height(){return 60}static get width(){return 160}}const GL={layouts:{abc:[["a","b","c","d","e","f","g","h","i","j"],["k","l","m","n","o","p","q","r","s","t"],["u","v","w","x","y","z","_","-","@","."],["Layout:ABC","Layout:123","Space","Search","Del"]],ABC:[["A","B","C","D","E","F","G","H","I","J"],["K","L","M","N","O","P","Q","R","S","T"],["U","V","W","X","Y","Z","_","-","@","."],["Layout:abc","Layout:123","Space","Search","Del"]],123:[["1","2","3","4","5","6","7","8","9","0"],["Layout:abc","Space","Clear","Del"]]},styling:{align:"center",horizontalSpacing:5,verticalSpacing:20},buttonTypes:{default:{type:WL},Del:{type:yo,icon:"del"},Layout:{type:yo},Space:{type:yo,w:280,label:"space"},Clear:{type:yo,label:"clear"},Search:{type:yo,label:"search"}}};class XL extends J.Component{constructor(){super(...arguments),this.contentId="",this.index=1,this.from=""}static _template(){return{ContentView:{w:1920,h:1080,color:ee.colors.black,rect:!0,shader:{x:100,y:-100,pivot:.5,type:J.shaders.RadialGradient,outerColor:ee.colors.primaryLight,innerColor:ee.colors.dark,radius:800},Thumbnail:{x:1e3,y:110,scale:1.5,shader:{type:J.shaders.FadeOut,innerColor:ee.colors.black,left:200,bottom:200}},ContentData:{shader:null,zIndex:2,Title:{x:40,y:165,shader:null,text:{fontSize:80},color:ee.colors.white},Description:{x:40,y:270,w:900,shader:null,text:{wordWrap:!0,maxLines:3,maxLinesSuffix:"...",fontSize:30},color:ee.colors.accentGrey.light},Genre:{x:40,y:380,w:900,shader:null,text:{fontSize:24},color:ee.colors.accentGrey.light},Info:{visible:!1,Director:{x:40,y:440,w:100,shader:null,text:{text:"Director : ",fontSize:24},color:ee.colors.accentGrey.light},Starring:{x:40,y:470,w:100,shader:null,text:{text:"Staring  : ",fontSize:24},color:ee.colors.accentGrey.light},DirectorList:{x:150,y:440,w:800,shader:null,text:{fontSize:24},color:ee.colors.accentGrey.light},StarringList:{x:150,y:470,w:800,shader:null,text:{fontSize:24,wordWrap:!0,maxLines:1,maxLinesSuffix:"..."},color:ee.colors.accentGrey.light}},VideoSpec:{visible:!1,VideoSpec1:{x:70,y:140,shader:null,type:ns,specData:"  16+  "},VideoSpec2:{x:135,y:140,shader:null,type:ns,specData:"  4k  "},VideoSpec3:{x:193,y:140,shader:null,type:ns,specData:"  cc  "}}},ContentActions:{shader:null,BackButton:{x:40,y:40,type:pu},PlayButton:{x:40,y:570,type:Mv,label:"Play Video"},PlayTrailer:{x:40,y:700,type:Mv,label:"Play Trailer"}}}}}_inactive(){console.log("Inactive"),this.index=1}set params(t){var m;const{id:n,from:a,data:u}=t;this.from=a;let f=(m=u.images.find(p=>p.width===828))==null?void 0:m.url;console.log(t),this.patch({ContentView:{shader:{type:J.shaders.RadialGradient,x:300,y:300,innerColor:4278190080,radius:1500},Thumbnail:{src:f},ContentData:{x:10,Title:{text:{text:u.title}},Description:{text:{text:u.description}},Genre:{text:{text:u.genre.join(" . ")}},Info:{visible:!0,DirectorList:{text:{text:u.director.map(p=>p.personName).join(", ")}},StarringList:{text:{text:u.actor.map(p=>p.personName).join(", ")}}},VideoSpec:{visible:!0}}}}),this._refocus()}_init(){}animateElements(){const t=this.tag("ContentView.ContentData").animation({duration:1,delay:0,actions:[{p:"alpha",v:{0:0,1:1}},{p:"y",v:{0:-60,1:0}}]});this.tag("ContentView.ContentActions").animation({duration:1,delay:0,actions:[{p:"alpha",v:{0:0,1:1}},{p:"x",v:{0:-100,1:10}}]}).start(),t.start()}_handleUp(){this.index>0&&(this.index-=1)}_handleDown(){this.index<2&&(this.index+=1)}_handleEnter(){console.log(this.from),this.index===0?this.from=="gridItem"||this.from=="Grid"?Pt.navigate("grid"):Pt.navigate("home"):Pt.navigate(`player/${this.contentId}`)}_getFocused(){return this.tag("ContentView.ContentActions").children[this.index]}pageTransition(t,n){return n?new Promise((a,u)=>{n.pageTransitionOut(n).then(()=>{t.visible=!0,t.animateElements(),a()})}):Promise.resolve()}}var lT={};/*
 @license
 Shaka Player
 Copyright 2016 Google LLC
 SPDX-License-Identifier: Apache-2.0
*/(function(c){(function(){var t=typeof window<"u"?window:TI,n={};(function(u,f,m){/*
 @license
 Shaka Player
 Copyright 2016 Google LLC
 SPDX-License-Identifier: Apache-2.0
*/var p;function x(e){var i=0;return function(){return i<e.length?{done:!1,value:e[i++]}:{done:!0}}}var T=typeof Object.defineProperties=="function"?Object.defineProperty:function(e,i,r){return e==Array.prototype||e==Object.prototype||(e[i]=r.value),e};function A(e){e=[typeof globalThis=="object"&&globalThis,e,typeof u=="object"&&u,typeof self=="object"&&self,typeof f=="object"&&f];for(var i=0;i<e.length;++i){var r=e[i];if(r&&r.Math==Math)return r}throw Error("Cannot find global object")}var b=A(this);function I(e,i){if(i)e:{var r=b;e=e.split(".");for(var s=0;s<e.length-1;s++){var o=e[s];if(!(o in r))break e;r=r[o]}e=e[e.length-1],s=r[e],i=i(s),i!=s&&i!=null&&T(r,e,{configurable:!0,writable:!0,value:i})}}I("Symbol",function(e){function i(l){if(this instanceof i)throw new TypeError("Symbol is not a constructor");return new r(s+(l||"")+"_"+o++,l)}function r(l,h){this.g=l,T(this,"description",{configurable:!0,writable:!0,value:h})}if(e)return e;r.prototype.toString=function(){return this.g};var s="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",o=0;return i}),I("Symbol.iterator",function(e){if(e)return e;e=Symbol("Symbol.iterator");for(var i="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),r=0;r<i.length;r++){var s=b[i[r]];typeof s=="function"&&typeof s.prototype[e]!="function"&&T(s.prototype,e,{configurable:!0,writable:!0,value:function(){return D(x(this))}})}return e});function D(e){return e={next:e},e[Symbol.iterator]=function(){return this},e}function v(e){var i=typeof Symbol<"u"&&Symbol.iterator&&e[Symbol.iterator];return i?i.call(e):{next:x(e)}}function O(e){if(!(e instanceof Array)){e=v(e);for(var i,r=[];!(i=e.next()).done;)r.push(i.value);e=r}return e}var W=typeof Object.create=="function"?Object.create:function(e){function i(){}return i.prototype=e,new i},Z;if(typeof Object.setPrototypeOf=="function")Z=Object.setPrototypeOf;else{var re;e:{var Q={a:!0},q={};try{q.__proto__=Q,re=q.a;break e}catch(e){}re=!1}Z=re?function(e,i){if(e.__proto__=i,e.__proto__!==i)throw new TypeError(e+" is not extensible");return e}:null}var xe=Z;function me(e,i){if(e.prototype=W(i.prototype),e.prototype.constructor=e,xe)xe(e,i);else for(var r in i)if(r!="prototype")if(Object.defineProperties){var s=Object.getOwnPropertyDescriptor(i,r);s&&Object.defineProperty(e,r,s)}else e[r]=i[r];e.xh=i.prototype}function He(){this.o=!1,this.l=null,this.h=void 0,this.g=1,this.j=this.m=0,this.u=this.i=null}function _e(e){if(e.o)throw new TypeError("Generator is already running");e.o=!0}He.prototype.s=function(e){this.h=e};function ce(e,i){e.i={Ee:i,Le:!0},e.g=e.m||e.j}He.prototype.return=function(e){this.i={return:e},this.g=this.j};function C(e,i,r){return e.g=r,{value:i}}He.prototype.A=function(e){this.g=e};function K(e){e.g=0}function de(e,i,r){e.m=i,r!=null&&(e.j=r)}function lt(e){e.m=0,e.j=2}function Ae(e,i){e.g=i,e.m=0}function oe(e){e.m=0;var i=e.i.Ee;return e.i=null,i}function Dt(e){e.u=[e.i],e.m=0,e.j=0}function St(e,i){var r=e.u.splice(0)[0];(r=e.i=e.i||r)?r.Le?e.g=e.m||e.j:r.A!=null&&e.j<r.A?(e.g=r.A,e.i=null):e.g=e.j:e.g=i}function vn(e){this.g=new He,this.h=e}function zo(e,i){_e(e.g);var r=e.g.l;return r?cs(e,"return"in r?r.return:function(s){return{value:s,done:!0}},i,e.g.return):(e.g.return(i),Mr(e))}function cs(e,i,r,s){try{var o=i.call(e.g.l,r);if(!(o instanceof Object))throw new TypeError("Iterator result "+o+" is not an object");if(!o.done)return e.g.o=!1,o;var l=o.value}catch(h){return e.g.l=null,ce(e.g,h),Mr(e)}return e.g.l=null,s.call(e.g,l),Mr(e)}function Mr(e){for(;e.g.g;)try{var i=e.h(e.g);if(i)return e.g.o=!1,{value:i.value,done:!1}}catch(r){e.g.h=void 0,ce(e.g,r)}if(e.g.o=!1,e.g.i){if(i=e.g.i,e.g.i=null,i.Le)throw i.Ee;return{value:i.return,done:!0}}return{value:void 0,done:!0}}function uT(e){this.next=function(i){return _e(e.g),e.g.l?i=cs(e,e.g.l.next,i,e.g.s):(e.g.s(i),i=Mr(e)),i},this.throw=function(i){return _e(e.g),e.g.l?i=cs(e,e.g.l.throw,i,e.g.s):(ce(e.g,i),i=Mr(e)),i},this.return=function(i){return zo(e,i)},this[Symbol.iterator]=function(){return this}}function hT(e){function i(s){return e.next(s)}function r(s){return e.throw(s)}return new Promise(function(s,o){function l(h){h.done?s(h.value):Promise.resolve(h.value).then(i,r).then(l,o)}l(e.next())})}function z(e){return hT(new uT(new vn(e)))}function Gi(){for(var e=Number(this),i=[],r=e;r<arguments.length;r++)i[r-e]=arguments[r];return i}I("Promise",function(e){function i(h){this.h=0,this.i=void 0,this.g=[],this.o=!1;var d=this.j();try{h(d.resolve,d.reject)}catch(g){d.reject(g)}}function r(){this.g=null}function s(h){return h instanceof i?h:new i(function(d){d(h)})}if(e)return e;r.prototype.h=function(h){if(this.g==null){this.g=[];var d=this;this.i(function(){d.l()})}this.g.push(h)};var o=b.setTimeout;r.prototype.i=function(h){o(h,0)},r.prototype.l=function(){for(;this.g&&this.g.length;){var h=this.g;this.g=[];for(var d=0;d<h.length;++d){var g=h[d];h[d]=null;try{g()}catch(_){this.j(_)}}}this.g=null},r.prototype.j=function(h){this.i(function(){throw h})},i.prototype.j=function(){function h(_){return function(y){g||(g=!0,_.call(d,y))}}var d=this,g=!1;return{resolve:h(this.F),reject:h(this.l)}},i.prototype.F=function(h){if(h===this)this.l(new TypeError("A Promise cannot resolve to itself"));else if(h instanceof i)this.H(h);else{e:switch(typeof h){case"object":var d=h!=null;break e;case"function":d=!0;break e;default:d=!1}d?this.D(h):this.m(h)}},i.prototype.D=function(h){var d=void 0;try{d=h.then}catch(g){this.l(g);return}typeof d=="function"?this.J(d,h):this.m(h)},i.prototype.l=function(h){this.s(2,h)},i.prototype.m=function(h){this.s(1,h)},i.prototype.s=function(h,d){if(this.h!=0)throw Error("Cannot settle("+h+", "+d+"): Promise already settled in state"+this.h);this.h=h,this.i=d,this.h===2&&this.G(),this.u()},i.prototype.G=function(){var h=this;o(function(){if(h.B()){var d=b.console;typeof d<"u"&&d.error(h.i)}},1)},i.prototype.B=function(){if(this.o)return!1;var h=b.CustomEvent,d=b.Event,g=b.dispatchEvent;return typeof g>"u"?!0:(typeof h=="function"?h=new h("unhandledrejection",{cancelable:!0}):typeof d=="function"?h=new d("unhandledrejection",{cancelable:!0}):(h=b.document.createEvent("CustomEvent"),h.initCustomEvent("unhandledrejection",!1,!0,h)),h.promise=this,h.reason=this.i,g(h))},i.prototype.u=function(){if(this.g!=null){for(var h=0;h<this.g.length;++h)l.h(this.g[h]);this.g=null}};var l=new r;return i.prototype.H=function(h){var d=this.j();h.Lc(d.resolve,d.reject)},i.prototype.J=function(h,d){var g=this.j();try{h.call(d,g.resolve,g.reject)}catch(_){g.reject(_)}},i.prototype.then=function(h,d){function g(w,E){return typeof w=="function"?function(R){try{_(w(R))}catch(P){y(P)}}:E}var _,y,S=new i(function(w,E){_=w,y=E});return this.Lc(g(h,_),g(d,y)),S},i.prototype.catch=function(h){return this.then(void 0,h)},i.prototype.Lc=function(h,d){function g(){switch(_.h){case 1:h(_.i);break;case 2:d(_.i);break;default:throw Error("Unexpected state: "+_.h)}}var _=this;this.g==null?l.h(g):this.g.push(g),this.o=!0},i.resolve=s,i.reject=function(h){return new i(function(d,g){g(h)})},i.race=function(h){return new i(function(d,g){for(var _=v(h),y=_.next();!y.done;y=_.next())s(y.value).Lc(d,g)})},i.all=function(h){var d=v(h),g=d.next();return g.done?s([]):new i(function(_,y){function S(R){return function(P){w[R]=P,E--,E==0&&_(w)}}var w=[],E=0;do w.push(void 0),E++,s(g.value).Lc(S(w.length-1),y),g=d.next();while(!g.done)})},i});function _i(e,i){return Object.prototype.hasOwnProperty.call(e,i)}I("WeakMap",function(e){function i(g){if(this.g=(d+=Math.random()+1).toString(),g){g=v(g);for(var _;!(_=g.next()).done;)_=_.value,this.set(_[0],_[1])}}function r(){}function s(g){var _=typeof g;return _==="object"&&g!==null||_==="function"}function o(g){if(!_i(g,h)){var _=new r;T(g,h,{value:_})}}function l(g){var _=Object[g];_&&(Object[g]=function(y){return y instanceof r?y:(Object.isExtensible(y)&&o(y),_(y))})}if(function(){if(!e||!Object.seal)return!1;try{var g=Object.seal({}),_=Object.seal({}),y=new e([[g,2],[_,3]]);return y.get(g)!=2||y.get(_)!=3?!1:(y.delete(g),y.set(_,4),!y.has(g)&&y.get(_)==4)}catch(S){return!1}}())return e;var h="$jscomp_hidden_"+Math.random();l("freeze"),l("preventExtensions"),l("seal");var d=0;return i.prototype.set=function(g,_){if(!s(g))throw Error("Invalid WeakMap key");if(o(g),!_i(g,h))throw Error("WeakMap key fail: "+g);return g[h][this.g]=_,this},i.prototype.get=function(g){return s(g)&&_i(g,h)?g[h][this.g]:void 0},i.prototype.has=function(g){return s(g)&&_i(g,h)&&_i(g[h],this.g)},i.prototype.delete=function(g){return s(g)&&_i(g,h)&&_i(g[h],this.g)?delete g[h][this.g]:!1},i}),I("Map",function(e){function i(){var d={};return d.Qa=d.next=d.head=d}function r(d,g){var _=d.g;return D(function(){if(_){for(;_.head!=d.g;)_=_.Qa;for(;_.next!=_.head;)return _=_.next,{done:!1,value:g(_)};_=null}return{done:!0,value:void 0}})}function s(d,g){var _=g&&typeof g;_=="object"||_=="function"?l.has(g)?_=l.get(g):(_=""+ ++h,l.set(g,_)):_="p_"+g;var y=d.h[_];if(y&&_i(d.h,_))for(d=0;d<y.length;d++){var S=y[d];if(g!==g&&S.key!==S.key||g===S.key)return{id:_,list:y,index:d,ga:S}}return{id:_,list:y,index:-1,ga:void 0}}function o(d){if(this.h={},this.g=i(),this.size=0,d){d=v(d);for(var g;!(g=d.next()).done;)g=g.value,this.set(g[0],g[1])}}if(function(){if(!e||typeof e!="function"||!e.prototype.entries||typeof Object.seal!="function")return!1;try{var d=Object.seal({x:4}),g=new e(v([[d,"s"]]));if(g.get(d)!="s"||g.size!=1||g.get({x:4})||g.set({x:4},"t")!=g||g.size!=2)return!1;var _=g.entries(),y=_.next();return y.done||y.value[0]!=d||y.value[1]!="s"?!1:(y=_.next(),!(y.done||y.value[0].x!=4||y.value[1]!="t"||!_.next().done))}catch(S){return!1}}())return e;var l=new WeakMap;o.prototype.set=function(d,g){d=d===0?0:d;var _=s(this,d);return _.list||(_.list=this.h[_.id]=[]),_.ga?_.ga.value=g:(_.ga={next:this.g,Qa:this.g.Qa,head:this.g,key:d,value:g},_.list.push(_.ga),this.g.Qa.next=_.ga,this.g.Qa=_.ga,this.size++),this},o.prototype.delete=function(d){return d=s(this,d),d.ga&&d.list?(d.list.splice(d.index,1),d.list.length||delete this.h[d.id],d.ga.Qa.next=d.ga.next,d.ga.next.Qa=d.ga.Qa,d.ga.head=null,this.size--,!0):!1},o.prototype.clear=function(){this.h={},this.g=this.g.Qa=i(),this.size=0},o.prototype.has=function(d){return!!s(this,d).ga},o.prototype.get=function(d){return(d=s(this,d).ga)&&d.value},o.prototype.entries=function(){return r(this,function(d){return[d.key,d.value]})},o.prototype.keys=function(){return r(this,function(d){return d.key})},o.prototype.values=function(){return r(this,function(d){return d.value})},o.prototype.forEach=function(d,g){for(var _=this.entries(),y;!(y=_.next()).done;)y=y.value,d.call(g,y[1],y[0],this)},o.prototype[Symbol.iterator]=o.prototype.entries;var h=0;return o}),I("Set",function(e){function i(r){if(this.g=new Map,r){r=v(r);for(var s;!(s=r.next()).done;)this.add(s.value)}this.size=this.g.size}return function(){if(!e||typeof e!="function"||!e.prototype.entries||typeof Object.seal!="function")return!1;try{var r=Object.seal({x:4}),s=new e(v([r]));if(!s.has(r)||s.size!=1||s.add(r)!=s||s.size!=1||s.add({x:4})!=s||s.size!=2)return!1;var o=s.entries(),l=o.next();return l.done||l.value[0]!=r||l.value[1]!=r?!1:(l=o.next(),l.done||l.value[0]==r||l.value[0].x!=4||l.value[1]!=l.value[0]?!1:o.next().done)}catch(h){return!1}}()?e:(i.prototype.add=function(r){return r=r===0?0:r,this.g.set(r,r),this.size=this.g.size,this},i.prototype.delete=function(r){return r=this.g.delete(r),this.size=this.g.size,r},i.prototype.clear=function(){this.g.clear(),this.size=0},i.prototype.has=function(r){return this.g.has(r)},i.prototype.entries=function(){return this.g.entries()},i.prototype.values=function(){return this.g.values()},i.prototype.keys=i.prototype.values,i.prototype[Symbol.iterator]=i.prototype.values,i.prototype.forEach=function(r,s){var o=this;this.g.forEach(function(l){return r.call(s,l,l,o)})},i)});function Lf(e,i,r){e instanceof String&&(e=String(e));for(var s=e.length,o=0;o<s;o++){var l=e[o];if(i.call(r,l,o,e))return{Je:o,v:l}}return{Je:-1,v:void 0}}I("Array.prototype.findIndex",function(e){return e||function(i,r){return Lf(this,i,r).Je}}),I("Object.is",function(e){return e||function(i,r){return i===r?i!==0||1/i===1/r:i!==i&&r!==r}}),I("Array.prototype.includes",function(e){return e||function(i,r){var s=this;s instanceof String&&(s=String(s));var o=s.length;for(r=r||0,0>r&&(r=Math.max(r+o,0));r<o;r++){var l=s[r];if(l===i||Object.is(l,i))return!0}return!1}});function mu(e,i,r){if(e==null)throw new TypeError("The 'this' value for String.prototype."+r+" must not be null or undefined");if(i instanceof RegExp)throw new TypeError("First argument to String.prototype."+r+" must not be a regular expression");return e+""}I("String.prototype.includes",function(e){return e||function(i,r){return mu(this,i,"includes").indexOf(i,r||0)!==-1}}),I("Array.prototype.find",function(e){return e||function(i,r){return Lf(this,i,r).v}}),I("String.prototype.startsWith",function(e){return e||function(i,r){var s=mu(this,i,"startsWith"),o=s.length,l=i.length;r=Math.max(0,Math.min(r|0,s.length));for(var h=0;h<l&&r<o;)if(s[r++]!=i[h++])return!1;return h>=l}});function _u(e,i){e instanceof String&&(e+="");var r=0,s=!1,o={next:function(){if(!s&&r<e.length){var l=r++;return{value:i(l,e[l]),done:!1}}return s=!0,{done:!0,value:void 0}}};return o[Symbol.iterator]=function(){return o},o}I("Array.prototype.keys",function(e){return e||function(){return _u(this,function(i){return i})}});var cT=typeof Object.assign=="function"?Object.assign:function(e,i){for(var r=1;r<arguments.length;r++){var s=arguments[r];if(s)for(var o in s)_i(s,o)&&(e[o]=s[o])}return e};I("Object.assign",function(e){return e||cT}),I("Array.from",function(e){return e||function(i,r,s){r=r!=null?r:function(d){return d};var o=[],l=typeof Symbol<"u"&&Symbol.iterator&&i[Symbol.iterator];if(typeof l=="function"){i=l.call(i);for(var h=0;!(l=i.next()).done;)o.push(r.call(s,l.value,h++))}else for(l=i.length,h=0;h<l;h++)o.push(r.call(s,i[h],h));return o}}),I("Array.prototype.values",function(e){return e||function(){return _u(this,function(i,r){return r})}}),I("Promise.prototype.finally",function(e){return e||function(i){return this.then(function(r){return Promise.resolve(i()).then(function(){return r})},function(r){return Promise.resolve(i()).then(function(){throw r})})}}),I("Array.prototype.entries",function(e){return e||function(){return _u(this,function(i,r){return[i,r]})}}),I("String.prototype.repeat",function(e){return e||function(i){var r=mu(this,null,"repeat");if(0>i||1342177279<i)throw new RangeError("Invalid count value");i|=0;for(var s="";i;)i&1&&(s+=r),(i>>>=1)&&(r+=r);return s}}),I("Number.isNaN",function(e){return e||function(i){return typeof i=="number"&&isNaN(i)}}),I("Object.values",function(e){return e||function(i){var r=[],s;for(s in i)_i(i,s)&&r.push(i[s]);return r}}),I("Math.log2",function(e){return e||function(i){return Math.log(i)/Math.LN2}}),I("Math.trunc",function(e){return e||function(i){if(i=Number(i),isNaN(i)||i===1/0||i===-1/0||i===0)return i;var r=Math.floor(Math.abs(i));return 0>i?-r:r}}),I("Object.entries",function(e){return e||function(i){var r=[],s;for(s in i)_i(i,s)&&r.push([s,i[s]]);return r}});var dT=this||self;function te(e,i){e=e.split(".");var r=dT;e[0]in r||typeof r.execScript>"u"||r.execScript("var "+e[0]);for(var s;e.length&&(s=e.shift());)e.length||i===void 0?r[s]&&r[s]!==Object.prototype[s]?r=r[s]:r=r[s]={}:r[s]=i}function Bo(e){this.g=Math.exp(Math.log(.5)/e),this.i=this.h=0}Bo.prototype.sample=function(e,i){var r=Math.pow(this.g,e);i=i*(1-r)+r*this.h,isNaN(i)||(this.h=i,this.i+=e)};function yu(e){return e.h/(1-Math.pow(e.g,e.i))}function ds(){this.h=new Bo(2),this.j=new Bo(5),this.g=0,this.i=128e3,this.l=16e3}ds.prototype.configure=function(e){this.i=e.minTotalBytes,this.l=e.minBytes,this.h.g=Math.exp(Math.log(.5)/e.fastHalfLife),this.j.g=Math.exp(Math.log(.5)/e.slowHalfLife)},ds.prototype.sample=function(e,i){if(!(i<this.l)){var r=8e3*i/e;e/=1e3,this.g+=i,this.h.sample(e,r),this.j.sample(e,r)}},ds.prototype.getBandwidthEstimate=function(e){return this.g<this.i?e:Math.min(yu(this.h),yu(this.j))};function fT(){}function Pr(){}function qe(){}function kr(e){var i=Gi.apply(1,arguments);Mf.has(e)||(Mf.add(e),qe.apply(fT,O(i)))}function pT(){}function tM(){}function iM(){}function rM(){}var Mf=new Set;if(u.console&&u.console.log.bind){var Dr={},Pf=(Dr[1]=console.error.bind(console),Dr[2]=console.warn.bind(console),Dr[3]=console.info.bind(console),Dr[4]=console.log.bind(console),Dr[5]=console.debug.bind(console),Dr[6]=console.debug.bind(console),Dr);qe=Pf[2],Pr=Pf[1]}function Qt(e){if(xu.has(e))return xu.get(e);var i=MediaSource.isTypeSupported(e);return xu.set(e,i),i}var xu=new Map;function kf(e,i){return typeof e=="number"&&typeof i=="number"&&isNaN(e)&&isNaN(i)?!0:e===i}function yi(e,i){i=e.indexOf(i),-1<i&&e.splice(i,1)}function fs(e,i,r){if(r||(r=kf),e.length!=i.length)return!1;i=i.slice();var s={};e=v(e);for(var o=e.next();!o.done;s={md:s.md},o=e.next()){if(s.md=o.value,o=i.findIndex(function(l){return function(h){return r(l.md,h)}}(s)),o==-1)return!1;i[o]=i[i.length-1],i.pop()}return i.length==0}function vu(e,i,r){if(r||(r=kf),e.length!=i.length)return!1;for(var s=0;s<e.length;s++)if(!r(e[s],i[s]))return!1;return!0}function Be(e,i,r){this.startTime=e,this.direction=Su,this.endTime=i,this.payload=r,this.region=new Tn,this.position=null,this.positionAlign=Of,this.size=0,this.textAlign=Xi,this.writingMode=gs,this.lineInterpretation=wu,this.line=null,this.lineHeight="",this.lineAlign=Or,this.displayAlign=ps,this.fontSize=this.textStrokeWidth=this.textStrokeColor=this.textShadow=this.border=this.backgroundImage=this.backgroundColor=this.color="",this.fontWeight=zf,this.fontStyle=Eu,this.linePadding=this.letterSpacing=this.fontFamily="",this.opacity=1,this.textDecoration=[],this.wrapLine=!0,this.id="",this.nestedCues=[],this.lineBreak=this.isContainer=!1,this.cellResolution={columns:32,rows:15}}Be.prototype.clone=function(){var e=new Be(0,0,""),i;for(i in this)e[i]=this[i],e[i]&&e[i].constructor==Array&&(e[i]=e[i].slice());return e};function Df(e,i){if(e.startTime!=i.startTime||e.endTime!=i.endTime||e.payload!=i.payload)return!1;for(var r in e)if(r!="startTime"&&r!="endTime"&&r!="payload"){if(r=="nestedCues"){if(!vu(e.nestedCues,i.nestedCues,Df))return!1}else if(r=="region"||r=="cellResolution"){for(var s in e[r])if(e[r][s]!=i[r][s])return!1}else if(Array.isArray(e[r])){if(!vu(e[r],i[r]))return!1}else if(e[r]!=i[r])return!1}return!0}te("shaka.text.Cue",Be);var Of="auto";Be.positionAlign={LEFT:"line-left",RIGHT:"line-right",CENTER:"center",AUTO:Of};var Xi="center",Tu={LEFT:"left",RIGHT:"right",CENTER:Xi,START:"start",END:"end"};Be.textAlign=Tu;var ps="after",Ff={BEFORE:"before",CENTER:"center",AFTER:ps};Be.displayAlign=Ff;var Su="ltr";Be.direction={HORIZONTAL_LEFT_TO_RIGHT:Su,HORIZONTAL_RIGHT_TO_LEFT:"rtl"};var gs="horizontal-tb";Be.writingMode={HORIZONTAL_TOP_TO_BOTTOM:gs,VERTICAL_LEFT_TO_RIGHT:"vertical-lr",VERTICAL_RIGHT_TO_LEFT:"vertical-rl"};var wu=0;Be.lineInterpretation={LINE_NUMBER:wu,PERCENTAGE:1};var Or="start",Au={CENTER:"center",START:Or,END:"end"};Be.lineAlign=Au;var Nf={white:"#FFF",lime:"#0F0",cyan:"#0FF",red:"#F00",yellow:"#FF0",magenta:"#F0F",blue:"#00F",black:"#000"};Be.defaultTextColor=Nf;var Uf={bg_white:"#FFF",bg_lime:"#0F0",bg_cyan:"#0FF",bg_red:"#F00",bg_yellow:"#FF0",bg_magenta:"#F0F",bg_blue:"#00F",bg_black:"#000"};Be.defaultTextBackgroundColor=Uf;var zf=400;Be.fontWeight={NORMAL:zf,BOLD:700};var Eu="normal",Bf={NORMAL:Eu,ITALIC:"italic",OBLIQUE:"oblique"};Be.fontStyle=Bf,Be.textDecoration={UNDERLINE:"underline",LINE_THROUGH:"lineThrough",OVERLINE:"overline"};function Tn(){this.id="",this.regionAnchorY=this.regionAnchorX=this.viewportAnchorY=this.viewportAnchorX=0,this.height=this.width=100,this.viewportAnchorUnits=this.widthUnits=this.heightUnits=Mi,this.scroll=jf}te("shaka.text.CueRegion",Tn);var Mi=1;Tn.units={PX:0,PERCENTAGE:Mi,LINES:2};var jf="";Tn.scrollMode={NONE:jf,UP:"up"};function ms(){}function Fr(e,i){if(!e&&!i)return!0;if(!e||!i||e.byteLength!=i.byteLength)return!1;if(Cu(e)==Cu(i)&&(e.byteOffset||0)==(i.byteOffset||0))return!0;var r=Ee(e);i=Ee(i);for(var s=0;s<e.byteLength;s++)if(r[s]!=i[s])return!1;return!0}function Cu(e){return e instanceof ArrayBuffer?e:e.buffer}function Jt(e){return e instanceof ArrayBuffer?e:e.byteOffset==0&&e.byteLength==e.buffer.byteLength?e.buffer:new Uint8Array(e).buffer}function Ee(e,i,r){return r=r===void 0?1/0:r,Hf(e,i===void 0?0:i,r,Uint8Array)}function Ot(e,i,r){return r=r===void 0?1/0:r,Hf(e,i===void 0?0:i,r,DataView)}function Hf(e,i,r,s){var o=(e.byteOffset||0)+e.byteLength;return i=Math.max(0,Math.min((e.byteOffset||0)+i,o)),new s(Cu(e),i,Math.min(i+Math.max(r,0),o)-i)}te("shaka.util.BufferUtils",ms),ms.toDataView=Ot,ms.toUint8=Ee,ms.toArrayBuffer=Jt,ms.equal=Fr;function F(e,i,r){var s=Gi.apply(3,arguments);this.severity=e,this.category=i,this.code=r,this.data=s,this.handled=!1}F.prototype.toString=function(){return"shaka.util.Error "+JSON.stringify(this,null,"  ")},te("shaka.util.Error",F),F.Severity={RECOVERABLE:1,CRITICAL:2},F.Category={NETWORK:1,TEXT:2,MEDIA:3,MANIFEST:4,STREAMING:5,DRM:6,PLAYER:7,CAST:8,STORAGE:9,ADS:10},F.Code={UNSUPPORTED_SCHEME:1e3,BAD_HTTP_STATUS:1001,HTTP_ERROR:1002,TIMEOUT:1003,MALFORMED_DATA_URI:1004,REQUEST_FILTER_ERROR:1006,RESPONSE_FILTER_ERROR:1007,MALFORMED_TEST_URI:1008,UNEXPECTED_TEST_REQUEST:1009,ATTEMPTS_EXHAUSTED:1010,SEGMENT_MISSING:1011,INVALID_TEXT_HEADER:2e3,INVALID_TEXT_CUE:2001,UNABLE_TO_DETECT_ENCODING:2003,BAD_ENCODING:2004,INVALID_XML:2005,INVALID_MP4_TTML:2007,INVALID_MP4_VTT:2008,UNABLE_TO_EXTRACT_CUE_START_TIME:2009,INVALID_MP4_CEA:2010,TEXT_COULD_NOT_GUESS_MIME_TYPE:2011,CANNOT_ADD_EXTERNAL_TEXT_TO_SRC_EQUALS:2012,TEXT_ONLY_WEBVTT_SRC_EQUALS:2013,MISSING_TEXT_PLUGIN:2014,CHAPTERS_TRACK_FAILED:2015,CANNOT_ADD_EXTERNAL_THUMBNAILS_TO_SRC_EQUALS:2016,UNSUPPORTED_EXTERNAL_THUMBNAILS_URI:2017,BUFFER_READ_OUT_OF_BOUNDS:3e3,JS_INTEGER_OVERFLOW:3001,EBML_OVERFLOW:3002,EBML_BAD_FLOATING_POINT_SIZE:3003,MP4_SIDX_WRONG_BOX_TYPE:3004,MP4_SIDX_INVALID_TIMESCALE:3005,MP4_SIDX_TYPE_NOT_SUPPORTED:3006,WEBM_CUES_ELEMENT_MISSING:3007,WEBM_EBML_HEADER_ELEMENT_MISSING:3008,WEBM_SEGMENT_ELEMENT_MISSING:3009,WEBM_INFO_ELEMENT_MISSING:3010,WEBM_DURATION_ELEMENT_MISSING:3011,WEBM_CUE_TRACK_POSITIONS_ELEMENT_MISSING:3012,WEBM_CUE_TIME_ELEMENT_MISSING:3013,MEDIA_SOURCE_OPERATION_FAILED:3014,MEDIA_SOURCE_OPERATION_THREW:3015,VIDEO_ERROR:3016,QUOTA_EXCEEDED_ERROR:3017,TRANSMUXING_FAILED:3018,CONTENT_TRANSFORMATION_FAILED:3019,UNABLE_TO_GUESS_MANIFEST_TYPE:4e3,DASH_INVALID_XML:4001,DASH_NO_SEGMENT_INFO:4002,DASH_EMPTY_ADAPTATION_SET:4003,DASH_EMPTY_PERIOD:4004,DASH_WEBM_MISSING_INIT:4005,DASH_UNSUPPORTED_CONTAINER:4006,DASH_PSSH_BAD_ENCODING:4007,DASH_NO_COMMON_KEY_SYSTEM:4008,DASH_MULTIPLE_KEY_IDS_NOT_SUPPORTED:4009,DASH_CONFLICTING_KEY_IDS:4010,RESTRICTIONS_CANNOT_BE_MET:4012,HLS_PLAYLIST_HEADER_MISSING:4015,INVALID_HLS_TAG:4016,HLS_INVALID_PLAYLIST_HIERARCHY:4017,DASH_DUPLICATE_REPRESENTATION_ID:4018,HLS_MULTIPLE_MEDIA_INIT_SECTIONS_FOUND:4020,HLS_REQUIRED_ATTRIBUTE_MISSING:4023,HLS_REQUIRED_TAG_MISSING:4024,HLS_COULD_NOT_GUESS_CODECS:4025,HLS_KEYFORMATS_NOT_SUPPORTED:4026,DASH_UNSUPPORTED_XLINK_ACTUATE:4027,DASH_XLINK_DEPTH_LIMIT:4028,CONTENT_UNSUPPORTED_BY_BROWSER:4032,CANNOT_ADD_EXTERNAL_TEXT_TO_LIVE_STREAM:4033,NO_VARIANTS:4036,PERIOD_FLATTENING_FAILED:4037,INCONSISTENT_DRM_ACROSS_PERIODS:4038,HLS_VARIABLE_NOT_FOUND:4039,HLS_MSE_ENCRYPTED_MP2T_NOT_SUPPORTED:4040,HLS_MSE_ENCRYPTED_LEGACY_APPLE_MEDIA_KEYS_NOT_SUPPORTED:4041,NO_WEB_CRYPTO_API:4042,HLS_AES_128_INVALID_IV_LENGTH:4043,HLS_AES_128_INVALID_KEY_LENGTH:4044,CANNOT_ADD_EXTERNAL_THUMBNAILS_TO_LIVE_STREAM:4045,STREAMING_ENGINE_STARTUP_INVALID_STATE:5006,NO_RECOGNIZED_KEY_SYSTEMS:6e3,REQUESTED_KEY_SYSTEM_CONFIG_UNAVAILABLE:6001,FAILED_TO_CREATE_CDM:6002,FAILED_TO_ATTACH_TO_VIDEO:6003,INVALID_SERVER_CERTIFICATE:6004,FAILED_TO_CREATE_SESSION:6005,FAILED_TO_GENERATE_LICENSE_REQUEST:6006,LICENSE_REQUEST_FAILED:6007,LICENSE_RESPONSE_REJECTED:6008,ENCRYPTED_CONTENT_WITHOUT_DRM_INFO:6010,NO_LICENSE_SERVER_GIVEN:6012,OFFLINE_SESSION_REMOVED:6013,EXPIRED:6014,SERVER_CERTIFICATE_REQUIRED:6015,INIT_DATA_TRANSFORM_ERROR:6016,SERVER_CERTIFICATE_REQUEST_FAILED:6017,LOAD_INTERRUPTED:7e3,OPERATION_ABORTED:7001,NO_VIDEO_ELEMENT:7002,OBJECT_DESTROYED:7003,CONTENT_NOT_LOADED:7004,CAST_API_UNAVAILABLE:8e3,NO_CAST_RECEIVERS:8001,ALREADY_CASTING:8002,UNEXPECTED_CAST_ERROR:8003,CAST_CANCELED_BY_USER:8004,CAST_CONNECTION_TIMED_OUT:8005,CAST_RECEIVER_APP_UNAVAILABLE:8006,STORAGE_NOT_SUPPORTED:9e3,INDEXED_DB_ERROR:9001,DEPRECATED_OPERATION_ABORTED:9002,REQUESTED_ITEM_NOT_FOUND:9003,MALFORMED_OFFLINE_URI:9004,CANNOT_STORE_LIVE_OFFLINE:9005,NO_INIT_DATA_FOR_OFFLINE:9007,LOCAL_PLAYER_INSTANCE_REQUIRED:9008,NEW_KEY_OPERATION_NOT_SUPPORTED:9011,KEY_NOT_FOUND:9012,MISSING_STORAGE_CELL:9013,STORAGE_LIMIT_REACHED:9014,DOWNLOAD_SIZE_CALLBACK_ERROR:9015,MODIFY_OPERATION_NOT_SUPPORTED:9016,INDEXED_DB_INIT_TIMED_OUT:9017,CS_IMA_SDK_MISSING:1e4,CS_AD_MANAGER_NOT_INITIALIZED:10001,SS_IMA_SDK_MISSING:10002,SS_AD_MANAGER_NOT_INITIALIZED:10003,CURRENT_DAI_REQUEST_NOT_FINISHED:10004};/*
 @license
 Copyright 2008 The Closure Library Authors
 SPDX-License-Identifier: Apache-2.0
*/var gT=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#(.*))?$");/*
 @license
 Copyright 2006 The Closure Library Authors
 SPDX-License-Identifier: Apache-2.0
*/function jt(e){var i;e instanceof jt?(jo(this,e.Ea),this.pb=e.pb,this.Ha=e.Ha,bu(this,e.Kb),this.qa=e.qa,Ho(this,e.g.clone()),this.fb=e.fb):e&&(i=String(e).match(gT))?(jo(this,i[1]||"",!0),this.pb=_s(i[2]||""),this.Ha=_s(i[3]||"",!0),bu(this,i[4]),this.qa=_s(i[5]||"",!0),Ho(this,i[6]||"",!0),this.fb=_s(i[7]||"")):this.g=new Sn(null)}p=jt.prototype,p.Ea="",p.pb="",p.Ha="",p.Kb=null,p.qa="",p.fb="",p.toString=function(){var e=[],i=this.Ea;if(i&&e.push(ys(i,Vf,!0),":"),i=this.Ha){e.push("//");var r=this.pb;r&&e.push(ys(r,Vf,!0),"@"),e.push(encodeURIComponent(i).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),i=this.Kb,i!=null&&e.push(":",String(i))}return(i=this.qa)&&(this.Ha&&i.charAt(0)!="/"&&e.push("/"),e.push(ys(i,i.charAt(0)=="/"?yT:_T,!0))),(i=this.g.toString())&&e.push("?",i),(i=this.fb)&&e.push("#",ys(i,vT)),e.join("")},p.resolve=function(e){var i=this.clone();i.Ea==="data"&&(i=new jt);var r=!!e.Ea;r?jo(i,e.Ea):r=!!e.pb,r?i.pb=e.pb:r=!!e.Ha,r?i.Ha=e.Ha:r=e.Kb!=null;var s=e.qa;if(r)bu(i,e.Kb);else if(r=!!e.qa){if(s.charAt(0)!="/")if(this.Ha&&!this.qa)s="/"+s;else{var o=i.qa.lastIndexOf("/");o!=-1&&(s=i.qa.substr(0,o+1)+s)}if(s==".."||s==".")s="";else if(s.indexOf("./")!=-1||s.indexOf("/.")!=-1){o=s.lastIndexOf("/",0)==0,s=s.split("/");for(var l=[],h=0;h<s.length;){var d=s[h++];d=="."?o&&h==s.length&&l.push(""):d==".."?((1<l.length||l.length==1&&l[0]!="")&&l.pop(),o&&h==s.length&&l.push("")):(l.push(d),o=!0)}s=l.join("/")}}return r?i.qa=s:r=e.g.toString()!=="",r?Ho(i,e.g.clone()):r=!!e.fb,r&&(i.fb=e.fb),i},p.clone=function(){return new jt(this)};function jo(e,i,r){e.Ea=r?_s(i,!0):i,e.Ea&&(e.Ea=e.Ea.replace(/:$/,""))}function bu(e,i){if(i){if(i=Number(i),isNaN(i)||0>i)throw Error("Bad port number "+i);e.Kb=i}else e.Kb=null}function Ho(e,i,r){i instanceof Sn?e.g=i:(r||(i=ys(i,xT)),e.g=new Sn(i))}function _s(e,i){return e?i?decodeURI(e):decodeURIComponent(e):""}function ys(e,i,r){return e!=null?(e=encodeURI(e).replace(i,mT),r&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function mT(e){return e=e.charCodeAt(0),"%"+(e>>4&15).toString(16)+(e&15).toString(16)}var Vf=/[#\/\?@]/g,_T=/[#\?:]/g,yT=/[#\?]/g,xT=/[#\?@]/g,vT=/#/g;function Sn(e){this.g=e||null}function Wf(e){if(!e.la&&(e.la={},e.Oc=0,e.g))for(var i=e.g.split("&"),r=0;r<i.length;r++){var s=i[r].indexOf("="),o=null;if(0<=s){var l=i[r].substring(0,s);o=i[r].substring(s+1)}else l=i[r];l=decodeURIComponent(l.replace(/\+/g," ")),o=o||"",e.add(l,decodeURIComponent(o.replace(/\+/g," ")))}}p=Sn.prototype,p.la=null,p.Oc=null,p.add=function(e,i){Wf(this),this.g=null;var r=this.la.hasOwnProperty(e)?this.la[e]:null;return r||(this.la[e]=r=[]),r.push(i),this.Oc++,this},p.set=function(e,i){return Wf(this),this.g=null,this.la.hasOwnProperty(e)?this.la[e]=[i]:this.add(e,i),this},p.toString=function(){if(this.g)return this.g;if(!this.la)return"";var e=[],i;for(i in this.la)for(var r=encodeURIComponent(i),s=this.la[i],o=0;o<s.length;o++){var l=r;s[o]!==""&&(l+="="+encodeURIComponent(s[o])),e.push(l)}return this.g=e.join("&")},p.clone=function(){var e=new Sn;if(e.g=this.g,this.la){var i={},r;for(r in this.la)i[r]=this.la[r].concat();e.la=i,e.Oc=this.Oc}return e};function Iu(e,i){return e.concat(i)}function TT(){}function pr(e){return e!=null}function Ft(e,i){if(i.length==0)return e;var r=i.map(function(s){return new jt(s)});return e.map(function(s){return new jt(s)}).map(function(s){return r.map(function(o){return s.resolve(o)})}).reduce(Iu,[]).map(function(s){return s.toString()})}function Nr(e,i){return{keySystem:e,licenseServerUri:"",distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",serverCertificate:null,serverCertificateUri:"",sessionType:"",initData:i||[],keyIds:new Set}}function xs(e,i){if(i.length==1)return i[0];if(e=wn(e,i),e!=null)return e;throw new F(2,4,4025,i)}function wn(e,i){for(var r=v(ST[e]),s=r.next();!s.done;s=r.next()){s=s.value;for(var o=v(i),l=o.next();!l.done;l=o.next())if(l=l.value,s.test(l.trim()))return l.trim()}return e==De?"":null}var De="text",wt={va:"video",Hc:"audio",X:De,Wb:"image",Gg:"application"},ST={audio:[/^vorbis$/,/^opus$/,/^flac$/,/^mp4a/,/^[ae]c-3$/,/^ac-4$/,/^dts[cx]$/,/^[du]dts$/],video:[/^avc/,/^hev/,/^hvc/,/^vp0?[89]/,/^av01/,/^dvhe/],text:[/^vtt$/,/^wvtt/,/^stpp/]};function Ve(){var e,i,r=new Promise(function(s,o){e=s,i=o});return r.resolve=e,r.reject=i,r}Ve.prototype.resolve=function(){},Ve.prototype.reject=function(){};function An(e){this.h=e,this.g=void 0}An.prototype.value=function(){return this.g==null&&(this.g=this.h()),this.g};function vs(e){this.h=e,this.g=null}vs.prototype.N=function(e){var i=this;this.stop();var r=!0,s=null;return this.g=function(){u.clearTimeout(s),r=!1},s=u.setTimeout(function(){r&&i.h()},1e3*e),this},vs.prototype.stop=function(){this.g&&(this.g(),this.g=null)};function we(e){this.h=e,this.g=null}we.prototype.Mb=function(){return this.stop(),this.h(),this},we.prototype.N=function(e){var i=this;return this.stop(),this.g=new vs(function(){i.h()}).N(e),this},we.prototype.Ca=function(e){var i=this;return this.stop(),this.g=new vs(function(){i.g.N(e),i.h()}).N(e),this},we.prototype.stop=function(){this.g&&(this.g.stop(),this.g=null)},te("shaka.util.Timer",we),we.prototype.stop=we.prototype.stop,we.prototype.tickEvery=we.prototype.Ca,we.prototype.tickAfter=we.prototype.N,we.prototype.tickNow=we.prototype.Mb;function xi(){return!!(u.MediaSource&&MediaSource.isTypeSupported)}function En(e){return Xf().canPlayType(e)!=""}function Ru(){return!!navigator.userAgent.match(/Edge?\//)}function Ts(){return $e("Xbox One")}function Cn(){return $e("Tizen")}function Gf(){return $e("Web0S")&&$e("Chrome/38.0.2125.122 Safari/537.36")}function Vo(){return!!navigator.vendor&&navigator.vendor.includes("Apple")&&!Cn()&&!$e("PC=EOS")&&!$e("VirginMedia")&&!Ss()&&!$e("AFT")}function Ss(){return $e("PlayStation 4")}function Lu(){if(!Vo())return null;var e=navigator.userAgent.match(/Version\/(\d+)/);return e||(e=navigator.userAgent.match(/OS (\d+)(?:_\d+)?/))?parseInt(e[1],10):null}function $e(e){return(navigator.userAgent||"").includes(e)}function Xf(){return bn||(Mu||(Mu=new we(function(){bn=null})),(bn=document.getElementsByTagName("video")[0]||document.getElementsByTagName("audio")[0])||(bn=document.createElement("video")),Mu.N(1),bn)}var Mu=null,bn=null;function Ur(){}function et(e){if(!e)return"";if(e=Ee(e),e[0]==239&&e[1]==187&&e[2]==191&&(e=e.subarray(3)),u.TextDecoder&&!Ss())return e=new TextDecoder().decode(e),e.includes("")&&Pr('Decoded string contains an "unknown character" codepoint.  That probably means the UTF8 encoding was incorrect!'),e;for(var i="",r=0;r<e.length;++r){var s=65533;if(e[r]&128?e.length>=r+2&&(e[r]&224)==192&&(e[r+1]&192)==128?(s=(e[r]&31)<<6|e[r+1]&63,r+=1):e.length>=r+3&&(e[r]&240)==224&&(e[r+1]&192)==128&&(e[r+2]&192)==128?(s=(e[r]&15)<<12|(e[r+1]&63)<<6|e[r+2]&63,r+=2):e.length>=r+4&&(e[r]&241)==240&&(e[r+1]&192)==128&&(e[r+2]&192)==128&&(e[r+3]&192)==128&&(s=(e[r]&7)<<18|(e[r+1]&63)<<12|(e[r+2]&63)<<6|e[r+3]&63,r+=3):s=e[r],65535>=s)i+=String.fromCharCode(s);else{s-=65536;var o=s&1023;i+=String.fromCharCode(55296+(s>>10)),i+=String.fromCharCode(56320+o)}}return i}function gr(e,i,r){if(!e)return"";if(!r&&e.byteLength%2!=0)throw new F(2,2,2004);r=Math.floor(e.byteLength/2);var s=new Uint16Array(r);e=Ot(e);for(var o=0;o<r;o++)s[o]=e.getUint16(2*o,i);return ku.value()(s)}function zr(e){function i(s){return r.byteLength<=s||32<=r[s]&&126>=r[s]}if(!e)return"";var r=Ee(e);if(r[0]==239&&r[1]==187&&r[2]==191)return et(r);if(r[0]==254&&r[1]==255)return gr(r.subarray(2),!1);if(r[0]==255&&r[1]==254)return gr(r.subarray(2),!0);if(r[0]==0&&r[2]==0)return gr(e,!1);if(r[1]==0&&r[3]==0)return gr(e,!0);if(i(0)&&i(1)&&i(2)&&i(3))return et(e);throw new F(2,2,2003)}function mr(e){if(u.TextEncoder&&!Ss()){var i=new TextEncoder;return Jt(i.encode(e))}e=encodeURIComponent(e),e=unescape(e),i=new Uint8Array(e.length);for(var r=0;r<e.length;r++)i[r]=e[r].charCodeAt(0);return Jt(i)}function Pu(e,i){for(var r=new ArrayBuffer(2*e.length),s=new DataView(r),o=0;o<e.length;++o)s.setUint16(2*o,e.charCodeAt(o),i);return r}te("shaka.util.StringUtils",Ur),Ur.resetFromCharCode=function(){ku.g=void 0},Ur.toUTF16=Pu,Ur.toUTF8=mr,Ur.fromBytesAutoDetect=zr,Ur.fromUTF16=gr,Ur.fromUTF8=et;var ku=new An(function(){function e(r){try{var s=new Uint8Array(r);return 0<String.fromCharCode.apply(null,s).length}catch(o){return!1}}for(var i={Ua:65536};0<i.Ua;i={Ua:i.Ua},i.Ua/=2)if(e(i.Ua))return function(r){return function(s){for(var o="",l=0;l<s.length;l+=r.Ua)o+=String.fromCharCode.apply(null,s.subarray(l,l+r.Ua));return o}}(i);return null});function _r(){}function qf(e){return e=Ee(e),e=ku.value()(e),btoa(e)}function Br(e,i){return i=i==null?!0:i,e=qf(e).replace(/\+/g,"-").replace(/\//g,"_"),i?e:e.replace(/[=]*$/,"")}function qi(e){e=u.atob(e.replace(/-/g,"+").replace(/_/g,"/"));for(var i=new Uint8Array(e.length),r=0;r<e.length;++r)i[r]=e.charCodeAt(r);return i}function ws(e){for(var i=e.length/2,r=new Uint8Array(i),s=0;s<i;s++)r[s]=u.parseInt(e.substr(2*s,2),16);return r}function As(e){var i=Ee(e);e="",i=v(i);for(var r=i.next();!r.done;r=i.next())r=r.value,r=r.toString(16),r.length==1&&(r="0"+r),e+=r;return e}function Es(){for(var e=Gi.apply(0,arguments),i=0,r=v(e),s=r.next();!s.done;s=r.next())i+=s.value.byteLength;for(i=new Uint8Array(i),r=0,e=v(e),s=e.next();!s.done;s=e.next())s=s.value,i.set(Ee(s),r),r+=s.byteLength;return i}te("shaka.util.Uint8ArrayUtils",_r),_r.concat=Es,_r.toHex=As,_r.fromHex=ws,_r.fromBase64=qi,_r.toBase64=Br,_r.toStandardBase64=qf;function Wo(){}te("shaka.dependencies",Wo),Wo.has=function(e){return Go.has(e)},Wo.add=function(e,i){if(!$f[e])throw Error(e+" is not supported");Go.set(e,function(){return i})};var $f={muxjs:"muxjs"};Wo.Allowed=$f;var Go=new Map([["muxjs",function(){return u.muxjs}]]);function Yf(e){var i=this;this.o=e,this.m=Go.get("muxjs")(),this.h=this.g=null,this.l=[],this.i=[],this.j=!1,this.m&&(this.g=new this.m.mp4.Transmuxer({keepOriginalTimestamps:!0}),this.g.on("data",function(r){i.i=r.captions,i.l.push(Es(r.initSegment,r.data))}),this.g.on("done",function(){var r={data:Es.apply(_r,O(i.l)),captions:i.i};i.h.resolve(r),i.j=!1}))}Yf.prototype.destroy=function(){return this.g&&this.g.dispose(),this.g=null,Promise.resolve()};function Du(e,i){var r=Kf(e),s=e.toLowerCase().split(";")[0]=="audio/aac";return!Go.get("muxjs")()||!r&&!s?!1:s?Qt('audio/mp4; codecs="mp4a.40.2"'):i?Qt(Xo(i,e)):(i=Xo("audio",e),e=Xo("video",e),Qt(i)||Qt(e))}function Kf(e){return e.toLowerCase().split(";")[0].split("/")[1]=="mp2t"}function Zf(e,i){return i.toLowerCase().split(";")[0]=="audio/aac"?'audio/mp4; codecs="mp4a.40.2"':Kf(i)?Xo(e,i):i}function Xo(e,i){if(i=i.replace(/mp2t/i,"mp4"),e=="audio"&&(i=i.replace("video","audio")),e=/avc1\.(66|77|100)\.(\d+)/.exec(i)){var r="avc1.",s=e[1],o=Number(e[2]);r=(s=="66"?r+"4200":s=="77"?r+"4d00":r+"6400")+(o>>4).toString(16),r+=(o&15).toString(16),i=i.replace(e[0],r)}return i}function wT(e,i){return e.j=!0,e.h=new Ve,e.l=[],e.i=[],i=Ee(i),e.g.push(i),e.g.flush(),e.j&&e.h.reject(new F(2,3,3018)),e.h}function Qf(){}function Pi(e,i){return i&&(e+='; codecs="'+i+'"'),e}function In(e,i,r){return i=Pi(e,i),Du(i,r)?Zf(r,i):e!="video/mp2t"&&r=="audio"?i.replace("video","audio"):i}function yr(e){var i=Cs(e);switch(e=i[0],i=i[1].toLowerCase(),!0){case(e==="mp4a"&&i==="69"):case(e==="mp4a"&&i==="6b"):return"mp3";case(e==="mp4a"&&i==="66"):case(e==="mp4a"&&i==="67"):case(e==="mp4a"&&i==="68"):case(e==="mp4a"&&i==="40.2"):case(e==="mp4a"&&i==="40.02"):case(e==="mp4a"&&i==="40.5"):case(e==="mp4a"&&i==="40.05"):case(e==="mp4a"&&i==="40.29"):case(e==="mp4a"&&i==="40.42"):return"aac";case(e==="mp4a"&&i==="a5"):return"ac-3";case(e==="mp4a"&&i==="a6"):return"ec-3";case(e==="mp4a"&&i==="b2"):return"dtsx";case(e==="mp4a"&&i==="a9"):return"dtsc";case e==="avc1":case e==="avc3":return"avc";case e==="hvc1":case e==="hev1":return"hevc";case e==="dvh1":case e==="dvhe":return"dovi"}return e}function Jf(e){return e=e.split(/ *; */),e.shift(),(e=e.find(function(i){return i.startsWith("codecs=")}))?e.split("=")[1].replace(/^"|"$/g,""):""}function Cs(e){e=e.split(".");var i=e[0];return e.shift(),[i,e.join(".")]}te("shaka.util.MimeUtils",Qf),Qf.getFullType=Pi,new Map().set("codecs","codecs").set("frameRate","framerate").set("bandwidth","bitrate").set("width","width").set("height","height").set("channelsCount","channels");function $i(e){this.j=null,this.i=e,this.u=!1,this.l=this.s=0,this.m=1/0,this.h=this.g=null,this.B="",this.o=new Map}function qo(e){return!!(ft[e]||e=="application/cea-608"||e=="application/cea-708")}$i.prototype.destroy=function(){return this.i=this.j=null,this.o.clear(),Promise.resolve()};function AT(e,i,r,s){var o,l,h,d;return z(function(g){if(g.g==1)return C(g,Promise.resolve(),2);if(!e.j||!e.i)return g.return();if(r==null||s==null)return e.j.parseInit(Ee(i)),g.return();o=e.u?r:e.s,l={periodStart:e.s,segmentStart:r,segmentEnd:s,vttOffset:o},h=e.j.parseMedia(Ee(i),l),d=h.filter(function(_){return _.startTime>=e.l&&_.startTime<e.m}),e.i.append(d),e.g==null&&(e.g=Math.max(r,e.l)),e.h=Math.min(s,e.m),K(g)})}$i.prototype.remove=function(e,i){var r=this;return z(function(s){if(s.g==1)return C(s,Promise.resolve(),2);!r.i||!r.i.remove(e,i)||r.g==null||i<=r.g||e>=r.h||(e<=r.g&&i>=r.h?r.g=r.h=null:e<=r.g&&i<r.h?r.g=i:e>r.g&&i>=r.h&&(r.h=e)),K(s)})};function ET(e,i,r){e.l=i,e.m=r}function ep(e,i,r){if(e.B=i,i=e.o.get(i))for(var s=v(i.keys()),o=s.next();!o.done;o=s.next())(o=i.get(o.value).filter(function(l){return l.endTime<=r}))&&e.i.append(o)}function CT(e){var i=[];e=v(e);for(var r=e.next();!r.done;r=e.next())r=r.value,i.push({stream:r.stream,cue:new Be(r.startTime,r.endTime,r.text)});return i}function tp(e,i,r){i.startTime+=r,i.endTime+=r,i=v(i.nestedCues);for(var s=i.next();!s.done;s=i.next())tp(e,s.value,r)}function ip(e,i,r,s,o){var l=r+" "+s,h=new Map;i=v(i);for(var d=i.next();!d.done;d=i.next()){var g=d.value;d=g.stream,g=g.cue,h.has(d)||h.set(d,new Map),h.get(d).has(l)||h.get(d).set(l,[]),tp(e,g,o),g.startTime>=e.l&&g.startTime<e.m&&(h.get(d).get(l).push(g),d==e.B&&e.i.append([g]))}for(o=v(h.keys()),l=o.next();!l.done;l=o.next())for(l=l.value,e.o.has(l)||e.o.set(l,new Map),i=v(h.get(l).keys()),d=i.next();!d.done;d=i.next())d=d.value,g=h.get(l).get(d),e.o.get(l).set(d,g);e.g=e.g==null?Math.max(r,e.l):Math.min(e.g,Math.max(r,e.l)),e.h=Math.max(e.h,Math.min(s,e.m))}te("shaka.text.TextEngine",$i),$i.prototype.destroy=$i.prototype.destroy,$i.findParser=function(e){return ft[e]},$i.unregisterParser=function(e){delete ft[e]},$i.registerParser=function(e,i){ft[e]=i};var ft={};function ei(){}function $o(e,i){return e=Me(e),i=Me(i),e.split("-")[0]==i.split("-")[0]}function bs(e,i){return e=Me(e),i=Me(i),e=e.split("-"),i=i.split("-"),e[0]==i[0]&&e.length==1&&i.length==2}function Ou(e,i){return e=Me(e),i=Me(i),e=e.split("-"),i=i.split("-"),e.length==2&&i.length==2&&e[0]==i[0]}function Me(e){var i=e.split("-");return e=i[0]||"",i=i[1]||"",e=e.toLowerCase(),e=rp.get(e)||e,(i=i.toUpperCase())?e+"-"+i:e}function jr(e,i){return e=Me(e),i=Me(i),i==e?4:bs(i,e)?3:Ou(i,e)?2:bs(e,i)?1:0}function Fu(e){var i=e.indexOf("-");return e=0<=i?e.substring(0,i):e,e=e.toLowerCase(),e=rp.get(e)||e}function Nu(e){return e.language?Me(e.language):e.audio&&e.audio.language?Me(e.audio.language):e.video&&e.video.language?Me(e.video.language):"und"}function Yo(e,i){e=Me(e);var r=new Set,s=v(i);for(i=s.next();!i.done;i=s.next())r.add(Me(i.value));for(s=v(r),i=s.next();!i.done;i=s.next())if(i=i.value,i==e)return i;for(s=v(r),i=s.next();!i.done;i=s.next())if(i=i.value,bs(i,e))return i;for(s=v(r),i=s.next();!i.done;i=s.next())if(i=i.value,Ou(i,e))return i;for(r=v(r),i=r.next();!i.done;i=r.next())if(i=i.value,bs(e,i))return i;return null}te("shaka.util.LanguageUtils",ei),ei.findClosestLocale=Yo,ei.getLocaleForVariant=Nu,ei.getLocaleForText=function(e){return Me(e.language||"und")},ei.getBase=Fu,ei.relatedness=jr,ei.areSiblings=function(e,i){var r=Fu(e),s=Fu(i);return e!=r&&i!=s&&r==s},ei.normalize=Me,ei.isSiblingOf=Ou,ei.isParentOf=bs,ei.areLanguageCompatible=$o,ei.areLocaleCompatible=function(e,i){return e=Me(e),i=Me(i),e==i};var rp=new Map([["aar","aa"],["abk","ab"],["afr","af"],["aka","ak"],["alb","sq"],["amh","am"],["ara","ar"],["arg","an"],["arm","hy"],["asm","as"],["ava","av"],["ave","ae"],["aym","ay"],["aze","az"],["bak","ba"],["bam","bm"],["baq","eu"],["bel","be"],["ben","bn"],["bih","bh"],["bis","bi"],["bod","bo"],["bos","bs"],["bre","br"],["bul","bg"],["bur","my"],["cat","ca"],["ces","cs"],["cha","ch"],["che","ce"],["chi","zh"],["chu","cu"],["chv","cv"],["cor","kw"],["cos","co"],["cre","cr"],["cym","cy"],["cze","cs"],["dan","da"],["deu","de"],["div","dv"],["dut","nl"],["dzo","dz"],["ell","el"],["eng","en"],["epo","eo"],["est","et"],["eus","eu"],["ewe","ee"],["fao","fo"],["fas","fa"],["fij","fj"],["fin","fi"],["fra","fr"],["fre","fr"],["fry","fy"],["ful","ff"],["geo","ka"],["ger","de"],["gla","gd"],["gle","ga"],["glg","gl"],["glv","gv"],["gre","el"],["grn","gn"],["guj","gu"],["hat","ht"],["hau","ha"],["heb","he"],["her","hz"],["hin","hi"],["hmo","ho"],["hrv","hr"],["hun","hu"],["hye","hy"],["ibo","ig"],["ice","is"],["ido","io"],["iii","ii"],["iku","iu"],["ile","ie"],["ina","ia"],["ind","id"],["ipk","ik"],["isl","is"],["ita","it"],["jav","jv"],["jpn","ja"],["kal","kl"],["kan","kn"],["kas","ks"],["kat","ka"],["kau","kr"],["kaz","kk"],["khm","km"],["kik","ki"],["kin","rw"],["kir","ky"],["kom","kv"],["kon","kg"],["kor","ko"],["kua","kj"],["kur","ku"],["lao","lo"],["lat","la"],["lav","lv"],["lim","li"],["lin","ln"],["lit","lt"],["ltz","lb"],["lub","lu"],["lug","lg"],["mac","mk"],["mah","mh"],["mal","ml"],["mao","mi"],["mar","mr"],["may","ms"],["mkd","mk"],["mlg","mg"],["mlt","mt"],["mon","mn"],["mri","mi"],["msa","ms"],["mya","my"],["nau","na"],["nav","nv"],["nbl","nr"],["nde","nd"],["ndo","ng"],["nep","ne"],["nld","nl"],["nno","nn"],["nob","nb"],["nor","no"],["nya","ny"],["oci","oc"],["oji","oj"],["ori","or"],["orm","om"],["oss","os"],["pan","pa"],["per","fa"],["pli","pi"],["pol","pl"],["por","pt"],["pus","ps"],["que","qu"],["roh","rm"],["ron","ro"],["rum","ro"],["run","rn"],["rus","ru"],["sag","sg"],["san","sa"],["sin","si"],["slk","sk"],["slo","sk"],["slv","sl"],["sme","se"],["smo","sm"],["sna","sn"],["snd","sd"],["som","so"],["sot","st"],["spa","es"],["sqi","sq"],["srd","sc"],["srp","sr"],["ssw","ss"],["sun","su"],["swa","sw"],["swe","sv"],["tah","ty"],["tam","ta"],["tat","tt"],["tel","te"],["tgk","tg"],["tgl","tl"],["tha","th"],["tib","bo"],["tir","ti"],["ton","to"],["tsn","tn"],["tso","ts"],["tuk","tk"],["tur","tr"],["twi","tw"],["uig","ug"],["ukr","uk"],["urd","ur"],["uzb","uz"],["ven","ve"],["vie","vi"],["vol","vo"],["wel","cy"],["wln","wa"],["wol","wo"],["xho","xh"],["yid","yi"],["yor","yo"],["zha","za"],["zho","zh"],["zul","zu"]]);function Rn(){this.g={}}p=Rn.prototype,p.push=function(e,i){this.g.hasOwnProperty(e)?this.g[e].push(i):this.g[e]=[i]},p.get=function(e){return(e=this.g[e])?e.slice():null},p.remove=function(e,i){e in this.g&&(this.g[e]=this.g[e].filter(function(r){return r!=i}),this.g[e].length==0&&delete this.g[e])},p.forEach=function(e){for(var i in this.g)e(i,this.g[i])},p.size=function(){return Object.keys(this.g).length},p.keys=function(){return Object.keys(this.g)};function np(e,i,r,s,o){var l=e.variants;(i.length||r.length)&&(l=RT(l,i,r)),l=dp(l,s),i=bT(l),i=IT(i);var h=LT(i,o);e.variants=e.variants.filter(function(d){return sp(d)==h})}function bT(e){var i=new Rn;e=v(e);for(var r=e.next();!r.done;r=e.next()){r=r.value;var s=sp(r);i.push(s,r)}return i}function IT(e){var i=0,r=new Map,s=e.size();return e.forEach(function(o,l){l=v(l);for(var h=l.next();!h.done;h=l.next()){h=h.value;var d=h.video;if(d&&d.width&&d.height){d=d.width*d.height*(d.frameRate||1),r.has(d)||r.set(d,new Rn);var g=r.get(d);g.push(o,h),g.size()===s&&(i=Math.max(i,d))}}}),i?r.get(i):e}function RT(e,i,r){var s={};i=v(i);for(var o=i.next();!o.done;s={xd:s.xd},o=i.next())if(s.xd=o.value,o=e.filter(function(l){return function(h){return h.video&&h.video.codecs.startsWith(l.xd)}}(s)),o.length){e=o;break}for(s={},r=v(r),i=r.next();!i.done;s={jd:s.jd},i=r.next())if(s.jd=i.value,i=e.filter(function(l){return function(h){return h.audio&&h.audio.codecs.startsWith(l.jd)}}(s)),i.length){e=i;break}return e}function LT(e,i){i=v(i);for(var r=i.next();!r.done;r=i.next())if(r=r.value,r==jT||r==HT){if(e=MT(e,r),e.size()==1)return e.keys()[0]}else if(r==VT)break;return PT(e)}function MT(e,i){var r=0,s=new Rn;return e.forEach(function(o,l){for(var h=0,d=0,g=v(l),_=g.next();!_.done;_=g.next())_=_.value,_.decodingInfos.length&&(h+=_.decodingInfos[0][i]?1:0,d++);h/=d,h>r?(s.g={},s.push(o,l),r=h):h==r&&s.push(o,l)}),s}function PT(e){var i="",r=1/0;return e.forEach(function(s,o){var l=0,h=0;o=v(o);for(var d=o.next();!d.done;d=o.next())l+=d.value.bandwidth||0,++h;l/=h,l<r&&(i=s,r=l)}),i}function sp(e){var i="";e.video&&(i=yr(e.video.codecs));var r="";return e.audio&&(r=yr(e.audio.codecs)),i+"-"+r}function kT(e,i,r){e.variants=e.variants.filter(function(s){return Uu(s,i,r)})}function Uu(e,i,r){function s(l,h,d){return l>=h&&l<=d}var o=e.video;if(e.disabledUntilTime!=0){if(e.disabledUntilTime>Date.now()/1e3)return!1;e.disabledUntilTime=0}return!(o&&o.width&&o.height&&(!s(o.width,i.minWidth,Math.min(i.maxWidth,r.width))||!s(o.height,i.minHeight,Math.min(i.maxHeight,r.height))||!s(o.width*o.height,i.minPixels,i.maxPixels))||e&&e.video&&e.video.frameRate&&!s(e.video.frameRate,i.minFrameRate,i.maxFrameRate)||!s(e.bandwidth,i.minBandwidth,i.maxBandwidth))}function zu(e,i,r){var s=!1;e=v(e);for(var o=e.next();!o.done;o=e.next()){o=o.value;var l=o.allowedByApplication;o.allowedByApplication=Uu(o,i,r),l!=o.allowedByApplication&&(s=!0)}return s}function DT(e,i){return z(function(r){return r.g==1?C(r,op(i,0<i.offlineSessionIds.length),2):(lp(e,i),FT(i),C(r,NT(i),0))})}function op(e,i){return z(function(r){if(r.g==1)return C(r,ap(e.variants,i,!1),2);e.variants=e.variants.filter(function(s){var o=s.video;if(o){var l=Ko(o.codecs);if(o.codecs.includes(",")){var h=o.codecs.split(",");l=xs("video",h),l=Ko(l),h=xs("audio",h),h=Bu(h);var d=In(o.mimeType,h,"audio");if(!Qt(d))return!1;l=[l,h].join()}if(h=In(o.mimeType,l,"video"),!Qt(h))return!1;o.codecs=l}if(l=s.audio){if(h=Bu(l.codecs),d=In(l.mimeType,h,"audio"),!Qt(d))return!1;l.codecs=h}return Ts()&&o&&(o.width&&1920<o.width||o.height&&1080<o.height)&&(o.codecs.includes("avc1.")||o.codecs.includes("avc3."))?(pp(s),!1):((o=s.decodingInfos.some(function(g){return g.supported}))||(pp(s),void 0),o)}),K(r)})}function ap(e,i,r){var s,o,l,h,d,g,_,y,S,w;return z(function(E){if(e.some(function(R){return R.decodingInfos.length}))return E.return();for(s=navigator.mediaCapabilities,o=[],l=function(R,P){var L;return z(function(M){if(M.g==1)return de(M,2),C(M,s.decodingInfo(P),4);if(M.g!=2)return L=M.h,R.decodingInfos.push(L),Ae(M,0);oe(M),JSON.stringify(P),K(M)})},h=v(e),d=h.next();!d.done;d=h.next())for(g=d.value,_=OT(g,i,r),y=v(_),S=y.next();!S.done;S=y.next())w=S.value,o.push(l(g,w));return C(E,Promise.all(o),0)})}function OT(e,i,r){var s=e.audio,o=e.video;if(r={type:r?"file":"media-source"},o){var l=o.codecs;if(o.codecs.includes(",")){var h=o.codecs.split(",");l=xs("video",h),l=Ko(l),h=xs("audio",h),h=In(o.mimeType,h,"audio"),r.audio={contentType:h,channels:2,bitrate:e.bandwidth||1,samplerate:1,spatialRendering:!1}}if(l=Ko(l),l=In(o.mimeType,l,"video"),r.video={contentType:l,width:o.width||64,height:o.height||64,bitrate:o.bandwidth||e.bandwidth||1,framerate:o.frameRate||1},o.hdr)switch(o.hdr){case"SDR":r.video.transferFunction="srgb";break;case"PQ":r.video.transferFunction="pq";break;case"HLG":r.video.transferFunction="hlg"}}if(s&&(l=Bu(s.codecs),l=In(s.mimeType,l,"audio"),r.audio={contentType:l,channels:s.channelsCount||2,bitrate:s.bandwidth||e.bandwidth||1,samplerate:s.audioSamplingRate||1,spatialRendering:s.spatialAudio}),h=(e.video?e.video.drmInfos:[]).concat(e.audio?e.audio.drmInfos:[]),!h.length)return[r];e=[],l=new Map,h=v(h);for(var d=h.next();!d.done;d=h.next()){var g=d.value;l.get(g.keySystem)||l.set(g.keySystem,[]),l.get(g.keySystem).push(g)}h=i?"required":"optional",i=i?["persistent-license"]:["temporary"],g=v(l.keys());for(var _=g.next();!_.done;_=g.next()){var y=_.value;_=Object.assign({},r);var S=l.get(y);for(y={keySystem:y,initDataType:"cenc",persistentState:h,distinctiveIdentifier:"optional",sessionTypes:i},S=v(S),d=S.next();!d.done;d=S.next()){if(d=d.value,d.initData&&d.initData.length){for(var w=new Set,E=v(d.initData),R=E.next();!R.done;R=E.next())w.add(R.value.initDataType);y.initDataType=d.initData[0].initDataType}d.distinctiveIdentifierRequired&&(y.distinctiveIdentifier="required"),d.persistentStateRequired&&(y.persistentState="required"),d.sessionType&&(y.sessionTypes=[d.sessionType]),s&&(d.audioRobustness!=""?y.audio?y.audio.robustness=y.audio.robustness||d.audioRobustness:y.audio={robustness:d.audioRobustness}:y.audio||(y.audio={})),o&&(d.videoRobustness!=""?y.video?y.video.robustness=y.video.robustness||d.videoRobustness:y.video={robustness:d.videoRobustness}:y.video||(y.video={}))}_.keySystemConfiguration=y,e.push(_)}return e}function Bu(e){return Cn()&&e.toLowerCase()=="ac-3"?"ec-3":e}function Ko(e){if(e.includes("avc1")){var i=e.split(".");if(i.length==3)return e=i.shift()+".",e+=parseInt(i.shift(),10).toString(16),e+=("000"+parseInt(i.shift(),10).toString(16)).slice(-4)}else if(e=="vp9")return"vp09.00.41.08";return e}function lp(e,i){i.variants=i.variants.filter(function(r){var s=r.audio;return r=r.video,!(s&&e&&e.audio&&!up(s,e.audio)||r&&e&&e.video&&!up(r,e.video))})}function FT(e){e.textStreams=e.textStreams.filter(function(i){return qo(Pi(i.mimeType,i.codecs))})}function NT(e){var i,r,s,o,l,h,d;return z(function(g){switch(g.g){case 1:i=[],r=v(e.imageStreams),s=r.next();case 2:if(s.done){g.A(4);break}if(o=s.value,l=o.mimeType,Jo.has(l)){g.A(5);break}if(h=WT.get(l),!h){Jo.set(l,!1),g.A(5);break}return C(g,UT(h),7);case 7:d=g.h,Jo.set(l,d);case 5:Jo.get(l)&&i.push(o),s=r.next(),g.A(2);break;case 4:e.imageStreams=i,K(g)}})}function UT(e){return new Promise(function(i){var r=new Image;r.src=e,"decode"in r?r.decode().then(function(){i(!0)}).catch(function(){i(!1)}):r.onload=r.onerror=function(){i(r.height===2)}})}function up(e,i){return!(e.mimeType!=i.mimeType||e.codecs.split(".")[0]!=i.codecs.split(".")[0])}function Hr(e){var i=e.audio,r=e.video,s=i?i.mimeType:null,o=r?r.mimeType:null,l=i?i.codecs:null,h=r?r.codecs:null,d=[];h&&d.push(h),l&&d.push(l);var g=[];r&&g.push(r.mimeType),i&&g.push(i.mimeType),g=g[0]||null;var _=[];i&&_.push(i.kind),r&&_.push(r.kind),_=_[0]||null;var y=new Set;if(i)for(var S=v(i.roles),w=S.next();!w.done;w=S.next())y.add(w.value);if(r)for(S=v(r.roles),w=S.next();!w.done;w=S.next())y.add(w.value);return e={id:e.id,active:!1,type:"variant",bandwidth:e.bandwidth,language:e.language,label:null,kind:_,width:null,height:null,frameRate:null,pixelAspectRatio:null,hdr:null,mimeType:g,audioMimeType:s,videoMimeType:o,codecs:d.join(", "),audioCodec:l,videoCodec:h,primary:e.primary,roles:Array.from(y),audioRoles:null,forced:!1,videoId:null,audioId:null,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,tilesLayout:null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:null,originalImageId:null},r&&(e.videoId=r.id,e.originalVideoId=r.originalId,e.width=r.width||null,e.height=r.height||null,e.frameRate=r.frameRate||null,e.pixelAspectRatio=r.pixelAspectRatio||null,e.videoBandwidth=r.bandwidth||null),i&&(e.audioId=i.id,e.originalAudioId=i.originalId,e.channelsCount=i.channelsCount,e.audioSamplingRate=i.audioSamplingRate,e.audioBandwidth=i.bandwidth||null,e.spatialAudio=i.spatialAudio,e.label=i.label,e.audioRoles=i.roles),e}function Zo(e){return{id:e.id,active:!1,type:De,bandwidth:0,language:e.language,label:e.label,kind:e.kind||null,width:null,height:null,frameRate:null,pixelAspectRatio:null,hdr:null,mimeType:e.mimeType,audioMimeType:null,videoMimeType:null,codecs:e.codecs||null,audioCodec:null,videoCodec:null,primary:e.primary,roles:e.roles,audioRoles:null,forced:e.forced,videoId:null,audioId:null,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,tilesLayout:null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:e.originalId,originalImageId:null}}function ju(e){var i=e.width||null,r=e.height||null,s=null;e.segmentIndex&&(s=e.segmentIndex.get(0));var o=e.tilesLayout;return s&&(o=s.tilesLayout||o),o&&i!=null&&(i/=Number(o.split("x")[0])),o&&r!=null&&(r/=Number(o.split("x")[1])),{id:e.id,active:!1,type:"image",bandwidth:e.bandwidth||0,language:"",label:null,kind:null,width:i,height:r,frameRate:null,pixelAspectRatio:null,hdr:null,mimeType:e.mimeType,audioMimeType:null,videoMimeType:null,codecs:null,audioCodec:null,videoCodec:null,primary:!1,roles:[],audioRoles:null,forced:!1,videoId:null,audioId:null,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,tilesLayout:o||null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:null,originalImageId:e.originalId}}function Hu(e){return e.__shaka_id||(e.__shaka_id=BT++),e.__shaka_id}function hp(e){var i=cp(e);return i.active=e.mode!="disabled",i.type="text",i.originalTextId=e.id,e.kind=="captions"&&(i.mimeType="application/cea-608"),e.kind&&(i.roles=[e.kind]),e.kind=="forced"&&(i.forced=!0),i}function Qo(e){var i=cp(e);return i.active=e.enabled,i.type="variant",i.originalAudioId=e.id,e.kind=="main"&&(i.primary=!0),e.kind&&(i.roles=[e.kind],i.audioRoles=[e.kind],i.label=e.label),i}function cp(e){return{id:Hu(e),active:!1,type:"",bandwidth:0,language:Me(e.language),label:e.label,kind:e.kind,width:null,height:null,frameRate:null,pixelAspectRatio:null,hdr:null,mimeType:null,audioMimeType:null,videoMimeType:null,codecs:null,audioCodec:null,videoCodec:null,primary:!1,roles:[],forced:!1,audioRoles:null,videoId:null,audioId:null,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,tilesLayout:null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:null,originalImageId:null}}function Is(e){return e.allowedByApplication&&e.allowedByKeySystem}function zT(e){return e.filter(function(i){return Is(i)})}function dp(e,i){var r=e.filter(function(h){return h.audio&&h.audio.channelsCount}),s=new Map;r=v(r);for(var o=r.next();!o.done;o=r.next()){o=o.value;var l=o.audio.channelsCount;s.has(l)||s.set(l,[]),s.get(l).push(o)}return r=Array.from(s.keys()),r.length==0?e:(e=r.filter(function(h){return h<=i}),e.length?s.get(Math.max.apply(Math,O(e))):s.get(Math.min.apply(Math,O(r))))}function Vu(e,i,r,s){var o=e,l=e.filter(function(g){return g.primary});l.length&&(o=l);var h=o.length?o[0].language:"";if(o=o.filter(function(g){return g.language==h}),i){var d=Yo(Me(i),e.map(function(g){return g.language}));d&&(o=e.filter(function(g){return Me(g.language)==d}))}if(o=o.filter(function(g){return g.forced==s}),r){if(e=fp(o,r),e.length)return e}else if(e=o.filter(function(g){return g.roles.length==0}),e.length)return e;return e=o.map(function(g){return g.roles}).reduce(Iu,[]),e.length?fp(o,e[0]):o}function fp(e,i){return e.filter(function(r){return r.roles.includes(i)})}function pp(e){var i=[];return e.audio&&i.push(gp(e.audio)),e.video&&i.push(gp(e.video)),i.join(", ")}function gp(e){return e.type=="audio"?"type=audio codecs="+e.codecs+" bandwidth="+e.bandwidth+" channelsCount="+e.channelsCount+" audioSamplingRate="+e.audioSamplingRate:e.type=="video"?"type=video codecs="+e.codecs+" bandwidth="+e.bandwidth+" frameRate="+e.frameRate+" width="+e.width+" height="+e.height:"unexpected stream type"}var BT=0,jT="smooth",HT="powerEfficient",VT="bandwidth",Jo=new Map().set("image/svg+xml",!0).set("image/png",!0).set("image/jpeg",!0).set("image/jpg",!0),WT=new Map().set("image/webp","data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA").set("image/avif","data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=");function tt(){var e=this;this.l=null,this.o=!1,this.i=new ds,navigator.connection&&navigator.connection.addEventListener("change",function(){if(e.g.useNetworkInformation&&e.o){e.i=new ds,e.g&&e.i.configure(e.g.advanced);var i=e.chooseVariant();i&&e.l(i)}}),this.m=[],this.u=1,this.B=!1,this.h=this.j=this.g=this.s=null,this.D=new we(function(){if(e.g.restrictToElementSize){var i=e.chooseVariant();i&&e.l(i)}})}p=tt.prototype,p.stop=function(){this.l=null,this.o=!1,this.m=[],this.u=1,this.j=this.s=null,this.h&&(this.h.disconnect(),this.h=null),this.D.stop()},p.init=function(e){this.l=e},p.chooseVariant=function(){var e=1/0,i=1/0;this.g.restrictToScreenSize&&(i=this.g.ignoreDevicePixelRatio?1:u.devicePixelRatio,e=u.screen.height*i,i*=u.screen.width),this.h&&this.g.restrictToElementSize&&(i=this.g.ignoreDevicePixelRatio?1:u.devicePixelRatio,e=this.j.clientWidth*i,i*=this.j.clientHeight),e=mp(this.g.restrictions,this.m,e,i),i=this.i.getBandwidthEstimate(Wu(this)),this.m.length&&!e.length&&(e=mp(null,this.m,1/0,1/0),e=[e[0]]);for(var r=e[0]||null,s=0;s<e.length;s++){for(var o=e[s],l=isNaN(this.u)?1:Math.abs(this.u),h=l*o.bandwidth/this.g.bandwidthDowngradeTarget,d={bandwidth:1/0},g=s+1;g<e.length;g++)if(o.bandwidth!=e[g].bandwidth){d=e[g];break}l=l*d.bandwidth/this.g.bandwidthUpgradeTarget,i>=h&&i<=l&&r.bandwidth!=o.bandwidth&&(r=o)}return this.s=Date.now(),r},p.enable=function(){this.o=!0},p.disable=function(){this.o=!1},p.segmentDownloaded=function(e,i){if(this.i.sample(e,i),this.s!=null&&this.o)e:{if(this.B){if(Date.now()-this.s<1e3*this.g.switchInterval)break e}else{if(e=this.i,!(e.g>=e.i))break e;this.B=!0}e=this.chooseVariant(),this.i.getBandwidthEstimate(Wu(this)),e&&this.l(e)}},p.getBandwidthEstimate=function(){return this.i.getBandwidthEstimate(Wu(this))},p.setVariants=function(e){this.m=e},p.playbackRateChanged=function(e){this.u=e},p.setMediaElement=function(e){var i=this;this.j=e,this.h&&(this.h.disconnect(),this.h=null),this.j&&"ResizeObserver"in u&&(this.h=new ResizeObserver(function(){i.D.N(GT)}),this.h.observe(this.j))},p.configure=function(e){this.g=e,this.i&&this.g&&this.i.configure(this.g.advanced)};function Wu(e){var i=e.g.defaultBandwidthEstimate;return navigator.connection&&navigator.connection.downlink&&e.g.useNetworkInformation&&(i=1e6*navigator.connection.downlink),i}function mp(e,i,r,s){return e&&(i=i.filter(function(o){return Uu(o,e,{width:s,height:r})})),i.sort(function(o,l){return o.bandwidth-l.bandwidth})}te("shaka.abr.SimpleAbrManager",tt),tt.prototype.configure=tt.prototype.configure,tt.prototype.setMediaElement=tt.prototype.setMediaElement,tt.prototype.playbackRateChanged=tt.prototype.playbackRateChanged,tt.prototype.setVariants=tt.prototype.setVariants,tt.prototype.getBandwidthEstimate=tt.prototype.getBandwidthEstimate,tt.prototype.segmentDownloaded=tt.prototype.segmentDownloaded,tt.prototype.disable=tt.prototype.disable,tt.prototype.enable=tt.prototype.enable,tt.prototype.chooseVariant=tt.prototype.chooseVariant,tt.prototype.init=tt.prototype.init,tt.prototype.stop=tt.prototype.stop;var GT=1;function Gu(e,i){this.g=e,this.h=i}Gu.prototype.toString=function(){return"v"+this.g+"."+this.h};function _p(e,i){var r=new Gu(5,0),s=yp,o=s.g,l=r.h-o.h;(0<(r.g-o.g||l)?s.i:s.h)(s.g,r,e,i)}function XT(e,i,r,s){qe([r,"has been deprecated and will be removed in",i,". We are currently at version",e,". Additional information:",s].join(" "))}function qT(e,i,r,s){Pr([r,"has been deprecated and has been removed in",i,". We are now at version",e,". Additional information:",s].join(""))}var yp=null;te("shaka.config.AutoShowText",{NEVER:0,ALWAYS:1,IF_PREFERRED_TEXT_LANGUAGE:2,IF_SUBTITLES_MAY_BE_NEEDED:3});function ea(e,i){for(this.h=e,this.g=new Set([e]),i=i||[],e=v(i),i=e.next();!i.done;i=e.next())this.add(i.value)}ea.prototype.add=function(e){return Xu(this.h,e)?(this.g.add(e),!0):!1};function Xu(e,i){var r;if(!(r=!!e.audio!=!!i.audio||!!e.video!=!!i.video||e.language!=i.language)&&(r=e.audio&&i.audio)){r=e.audio;var s=i.audio;r=!((!(!r.channelsCount||!s.channelsCount||2<r.channelsCount||2<s.channelsCount)||r.channelsCount==s.channelsCount)&&xp(r,s)&&vp(r.roles,s.roles))}return!r&&(r=e.video&&i.video)&&(e=e.video,i=i.video,r=!(xp(e,i)&&vp(e.roles,i.roles))),!r}ea.prototype.values=function(){return this.g.values()};function xp(e,i){if(e.mimeType!=i.mimeType||(e=e.codecs.split(",").map(function(s){return Cs(s)[0]}),i=i.codecs.split(",").map(function(s){return Cs(s)[0]}),e.length!=i.length))return!1;e.sort(),i.sort();for(var r=0;r<e.length;r++)if(e[r]!=i[r])return!1;return!0}function vp(e,i){if(e=new Set(e),i=new Set(i),e.delete("main"),i.delete("main"),e.size!=i.size)return!1;e=v(e);for(var r=e.next();!r.done;r=e.next())if(!i.has(r.value))return!1;return!0}function Tp(e){this.g=e,this.h=new Ln(e.language,"",e.audio&&e.audio.channelsCount?e.audio.channelsCount:0,"")}Tp.prototype.create=function(e){var i=this,r=e.filter(function(s){return Xu(i.g,s)});return r.length?new ea(r[0],r):this.h.create(e)};function Ln(e,i,r,s){this.i=e,this.j=i,this.g=r,this.h=s===void 0?"":s}Ln.prototype.create=function(e){var i=[];i=$T(e,this.i);var r=e.filter(function(s){return s.primary});for(i=i.length?i:r.length?r:e,e=YT(i,this.j),e.length&&(i=e),this.g&&(e=dp(i,this.g),e.length&&(i=e)),this.h&&(e=KT(i,this.h),e.length&&(i=e)),e=new ea(i[0]),i=v(i),r=i.next();!r.done;r=i.next())r=r.value,Xu(e.h,r)&&e.add(r);return e};function $T(e,i){i=Me(i);var r=Yo(i,e.map(function(s){return Nu(s)}));return r?e.filter(function(s){return r==Nu(s)}):[]}function YT(e,i){return e.filter(function(r){return r.audio?i?r.audio.roles.includes(i):r.audio.roles.length==0:!1})}function KT(e,i){return e.filter(function(r){return r.audio?r.audio.label.toLowerCase()==i.toLowerCase():!1})}function ZT(){this.g=ta,this.h=new Map().set(ta,2).set(Mn,1)}function Sp(e,i,r){e.h.set(ta,r).set(Mn,i)}var Mn=0,ta=1;function wp(e,i){var r=Pn();this.l=e.maxAttempts==null?r.maxAttempts:e.maxAttempts,this.j=e.baseDelay==null?r.baseDelay:e.baseDelay,this.o=e.fuzzFactor==null?r.fuzzFactor:e.fuzzFactor,this.m=e.backoffFactor==null?r.backoffFactor:e.backoffFactor,this.g=0,this.h=this.j,(this.i=i===void 0?!1:i)&&(this.g=1)}function Ap(e){var i,r;return z(function(s){if(s.g==1){if(e.g>=e.l)if(e.i)e.g=1,e.h=e.j;else throw new F(2,7,1010);return i=e.g,e.g++,i==0?s.return():(r=e.h*(1+(2*Math.random()-1)*e.o),C(s,new Promise(function(o){new we(o).N(r/1e3)}),2))}e.h*=e.m,K(s)})}function Pn(){return{maxAttempts:2,baseDelay:1e3,backoffFactor:2,fuzzFactor:.5,timeout:3e4,stallTimeout:5e3,connectionTimeout:1e4}}function Ye(e,i){this.promise=e,this.i=i,this.g=!1}function Vr(e){return new Ye(Promise.reject(e),function(){return Promise.resolve()})}function qu(){var e=Promise.reject(new F(2,7,7001));return e.catch(function(){}),new Ye(e,function(){return Promise.resolve()})}function kn(e){return new Ye(Promise.resolve(e),function(){return Promise.resolve()})}function ki(e){return new Ye(e,function(){return e.catch(function(){})})}Ye.prototype.abort=function(){return this.g=!0,this.i()};function Ep(e){return new Ye(Promise.all(e.map(function(i){return i.promise})),function(){return Promise.all(e.map(function(i){return i.abort()}))})}Ye.prototype.finally=function(e){return this.promise.then(function(){return e(!0)},function(){return e(!1)}),this},Ye.prototype.Y=function(e,i){function r(d){return function(g){if(o.g&&d)l.reject(h);else{var _=d?e:i;_?s=QT(_,g,l):(d?l.resolve:l.reject)(g)}}}function s(){return l.reject(h),o.abort()}var o=this,l=new Ve,h=new F(2,7,7001);return this.promise.then(r(!0),r(!1)),new Ye(l,function(){return s()})};function QT(e,i,r){try{var s=e(i);return s&&s.promise&&s.abort?(r.resolve(s.promise),function(){return s.abort()}):(r.resolve(s),function(){return Promise.resolve(s).then(function(){},function(){})})}catch(o){return r.reject(o),function(){return Promise.resolve()}}}te("shaka.util.AbortableOperation",Ye),Ye.prototype.chain=Ye.prototype.Y,Ye.prototype.finally=Ye.prototype.finally,Ye.all=Ep,Ye.prototype.abort=Ye.prototype.abort,Ye.notAbortable=ki,Ye.completed=kn,Ye.aborted=qu,Ye.failed=Vr;function fe(e,i){if(i)if(i instanceof Map)for(var r=v(i.keys()),s=r.next();!s.done;s=r.next())s=s.value,Object.defineProperty(this,s,{value:i.get(s),writable:!0,enumerable:!0});else for(r in i)Object.defineProperty(this,r,{value:i[r],writable:!0,enumerable:!0});this.defaultPrevented=this.cancelable=this.bubbles=!1,this.timeStamp=u.performance&&u.performance.now?u.performance.now():Date.now(),this.type=e,this.isTrusted=!1,this.target=this.currentTarget=null,this.g=!1}function Cp(e){var i=new fe(e.type),r;for(r in e)Object.defineProperty(i,r,{value:e[r],writable:!0,enumerable:!0});return i}fe.prototype.preventDefault=function(){this.cancelable&&(this.defaultPrevented=!0)},fe.prototype.stopImmediatePropagation=function(){this.g=!0},fe.prototype.stopPropagation=function(){},te("shaka.util.FakeEvent",fe);var ia={Ig:"abrstatuschanged",Jg:"adaptation",Kg:"buffering",Lg:"downloadfailed",Mg:"downloadheadersreceived",Ng:"drmsessionupdate",Pg:"emsg",ah:"prft",Error:"error",Qg:"expirationupdated",Rg:"gapjumped",Tg:"loaded",Ug:"loading",Wg:"manifestparsed",Xg:"mediaqualitychanged",Metadata:"metadata",Zg:"onstatechange",$g:"onstateidle",bh:"ratechange",eh:"segmentappended",fh:"sessiondata",gh:"stalldetected",hh:"streaming",ih:"textchanged",jh:"texttrackvisibility",kh:"timelineregionadded",lh:"timelineregionenter",mh:"timelineregionexit",nh:"trackschanged",ph:"unloading",qh:"variantchanged"};function Le(){this.da=new Rn,this.Wc=this}Le.prototype.addEventListener=function(e,i){this.da&&this.da.push(e,i)},Le.prototype.removeEventListener=function(e,i){this.da&&this.da.remove(e,i)},Le.prototype.dispatchEvent=function(e){if(!this.da)return!0;var i=this.da.get(e.type)||[],r=this.da.get("All");for(r&&(i=i.concat(r)),i=v(i),r=i.next();!r.done;r=i.next()){r=r.value,e.target=this.Wc,e.currentTarget=this.Wc;try{r.handleEvent?r.handleEvent(e):r.call(this,e)}catch(s){}if(e.g)break}return e.defaultPrevented},Le.prototype.release=function(){this.da=null};function Dn(e){function i(s){switch(typeof s){case"undefined":case"boolean":case"number":case"string":case"symbol":case"function":return s;default:if(!s||s.buffer&&s.buffer.constructor==ArrayBuffer)return s;if(r.has(s))return null;var o=s.constructor==Array;if(s.constructor!=Object&&!o)return null;r.add(s);var l=o?[]:{},h;for(h in s)l[h]=i(s[h]);return o&&(l.length=s.length),l}}var r=new Set;return i(e)}function bp(e){var i={},r;for(r in e)i[r]=e[r];return i}function ra(){this.g=[]}function On(e,i){e.g.push(i.finally(function(){yi(e.g,i)}))}ra.prototype.destroy=function(){for(var e=[],i=v(this.g),r=i.next();!r.done;r=i.next())r=r.value,r.promise.catch(function(){}),e.push(r.abort());return this.g=[],Promise.all(e)};function Ne(e,i,r){Le.call(this),this.i=!1,this.m=new ra,this.g=new Set,this.h=new Set,this.l=e||null,this.j=i||null,this.s=r||null,this.o=!1}me(Ne,Le),p=Ne.prototype,p.je=function(e){this.o=e};function Yi(e,i,r,s){r=r||Lp;var o=sa[e];(!o||r>=o.priority)&&(sa[e]={priority:r,jg:i,kg:s===void 0?!1:s})}p.lg=function(e){this.g.add(e)},p.Bg=function(e){this.g.delete(e)},p.rf=function(){this.g.clear()},p.mg=function(e){this.h.add(e)},p.Cg=function(e){this.h.delete(e)},p.tf=function(){this.h.clear()};function ti(e,i,r){return{uris:e,method:"GET",body:null,headers:{},allowCrossSiteCredentials:!1,retryParameters:i,licenseRequestType:null,sessionId:null,drmInfo:null,initData:null,initDataType:null,streamDataCallback:r===void 0?null:r}}p.destroy=function(){return this.i=!0,this.g.clear(),this.h.clear(),Le.prototype.release.call(this),this.m.destroy()},p.request=function(e,i){var r=this,s=new Rp;if(this.i){var o=Promise.reject(new F(2,7,7001));return o.catch(function(){}),new na(o,function(){return Promise.resolve()},s)}i.method=i.method||"GET",i.headers=i.headers||{},i.retryParameters=i.retryParameters?Dn(i.retryParameters):Pn(),i.uris=Dn(i.uris),o=JT(this,e,i);var l=o.Y(function(){return Ip(r,e,i,new wp(i.retryParameters,!1),0,null,s)}),h=l.Y(function(S){return eS(r,e,S)}),d=Date.now(),g=0;o.promise.then(function(){g=Date.now()-d},function(){});var _=0;l.promise.then(function(){_=Date.now()},function(){});var y=h.Y(function(S){var w=Date.now()-_,E=S.response;return E.timeMs+=g,E.timeMs+=w,S.Yf||!r.l||E.fromCache||e!=xr||r.l(E.timeMs,E.data.byteLength),E},function(S){throw S&&(S.severity=2),S});return o=new na(y.promise,function(){return y.abort()},s),On(this.m,o),o};function JT(e,i,r){var s=kn(void 0),o={};e=v(e.g);for(var l=e.next();!l.done;o={sd:o.sd},l=e.next())o.sd=l.value,s=s.Y(function(h){return function(){return r.body&&(r.body=Jt(r.body)),h.sd(i,r)}}(o));return s.Y(void 0,function(h){throw h instanceof F&&h.code==7001?h:new F(2,1,1006,h)})}function Ip(e,i,r,s,o,l,h){e.o&&(r.uris[o]=r.uris[o].replace("http://","https://"));var d=new jt(r.uris[o]),g=d.Ea,_=!1;g||(g=location.protocol,g=g.slice(0,-1),jo(d,g),r.uris[o]=d.toString()),g=g.toLowerCase();var y=(g=sa[g])?g.jg:null;if(!y)return Vr(new F(2,1,1e3,d));var S=g.kg,w=null,E=null,R=!1,P=!1,L;return ki(Ap(s)).Y(function(){if(e.i)return qu();L=Date.now();var M=y(r.uris[o],r,i,function(N,B,j){w&&w.stop(),E&&E.N(k/1e3),e.l&&i==xr&&(e.l(N,B),_=!0,h.g=j)},function(N){e.j&&e.j(N,r,i),P=!0});if(!S)return M;var U=r.retryParameters.connectionTimeout;U&&(w=new we(function(){R=!0,M.abort()}),w.N(U/1e3));var k=r.retryParameters.stallTimeout;return k&&(E=new we(function(){R=!0,M.abort()})),M}).Y(function(M){w&&w.stop(),E&&E.stop(),M.timeMs==null&&(M.timeMs=Date.now()-L);var U={response:M,Yf:_};return!P&&e.j&&e.j(M.headers,r,i),U},function(M){if(w&&w.stop(),E&&E.stop(),e.s){var U=null,k=0;M instanceof F&&(U=M,M.code==1001&&(k=M.data[1])),e.s(r,U,k,R)}if(e.i)return qu();if(R&&(M=new F(1,1,1003,r.uris[o],i)),M instanceof F){if(M.code==7001)throw M;if(M.code==1010)throw l;if(M.severity==1)return U=new Map().set("error",M),U=new fe("retry",U),e.dispatchEvent(U),o=(o+1)%r.uris.length,Ip(e,i,r,s,o,M,h)}throw M})}function eS(e,i,r){var s=kn(void 0),o={};e=v(e.h);for(var l=e.next();!l.done;o={td:o.td},l=e.next())o.td=l.value,s=s.Y(function(h){return function(){var d=r.response;return d.data&&(d.data=Jt(d.data)),h.td(i,d)}}(o));return s.Y(function(){return r},function(h){var d=2;if(h instanceof F){if(h.code==7001)throw h;d=h.severity}throw new F(d,1,1007,h)})}te("shaka.net.NetworkingEngine",Ne),Ne.prototype.request=Ne.prototype.request,Ne.prototype.destroy=Ne.prototype.destroy,Ne.makeRequest=ti,Ne.defaultRetryParameters=function(){return Pn()},Ne.prototype.clearAllResponseFilters=Ne.prototype.tf,Ne.prototype.unregisterResponseFilter=Ne.prototype.Cg,Ne.prototype.registerResponseFilter=Ne.prototype.mg,Ne.prototype.clearAllRequestFilters=Ne.prototype.rf,Ne.prototype.unregisterRequestFilter=Ne.prototype.Bg,Ne.prototype.registerRequestFilter=Ne.prototype.lg,Ne.unregisterScheme=function(e){delete sa[e]},Ne.registerScheme=Yi,Ne.prototype.setForceHTTPS=Ne.prototype.je;function Rp(){this.g=0}Ne.NumBytesRemainingClass=Rp;function na(e,i,r){Ye.call(this,e,i),this.h=r}me(na,Ye),Ne.PendingRequest=na;var xr=1;Ne.RequestType={MANIFEST:0,SEGMENT:xr,LICENSE:2,APP:3,TIMING:4,SERVER_CERTIFICATE:5,KEY:6};var Lp=3;Ne.PluginPriority={FALLBACK:1,PREFERRED:2,APPLICATION:Lp};var sa={};function Wr(e){this.g=!1,this.h=new Ve,this.i=e}Wr.prototype.destroy=function(){var e=this;return this.g?this.h:(this.g=!0,this.i().then(function(){e.h.resolve()},function(){e.h.resolve()}))};function Ue(e,i){if(e.g)throw i instanceof F&&i.code==7003?i:new F(2,7,7003,i)}function je(){this.g=new Rn}p=je.prototype,p.release=function(){this.nb(),this.g=null},p.C=function(e,i,r,s){this.g&&(e=new Mp(e,i,r,s),this.g.push(i,e))},p.ma=function(e,i,r,s){function o(h){l.zc(e,i,o),r(h)}var l=this;this.C(e,i,o,s)},p.zc=function(e,i,r){if(this.g){var s=this.g.get(i)||[];s=v(s);for(var o=s.next();!o.done;o=s.next())o=o.value,o.target!=e||r!=o.listener&&r||(o.zc(),this.g.remove(i,o))}},p.nb=function(){if(this.g){var e=this.g,i=[],r;for(r in e.g)i.push.apply(i,O(e.g[r]));for(e=v(i),i=e.next();!i.done;i=e.next())i.value.zc();this.g.g={}}},te("shaka.util.EventManager",je),je.prototype.removeAll=je.prototype.nb,je.prototype.unlisten=je.prototype.zc,je.prototype.listenOnce=je.prototype.ma,je.prototype.listen=je.prototype.C,je.prototype.release=je.prototype.release;function Mp(e,i,r,s){this.target=e,this.type=i,this.listener=r,this.g=tS(e,s),this.target.addEventListener(i,r,this.g)}Mp.prototype.zc=function(){this.target.removeEventListener(this.type,this.listener,this.g),this.listener=this.target=null,this.g=!1};function tS(e,i){if(i==null)return!1;if(typeof i=="boolean")return i;var r=new Set(["passive","capture"]);return Object.keys(i).filter(function(s){return!r.has(s)}),iS(e)?i:i.capture||!1}function iS(e){var i=Pp;if(i==null){i=!1;try{var r={},s={get:function(){return i=!0,!1}};Object.defineProperty(r,"passive",s),Object.defineProperty(r,"capture",s),s=function(){},e.addEventListener("test",s,r),e.removeEventListener("test",s,r)}catch(o){i=!1}Pp=i}return i||!1}var Pp=void 0;function kp(e,i){var r=[];e=v(e);for(var s=e.next();!s.done;s=e.next())r.push(i(s.value));return r}function rS(e,i){e=v(e);for(var r=e.next();!r.done;r=e.next())if(!i(r.value))return!1;return!0}function Rs(e){for(var i=new Map,r=v(Object.keys(e)),s=r.next();!s.done;s=r.next())s=s.value,i.set(s,e[s]);return i}function $u(e){var i={};return e.forEach(function(r,s){i[s]=r}),i}function nS(e,i){if(e||i){if(e&&!i||i&&!e)return!1}else return!0;if(e.size!=i.size)return!1;e=v(e);for(var r=e.next();!r.done;r=e.next()){var s=v(r.value);if(r=s.next().value,s=s.next().value,!i.has(r)||(r=i.get(r),r!=s||r==null))return!1}return!0}function Oe(e,i){this.S=Ot(e),this.h=i==Dp,this.g=0}p=Oe.prototype,p.ha=function(){return this.g<this.S.byteLength},p.Z=function(){return this.g},p.Gf=function(){return this.S.byteLength},p.Ra=function(){try{var e=this.S.getUint8(this.g);return this.g+=1,e}catch(i){throw Ki()}},p.$d=function(){try{var e=this.S.getUint16(this.g,this.h);return this.g+=2,e}catch(i){throw Ki()}},p.K=function(){try{var e=this.S.getUint32(this.g,this.h);return this.g+=4,e}catch(i){throw Ki()}},p.Pe=function(){try{var e=this.S.getInt32(this.g,this.h);return this.g+=4,e}catch(i){throw Ki()}},p.$a=function(){try{if(this.h)var e=this.S.getUint32(this.g,!0),i=this.S.getUint32(this.g+4,!0);else i=this.S.getUint32(this.g,!1),e=this.S.getUint32(this.g+4,!1)}catch(r){throw Ki()}if(2097151<i)throw new F(2,3,3001);return this.g+=8,i*Math.pow(2,32)+e},p.Za=function(e){if(this.g+e>this.S.byteLength)throw Ki();var i=Ee(this.S,this.g,e);return this.g+=e,i},p.skip=function(e){if(this.g+e>this.S.byteLength)throw Ki();this.g+=e},p.sg=function(e){if(this.g<e)throw Ki();this.g-=e},p.seek=function(e){if(0>e||e>this.S.byteLength)throw Ki();this.g=e},p.sc=function(){for(var e=this.g;this.ha()&&this.S.getUint8(this.g)!=0;)this.g+=1;return e=Ee(this.S,e,this.g-e),this.g+=1,et(e)};function Ki(){return new F(2,3,3e3)}te("shaka.util.DataViewReader",Oe),Oe.prototype.readTerminatedString=Oe.prototype.sc,Oe.prototype.seek=Oe.prototype.seek,Oe.prototype.rewind=Oe.prototype.sg,Oe.prototype.skip=Oe.prototype.skip,Oe.prototype.readBytes=Oe.prototype.Za,Oe.prototype.readUint64=Oe.prototype.$a,Oe.prototype.readInt32=Oe.prototype.Pe,Oe.prototype.readUint32=Oe.prototype.K,Oe.prototype.readUint16=Oe.prototype.$d,Oe.prototype.readUint8=Oe.prototype.Ra,Oe.prototype.getLength=Oe.prototype.Gf,Oe.prototype.getPosition=Oe.prototype.Z,Oe.prototype.hasMoreData=Oe.prototype.ha;var Dp=1;Oe.Endianness={BIG_ENDIAN:0,LITTLE_ENDIAN:Dp};function ze(){this.i=[],this.h=[],this.g=!1}p=ze.prototype,p.box=function(e,i){return e=Fp(e),this.i[e]=sS,this.h[e]=i,this},p.P=function(e,i){return e=Fp(e),this.i[e]=Np,this.h[e]=i,this},p.stop=function(){this.g=!0},p.parse=function(e,i,r){for(e=new Oe(e,0),this.g=!1;e.ha()&&!this.g;)this.qc(0,e,i,r)},p.qc=function(e,i,r,s){var o=i.Z();if(s&&o+8>i.S.byteLength)this.g=!0;else{var l=i.K(),h=i.K(),d=oa(h),g=!1;switch(l){case 0:l=i.S.byteLength-o;break;case 1:if(s&&i.Z()+8>i.S.byteLength){this.g=!0;return}l=i.$a(),g=!0}var _=this.h[h];if(_){var y=null,S=null;if(this.i[h]==Np){if(s&&i.Z()+4>i.S.byteLength){this.g=!0;return}S=i.K(),y=S>>>24,S&=16777215}h=o+l,r&&h>i.S.byteLength&&(h=i.S.byteLength),s&&h>i.S.byteLength?this.g=!0:(s=h-i.Z(),i=0<s?i.Za(s):new Uint8Array(0),i=new Oe(i,0),_({name:d,parser:this,partialOkay:r||!1,version:y,flags:S,reader:i,size:l,start:o+e,has64BitSize:g}))}else i.skip(Math.min(o+l-i.Z(),i.S.byteLength-i.Z()))}};function Ke(e){for(var i=Ms(e);e.reader.ha()&&!e.parser.g;)e.parser.qc(e.start+i,e.reader,e.partialOkay)}function Ls(e){for(var i=Ms(e),r=e.reader.K(),s=0;s<r&&(e.parser.qc(e.start+i,e.reader,e.partialOkay),!e.parser.g);s++);}function Op(e){var i=Ms(e);for(e.reader.skip(78);e.reader.ha()&&!e.parser.g;)e.parser.qc(e.start+i,e.reader,e.partialOkay)}function Fn(e){return function(i){e(i.reader.Za(i.reader.S.byteLength-i.reader.Z()))}}function Fp(e){var i=0;e=v(e);for(var r=e.next();!r.done;r=e.next())i=i<<8|r.value.charCodeAt(0);return i}function oa(e){return String.fromCharCode(e>>24&255,e>>16&255,e>>8&255,e&255)}function Ms(e){return 8+(e.has64BitSize?8:0)+(e.flags!=null?4:0)}te("shaka.util.Mp4Parser",ze),ze.headerSize=Ms,ze.typeToString=oa,ze.allData=Fn,ze.visualSampleEntry=Op,ze.sampleDescription=Ls,ze.children=Ke,ze.prototype.parseNext=ze.prototype.qc,ze.prototype.parse=ze.prototype.parse,ze.prototype.stop=ze.prototype.stop,ze.prototype.fullBox=ze.prototype.P,ze.prototype.box=ze.prototype.box;var sS=0,Np=1;function Up(e){var i=this;this.g=[],this.h=[],this.data=[],new ze().box("moov",Ke).box("moof",Ke).P("pssh",function(r){if(!(1<r.version)){var s=Ee(r.reader.S,-12,r.size);if(i.data.push(s),i.g.push(As(r.reader.Za(16))),0<r.version){s=r.reader.K();for(var o=0;o<s;o++){var l=As(r.reader.Za(16));i.h.push(l)}}}}).parse(e)}function Yu(e,i,r,s){var o=e.length,l=i.length+16+o;0<s&&(l+=4+16*r.size);var h=new Uint8Array(l),d=Ot(h),g=0;if(d.setUint32(g,l),g+=4,d.setUint32(g,1886614376),g+=4,1>s?d.setUint32(g,0):d.setUint32(g,16777216),g+=4,h.set(i,g),g+=i.length,0<s)for(d.setUint32(g,r.size),g+=4,i=v(r),r=i.next();!r.done;r=i.next())r=ws(r.value),h.set(r,g),g+=r.length;return d.setUint32(g,o),h.set(e,g+4),h}function aa(e,i){return e=Qe(e,i),e.length!=1?null:e[0]}function la(e,i,r){return e=zp(e,i,r),e.length!=1?null:e[0]}function Qe(e,i){var r=[];e=v(e.childNodes);for(var s=e.next();!s.done;s=e.next())s=s.value,s instanceof Element&&s.tagName==i&&r.push(s);return r}function oS(e){return Array.from(e.childNodes).filter(function(i){return i instanceof Element})}function zp(e,i,r){var s=[];e=v(e.childNodes);for(var o=e.next();!o.done;o=e.next())o=o.value,o instanceof Element&&o.localName==r&&o.namespaceURI==i&&s.push(o);return s}function Gr(e,i,r){return e.hasAttributeNS(i,r)?e.getAttributeNS(i,r):null}function Zi(e,i,r){i=v(i);for(var s=i.next();!s.done;s=i.next())if(s=s.value,e.hasAttributeNS(s,r))return e.getAttributeNS(s,r);return null}function ua(e){return Array.from(e.childNodes).every(Bp)?e.textContent.trim():null}function Bp(e){return e.nodeType==Node.TEXT_NODE||e.nodeType==Node.CDATA_SECTION_NODE}function We(e,i,r,s){s=s===void 0?null:s;var o=null;return e=e.getAttribute(i),e!=null&&(o=r(e)),o==null?s:o}function jp(e){return e?(/^\d+-\d+-\d+T\d+:\d+:\d+(\.\d+)?$/.test(e)&&(e+="Z"),e=Date.parse(e),isNaN(e)?null:e/1e3):null}function Qi(e){return!e||(e=RegExp("^P(?:([0-9]*)Y)?(?:([0-9]*)M)?(?:([0-9]*)D)?(?:T(?:([0-9]*)H)?(?:([0-9]*)M)?(?:([0-9.]*)S)?)?$").exec(e),!e)?null:(e=31536e3*Number(e[1]||null)+2592e3*Number(e[2]||null)+86400*Number(e[3]||null)+3600*Number(e[4]||null)+60*Number(e[5]||null)+Number(e[6]||null),isFinite(e)?e:null)}function ha(e){var i=/([0-9]+)-([0-9]+)/.exec(e);return!i||(e=Number(i[1]),!isFinite(e))?null:(i=Number(i[2]),isFinite(i)?{start:e,end:i}:null)}function aS(e){return e=Number(e),e%1===0?e:null}function ca(e){return e=Number(e),e%1===0&&0<e?e:null}function Di(e){return e=Number(e),e%1===0&&0<=e?e:null}function Ps(e){return e=Number(e),isNaN(e)?null:e}function lS(e){var i,r=(i=e.match(/^(\d+)\/(\d+)$/))?Number(i[1])/Number(i[2]):Number(e);return isNaN(r)?null:r}function ks(e,i){var r=new DOMParser,s=uS.value()(e);e=null;try{e=r.parseFromString(s,"text/xml")}catch(o){return null}if(r=e.documentElement,!r||r.getElementsByTagName("parsererror").length||r.tagName!=i)return null;for(i=document.createNodeIterator(e,NodeFilter.SHOW_ALL);e=i.nextNode();)if(e instanceof HTMLElement||e instanceof SVGElement)return null;return r}function Hp(e,i){try{var r=et(e);return ks(r,i)}catch(s){return null}}var uS=new An(function(){if(typeof trustedTypes<"u"){var e=trustedTypes.createPolicy("shaka-player#xml",{createHTML:function(i){return i}});return function(i){return e.createHTML(i)}}return function(i){return i}});function da(e,i){var r=this;i=i===void 0?1:i,this.D=e,this.G=new Set,this.l=this.u=null,this.da=this.W=!1,this.H=0,this.g=null,this.s=new je,this.i=new Map,this.B=[],this.o=new Ve,this.h=null,this.m=function(s){r.o.reject(s),e.onError(s)},this.ea=new Map,this.ba=new Map,this.O=new we(function(){return vS(r)}),this.L=!1,this.J=[],this.M=!1,this.ca=new we(function(){wS(r)}).Ca(i),this.o.catch(function(){}),this.j=new Wr(function(){return hS(r)}),this.V=!1,this.F=null}p=da.prototype,p.destroy=function(){return this.j.destroy()};function hS(e){return z(function(i){switch(i.g){case 1:return e.s.release(),e.s=null,e.o.reject(),e.ca.stop(),e.ca=null,e.O.stop(),e.O=null,C(i,Qp(e),2);case 2:if(!e.l){i.A(3);break}return de(i,4),C(i,e.l.setMediaKeys(null),6);case 6:Ae(i,5);break;case 4:oe(i);case 5:e.l=null;case 3:e.g=null,e.G.clear(),e.u=null,e.B=[],e.h=null,e.m=function(){},e.D=null,e.V=!1,e.F=null,K(i)}})}p.configure=function(e){this.h=e};function cS(e,i,r){return e.da=!0,e.B=[],e.L=r,Wp(e,i)}function Vp(e,i,r){return e.B=r,e.L=0<r.length,Wp(e,i)}function dS(e,i,r,s,o,l){var h=new Map;return o={audioCapabilities:o,videoCapabilities:l,distinctiveIdentifier:"optional",persistentState:"required",sessionTypes:["persistent-license"],label:i},o.drmInfos=[{keySystem:i,licenseServerUri:r,distinctiveIdentifierRequired:!1,persistentStateRequired:!0,audioRobustness:"",videoRobustness:"",serverCertificate:s,serverCertificateUri:"",initData:null,keyIds:null}],h.set(i,o),Yp(e,h,[])}function Wp(e,i){var r,s,o,l,h,d,g,_,y,S,w,E,R,P;return z(function(L){if(L.g==1){if(r=_S(e))for(s=v(i),o=s.next();!o.done;o=s.next())l=o.value,l.video&&(l.video.drmInfos=[r]),l.audio&&(l.audio.drmInfos=[r]);for(h=i.some(function(M){return!!(M.video&&M.video.drmInfos.length||M.audio&&M.audio.drmInfos.length)}),h||(d=Rs(e.h.servers),AS(i,d)),g=v(i),o=g.next();!o.done;o=g.next())for(_=o.value,y=Jp(_),S=v(y),w=S.next();!w.done;w=S.next())E=w.value,ES(E,Rs(e.h.servers),Rs(e.h.advanced||{}),e.h.keySystemsMapping);return C(L,ap(i,e.L,e.V),2)}return R=h||Object.keys(e.h.servers).length,R?(P=Yp(e,void 0,i),L.return(h?P:P.catch(function(){}))):(e.W=!0,L.return(Promise.resolve()))})}function Gp(e){var i;return z(function(r){switch(r.g){case 1:if(e.l.mediaKeys)return r.return();if(!e.F){r.A(2);break}return C(r,e.F,3);case 3:return Ue(e.j),r.return();case 2:return de(r,4),e.F=e.l.setMediaKeys(e.u),C(r,e.F,6);case 6:Ae(r,5);break;case 4:i=oe(r),e.m(new F(2,6,6003,i.message));case 5:Ue(e.j),K(r)}})}function fS(e,i){return z(function(r){if(r.g==1)return C(r,Gp(e),2);Ds(e,i.initDataType,Ee(i.initData)),K(r)})}p.Yb=function(e){var i=this,r;return z(function(s){if(s.g==1)return i.u?(i.l=e,i.s.ma(i.l,"play",function(){for(var o=v(i.J),l=o.next();!l.done;l=o.next())Zu(i,l.value);i.M=!0,i.J=[]}),"webkitCurrentPlaybackTargetIsWireless"in i.l&&i.s.C(i.l,"webkitcurrentplaybacktargetiswirelesschanged",function(){return Qp(i)}),(r=i.g?i.g.initData.find(function(o){return 0<o.initData.length}):null)||i.g.keySystem!=="com.apple.fps"||i.B.length?C(s,Gp(i),2):s.A(2)):(i.s.ma(e,"encrypted",function(){i.m(new F(2,6,6010))}),s.return());Xp(i),r||i.B.length||i.h.parseInbandPsshEnabled||i.s.C(i.l,"encrypted",function(o){return fS(i,o)}),K(s)})};function Ku(e){var i,r,s,o,l;return z(function(h){switch(h.g){case 1:if(!e.u||!e.g)return h.return();if(!e.g.serverCertificateUri||e.g.serverCertificate&&e.g.serverCertificate.length){h.A(2);break}return i=ti([e.g.serverCertificateUri],e.h.retryParameters),de(h,3),r=e.D.kb.request(5,i),C(h,r.promise,5);case 5:s=h.h,e.g.serverCertificate=Ee(s.data),Ae(h,4);break;case 3:throw o=oe(h),new F(2,6,6017,o);case 4:if(e.j.g)return h.return();case 2:return!e.g.serverCertificate||!e.g.serverCertificate.length?h.return():(de(h,6),C(h,e.u.setServerCertificate(e.g.serverCertificate),8));case 8:Ae(h,0);break;case 6:throw l=oe(h),new F(2,6,6004,l.message)}})}function pS(e,i){var r,s,o;return z(function(l){if(l.g==1)return C(l,Kp(e,i),2);if(l.g!=3)return r=l.h,r?(s=[],(o=e.i.get(r))&&(o.Ja=new Ve,s.push(o.Ja)),s.push(r.remove()),C(l,Promise.all(s),3)):l.return();e.i.delete(r),K(l)})}function Xp(e){for(var i=(e.g?e.g.initData:[])||[],r=v(i),s=r.next();!s.done;s=r.next())s=s.value,Ds(e,s.initDataType,s.initData);for(r=v(e.B),s=r.next();!s.done;s=r.next())Kp(e,s.value);return i.length||e.B.length||e.o.resolve(),e.o}function Ds(e,i,r){if(r.length){var s=e.i.values();s=v(s);for(var o=s.next();!o.done;o=s.next())if(Fr(r,o.value.initData)&&!$e("Tizen 2"))return;0<e.i.size&&pa(e)&&(e.o.resolve(),e.o=new Ve,e.o.catch(function(){})),yS(e,i,r,e.g.sessionType)}}function qp(e){return e?!!e.match(/^com\.(microsoft|chromecast)\.playready/):!1}function $p(e){return e=e.i.keys(),e=kp(e,function(i){return i.sessionId}),Array.from(e)}p.ic=function(){var e=1/0,i=this.i.keys();i=v(i);for(var r=i.next();!r.done;r=i.next())r=r.value,isNaN(r.expiration)||(e=Math.min(e,r.expiration));return e},p.Qc=function(){return $u(this.ba)};function Yp(e,i,r){var s,o,l,h,d,g,_,y,S,w,E,R,P;return z(function(L){switch(L.g){case 1:if(s=new Map,r.length){o=gS(e,r,s),L.A(2);break}return C(L,mS(e,i),3);case 3:o=L.h;case 2:if(l=o,!l)throw new F(2,6,6001);for(Ue(e.j),de(L,4),e.G.clear(),h=l.getConfiguration(),d=h.audioCapabilities||[],g=h.videoCapabilities||[],_=v(d),y=_.next();!y.done;y=_.next())S=y.value,e.G.add(S.contentType.toLowerCase());for(w=v(g),y=w.next();!y.done;y=w.next())E=y.value,e.G.add(E.contentType.toLowerCase());if(r.length){var M=l.keySystem,U=s.get(l.keySystem),k=[],N=[],B=[],j=[],V=new Set;eg(U,k,B,N,j,V);var $=e.L?"persistent-license":"temporary";for(M={keySystem:M,licenseServerUri:k[0],distinctiveIdentifierRequired:U[0].distinctiveIdentifierRequired,persistentStateRequired:U[0].persistentStateRequired,sessionType:U[0].sessionType||$,audioRobustness:U[0].audioRobustness||"",videoRobustness:U[0].videoRobustness||"",serverCertificate:B[0],serverCertificateUri:N[0],initData:j,keyIds:V},U=v(U),k=U.next();!k.done;k=U.next())k=k.value,k.distinctiveIdentifierRequired&&(M.distinctiveIdentifierRequired=k.distinctiveIdentifierRequired),k.persistentStateRequired&&(M.persistentStateRequired=k.persistentStateRequired);U=M}else U=l.keySystem,M=i.get(l.keySystem),k=[],N=[],B=[],j=[],V=new Set,eg(M.drmInfos,k,B,N,j,V),U={keySystem:U,licenseServerUri:k[0],distinctiveIdentifierRequired:M.distinctiveIdentifier=="required",persistentStateRequired:M.persistentState=="required",sessionType:M.sessionTypes[0]||"temporary",audioRobustness:(M.audioCapabilities?M.audioCapabilities[0].robustness:"")||"",videoRobustness:(M.videoCapabilities?M.videoCapabilities[0].robustness:"")||"",serverCertificate:B[0],serverCertificateUri:N[0],initData:j,keyIds:V};if(e.g=U,!e.g.licenseServerUri)throw new F(2,6,6012,e.g.keySystem);return C(L,l.createMediaKeys(),6);case 6:return R=L.h,Ue(e.j),e.u=R,e.W=!0,C(L,Ku(e),7);case 7:Ue(e.j),Ae(L,0);break;case 4:throw P=oe(L),Ue(e.j,P),e.g=null,e.G.clear(),P instanceof F?P:new F(2,6,6002,P.message)}})}function gS(e,i,r){for(var s=v(i),o=s.next();!o.done;o=s.next()){var l=v(Jp(o.value));for(o=l.next();!o.done;o=l.next())o=o.value,r.has(o.keySystem)||r.set(o.keySystem,[]),r.get(o.keySystem).push(o)}if(r.size==1&&r.has(""))throw new F(2,6,6e3);for(s={},e=v(e.h.preferredKeySystems),o=e.next();!o.done;s={qd:s.qd},o=e.next())for(s.qd=o.value,l=v(i),o=l.next();!o.done;o=l.next())if(o=o.value.decodingInfos.find(function(_){return function(y){return y.supported&&y.keySystemAccess!=null&&y.keySystemAccess.keySystem==_.qd}}(s)))return o.keySystemAccess;for(e=v([!0,!1]),o=e.next();!o.done;o=e.next())for(s=o.value,l=v(i),o=l.next();!o.done;o=l.next()){var h=v(o.value.decodingInfos);for(o=h.next();!o.done;o=h.next()){var d=o.value;if(d.supported&&d.keySystemAccess){o=r.get(d.keySystemAccess.keySystem);var g=v(o);for(o=g.next();!o.done;o=g.next())if(!!o.value.licenseServerUri==s)return d.keySystemAccess}}}return null}function mS(e,i){var r,s,o,l,h,d,g,_,y,S,w,E,R,P,L;return z(function(M){switch(M.g){case 1:if(i.size==1&&i.has(""))throw new F(2,6,6e3);for(s=v(i.values()),o=s.next();!o.done;o=s.next())l=o.value,l.audioCapabilities.length==0&&delete l.audioCapabilities,l.videoCapabilities.length==0&&delete l.videoCapabilities;h=v(e.h.preferredKeySystems),d=h.next();case 2:if(d.done){M.A(4);break}if(g=d.value,!i.has(g)){M.A(3);break}return _=i.get(g),de(M,6),C(M,navigator.requestMediaKeySystemAccess(g,[_]),8);case 8:return r=M.h,M.return(r);case 6:oe(M);case 7:Ue(e.j);case 3:d=h.next(),M.A(2);break;case 4:y=v([!0,!1]),S=y.next();case 9:if(S.done){M.A(11);break}w=S.value,E=v(i.keys()),d=E.next();case 12:if(d.done){S=y.next(),M.A(9);break}if(R=d.value,P=i.get(R),L=P.drmInfos.some(function(U){return!!U.licenseServerUri}),L!=w){M.A(13);break}return de(M,15),C(M,navigator.requestMediaKeySystemAccess(R,[P]),17);case 17:return r=M.h,M.return(r);case 15:oe(M);case 16:Ue(e.j);case 13:d=E.next(),M.A(12);break;case 11:return M.return(r)}})}function _S(e){if(e=Rs(e.h.clearKeys),e.size==0)return null;var i=[],r=[];e.forEach(function(o,l){var h=l;h.length!=22&&(h=Br(ws(l),!1)),l=o,l.length!=22&&(l=Br(ws(o),!1)),o={kty:"oct",kid:h,k:l},i.push(o),r.push(o.kid)}),e=JSON.stringify({keys:i});var s=JSON.stringify({kids:r});return s=[{initData:Ee(mr(s)),initDataType:"keyids"}],{keySystem:"org.w3.clearkey",licenseServerUri:"data:application/json;base64,"+u.btoa(e),distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",serverCertificate:null,serverCertificateUri:"",sessionType:"",initData:s,keyIds:new Set(r)}}function Kp(e,i){var r,s,o,l,h;return z(function(d){switch(d.g){case 1:try{r=e.u.createSession("persistent-license")}catch(g){return s=new F(2,6,6005,g.message),e.m(s),d.return(Promise.reject(s))}return e.s.C(r,"message",function(g){e.l&&e.h.delayLicenseRequestUntilPlayed&&e.l.paused&&!e.M?e.J.push(g):Zu(e,g)}),e.s.C(r,"keystatuseschange",function(g){return Zp(e,g)}),o={initData:null,initDataType:null,loaded:!1,Vd:1/0,Ja:null,type:"persistent-license"},e.i.set(r,o),de(d,2),C(d,r.load(i),4);case 4:return l=d.h,Ue(e.j),l?(o.loaded=!0,pa(e)&&e.o.resolve(),d.return(r)):(e.i.delete(r),e.m(new F(2,6,6013)),d.return(Promise.resolve()));case 2:h=oe(d),Ue(e.j,h),e.i.delete(r),e.m(new F(2,6,6005,h.message));case 3:return d.return(Promise.resolve())}})}function yS(e,i,r,s){try{var o=e.u.createSession(s)}catch(l){e.m(new F(2,6,6005,l.message));return}e.s.C(o,"message",function(l){e.l&&e.h.delayLicenseRequestUntilPlayed&&e.l.paused&&!e.M?e.J.push(l):Zu(e,l)}),e.s.C(o,"keystatuseschange",function(l){return Zp(e,l)}),e.i.set(o,{initData:r,initDataType:i,loaded:!1,Vd:1/0,Ja:null,type:s});try{r=e.h.initDataTransform(r,i,e.g)}catch(l){i=l,l instanceof F||(i=new F(2,6,6016,l)),e.m(i);return}e.h.logLicenseExchange&&Br(r),o.generateRequest(i,r).catch(function(l){if(!e.j.g){e.i.delete(o);var h=l.errorCode;if(h&&h.systemCode){var d=h.systemCode;0>d&&(d+=Math.pow(2,32)),d="0x"+d.toString(16)}e.m(new F(2,6,6006,l.message,l,d))}})}function Zu(e,i){var r,s,o,l,h,d,g,_,y,S,w,E,R,P;z(function(L){switch(L.g){case 1:return r=i.target,e.h.logLicenseExchange&&Br(i.message),s=e.i.get(r),o=e.g.licenseServerUri,l=e.h.advanced[e.g.keySystem],i.messageType=="individualization-request"&&l&&l.individualizationServer&&(o=l.individualizationServer),h=ti([o],e.h.retryParameters),h.body=i.message,h.method="POST",h.licenseRequestType=i.messageType,h.sessionId=r.sessionId,h.drmInfo=e.g,s&&(h.initData=s.initData,h.initDataType=s.initDataType),qp(e.g.keySystem)&&xS(h),d=Date.now(),de(L,2),_=e.D.kb.request(2,h),C(L,_.promise,4);case 4:g=L.h,Ae(L,3);break;case 2:return y=oe(L),S=new F(2,6,6007,y),e.m(S),s&&s.Ja&&s.Ja.reject(S),L.return();case 3:return e.j.g?L.return():(e.H+=(Date.now()-d)/1e3,e.h.logLicenseExchange&&Br(g.data),de(L,5),C(L,r.update(g.data),7));case 7:Ae(L,6);break;case 5:return w=oe(L),E=new F(2,6,6008,w.message),e.m(E),s&&s.Ja&&s.Ja.reject(E),L.return();case 6:if(e.j.g)return L.return();R=new fe("drmsessionupdate"),e.D.onEvent(R),s&&(s.Ja&&s.Ja.resolve(),P=new we(function(){s.loaded=!0,pa(e)&&e.o.resolve()}),P.N(bS)),K(L)}})}function xS(e){var i=gr(e.body,!0,!0);if(i.includes("PlayReadyKeyMessage")){i=ks(i,"PlayReadyKeyMessage");for(var r=v(i.getElementsByTagName("HttpHeader")),s=r.next();!s.done;s=r.next())s=s.value,e.headers[s.getElementsByTagName("name")[0].textContent]=s.getElementsByTagName("value")[0].textContent;e.body=qi(i.getElementsByTagName("Challenge")[0].textContent)}else e.headers["Content-Type"]="text/xml; charset=utf-8"}function Zp(e,i){i=i.target;var r=e.i.get(i),s=!1;i.keyStatuses.forEach(function(l,h){if(typeof h=="string"){var d=h;h=l,l=d}if(qp(e.g.keySystem)&&h.byteLength==16&&(Ru()||Ss())){d=Ot(h);var g=d.getUint32(0,!0),_=d.getUint16(4,!0),y=d.getUint16(6,!0);d.setUint32(0,g,!1),d.setUint16(4,_,!1),d.setUint16(6,y,!1)}l!="status-pending"&&(r.loaded=!0),l=="expired"&&(s=!0),h=As(h).slice(0,32),e.ea.set(h,l)});var o=i.expiration-Date.now();(0>o||s&&1e3>o)&&r&&!r.Ja&&(e.i.delete(i),i.close().catch(function(){})),pa(e)&&(e.o.resolve(),e.O.N(IS))}function vS(e){var i=e.ea,r=e.ba;r.clear(),i.forEach(function(s,o){return r.set(o,s)}),i=Array.from(r.values()),i.length&&i.every(function(s){return s=="expired"})&&e.m(new F(2,6,6014)),e.D.cd($u(r))}function TS(){var e,i,r,s,o,l,h,d;return z(function(g){return g.g==1?(e="org.w3.clearkey com.widevine.alpha com.microsoft.playready com.microsoft.playready.recommendation com.apple.fps.1_0 com.apple.fps com.adobe.primetime".split(" "),i=[{contentType:'video/mp4; codecs="avc1.42E01E"'},{contentType:'video/webm; codecs="vp8"'}],r={initDataTypes:["cenc"],videoCapabilities:i},s={videoCapabilities:i,persistentState:"required",sessionTypes:["persistent-license"]},o=[s,r],l=new Map,h=function(_){var y,S,w;return z(function(E){switch(E.g){case 1:if(de(E,2),_==="org.w3.clearkey"&&Lu())throw Error("Unsupported keySystem");return C(E,navigator.requestMediaKeySystemAccess(_,o),4);case 4:return y=E.h,w=(S=y.getConfiguration().sessionTypes)?S.includes("persistent-license"):!1,$e("Tizen 3")&&(w=!1),l.set(_,{persistentState:w}),C(E,y.createMediaKeys(),5);case 5:Ae(E,0);break;case 2:oe(E),l.set(_,null),K(E)}})},d=e.map(function(_){return h(_)}),C(g,Promise.all(d),2)):g.return($u(l))})}function SS(e){var i;return z(function(r){if(r.g==1)return i=new Promise(function(s,o){new we(o).N(CS)}),de(r,2),C(r,Promise.race([Promise.all([e.close(),e.closed]),i]),4);if(r.g!=2)return Ae(r,0);oe(r),K(r)})}function Qp(e){var i;return z(function(r){return i=Array.from(e.i.entries()),e.i.clear(),C(r,Promise.all(i.map(function(s){s=v(s);var o=s.next().value,l=s.next().value;return z(function(h){if(h.g==1)return de(h,2),e.da||e.B.includes(o.sessionId)||l.type!=="persistent-license"?C(h,SS(o),5):C(h,o.remove(),5);if(h.g!=2)return Ae(h,0);oe(h),K(h)})})),0)})}function fa(e,i){if(!e.length)return i;if(!i.length)return e;var r=[];e=v(e);for(var s=e.next();!s.done;s=e.next()){s=s.value;for(var o={},l=v(i),h=l.next();!h.done;o={Da:o.Da},h=l.next())if(h=h.value,s.keySystem==h.keySystem){o.Da=[],o.Da=o.Da.concat(s.initData||[]),o.Da=o.Da.concat(h.initData||[]),o.Da=o.Da.filter(function(d){return function(g,_){return g.keyId===void 0||_===d.Da.findIndex(function(y){return y.keyId===g.keyId})}}(o)),l=s.keyIds&&h.keyIds?new Set([].concat(O(s.keyIds),O(h.keyIds))):s.keyIds||h.keyIds,r.push({keySystem:s.keySystem,licenseServerUri:s.licenseServerUri||h.licenseServerUri,distinctiveIdentifierRequired:s.distinctiveIdentifierRequired||h.distinctiveIdentifierRequired,persistentStateRequired:s.persistentStateRequired||h.persistentStateRequired,videoRobustness:s.videoRobustness||h.videoRobustness,audioRobustness:s.audioRobustness||h.audioRobustness,serverCertificate:s.serverCertificate||h.serverCertificate,serverCertificateUri:s.serverCertificateUri||h.serverCertificateUri,initData:o.Da,keyIds:l});break}}return r}function Jp(e){return(e.video?e.video.drmInfos:[]).concat(e.audio?e.audio.drmInfos:[])}function wS(e){e.i.forEach(function(i,r){var s=i.Vd,o=r.expiration;isNaN(o)&&(o=1/0),o!=s&&(e.D.onExpirationUpdated(r.sessionId,o),i.Vd=o)})}function pa(e){return e=e.i.values(),rS(e,function(i){return i.loaded})}function AS(e,i){var r=[];for(i.forEach(function(s,o){r.push({keySystem:o,licenseServerUri:s,distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",serverCertificate:null,serverCertificateUri:"",initData:[],keyIds:new Set})}),e=v(e),i=e.next();!i.done;i=e.next())i=i.value,i.video&&(i.video.drmInfos=r),i.audio&&(i.audio.drmInfos=r)}function eg(e,i,r,s,o,l){var h={};e=v(e);for(var d=e.next();!d.done;h={oa:h.oa},d=e.next()){if(h.oa=d.value,i.includes(h.oa.licenseServerUri)||i.push(h.oa.licenseServerUri),s.includes(h.oa.serverCertificateUri)||s.push(h.oa.serverCertificateUri),h.oa.serverCertificate&&(r.some(function(y){return function(S){return Fr(S,y.oa.serverCertificate)}}(h))||r.push(h.oa.serverCertificate)),h.oa.initData){d={};for(var g=v(h.oa.initData),_=g.next();!_.done;d={Dc:d.Dc},_=g.next())d.Dc=_.value,o.some(function(y){return function(S){var w=y.Dc;return S.keyId&&S.keyId==w.keyId?!0:S.initDataType==w.initDataType&&Fr(S.initData,w.initData)}}(d))||o.push(d.Dc)}if(h.oa.keyIds)for(d=v(h.oa.keyIds),g=d.next();!g.done;g=d.next())l.add(g.value)}}function ES(e,i,r,s){var o=e.keySystem;o&&(o!="org.w3.clearkey"||!e.licenseServerUri)&&(i.size&&(i=i.get(o)||"",e.licenseServerUri=i),e.keyIds||(e.keyIds=new Set),(r=r.get(o))&&(e.distinctiveIdentifierRequired||(e.distinctiveIdentifierRequired=r.distinctiveIdentifierRequired),e.persistentStateRequired||(e.persistentStateRequired=r.persistentStateRequired),e.videoRobustness||(e.videoRobustness=r.videoRobustness),e.audioRobustness||(e.audioRobustness=r.audioRobustness),e.serverCertificate||(e.serverCertificate=r.serverCertificate),r.sessionType&&(e.sessionType=r.sessionType),e.serverCertificateUri||(e.serverCertificateUri=r.serverCertificateUri)),s[o]&&(e.keySystem=s[o]),u.cast&&u.cast.__platform__&&o=="com.microsoft.playready"&&(e.keySystem="com.chromecast.playready"))}var CS=1,bS=5,IS=.5,ga=new An(function(){return Jt(new Uint8Array([0]))});function ma(){}function tg(e,i,r,s){var o,l,h,d;return z(function(g){if(g.g==1)return s&&(o=ii[s.toLowerCase()])?g.return(o):(l=Nn(e))&&(h=Xr[l])?g.return(h):s?g.A(2):C(g,ig(e,i,r),3);if(g.g!=2&&(s=g.h)&&(d=ii[s]))return g.return(d);throw new F(2,4,4e3,e)})}function ig(e,i,r){var s,o,l;return z(function(h){return h.g==1?(s=ti([e],r),s.method="HEAD",C(h,i.request(0,s).promise,2)):(o=h.h,l=o.headers["content-type"],h.return(l?l.toLowerCase().split(";").shift():""))})}function Nn(e){return e=new jt(e).qa.split("/").pop().split("."),e.length==1?"":e.pop().toLowerCase()}te("shaka.media.ManifestParser",ma),ma.unregisterParserByMime=function(e){delete ii[e]},ma.registerParserByMime=function(e,i){ii[e]=i},ma.registerParserByExtension=function(e,i){Xr[e]=i};var ii={},Xr={};function RS(e){function i(){s=!0}function r(_){l.push(_),Ke(_)}e=Ee(e);var s=!1,o,l=[],h=[];if(new ze().box("moov",r).box("trak",r).box("mdia",r).box("minf",r).box("stbl",r).P("stsd",function(_){o=_,l.push(_),Ls(_)}).P("encv",i).P("enca",i).P("hev1",function(_){h.push({box:_,lb:1701733238})}).P("hvc1",function(_){h.push({box:_,lb:1701733238})}).P("avc1",function(_){h.push({box:_,lb:1701733238})}).P("avc3",function(_){h.push({box:_,lb:1701733238})}).P("ac-3",function(_){h.push({box:_,lb:1701733217})}).P("ec-3",function(_){h.push({box:_,lb:1701733217})}).P("mp4a",function(_){h.push({box:_,lb:1701733217})}).parse(e),s)return e;if(h.length==0||!o)throw As(e),new F(2,3,3019);h.reverse();for(var d=v(h),g=d.next();!g.done;g=d.next())g=g.value,e=LS(e,o,g.box,l,g.lb);return e}function LS(e,i,r,s,o){var l=MS.value(),h=e.subarray(r.start,r.start+r.size),d=Ot(h),g=new Uint8Array(r.size+l.byteLength);for(g.set(h,0),h=Ot(g),h.setUint32(4,o),g.set(l,r.size),o=d.getUint32(4),h.setUint32(r.size+16,o),rg(g,0,g.byteLength),o=new Uint8Array(e.byteLength+g.byteLength),r=Ts()?r.start:r.start+r.size,l=e.subarray(r),o.set(e.subarray(0,r)),o.set(g,r),o.set(l,r+g.byteLength),e=v(s),s=e.next();!s.done;s=e.next())s=s.value,rg(o,s.start,s.size+g.byteLength);return g=Ot(o,i.start),i=Ms(i),e=g.getUint32(i),g.setUint32(i,e+1),o}function rg(e,i,r){e=Ot(e,i),i=e.getUint32(0),i!=0&&(i==1?(e.setUint32(8,r>>32),e.setUint32(12,r&4294967295)):e.setUint32(0,r))}var MS=new An(function(){return new Uint8Array([0,0,0,80,115,105,110,102,0,0,0,12,102,114,109,97,0,0,0,0,0,0,0,20,115,99,104,109,0,0,0,0,99,101,110,99,0,1,0,0,0,0,0,40,115,99,104,105,0,0,0,32,116,101,110,99,0,0,0,0,0,0,1,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0])});function ng(e,i,r,s,o){if(s>=o)return null;for(var l=-1,h=-1,d=0;d<r.length;d++)if(r[d].some(function(N){return N!=null&&N.g.trim()!=""})){l=d;break}for(d=r.length-1;0<=d;d--)if(r[d].some(function(N){return N!=null&&N.g.trim()!=""})){h=d;break}if(l===-1||h===-1)return null;for(var g=d=!1,_="white",y="black",S=Qu(s,o,d,g,_,y);l<=h;l++){for(var w=r[l],E=-1,R=-1,P=0;P<w.length;P++)if(w[P]!=null&&w[P].g.trim()!==""){E=P;break}for(P=w.length-1;0<=P;P--)if(w[P]!=null&&w[P].g.trim()!==""){R=P;break}if(E===-1||R===-1)w=sg(s,o),e.nestedCues.push(w);else{for(;E<=R;E++)if(P=w[E]){var L=P.l,M=P.i,U=P.j,k=P.h;(L!=d||M!=g||U!=_||k!=y)&&(S.payload&&e.nestedCues.push(S),S=Qu(s,o,L,M,U,k),d=L,g=M,_=U,y=k),S.payload+=P.g}else S.payload+=" ";S.payload&&e.nestedCues.push(S),l!==h&&(S=sg(s,o),e.nestedCues.push(S)),S=Qu(s,o,d,g,_,y)}}return e.nestedCues.length?{cue:e,stream:i}:null}function Qu(e,i,r,s,o,l){return e=new Be(e,i,""),r&&e.textDecoration.push("underline"),s&&(e.fontStyle="italic"),e.color=o,e.backgroundColor=l,e}function sg(e,i){return e=new Be(e,i,""),e.lineBreak=!0,e}function og(e,i,r,s,o){this.g=e,this.l=i,this.i=r,this.h=s,this.j=o}function Ju(e,i){this.i=[],this.g=1,this.h=0,this.u=e,this.s=i,this.j=this.m=!1,this.l="white",this.o="black",Os(this)}function _a(e,i,r){return ng(new Be(i,r,""),"CC"+(e.u<<1|e.s+1),e.i,i,r)}function Os(e){Ji(e,0,15),e.g=1}function Un(e,i,r){if(!(32>r||127<r)){var s="";switch(i){case Fs:s=cg.has(r)?cg.get(r):String.fromCharCode(r);break;case lg:s=PS.get(r);break;case ug:e.i[e.g].pop(),s=kS.get(r);break;case hg:e.i[e.g].pop(),s=DS.get(r)}s&&e.i[e.g].push(new og(s,e.m,e.j,e.o,e.l))}}function ag(e,i,r,s){if(!(0>r||0>i))if(i>=r)for(--s;0<=s;s--)e.i[i+s]=e.i[r+s].map(function(l){return l});else for(var o=0;o<s;o++)e.i[i+o]=e.i[r+o].map(function(l){return l})}function Ji(e,i,r){for(var s=0;s<=r;s++)e.i[i+s]=[]}var Fs=0,lg=1,ug=2,hg=3,cg=new Map([[39,""],[42,""],[92,""],[92,""],[94,""],[95,""],[96,""],[123,""],[124,""],[125,""],[126,""],[127,""]]),PS=new Map([[48,""],[49,""],[50,""],[51,""],[52,""],[53,""],[54,""],[55,""],[56,""],[57,""],[58,""],[59,""],[60,""],[61,""],[62,""],[63,""]]),kS=new Map([[32,""],[33,""],[34,""],[35,""],[36,""],[37,""],[38,""],[39,""],[40,"*"],[41,"'"],[42,""],[43,""],[44,""],[45,""],[46,""],[47,""],[48,""],[49,""],[50,""],[51,""],[52,""],[53,""],[54,""],[55,""],[56,""],[57,""],[58,""],[59,""],[60,""],[61,""],[62,""],[63,""]]),DS=new Map([[32,""],[33,""],[34,""],[35,""],[36,""],[37,""],[38,""],[39,""],[40,""],[41,"{"],[42,"}"],[43,"\\"],[44,"^"],[45,"_"],[46,"|"],[47,"~"],[48,""],[49,""],[50,""],[51,""],[52,""],[53,""],[54,""],[55,""],[56,""],[57,""],[58,""],[59,""],[60,""],[61,""],[62,""],[63,""]]);function ya(e,i){this.h=OS,this.o=new Ju(e,i),this.i=new Ju(e,i),this.l=new Ju(e,i),this.g=this.i,this.j=0,this.m=null}function eh(e,i,r){e.g=e.i;var s=e.g,o=null;return e.h!==xa&&e.h!==Ns&&(o=_a(s,e.j,r),r=e.i,r.g=0<r.h?r.h:0,Ji(r,0,15),r=e.l,r.g=0<r.h?r.h:0,Ji(r,0,15),s.g=15),e.h=xa,s.h=i,o}function dg(e){e.h=FS,e.g=e.l,e.g.h=0}function fg(e){kr("Cea608DataChannel","CEA-608 text mode entered, but is unsupported"),e.g=e.o,e.h=Ns}var OS=0,FS=1,xa=3,Ns=4,NS="black green blue cyan red yellow magenta black".split(" "),pg="white green blue cyan red yellow magenta white_italics".split(" ");function gg(){this.l=!1,this.B=this.F=0,this.D=BS,this.i=[],this.g=this.h=this.j=0,this.u=this.o=!1,this.s="white",this.m="black",th(this)}function th(e){e.i=[];for(var i=0;16>i;i++)e.i.push(ih())}function ih(){for(var e=[],i=0;42>i;i++)e.push(null);return e}function qr(e,i){mg(e)&&(e.i[e.h][e.g]=new og(i,e.u,e.o,e.m,e.s),e.g++)}function mg(e){var i=e.g<e.B&&0<=e.g;return e.h<e.F&&0<=e.h&&i}gg.prototype.isVisible=function(){return this.l};function $r(e,i,r){var s=new Be(e.j,i,"");return s.textAlign=e.D===US?"left":e.D===zS?"right":Xi,(r=ng(s,"svc"+r,e.i,e.j,i))&&(e.j=i),r}var US=0,zS=1,BS=2;function jS(){this.i=[],this.h=null,this.g=0}function HS(e,i){i.type===3?(e.g=2*(i.value&63)-1,e.h=[]):e.h&&(0<e.g&&(e.h.push(i),e.g--),e.g===0&&(e.i.push(new va(e.h)),e.h=null,e.g=0))}function va(e){this.g=0,this.h=e}va.prototype.ha=function(){return this.g<this.h.length},va.prototype.Z=function(){return this.g};function ut(e){if(!e.ha())throw new F(2,2,3e3);return e.h[e.g++]}va.prototype.skip=function(e){if(this.g+e>this.h.length)throw new F(2,2,3e3);this.g+=e};function VS(e){this.i=e,this.h=[null,null,null,null,null,null,null,null],this.g=null}function WS(e,i,r,s){if(128<=r&&135>=r)s=r&7,e.h[s]&&(e.g=e.h[s]);else{if(r===136){r=ut(i).value,i=null,r=v(Us(e,r));for(var o=r.next();!o.done;o=r.next())o=e.h[o.value],o.isVisible()&&(i=$r(o,s,e.i)),th(o);return i}if(r===137)for(i=ut(i).value,i=v(Us(e,i)),r=i.next();!r.done;r=i.next())r=e.h[r.value],r.isVisible()||(r.j=s),r.l=!0;else{if(r===138){for(r=ut(i).value,i=null,r=v(Us(e,r)),o=r.next();!o.done;o=r.next())o=e.h[o.value],o.isVisible()&&(i=$r(o,s,e.i)),o.l=!1;return i}if(r===139){for(r=ut(i).value,i=null,r=v(Us(e,r)),o=r.next();!o.done;o=r.next())o=e.h[o.value],o.isVisible()?i=$r(o,s,e.i):o.j=s,o.l=!o.l;return i}if(r===140)return i=ut(i).value,_g(e,i,s);if(r===143)return s=_g(e,255,s),yg(e),s;if(r===144)i.skip(1),s=ut(i).value,e.g&&(e.g.o=0<(s&128),e.g.u=0<(s&64));else if(r===145)s=ut(i).value,r=ut(i).value,i.skip(1),e.g&&(i=xg((r&48)>>4,(r&12)>>2,r&3),e.g.s=xg((s&48)>>4,(s&12)>>2,s&3),e.g.m=i);else if(r===146)s=ut(i).value,i=ut(i).value,e.g&&(e=e.g,e.h=s&15,e.g=i&63);else if(r===151)i.skip(1),i.skip(1),s=ut(i).value,i.skip(1),e.g&&(e.g.D=s&3);else if(152<=r&&159>=r){if(r=(r&15)-8,o=e.h[r]!==null,!o){var l=new gg;l.j=s,e.h[r]=l}s=ut(i).value,ut(i),ut(i),l=ut(i).value;var h=ut(i).value;i=ut(i).value,o&&!(i&7)||(i=e.h[r],i.h=0,i.g=0,i.u=!1,i.o=!1,i.s="white",i.m="black"),i=e.h[r],i.l=0<(s&32),i.F=(l&15)+1,i.B=(h&63)+1,e.g=e.h[r]}}}return null}function Us(e,i){for(var r=[],s=0;8>s;s++)(i&1)===1&&e.h[s]&&r.push(s),i>>=1;return r}function _g(e,i,r){var s=null;i=v(Us(e,i));for(var o=i.next();!o.done;o=i.next()){o=o.value;var l=e.h[o];l.isVisible()&&(s=$r(l,r,e.i)),e.h[o]=null}return s}function yg(e){e.g=null,e.h=[null,null,null,null,null,null,null,null]}function xg(e,i,r){var s={0:0,1:0,2:1,3:1};return e=s[e],i=s[i],r=s[r],GS[e<<2|i<<1|r]}var vg=new Map([[32," "],[33,""],[37,""],[42,""],[44,""],[48,""],[49,""],[50,""],[51,""],[52,""],[53,""],[57,""],[58,""],[60,""],[61,""],[63,""],[118,""],[119,""],[120,""],[121,""],[122,""],[123,""],[124,""],[125,""],[126,""],[127,""]]),GS="black blue green cyan red magenta yellow white".split(" ");function XS(){this.h=[],this.g=[],this.i=new jS,this.l=0,this.s=new Map([["CC1",new ya(0,0)],["CC2",new ya(0,1)],["CC3",new ya(1,0)],["CC4",new ya(1,1)]]),this.o=this.m=0,this.j=new Map,rh(this)}function rh(e){e.m=0,e.o=0,e=v(e.s.values());for(var i=e.next();!i.done;i=e.next())i=i.value,i.h=2,i.g=i.i,i.m=null,Os(i.i),Os(i.l),Os(i.o)}function qS(e){function i(l,h){return l.pts-h.pts||l.order-h.order}var r=[];e.h.sort(i),e.g.sort(i);for(var s=v(e.h),o=s.next();!o.done;o=s.next())(o=$S(e,o.value))&&r.push(o);for(s=v(e.g),o=s.next();!o.done;o=s.next())HS(e.i,o.value);for(s=v(e.i.i),o=s.next();!o.done;o=s.next())o=YS(e,o.value),r.push.apply(r,O(o));return e.i.i=[],e.h=[],e.g=[],r}function $S(e,i){var r=i.type;if((i.xa&112)===16){var s=i.xa>>3&1;r===0?e.m=s:e.o=s}if(r=e.s.get("CC"+(r<<1|(r?e.o:e.m)+1)),i.xa===255&&i.La===255||!i.xa&&!i.La||!Tg(i.xa)||!Tg(i.La))return 45<=++e.l&&rh(e),null;if(e.l=0,i.xa&=127,i.La&=127,!i.xa&&!i.La)return null;if(e=null,(i.xa&112)===16)e:{if(s=i.xa,e=i.La,r.m===(s<<8|e))r.m=null;else if(r.m=s<<8|e,(s&240)===16&&(e&192)===64){i=[11,11,1,2,3,4,12,13,14,15,5,6,7,8,9,10][(s&7)<<1|e>>5&1];var o=(e&30)>>1;s="white";var l=!1;if(7>o?s=pg[o]:o===7&&(l=!0),e=(e&1)===1,r.h!==Ns){if(o=r.g,r.h===xa&&i!==o.g){var h=1+i-o.h;ag(o,h,1+o.g-o.h,o.h),Ji(o,0,h-1),Ji(o,i+1,15-i)}o.g=i,r.g.m=e,r.g.j=l,r.g.l=s,r.g.o="black"}}else if((s&247)===17&&(e&240)===32)r.g.m=!1,r.g.j=!1,r.g.l="white",Un(r.g,Fs,32),s=!1,i=pg[(e&14)>>1],i==="white_italics"&&(i="white",s=!0),r.g.m=(e&1)===1,r.g.j=s,r.g.l=i;else if((s&247)===16&&(e&240)===32||(s&247)===23&&(e&255)===45)i="black",!(s&7)&&(i=NS[(e&14)>>1]),r.g.o=i;else if((s&247)===17&&(e&240)===48)Un(r.g,lg,e);else if((s&246)===18&&(e&224)===32)Un(r.g,s&1?hg:ug,e);else if((s&246)===20&&(e&240)===32){switch(e=i.pts,s=null,i.La){case 32:dg(r);break;case 33:r=r.g,r.i[r.g].pop();break;case 37:s=eh(r,2,e);break;case 38:s=eh(r,3,e);break;case 39:s=eh(r,4,e);break;case 40:Un(r.g,Fs,32);break;case 41:r.h=2,r.g=r.i,r.g.h=0,r.j=e;break;case 42:Os(r.o),fg(r);break;case 43:fg(r);break;case 44:i=r.i,s=null,r.h!==Ns&&(s=_a(i,r.j,e)),Ji(i,0,15);break;case 45:i=r.g,r.h!==xa?s=null:(s=_a(i,r.j,e),l=i.g-i.h+1,ag(i,l-1,l,i.h),Ji(i,0,l-1),Ji(i,i.g,15-i.g),r.j=e);break;case 46:Ji(r.l,0,15);break;case 47:i=null,r.h!==Ns&&(i=_a(r.i,r.j,e)),s=r.l,r.l=r.i,r.i=s,dg(r),r.j=e,s=i}e=s;break e}e=null}else s=i.La,Un(r.g,Fs,i.xa),Un(r.g,Fs,s);return e}function YS(e,i){var r=[];try{for(;i.ha();){var s=ut(i).value,o=(s&224)>>5,l=s&31;if(o===7&&l!=0&&(o=ut(i).value&63),o!=0){e.j.has(o)||e.j.set(o,new VS(o));for(var h=e.j.get(o),d=i.Z();i.Z()-d<l;){o=i;var g=ut(o),_=g.value,y=g.pts;if(_===16){var S=ut(o);_=_<<16|S.value}if(0<=_&&31>=_){var w=y;if(h.g){var E=h.g;switch(o=null,_){case 8:!mg(E)||0>=E.g&&0>=E.h||(0>=E.g?(E.g=E.B-1,E.h--):E.g--,E.i[E.h][E.g]=null);break;case 13:if(E.isVisible()&&(o=$r(E,w,h.i)),E.h+1>=E.F){w=E;for(var R=0,P=1;16>P;P++,R++)w.i[R]=w.i[P];for(P=0;1>P;P++,R++)w.i[R]=ih()}else E.h++;E.g=0;break;case 14:E.isVisible()&&(o=$r(E,w,h.i)),E.i[E.h]=ih(),E.g=0;break;case 12:E.isVisible()&&(o=$r(E,w,h.i)),th(E),w=E,w.h=0,w.g=0}var L=o}else L=null}else if(128<=_&&159>=_)L=WS(h,o,_,y);else{if(4096<=_&&4127>=_)w=_&255,8<=w&&15>=w?o.skip(1):16<=w&&23>=w?o.skip(2):24<=w&&31>=w&&o.skip(3);else if(4224<=_&&4255>=_)w=_&255,128<=w&&135>=w?o.skip(4):136<=w&&143>=w&&o.skip(5);else if(32<=_&&127>=_)o=_,h.g&&(o===127?qr(h.g,""):qr(h.g,String.fromCharCode(o)));else if(160<=_&&255>=_)h.g&&qr(h.g,String.fromCharCode(_));else if(4128<=_&&4223>=_){if(o=_&255,h.g)if(vg.has(o)){var M=vg.get(o);qr(h.g,M)}else qr(h.g,"_")}else 4256<=_&&4351>=_&&h.g&&((_&255)!=160?qr(h.g,"_"):qr(h.g,"[CC]"));L=null}(o=L)&&r.push(o)}}}}catch(U){if(U instanceof F&&U.code===3e3)kr("CEA708_INVALID_DATA","Buffer read out of bounds / invalid CEA-708 Data.");else throw U}return r}function Tg(e){for(var i=0;e;)i^=e&1,e>>=1;return i===1}function nh(){}nh.prototype.init=function(){},nh.prototype.parse=function(){return[]};function Sg(e,i){var r=null,s=null,o=null,l=e.K();return i&1&&(o=e.$a()),i&2&&e.skip(4),i&8&&(r=e.K()),i&16&&(s=e.K()),{trackId:l,Ce:r,xf:s,rh:o}}function wg(e,i){return{we:i==1?e.$a():e.K()}}function sh(e,i){return i==1?(e.skip(8),e.skip(8)):(e.skip(4),e.skip(4)),{timescale:e.K()}}function Ag(e,i,r){var s=e.K(),o=[],l=null;r&1&&(l=e.K()),r&4&&e.skip(4);for(var h=0;h<s;h++){var d={ee:null,sampleSize:null,ed:null};r&256&&(d.ee=e.K()),r&512&&(d.sampleSize=e.K()),r&1024&&e.skip(4),r&2048&&(d.ed=i==0?e.K():e.Pe()),o.push(d)}return{wh:s,Re:o,wf:l}}function oh(){this.j=new Map,this.i=this.h=0,this.g=ah}oh.prototype.init=function(e){function i(l){l=l.name,l in Ta&&(r.g=Ta[l])}var r=this,s=[],o=[];if(new ze().box("moov",Ke).box("mvex",Ke).P("trex",function(l){var h=l.reader;h.skip(4),h.skip(4),l=h.K(),h=h.K(),r.h=l,r.i=h}).box("trak",Ke).P("tkhd",function(l){var h=l.reader;l.version==1?(h.skip(8),h.skip(8)):(h.skip(4),h.skip(4)),l=h.K(),s.push(l)}).box("mdia",Ke).P("mdhd",function(l){l=sh(l.reader,l.version),o.push(l.timescale)}).box("minf",Ke).box("stbl",Ke).P("stsd",Ls).box("avc1",i).box("avc3",i).box("hev1",i).box("hvc1",i).box("dvh1",i).box("dvhe",i).box("encv",Op).box("sinf",Ke).box("frma",function(l){l=l.reader.K(),l=oa(l),l in Ta&&(r.g=Ta[l])}).parse(e,!0),!s.length||!o.length||s.length!=o.length)throw new F(2,2,2010);this.g==ah&&qe("Unable to determine bitstream format for CEA parsing!"),s.forEach(function(l,h){r.j.set(l,o[h])})},oh.prototype.parse=function(e){var i=this;if(this.g==ah)return[];var r=[],s=this.h,o=this.i,l=[],h=null,d=null,g=null,_=9e4;return new ze().box("moof",function(y){h=y.start,Ke(y)}).box("traf",Ke).P("trun",function(y){y=Ag(y.reader,y.version,y.flags),l=y.Re,d=y.wf}).P("tfhd",function(y){y=Sg(y.reader,y.flags),s=y.Ce||i.h,o=y.xf||i.i,y=y.trackId,i.j.has(y)&&(_=i.j.get(y))}).P("tfdt",function(y){g=wg(y.reader,y.version).we}).box("mdat",function(y){if(g===null)throw new F(2,2,2010);e:{var S=y.reader,w=g,E=_,R=s,P=o,L=l,M=0,U=P;for(L.length&&(U=L[0].sampleSize||P),S.skip((h||0)+(d||0)-y.start-8);S.ha();){y=S.K();var k=S.Ra();switch(i.g){case lh:k&=31,k=k==6;break;case zs:k=k>>1&63,k=k==39||k==40;break;default:break e}if(k){k=0,L.length>M&&(k=L[M].ed||0),k=(w+k)/E;for(var N=[],B,j=S.Za(y-1),V=B=0;V<j.length;)B==2&&j[V]==3?(B=0,j=[].concat(O(j)),j.splice(V,1),j=new Uint8Array(j)):j[V]==0?B++:B=0,V++;for(B=j,V=0;V<B.length;){for(j=0;B[V]==255;)j+=255,V++;j+=B[V++];for(var $=0;B[V]==255;)$+=255,V++;$+=B[V++],j==4&&N.push(B.subarray(V,V+$)),V+=$}for(N=v(N),B=N.next();!B.done;B=N.next())r.push({ig:B.value,pts:k})}else try{S.skip(y-1)}catch(Y){break}U-=y+4,U==0&&(w=L.length>M?w+(L[M].ee||R):w+R,M++,U=L.length>M&&L[M].sampleSize||P)}}}).parse(e,!1),r};var ah=0,lh=1,zs=2,Ta={avc1:lh,avc3:lh,hev1:zs,hvc1:zs,dvh1:zs,dvhe:zs};function Eg(e){this.h=new nh,e.includes("video/mp4")&&(this.h=new oh),this.g=new XS}Eg.prototype.init=function(e){this.h.init(e)};function KS(e,i){i=e.h.parse(i),i=v(i);for(var r=i.next();!r.done;r=i.next()){var s=r.value,o=Ee(s.ig);if(0<o.length&&(r=e.g,s=s.pts,o=new Oe(o,0),o.Ra()===181&&o.$d()===49&&o.K()===1195456820&&o.Ra()===3)){var l=o.Ra();if(l&64){l&=31,o.skip(1);for(var h=0;h<l;h++){var d=o.Ra(),g=(d&4)>>2,_=o.Ra(),y=o.Ra();g&&(d&=3,d===0||d===1?r.h.push({pts:s,type:d,xa:_,La:y,order:r.h.length}):(r.g.push({pts:s,type:d,value:_,order:r.g.length}),r.g.push({pts:s,type:2,value:y,order:r.g.length})))}}}}return qS(e.g)}function ri(e,i,r,s,o){this.ya=e,this.Ba=i,this.ka=r,this.Od=s===void 0?null:s,this.timescale=o}ri.prototype.lc=function(){return this.Ba},ri.prototype.hc=function(){return this.ka};function ZS(e,i){return e&&i?e.lc()==i.lc()&&e.hc()==i.hc()&&vu(e.ya(),i.ya()):e==i}te("shaka.media.InitSegmentReference",ri),ri.prototype.getEndByte=ri.prototype.hc,ri.prototype.getStartByte=ri.prototype.lc;function be(e,i,r,s,o,l,h,d,g,_,y,S,w,E,R){_=_===void 0?[]:_,E=E===void 0?Sa:E,this.startTime=e,this.j=this.endTime=i,this.u=r,this.Ba=s,this.ka=o,this.h=l,this.timestampOffset=h,this.appendWindowStart=d,this.appendWindowEnd=g,this.i=_,this.tilesLayout=y===void 0?"":y,this.s=S===void 0?null:S,this.g=w===void 0?null:w,this.status=E,this.l=R===void 0?null:R,this.o=null,this.m=0}p=be.prototype,p.ya=function(){return this.u()},p.getStartTime=function(){return this.startTime},p.Ef=function(){return this.endTime},p.lc=function(){return this.Ba},p.hc=function(){return this.ka},p.Vf=function(){return this.tilesLayout},p.Uf=function(){return this.s},p.Eb=function(){return this.status},p.bg=function(){this.status=Cg},p.Ye=function(e){this.o=e},p.Sf=function(){return this.o},p.offset=function(e){this.startTime+=e,this.endTime+=e,this.j+=e;for(var i=v(this.i),r=i.next();!r.done;r=i.next())r=r.value,r.startTime+=e,r.endTime+=e,r.j+=e},p.oe=function(e){this.g==null?Pr("Sync attempted without sync time!"):(e=this.g-e-this.startTime,.001<=Math.abs(e)&&this.offset(e))},te("shaka.media.SegmentReference",be),be.prototype.syncAgainst=be.prototype.oe,be.prototype.offset=be.prototype.offset,be.prototype.getThumbnailSprite=be.prototype.Sf,be.prototype.setThumbnailSprite=be.prototype.Ye,be.prototype.markAsUnavailable=be.prototype.bg,be.prototype.getStatus=be.prototype.Eb,be.prototype.getTileDuration=be.prototype.Uf,be.prototype.getTilesLayout=be.prototype.Vf,be.prototype.getEndByte=be.prototype.hc,be.prototype.getStartByte=be.prototype.lc,be.prototype.getEndTime=be.prototype.Ef,be.prototype.getStartTime=be.prototype.getStartTime,be.prototype.getUris=be.prototype.ya;var Sa=0,Cg=1;be.Status={Hg:Sa,oh:Cg,Vg:2};function bg(e){return!e||e.length==1&&1e-6>e.end(0)-e.start(0)?null:e.length==1&&0>e.start(0)?0:e.length?e.start(0):null}function uh(e){return!e||e.length==1&&1e-6>e.end(0)-e.start(0)?null:e.length?e.end(e.length-1):null}function hh(e,i){return!e||!e.length||e.length==1&&1e-6>e.end(0)-e.start(0)||i>e.end(e.length-1)?!1:i>=e.start(0)}function Ig(e,i){if(!e||!e.length||e.length==1&&1e-6>e.end(0)-e.start(0))return 0;var r=0;e=v(vr(e));for(var s=e.next();!s.done;s=e.next()){var o=s.value;s=o.start,o=o.end,o>i&&(r+=o-Math.max(s,i))}return r}function QS(e,i,r){return!e||!e.length||e.length==1&&1e-6>e.end(0)-e.start(0)?null:(e=vr(e).findIndex(function(s,o,l){return s.start>i&&(o==0||l[o-1].end-i<=r)}),0<=e?e:null)}function vr(e){if(!e)return[];for(var i=[],r=0;r<e.length;r++)i.push({start:e.start(r),end:e.end(r)});return i}function Rg(){}function Lg(e,i){var r=(e[i]&127)<<21;return r|=(e[i+1]&127)<<14,r|=(e[i+2]&127)<<7,r|=e[i+3]&127}function JS(e){var i={key:e.type,description:"",data:""};if(e.type==="TXXX"){if(2>e.size||e.data[0]!==3)return null;var r=e.data.subarray(1).indexOf(0);if(r===-1)return null;var s=et(Ee(e.data,1,r));return e=et(Ee(e.data,2+r)).replace(/\0*$/,""),i.description=s,i.data=e,i}return e.type==="WXXX"?2>e.size||e.data[0]!==3||(r=e.data.subarray(1).indexOf(0),r===-1)?null:(s=et(Ee(e.data,1,r)),e=et(Ee(e.data,2+r)).replace(/\0*$/,""),i.description=s,i.data=e,i):e.type==="PRIV"?2>e.size||(s=e.data.indexOf(0),s===-1)?null:(s=et(Ee(e.data,0,s)),e=Jt(e.data.subarray(s.length+1)),i.description=s,i.data=e,i):e.type[0]==="T"?2>e.size||e.data[0]!==3?null:(e=et(e.data.subarray(1)).replace(/\0*$/,""),i.data=e,i):e.type[0]==="W"?(e=et(e.data).replace(/\0*$/,""),i.data=e,i):e.data?(i.data=Jt(e.data),i):null}function wa(e){for(var i=0,r=[];i+10<=e.length&&e[i]===73&&e[i+1]===68&&e[i+2]===51&&255>e[i+3]&&255>e[i+4]&&128>e[i+6]&&128>e[i+7]&&128>e[i+8]&&128>e[i+9];){var s=Lg(e,i+6);for(e[i+5]>>6&1&&(i+=10),i+=10,s=i+s;i+10<s;){var o=e.subarray(i),l=Lg(o,4);o={type:String.fromCharCode(o[0],o[1],o[2],o[3]),size:l,data:o.subarray(10,10+l)},(l=JS(o))&&r.push(l),i+=o.size+10}i+10<=e.length&&e[i]===51&&e[i+1]===68&&e[i+2]===73&&255>e[i+3]&&255>e[i+4]&&128>e[i+6]&&128>e[i+7]&&128>e[i+8]&&128>e[i+9]&&(i+=10)}return r}te("shaka.util.Id3Utils",Rg),Rg.getID3Frames=wa;function Aa(){this.o=null,this.s=!1,this.l=this.m=null,this.B=[],this.g=this.h=null,this.u=[],this.j=null,this.i=[]}Aa.prototype.parse=function(e){if(564>e.length)return this;for(var i=Math.max(0,Mg(e)),r=e.length-(e.length+i)%188,s=!1,o=i;o<r;o+=188)if(e[o]===71){var l=!!(e[o+1]&64),h=((e[o+1]&31)<<8)+e[o+2];if(1<(e[o+3]&48)>>4){var d=o+5+e[o+4];if(d===o+188)continue}else d=o+4;switch(h){case 0:l&&(d+=e[d]+1),this.o=(e[d+10]&31)<<8|e[d+11];break;case 17:case 8191:break;case this.o:l&&(d+=e[d]+1),l=e,h={audio:-1,video:-1,Ed:-1,audioCodec:"",videoCodec:""};var g=d+3+((l[d+1]&15)<<8|l[d+2])-4;for(d+=12+((l[d+10]&15)<<8|l[d+11]);d<g;){var _=(l[d+1]&31)<<8|l[d+2];switch(l[d]){case 15:h.audio===-1&&(h.audio=_,h.audioCodec="aac");break;case 21:h.Ed===-1&&(h.Ed=_);break;case 27:h.video===-1&&(h.video=_,h.videoCodec="avc");break;case 3:case 4:h.audio===-1&&(h.audio=_,h.audioCodec="mp3");break;case 36:h.video===-1&&(h.video=_,h.videoCodec="hvc")}d+=((l[d+3]&15)<<8|l[d+4])+5}l=h,this.l==null&&(this.l=l.video),this.g==null&&(this.g=l.audio),this.j==null&&(this.j=l.Ed),s&&!this.s&&(s=!1,o=i-188),this.s=!0;break;case this.l:l=e.subarray(d,o+188),this.m==null&&(d=ch(l))&&d.pts!=null&&(this.m=d.pts/9e4),this.B.push(l);break;case this.g:l=e.subarray(d,o+188),this.h==null&&(d=ch(l))&&d.pts!=null&&(this.h=d.pts/9e4),this.u.push(l);break;case this.j:this.i.push(e.subarray(d,o+188));break;default:s=!0}}return this};function ch(e){if((e[0]<<16|e[1]<<8|e[2])!==1)return null;var i={data:new Uint8Array(0),vh:6+(e[4]<<8|e[5]),pts:null,dts:null},r=e[7];return r&192&&(i.pts=536870912*(e[9]&14)+4194304*(e[10]&255)+16384*(e[11]&254)+128*(e[12]&255)+(e[13]&254)/2,i.dts=i.pts,r&64&&(i.dts=536870912*(e[14]&14)+4194304*(e[15]&255)+16384*(e[16]&254)+128*(e[17]&255)+(e[18]&254)/2)),i.data=e.subarray(9+e[8]),i}function ew(e){for(var i=[],r=new Uint8Array(0),s=e.i.length-1;0<=s;s--){r=Es(e.i[s],r);var o=ch(r);o&&(i.unshift({cueTime:o.pts?o.pts/9e4:null,data:o.data,frames:wa(o.data),dts:o.dts,pts:o.pts}),r=new Uint8Array(0))}return i}Aa.prototype.getStartTime=function(){return{audio:this.h,video:this.m}};function Mg(e){for(var i=Math.min(1e3,e.length-564),r=0;r<i;){if(e[r]===71&&e[r+188]===71&&e[r+376]===71)return r;r++}return-1}te("shaka.util.TsParser",Aa);function Bs(e,i,r){this.g=null,this.i=-1,this.j=e,this.h=i,this.l=r,typeof libDPIModule>"u"&&qe("Could not Find LCEVC Library dependencies on this page"),typeof LcevcDil>"u"?qe("Could not Find LCEVC Library on this page"):LcevcDil.SupportObject.SupportStatus||qe(LcevcDil.SupportObject.SupportError),typeof LcevcDil<"u"&&typeof libDPIModule<"u"&&this.h instanceof HTMLCanvasElement&&LcevcDil.SupportObject.SupportStatus&&!this.g&&LcevcDil.SupportObject.webGLSupport(this.h)&&(this.h.classList.remove("shaka-hidden"),this.g=new LcevcDil.LcevcDil(this.j,this.h,this.l))}Bs.prototype.release=function(){this.g&&(this.g.close(),this.g=null)};function Pg(e,i){var r=tw;switch(i.mimeType){case"video/webm":r=iw;break;case"video/mp4":r=rw}e.g&&(e.i=i.id,e.g.setLevelSwitching(i.id,!0),e.g.setContainerFormat(r))}te("shaka.lcevc.Dil",Bs),Bs.prototype.release=Bs.prototype.release;var tw=0,iw=1,rw=2;function kg(e,i,r,s){var o=this;this.j=e,this.F=null,this.m=i,this.h={},this.L={},this.O={},this.g=null,this.H=!1,this.V=r||function(){},this.D=s||null,this.i={},this.u=new je,this.o={},this.s=null,this.J=new Ve,this.l=nw(this,this.J),this.G=new Wr(function(){return sw(o)}),this.M="",this.B=!1,this.W=new Ve}function nw(e,i){var r=new MediaSource;return e.u.ma(r,"sourceopen",function(){URL.revokeObjectURL(e.M),i.resolve()}),e.M=gh(r),e.j.src=e.M,r}p=kg.prototype,p.destroy=function(){return this.G.destroy()};function sw(e){var i,r,s,o,l,h,d,g;return z(function(_){if(_.g==1){i=[];for(r in e.i)for(s=e.i[r],o=s[0],e.i[r]=s.slice(0,1),o&&i.push(o.p.catch(TT)),l=v(s.slice(1)),h=l.next();!h.done;h=l.next())d=h.value,d.p.reject(new F(2,7,7003,void 0));e.g&&i.push(e.g.destroy()),e.m&&i.push(e.m.destroy());for(g in e.o)i.push(e.o[g].destroy());return C(_,Promise.all(i),2)}e.u&&(e.u.release(),e.u=null),e.j&&(e.j.removeAttribute("src"),e.j.load(),e.j=null),e.F=null,e.l=null,e.g=null,e.m=null,e.h={},e.o={},e.s=null,e.i={},e.D=null,K(_)})}p.init=function(e,i,r){r=r===void 0?!1:r;var s=this,o,l,h,d,g,_,y,S;return z(function(w){if(w.g==1)return o=wt,C(w,s.J,2);for(s.B=r,l={},h=v(e.keys()),d=h.next();!d.done;l={na:l.na},d=h.next())l.na=d.value,g=e.get(l.na),_=Pi(g.mimeType,g.codecs),l.na==o.X?js(s,_,r):(!i&&Qt(_)||!Du(_,l.na)||(s.o[l.na]=new Yf(_),_=Zf(l.na,_)),y=_+s.F.sourceBufferExtraFeatures,S=s.l.addSourceBuffer(y),s.u.C(S,"error",function(E){return function(){s.i[E.na][0].p.reject(new F(2,3,3014,s.j.error?s.j.error.code:0))}}(l)),s.u.C(S,"updateend",function(E){return function(){return Kr(s,E.na)}}(l)),s.h[l.na]=S,s.L[l.na]=_,s.i[l.na]=[],s.O[l.na]=!!g.drmInfos.length);K(w)})},p.configure=function(e){this.F=e};function js(e,i,r){e.g||(e.g=new $i(e.m));var s=e.g;e=e.H,i!="application/cea-608"&&i!="application/cea-708"&&(s.j=(0,ft[i])(),s.j.setSequenceMode?s.j.setSequenceMode(r):qe('Text parsers should have a "setSequenceMode" method!'),s.u=e)}function Dg(e){return e.l?e.l.readyState=="ended":!0}function Og(e,i){return i==De?e.g.g:bg(Yr(e,i))}function Ea(e,i){return i==De?e.g.h:uh(Yr(e,i))}function ow(e,i,r){return i==De?(e=e.g,e.h==null||e.h<r?0:e.h-Math.max(r,e.g)):(e=Yr(e,i),Ig(e,r))}p.Na=function(){var e={total:vr(this.j.buffered),audio:vr(Yr(this,"audio")),video:vr(Yr(this,"video")),text:[]};if(this.g){var i=this.g.g,r=this.g.h;i!=null&&r!=null&&e.text.push({start:i,end:r})}return e};function Yr(e,i){try{return e.h[i].buffered}catch(r){return null}}function Fg(e,i,r,s,o,l,h){l=l===void 0?!1:l,h=h===void 0?!1:h;var d,g,_,y,S,w,E,R,P,L,M,U,k,N,B,j,V,$,Y,ae,ue,he,Se;return z(function(ne){switch(ne.g){case 1:if(d=wt,i!=d.X){ne.A(2);break}if(!e.B){ne.A(3);break}return C(ne,e.W,4);case 4:g=ne.h,e.g.s=g;case 3:return C(ne,AT(e.g,r,s?s.startTime:null,s?s.endTime:null),5);case 5:return ne.return();case 2:if(_=Ee(r),y=e.L[i],e.o[i]&&(y=e.o[i].o),0>Mg(_)?zn.includes(y)&&(R=wa(_),R.length&&s&&(P={cueTime:s.startTime,data:_,frames:R,dts:s.startTime,pts:s.startTime},e.V([P],0,s.endTime))):(S=new Aa().parse(_),w=s.startTime-(S.getStartTime()[i]||0),E=ew(S),E.length&&e.V(E,w,s?s.endTime:null)),!e.o[i]){o&&i==d.va&&(e.g||js(e,"text/vtt",e.B),e.s||(e.s=new Eg(y)),s?(L=KS(e.s,r),L.length&&(M=e.h[d.va].timestampOffset,ip(e.g,L,s.startTime,s.endTime,M))):e.s.init(r)),ne.A(6);break}return l&&e.o[i].g.resetCaptions(),C(ne,wT(e.o[i],r),7);case 7:U=ne.h,e.g||js(e,"text/vtt",e.B),U.captions&&U.captions.length&&(k=e.h[d.va].timestampOffset,N=CT(U.captions),ip(e.g,N,s?s.startTime:null,s?s.endTime:null,k)),r=U.data;case 6:if(r=cw(e,r,s?s.startTime:null,i),B=e.h[i],j=dw,!e.B||B.mode==j||!s){ne.A(8);break}if(V=e.l.duration,$=i==d.va||!(d.va in e.h),!$){ne.A(9);break}return Y=[B.appendWindowStart,B.appendWindowEnd],B.appendWindowStart=0,B.appendWindowEnd=1/0,ae=B.timestampOffset,B.timestampOffset=0,C(ne,kt(e,i,function(){return Ug(e,i,r)}),10);case 10:return C(ne,kt(e,i,function(){return Ca(e,i)}),11);case 11:return B.timestampOffset=ae,B.appendWindowStart=Y[0],B.appendWindowEnd=Y[1],ue=bg(Yr(e,i)),he=(s.startTime||0)-(ue||0),e.W.resolve(he),C(ne,kt(e,i,function(){return dh(e,i,0,V)}),12);case 12:if(i!=d.va){ne.A(9);break}return C(ne,kt(e,i,function(){e.j.currentTime-=.001,Kr(e,i)}),9);case 9:return B.mode=j,C(ne,e.Aa(V),8);case 8:return s&&e.B&&i!=d.X&&(l||h)&&(Se=s.startTime,kt(e,i,function(){return Ca(e,i)}),kt(e,i,function(){return fh(e,i,Se)})),C(ne,kt(e,i,function(){Ug(e,i,r)}),16);case 16:K(ne)}})}function aw(e,i){var r=Ea(e,"video")||0;ep(e.g,i,r)}function lw(e){e.g&&ep(e.g,"",0)}p.remove=function(e,i,r){var s=this,o;return z(function(l){return o=wt,e==o.X?C(l,s.g.remove(i,r),0):C(l,kt(s,e,function(){return dh(s,e,i,r)}),0)})};function Ng(e,i){var r;return z(function(s){return r=wt,i==r.X?e.g?C(s,e.g.remove(0,1/0),0):s.return():C(s,kt(e,i,function(){return dh(e,i,0,e.l.duration)}),0)})}p.flush=function(e){var i=this,r;return z(function(s){return r=wt,e==r.X?s.return():C(s,kt(i,e,function(){i.j.currentTime-=.001,Kr(i,e)}),0)})};function uw(e,i,r,s,o,l){var h;return z(function(d){return h=wt,i==h.X?(l||(e.g.s=r),ET(e.g,s,o),d.return()):C(d,Promise.all([kt(e,i,function(){return Ca(e,i)}),l?Promise.resolve():kt(e,i,function(){return fh(e,i,r)}),kt(e,i,function(){e.h[i].appendWindowStart=0,e.h[i].appendWindowEnd=o,e.h[i].appendWindowStart=s,Kr(e,i)})]),0)})}function hw(e,i,r){var s;return z(function(o){return s=wt,i==s.X?o.return():(kt(e,i,function(){return Ca(e,i)}),C(o,kt(e,i,function(){return fh(e,i,r)}),0))})}p.endOfStream=function(e){var i=this;return z(function(r){return C(r,zg(i,function(){Dg(i)||(e?i.l.endOfStream(e):i.l.endOfStream())}),0)})},p.Aa=function(e){var i=this;return z(function(r){return C(r,zg(i,function(){if(e<i.l.duration)for(var s in i.h){var o={start:function(){},p:new Ve};i.i[s].unshift(o)}i.l.duration=e}),0)})},p.getDuration=function(){return this.l.duration};function Ug(e,i,r){if(i=="video"&&e.D){var s=e.D;s.g&&s.g.appendBuffer(r,"video",s.i)}e.h[i].appendBuffer(r)}function dh(e,i,r,s){s<=r?Kr(e,i):e.h[i].remove(r,s)}function Ca(e,i){var r=e.h[i].appendWindowStart,s=e.h[i].appendWindowEnd;e.h[i].abort(),e.h[i].appendWindowStart=r,e.h[i].appendWindowEnd=s,Kr(e,i)}function fh(e,i,r){0>r&&(r+=.001),e.h[i].timestampOffset=r,Kr(e,i)}function Kr(e,i){var r=e.i[i][0];r&&(r.p.resolve(),ph(e,i))}function kt(e,i,r){return Ue(e.G),r={start:r,p:new Ve},e.i[i].push(r),e.i[i].length==1&&Bg(e,i),r.p}function zg(e,i){var r,s,o,l,h,d;return z(function(g){switch(g.g){case 1:Ue(e.G),r=[],s={};for(o in e.h)s.Ub=new Ve,l={start:function(_){return function(){return _.Ub.resolve()}}(s),p:s.Ub},e.i[o].push(l),r.push(s.Ub),e.i[o].length==1&&l.start(),s={Ub:s.Ub};return de(g,2),C(g,Promise.all(r),4);case 4:Ae(g,3);break;case 2:throw h=oe(g),h;case 3:try{i()}catch(_){throw new F(2,3,3015,_)}finally{for(d in e.h)ph(e,d)}K(g)}})}function ph(e,i){e.i[i].shift(),Bg(e,i)}function Bg(e,i){var r=e.i[i][0];if(r)try{r.start()}catch(s){s.name=="QuotaExceededError"?r.p.reject(new F(2,3,3017,i)):r.p.reject(new F(2,3,3015,s)),ph(e,i)}}function cw(e,i,r,s){var o=e.O[s];return r==null&&o&&(Cn()||Ts())&&e.L[s].split(";")[0].split("/")[1]=="mp4"&&(i=RS(i)),i}var gh=u.URL.createObjectURL,dw="sequence",zn=["audio/aac","audio/ac3","audio/ec3","audio/mpeg"];function le(e,i,r){this.i=e,this.m=i,this.o=this.j=1/0,this.g=1,this.h=this.l=null,this.s=0,this.u=!0,this.B=0,this.D=r===void 0?!0:r,this.F=0,this.G=!1}p=le.prototype,p.getDuration=function(){return this.j},p.Kf=function(){return this.g},p.Xe=function(e){this.i=e},p.Aa=function(e){this.j=e},p.Pf=function(){return this.i},p.Ve=function(e){this.s=e},p.yc=function(e){this.u=e},p.me=function(e){this.o=e},p.We=function(e){this.m=e},p.Df=function(){return this.m},p.Ib=function(e){if(e.length!=0){var i=e[0].startTime,r=e[0].endTime;e=v(e);for(var s=e.next();!s.done;s=e.next())s=s.value,i=Math.min(i,s.startTime),r=Math.max(r,s.endTime),this.g=Math.max(this.g,s.endTime-s.startTime);this.Td(i),this.h=Math.max(this.h,r),this.i!=null&&this.D&&!this.G&&(this.i=(Date.now()+this.s)/1e3-this.h-this.g)}},p.Md=function(){this.G=!0},p.Td=function(e){this.l=this.l==null?e:Math.min(this.l,e)},p.Sd=function(e){this.g=Math.max(this.g,e)},p.offset=function(e){this.l!=null&&(this.l+=e),this.h!=null&&(this.h+=e)},p.U=function(){return this.j==1/0&&!this.u},p.jb=function(){return this.j!=1/0&&!this.u},p.Pa=function(){return Math.max(this.B,this.gb()-this.o)},p.Ze=function(e){this.B=e},p.gb=function(){return this.U()||this.jb()?Math.min(Math.max(0,(Date.now()+this.s)/1e3-this.g-this.i)+this.F,this.j):this.h?Math.min(this.h,this.j):this.j},p.kc=function(e){var i=Math.max(this.l,this.B);return this.o==1/0?Math.ceil(1e3*i)/1e3:Math.max(i,Math.min(this.gb()-this.o+e,this.Oa()))},p.Db=function(){return this.kc(0)},p.Oa=function(){return Math.max(0,this.gb()-(this.U()||this.jb()?this.m:0))},p.df=function(){return!(this.i==null||this.h!=null&&this.D)},p.Ue=function(e){this.F=e},te("shaka.media.PresentationTimeline",le),le.prototype.setAvailabilityTimeOffset=le.prototype.Ue,le.prototype.usingPresentationStartTime=le.prototype.df,le.prototype.getSeekRangeEnd=le.prototype.Oa,le.prototype.getSeekRangeStart=le.prototype.Db,le.prototype.getSafeSeekRangeStart=le.prototype.kc,le.prototype.getSegmentAvailabilityEnd=le.prototype.gb,le.prototype.setUserSeekStart=le.prototype.Ze,le.prototype.getSegmentAvailabilityStart=le.prototype.Pa,le.prototype.isInProgress=le.prototype.jb,le.prototype.isLive=le.prototype.U,le.prototype.offset=le.prototype.offset,le.prototype.notifyMaxSegmentDuration=le.prototype.Sd,le.prototype.notifyMinSegmentStartTime=le.prototype.Td,le.prototype.lockStartTime=le.prototype.Md,le.prototype.notifySegments=le.prototype.Ib,le.prototype.getDelay=le.prototype.Df,le.prototype.setDelay=le.prototype.We,le.prototype.setSegmentAvailabilityDuration=le.prototype.me,le.prototype.setStatic=le.prototype.yc,le.prototype.setClockOffset=le.prototype.Ve,le.prototype.getPresentationStartTime=le.prototype.Pf,le.prototype.setDuration=le.prototype.Aa,le.prototype.setPresentationStartTime=le.prototype.Xe,le.prototype.getMaxSegmentDuration=le.prototype.Kf,le.prototype.getDuration=le.prototype.getDuration;function jg(e,i,r){this.l=r,this.j=e,this.s=Hg(e),this.g=e.g.currentTime,this.m=Date.now()/1e3,this.h=!1,this.o=0,this.u=i,this.i=function(){}}jg.prototype.release=function(){this.l=this.j=null,this.i=function(){}};function fw(e,i){e.i=i}function pw(e){this.g=e}function Hg(e){if(e.g.paused||e.g.playbackRate==0||e.g.buffered.length==0)var i=!1;else e:{i=e.g.currentTime,e=v(vr(e.g.buffered));for(var r=e.next();!r.done;r=e.next())if(r=r.value,!(i<r.start-.1||i>r.end-.5)){i=!0;break e}i=!1}return i}function mh(e,i,r,s,o){var l=this;this.o=o,this.g=e,this.s=i,this.D=r,this.i=new je,this.m=!1,this.B=e.readyState,this.u=0,this.h=s,this.l=!1,this.i.C(e,"waiting",function(){return _h(l)}),this.j=new we(function(){_h(l)}).Ca(.25)}mh.prototype.release=function(){this.i&&(this.i.release(),this.i=null),this.j!=null&&(this.j.stop(),this.j=null),this.h&&(this.h.release(),this.h=null),this.g=this.s=this.o=null},mh.prototype.Wd=function(){this.l=!0,_h(this)};function _h(e){if(e.g.readyState!=0){if(e.g.seeking){if(!e.m)return}else e.m=!1;if(!e.g.paused||e.g.currentTime==0&&(e.g.autoplay||e.g.currentTime!=0)){e.g.readyState!=e.B&&(e.B=e.g.readyState);var i;if(!(i=!e.h)){i=e.h;var r=i.j,s=Hg(r),o=r.g.currentTime,l=Date.now()/1e3;(i.g!=o||i.s!=s)&&(i.m=l,i.g=o,i.s=s,i.h=!1),o=l-i.m,(s=o>=i.u&&s&&!i.h)&&(i.i(i.g,o),i.h=!0,i.g=r.g.currentTime,i.o++,i.l(new fe("stalldetected"))),i=!s}i&&(i=e.g.currentTime,r=e.g.buffered,s=QS(r,i,e.D.gapDetectionThreshold),s==null||s==0&&!e.l||(o=r.start(s),o>=e.s.Oa()||.001>o-i||(s!=0&&r.end(s-1),e.g.currentTime=o,e.u++,e.o(new fe("gapjumped")))))}}}function Bn(e,i,r,s){i==HTMLMediaElement.HAVE_NOTHING||e.readyState>=i?s():(i=gw.value().get(i),r.ma(e,i,s))}var gw=new An(function(){return new Map([[HTMLMediaElement.HAVE_METADATA,"loadedmetadata"],[HTMLMediaElement.HAVE_CURRENT_DATA,"loadeddata"],[HTMLMediaElement.HAVE_FUTURE_DATA,"canplay"],[HTMLMediaElement.HAVE_ENOUGH_DATA,"canplaythrough"]])});function Vg(e,i,r){var s=this;this.g=e,this.l=i,this.j=r,this.m=!1,this.h=new je,this.i=new qg(e),Bn(this.g,HTMLMediaElement.HAVE_METADATA,this.h,function(){Gg(s,s.j)})}Vg.prototype.release=function(){this.h&&(this.h.release(),this.h=null),this.i!=null&&(this.i.release(),this.i=null),this.l=function(){},this.g=null};function yh(e){return e.m?e.g.currentTime:e.j}function Wg(e,i){0<e.g.readyState?$g(e.i,i):Bn(e.g,HTMLMediaElement.HAVE_METADATA,e.h,function(){Gg(e,e.j)})}function Gg(e,i){.001>Math.abs(e.g.currentTime-i)?Xg(e):(e.h.ma(e.g,"seeking",function(){Xg(e)}),$g(e.i,e.g.currentTime&&e.g.currentTime!=0?e.g.currentTime:i))}function Xg(e){e.m=!0,e.h.C(e.g,"seeking",function(){return e.l()})}function qg(e){var i=this;this.h=e,this.m=10,this.l=this.j=this.i=0,this.g=new we(function(){0>=i.i||i.h.currentTime!=i.j?i.g.stop():(i.h.currentTime=i.l,i.i--)})}qg.prototype.release=function(){this.g&&(this.g.stop(),this.g=null),this.h=null};function $g(e,i){e.j=e.h.currentTime,e.l=i,e.i=e.m,e.h.currentTime=i,e.g.Ca(.1)}function Yg(e){this.g=e,this.j=!1,this.h=null,this.i=new je}p=Yg.prototype,p.yd=function(){function e(){i.h==null||i.h==0?i.j=!0:(i.i.ma(i.g,"seeking",function(){i.j=!0}),i.g.currentTime=Math.max(0,i.g.currentTime+i.h))}var i=this;Bn(this.g,HTMLMediaElement.HAVE_CURRENT_DATA,this.i,function(){e()})},p.release=function(){this.i&&(this.i.release(),this.i=null),this.g=null},p.zd=function(e){this.h=this.j?this.h:e},p.Ic=function(){return(this.j?this.g.currentTime:this.h)||0},p.ue=function(){return 0},p.te=function(){return 0},p.Ne=function(){};function Kg(e,i,r,s,o,l){var h=this;this.i=e,this.g=i.presentationTimeline,this.B=i.minBufferTime||0,this.l=r,this.u=o,this.s=null,this.o=_w(e,r,l),this.j=new mh(e,i.presentationTimeline,r,this.o,l),this.h=new Vg(e,function(){e:{var d=h.j;d.m=!0,d.l=!1;var g=yh(h.h);if(d=Qg(h,g),.001<Math.abs(d-g)&&(g=Date.now()/1e3,!h.s||h.s<g-1)){h.s=g,Wg(h.h,d),d=void 0;break e}h.u(),d=void 0}return d},mw(this,s)),this.m=new we(function(){if(h.i.readyState!=0&&!h.i.paused){var d=yh(h.h),g=h.g.Db(),_=h.g.Oa();3>_-g&&(g=_-3),d<g&&(d=Qg(h,d),h.i.currentTime=d)}})}p=Kg.prototype,p.yd=function(){this.m.Ca(.25)},p.release=function(){this.h&&(this.h.release(),this.h=null),this.j&&(this.j.release(),this.j=null),this.m&&(this.m.stop(),this.m=null),this.i=this.h=this.g=this.l=null,this.u=function(){}},p.zd=function(e){Wg(this.h,e)},p.Ic=function(){var e=yh(this.h);return 0<this.i.readyState&&!this.i.paused?Jg(this,e):e},p.ue=function(){return this.o?this.o.o:0},p.te=function(){return this.j.u};function mw(e,i){return i==null?i=1/0>e.g.getDuration()?e.g.Db():e.g.Oa():0>i&&(i=e.g.Oa()+i),Zg(e,Jg(e,i))}p.Ne=function(){this.j.Wd()};function Zg(e,i){var r=e.g.getDuration();return i>=r?r-e.l.durationBackoff:i}function Qg(e,i){var r=Math.max(e.B,e.l.rebufferingGoal),s=e.l.safeSeekOffset,o=e.g.Db(),l=e.g.Oa(),h=e.g.getDuration();3>l-o&&(o=l-3);var d=e.g.kc(r),g=e.g.kc(s);return r=e.g.kc(r+s),i>=h?Zg(e,i):i>l?l:i<o?hh(e.i.buffered,g)?g:r:i>=d||hh(e.i.buffered,i)?i:r}function Jg(e,i){var r=e.g.Db();return i<r?r:(e=e.g.Oa(),i>e?e:i)}function _w(e,i,r){if(!i.stallEnabled)return null;var s=i.stallSkip;return i=new jg(new pw(e),i.stallThreshold,r),fw(i,function(){s?e.currentTime+=s:(e.pause(),e.play())}),i}function Pe(e){this.g=e,this.h=null,this.i=0,this.j=!1}p=Pe.prototype,p.release=function(){this.j||(this.g=[],this.h&&this.h.stop(),this.h=null)},p.cg=function(){this.j=!0};function yw(e,i){e=v(e.g);for(var r=e.next();!r.done;r=e.next())i(r.value)}p.find=function(e){for(var i=this.g.length-1,r=i;0<=r;--r){var s=this.g[r],o=r<i?this.g[r+1].startTime:s.endTime;if(e>=s.startTime&&e<o)return r+this.i}return this.g.length&&e<this.g[0].startTime?this.i:null},p.get=function(e){return this.g.length==0?null:(e-=this.i,0>e||e>=this.g.length?null:this.g[e])},p.offset=function(e){if(!this.j)for(var i=v(this.g),r=i.next();!r.done;r=i.next())r.value.offset(e)},p.pc=function(e){if(!this.j&&e.length){var i=Math.round(1e3*e[0].startTime)/1e3;this.g=this.g.filter(function(r){return Math.round(1e3*r.startTime)/1e3<i}),this.g.push.apply(this.g,O(e))}},p.Hb=function(e,i){var r=this;e=e.filter(function(s){return s.endTime>i&&(r.g.length==0||s.endTime>r.g[0].startTime)}),this.pc(e),this.eb(i)},p.eb=function(e){if(!this.j){var i=this.g.length;this.g=this.g.filter(function(r){return r.endTime>e}),this.i+=i-this.g.length}},p.Wa=function(e,i,r){if(r=r===void 0?!1:r,!this.j){for(;this.g.length&&this.g[this.g.length-1].startTime>=i;)this.g.pop();for(;this.g.length&&this.g[0].endTime<=e;)this.g.shift(),r||this.i++;this.g.length!=0&&(e=this.g[this.g.length-1],this.g[this.g.length-1]=new be(e.startTime,i,e.u,e.Ba,e.ka,e.h,e.timestampOffset,e.appendWindowStart,e.appendWindowEnd,e.i,e.tilesLayout,e.s,e.g,e.status,e.l))}},p.fd=function(e,i){var r=this;this.j||(this.h&&this.h.stop(),this.h=new we(function(){var s=i();s?r.g.push.apply(r.g,O(s)):(r.h.stop(),r.h=null)}),this.h.Ca(e))},Pe.prototype[Symbol.iterator]=function(){return this.Cb(0)},Pe.prototype.Cb=function(e){var i=this.find(e);if(i==null)return null;i--;var r=this.get(i+1),s=-1;if(r&&0<r.i.length)for(var o=r.i.length-1;0<=o;--o){var l=r.i[o];if(e>=l.startTime&&e<l.endTime){i++,s=o-1;break}}return new vi(this,i,s)};function xh(e,i,r){return new Pe([new be(e,e+i,function(){return r},0,null,null,e,e,e+i)])}te("shaka.media.SegmentIndex",Pe),Pe.forSingleSegment=xh,Pe.prototype.getIteratorForTime=Pe.prototype.Cb,Pe.prototype.updateEvery=Pe.prototype.fd,Pe.prototype.fit=Pe.prototype.Wa,Pe.prototype.evict=Pe.prototype.eb,Pe.prototype.mergeAndEvict=Pe.prototype.Hb,Pe.prototype.offset=Pe.prototype.offset,Pe.prototype.get=Pe.prototype.get,Pe.prototype.find=Pe.prototype.find,Pe.prototype.markImmutable=Pe.prototype.cg,Pe.prototype.release=Pe.prototype.release;function vi(e,i,r){this.i=e,this.g=i,this.h=r}vi.prototype.vf=function(){return this.g},vi.prototype.current=function(){var e=this.i.get(this.g);return e&&0<e.i.length&&e.ya().length&&this.h>=e.i.length&&(this.g++,this.h=0,e=this.i.get(this.g)),e&&0<e.i.length?e.i[this.h]:e},vi.prototype.next=function(){var e=this.i.get(this.g);return e&&0<e.i.length?(this.h++,e.ya().length&&this.h==e.i.length&&(this.g++,this.h=0)):(this.g++,this.h=0),e=this.current(),{value:e,done:!e}},te("shaka.media.SegmentIterator",vi),vi.prototype.next=vi.prototype.next,vi.prototype.current=vi.prototype.current,vi.prototype.currentPosition=vi.prototype.vf;function it(){Pe.call(this,[]),this.l=[]}me(it,Pe),p=it.prototype,p.clone=function(){var e=new it;return e.l=this.l.slice(),e},p.release=function(){for(var e=v(this.l),i=e.next();!i.done;i=e.next())i.value.release();this.l=[]},p.find=function(e){for(var i=0,r=v(this.l),s=r.next();!s.done;s=r.next()){s=s.value;var o=s.find(e);if(o!=null)return o+i;i+=s.i+s.g.length}return null},p.get=function(e){for(var i=0,r=v(this.l),s=r.next();!s.done;s=r.next()){s=s.value;var o=s.get(e-i);if(o)return o;i+=s.i+s.g.length}return null},p.offset=function(){},p.pc=function(){},p.eb=function(){},p.Hb=function(){},p.Wa=function(){},p.fd=function(){},te("shaka.media.MetaSegmentIndex",it),it.prototype.updateEvery=it.prototype.fd,it.prototype.fit=it.prototype.Wa,it.prototype.mergeAndEvict=it.prototype.Hb,it.prototype.evict=it.prototype.eb,it.prototype.merge=it.prototype.pc,it.prototype.offset=it.prototype.offset,it.prototype.get=it.prototype.get,it.prototype.find=it.prototype.find,it.prototype.release=it.prototype.release;function Hs(e){var i=this;this.g=e,this.j=!1,this.i=this.g.Tc(),this.h=new we(function(){i.g.Me(.25*i.i)})}Hs.prototype.release=function(){this.h&&(this.h.stop(),this.h=null),this.g=null},Hs.prototype.set=function(e){this.i=e,em(this)},Hs.prototype.Pc=function(){return this.g.Pc()};function em(e){e.h.stop();var i=e.j?0:e.i;if(0<=i)try{e.g.Tc()!=i&&e.g.le(i);return}catch(r){}e.h.Ca(.25),e.g.Tc()!=0&&e.g.le(0)}function tm(e){var i=this;this.h=e,this.g=new Set,this.i=new we(function(){im(i,!1)}).Ca(.25)}tm.prototype.release=function(){this.i.stop();for(var e=v(this.g),i=e.next();!i.done;i=e.next())i.value.release();this.g.clear()};function im(e,i){for(var r=v(e.g),s=r.next();!s.done;s=r.next())s.value.j(e.h.currentTime,i)}function ba(e){Le.call(this),this.g=new Map,this.h=e}me(ba,Le),ba.prototype.release=function(){this.g.clear(),Le.prototype.release.call(this)};function xw(e,i){var r=e.g.get(i);return r||(r={rc:[],Ae:null,contentType:i},e.g.set(i,r)),r}function vw(e,i,r){var s=xw(e,i.contentType);Tw(e,s),e={Od:i,position:r},s=s.rc,i=s.findIndex(function(o){return o.position>=r}),0<=i?s.splice(i,s[i].position==r?1:0,e):s.push(e)}ba.prototype.j=function(e){for(var i=v(this.g.values()),r=i.next();!r.done;r=i.next()){r=r.value;e:{for(var s=r.rc,o=s.length-1;0<=o;o--){var l=s[o];if(l.position<=e){s=l.Od;break e}}s=null}if((o=s)&&(o=r.Ae,o=!(o===s||o&&s&&o.bandwidth==s.bandwidth&&o.audioSamplingRate==s.audioSamplingRate&&o.codecs==s.codecs&&o.contentType==s.contentType&&o.frameRate==s.frameRate&&o.height==s.height&&o.mimeType==s.mimeType&&o.channelsCount==s.channelsCount&&o.pixelAspectRatio==s.pixelAspectRatio&&o.width==s.width)),o)e:{if(o=e,l=s.contentType,(l=this.h()[l])&&0<l.length){var h=l[l.length-1].end;if(o>=l[0].start&&o<h){o=!0;break e}}o=!1}o&&(r.Ae=s,JSON.stringify(s),r=new fe("qualitychange",new Map([["quality",s],["position",e]])),this.dispatchEvent(r))}};function Tw(e,i){if((e=e.h()[i.contentType])&&0<e.length){var r=e[0].start,s=e[e.length-1].end,o=i.rc;i.rc=o.filter(function(l,h){return!(l.position<=r&&h+1<o.length&&o[h+1].position<=r||l.position>=s)})}else i.rc=[]}function vh(e){Le.call(this);var i=this;this.g=new Set,this.i=e,this.h=new we(function(){for(var r=i.i(),s=v(i.g),o=s.next();!o.done;o=s.next())o=o.value,o.endTime<r.start&&(i.g.delete(o),o=new fe("regionremove",new Map([["region",o]])),i.dispatchEvent(o))}).Ca(2)}me(vh,Le),vh.prototype.release=function(){this.g.clear(),this.h.stop(),Le.prototype.release.call(this)};function Ia(e){Le.call(this);var i=this;this.i=e,this.g=new Map,this.l=[{rb:null,qb:jn,ib:function(r,s){return Zr(i,"enter",r,s)}},{rb:Vs,qb:jn,ib:function(r,s){return Zr(i,"enter",r,s)}},{rb:Ws,qb:jn,ib:function(r,s){return Zr(i,"enter",r,s)}},{rb:jn,qb:Vs,ib:function(r,s){return Zr(i,"exit",r,s)}},{rb:jn,qb:Ws,ib:function(r,s){return Zr(i,"exit",r,s)}},{rb:Vs,qb:Ws,ib:function(r,s){return Zr(i,"skip",r,s)}},{rb:Ws,qb:Vs,ib:function(r,s){return Zr(i,"skip",r,s)}}],this.h=new je,this.h.C(this.i,"regionremove",function(r){i.g.delete(r.region)})}me(Ia,Le),Ia.prototype.release=function(){this.i=null,this.g.clear(),this.h.release(),this.h=null,Le.prototype.release.call(this)},Ia.prototype.j=function(e,i){for(var r=v(this.i.g),s=r.next();!s.done;s=r.next()){s=s.value;var o=this.g.get(s),l=e<s.startTime?Vs:e>s.endTime?Ws:jn;this.g.set(s,l);for(var h=v(this.l),d=h.next();!d.done;d=h.next())d=d.value,d.rb==o&&d.qb==l&&d.ib(s,i)}};function Zr(e,i,r,s){i=new fe(i,new Map([["region",r],["seeking",s]])),e.dispatchEvent(i)}var Vs=1,jn=2,Ws=3;function Th(e,i,r,s,o){return e=ti(e,s,o),(i!=0||r!=null)&&(e.headers.Range=r?"bytes="+i+"-"+r:"bytes="+i+"-"),e}function rm(e,i){var r=this;this.g=i,this.m=e,this.i=null,this.u=1,this.o=this.l=null,this.D=!1,this.j=new Map,this.B=!1,this.F=null,this.s=!1,this.h=new Wr(function(){return Sw(r)})}p=rm.prototype,p.destroy=function(){return this.h.destroy()};function Sw(e){var i,r,s,o;return z(function(l){if(l.g==1){for(i=[],r=v(e.j.values()),s=r.next();!s.done;s=r.next())o=s.value,Gs(o),i.push(am(o));return C(l,Promise.all(i),2)}e.j.clear(),e.g=null,e.m=null,e.i=null,K(l)})}p.configure=function(e){this.i=e,this.F=new wp({maxAttempts:Math.max(e.retryParameters.maxAttempts,2),baseDelay:e.retryParameters.baseDelay,backoffFactor:e.retryParameters.backoffFactor,fuzzFactor:e.retryParameters.fuzzFactor,timeout:0,stallTimeout:0,connectionTimeout:0},!0)},p.start=function(){var e=this;return z(function(i){if(i.g==1)return C(i,bw(e),2);Ue(e.h),e.B=!0,K(i)})};function ww(e,i){var r,s,o,l,h;z(function(d){switch(d.g){case 1:return r=wt,de(d,2),C(d,Ng(e.g.R,r.X),4);case 4:Ae(d,3);break;case 2:s=oe(d),e.g&&e.g.onError(s);case 3:o=Pi(i.mimeType,i.codecs),js(e.g.R,o,e.m.sequenceMode),l=e.g.R.m,(l.isTextVisible()||e.i.alwaysStreamText)&&(h=om(i),e.j.set(r.X,h),ni(e,h,0)),K(d)}})}function Aw(e){var i=e.j.get(De);i&&(Gs(i),am(i).catch(function(){}),e.j.delete(De)),e.o=null}function nm(e,i){var r=e.j.get("video");if(r){var s=r.stream;s&&(i?(i=s.trickModeVideo)&&!r.ob&&(Hn(e,i,!1,0,!1),r.ob=s):(s=r.ob)&&(r.ob=null,Hn(e,s,!0,0,!1)))}}function sm(e,i,r,s,o,l){r=r===void 0?!1:r,s=s===void 0?0:s,o=o===void 0?!1:o,l=l===void 0?!1:l,e.l=i,e.B&&(i.video&&Hn(e,i.video,r,s,o,l),i.audio&&Hn(e,i.audio,r,s,o,l))}function Ra(e,i){e.o=i,e.B&&Hn(e,i,!0,0,!1)}function Hn(e,i,r,s,o,l){var h=e.j.get(i.type);h||i.type!=De?h&&(h.ob&&(i.trickModeVideo?(h.ob=i,i=i.trickModeVideo):h.ob=null),h.stream!=i||o)&&(i.type==De&&js(e.g.R,Pi(i.mimeType,i.codecs),e.m.sequenceMode),h.stream.closeSegmentIndex&&h.stream.closeSegmentIndex(),h.stream=i,h.aa=null,h.ve=!!l,r&&(h.ac?h.hd=!0:h.ra?(h.bb=!0,h.Nc=s,h.hd=!0):(Gs(h),Eh(e,h,!0,s).catch(function(d){e.g&&e.g.onError(d)}))),Ew(e,h).catch(function(d){e.g&&e.g.onError(d)})):ww(e,i)}function Ew(e,i){var r,s;return z(function(o){if(o.g==1)return i.ta?(r=i.stream,s=i.ta,r.segmentIndex?o.A(2):C(o,r.createSegmentIndex(),2)):o.return();if(i.ta!=s||i.stream!=r)return o.return();var l=e.g.Sc(),h=Ea(e.g.R,i.type),d=i.stream.segmentIndex.find(i.pa?i.pa.endTime:l),g=d==null?null:i.stream.segmentIndex.get(d);d=g&&g.ka?g.ka-g.Ba:null,g&&!d&&(d=(g.endTime-g.getStartTime())*(i.stream.bandwidth||0)/8),d?((g=g.h)&&(d+=(g.ka?g.ka-g.Ba:null)||0),g=e.g.getBandwidthEstimate(),l=8*d/g<(h||0)-l-Math.max(e.m.minBufferTime||0,e.i.rebufferingGoal)||i.ta.h.g>d):l=!1,l&&i.ta.abort(),K(o)})}p.vc=function(){if(this.g)for(var e=this.g.Sc(),i=v(this.j.keys()),r=i.next();!r.done;r=i.next()){var s=r.value;r=this.j.get(s),r.aa=null;var o=this.g.R;if(s==De?(o=o.g,o=o.g==null||o.h==null?!1:e>=o.g&&e<o.h):(o=Yr(o,s),o=hh(o,e)),!o){if((Ea(this.g.R,s)!=null||r.ra)&&Cw(this,r),r.ta&&(r.ta.abort(),r.ta=null),s===De&&(s=this.g.R,s.s))for(s=s.s.g,s.l=0,s.h=[],s.g=[],o=s.i,o.i=[],o.h=[],o.g=0,rh(s),s=v(s.j.values()),o=s.next();!o.done;o=s.next())yg(o.value);r.vc=!0}}};function Cw(e,i){i.ac||i.bb||(i.ra?(i.bb=!0,i.Nc=0):Og(e.g.R,i.type)==null?i.Ka==null&&ni(e,i,0):(Gs(i),Eh(e,i,!1,0).catch(function(r){e.g&&e.g.onError(r)})))}function bw(e){var i,r,s,o,l,h,d,g,_,y;return z(function(S){if(S.g==1){if(i=wt,!e.l)throw new F(2,5,5006);return r=new Map,s=new Set,e.l.audio&&(r.set(i.Hc,e.l.audio),s.add(e.l.audio)),e.l.video&&(r.set(i.va,e.l.video),s.add(e.l.video)),e.o&&(r.set(i.X,e.o),s.add(e.o)),o=e.g.R,l=e.i.forceTransmux,C(S,o.init(r,l,e.m.sequenceMode),2)}for(Ue(e.h),e.updateDuration(),h=v(r.keys()),d=h.next();!d.done;d=h.next())g=d.value,_=r.get(g),e.j.has(g)||(y=om(_),e.j.set(g,y),ni(e,y,0));K(S)})}function om(e){return{stream:e,type:e.type,aa:null,pa:null,Zc:null,Kd:null,Jd:null,Id:null,ob:null,endOfStream:!1,ra:!1,Ka:null,bb:!1,Nc:0,hd:!1,ac:!1,vc:!0,Rd:!1,be:!1,nc:!1,ta:null}}p.updateDuration=function(){var e=this.m.presentationTimeline.getDuration();1/0>e?this.g.R.Aa(e):this.g.R.Aa(Math.pow(2,32))};function Iw(e,i){var r,s,o,l,h;return z(function(d){switch(d.g){case 1:if(Ue(e.h),i.ra||i.Ka==null||i.ac)return d.return();if(i.Ka=null,!i.bb){d.A(2);break}return C(d,Eh(e,i,i.hd,i.Nc),3);case 3:return d.return();case 2:if(i.stream.segmentIndex){d.A(4);break}return r=i.stream,C(d,i.stream.createSegmentIndex(),5);case 5:if(r!=i.stream)return r.closeSegmentIndex&&r.closeSegmentIndex(),i.ra||i.Ka||ni(e,i,0),d.return();case 4:de(d,6),s=Rw(e,i),s!=null&&(ni(e,i,s),i.nc=!1),Ae(d,7);break;case 6:return o=oe(d),C(d,lm(e,o),8);case 8:return d.return();case 7:if(l=Array.from(e.j.values()),!e.B||!l.every(function(g){return g.endOfStream})){d.A(0);break}return C(d,e.g.R.endOfStream(),10);case 10:Ue(e.h),h=e.g.R.getDuration(),h!=0&&h<e.m.presentationTimeline.getDuration()&&e.m.presentationTimeline.Aa(h),K(d)}})}function Rw(e,i){if(wh(i))return aw(e.g.R,i.stream.originalId||""),null;i.type==De&&lw(e.g.R);var r=e.g.Sc(),s=i.pa?i.pa.endTime:r,o=ow(e.g.R,i.type,r),l=Math.max(e.m.minBufferTime||0,e.i.rebufferingGoal,e.i.bufferingGoal)*e.u,h=e.m.presentationTimeline.getDuration()-s,d=Ea(e.g.R,i.type);if(1e-6>h&&d)return i.endOfStream=!0,i.type=="video"&&(e=e.j.get(De))&&wh(e)&&(e.endOfStream=!0),null;if(i.endOfStream=!1,o>=l)return e.i.updateIntervalSeconds/2;if(o=Lw(e,i,r,d),!o)return e.i.updateIntervalSeconds;for(l=1/0,h=Array.from(e.j.values()),h=v(h),d=h.next();!d.done;d=h.next())d=d.value,wh(d)||d.aa&&!d.aa.current()||(l=Math.min(l,d.pa?d.pa.endTime:r));return s>=l+e.m.presentationTimeline.g?e.i.updateIntervalSeconds:(Mw(e,i,r,o).catch(function(){}),null)}function Lw(e,i,r,s){if(i.aa)return i.aa.current();if(i.pa||s)return r=i.pa?i.pa.endTime:s,i.Rd=!0,i.aa=i.stream.segmentIndex.Cb(r),i.aa&&i.aa.next().value;e=e.i.inaccurateManifestTolerance,s=Math.max(r-e,0);var o=null;return e&&(i.aa=i.stream.segmentIndex.Cb(s),o=i.aa&&i.aa.next().value),o||(i.aa=i.stream.segmentIndex.Cb(r),o=i.aa&&i.aa.next().value),o}function Mw(e,i,r,s){var o,l,h,d,g,_,y,S,w,E,R,P,L,M,U;return z(function(k){switch(k.g){case 1:if(o=wt,l=i.stream,h=i.aa,i.ra=!0,de(k,2),s.Eb()==2)throw new F(1,1,1011);return C(k,Ow(e,i,s),4);case 4:return Ue(e.h),e.s?k.return():(d=l.mimeType=="video/mp4"||l.mimeType=="audio/mp4",g=u.ReadableStream,e.i.lowLatencyMode&&g&&d&&!s.l?(S=new Uint8Array(0),E=w=!1,R=function(N){var B,j,V;return z(function($){return w||(E=!0,Ue(e.h),e.s)?$.return():(S=kw(S,N),B=!1,j=0,new ze().box("mdat",function(Y){j=Y.size+Y.start,B=!0}).parse(S,!1,!0),B?(V=S.subarray(0,j),S=S.subarray(j),C($,Sh(e,i,r,l,s,V),0)):$.A(0))})},C(k,Ah(e,i,s,R),11)):(_=Ah(e,i,s),C(k,_,7)));case 7:if(y=k.h,Ue(e.h),e.s)return k.return();if(!s.l){k.A(8);break}return C(k,Pw(y,s,h),9);case 9:y=k.h;case 8:return Ue(e.h),i.bb?(i.ra=!1,ni(e,i,0),k.return()):C(k,Sh(e,i,r,l,s,y),6);case 11:if(P=k.h,E){k.A(6);break}return w=!0,Ue(e.h),e.s?k.return():i.bb?(i.ra=!1,ni(e,i,0),k.return()):C(k,Sh(e,i,r,l,s,P),6);case 6:if(Ue(e.h),e.s)return k.return();i.pa=s,h.next(),i.ra=!1,i.be=!1,L=e.g.R.Na(),M=L[i.type],JSON.stringify(M),i.bb||e.g.Wd(s.startTime,s.endTime,i.type),ni(e,i,0),Ae(k,0);break;case 2:if(U=oe(k),Ue(e.h,U),e.s)return k.return();if(i.ra=!1,U.code==7001)i.ra=!1,Gs(i),ni(e,i,0),k.A(0);else if(i.type==o.X&&e.i.ignoreTextStreamFailures)e.j.delete(o.X),k.A(0);else if(U.code==3017)Dw(e,i,U),k.A(0);else return i.nc=!0,U.severity=2,C(k,lm(e,U),0)}})}function Pw(e,i,r){var s,o,l,h;return z(function(d){if(d.g==1)return s=i.l,s.cryptoKey?d.A(2):C(d,s.fetchKey(),3);if(o=s.iv,!o)for(o=Ee(new ArrayBuffer(16)),l=s.firstMediaSequenceNumber+r.g,h=o.byteLength-1;0<=h;h--)o[h]=l&255,l>>=8;return d.return(u.crypto.subtle.decrypt({name:"AES-CBC",iv:o},s.cryptoKey,e))})}function kw(e,i){var r=new Uint8Array(e.length+i.length);return r.set(e),r.set(i,e.length),r}function Dw(e,i,r){if(!Array.from(e.j.values()).some(function(o){return o!=i&&o.be})){var s=Math.round(100*e.u);if(20<s)e.u-=.2;else if(4<s)e.u-=.04;else{i.nc=!0,e.s=!0,e.g.onError(r);return}i.be=!0}ni(e,i,4)}function Ow(e,i,r){var s,o,l,h,d,g,_,y;return z(function(S){return s=[],o=Math.max(0,r.appendWindowStart-.1),l=r.appendWindowEnd+.01,h=r.timestampOffset,(h!=i.Kd||o!=i.Jd||l!=i.Id)&&(d=function(){var w;return z(function(E){if(E.g==1)return de(E,2),i.Jd=o,i.Id=l,i.Kd=h,C(E,uw(e.g.R,i.type,h,o,l,e.m.sequenceMode),4);if(E.g!=2)return Ae(E,0);throw w=oe(E),i.Jd=null,i.Id=null,i.Kd=null,w})},s.push(d())),!ZS(r.h,i.Zc)&&(i.Zc=r.h)&&(g=Ah(e,i,r.h),_=function(){var w,E,R,P;return z(function(L){switch(L.g){case 1:return de(L,2),C(L,g,4);case 4:return w=L.h,Ue(e.h),E=new ze,E.box("moov",Ke).box("trak",Ke).box("mdia",Ke).P("mdhd",function(M){M=sh(M.reader||0,M.version||0),r.h.timescale=M.timescale}).parse(w),R=i.stream.closedCaptions&&0<i.stream.closedCaptions.size,C(L,e.g.xe(i.type,w),5);case 5:return C(L,Fg(e.g.R,i.type,w,null,R),6);case 6:Ae(L,0);break;case 2:throw P=oe(L),i.Zc=null,P}})},e.g.fg(r.startTime,r.h),s.push(_())),e.m.sequenceMode&&(y=i.pa?i.pa.m:null,r.m!=y||i.Rd)&&(i.Rd=!1,s.push(hw(e.g.R,i.type,r.startTime))),C(S,Promise.all(s),0)})}function Sh(e,i,r,s,o,l){var h,d,g,_,y,S;return z(function(w){switch(w.g){case 1:return h=s.closedCaptions&&0<s.closedCaptions.size,g=s.emsgSchemeIdUris!=null&&0<s.emsgSchemeIdUris.length||e.i.dispatchAllEmsgBoxes,_=e.i.parsePrftBox&&!e.D,(g||_)&&(d=new ze),g&&d.P("emsg",function(E){var R=s.emsgSchemeIdUris;if(E.version===0)var P=E.reader.sc(),L=E.reader.sc(),M=E.reader.K(),U=E.reader.K(),k=E.reader.K(),N=E.reader.K(),B=o.startTime+U/M;else M=E.reader.K(),B=E.reader.$a()/M+o.timestampOffset,U=B-o.startTime,k=E.reader.K(),N=E.reader.K(),P=E.reader.sc(),L=E.reader.sc();E=E.reader.Za(E.reader.S.byteLength-E.reader.Z()),(R&&R.includes(P)||e.i.dispatchAllEmsgBoxes)&&(P=="urn:mpeg:dash:event:2012"?e.g.gg():P=="https://aomedia.org/emsg/ID3"?(R=wa(E),R.length&&o&&e.g.hg([{cueTime:o.startTime,data:E,frames:R,dts:o.startTime,pts:o.startTime}],0,o.endTime)):(R=new Map().set("detail",{startTime:B,endTime:B+k/M,schemeIdUri:P,value:L,timescale:M,presentationTimeDelta:U,eventDuration:k,id:N,messageData:E}),R=new fe("emsg",R),e.g.onEvent(R)))}),_&&d.P("prft",function(E){e:{if(!e.D&&o.h.timescale){E.reader.K();var R=E.reader.K(),P=E.reader.K();if(R=1e3*R+P/Math.pow(2,32)*1e3,E.version===0)var L=E.reader.K();else try{L=E.reader.$a()}catch(M){e.D=!0,L=void 0;break e}E=new Date(new Date(Date.UTC(1900,0,1,0,0,0)).getTime()+R).getTime(),L=new Map().set("detail",{wallClockTime:E,programStartDate:new Date(E-L/o.h.timescale*1e3)}),L=new fe("prft",L),e.g.onEvent(L),e.D=!0}L=void 0}return L}),(g||_)&&d.parse(l),C(w,Fw(e,i,r),2);case 2:return Ue(e.h),y=i.vc,i.vc=!1,S=i.ve,i.ve=!1,C(w,e.g.xe(i.type,l),3);case 3:return C(w,Fg(e.g.R,i.type,l,o,h,y,S),4);case 4:Ue(e.h),K(w)}})}function Fw(e,i,r){var s,o,l,h;return z(function(d){if(d.g==1)return s=Math.max(e.i.bufferBehind,e.m.presentationTimeline.g),o=Og(e.g.R,i.type),o==null?d.return():(l=r-o,h=l-s,.01>=h?d.return():C(d,e.g.R.remove(i.type,o,o+h),2));Ue(e.h),K(d)})}function wh(e){return e&&e.type==De&&(e.stream.mimeType=="application/cea-608"||e.stream.mimeType=="application/cea-708")}function Ah(e,i,r,s){var o,l,h,d,g;return z(function(_){return _.g==1?(o=xr,l=Th(r.ya(),r.Ba,r.ka,e.i.retryParameters,s),h=i.stream,e.g.modifySegmentRequest(l,{type:h.type,init:r instanceof ri,duration:r.endTime-r.startTime,mimeType:h.mimeType,codecs:h.codecs,bandwidth:h.bandwidth}),d=e.g.kb.request(o,l),i.ta=d,C(_,d.promise,2)):(g=_.h,i.ta=null,_.return(g.data))})}function Eh(e,i,r,s){var o,l;return z(function(h){if(h.g==1)return i.bb=!1,i.hd=!1,i.Nc=0,i.ac=!0,i.pa=null,i.Zc=null,i.aa=null,s?(o=e.g.Sc(),l=e.g.R.getDuration(),C(h,e.g.R.remove(i.type,o+s,l),3)):C(h,Ng(e.g.R,i.type),4);if(h.g!=3)return Ue(e.h),r?C(h,e.g.R.flush(i.type),3):h.A(3);Ue(e.h),i.ac=!1,i.endOfStream=!1,i.ra||i.Ka||ni(e,i,0),K(h)})}function ni(e,i,r){var s=i.type;(s!=De||e.j.has(s))&&(i.Ka=new vs(function(){var o;return z(function(l){if(l.g==1)return de(l,2),C(l,Iw(e,i),4);if(l.g!=2)return Ae(l,0);o=oe(l),e.g&&e.g.onError(o),K(l)})}).N(r))}function Gs(e){e.Ka!=null&&(e.Ka.stop(),e.Ka=null)}function am(e){return z(function(i){return e.ta?C(i,e.ta.abort(),0):i.A(0)})}function lm(e,i){return z(function(r){if(r.g==1)return C(r,Ap(e.F),2);Ue(e.h),e.g.onError(i),i.handled||e.i.failureCallback(i),K(r)})}function um(e,i){var r=qn(),s=this;this.j=i,this.i=e,this.l=r,this.o=null,this.m=[],this.h=this.g=null,this.u=Promise.resolve().then(function(){return Uw(s)}),this.s=new Wr(function(){return Nw(s)})}um.prototype.destroy=function(){return this.s.destroy()};function Nw(e){var i,r,s;return z(function(o){if(o.g==1)return e.h&&e.h.abort(),hm(e),C(o,e.u,2);for(e.g&&e.g.Ia.mb(),i=v(e.m),r=i.next();!r.done;r=i.next())s=r.value,s.Ia.mb();e.g=null,e.m=[],e.j=null,K(o)})}function Xs(e,i){var r={Jb:function(){},bd:function(){},mb:function(){},onError:function(){},dd:function(){},uh:function(){}};return e.m.push({create:i,Ia:r}),e.h&&e.h.abort(),hm(e),r}function Uw(e){return z(function(i){if(e.s.g)i=i.A(0);else{if(e.m.length==0||e.g&&!e.g.hb)var r=!1;else{e.g&&(e.g.Ia.mb(),e.g=null),r=e.m.shift();var s=r.create(e.l);s?(r.Ia.Jb(),e.g={node:s.node,payload:s.payload,hb:s.hb,Ia:r.Ia}):r.Ia.dd(),r=!0}r?r=Promise.resolve():e.g?r=zw(e):(e.j.eg(e.i),e.o=new Ve,r=e.o),i=C(i,r,1)}return i})}function zw(e){var i,r;return z(function(s){switch(s.g){case 1:return e.i=e.j.Mf(e.i,e.l,e.g.node,e.g.payload),de(s,2),e.h=e.j.yf(e.i,e.l,e.g.payload),C(s,e.h.promise,4);case 4:e.h=null,e.i==e.g.node&&(e.g.Ia.bd(),e.g=null),Ae(s,0);break;case 2:return i=oe(s),i.code==7001?e.g.Ia.mb():e.g.Ia.onError(i),e.g=null,e.h=null,r=e,C(s,e.j.handleError(e.l,i),5);case 5:r.i=s.h,K(s)}})}function hm(e){e.o&&(e.o.resolve(),e.o=null)}function cm(e){var i=[],r=700<=e.fontWeight,s=e.fontStyle=="italic",o=e.textDecoration.includes("underline");return r&&i.push("b"),s&&i.push("i"),o&&i.push("u"),r=i.reduce(function(l,h){return l+"<"+h+">"},""),i=i.reduceRight(function(l,h){return l+"</"+h+">"},""),e.lineBreak?`
`:e.nestedCues.length?e.nestedCues.map(cm).join(""):r+e.payload+i}function Ch(e,i){e=v(e);for(var r=e.next();!r.done;r=e.next())if(r=r.value,r.isContainer)Ch(r.nestedCues,i);else{var s=r.clone();s.nestedCues=[],s.payload=cm(r),i.push(s)}return i}function Ht(e){this.g=null;for(var i=v(Array.from(e.textTracks)),r=i.next();!r.done;r=i.next())r=r.value,r.mode="disabled",r.label=="Shaka Player TextTrack"&&(this.g=r);this.g||(this.g=e.addTextTrack("subtitles","Shaka Player TextTrack")),this.g.mode="hidden"}p=Ht.prototype,p.remove=function(e,i){return this.g?(dm(this.g,function(r){return r.startTime<i&&r.endTime>e}),!0):!1},p.append=function(e){var i=Ch(e,[]),r=[];e=this.g.cues?Array.from(this.g.cues):[];var s={};i=v(i);for(var o=i.next();!o.done;s={sb:s.sb},o=i.next())s.sb=o.value,e.some(function(l){return function(h){return h.startTime==l.sb.startTime&&h.endTime==l.sb.endTime&&h.text==l.sb.payload}}(s))||(o=Bw(s.sb))&&r.push(o);for(e=r.slice().sort(function(l,h){return l.startTime!=h.startTime?l.startTime-h.startTime:l.endTime!=h.endTime?l.endTime-h.startTime:"line"in VTTCue.prototype?r.indexOf(h)-r.indexOf(l):r.indexOf(l)-r.indexOf(h)}),e=v(e),s=e.next();!s.done;s=e.next())this.g.addCue(s.value)},p.destroy=function(){return this.g&&(dm(this.g,function(){return!0}),this.g.mode="disabled"),this.g=null,Promise.resolve()},p.isTextVisible=function(){return this.g.mode=="showing"},p.setTextVisibility=function(e){this.g.mode=e?"showing":"hidden"};function Bw(e){if(e.startTime>=e.endTime)return null;var i=new VTTCue(e.startTime,e.endTime,e.payload);i.lineAlign=e.lineAlign,i.positionAlign=e.positionAlign,e.size&&(i.size=e.size);try{i.align=e.textAlign}catch(r){}return e.textAlign=="center"&&i.align!="center"&&(i.align="middle"),e.writingMode=="vertical-lr"?i.vertical="lr":e.writingMode=="vertical-rl"&&(i.vertical="rl"),e.lineInterpretation==1&&(i.snapToLines=!1),e.line!=null&&(i.line=e.line),e.position!=null&&(i.position=e.position),i}function dm(e,i){var r=e.mode;e.mode=r=="showing"?"showing":"hidden";for(var s=v(Array.from(e.cues)),o=s.next();!o.done;o=s.next())(o=o.value)&&i(o)&&e.removeCue(o);e.mode=r}te("shaka.text.SimpleTextDisplayer",Ht),Ht.prototype.setTextVisibility=Ht.prototype.setTextVisibility,Ht.prototype.isTextVisible=Ht.prototype.isTextVisible,Ht.prototype.destroy=Ht.prototype.destroy,Ht.prototype.append=Ht.prototype.append,Ht.prototype.remove=Ht.prototype.remove;function fm(){}function La(e){for(;e.firstChild;)e.removeChild(e.firstChild)}te("shaka.util.Dom",fm),fm.removeAllChildren=La;function Vt(e,i){var r=this;this.j=!1,this.i=[],this.B=e,this.m=i,this.g=document.createElement("div"),this.g.classList.add("shaka-text-container"),this.g.style.textAlign="center",this.g.style.display="flex",this.g.style.flexDirection="column",this.g.style.alignItems="center",this.g.style.justifyContent="flex-end",this.m.appendChild(this.g),this.u=new we(function(){qs(r)}).Ca(.25),this.h=new Map,this.s=new je,this.s.C(document,"fullscreenchange",function(){qs(r,!0)}),this.l=null,"ResizeObserver"in u&&(this.l=new ResizeObserver(function(){qs(r,!0)}),this.l.observe(this.g)),this.o=new Map}p=Vt.prototype,p.append=function(e){var i=[].concat(O(this.i)),r={};e=v(e);for(var s=e.next();!s.done;r={Cc:r.Cc},s=e.next())r.Cc=s.value,i.some(function(o){return function(l){return Df(l,o.Cc)}}(r))||this.i.push(r.Cc);qs(this)},p.destroy=function(){this.m.removeChild(this.g),this.g=null,this.j=!1,this.i=[],this.u&&this.u.stop(),this.h.clear(),this.s&&(this.s.release(),this.s=null),this.l&&(this.l.disconnect(),this.l=null)},p.remove=function(e,i){if(!this.g)return!1;var r=this.i.length;return this.i=this.i.filter(function(s){return s.startTime<e||s.endTime>=i}),qs(this,r>this.i.length),!0},p.isTextVisible=function(){return this.j},p.setTextVisibility=function(e){this.j=e};function jw(e,i){for(;i!=null;){if(i==e.g)return!0;i=i.parentElement}return!1}function pm(e,i,r,s,o){var l=!1,h=[],d=[];i=v(i);for(var g=i.next();!g.done;g=i.next()){g=g.value,o.push(g);var _=e.h.get(g),y=g.startTime<=s&&g.endTime>s,S=_?_.ef:null;_&&(h.push(_.Bd),_.tc&&h.push(_.tc),y||(l=!0,e.h.delete(g),_=null)),y&&(d.push(g),_?jw(e,S)||(l=!0):(Hw(e,g,o),_=e.h.get(g),S=_.ef,l=!0)),0<g.nestedCues.length&&S&&pm(e,g.nestedCues,S,s,o),o.pop()}if(l){for(s=v(h),o=s.next();!o.done;o=s.next())o=o.value,o.parentElement&&o.parentElement.removeChild(o);for(d.sort(function(w,E){return w.startTime!=E.startTime?w.startTime-E.startTime:w.endTime-E.endTime}),d=v(d),g=d.next();!g.done;g=d.next())s=e.h.get(g.value),s.tc?(r.appendChild(s.tc),s.tc.appendChild(s.Bd)):r.appendChild(s.Bd)}}function qs(e,i){if(e.g){var r=e.B.currentTime;if(!e.j||i!==void 0&&i){i=v(e.o.values());for(var s=i.next();!s.done;s=i.next())La(s.value);La(e.g),e.h.clear(),e.o.clear()}if(e.j){i=new Map,s=v(e.h.keys());for(var o=s.next();!o.done;o=s.next())o=o.value,i.set(o,e.h.get(o));pm(e,e.i,e.g,r,[])}}}function Hw(e,i,r){var s=1<r.length,o=s?"span":"div";i.lineBreak&&(o="br"),s=!s&&0<i.nestedCues.length;var l=document.createElement(o);if(o!="br"&&Vw(e,l,i,r,s),r=null,i.region&&i.region.id)if(r=i.region,o=r.id+"_"+r.width+"x"+r.height+(r.heightUnits==Mi?"%":"px")+"-"+r.viewportAnchorX+"x"+r.viewportAnchorY+(r.viewportAnchorUnits==Mi?"%":"px"),e.o.has(o))r=e.o.get(o);else{var h=document.createElement("span"),d=r.heightUnits==Mi?"%":"px",g=r.widthUnits==Mi?"%":"px",_=r.viewportAnchorUnits==Mi?"%":"px";h.id="shaka-text-region---"+o,h.classList.add("shaka-text-region"),h.style.height=r.height+d,h.style.width=r.width+g,h.style.position="absolute",h.style.top=r.viewportAnchorY+_,h.style.left=r.viewportAnchorX+_,h.style.display="flex",h.style.flexDirection="column",h.style.alignItems="center",h.style.justifyContent=i.displayAlign=="before"?"flex-start":i.displayAlign=="center"?"center":"flex-end",e.o.set(o,h),r=h}o=l,s&&(o=document.createElement("span"),o.classList.add("shaka-text-wrapper"),o.style.backgroundColor=i.backgroundColor,o.style.lineHeight="normal",l.appendChild(o)),e.h.set(i,{Bd:l,ef:o,tc:r})}function Vw(e,i,r,s,o){var l=i.style,h=r.nestedCues.length==0,d=1<s.length;l.whiteSpace="pre-wrap";var g=r.payload.replace(/\s+$/g,function(y){return"".repeat(y.length)});if(l.webkitTextStrokeColor=r.textStrokeColor,l.webkitTextStrokeWidth=r.textStrokeWidth,l.color=r.color,l.direction=r.direction,l.opacity=r.opacity,l.paddingLeft=bh(r.linePadding,r,e.m),l.paddingRight=bh(r.linePadding,r,e.m),l.textShadow=r.textShadow,r.backgroundImage)l.backgroundImage="url('"+r.backgroundImage+"')",l.backgroundRepeat="no-repeat",l.backgroundSize="contain",l.backgroundPosition="center",l.width="100%",l.height="100%";else{if(r.nestedCues.length)var _=i;else _=document.createElement("span"),i.appendChild(_);r.border&&(_.style.border=r.border),o||((i=Ww(s,function(y){return y.backgroundColor}))?_.style.backgroundColor=i:g&&(_.style.backgroundColor="rgba(0, 0, 0, 0.8)")),g&&(_.textContent=g)}d&&!s[s.length-1].isContainer?l.display="inline":(l.display="flex",l.flexDirection="column",l.alignItems="center",l.justifyContent=r.displayAlign=="before"?"flex-start":r.displayAlign=="center"?"center":"flex-end"),h||(l.margin="0"),l.fontFamily=r.fontFamily,l.fontWeight=r.fontWeight.toString(),l.fontStyle=r.fontStyle,l.letterSpacing=r.letterSpacing,l.fontSize=bh(r.fontSize,r,e.m),r.line!=null&&r.lineInterpretation==1&&(l.position="absolute",r.writingMode==gs?(l.width="100%",r.lineAlign==Or?l.top=r.line+"%":r.lineAlign=="end"&&(l.bottom=100-r.line+"%")):r.writingMode=="vertical-lr"?(l.height="100%",r.lineAlign==Or?l.left=r.line+"%":r.lineAlign=="end"&&(l.right=100-r.line+"%")):(l.height="100%",r.lineAlign==Or?l.right=r.line+"%":r.lineAlign=="end"&&(l.left=100-r.line+"%"))),l.lineHeight=r.lineHeight,r.position!=null&&(r.writingMode==gs?l.paddingLeft=r.position:l.paddingTop=r.position),r.positionAlign=="line-left"?l.cssFloat="left":r.positionAlign=="line-right"&&(l.cssFloat="right"),l.textAlign=r.textAlign,l.textDecoration=r.textDecoration.join(" "),l.writingMode=r.writingMode,"writingMode"in document.documentElement.style&&l.writingMode==r.writingMode||(l.webkitWritingMode=r.writingMode),r.size&&(r.writingMode==gs?l.width=r.size+"%":l.height=r.size+"%")}function bh(e,i,r){var s=(s=new RegExp(/(\d*\.?\d+)([a-z]+|%+)/).exec(e))?{value:Number(s[1]),unit:s[2]}:null;if(!s)return e;var o=s.value;switch(s.unit){case"%":return o/100*r.clientHeight/i.cellResolution.rows+"px";case"c":return r.clientHeight*o/i.cellResolution.rows+"px";default:return e}}function Ww(e,i){for(var r=e.length-1;0<=r;r--){var s=i(e[r]);if(s||s===0)return s}return null}te("shaka.text.UITextDisplayer",Vt),Vt.prototype.setTextVisibility=Vt.prototype.setTextVisibility,Vt.prototype.isTextVisible=Vt.prototype.isTextVisible,Vt.prototype.remove=Vt.prototype.remove,Vt.prototype.destroy=Vt.prototype.destroy,Vt.prototype.append=Vt.prototype.append;function Gw(e,i){function r(l){for(var h=l,d=v(i),g=d.next();!g.done;g=d.next())g=g.value,g.end&&g.start<l&&(h+=g.end-g.start);return l=Math.floor(h/3600),d=Math.floor(h/60%60),g=Math.floor(h%60),h=Math.floor(1e3*h%1e3),(10>l?"0":"")+l+":"+(10>d?"0":"")+d+":"+(10>g?"0":"")+g+"."+(100>h?10>h?"00":"0":"")+h}var s=Ch(e,[]);e=`WEBVTT

`,s=v(s);for(var o=s.next();!o.done;o=s.next())o=o.value,e+=r(o.startTime)+" --> "+r(o.endTime)+function(l){var h=[];switch(l.textAlign){case"left":h.push("align:left");break;case"right":h.push("align:right");break;case Xi:h.push("align:middle");break;case"start":h.push("align:start");break;case"end":h.push("align:end")}switch(l.writingMode){case"vertical-lr":h.push("vertical:lr");break;case"vertical-rl":h.push("vertical:rl")}return h.length?" "+h.join(" "):""}(o)+`
`,e+=o.payload+`

`;return e}te("shaka.text.WebVttGenerator",function(){});function Xw(e,i){this.h=e,this.g=i,this.j="",this.o=void 0,this.i=!1,this.m=!0,this.l=!1}function gm(e,i,r){try{if(e.g.enabled){var s={d:1e3*r.duration,st:e.h.U()?e1:Jw};s.ot=$w(r);var o=s.ot===Pa||s.ot===Mh||s.ot===ka||s.ot===kh;o&&(s.bl=Yw(e,r.type)),r.bandwidth&&(s.br=r.bandwidth/1e3),o&&s.ot!==kh&&(s.tb=Kw(e,s.ot)/1e3),Rh(e,i,s)}}catch(l){kr("CMCD_SEGMENT_ERROR","Could not generate segment CMCD data.",l)}}function qw(e,i,r){try{if(!e.g.enabled)return i;var s=Ih(e);e:{switch(r){case"video/webm":case"video/mp4":var o=ka;break e;case"application/x-mpegurl":o=mm;break e}o=void 0}s.ot=o,s.su=!0;var l=Ma(s);return Lh(i,l)}catch(h){return kr("CMCD_SRC_ERROR","Could not generate src CMCD data.",h),i}}function Ih(e){return e.j||(e.j=e.g.sessionId||u.crypto.randomUUID()),{v:1,sf:e.o,sid:e.j,cid:e.g.contentId,mtp:e.h.getBandwidthEstimate()/1e3}}function Rh(e,i,r){r=r===void 0?{}:r;var s=s===void 0?e.g.useHeaders:s;if(e.g.enabled){Object.assign(r,Ih(e)),r.pr=e.h.Rc();var o=r.ot===Pa||r.ot===ka;if(e.l&&o&&(r.bs=!0,r.su=!0,e.l=!1),r.su==null&&(r.su=e.m),s)e=Zw(r),Object.keys(e).length&&Object.assign(i.headers,e);else{var l=Ma(r);l&&(i.uris=i.uris.map(function(h){return Lh(h,l)}))}}}function $w(e){var i=e.type;if(e.init)return Qw;if(i=="video")return e.codecs.includes(",")?ka:Pa;if(i=="audio")return Mh;if(i=="text")return e.mimeType==="application/mp4"?kh:Ph}function Yw(e,i){if(i=e.h.Na()[i],!i.length)return NaN;var r=e.h.getCurrentTime();return(e=i.find(function(s){return s.start<=r&&s.end>=r}))?1e3*(e.end-r):NaN}function Kw(e,i){var r=e.h.Xa();if(!r.length)return NaN;e=r[0],r=v(r);for(var s=r.next();!s.done;s=r.next())s=s.value,s.type==="variant"&&s.bandwidth>e.bandwidth&&(e=s);switch(i){case Pa:return e.videoBandwidth||NaN;case Mh:return e.audioBandwidth||NaN;default:return e.bandwidth}}function Ma(e){function i(S){return 100*r(S/100)}function r(S){return Math.round(S)}function s(S){return!Number.isNaN(S)&&S!=null&&S!==""&&S!==!1}var o=[],l={br:r,d:r,bl:i,dl:i,mtp:i,nor:function(S){return encodeURIComponent(S)},rtp:i,tb:r},h=Object.keys(e||{}).sort();h=v(h);for(var d=h.next();!d.done;d=h.next()){d=d.value;var g=e[d];if(s(g)&&(d!=="v"||g!==1)&&(d!="pr"||g!==1)){var _=l[d];_&&(g=_(g)),_=typeof g;var y=void 0;y=_==="string"&&d!=="ot"&&d!=="sf"&&d!=="st"?d+"="+JSON.stringify(g):_==="boolean"?d:_==="symbol"?d+"="+g.description:d+"="+g,o.push(y)}}return o.join(",")}function Zw(e){var i=Object.keys(e),r={},s=["Object","Request","Session","Status"],o=[{},{},{},{}],l={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3};i=v(i);for(var h=i.next();!h.done;h=i.next())h=h.value,o[l[h]!=null?l[h]:1][h]=e[h];for(e=0;e<o.length;e++)(l=Ma(o[e]))&&(r["CMCD-"+s[e]]=l);return r}function Lh(e,i){return!i||e.includes("offline:")?e:(e=new jt(e),e.g.set("CMCD",i),e.toString())}var mm="m",Mh="a",Pa="v",ka="av",Qw="i",Ph="c",kh="tt",Jw="v",e1="l";te("shaka.util.CmcdManager.StreamingFormat",{DASH:"d",HLS:"h",dh:"s",Yg:"o"});function Dh(){}function Oh(e,i,r,s,o){var l=o in s,h=!0,d;for(d in i){var g=o+"."+d,_=l?s[o]:r[d];l||d in r?i[d]===void 0?_===void 0||l?delete e[d]:e[d]=Dn(_):_.constructor==Object&&i[d]&&i[d].constructor==Object?(e[d]||(e[d]=Dn(_)),g=Oh(e[d],i[d],_,s,g),h=h&&g):typeof i[d]!=typeof _||i[d]==null||typeof i[d]!="function"&&i[d].constructor!=_.constructor?(Pr("Invalid config, wrong type for "+g),h=!1):(typeof r[d]=="function"&&r[d].length!=i[d].length&&qe("Unexpected number of arguments for "+g),e[d]=i[d]):(Pr("Invalid config, unrecognized key "+g),h=!1)}return h}function Fh(e,i){for(var r={},s=r,o=0,l=0;o=e.indexOf(".",o),!(0>o);)(o==0||e[o-1]!="\\")&&(l=e.substring(l,o).replace(/\\\./g,"."),s[l]={},s=s[l],l=o+1),o+=1;return s[e.substring(l).replace(/\\\./g,".")]=i,r}function Nh(e,i){return e&&i}te("shaka.util.ConfigUtils",Dh),Dh.convertToConfigObject=Fh,Dh.mergeConfigObjects=Oh;function Ti(){}function _m(e){return e=zr(e),new jt(e).Ha}function $s(e,i,r){function s(d){Ot(l).setUint32(h,d.byteLength,!0),h+=4,l.set(Ee(d),h),h+=d.byteLength}if(!r||!r.byteLength)throw new F(2,6,6015);var o;typeof i=="string"?o=Pu(i,!0):o=i,e=zr(e),e=Pu(e,!0);var l=new Uint8Array(12+e.byteLength+o.byteLength+r.byteLength),h=0;return s(e),s(o),s(r),l}te("shaka.util.FairPlayUtils",Ti),Ti.commonFairPlayResponse=function(e,i){if(e===2){try{var r=et(i.data)}catch(o){return}e=!1,r=r.trim(),r.substr(0,5)==="<ckc>"&&r.substr(-6)==="</ckc>"&&(r=r.slice(5,-6),e=!0);try{var s=JSON.parse(r);s.ckc&&(r=s.ckc,e=!0),s.CkcMessage&&(r=s.CkcMessage,e=!0),s.License&&(r=s.License,e=!0)}catch(o){}e&&(i.data=Jt(qi(r)))}},Ti.conaxFairPlayRequest=function(e,i){e===2&&(i.headers["Content-Type"]="application/octet-stream")},Ti.ezdrmFairPlayRequest=function(e,i){e===2&&(i.headers["Content-Type"]="application/octet-stream")},Ti.verimatrixFairPlayRequest=function(e,i){e===2&&(e=Ee(i.body),e=Br(e),i.headers["Content-Type"]="application/x-www-form-urlencoded",i.body=mr("spc="+e))},Ti.conaxInitDataTransform=function(e,i,r){if(i!=="skd")return e;i=r.serverCertificate,r=zr(e).split("skd://").pop().split("?").shift(),r=u.atob(r);var s=new ArrayBuffer(2*r.length);s=new Uint16Array(s);for(var o=0,l=r.length;o<l;o++)s[o]=r.charCodeAt(o);return $s(e,s,i)},Ti.ezdrmInitDataTransform=function(e,i,r){return i!=="skd"?e:(i=r.serverCertificate,r=zr(e).split(";").pop(),$s(e,r,i))},Ti.verimatrixInitDataTransform=function(e,i,r){return i!=="skd"?e:(i=r.serverCertificate,r=zr(e).split("skd://").pop(),$s(e,r,i))},Ti.initDataTransform=$s,Ti.defaultGetContentId=_m,Ti.isFairPlaySupported=function(){var e;return z(function(i){return i.g==1?(e={initDataTypes:["cenc","sinf","skd"],videoCapabilities:[{contentType:'video/mp4; codecs="avc1.42E01E"'}]},de(i,2),C(i,navigator.requestMediaKeySystemAccess("com.apple.fps",[e]),4)):i.g!=2?i.return(!0):(oe(i),i.return(!1))})};function Uh(){}function Vn(){var e=1/0;navigator.connection&&navigator.connection.saveData&&(e=360);var i={retryParameters:Pn(),servers:{},clearKeys:{},advanced:{},delayLicenseRequestUntilPlayed:!1,initDataTransform:function(h,d,g){return g.keySystem=="com.apple.fps.1_0"&&d=="skd"&&(d=g.serverCertificate,g=_m(h),h=$s(h,g,d)),h},logLicenseExchange:!1,updateExpirationTime:1,preferredKeySystems:[],keySystemsMapping:{},parseInbandPsshEnabled:Ts()},r={retryParameters:Pn(),availabilityWindowOverride:NaN,disableAudio:!1,disableVideo:!1,disableText:!1,disableThumbnails:!1,defaultPresentationDelay:0,segmentRelativeVttTiming:!1,dash:{clockSyncUri:"",ignoreDrmInfo:!1,disableXlinkProcessing:!1,xlinkFailGracefully:!1,ignoreMinBufferTime:!1,autoCorrectDrift:!0,initialSegmentLimit:1e3,ignoreSuggestedPresentationDelay:!1,ignoreEmptyAdaptationSet:!1,ignoreMaxSegmentDuration:!1,keySystemsByURI:{"urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b":"org.w3.clearkey","urn:uuid:e2719d58-a985-b3c9-781a-b030af78d30e":"org.w3.clearkey","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":"com.widevine.alpha","urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95":"com.microsoft.playready","urn:uuid:79f0049a-4098-8642-ab92-e65be0885f95":"com.microsoft.playready","urn:uuid:f239e769-efa3-4850-9c16-a903c6932efb":"com.adobe.primetime"},manifestPreprocessor:function(h){return Nh([h],h)},sequenceMode:!1},hls:{ignoreTextStreamFailures:!1,ignoreImageStreamFailures:!1,defaultAudioCodec:"mp4a.40.2",defaultVideoCodec:"avc1.42E01E",ignoreManifestProgramDateTime:!1,mediaPlaylistFullMimeType:'video/mp2t; codecs="avc1.42E01E, mp4a.40.2"',useSafariBehaviorForLive:!0,liveSegmentsDelay:3}},s={retryParameters:Pn(),failureCallback:function(h){return Nh([h])},rebufferingGoal:2,bufferingGoal:10,bufferBehind:30,ignoreTextStreamFailures:!1,alwaysStreamText:!1,startAtSegmentBoundary:!1,gapDetectionThreshold:.5,durationBackoff:1,forceTransmux:!1,safeSeekOffset:5,stallEnabled:!0,stallThreshold:1,stallSkip:.1,useNativeHlsOnSafari:!0,inaccurateManifestTolerance:2,lowLatencyMode:!1,autoLowLatencyMode:!1,forceHTTPS:!1,preferNativeHls:!1,updateIntervalSeconds:1,dispatchAllEmsgBoxes:!1,observeQualityChanges:!1,maxDisabledTime:30,parsePrftBox:!1};($e("Web0S")||Cn()||$e("CrKey"))&&(s.stallSkip=0);var o={trackSelectionCallback:function(h){return z(function(d){return d.return(h)})},downloadSizeCallback:function(h){var d;return z(function(g){return g.g==1?navigator.storage&&navigator.storage.estimate?C(g,navigator.storage.estimate(),3):g.return(!0):(d=g.h,g.return(d.usage+h<.95*d.quota))})},progressCallback:function(h,d){return Nh([h,d])},usePersistentLicense:!0,numberOfParallelDownloads:5},l={drm:i,manifest:r,streaming:s,mediaSource:{sourceBufferExtraFeatures:""},offline:o,abrFactory:function(){return new tt},abr:{enabled:!0,useNetworkInformation:!0,defaultBandwidthEstimate:1e6,switchInterval:8,bandwidthUpgradeTarget:.85,bandwidthDowngradeTarget:.95,restrictions:{minWidth:0,maxWidth:1/0,minHeight:0,maxHeight:e,minPixels:0,maxPixels:1/0,minFrameRate:0,maxFrameRate:1/0,minBandwidth:0,maxBandwidth:1/0},advanced:{minTotalBytes:128e3,minBytes:16e3,fastHalfLife:2,slowHalfLife:5},restrictToElementSize:!1,restrictToScreenSize:!1,ignoreDevicePixelRatio:!1},autoShowText:3,preferredAudioLanguage:"",preferredTextLanguage:"",preferredVariantRole:"",preferredTextRole:"",preferredAudioChannelCount:2,preferredVideoCodecs:[],preferredAudioCodecs:[],preferForcedSubs:!1,preferredDecodingAttributes:[],restrictions:{minWidth:0,maxWidth:1/0,minHeight:0,maxHeight:1/0,minPixels:0,maxPixels:1/0,minFrameRate:0,maxFrameRate:1/0,minBandwidth:0,maxBandwidth:1/0},playRangeStart:0,playRangeEnd:1/0,textDisplayFactory:function(){return null},cmcd:{enabled:!1,sessionId:"",contentId:"",useHeaders:!1},lcevc:{enabled:!1,dynamicPerformanceScaling:!0,logLevel:0,drawLogo:!1}};return o.trackSelectionCallback=function(h){return z(function(d){return d.return(t1(h,l.preferredAudioLanguage))})},l}function Wn(e,i,r){var s={".drm.keySystemsMapping":"",".drm.servers":"",".drm.clearKeys":"",".drm.advanced":{distinctiveIdentifierRequired:!1,persistentStateRequired:!1,videoRobustness:"",audioRobustness:"",sessionType:"",serverCertificate:new Uint8Array(0),serverCertificateUri:"",individualizationServer:""}};return Oh(e,i,r||Vn(),s,"")}function t1(e,i){var r=e.filter(function(h){return h.type=="variant"}),s=[],o=Yo(i,r.map(function(h){return h.language}));o&&(s=r.filter(function(h){return Me(h.language)==o})),s.length==0&&(s=r.filter(function(h){return h.primary})),s.length==0&&(r.map(function(h){return h.language}),s=r);var l=s.filter(function(h){return h.height&&480>=h.height});for(l.length&&(l.sort(function(h,d){return d.height-h.height}),s=l.filter(function(h){return h.height==l[0].height})),i=[],s.length&&(r=Math.floor(s.length/2),s.sort(function(h,d){return h.bandwidth-d.bandwidth}),i.push(s[r])),e=v(e),s=e.next();!s.done;s=e.next())s=s.value,s.type!=De&&s.type!="image"||i.push(s);return i}te("shaka.util.PlayerConfiguration",Uh),Uh.mergeConfigObjects=Wn,Uh.createDefault=Vn;function i1(){this.g=null,this.h=[]}function Da(e,i){if(e.g==null)e.g={timestamp:Date.now()/1e3,state:i,duration:0};else{var r=Date.now()/1e3;e.g.duration=r-e.g.timestamp,e.g.state!=i&&(e.h.push(e.g),e.g={timestamp:r,state:i,duration:0})}}function zh(e,i){var r=0;e.g&&e.g.state==i&&(r+=e.g.duration),e=v(e.h);for(var s=e.next();!s.done;s=e.next())s=s.value,r+=s.state==i?s.duration:0;return r}function r1(e){function i(l){return{timestamp:l.timestamp,state:l.state,duration:l.duration}}for(var r=[],s=v(e.h),o=s.next();!o.done;o=s.next())r.push(i(o.value));return e.g&&r.push(i(e.g)),r}function n1(){this.i=this.h=null,this.g=[]}function Bh(e,i,r){e.i!=i&&(e.i=i,e.g.push({timestamp:Date.now()/1e3,id:i.id,type:"text",fromAdaptation:r,bandwidth:null}))}function ym(){this.u=this.B=this.G=this.D=this.s=this.j=this.F=this.m=this.i=this.M=this.O=this.H=this.J=this.L=this.l=this.o=NaN,this.g=new i1,this.h=new n1}function H(e,i){Le.call(this);var r=this;this.l=Kh,this.Uc=this.g=null,this.ca=!1,this.Xc=new je,this.Xb=new je,this.s=new je,this.Nb=this.i=this.Yc=this.J=this.j=this.ua=this.L=this.cf=this.V=this.Fa=this.M=this.Vc=this.H=this.xb=this.B=this.G=this.m=this.D=null,this.dc=!1,this.Nd=this.u=null,this.Yd=1e9,this.h=Gn(this),this.ec={width:1/0,height:1/0},this.o=null,this.ub=new Ln(this.h.preferredAudioLanguage,this.h.preferredVariantRole,this.h.preferredAudioChannelCount),this.vb=this.h.preferredTextLanguage,this.cc=this.h.preferredTextRole,this.$b=this.h.preferForcedSubs,this.Zb=[],this.fc=null,i&&i(this),this.D=x1(this),this.D.je(this.h.streaming.forceHTTPS),this.F=null,Ba&&(this.F=Ba()),this.Xc.C(u,"online",function(){r.ce()}),this.O={name:"detach"},this.W={name:"attach"},this.ea={name:"unload"},this.Zd={name:"manifest-parser"},this.Xd={name:"manifest"},this.wb={name:"media-source"},this.Qd={name:"drm-engine"},this.ba={name:"load"},this.de={name:"src-equals-drm-engine"},this.yb={name:"src-equals"};var s=new Map;s.set(this.W,function(o,l){return ki(a1(r,o,l))}),s.set(this.O,function(o){return o.mediaElement&&(r.Xb.nb(),o.mediaElement=null),r.F&&r.F.release(),r.g=null,o=Promise.resolve(),ki(o)}),s.set(this.ea,function(o){return ki(xm(r,o))}),s.set(this.wb,function(o){return o=l1(r,o),ki(o)}),s.set(this.Zd,function(o,l){return o=u1(r,o,l),ki(o)}),s.set(this.Xd,function(o){return h1(r,o)}),s.set(this.Qd,function(o){return o=c1(r,o),ki(o)}),s.set(this.ba,function(o,l){return ki(d1(r,o,l))}),s.set(this.de,function(o,l){return o=f1(r,o,l),ki(o)}),s.set(this.yb,function(o,l){return p1(r,o,l)}),this.Ga=new um(this.O,{Mf:function(o,l,h,d){var g=null;return o==r.O&&(g=h==r.O?r.O:r.W),o==r.W&&(g=h==r.O||l.mediaElement!=d.mediaElement?r.O:h==r.W?r.W:h==r.wb||h==r.ba?r.wb:h==r.yb?r.de:null),o==r.wb&&(g=h==r.ba&&l.mediaElement==d.mediaElement?r.Zd:r.ea),o==r.Zd&&(g=$h(r.ba,r.Xd,r.ea,h,l,d)),o==r.Xd&&(g=$h(r.ba,r.Qd,r.ea,h,l,d)),o==r.Qd&&(g=$h(r.ba,r.ba,r.ea,h,l,d)),o==r.de&&(g=h==r.yb&&l.mediaElement==d.mediaElement?r.yb:r.ea),(o==r.ba||o==r.yb)&&(g=r.ea),o==r.ea&&(g=d.mediaElement&&l.mediaElement==d.mediaElement?r.W:r.O),g},yf:function(o,l,h){return r.dispatchEvent(st("onstatechange",new Map().set("state",o.name))),s.get(o)(l,h)},handleError:function(o){return z(function(l){return l.g==1?C(l,xm(r,o),2):l.return(o.mediaElement?r.W:r.O)})},eg:function(o){r.dispatchEvent(st("onstateidle",new Map().set("state",o.name)))}}),this.af=new we(function(){zu(r.i.variants,r.h.restrictions,r.ec)&&Na(r)}),e&&this.Yb(e,!0)}me(H,Le);function Oa(e){e.L!=null&&(e.L.release(),e.L=null)}function s1(e,i){if(i.lcevc.enabled){var r=e.Xa();r&&r[0]&&r[0].videoMimeType==ja.ts&&(Ru()||navigator.userAgent.match(/Edge\//))&&(i.streaming.forceTransmux||qe("LCEVC Warning: For MPEG-2 TS decoding the config.streaming.forceTransmux must be enabled.")),Oa(e),e.L==null&&(e.L=new Bs(e.g,e.cf,i.lcevc),e.G&&(e.G.D=e.L))}else Oa(e)}function st(e,i){return new fe(e,i)}p=H.prototype,p.destroy=function(){var e=this,i;return z(function(r){switch(r.g){case 1:return e.l==Si?r.return():(Oa(e),e.l=Si,i=Xs(e.Ga,function(){return{node:e.O,payload:qn(),hb:!1}}),C(r,new Promise(function(s){i.Jb=function(){},i.bd=function(){s()},i.mb=function(){s()},i.onError=function(){s()},i.dd=function(){s()}}),2));case 2:return C(r,e.Ga.destroy(),3);case 3:if(e.Xc&&(e.Xc.release(),e.Xc=null),e.Xb&&(e.Xb.release(),e.Xb=null),e.s&&(e.s.release(),e.s=null),e.Nd=null,e.u=null,e.h=null,e.o=null,e.Uc=null,e.V=null,!e.D){r.A(4);break}return C(r,e.D.destroy(),5);case 5:e.D=null;case 4:Le.prototype.release.call(e),K(r)}})},p.Yb=function(e,i){if(i=i===void 0?!0:i,this.l==Si)return Promise.reject(Jr());var r=qn();r.mediaElement=e,xi()||(i=!1);var s=i?this.wb:this.W;return e=Xs(this.Ga,function(){return{node:s,payload:r,hb:!1}}),e.Jb=function(){},Yh(e)},p.lf=function(e){this.cf=e},p.detach=function(){var e=this;if(this.l==Si)return Promise.reject(Jr());var i=Xs(this.Ga,function(){return{node:e.O,payload:qn(),hb:!1}});return i.Jb=function(){},Yh(i)},p.re=function(e){var i=this;if(e=e===void 0?!0:e,this.l==Si)return Promise.reject(Jr());this.dc=!1,xi()||(e=!1),Oa(this);var r=qn(),s=Xs(this.Ga,function(o){var l=o.mediaElement&&e?i.wb:o.mediaElement?i.W:i.O;return r.mediaElement=o.mediaElement,{node:l,payload:r,hb:!1}});return s.Jb=function(){},Yh(s)},p.Fg=function(e){this.fc=e},p.load=function(e,i,r){var s=this;if(this.fc=null,this.dc=!1,this.l==Si)return Promise.reject(Jr());this.dispatchEvent(st("loading"));var o=qn();o.uri=e,o.ne=Date.now()/1e3,r&&(o.mimeType=r),i!==void 0&&(o.startTime=i);var l=o1(this,o)?this.yb:this.ba,h=Xs(this.Ga,function(d){return d.mediaElement==null?null:(o.mediaElement=d.mediaElement,{node:l,payload:o,hb:!0})});return this.o=new ym,this.V=w1(this),h.Jb=function(){},new Promise(function(d,g){h.dd=function(){return g(new F(2,7,7002))},h.bd=function(){d(),s.dispatchEvent(st("loaded"))},h.mb=function(){return g(Jr())},h.onError=function(_){return g(_)}})};function o1(e,i){if(!xi())return!0;var r=i.mimeType,s=i.uri||"";if(r||(r=Nn(s),r=ja[r]),r){if((i.mediaElement||Xf()).canPlayType(r)=="")return!1;if(!xi()||!(r in ii||Nn(s)in Xr)||e.h.streaming.preferNativeHls)return!0;if(Vo())return e.h.streaming.useNativeHlsOnSafari}return!1}function a1(e,i,r){return i.mediaElement==null&&(i.mediaElement=r.mediaElement,e.Xb.C(i.mediaElement,"error",function(){var s=qh(e);s&&Qr(e,s)})),e.g=i.mediaElement,Promise.resolve()}function xm(e,i){var r,s,o,l,h,d,g,_,y;return z(function(S){switch(S.g){case 1:return e.l!=Si&&(e.l=Kh),r=e.Zb.map(function(w){return w()}),e.Zb=[],C(S,Promise.all(r),2);case 2:if(e.dispatchEvent(st("unloading")),i.mimeType=null,i.startTime=null,i.uri=null,e.Fa&&(e.Fa.release(),e.Fa=null),i.mediaElement&&e.s.nb(),e.af.stop(),e.xb&&(e.xb.release(),e.xb=null),e.Vc&&(e.Vc.stop(),e.Vc=null),!e.J){S.A(3);break}return C(S,e.J.stop(),4);case 4:e.J=null,e.Yc=null;case 3:if(!e.u){S.A(5);break}return C(S,e.u.stop(),5);case 5:if(!e.j){S.A(7);break}return C(S,e.j.destroy(),8);case 8:e.j=null;case 7:if(e.H&&(e.H.release(),e.H=null),e.B&&(e.B.release(),e.B=null),!e.G){S.A(9);break}return C(S,e.G.destroy(),10);case 10:e.G=null;case 9:if(e.F&&e.F.onAssetUnload(),!i.mediaElement||!i.mediaElement.src){S.A(11);break}return C(S,new Promise(function(w){return new we(w).N(.1)}),12);case 12:for(i.mediaElement.removeAttribute("src"),i.mediaElement.load();i.mediaElement.lastChild;)i.mediaElement.removeChild(i.mediaElement.firstChild);case 11:if(!e.m){S.A(13);break}return C(S,e.m.destroy(),14);case 14:e.m=null;case 13:if(e.Nb=null,e.M=null,e.i){for(s=v(e.i.variants),o=s.next();!o.done;o=s.next())for(l=o.value,h=v([l.audio,l.video]),d=h.next();!d.done;d=h.next())(g=d.value)&&g.segmentIndex&&g.segmentIndex.release();for(_=v(e.i.textStreams),d=_.next();!d.done;d=_.next())y=d.value,y.segmentIndex&&y.segmentIndex.release()}e.i=null,e.o=new ym,e.Ud=null,Gh(e),K(S)}})}function l1(e,i){var r,s,o,l,h;return z(function(d){if(d.g==1)return r=e.h.textDisplayFactory,s=r(),e.Ud=r,o=S1(i.mediaElement,s,function(g,_,y){vm(e,g,_,y)},e.L),o.configure(e.h.mediaSource),l=e.h.manifest,h=l.segmentRelativeVttTiming,o.H=h,C(d,o.J,2);e.G=o,K(d)})}function u1(e,i,r){var s,o,l,h;return z(function(d){if(d.g==1)return i.mimeType=r.mimeType,i.uri=r.uri,s=i.uri,o=e.D,e.Nb=s,l=e,C(d,tg(s,o,e.h.manifest.retryParameters,i.mimeType),2);l.Yc=d.h,e.J=e.Yc(),h=Dn(e.h.manifest),r.mediaElement&&r.mediaElement.nodeName==="AUDIO"&&(h.disableVideo=!0),e.J.configure(h),K(d)})}function h1(e,i){var r=i.uri;i=e.D,e.Fa=new vh(function(){return e.uc()}),e.Fa.addEventListener("regionadd",function(l){l=l.region,Qs(e,"timelineregionadded",l),e.F&&e.F.onDashTimedMetadata(l)}),e.ua=null,e.h.streaming.observeQualityChanges&&(e.ua=new ba(function(){return e.Na()}),e.ua.addEventListener("qualitychange",function(l){var h=l.quality;l=l.position,h=new Map().set("mediaQuality",{bandwidth:h.bandwidth,audioSamplingRate:h.audioSamplingRate,codecs:h.codecs,contentType:h.contentType,frameRate:h.frameRate,height:h.height,mimeType:h.mimeType,channelsCount:h.channelsCount,pixelAspectRatio:h.pixelAspectRatio,width:h.width}).set("position",l),e.dispatchEvent(st("mediaqualitychanged",h))}));var s={networkingEngine:i,modifyManifestRequest:function(l,h){var d=e.V;try{d.g.enabled&&(d.o=h.format,Rh(d,l,{ot:mm,su:!d.i}))}catch(g){kr("CMCD_MANIFEST_ERROR","Could not generate manifest CMCD data.",g)}},modifySegmentRequest:function(l,h){gm(e.V,l,h)},filter:function(l){return Rm(e,l)},makeTextStreamsForClosedCaptions:function(l){return C1(e,l)},onTimelineRegionAdded:function(l){var h=e.Fa;e:{for(var d=v(h.g),g=d.next();!g.done;g=d.next())if(g=g.value,g.schemeIdUri==l.schemeIdUri&&g.id==l.id&&g.startTime==l.startTime&&g.endTime==l.endTime){d=g;break e}d=null}d==null&&(h.g.add(l),l=new fe("regionadd",new Map([["region",l]])),h.dispatchEvent(l))},onEvent:function(l){return e.dispatchEvent(l)},onError:function(l){return Qr(e,l)},isLowLatencyMode:function(){return e.h.streaming.lowLatencyMode},isAutoLowLatencyMode:function(){return e.h.streaming.autoLowLatencyMode},enableLowLatencyMode:function(){e.configure("streaming.lowLatencyMode",!0)},updateDuration:function(){e.j&&e.j.updateDuration()},newDrmInfo:function(l){var h=e.m?e.m.g:null;h&&e.m.u&&Wh(e,h.keySystem,l)}},o=Date.now()/1e3;return new Ye(function(){var l,h,d,g;return z(function(_){if(_.g==1)return l=e,C(_,e.J.start(r,s),2);if(l.i=_.h,h=st("manifestparsed"),e.dispatchEvent(h),e.i.variants.length==0)throw new F(2,4,4036);y1(e.i),d=Date.now()/1e3,g=d-o,e.o.F=g,K(_)})}(),function(){return e.J.stop()})}function c1(e,i){var r,s;return z(function(o){return o.g==1?(r=Date.now()/1e3,s=!0,e.m=wm(e,{kb:e.D,onError:function(l){Qr(e,l)},cd:function(l){Fm(e,l)},onExpirationUpdated:function(l,h){Nm(e,l,h)},onEvent:function(l){e.dispatchEvent(l),l.type=="drmsessionupdate"&&s&&(s=!1,e.o.j=Date.now()/1e3-r,e.L&&(l=e.L,l.g&&l.h.classList.add("shaka-hidden")))}}),e.m.configure(e.h.drm),C(o,Vp(e.m,e.i.variants,e.i.offlineSessionIds),2)):o.g!=3?C(o,e.m.Yb(i.mediaElement),3):C(o,Rm(e,e.i),0)})}function d1(e,i,r){var s,o,l,h,d,g,_,y,S,w,E,R,P,L,M,U,k;return z(function(N){switch(N.g){case 1:for(i.startTime=r.startTime,e.fc!=null&&(i.startTime=e.fc,e.fc=null),s=i.mediaElement,o=i.uri,e.Nb=o,e.H=new Hs({Tc:function(){return s.playbackRate},Pc:function(){return s.defaultPlaybackRate},le:function(B){s.playbackRate=B},Me:function(B){s.currentTime+=B}}),l=function(){return Fa(e)},h=function(){return Mm(e)},e.s.C(s,"playing",l),e.s.C(s,"pause",l),e.s.C(s,"ended",l),e.s.C(s,"ratechange",h),s1(e,e.h),d=e.h.abrFactory,e.u&&e.Nd==d||(e.Nd=d,e.u=d(),typeof e.u.setMediaElement!="function"&&(_p("AbrManager","Please use an AbrManager with setMediaElement function."),e.u.setMediaElement=function(){}),e.u.configure(e.h.abr)),e.ub=new Ln(e.h.preferredAudioLanguage,e.h.preferredVariantRole,e.h.preferredAudioChannelCount),e.vb=e.h.preferredTextLanguage,e.cc=e.h.preferredTextRole,e.$b=e.h.preferForcedSubs,Um(e.i.presentationTimeline,e.h.playRangeStart,e.h.playRangeEnd),e.u.init(function(B,j,V){e.j&&B!=e.j.l&&Zs(e,B,!0,j===void 0?!1:j,V===void 0?0:V)}),e.u.setMediaElement(s),np(e.i,e.h.preferredVideoCodecs,e.h.preferredAudioCodecs,e.h.preferredAudioChannelCount,e.h.preferredDecodingAttributes),e.j=A1(e),e.j.configure(e.h.streaming),e.l=Wt,s.textTracks&&e.s.C(s.textTracks,"addtrack",function(B){if(B.track)switch(B=B.track,B.kind){case"chapters":Sm(e,B)}}),e.dispatchEvent(st("streaming")),g=null,(_=e.j.l)||(g=Na(e)),y=[],S=_||g,w=v([S.video,S.audio]),E=w.next();!E.done;E=w.next())(R=E.value)&&!R.segmentIndex&&y.push(R.createSegmentIndex());if(!(0<y.length)){N.A(2);break}return C(N,Promise.all(y),2);case 2:if(e.B=v1(e,i.startTime),e.xb=T1(e),P=Math.max(e.i.minBufferTime,e.h.streaming.rebufferingGoal),Am(e,P),_){N.A(4);break}if(Zs(e,g,!0,!1,0),!e.h.streaming.startAtSegmentBoundary){N.A(5);break}return L=e.B.Ic(),C(N,I1(g,L),6);case 6:M=N.h,e.B.zd(M);case 5:Pm(e,null,Hr(g));case 4:return e.B.yd(),U=e.Fb().find(function(B){return B.active}),U||((k=Vu(e.i.textStreams,e.vb,e.cc,e.$b)[0]||null)&&Bh(e.o.h,k,!0),g&&(k?(g.audio&&R1(e,g.audio,k)&&(e.ca=!0),e.ca&&e.G.m.setTextVisibility(!0),Dm(e)):e.ca=!1),k&&(e.h.streaming.alwaysStreamText||e.Hd())&&Ra(e.j,k)),C(N,e.j.start(),7);case 7:e.h.abr.enabled&&(e.u.enable(),Om(e)),lp(e.j?e.j.l:null,e.i),Bm(e.i),si(e),Ks(e),e.i.variants.some(function(B){return B.primary}),e.dc=!0,e.s.ma(s,"loadedmetadata",function(){e.o.m=Date.now()/1e3-r.ne}),K(N)}})}function f1(e,i,r){var s,o,l,h,d,g,_;return z(function(y){return y.g==1?(s=wt,o=Date.now()/1e3,l=!0,e.m=wm(e,{kb:e.D,onError:function(S){Qr(e,S)},cd:function(S){Fm(e,S)},onExpirationUpdated:function(S,w){Nm(e,S,w)},onEvent:function(S){e.dispatchEvent(S),S.type=="drmsessionupdate"&&l&&(l=!1,e.o.j=Date.now()/1e3-o)}}),e.m.configure(e.h.drm),h=r.uri||"",d=Nn(h),g=ja[d],g=="application/x-mpegurl"&&Vo()&&(g="application/vnd.apple.mpegurl"),g||(g="video/mp4"),_={id:0,language:"und",disabledUntilTime:0,primary:!1,audio:null,video:{id:0,originalId:null,createSegmentIndex:function(){return Promise.resolve()},segmentIndex:null,mimeType:r.mimeType?r.mimeType.split(";")[0]:g,codecs:r.mimeType?Jf(r.mimeType):"",encrypted:!0,drmInfos:[],keyIds:new Set,language:"und",label:null,type:s.va,primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],forced:!1,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,closedCaptions:null},bandwidth:100,allowedByApplication:!0,allowedByKeySystem:!0,decodingInfos:[]},e.m.V=!0,C(y,Vp(e.m,[_],[]),2)):C(y,e.m.Yb(i.mediaElement),0)})}function p1(e,i,r){function s(){return Fa(e)}i.uri=r.uri,i.startTime=r.startTime,e.Nb=i.uri;var o=i.mediaElement;e.B=new Yg(o);var l=!1;e.Zb.push(function(){l=!0}),i.startTime!=null&&e.B.zd(i.startTime),e.H=new Hs({Tc:function(){return o.playbackRate},Pc:function(){return o.defaultPlaybackRate},le:function(g){o.playbackRate=g},Me:function(g){o.currentTime+=g}}),Am(e,e.h.streaming.rebufferingGoal),e.s.C(o,"playing",s),e.s.C(o,"pause",s),e.s.C(o,"ended",s),e.s.C(o,"ratechange",function(){return Mm(e)}),o.preload!="none"&&e.s.ma(o,"loadedmetadata",function(){e.o.m=Date.now()/1e3-r.ne}),o.audioTracks&&(e.s.C(o.audioTracks,"addtrack",function(){return si(e)}),e.s.C(o.audioTracks,"removetrack",function(){return si(e)}),e.s.C(o.audioTracks,"change",function(){return si(e)})),o.textTracks&&(e.s.C(o.textTracks,"addtrack",function(g){if(g.track)switch(g=g.track,g.kind){case"metadata":_1(e,g);break;case"chapters":Sm(e,g);break;default:si(e)}}),e.s.C(o.textTracks,"removetrack",function(){return si(e)}),e.s.C(o.textTracks,"change",function(){return si(e)}));var h=Nn(i.uri);o.src=qw(e.V,i.uri,ja[h]),(Cn()||$e("Web0S"))&&o.load(),e.l=oi,e.dispatchEvent(st("streaming"));var d=new Ve;return Bn(o,HTMLMediaElement.HAVE_METADATA,e.s,function(){e.B.yd(),d.resolve()}),Bn(o,HTMLMediaElement.HAVE_CURRENT_DATA,e.s,function(){var g;return z(function(_){if(_.g==1)return g1(e),g=Ys(e),g.find(function(y){return y.mode!="disabled"})?(0<g.length&&(e.ca=!0),_.A(2)):C(_,new Promise(function(y){e.s.ma(o.textTracks,"change",y),new we(y).N(1)}),2);if(l)return _.return();m1(e),K(_)})}),o.error?d.reject(qh(e)):o.preload=="none"&&(qe('With <video preload="none">, the browser will not load anything until play() is called. We are unable to measure load latency in a meaningful way, and we cannot provide track info yet. Please do not use preload="none" with Shaka Player.'),d.resolve()),e.s.ma(o,"error",function(){d.reject(qh(e))}),new Ye(d,function(){return d.reject(new F(2,7,7001)),Promise.resolve()}).Y(function(){e.dc=!0})}function g1(e){var i=e.h.preferredAudioLanguage;if(i!=""){e.ge(i);var r=e.h.preferredVariantRole;r!=""&&e.ge(i,r)}}function m1(e){var i=e.h.preferredTextLanguage,r=e.h.preferForcedSubs;if(i!=""){e.he(i,"",r);var s=e.h.preferredTextRole;s!=""&&e.he(i,s,r)}}function _1(e,i){if(i.kind=="metadata"){i.mode="hidden",e.s.C(i,"cuechange",function(){if(i.activeCues)for(var s=v(i.activeCues),o=s.next();!o.done;o=s.next())o=o.value,Tm(e,o.startTime,o.endTime,o.type,o.value),e.F&&e.F.onCueMetadataChange(o.value)});var r=new we(function(){var s=E1(e);s=v(s);for(var o=s.next();!o.done;o=s.next())o.value.mode="hidden"}).Mb().N(.5);e.Zb.push(function(){r.stop()})}}function vm(e,i,r,s){i=v(i);for(var o=i.next();!o.done;o=i.next())if(o=o.value,o.data&&o.cueTime&&o.frames){var l=o.cueTime+r,h=s;h&&l>h&&(h=l);for(var d=v(o.frames),g=d.next();!g.done;g=d.next())Tm(e,l,h,"org.id3",g.value);e.F&&e.F.onHlsTimedMetadata(o,l)}}function Tm(e,i,r,s,o){i=new Map().set("startTime",i).set("endTime",r).set("metadataType",s).set("payload",o),e.dispatchEvent(st("metadata",i))}function Sm(e,i){if(i&&i.kind=="chapters"){i.mode="hidden";var r=new we(function(){i.mode="hidden"}).Mb().N(.5);e.Zb.push(function(){r.stop()})}}function y1(e){function i(r){return r.video&&r.audio||r.video&&r.video.codecs.includes(",")}e.variants.some(i)&&(e.variants=e.variants.filter(i))}function wm(e,i){return new da(i,e.h.drm.updateExpirationTime)}function x1(e){return new Ne(function(i,r){e.u&&e.u.segmentDownloaded(i,r)},function(i,r,s){i=new Map().set("headers",i).set("request",r).set("requestType",s),e.dispatchEvent(st("downloadheadersreceived",i))},function(i,r,s,o){i=new Map().set("request",i).set("error",r).set("httpResponseCode",s).set("aborted",o),e.dispatchEvent(st("downloadfailed",i))})}function v1(e,i){return new Kg(e.g,e.i,e.h.streaming,i,function(){e.xb&&im(e.xb,!0),e.j&&e.j.vc(),e.M&&jh(e)},function(r){return e.dispatchEvent(r)})}function T1(e){var i=new Ia(e.Fa);i.addEventListener("enter",function(s){Qs(e,"timelineregionenter",s.region)}),i.addEventListener("exit",function(s){Qs(e,"timelineregionexit",s.region)}),i.addEventListener("skip",function(s){var o=s.region;s.seeking||(Qs(e,"timelineregionenter",o),Qs(e,"timelineregionexit",o))});var r=new tm(e.g);return r.g.add(i),e.ua&&r.g.add(e.ua),r}function Am(e,i){e.M=new ZT,e.M.g=Mn,Sp(e.M,i,Math.min(.5,i/2)),Gh(e),e.Vc=new we(function(){jh(e)}).Ca(.25)}function jh(e){switch(e.l){case oi:if(e.g.ended)var i=!0;else{var r=uh(e.g.buffered);i=r!=null&&r>=e.g.duration-1}break;case Wt:e:if(e.g.ended||Dg(e.G))i=!0;else{if(e.i.presentationTimeline.U()){r=e.i.presentationTimeline.gb();var s=uh(e.g.buffered);if(s!=null&&s>=r){i=!0;break e}}i=!1}break;default:i=!1}s=Ig(e.g.buffered,e.g.currentTime),r=e.M;var o=i,l=r.h.get(r.g);i=r.g,s=o||s>=l?ta:Mn,r.g=s,i!=s&&Gh(e)}function S1(e,i,r,s){return new kg(e,i,r,s)}function w1(e){return new Xw({getBandwidthEstimate:function(){return e.u?e.u.getBandwidthEstimate():NaN},Na:function(){return e.Na()},getCurrentTime:function(){return e.g?e.g.currentTime:0},Xa:function(){return e.Xa()},Rc:function(){return e.Rc()},U:function(){return e.U()}},e.h.cmcd)}function A1(e){return new rm(e.i,{Sc:function(){return e.B?e.B.Ic():0},getBandwidthEstimate:function(){return e.u.getBandwidthEstimate()},modifySegmentRequest:function(i,r){gm(e.V,i,r)},R:e.G,kb:e.D,onError:function(i){return Qr(e,i)},onEvent:function(i){return e.dispatchEvent(i)},gg:function(){e.J&&e.J.update&&e.J.update()},Wd:function(i,r,s){e.B&&e.B.Ne(),jh(e),i=new Map().set("start",i).set("end",r).set("contentType",s),e.dispatchEvent(st("segmentappended",i))},fg:function(i,r){(r=r.Od)&&e.ua&&vw(e.ua,r,i)},xe:function(i,r){var s=e.m;if(s.h.parseInbandPsshEnabled&&["audio","video"].includes(i)){r=new Up(Ee(r));var o=0,l=v(r.data);for(i=l.next();!i.done;i=l.next())o+=i.value.length;if(o==0)s=Promise.resolve();else{for(o=new Uint8Array(o),l=0,r=v(r.data),i=r.next();!i.done;i=r.next())i=i.value,o.set(i,l),l+=i.length;Ds(s,"cenc",o),s=s.o}}else s=Promise.resolve();return s},hg:function(i,r,s){vm(e,i,r,s)}})}p.configure=function(e,i){arguments.length==2&&typeof e=="string"&&(e=Fh(e,i)),e.streaming&&"forceTransmuxTS"in e.streaming&&(_p("streaming.forceTransmuxTS configuration","Please Use streaming.forceTransmux instead."),e.streaming.forceTransmux=e.streaming.forceTransmuxTS,delete e.streaming.forceTransmuxTS),e.streaming&&e.streaming.lowLatencyMode&&(e.streaming.inaccurateManifestTolerance==null&&(e.streaming.inaccurateManifestTolerance=0),e.streaming.rebufferingGoal==null&&(e.streaming.rebufferingGoal=.01));var r=Wn(this.h,e,Gn(this));return Em(this),r};function Em(e){if(e.J){var i=Dn(e.h.manifest);e.g&&e.g.nodeName==="AUDIO"&&(i.disableVideo=!0),e.J.configure(i)}if(e.m&&e.m.configure(e.h.drm),e.j){e.j.configure(e.h.streaming);try{Lm(e,e.i)}catch(l){Qr(e,l)}e.u&&Ks(e),i=e.j.l,!i||i.allowedByApplication&&i.allowedByKeySystem||Ua(e)}if(e.D&&e.D.je(e.h.streaming.forceHTTPS),e.G&&(e.G.configure(e.h.mediaSource),e.G.H=e.h.manifest.segmentRelativeVttTiming,i=e.h.textDisplayFactory,e.Ud!=i)){var r=i(),s=e.G,o=s.m;s.m=r,o&&(r.setTextVisibility(o.isTextVisible()),o.destroy()),s.g&&(s.g.i=r),e.Ud=i,e.j&&(i=e.j,(r=i.j.get(De))&&Hn(i,r.stream,!0,0,!0))}e.u&&(e.u.configure(e.h.abr),e.h.abr.enabled?e.u.enable():e.u.disable(),Om(e)),e.M&&(i=e.h.streaming.rebufferingGoal,e.i&&(i=Math.max(i,e.i.minBufferTime)),Sp(e.M,i,Math.min(.5,i/2))),e.i&&Um(e.i.presentationTimeline,e.h.playRangeStart,e.h.playRangeEnd)}p.getConfiguration=function(){var e=Gn(this);return Wn(e,this.h,Gn(this)),e},p.Bf=function(){if(this.g){var e=this.g.buffered.length;e=e?this.g.buffered.end(e-1):0;var i=this.getConfiguration().streaming.bufferingGoal;if(i=Math.min(this.g.currentTime+i,this.uc().end),e>=i)return 1;if(!(e<=this.g.currentTime)&&e<i)return(e-this.g.currentTime)/(i-this.g.currentTime)}return 0},p.rg=function(){for(var e in this.h)delete this.h[e];Wn(this.h,Gn(this),Gn(this)),Em(this)},p.Hf=function(){return this.l},p.Lf=function(){return this.g},p.jc=function(){return this.D},p.Dd=function(){return this.Nb},p.Ge=function(){return this.F?this.F:null},p.U=function(){return this.i?this.i.presentationTimeline.U():this.g&&this.g.src?this.g.duration==1/0:!1},p.jb=function(){return this.i?this.i.presentationTimeline.jb():!1},p.Zf=function(){if(this.i){var e=this.i.variants;return e.length?!e[0].video:!1}return this.g&&this.g.src?this.g.videoTracks?this.g.videoTracks.length==0:this.g.videoHeight==0:!1},p.uc=function(){if(!this.dc)return{start:0,end:0};if(this.i){var e=this.i.presentationTimeline;return{start:e.Db(),end:e.Oa()}}return this.g&&this.g.src&&(e=this.g.seekable,e.length)?{start:e.start(0),end:e.end(e.length-1)}:{start:0,end:0}},p.Xf=function(){this.U()&&(this.g.currentTime=this.uc().end)},p.keySystem=function(){var e=this.drmInfo();return e?e.keySystem:""},p.drmInfo=function(){return this.m?this.m.g:null},p.ic=function(){return this.m?this.m.ic():1/0},p.Qc=function(){return this.m?this.m.Qc():{}},p.Fd=function(){return this.M?this.M.g==Mn:!1},p.Rc=function(){return this.g?this.H?this.H.i:1:0},p.Ag=function(e){e==0?qe("A trick play rate of 0 is unsupported!"):(this.g.paused&&this.g.play(),this.H.set(e),this.l==Wt&&(this.u.playbackRateChanged(e),nm(this.j,1<Math.abs(e))))},p.pf=function(){var e=this.H.Pc();this.l==oi&&this.H.set(e),this.l==Wt&&(this.H.set(e),this.u.playbackRateChanged(e),nm(this.j,!1))},p.Xa=function(){if(this.i){for(var e=this.j?this.j.l:null,i=[],r=0,s=v(this.i.variants),o=s.next();!o.done;o=s.next())if(o=o.value,Is(o)){var l=Hr(o);l.active=o==e,l.active||r==1||e==null||o.video!=e.video||o.audio!=e.audio||(l.active=!0),l.active&&r++,i.push(l)}return i}return this.g&&this.g.audioTracks?Array.from(this.g.audioTracks).map(function(h){return Qo(h)}):[]},p.Fb=function(){if(this.i){for(var e=this.j?this.j.o:null,i=[],r=v(this.i.textStreams),s=r.next();!s.done;s=r.next()){s=s.value;var o=Zo(s);o.active=s==e,i.push(o)}return i}return this.g&&this.g.src&&this.g.textTracks?Ys(this).map(function(l){return hp(l)}):[]},p.Ff=function(){return this.i?this.i.imageStreams.map(function(e){return ju(e)}):[]},p.Tf=function(e,i){var r=this,s,o,l,h,d,g,_,y,S,w,E,R,P,L,M,U,k,N,B,j;return z(function(V){return V.g==1?r.i?(s=r.i.imageStreams.find(function($){return $.id==e}))?s.segmentIndex?V.A(3):C(V,s.createSegmentIndex(),3):V.return(null):V.A(2):V.g!=2?(o=s.segmentIndex.find(i),o==null||(l=s.segmentIndex.get(o),h=l.tilesLayout||s.tilesLayout,d=/(\d+)x(\d+)/.exec(h),!d)?V.return(null):(g=s.width||0,_=s.height||0,y=parseInt(d[1],10),S=parseInt(d[2],10),w=g/y,E=_/S,R=y*S,P=l.j-l.startTime,L=l.s||P/R,M=l.startTime,k=U=0,1<R&&(N=Math.floor((i-l.startTime)/L),M=l.startTime+N*L,U=N%y*w,k=Math.floor(N/y)*E),B=!1,(j=l.o)&&(B=!0,E=j.height,U=j.positionX,k=j.positionY,w=j.width),V.return({imageHeight:_,imageWidth:g,height:E,positionX:U,positionY:k,startTime:M,duration:L,uris:l.ya(),width:w,sprite:B}))):V.return(null)})},p.Se=function(e){if(this.i&&this.j){var i=this.i.textStreams.find(function(s){return s.id==e.id});i&&i!=this.j.o&&(Bh(this.o.h,i,!1),Ra(this.j,i),za(this),this.vb=i.language)}else if(this.g&&this.g.src&&this.g.textTracks){i=Ys(this),i=v(i);for(var r=i.next();!r.done;r=i.next())r=r.value,Hu(r)==e.id?r.mode=this.ca?"showing":"hidden":r.mode="disabled";za(this)}},p.Te=function(e,i,r){if(i=i===void 0?!1:i,r=r===void 0?0:r,this.i&&this.j){this.h.abr.enabled&&qe("Changing tracks while abr manager is enabled will likely result in the selected track being overriden. Consider disabling abr before calling selectVariantTrack().");var s=this.i.variants.find(function(o){return o.id==e.id});s&&Is(s)&&(Zs(this,s,!1,i,r),this.ub=new Tp(s),Ks(this))}else if(this.g&&this.g.audioTracks){for(i=Array.from(this.g.audioTracks),i=v(i),r=i.next();!r.done;r=i.next())if(r=r.value,Hu(r)==e.id){Xh(this,r);break}}},p.Af=function(){return Hm(this.Xa())},p.Rf=function(){return Hm(this.Fb())},p.zf=function(){return Array.from(jm(this.Xa()))},p.Qf=function(){return Array.from(jm(this.Fb()))},p.ge=function(e,i,r){if(r=r===void 0?0:r,this.i&&this.B){this.ub=new Ln(e,i||"",r,""),i=function(d,g){return d.video||g.video?d.video&&g.video?Math.abs((d.video.height||0)-(g.video.height||0))+Math.abs((d.video.width||0)-(g.video.width||0)):1/0:0},e=this.j.l;var s=this.ub.create(this.i.variants);r=null,s=v(s.values());for(var o=s.next();!o.done;o=s.next())o=o.value,(!r||i(r,e)>i(o,e))&&(r=o);r?(i=Hr(r),this.Te(i,!0)):Ua(this)}else if(this.g&&this.g.audioTracks){o=Array.from(this.g.audioTracks),e=Me(e),s=r=null,o=v(o);for(var l=o.next();!l.done;l=o.next()){l=l.value;var h=Qo(l);Me(h.language)==e&&(r=l,i?h.roles.includes(i)&&(s=l):h.roles.length==0&&(s=l))}s?Xh(this,s):r&&Xh(this,r)}},p.he=function(e,i,r){if(r=r===void 0?!1:r,this.i&&this.B)this.vb=e,this.cc=i||"",this.$b=r,(e=Vu(this.i.textStreams,this.vb,this.cc,this.$b)[0]||null)&&e!=this.j.o&&(Bh(this.o.h,e,!1),this.h.streaming.alwaysStreamText||this.Hd())&&(Ra(this.j,e),za(this));else{var s=Me(e);(e=this.Fb().find(function(o){return Me(o.language)==s&&(!i||o.roles.includes(i))&&o.forced==r}))&&this.Se(e)}},p.tg=function(e){if(this.i&&this.B){for(var i=null,r=v(this.i.variants),s=r.next();!s.done;s=r.next())if(s=s.value,s.audio.label==e){i=s;break}i!=null&&(this.ub=new Ln(i.language,"",0,e),Ua(this))}},p.Hd=function(){var e=this.ca;return this.G?this.G.m.isTextVisible():this.g&&this.g.src&&this.g.textTracks?Ys(this).some(function(i){return i.mode=="showing"}):e},p.He=function(){return this.g&&this.g.src&&this.g.textTracks?Cm(this).map(function(e){return hp(e)}):[]},p.Cf=function(e){var i=Me(e),r=Cm(this).filter(function(d){return Me(d.language)==i});if(!r||!r.length)return[];e=[];var s=new Set;r=v(r);for(var o=r.next();!o.done;o=r.next())if((o=o.value)&&o.cues){o=v(o.cues);for(var l=o.next();!l.done;l=o.next()){var h=l.value;(l=h.id)&&l!=""||(l=h.startTime+"-"+h.endTime+"-"+h.text),h={id:l,title:h.text,startTime:h.startTime,endTime:h.endTime},s.has(l)||(e.push(h),s.add(l))}}return e};function Ys(e){return Array.from(e.g.textTracks).filter(function(i){return i.kind!="metadata"&&i.kind!="chapters"&&i.label!="Shaka Player TextTrack"})}function E1(e){return Array.from(e.g.textTracks).filter(function(i){return i.kind=="metadata"})}function Cm(e){return Array.from(e.g.textTracks).filter(function(i){return i.kind=="chapters"})}p.yg=function(e){if(e=!!e,this.ca!=e){if(this.ca=e,this.l==Wt)this.G.m.setTextVisibility(e),this.h.streaming.alwaysStreamText||(e?this.j.o||(e=Vu(this.i.textStreams,this.vb,this.cc,this.$b),0<e.length&&(Ra(this.j,e[0]),za(this))):Aw(this.j));else if(this.g&&this.g.src&&this.g.textTracks){var i=Ys(this);i=v(i);for(var r=i.next();!r.done;r=i.next())r=r.value,r.mode!="disabled"&&(r.mode=e?"showing":"hidden")}Dm(this)}},p.Of=function(){if(!this.U())return null;var e=this.Ga.l,i=0;if(this.B)i=this.B.Ic();else if(e){if(e.startTime==null)return new Date;i=e.startTime}return this.i?new Date(1e3*(this.i.presentationTimeline.i+i)):this.g&&this.g.getStartDate?(e=this.g.getStartDate(),isNaN(e.getTime())?null:new Date(e.getTime()+1e3*i)):null},p.Ie=function(){if(!this.U())return null;if(this.i)return new Date(1e3*this.i.presentationTimeline.i);if(this.g&&this.g.getStartDate){var e=this.g.getStartDate();return isNaN(e.getTime())?null:e}return null},p.Na=function(){if(this.l==Wt)return this.G.Na();var e={total:[],audio:[],video:[],text:[]};return this.l==oi&&(e.total=vr(this.g.buffered)),e},p.getStats=function(){if(this.l!=Wt&&this.l!=oi)return{width:NaN,height:NaN,streamBandwidth:NaN,decodedFrames:NaN,droppedFrames:NaN,corruptedFrames:NaN,stallsDetected:NaN,gapsJumped:NaN,estimatedBandwidth:NaN,completionPercent:NaN,loadLatency:NaN,manifestTimeSeconds:NaN,drmTimeSeconds:NaN,playTime:NaN,pauseTime:NaN,bufferingTime:NaN,licenseTime:NaN,liveLatency:NaN,maxSegmentDuration:NaN,switchHistory:[],stateHistory:[]};Fa(this);var e=this.g,i=e.currentTime/e.duration;if(!isNaN(i)){var r=this.o;i=Math.round(100*i),r.i=isNaN(r.i)?i:Math.max(r.i,i)}if(this.B&&(this.o.M=this.B.te(),this.o.O=this.B.ue()),e.getVideoPlaybackQuality){r=e.getVideoPlaybackQuality(),i=this.o;var s=Number(r.totalVideoFrames);i.L=Number(r.droppedVideoFrames),i.J=s,this.o.H=Number(r.corruptedVideoFrames)}this.m?(r=this.m,r=r.H?r.H:NaN):r=NaN,this.o.s=r,this.l==Wt&&((r=this.j.l)&&(this.o.B=(this.H?this.H.i:1)*r.bandwidth),r&&r.video&&(i=this.o,s=r.video.height||NaN,i.o=r.video.width||NaN,i.l=s),this.U()&&(r=this.Ie().valueOf()+1e3*this.uc().end,this.o.D=(Date.now()-r)/1e3),this.i&&this.i.presentationTimeline&&(this.o.G=this.i.presentationTimeline.g),r=this.u.getBandwidthEstimate(),this.o.u=r),this.l==oi&&(r=this.o,i=e.videoHeight||NaN,r.o=e.videoWidth||NaN,r.l=i);var o=this.o;e=o.o,r=o.l,i=o.B,s=o.J;var l=o.L,h=o.H,d=o.O,g=o.M,_=o.u,y=o.i,S=o.m,w=o.F,E=o.j,R=zh(o.g,"playing"),P=zh(o.g,"paused"),L=zh(o.g,"buffering"),M=o.s,U=o.D,k=o.G,N=r1(o.g),B=[];o=v(o.h.g);for(var j=o.next();!j.done;j=o.next())j=j.value,B.push({timestamp:j.timestamp,id:j.id,type:j.type,fromAdaptation:j.fromAdaptation,bandwidth:j.bandwidth});return{width:e,height:r,streamBandwidth:i,decodedFrames:s,droppedFrames:l,corruptedFrames:h,stallsDetected:d,gapsJumped:g,estimatedBandwidth:_,completionPercent:y,loadLatency:S,manifestTimeSeconds:w,drmTimeSeconds:E,playTime:R,pauseTime:P,bufferingTime:L,licenseTime:M,liveLatency:U,maxSegmentDuration:k,stateHistory:N,switchHistory:B}},p.hf=function(e,i,r,s,o,l,h){h=h===void 0?!1:h;var d=this,g,_,y,S,w,E,R,P,L,M,U;return z(function(k){switch(k.g){case 1:if(d.l!=Wt&&d.l!=oi)throw new F(1,7,7004);if(s){k.A(2);break}return C(k,Hh(d,e),3);case 3:s=k.h;case 2:if(g=[],d.F)try{g=d.F.getServerSideCuePoints()}catch(N){}if(d.l!=oi){k.A(4);break}return h&&(r="forced"),C(k,bm(d,e,i,r,s,l||"",g),5);case 5:if(_=d.Fb(),y=_.find(function(N){return N.language==i&&N.label==(l||"")&&N.kind==r}))return si(d),k.return(y);throw new F(1,2,2012);case 4:if(S=wt,w=d.i.presentationTimeline.getDuration(),w==1/0)throw new F(1,4,4033);if(!g.length){k.A(6);break}return C(k,Vh(d,e,d.D,d.h.streaming.retryParameters),7);case 7:E=k.h,R=Im(d,E,s,g),P=new Blob([R],{type:"text/vtt"}),e=gh(P),s="text/vtt";case 6:if(L={id:d.Yd++,originalId:null,createSegmentIndex:function(){return Promise.resolve()},segmentIndex:xh(0,w,[e]),mimeType:s||"",codecs:o||"",kind:r,encrypted:!1,drmInfos:[],keyIds:new Set,language:i,label:l||null,type:S.X,primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],forced:!!h,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,closedCaptions:null},M=Pi(L.mimeType,L.codecs),U=qo(M),!U)throw new F(2,2,2014,s);return d.i.textStreams.push(L),si(d),k.return(Zo(L))}})},p.jf=function(e,i){var r=this,s,o,l,h,d,g,_,y,S,w,E,R,P,L,M,U;return z(function(k){switch(k.g){case 1:if(r.l!=Wt&&r.l!=oi)throw new F(1,7,7004);if(r.l==oi)throw new F(1,2,2016);if(i){k.A(2);break}return C(k,Hh(r,e),3);case 3:i=k.h;case 2:if(i!="text/vtt")throw new F(1,2,2017,e);if(s=wt,o=r.i.presentationTimeline.getDuration(),o==1/0)throw new F(1,4,4045);return C(k,Vh(r,e,r.D,r.h.streaming.retryParameters),4);case 4:if(l=k.h,h=ft[i],!h)throw new F(2,2,2014,i);for(d=h(),g={periodStart:0,segmentStart:0,segmentEnd:o,vttOffset:0},_=Ee(l),y=d.parseMedia(_,g),S=[],w={},E=v(y),R=E.next();!R.done;w={Rb:w.Rb},R=E.next())P=R.value,w.Rb=Ft([e],[P.payload])[0],L=new be(P.startTime,P.endTime,function(N){return function(){return[N.Rb]}}(w),0,null,null,0,0,1/0),w.Rb.includes("#xywh")&&(M=w.Rb.split("#xywh=")[1].split(","),M.length===4&&L.Ye({height:parseInt(M[3],10),positionX:parseInt(M[0],10),positionY:parseInt(M[1],10),width:parseInt(M[2],10)})),S.push(L);return U={id:r.Yd++,originalId:null,createSegmentIndex:function(){return Promise.resolve()},segmentIndex:new Pe(S),mimeType:i||"",codecs:"",kind:"",encrypted:!1,drmInfos:[],keyIds:new Set,language:"und",label:null,type:s.Wb,primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],forced:!1,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,closedCaptions:null,tilesLayout:"1x1"},r.i.imageStreams.push(U),si(r),k.return(ju(U))}})},p.gf=function(e,i,r){var s=this,o,l,h,d;return z(function(g){switch(g.g){case 1:if(s.l!=Wt&&s.l!=oi)throw new F(1,7,7004);if(r){g.A(2);break}return C(g,Hh(s,e),3);case 3:r=g.h;case 2:if(o=[],s.F)try{o=s.F.getServerSideCuePoints()}catch(_){}return C(g,bm(s,e,i,"chapters",r,"",o),4);case 4:if(l=g.h,h=s.He(),d=h.find(function(_){return _.language==i}),!d){g.A(5);break}return C(g,new Promise(function(_,y){s.s.ma(l,"load",_),s.s.ma(l,"error",function(){y(new F(1,2,2015))})}),6);case 6:return g.return(d);case 5:throw new F(1,2,2012)}})};function Hh(e,i){var r,s;return z(function(o){switch(o.g){case 1:return r=Nn(i),(s=M1[r])?o.return(s):(de(o,2),C(o,ig(i,e.D,e.h.streaming.retryParameters),4));case 4:s=o.h,Ae(o,3);break;case 2:oe(o);case 3:if(s)return o.return(s);throw new F(1,2,2011,r)}})}function bm(e,i,r,s,o,l,h){var d,g,_,y;return z(function(S){if(S.g==1)return o!="text/vtt"||h.length?C(S,Vh(e,i,e.D,e.h.streaming.retryParameters),3):S.A(2);S.g!=2&&(d=S.h,g=Im(e,d,o,h),_=new Blob([g],{type:"text/vtt"}),i=gh(_),o="text/vtt"),y=document.createElement("track");var w=e.V,E=i;try{if(w.g.enabled){var R=Ih(w);R.ot=Ph,R.su=!0;var P=Ma(R),L=Lh(E,P)}else L=E}catch(M){kr("CMCD_TEXT_TRACK_ERROR","Could not generate text track CMCD data.",M),L=E}return y.src=L,y.label=l,y.kind=s,y.srclang=r,e.g.getAttribute("crossorigin")||e.g.setAttribute("crossorigin","anonymous"),e.g.appendChild(y),S.return(y)})}function Vh(e,i,r,s){var o,l,h;return z(function(d){if(d.g==1){o=xr,l=ti([i],s),l.method="GET";var g=e.V;try{g.g.enabled&&Rh(g,l,{ot:Ph,su:!0})}catch(_){kr("CMCD_TEXT_ERROR","Could not generate text CMCD data.",_)}return C(d,r.request(o,l).promise,2)}return h=d.h,d.return(h.data)})}function Im(e,i,r,s){var o=ft[r];if(o)return r=o(),e={periodStart:0,segmentStart:0,segmentEnd:e.g.duration,vttOffset:0},i=Ee(i),i=r.parseMedia(i,e),Gw(i,s);throw new F(2,2,2014,r)}p.ke=function(e,i){this.ec.width=e,this.ec.height=i},p.ce=function(e){if(this.l==Wt){var i=this.j;if(e=e===void 0?.1:e,i.h.g)i=!1;else if(i.s)i=!1;else{for(var r=v(i.j.values()),s=r.next();!s.done;s=r.next())s=s.value,!s.nc||s.ra||s.Ka||(s.nc=!1,ni(i,s,e));i=!0}}else i=!1;return i},p.If=function(){return qe("Shaka Player's internal Manifest structure is NOT covered by semantic versioning compatibility guarantees.  It may change at any time!  Please consider filing a feature request for whatever you use getManifest() for."),this.i},p.Jf=function(){return this.Yc};function Gn(e){var i=Vn();return i.streaming.failureCallback=function(r){if(e.U()){var s=null;r.code==1001||r.code==1002?s=1:r.code==1003&&(s=.1),s!=null&&(r.severity=1,e.ce(s))}},i.textDisplayFactory=function(){return e.Uc?new Vt(e.g,e.Uc):new Ht(e.g)},i}p.$e=function(e){this.Uc=e};function C1(e,i){for(var r=new Set,s=v(i.textStreams),o=s.next();!o.done;o=s.next())o=o.value,o.mimeType!="application/cea-608"&&o.mimeType!="application/cea-708"||r.add(o.originalId);for(s=v(i.variants),o=s.next();!o.done;o=s.next())if((o=o.value.video)&&o.closedCaptions){for(var l=v(o.closedCaptions.keys()),h=l.next();!h.done;h=l.next())if(h=h.value,!r.has(h)){var d=h.startsWith("CC")?"application/cea-608":"application/cea-708",g=new it;d={id:e.Yd++,originalId:h,createSegmentIndex:function(){return Promise.resolve()},segmentIndex:g,mimeType:d,codecs:"",kind:"caption",encrypted:!1,drmInfos:[],keyIds:new Set,language:o.closedCaptions.get(h),label:null,type:De,primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:o.roles,forced:!1,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,closedCaptions:null},i.textStreams.push(d),r.add(h)}}}function Rm(e,i){return z(function(r){if(r.g==1)return C(r,b1(e,i),2);Lm(e,i),K(r)})}function b1(e,i){var r;return z(function(s){if(s.g==1)return r=e.j?e.j.l:null,C(s,DT(r,i),2);Bm(i),K(s)})}function Lm(e,i){if(e.l!=Si){zu(i.variants,e.h.restrictions,e.ec)&&e.j&&si(e);var r=e.m?e.m.g:null;if(r&&e.m.u)for(var s=v(i.variants),o=s.next();!o.done;o=s.next())o=o.value,Wh(e,r.keySystem,o.video),Wh(e,r.keySystem,o.audio);zm(e,i)}}function Wh(e,i,r){if(r){r=v(r.drmInfos);for(var s=r.next();!s.done;s=r.next())if(s=s.value,s.keySystem==i){s=v(s.initData||[]);for(var o=s.next();!o.done;o=s.next())o=o.value,Ds(e.m,o.initDataType,o.initData)}}}function I1(e,i){var r,s,o,l,h;return z(function(d){return d.g==1?(r=e.audio,s=e.video,o=function(g,_){var y,S,w;return z(function(E){return E.g==1?g?C(E,g.createSegmentIndex(),2):E.return(null):(S=(y=g.segmentIndex.Cb(_))?y.next().value:null,S?(w=S.startTime,E.return(w)):E.return(null))})},C(d,o(r,i),2)):d.g!=3?(l=d.h,C(d,o(s,i),3)):(h=d.h,h!=null&&l!=null?d.return(Math.max(h,l)):h!=null?d.return(h):l!=null?d.return(l):d.return(i))})}function Gh(e){var i=e.Fd();if(e.o&&e.M&&e.B){var r=e.H;r.j=i,em(r),e.V&&(r=e.V,i||r.i||(r.i=!0),r.i&&i&&(r.l=!0),r.m=i),Fa(e)}i=new Map().set("buffering",i),e.dispatchEvent(st("buffering",i))}function Mm(e){var i=e.g.playbackRate;i!=0&&(e.H&&e.H.set(i),i=st("ratechange"),e.dispatchEvent(i))}function Fa(e){if(e.o&&e.M){var i=e.o.g;e.M.g==Mn?Da(i,"buffering"):e.g.paused?Da(i,"paused"):e.g.ended?Da(i,"ended"):Da(i,"playing")}}function Ks(e){try{zm(e,e.i)}catch(r){return Qr(e,r),!1}var i=e.i.variants.filter(function(r){return Is(r)});return i=e.ub.create(i),e.u.setVariants(Array.from(i.values())),!0}function Na(e){return Ks(e)?e.u.chooseVariant():null}function Ua(e){var i=Na(e);i&&Zs(e,i,!0,!0,0)}function Zs(e,i,r,s,o){var l=e.j.l;if(i==l)s&&sm(e.j,i,s,o,!0);else{var h=e.o.h;h.h!=i&&(h.h=i,h.g.push({timestamp:Date.now()/1e3,id:i.id,type:"variant",fromAdaptation:r,bandwidth:i.bandwidth})),sm(e.j,i,s,o,void 0,r),s=null,l&&(s=Hr(l)),i=Hr(i),r?Pm(e,s,i):km(e,s,i)}}function Xh(e,i){var r=Array.from(e.g.audioTracks).find(function(s){return s.enabled});i.enabled=!0,i.id!==r.id&&(r.enabled=!1),r=Qo(r),i=Qo(i),km(e,r,i)}function R1(e,i,r){if(e.h.autoShowText==0)return!1;if(e.h.autoShowText==1)return!0;var s=Me(e.h.preferredTextLanguage);return r=Me(r.language),e.h.autoShowText==2?$o(r,s):e.h.autoShowText==3?(e=Me(i.language),$o(r,s)&&!$o(e,r)):(qe("Invalid autoShowText setting!"),!1)}function Pm(e,i,r){i=new Map().set("oldTrack",i).set("newTrack",r),e.L&&Pg(e.L,r),r=st("adaptation",i),Xn(e,r)}function si(e){var i=st("trackschanged");Xn(e,i)}function km(e,i,r){i=new Map().set("oldTrack",i).set("newTrack",r),e.L&&Pg(e.L,r),r=st("variantchanged",i),Xn(e,r)}function za(e){var i=st("textchanged");Xn(e,i)}function Dm(e){var i=st("texttrackvisibility");Xn(e,i)}function Om(e){var i=new Map().set("newStatus",e.h.abr.enabled);Xn(e,st("abrstatuschanged",i))}function L1(e,i){if(i.code!=1002&&i.code!=1011||i.category!=1||!navigator.onLine)return!1;var r=e.h.streaming.maxDisabledTime;if(r==0)if(i.code==1011)r=1;else return!1;i=e.Xa().find(function(h){return h.active});for(var s=e.i,o=v(s.variants),l=o.next();!l.done;l=o.next())l=l.value,l.id===i.id&&(l.disabledUntilTime=Date.now()/1e3+r);return zu(s.variants,e.h.restrictions,e.ec),i=Na(e),i?(s=e.Na().video.reduce(function(h,d){return h+d.end-d.start},0),Zs(e,i,!1,!0,s),e.af.N(r),!0):!1}function Qr(e,i){if(e.l!=Si)if(L1(e,i))i.handled=!0;else{var r=st("error",new Map().set("detail",i));e.dispatchEvent(r),r.defaultPrevented&&(i.handled=!0)}}function Qs(e,i,r){r=new Map().set("detail",{schemeIdUri:r.schemeIdUri,value:r.value,startTime:r.startTime,endTime:r.endTime,id:r.id,eventElement:r.eventElement}),e.dispatchEvent(st(i,r))}function qh(e){if(!e.g.error)return null;var i=e.g.error.code;if(i==1)return null;var r=e.g.error.msExtendedCode;return r&&(0>r&&(r+=Math.pow(2,32)),r=r.toString(16)),new F(2,3,3016,i,r,e.g.error.message)}function Fm(e,i){if(e.j){var r=Object.keys(i),s=r.length==1&&r[0]=="00",o=!1;if(r.length){r=v(e.i.variants);for(var l=r.next();!l.done;l=r.next()){l=l.value;var h=[];l.audio&&h.push(l.audio),l.video&&h.push(l.video),h=v(h);for(var d=h.next();!d.done;d=h.next()){var g=d.value;if(d=l.allowedByKeySystem,g.keyIds.size){l.allowedByKeySystem=!0,g=v(g.keyIds);for(var _=g.next();!_.done;_=g.next())_=_.value,_=i[s?"00":_],l.allowedByKeySystem=l.allowedByKeySystem&&!!_&&!Wm.includes(_)}d!=l.allowedByKeySystem&&(o=!0)}}}(!o||Ks(e))&&((i=e.j.l)&&!i.allowedByKeySystem&&Ua(e),o&&si(e))}}function Nm(e,i,r){e.J&&e.J.onExpirationUpdated&&e.J.onExpirationUpdated(i,r),i=st("expirationupdated"),e.dispatchEvent(i)}function Um(e,i,r){0<i&&(e.U()||e.Ze(i)),i=e.getDuration(),r<i&&(e.U()||e.Aa(r))}function zm(e,i){e=e.m?e.m.Qc():{};var r=Object.keys(e);r=r.length&&r[0]=="00";var s=!1,o=!1,l=new Set,h=new Set;i=v(i.variants);for(var d=i.next();!d.done;d=i.next()){d=d.value;var g=[];d.audio&&g.push(d.audio),d.video&&g.push(d.video),g=v(g);for(var _=g.next();!_.done;_=g.next())if(_=_.value,_.keyIds.size){_=v(_.keyIds);for(var y=_.next();!y.done;y=_.next()){y=y.value;var S=e[r?"00":y];S?Wm.includes(S)&&h.add(S):l.add(y)}}d.allowedByApplication?d.allowedByKeySystem&&(s=!0):o=!0}if(!s)throw e={hasAppRestrictions:o,missingKeys:Array.from(l),restrictedKeyStatuses:Array.from(h)},new F(2,4,4012,e)}function Bm(e){if(!e.variants.some(Is))throw new F(2,4,4032)}function Xn(e,i){z(function(r){if(r.g==1)return C(r,Promise.resolve(),2);e.l!=Si&&e.dispatchEvent(i),K(r)})}function jm(e){var i=new Set;e=v(e);for(var r=e.next();!r.done;r=e.next())r=r.value,r.language?i.add(Me(r.language)):i.add("und");return i}function Hm(e){var i=new Map,r=new Map;e=v(e);for(var s=e.next();!s.done;s=e.next()){s=s.value;var o="und",l=[];s.language&&(o=Me(s.language)),s.type=="variant"?l=s.audioRoles:l=s.roles,l&&l.length||(l=[""]),i.has(o)||i.set(o,new Set),l=v(l);for(var h=l.next();!h.done;h=l.next())h=h.value,i.get(o).add(h),s.label&&(r.has(o)||r.set(o,new Map),r.get(o).set(h,s.label))}var d=[];return i.forEach(function(g,_){g=v(g);for(var y=g.next();!y.done;y=g.next()){y=y.value;var S=null;r.has(_)&&r.get(_).has(y)&&(S=r.get(_).get(y)),d.push({language:_,role:y,label:S})}}),d}function Jr(){return new F(2,7,7e3)}function $h(e,i,r,s,o,l){return s==e&&o.mediaElement==l.mediaElement&&o.uri==l.uri&&o.mimeType==l.mimeType?i:r}function qn(){return{mediaElement:null,mimeType:null,startTime:null,ne:NaN,uri:null}}function Yh(e){return new Promise(function(i,r){e.mb=function(){return r(Jr())},e.bd=function(){return i()},e.onError=function(s){return r(s)},e.dd=function(){return r(Jr())}})}te("shaka.Player",H),H.prototype.setVideoContainer=H.prototype.$e,H.prototype.getManifestParserFactory=H.prototype.Jf,H.prototype.getManifest=H.prototype.If,H.prototype.retryStreaming=H.prototype.ce,H.prototype.setMaxHardwareResolution=H.prototype.ke,H.prototype.addChaptersTrack=H.prototype.gf,H.prototype.addThumbnailsTrack=H.prototype.jf,H.prototype.addTextTrackAsync=H.prototype.hf,H.prototype.getStats=H.prototype.getStats,H.prototype.getBufferedInfo=H.prototype.Na,H.prototype.getPresentationStartTimeAsDate=H.prototype.Ie,H.prototype.getPlayheadTimeAsDate=H.prototype.Of,H.prototype.setTextTrackVisibility=H.prototype.yg,H.prototype.getChapters=H.prototype.Cf,H.prototype.getChaptersTracks=H.prototype.He,H.prototype.isTextTrackVisible=H.prototype.Hd,H.prototype.selectVariantsByLabel=H.prototype.tg,H.prototype.selectTextLanguage=H.prototype.he,H.prototype.selectAudioLanguage=H.prototype.ge,H.prototype.getTextLanguages=H.prototype.Qf,H.prototype.getAudioLanguages=H.prototype.zf,H.prototype.getTextLanguagesAndRoles=H.prototype.Rf,H.prototype.getAudioLanguagesAndRoles=H.prototype.Af,H.prototype.selectVariantTrack=H.prototype.Te,H.prototype.selectTextTrack=H.prototype.Se,H.prototype.getThumbnails=H.prototype.Tf,H.prototype.getImageTracks=H.prototype.Ff,H.prototype.getTextTracks=H.prototype.Fb,H.prototype.getVariantTracks=H.prototype.Xa,H.prototype.cancelTrickPlay=H.prototype.pf,H.prototype.trickPlay=H.prototype.Ag,H.prototype.getPlaybackRate=H.prototype.Rc,H.prototype.isBuffering=H.prototype.Fd,H.prototype.getKeyStatuses=H.prototype.Qc,H.prototype.getExpiration=H.prototype.ic,H.prototype.drmInfo=H.prototype.drmInfo,H.prototype.keySystem=H.prototype.keySystem,H.prototype.goToLive=H.prototype.Xf,H.prototype.seekRange=H.prototype.uc,H.prototype.isAudioOnly=H.prototype.Zf,H.prototype.isInProgress=H.prototype.jb,H.prototype.isLive=H.prototype.U,H.prototype.getAdManager=H.prototype.Ge,H.prototype.getAssetUri=H.prototype.Dd,H.prototype.getNetworkingEngine=H.prototype.jc,H.prototype.getMediaElement=H.prototype.Lf,H.prototype.getLoadMode=H.prototype.Hf,H.prototype.resetConfiguration=H.prototype.rg,H.prototype.getBufferFullness=H.prototype.Bf,H.prototype.getConfiguration=H.prototype.getConfiguration,H.prototype.configure=H.prototype.configure,H.prototype.load=H.prototype.load,H.prototype.updateStartTime=H.prototype.Fg,H.prototype.unload=H.prototype.re,H.prototype.detach=H.prototype.detach,H.prototype.attachCanvas=H.prototype.lf,H.prototype.attach=H.prototype.Yb,H.probeSupport=function(e){e=e===void 0?!0:e;var i,r,s,o,l,h;return z(function(d){if(d.g==1)return i={},e?C(d,TS(),3):d.A(2);d.g!=2&&(i=d.h);var g={};if(xi()){for(var _ in ii)g[_]=!0;for(var y in Xr)g[y]=!0}_={mpd:"application/dash+xml",m3u8:"application/x-mpegurl",ism:"application/vnd.ms-sstr+xml"},y=v(["application/dash+xml","application/x-mpegurl","application/vnd.apple.mpegurl","application/vnd.ms-sstr+xml"]);for(var S=y.next();!S.done;S=y.next())S=S.value,g[S]=xi()?!!ii[S]:En(S);for(var w in _)g[w]=xi()?!!Xr[w]:En(_[w]);for(r=g,w='video/mp4; codecs="avc1.42E01E",video/mp4; codecs="avc3.42E01E",video/mp4; codecs="hev1.1.6.L93.90",video/mp4; codecs="hvc1.1.6.L93.90",video/mp4; codecs="hev1.2.4.L153.B0"; eotf="smpte2084",video/mp4; codecs="hvc1.2.4.L153.B0"; eotf="smpte2084",video/mp4; codecs="vp9",video/mp4; codecs="vp09.00.10.08",video/mp4; codecs="av01.0.01M.08",audio/mp4; codecs="mp4a.40.2",audio/mp4; codecs="ac-3",audio/mp4; codecs="ec-3",audio/mp4; codecs="opus",audio/mp4; codecs="flac",video/webm; codecs="vp8",video/webm; codecs="vp9",video/webm; codecs="vp09.00.10.08",audio/webm; codecs="vorbis",audio/webm; codecs="opus",video/mp2t; codecs="avc1.42E01E",video/mp2t; codecs="avc3.42E01E",video/mp2t; codecs="hvc1.1.6.L93.90",video/mp2t; codecs="mp4a.40.2",video/mp2t; codecs="ac-3",video/mp2t; codecs="ec-3",text/vtt,application/mp4; codecs="wvtt",application/ttml+xml,application/mp4; codecs="stpp"'.split(",").concat(O(zn)),g={},w=v(w),_=w.next();!_.done;_=w.next())_=_.value,g[_]=xi()?qo(_)?!0:Qt(_)||Du(_):En(_),y=_.split(";")[0],g[y]=g[y]||g[_];s=g,o={manifest:r,media:s,drm:i},l=Zh;for(h in l)o[h]=l[h]();return d.return(o)})},H.isBrowserSupported=function(){if(u.Promise||qe("A Promise implementation or polyfill is required"),!(u.Promise&&u.Uint8Array&&Array.prototype.forEach)||$e("Trident/"))return!1;var e=Lu();return e&&13>e||!(u.MediaKeys&&u.navigator&&u.navigator.requestMediaKeySystemAccess&&u.MediaKeySystemAccess&&u.MediaKeySystemAccess.prototype.getConfiguration)?!1:xi()?!0:En("application/x-mpegurl")},H.setAdManagerFactory=function(e){Ba=e},H.registerSupportPlugin=function(e,i){Zh[e]=i},H.prototype.destroy=H.prototype.destroy;var Si=0,Kh=1,Wt=2,oi=3;H.LoadMode={DESTROYED:Si,NOT_LOADED:Kh,MEDIA_SOURCE:Wt,SRC_EQUALS:oi},H.version="v4.3.5";var Vm=["4","3"];yp=new function(e){this.g=e,this.i=XT,this.h=qT}(new Gu(Number(Vm[0]),Number(Vm[1])));var Wm=["output-restricted","internal-error"],Zh={},Ba=null,ja={mp4:"video/mp4",m4v:"video/mp4",m4a:"audio/mp4",webm:"video/webm",weba:"audio/webm",mkv:"video/webm",ts:"video/mp2t",ogv:"video/ogg",ogg:"audio/ogg",mpg:"video/mpeg",mpeg:"video/mpeg",m3u8:"application/x-mpegurl",mpd:"application/dash+xml",mp3:"audio/mpeg",aac:"audio/aac",flac:"audio/flac",wav:"audio/wav"},M1={sbv:"text/x-subviewer",srt:"text/srt",vtt:"text/vtt",webvtt:"text/vtt",ttml:"application/ttml+xml",lrc:"application/x-subtitle-lrc",ssa:"text/x-ssa",ass:"text/x-ssa"};function Gm(){this.h=[],this.j=this.i=this.g=0}function ve(e,i,r){var s=this;this.h=e,this.g=i,this.m=r,this.i=!1,this.l=this.g.getVolume(),this.j=new je,this.j.C(this.g,google.ima.AdEvent.Type.PAUSED,function(){s.i=!0}),this.j.C(this.g,google.ima.AdEvent.Type.RESUMED,function(){s.i=!1})}p=ve.prototype,p.getDuration=function(){return this.h.getDuration()},p.getMinSuggestedDuration=function(){return this.h.getMinSuggestedDuration()},p.getRemainingTime=function(){return this.g.getRemainingTime()},p.isPaused=function(){return this.i},p.isSkippable=function(){return 0<=this.h.getSkipTimeOffset()},p.getTimeUntilSkippable=function(){var e=this.h.getSkipTimeOffset();return e=this.getRemainingTime()-e,Math.max(e,0)},p.canSkipNow=function(){return this.g.getAdSkippableState()},p.skip=function(){return this.g.skip()},p.pause=function(){return this.g.pause()},p.play=function(){return this.g.resume()},p.getVolume=function(){return this.g.getVolume()},p.setVolume=function(e){return this.g.setVolume(e)},p.isMuted=function(){return this.g.getVolume()==0},p.isLinear=function(){return this.h.isLinear()},p.resize=function(e,i){var r=!1,s=this.m;document.fullscreenEnabled?r=!!document.fullscreenElement:s.webkitSupportsFullscreen&&(r=s.webkitDisplayingFullscreen),this.g.resize(e,i,r?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL)},p.setMuted=function(e){e?(this.l=this.getVolume(),this.setVolume(0)):this.setVolume(this.l)},p.getSequenceLength=function(){var e=this.h.getAdPodInfo();return e==null?1:e.getTotalAds()},p.getPositionInSequence=function(){var e=this.h.getAdPodInfo();return e==null?1:e.getAdPosition()},p.getTitle=function(){return this.h.getTitle()},p.getDescription=function(){return this.h.getDescription()},p.release=function(){this.g=this.h=null},te("shaka.ads.ClientSideAd",ve),ve.prototype.release=ve.prototype.release,ve.prototype.getDescription=ve.prototype.getDescription,ve.prototype.getTitle=ve.prototype.getTitle,ve.prototype.getPositionInSequence=ve.prototype.getPositionInSequence,ve.prototype.getSequenceLength=ve.prototype.getSequenceLength,ve.prototype.setMuted=ve.prototype.setMuted,ve.prototype.resize=ve.prototype.resize,ve.prototype.isLinear=ve.prototype.isLinear,ve.prototype.isMuted=ve.prototype.isMuted,ve.prototype.setVolume=ve.prototype.setVolume,ve.prototype.getVolume=ve.prototype.getVolume,ve.prototype.play=ve.prototype.play,ve.prototype.pause=ve.prototype.pause,ve.prototype.skip=ve.prototype.skip,ve.prototype.canSkipNow=ve.prototype.canSkipNow,ve.prototype.getTimeUntilSkippable=ve.prototype.getTimeUntilSkippable,ve.prototype.isSkippable=ve.prototype.isSkippable,ve.prototype.isPaused=ve.prototype.isPaused,ve.prototype.getRemainingTime=ve.prototype.getRemainingTime,ve.prototype.getMinSuggestedDuration=ve.prototype.getMinSuggestedDuration,ve.prototype.getDuration=ve.prototype.getDuration;function Qh(e,i,r,s){var o=this;this.o=e,this.i=i,this.s=null,this.u=NaN,this.l=s,this.j=null,this.h=new je,google.ima.settings.setLocale(r),e=new google.ima.AdDisplayContainer(this.o,this.i),e.initialize(),this.m=new google.ima.AdsLoader(e),this.m.getSettings().setPlayerType("shaka-player"),this.m.getSettings().setPlayerVersion("v4.3.5"),this.g=null,this.h.ma(this.m,google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,function(l){P1(o,l)}),this.h.C(this.m,google.ima.AdErrorEvent.Type.AD_ERROR,function(l){Xm(o,l)}),this.h.C(this.i,"ended",function(){o.m.contentComplete()})}Qh.prototype.stop=function(){this.g&&this.g.stop(),this.o&&La(this.o)},Qh.prototype.release=function(){this.stop(),this.s&&this.s.disconnect(),this.h&&this.h.release(),this.g&&this.g.destroy(),this.m.destroy()};function Xm(e,i){i.getError(),Va(e,null),e.l(new fe("ad-cue-points-changed",new Map().set("cuepoints",[])))}function P1(e,i){e.l(new fe("ads-loaded",new Map().set("loadTime",Date.now()/1e3-e.u))),e.g=i.getAdsManager(e.i),e.l(new fe("ima-ad-manager-loaded",new Map().set("imaAdManager",e.g)));var r=e.g.getCuePoints();if(r.length){i=[],r=v(r);for(var s=r.next();!s.done;s=r.next())i.push({start:s.value,end:null});e.l(new fe("ad-cue-points-changed",new Map().set("cuepoints",i)))}k1(e);try{e.g.init(e.i.offsetWidth,e.i.offsetHeight,Ha(e)?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL),e.h.C(e.i,"loadeddata",function(){e.g.resize(e.i.offsetWidth,e.i.offsetHeight,Ha(e)?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL)}),"ResizeObserver"in u?(e.s=new ResizeObserver(function(){e.g.resize(e.i.offsetWidth,e.i.offsetHeight,Ha(e)?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL)}),e.s.observe(e.i)):e.h.C(document,"fullscreenchange",function(){e.g.resize(e.i.offsetWidth,e.i.offsetHeight,Ha(e)?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL)}),e.i.addEventListener("play",function(){e.g.start()},{once:!0})}catch(o){Va(e,null)}}function Ha(e){return document.fullscreenEnabled?!!document.fullscreenElement:(e=e.i,e.webkitSupportsFullscreen?e.webkitDisplayingFullscreen:!1)}function k1(e){function i(r,s){r=new Map().set("originalEvent",r),e.l(new fe(s,r))}e.h.C(e.g,google.ima.AdErrorEvent.Type.AD_ERROR,function(r){Xm(e,r)}),e.h.C(e.g,google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,function(r){qm(e,r)}),e.h.C(e.g,google.ima.AdEvent.Type.STARTED,function(r){qm(e,r)}),e.h.C(e.g,google.ima.AdEvent.Type.FIRST_QUARTILE,function(r){i(r,"ad-first-quartile")}),e.h.C(e.g,google.ima.AdEvent.Type.MIDPOINT,function(r){i(r,"ad-midpoint")}),e.h.C(e.g,google.ima.AdEvent.Type.THIRD_QUARTILE,function(r){i(r,"ad-third-quartile")}),e.h.C(e.g,google.ima.AdEvent.Type.COMPLETE,function(r){i(r,"ad-complete")}),e.h.C(e.g,google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,function(r){Va(e,r)}),e.h.C(e.g,google.ima.AdEvent.Type.ALL_ADS_COMPLETED,function(r){Va(e,r)}),e.h.C(e.g,google.ima.AdEvent.Type.SKIPPED,function(r){i(r,"ad-skipped")}),e.h.C(e.g,google.ima.AdEvent.Type.VOLUME_CHANGED,function(r){i(r,"ad-volume-changed")}),e.h.C(e.g,google.ima.AdEvent.Type.VOLUME_MUTED,function(r){i(r,"ad-muted")}),e.h.C(e.g,google.ima.AdEvent.Type.PAUSED,function(r){e.j&&(e.j.i=!0,i(r,"ad-paused"))}),e.h.C(e.g,google.ima.AdEvent.Type.RESUMED,function(r){e.j&&(e.j.i=!1,i(r,"ad-resumed"))}),e.h.C(e.g,google.ima.AdEvent.Type.SKIPPABLE_STATE_CHANGED,function(r){e.j&&i(r,"ad-skip-state-changed")}),e.h.C(e.g,google.ima.AdEvent.Type.CLICK,function(r){i(r,"ad-clicked")}),e.h.C(e.g,google.ima.AdEvent.Type.AD_PROGRESS,function(r){i(r,"ad-progress")}),e.h.C(e.g,google.ima.AdEvent.Type.AD_BUFFERING,function(r){i(r,"ad-buffering")}),e.h.C(e.g,google.ima.AdEvent.Type.IMPRESSION,function(r){i(r,"ad-impression")}),e.h.C(e.g,google.ima.AdEvent.Type.DURATION_CHANGE,function(r){i(r,"ad-duration-changed")}),e.h.C(e.g,google.ima.AdEvent.Type.USER_CLOSE,function(r){i(r,"ad-closed")}),e.h.C(e.g,google.ima.AdEvent.Type.LOADED,function(r){i(r,"ad-loaded")}),e.h.C(e.g,google.ima.AdEvent.Type.ALL_ADS_COMPLETED,function(r){i(r,"all-ads-completed")}),e.h.C(e.g,google.ima.AdEvent.Type.LINEAR_CHANGED,function(r){i(r,"ad-linear-changed")}),e.h.C(e.g,google.ima.AdEvent.Type.AD_METADATA,function(r){i(r,"ad-metadata")}),e.h.C(e.g,google.ima.AdEvent.Type.LOG,function(r){i(r,"ad-recoverable-error")}),e.h.C(e.g,google.ima.AdEvent.Type.AD_BREAK_READY,function(r){i(r,"ad-break-ready")}),e.h.C(e.g,google.ima.AdEvent.Type.INTERACTION,function(r){i(r,"ad-interaction")})}function qm(e,i){var r=i.getAd();r?(e.j=new ve(r,e.g,e.i),i=new Map().set("ad",e.j).set("sdkAdObject",r).set("originalEvent",i),e.l(new fe("ad-started",i)),e.j.isLinear()&&(e.o.setAttribute("ad-active","true"),e.i.pause(),e.j.setVolume(e.i.muted?0:e.i.volume))):qe("The IMA SDK fired a "+i.type+" event with no associated ad. Unable to play ad!")}function Va(e,i){e.l(new fe("ad-stopped",new Map().set("originalEvent",i))),e.j&&e.j.isLinear()&&(e.o.removeAttribute("ad-active"),e.i.ended||e.i.play())}function Te(e,i){this.i=e,this.h=null,this.g=i}p=Te.prototype,p.getDuration=function(){return this.h?this.h.duration:-1},p.getMinSuggestedDuration=function(){return this.getDuration()},p.getRemainingTime=function(){return this.h?this.h.duration-this.h.currentTime:-1},p.isPaused=function(){return this.g.paused},p.isSkippable=function(){return this.i.isSkippable()},p.getTimeUntilSkippable=function(){var e=this.i.getSkipTimeOffset();return e=this.getRemainingTime()-e,Math.max(e,0)},p.canSkipNow=function(){return this.getTimeUntilSkippable()==0},p.skip=function(){this.g.currentTime+=this.getRemainingTime()},p.pause=function(){return this.g.pause()},p.play=function(){return this.g.play()},p.getVolume=function(){return this.g.volume},p.setVolume=function(e){this.g.volume=e},p.isMuted=function(){return this.g.muted},p.isLinear=function(){return!0},p.resize=function(){},p.setMuted=function(e){this.g.muted=e},p.getSequenceLength=function(){var e=this.i.getAdPodInfo();return e==null?1:e.getTotalAds()},p.getPositionInSequence=function(){var e=this.i.getAdPodInfo();return e==null?1:e.getAdPosition()},p.getTitle=function(){return this.i.getTitle()},p.getDescription=function(){return this.i.getDescription()},p.release=function(){this.g=this.h=this.i=null},te("shaka.ads.ServerSideAd",Te),Te.prototype.release=Te.prototype.release,Te.prototype.getDescription=Te.prototype.getDescription,Te.prototype.getTitle=Te.prototype.getTitle,Te.prototype.getPositionInSequence=Te.prototype.getPositionInSequence,Te.prototype.getSequenceLength=Te.prototype.getSequenceLength,Te.prototype.setMuted=Te.prototype.setMuted,Te.prototype.resize=Te.prototype.resize,Te.prototype.isLinear=Te.prototype.isLinear,Te.prototype.isMuted=Te.prototype.isMuted,Te.prototype.setVolume=Te.prototype.setVolume,Te.prototype.getVolume=Te.prototype.getVolume,Te.prototype.play=Te.prototype.play,Te.prototype.pause=Te.prototype.pause,Te.prototype.skip=Te.prototype.skip,Te.prototype.canSkipNow=Te.prototype.canSkipNow,Te.prototype.getTimeUntilSkippable=Te.prototype.getTimeUntilSkippable,Te.prototype.isSkippable=Te.prototype.isSkippable,Te.prototype.isPaused=Te.prototype.isPaused,Te.prototype.getRemainingTime=Te.prototype.getRemainingTime,Te.prototype.getMinSuggestedDuration=Te.prototype.getMinSuggestedDuration,Te.prototype.getDuration=Te.prototype.getDuration;function Wa(e,i,r,s){var o=this;this.s=e,this.l=i,this.j=null,this.G=NaN,this.i=s,this.F=!1,this.u=this.m=this.o=null,this.B="",this.D=[],this.h=new je,e=new google.ima.dai.api.UiSettings,e.setLocale(r),this.g=new google.ima.dai.api.StreamManager(this.l,this.s,e),this.i(new fe("ima-stream-manager-loaded",new Map().set("imaStreamManager",this.g))),this.h.C(this.g,google.ima.dai.api.StreamEvent.Type.LOADED,function(l){D1(o,l)}),this.h.C(this.g,google.ima.dai.api.StreamEvent.Type.ERROR,function(){o.B.length?o.j.resolve(o.B):o.j.reject("IMA Stream request returned an error and there was no backup asset uri provided."),o.j=null}),this.h.C(this.g,google.ima.dai.api.StreamEvent.Type.AD_BREAK_STARTED,function(){}),this.h.C(this.g,google.ima.dai.api.StreamEvent.Type.STARTED,function(l){l=l.getAd(),o.m=new Te(l,o.l),o.u&&(o.m.h=o.u),o.i(new fe("ad-started",new Map().set("ad",o.m))),o.s.setAttribute("ad-active","true")}),this.h.C(this.g,google.ima.dai.api.StreamEvent.Type.AD_BREAK_ENDED,function(){o.s.removeAttribute("ad-active");var l=o.l.currentTime;o.o&&o.o>l&&(o.l.currentTime=o.o,o.o=null)}),this.h.C(this.g,google.ima.dai.api.StreamEvent.Type.AD_PROGRESS,function(l){o.u=l.getStreamData().adProgressData,o.m&&(o.m.h=o.u)}),this.h.C(this.g,google.ima.dai.api.StreamEvent.Type.FIRST_QUARTILE,function(){o.i(new fe("ad-first-quartile"))}),this.h.C(this.g,google.ima.dai.api.StreamEvent.Type.MIDPOINT,function(){o.i(new fe("ad-midpoint"))}),this.h.C(this.g,google.ima.dai.api.StreamEvent.Type.THIRD_QUARTILE,function(){o.i(new fe("ad-third-quartile"))}),this.h.C(this.g,google.ima.dai.api.StreamEvent.Type.COMPLETE,function(){o.i(new fe("ad-complete")),o.i(new fe("ad-stopped")),o.s.removeAttribute("ad-active"),o.m=null}),this.h.C(this.g,google.ima.dai.api.StreamEvent.Type.SKIPPED,function(){o.i(new fe("ad-skipped")),o.i(new fe("ad-stopped"))}),this.h.C(this.g,google.ima.dai.api.StreamEvent.Type.CUEPOINTS_CHANGED,function(l){var h=l.getStreamData();l=[],h=v(h.cuepoints);for(var d=h.next();!d.done;d=h.next())d=d.value,l.push({start:d.start,end:d.end});o.D=l,o.i(new fe("ad-cue-points-changed",new Map().set("cuepoints",l)))})}Wa.prototype.stop=function(){this.B="",this.o=null,this.D=[]},Wa.prototype.release=function(){this.stop(),this.h&&this.h.release()},Wa.prototype.onCueMetadataChange=function(e){if(e.key&&e.data){var i={};i[e.key]=e.data,this.g.onTimedMetadata(i)}};function D1(e,i){e.i(new fe("ads-loaded",new Map().set("loadTime",Date.now()/1e3-e.G))),i=i.getStreamData().url,e.j.resolve(i),e.j=null,e.F||e.h.C(e.l,"seeked",function(){var r=e.l.currentTime;if(r!=0){e.g.streamTimeForContentTime(r);var s=e.g.previousCuePointForStreamTime(r);s&&!s.played&&(e.o=r,e.l.currentTime=s.start)}})}function se(){Le.call(this),this.g=this.i=null,this.h=new Gm,this.j=navigator.language}me(se,Le),p=se.prototype,p.setLocale=function(e){this.j=e},p.initClientSide=function(e,i){var r=this;if(!u.google||!google.ima||!google.ima.AdsLoader)throw new F(2,10,1e4);this.i&&this.i.release(),this.i=new Qh(e,i,this.j,function(s){if(s&&s.type)switch(s.type){case"ads-loaded":r.h.h.push(s.loadTime);break;case"ad-started":r.h.g++;break;case"ad-complete":r.h.i++;break;case"ad-skipped":r.h.j++}r.dispatchEvent(s)})},p.release=function(){this.i&&(this.i.release(),this.i=null),this.g&&(this.g.release(),this.g=null),Le.prototype.release.call(this)},p.onAssetUnload=function(){this.i&&this.i.stop(),this.g&&this.g.stop(),this.dispatchEvent(new fe("ad-stopped")),this.h=new Gm},p.requestClientSideAds=function(e){if(!this.i)throw new F(1,10,10001);var i=this.i;i.u=Date.now()/1e3,i.m.requestAds(e)},p.initServerSide=function(e,i){var r=this;if(!u.google||!google.ima||!google.ima.dai)throw new F(2,10,10002);this.g&&this.g.release(),this.g=new Wa(e,i,this.j,function(s){if(s&&s.type)switch(s.type){case"ads-loaded":r.h.h.push(s.loadTime);break;case"ad-started":r.h.g++;break;case"ad-complete":r.h.i++;break;case"ad-skipped":r.h.j++}r.dispatchEvent(s)})},p.requestServerSideStream=function(e,i){if(i=i===void 0?"":i,!this.g)throw new F(1,10,10003);e.adTagParameters||(e.adTagParameters={});var r=e.adTagParameters;return(r.mpt||r.mpv)&&qe('You have attempted to set "mpt" and/or "mpv" parameters of the ad tag. Please note that those parameters are used for Shaka adoption tracking and will be overriden.'),e.adTagParameters.mpt="shaka-player",e.adTagParameters.mpv="v4.3.5",r=this.g,r.j?e=Promise.reject(new F(1,10,10004)):(e instanceof google.ima.dai.api.LiveStreamRequest&&(r.F=!0),r.j=new Ve,r.g.requestStream(e),r.B=i||"",r.G=Date.now()/1e3,e=r.j),e},p.replaceServerSideAdTagParameters=function(e){if(!this.g)throw new F(1,10,10003);(e.mpt||e.mpv)&&qe('You have attempted to set "mpt" and/or "mpv" parameters of the ad tag. Please note that those parameters are used for Shaka adoption tracking and will be overriden.'),e.mpt="Shaka Player",e.mpv="v4.3.5",this.g.g.replaceAdTagParameters(e)},p.getServerSideCuePoints=function(){if(!this.g)throw new F(1,10,10003);return this.g.D},p.getStats=function(){var e=this.h;return{loadTimes:e.h,started:e.g,playedCompletely:e.i,skipped:e.j}},p.onDashTimedMetadata=function(e){if(this.g&&e.schemeIdUri=="urn:google:dai:2018"){var i=e.schemeIdUri,r=e.eventElement?e.eventElement.getAttribute("messageData"):null;this.g.g.processMetadata(i,r,e.startTime)}},p.onHlsTimedMetadata=function(e,i){this.g&&this.g.g.processMetadata("ID3",e.data,i)},p.onCueMetadataChange=function(e){this.g&&this.g.onCueMetadataChange(e)},te("shaka.ads.AdManager",se),se.prototype.onCueMetadataChange=se.prototype.onCueMetadataChange,se.prototype.onHlsTimedMetadata=se.prototype.onHlsTimedMetadata,se.prototype.onDashTimedMetadata=se.prototype.onDashTimedMetadata,se.prototype.getStats=se.prototype.getStats,se.prototype.getServerSideCuePoints=se.prototype.getServerSideCuePoints,se.prototype.replaceServerSideAdTagParameters=se.prototype.replaceServerSideAdTagParameters,se.prototype.requestServerSideStream=se.prototype.requestServerSideStream,se.prototype.initServerSide=se.prototype.initServerSide,se.prototype.requestClientSideAds=se.prototype.requestClientSideAds,se.prototype.onAssetUnload=se.prototype.onAssetUnload,se.prototype.release=se.prototype.release,se.prototype.initClientSide=se.prototype.initClientSide,se.prototype.setLocale=se.prototype.setLocale,se.ADS_LOADED="ads-loaded",se.AD_STARTED="ad-started",se.AD_FIRST_QUARTILE="ad-first-quartile",se.AD_MIDPOINT="ad-midpoint",se.AD_THIRD_QUARTILE="ad-third-quartile",se.AD_COMPLETE="ad-complete",se.AD_STOPPED="ad-stopped",se.AD_SKIPPED="ad-skipped",se.AD_VOLUME_CHANGED="ad-volume-changed",se.AD_MUTED="ad-muted",se.AD_PAUSED="ad-paused",se.AD_RESUMED="ad-resumed",se.AD_SKIP_STATE_CHANGED="ad-skip-state-changed",se.CUEPOINTS_CHANGED="ad-cue-points-changed",se.IMA_AD_MANAGER_LOADED="ima-ad-manager-loaded",se.IMA_STREAM_MANAGER_LOADED="ima-stream-manager-loaded",se.AD_CLICKED="ad-clicked",se.AD_PROGRESS="ad-progress",se.AD_BUFFERING="ad-buffering",se.AD_IMPRESSION="ad-impression",se.AD_DURATION_CHANGED="ad-duration-changed",se.AD_CLOSED="ad-closed",se.AD_LOADED="ad-loaded",se.ALL_ADS_COMPLETED="all-ads-completed",se.AD_LINEAR_CHANGED="ad-linear-changed",se.AD_METADATA="ad-metadata",se.AD_RECOVERABLE_ERROR="ad-recoverable-error",se.AD_BREAK_READY="ad-break-ready",se.AD_INTERACTION="ad-interaction",Ba=function(){return new se};function $m(e){return JSON.stringify(e,function(i,r){if(typeof r!="function"){if(r instanceof Event||r instanceof fe){var s={};for(o in r)(i=r[o])&&typeof i=="object"?o=="detail"&&(s[o]=i):o in Event||(s[o]=i);return s}if(r instanceof Error){var o=new Set(["name","message","stack"]);for(s in r)o.add(s);for(i=v(Object.getOwnPropertyNames(r)),s=i.next();!s.done;s=i.next())o.add(s.value);for(i={},o=v(o),s=o.next();!s.done;s=o.next())s=s.value,i[s]=r[s];r={__type__:"Error",contents:i}}else if(r instanceof TimeRanges){for(o={__type__:"TimeRanges",length:r.length,start:[],end:[]},r=v(vr(r)),s=r.next();!s.done;s=r.next())s=s.value,i=s.end,o.start.push(s.start),o.end.push(i);r=o}else r=r instanceof Uint8Array?{__type__:"Uint8Array",entries:Array.from(r)}:typeof r=="number"?isNaN(r)?"NaN":isFinite(r)?r:0>r?"-Infinity":"Infinity":r;return r}})}function Jh(e){return JSON.parse(e,function(i,r){if(r=="NaN")var s=NaN;else if(r=="-Infinity")s=-1/0;else if(r=="Infinity")s=1/0;else if(r&&typeof r=="object"&&r.__type__=="TimeRanges")s=O1(r);else if(r&&typeof r=="object"&&r.__type__=="Uint8Array")s=new Uint8Array(r.entries);else if(r&&typeof r=="object"&&r.__type__=="Error"){i=r.contents,r=Error(i.message);for(s in i)r[s]=i[s];s=r}else s=r;return s})}function O1(e){return{length:e.length,start:function(i){return e.start[i]},end:function(i){return e.end[i]}}}var Ym="ended play playing pause pausing ratechange seeked seeking timeupdate volumechange".split(" "),F1="buffered currentTime duration ended loop muted paused playbackRate seeking videoHeight videoWidth volume".split(" "),ec=["loop","playbackRate"],N1=["pause","play"],Ga={getAssetUri:2,getAudioLanguages:4,getAudioLanguagesAndRoles:4,getBufferFullness:1,getBufferedInfo:2,getExpiration:2,getKeyStatuses:2,getPlaybackRate:2,getTextLanguages:4,getTextLanguagesAndRoles:4,getImageTracks:2,getThumbnails:2,isAudioOnly:10,isBuffering:1,isInProgress:1,isLive:10,isTextTrackVisible:1,keySystem:10,seekRange:1,getLoadMode:10},Xa={getConfiguration:4,getStats:5,getTextTracks:2,getVariantTracks:2},tc={getPlayheadTimeAsDate:1,getPresentationStartTimeAsDate:20},Km=[["getConfiguration","configure"]],Zm=[["isTextTrackVisible","setTextTrackVisibility"]],U1="addChaptersTrack addTextTrackAsync addThumbnailsTrack cancelTrickPlay configure getChapters getChaptersTracks resetConfiguration retryStreaming selectAudioLanguage selectTextLanguage selectTextTrack selectVariantTrack selectVariantsByLabel setTextTrackVisibility trickPlay updateStartTime goToLive".split(" "),z1=["attach","attachCanvas","detach","load","unload"];function ic(e,i,r,s,o,l,h){var d=this;this.G=e,this.M=h,this.j=new we(i),this.O=r,this.u=!1,this.s=s,this.F=o,this.J=l,this.h=this.m=!1,this.L="",this.o=null,this.B=function(){return nc(d)},this.D=function(g,_){switch(g=Jh(_),g.type){case"event":var y=g.targetName,S=Cp(g.event);d.s(y,S);break;case"update":y=g.update;for(S in y){g=d.g[S]||{};for(var w in y[S])g[w]=y[S][w]}d.u&&(d.O(),d.u=!1);break;case"asyncComplete":if(S=g.id,w=g.error,g=d.i[S],delete d.i[S],g)if(w){S=new F(w.severity,w.category,w.code);for(y in w)S[y]=w[y];g.reject(S)}else g.resolve()}},this.g={video:{},player:{}},this.H=0,this.i={},this.l=null,eo.add(this)}p=ic.prototype,p.destroy=function(){return eo.delete(this),sc(this),ai&&e_(this),this.j&&(this.j.stop(),this.j=null),this.F=this.s=null,this.h=this.m=!1,this.D=this.B=this.l=this.i=this.g=this.o=null,Promise.resolve()},p.sa=function(){return this.h},p.ae=function(){return this.L},p.init=function(){if(this.G.length)if(u.chrome&&chrome.cast&&chrome.cast.isAvailable){this.m=!0,this.j.Mb();var e=new chrome.cast.SessionRequest(this.G,[],null,this.M,null);e=new chrome.cast.ApiConfig(e,function(i){for(var r=v(eo),s=r.next();!s.done;s=r.next())Jm(s.value,i)},function(i){for(var r=v(eo),s=r.next();!s.done;s=r.next())s=s.value,qa=i=="available",s.j.Mb()},"origin_scoped"),chrome.cast.initialize(e,function(){},function(){}),qa&&this.j.N(j1),(e=ai)&&e.status!=chrome.cast.SessionStatus.STOPPED?Jm(this,e):ai=null}else u.__onGCastApiAvailable!==t_&&($a=u.__onGCastApiAvailable||null,u.__onGCastApiAvailable=t_)},p.ie=function(e){this.o=e,this.h&&Js(this,{type:"appData",appData:this.o})},p.cast=function(e){var i=this;return z(function(r){if(!i.m)throw new F(1,8,8e3);if(!qa)throw new F(1,8,8001);if(i.h)throw new F(1,8,8002);return i.l=new Ve,chrome.cast.requestSession(function(s){return rc(i,e,s)},function(s){return Qm(i,s)}),C(r,i.l,0)})};function B1(e){if(e.h){var i=e.J();chrome.cast.requestSession(function(r){return rc(e,i,r)},function(r){return Qm(e,r)})}}p.Ab=function(){if(this.h){if(sc(this),ai){e_(this);try{ai.stop(function(){},function(){})}catch(e){}ai=null}nc(this)}},p.get=function(e,i){var r=this;if(e=="video"){if(N1.includes(i))return function(){return r.Qe.apply(r,[e,i].concat(O(Gi.apply(0,arguments))))}}else if(e=="player"){if(tc[i]&&!this.get("player","isLive")())return function(){};if(U1.includes(i))return function(){return r.Qe.apply(r,[e,i].concat(O(Gi.apply(0,arguments))))};if(z1.includes(i))return function(){return r.og.apply(r,[e,i].concat(O(Gi.apply(0,arguments))))};if(Ga[i]||Xa[i])return function(){return r.g[e][i]}}return this.g[e][i]},p.set=function(e,i,r){this.g[e][i]=r,Js(this,{type:"set",targetName:e,property:i,value:r})};function rc(e,i,r){ai=r,r.addUpdateListener(e.B),r.addMessageListener("urn:x-cast:com.google.shaka.v2",e.D),nc(e),Js(e,{type:"init",initState:i,appData:e.o}),e.l.resolve()}function Qm(e,i){var r=8003;switch(i.code){case"cancel":r=8004;break;case"timeout":r=8005;break;case"receiver_unavailable":r=8006}e.l.reject(new F(2,8,r,i))}p.Qe=function(e,i){Js(this,{type:"call",targetName:e,methodName:i,args:Gi.apply(2,arguments)})},p.og=function(e,i){var r=Gi.apply(2,arguments),s=new Ve,o=this.H.toString();this.H++,this.i[o]=s;try{Js(this,{type:"asyncCall",targetName:e,methodName:i,args:r,id:o})}catch(l){s.reject(l)}return s};function Jm(e,i){var r=e.J();e.l=new Ve,e.u=!0,rc(e,r,i)}function e_(e){var i=ai;i.removeUpdateListener(e.B),i.removeMessageListener("urn:x-cast:com.google.shaka.v2",e.D)}function nc(e){var i=ai?ai.status=="connected":!1;if(e.h&&!i){e.F();for(var r in e.g)e.g[r]={};sc(e)}e.h=i,e.L=i?ai.receiver.friendlyName:"",e.j.Mb()}function sc(e){for(var i in e.i){var r=e.i[i];delete e.i[i],r.reject(new F(1,7,7e3))}}function Js(e,i){i=$m(i);var r=ai;try{r.sendMessage("urn:x-cast:com.google.shaka.v2",i,function(){},pT)}catch(s){throw i=new F(2,8,8005,s),r=new fe("error",new Map().set("detail",i)),e.s("player",r),e.Ab(),i}}var j1=.02,qa=!1,ai=null,$a=null,eo=new Set;function t_(e){if($a?u.__onGCastApiAvailable=$a:delete u.__onGCastApiAvailable,$a=null,e)for(var i=v(eo),r=i.next();!r.done;r=i.next())r.value.init();typeof u.__onGCastApiAvailable=="function"&&u.__onGCastApiAvailable(e)}function rt(e,i,r,s){s=s===void 0?!1:s,Le.call(this);var o=this;this.i=e,this.h=i,this.m=this.o=this.j=this.s=this.l=null,this.D=r,this.B=s,this.u=new Map,this.g=new ic(r,function(){return r_(o)},function(){return n_(o)},function(l,h){return o_(o,l,h)},function(){return s_(o)},function(){return oc(o)},s),H1(this)}me(rt,Le),p=rt.prototype,p.destroy=function(e){return e&&this.g.Ab(),this.m&&(this.m.release(),this.m=null),e=[],this.h&&(e.push(this.h.destroy()),this.h=null),this.g&&(e.push(this.g.destroy()),this.g=null),this.s=this.l=this.i=null,Le.prototype.release.call(this),Promise.all(e)},p.Wf=function(){return this.l},p.Nf=function(){return this.s},p.nf=function(){return this.g.m&&qa},p.sa=function(){return this.g.sa()},p.ae=function(){return this.g.ae()},p.cast=function(){var e=this,i;return z(function(r){return r.g==1?(i=oc(e),C(r,e.g.cast(i),2)):e.h?C(r,e.h.re(),0):r.return()})},p.ie=function(e){this.g.ie(e)},p.zg=function(){B1(this.g)},p.Ab=function(){this.g.Ab()},p.qf=function(e,i){i=i===void 0?!1:i;var r=this;return z(function(s){if(s.g==1)return e==r.D&&i==r.B?s.return():(r.D=e,r.B=i,r.g.Ab(),C(s,r.g.destroy(),2));r.g=null,r.g=new ic(e,function(){return r_(r)},function(){return n_(r)},function(o,l){return o_(r,o,l)},function(){return s_(r)},function(){return oc(r)},i),r.g.init(),K(s)})};function H1(e){e.g.init(),e.m=new je;for(var i=v(Ym),r=i.next();!r.done;r=i.next())e.m.C(e.i,r.value,function(l){e.g.sa()||(l=Cp(l),e.j.dispatchEvent(l))});for(var s in ia)e.m.C(e.h,ia[s],function(l){e.g.sa()||e.o.dispatchEvent(l)});e.l={},i={};for(var o in e.i)i.Sb=o,Object.defineProperty(e.l,i.Sb,{configurable:!1,enumerable:!0,get:function(l){return function(){return W1(e,l.Sb)}}(i),set:function(l){return function(h){var d=l.Sb;e.g.sa()?e.g.set("video",d,h):e.i[d]=h}}(i)}),i={Sb:i.Sb};e.s={},i_(e,function(l){Object.defineProperty(e.s,l,{configurable:!1,enumerable:!0,get:function(){return G1(e,l)}})}),V1(e),e.j=new Le,e.j.Wc=e.l,e.o=new Le,e.o.Wc=e.s}function V1(e){var i=new Map;i_(e,function(r,s){i.has(s)?(s=i.get(s),r.length<s.length?e.u.set(r,s):e.u.set(s,r)):i.set(s,r)})}function i_(e,i){function r(g){return g=="constructor"||typeof s[g]!="function"?!1:!o.has(g)}var s=e.h,o=new Set,l;for(l in s)r(l)&&(o.add(l),i(l,s[l]));for(e=Object.getPrototypeOf(s),l=Object.getPrototypeOf({});e&&e!=l;){for(var h=v(Object.getOwnPropertyNames(e)),d=h.next();!d.done;d=h.next())d=d.value,r(d)&&(o.add(d),i(d,s[d]));e=Object.getPrototypeOf(e)}}function oc(e){var i={video:{},player:{},playerAfterLoad:{},manifest:e.h.Dd(),startTime:null};e.i.pause();for(var r=v(ec),s=r.next();!s.done;s=r.next())s=s.value,i.video[s]=e.i[s];for(e.i.ended||(i.startTime=e.i.currentTime),r=v(Km),s=r.next();!s.done;s=r.next()){var o=s.value;s=o[1],o=e.h[o[0]](),i.player[s]=o}for(r=v(Zm),s=r.next();!s.done;s=r.next())o=s.value,s=o[1],o=e.h[o[0]](),i.playerAfterLoad[s]=o;return i}function r_(e){var i=new fe("caststatuschanged");e.dispatchEvent(i)}function n_(e){var i=new fe(e.l.paused?"pause":"play");e.j.dispatchEvent(i)}function s_(e){for(var i=v(Km),r=i.next();!r.done;r=i.next()){var s=r.value;r=s[1],s=e.g.get("player",s[0])(),e.h[r](s)}var o=e.g.get("player","getAssetUri")();r=e.g.get("video","ended"),i=Promise.resolve();var l=e.i.autoplay;s=null,r||(s=e.g.get("video","currentTime")),o&&(e.i.autoplay=!1,i=e.h.load(o,s));var h={};for(r=v(ec),s=r.next();!s.done;s=r.next())s=s.value,h[s]=e.g.get("video",s);i.then(function(){if(e.i){for(var d=v(ec),g=d.next();!g.done;g=d.next())g=g.value,e.i[g]=h[g];for(d=v(Zm),g=d.next();!g.done;g=d.next()){var _=g.value;g=_[1],_=e.g.get("player",_[0])(),e.h[g](_)}e.i.autoplay=l,o&&e.i.play()}},function(d){d=new Map().set("detail",d),d=new fe("error",d),e.h.dispatchEvent(d)})}function W1(e,i){if(i=="addEventListener")return function(s,o,l){return e.j.addEventListener(s,o,l)};if(i=="removeEventListener")return function(s,o,l){return e.j.removeEventListener(s,o,l)};if(e.g.sa()&&Object.keys(e.g.g.video).length==0){var r=e.i[i];if(typeof r!="function")return r}return e.g.sa()?e.g.get("video",i):(i=e.i[i],typeof i=="function"&&(i=i.bind(e.i)),i)}function G1(e,i){if(e.u.has(i)&&(i=e.u.get(i)),i=="addEventListener")return function(r,s,o){return e.o.addEventListener(r,s,o)};if(i=="removeEventListener")return function(r,s,o){return e.o.removeEventListener(r,s,o)};if(i=="getMediaElement")return function(){return e.l};if(i=="getSharedConfiguration")return e.g.get("player","getConfiguration");if(i=="getNetworkingEngine")return function(){return e.h.jc()};if(i=="getDrmEngine")return function(){return e.h.m};if(i=="getAdManager")return function(){return e.h.Ge()};if(i=="setVideoContainer")return function(r){return e.h.$e(r)};if(e.g.sa()){if(i=="getManifest"||i=="drmInfo")return function(){return qe(i+"() does not work while casting!"),null};if(i=="attach"||i=="detach")return function(){return qe(i+"() does not work while casting!"),Promise.resolve()}}return e.g.sa()&&Object.keys(e.g.g.video).length==0&&(Ga[i]||Xa[i])||!e.g.sa()?e.h[i].bind(e.h):e.g.get("player",i)}function o_(e,i,r){e.g.sa()&&(i=="video"?e.j.dispatchEvent(r):i=="player"&&e.o.dispatchEvent(r))}te("shaka.cast.CastProxy",rt),rt.prototype.changeReceiverId=rt.prototype.qf,rt.prototype.forceDisconnect=rt.prototype.Ab,rt.prototype.suggestDisconnect=rt.prototype.zg,rt.prototype.setAppData=rt.prototype.ie,rt.prototype.cast=rt.prototype.cast,rt.prototype.receiverName=rt.prototype.ae,rt.prototype.isCasting=rt.prototype.sa,rt.prototype.canCast=rt.prototype.nf,rt.prototype.getPlayer=rt.prototype.Nf,rt.prototype.getVideo=rt.prototype.Wf,rt.prototype.destroy=rt.prototype.destroy;function yt(e,i,r,s){Le.call(this);var o=this;this.g=e,this.h=i,this.j=new je,this.H={video:e,player:i},this.D=r||function(){},this.J=s||function(l){return l},this.i=null,this.F=!1,this.o=!0,this.m=0,this.B=!1,this.u=!0,this.s=this.l=null,this.G=new we(function(){ac(o)}),X1(this)}me(yt,Le),p=yt.prototype,p.isConnected=function(){return this.F},p.$f=function(){return this.o},p.wg=function(e){this.i=e},p.uf=function(){this.i=null},p.xg=function(e){this.i||(this.i={metadataType:cast.receiver.media.MetadataType.GENERIC}),this.i.title=e},p.vg=function(e){this.i||(this.i={metadataType:cast.receiver.media.MetadataType.GENERIC}),this.i.images=[{url:e}]},p.ug=function(e){this.i||(this.i={}),this.i.artist=e,this.i.metadataType=cast.receiver.media.MetadataType.MUSIC_TRACK},p.destroy=function(){var e=this,i,r;return z(function(s){if(s.g==1)return e.j&&(e.j.release(),e.j=null),i=[],e.h&&(i.push(e.h.destroy()),e.h=null),e.G&&(e.G.stop(),e.G=null),e.g=null,e.H=null,e.D=null,e.F=!1,e.o=!0,e.l=null,e.s=null,Le.prototype.release.call(e),C(s,Promise.all(i),2);r=cast.receiver.CastReceiverManager.getInstance(),r.stop(),K(s)})};function X1(e){var i=cast.receiver.CastReceiverManager.getInstance();i.onSenderConnected=function(){return a_(e)},i.onSenderDisconnected=function(){return a_(e)},i.onSystemVolumeChanged=function(){var o=cast.receiver.CastReceiverManager.getInstance().getSystemVolume();o&&er(e,{type:"update",update:{video:{volume:o.level,muted:o.muted}}},e.l),er(e,{type:"event",targetName:"video",event:{type:"volumechange"}},e.l)},e.s=i.getCastMessageBus("urn:x-cast:com.google.cast.media"),e.s.onMessage=function(o){return Y1(e,o)},e.l=i.getCastMessageBus("urn:x-cast:com.google.shaka.v2"),e.l.onMessage=function(o){return $1(e,o)},i.start(),i=v(Ym);for(var r=i.next();!r.done;r=i.next())e.j.C(e.g,r.value,function(o){return l_(e,"video",o)});for(var s in ia)e.j.C(e.h,ia[s],function(o){return l_(e,"player",o)});cast.__platform__&&cast.__platform__.canDisplayType('video/mp4; codecs="avc1.640028"; width=3840; height=2160')?e.h.ke(3840,2160):e.h.ke(1920,1080),e.j.C(e.g,"loadeddata",function(){e.B=!0}),e.j.C(e.h,"loading",function(){e.o=!1,$n(e)}),e.j.C(e.g,"playing",function(){e.o=!1,$n(e)}),e.j.C(e.g,"pause",function(){$n(e)}),e.j.C(e.h,"unloading",function(){e.o=!0,$n(e)}),e.j.C(e.g,"ended",function(){new we(function(){e.g&&e.g.ended&&(e.o=!0,$n(e))}).N(Z1)})}function a_(e){e.m=0,e.u=!0,e.F=cast.receiver.CastReceiverManager.getInstance().getSenders().length!=0,$n(e)}function $n(e){var i;z(function(r){if(r.g==1)return C(r,Promise.resolve(),2);if(!e.h)return r.return();i=new fe("caststatuschanged"),e.dispatchEvent(i),u_(e)||tr(e),K(r)})}function q1(e,i,r){var s,o,l,h,d,g,_,y,S,w;z(function(E){switch(E.g){case 1:for(s in i.player)o=i.player[s],e.h[s](o);return e.D(r),l=e.g.autoplay,i.manifest?(e.g.autoplay=!1,de(E,5),C(E,e.h.load(i.manifest,i.startTime),7)):C(E,Promise.resolve(),3);case 7:Ae(E,3);break;case 5:return h=oe(E),d=new Map().set("detail",h),g=new fe("error",d),e.h&&e.h.dispatchEvent(g),E.return();case 3:if(!e.h)return E.return();for(_ in i.video)y=i.video[_],e.g[_]=y;for(S in i.playerAfterLoad)w=i.playerAfterLoad[S],e.h[S](w);e.g.autoplay=l,i.manifest&&(e.g.play(),tr(e)),K(E)}})}function l_(e,i,r){e.h&&(ac(e),er(e,{type:"event",targetName:i,event:r},e.l))}function ac(e){e.G.N(K1);for(var i={video:{},player:{}},r=v(F1),s=r.next();!s.done;s=r.next())s=s.value,i.video[s]=e.g[s];if(e.h.U())for(var o in tc)e.m%tc[o]==0&&(i.player[o]=e.h[o]());for(var l in Ga)e.m%Ga[l]==0&&(i.player[l]=e.h[l]());(r=cast.receiver.CastReceiverManager.getInstance().getSystemVolume())&&(i.video.volume=r.level,i.video.muted=r.muted),er(e,{type:"update",update:i},e.l);for(var h in Xa)e.m%Xa[h]==0&&(i={player:{}},i.player[h]=e.h[h](),er(e,{type:"update",update:i},e.l));e.B&&(e.m+=1),u_(e)}function u_(e){return e.u&&(e.g.duration||e.h.U())?(lc(e),e.u=!1,!0):!1}function lc(e,i){var r={contentId:e.h.Dd(),streamType:e.h.U()?"LIVE":"BUFFERED",contentType:""};e.h.U()||(r.duration=e.g.duration),e.i&&(r.metadata=e.i),tr(e,i===void 0?0:i,r)}function $1(e,i){var r=Jh(i.data);switch(r.type){case"init":e.m=0,e.B=!1,e.u=!0,q1(e,r.initState,r.appData),ac(e);break;case"appData":e.D(r.appData);break;case"set":var s=r.targetName,o=r.property;if(r=r.value,s=="video"){if(i=cast.receiver.CastReceiverManager.getInstance(),o=="volume"){i.setSystemVolumeLevel(r);break}else if(o=="muted"){i.setSystemVolumeMuted(r);break}}e.H[s][o]=r;break;case"call":s=e.H[r.targetName],s[r.methodName].apply(s,r.args);break;case"asyncCall":s=r.targetName,o=r.methodName,s=="player"&&o=="load"&&(e.m=0,e.B=!1);var l=r.id,h=i.senderId;i=e.H[s],r=i[o].apply(i,r.args),s=="player"&&o=="load"&&(r=r.then(function(){e.u=!0})),r.then(function(){return h_(e,h,l,null)},function(d){return h_(e,h,l,d)})}}function Y1(e,i){var r=Jh(i.data);switch(r.type){case"PLAY":e.g.play(),tr(e);break;case"PAUSE":e.g.pause(),tr(e);break;case"SEEK":i=r.currentTime;var s=r.resumeState;i!=null&&(e.g.currentTime=Number(i)),s&&s=="PLAYBACK_START"?(e.g.play(),tr(e)):s&&s=="PLAYBACK_PAUSE"&&(e.g.pause(),tr(e));break;case"STOP":e.h.re().then(function(){e.h&&tr(e)});break;case"GET_STATUS":lc(e,Number(r.requestId));break;case"VOLUME":s=r.volume,i=s.level,s=s.muted;var o=e.g.volume,l=e.g.muted;i!=null&&(e.g.volume=Number(i)),s!=null&&(e.g.muted=s),o==e.g.volume&&l==e.g.muted||tr(e);break;case"LOAD":e.m=0,e.B=!1,e.u=!1,i=r.media,s=r.currentTime,o=e.J(i.contentId),l=r.autoplay||!0,e.D(i.customData),l&&(e.g.autoplay=!0),e.h.load(o,s).then(function(){e.h&&lc(e)}).catch(function(h){var d="LOAD_FAILED";h.category==7&&h.code==7e3&&(d="LOAD_CANCELLED"),er(e,{requestId:Number(r.requestId),type:d},e.s)});break;default:er(e,{requestId:Number(r.requestId),type:"INVALID_REQUEST",reason:"INVALID_COMMAND"},e.s)}}function h_(e,i,r,s){e.h&&er(e,{type:"asyncComplete",id:r,error:s},e.l,i)}function er(e,i,r,s){e.F&&(e=$m(i),s?r.getCastChannel(s).send(e):r.broadcast(e))}function tr(e,i,r){r=r===void 0?null:r;var s={mediaSessionId:0,playbackRate:e.g.playbackRate,playerState:e.o?Q1:e.h.Fd()?eA:e.g.paused?tA:J1,currentTime:e.g.currentTime,supportedMediaCommands:63,volume:{level:e.g.volume,muted:e.g.muted}};r&&(s.media=r),er(e,{requestId:i===void 0?0:i,type:"MEDIA_STATUS",status:[s]},e.s)}te("shaka.cast.CastReceiver",yt),yt.prototype.destroy=yt.prototype.destroy,yt.prototype.setContentArtist=yt.prototype.ug,yt.prototype.setContentImage=yt.prototype.vg,yt.prototype.setContentTitle=yt.prototype.xg,yt.prototype.clearContentMetadata=yt.prototype.uf,yt.prototype.setContentMetadata=yt.prototype.wg,yt.prototype.isIdle=yt.prototype.$f,yt.prototype.isConnected=yt.prototype.isConnected;var K1=.5,Z1=5,Q1="IDLE",J1="PLAYING",eA="BUFFERING",tA="PAUSED";function c_(e,i,r){var s=oA(e),o=null;e=[];var l=[],h=new Set(s.map(function(d){return d.keyId}));if(h.delete(null),1<h.size)throw new F(2,4,4010);if(i||(l=s.filter(function(d){return d.fe=="urn:mpeg:dash:mp4protection:2011"?(o=d.init||o,!1):!0}),l.length&&(e=sA(o,l,r,h),e.length==0&&(e=[Nr("",o)]))),s.length&&(i||!l.length))for(e=[],i=v(Object.values(r)),r=i.next();!r.done;r=i.next())r=r.value,r!="org.w3.clearkey"&&e.push(Nr(r,o));if(h=Array.from(h)[0]||null)for(i=v(e),r=i.next();!r.done;r=i.next())for(r=v(r.value.initData),s=r.next();!s.done;s=r.next())s.value.keyId=h;return{Be:h,sh:o,drmInfos:e,Fe:!0}}function iA(e,i,r,s){var o=c_(e,r,s);if(i.Fe)e=i.drmInfos.length==1&&!i.drmInfos[0].keySystem,r=o.drmInfos.length==0,(i.drmInfos.length==0||e&&!r)&&(i.drmInfos=o.drmInfos),i.Fe=!1;else if(0<o.drmInfos.length&&(i.drmInfos=i.drmInfos.filter(function(l){return o.drmInfos.some(function(h){return h.keySystem==l.keySystem})}),i.drmInfos.length==0))throw new F(2,4,4008);return o.Be||i.Be}function rA(e){var i=0,r=Ot(e),s=r.getUint32(i,!0);if(s!=e.byteLength)return[];e:{for(e=i+6,i=[];e<r.byteLength-1;){s=r.getUint16(e,!0),e+=2;var o=r.getUint16(e,!0);if(e+=2,o&1||o+e>r.byteLength){r=[];break e}var l=Ee(r,e,o);i.push({type:s,value:l}),e+=o}r=i}return r}function nA(e){e=v(e.getElementsByTagName("DATA"));for(var i=e.next();!i.done;i=e.next()){i=v(i.value.childNodes);for(var r=i.next();!r.done;r=i.next())if(r=r.value,r instanceof Element&&r.tagName=="LA_URL")return r.textContent}return""}function Ya(e){return e=la(e.node,"urn:microsoft:playready","pro"),!e||(e=qi(e.textContent),e=rA(e).filter(function(i){return i.type===lA})[0],!e)?"":(e=gr(e.value,!0),(e=ks(e,"WRMHEADER"))?nA(e):"")}function sA(e,i,r,s){var o=[];i=v(i);for(var l=i.next();!l.done;l=i.next()){l=l.value;var h=r[l.fe];if(h){var d;if(d=la(l.node,"urn:microsoft:playready","pro")){d=qi(d.textContent);var g=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);d=[{initData:Yu(d,g,new Set,0),initDataType:"cenc",keyId:l.keyId}]}else d=null;if(g=null,l.fe==="urn:uuid:e2719d58-a985-b3c9-781a-b030af78d30e")if(g=s,g.size==0)g=null;else{var _=new Uint8Array([16,119,239,236,192,178,77,2,172,227,60,30,82,226,251,75]),y=new Uint8Array([]);g=[{initData:Yu(y,_,g,1),initDataType:"cenc",keyId:l.keyId}]}d=Nr(h,l.init||e||d||g),(h=uA.get(h))&&(d.licenseServerUri=h(l)),o.push(d)}}return o}function oA(e){var i=[];e=v(e);for(var r=e.next();!r.done;r=e.next())(r=aA(r.value))&&i.push(r);return i}function aA(e){var i=e.getAttribute("schemeIdUri"),r=Gr(e,"urn:mpeg:cenc:2013","default_KID"),s=zp(e,"urn:mpeg:cenc:2013","pssh").map(ua);if(!i)return null;if(i=i.toLowerCase(),r&&(r=r.replace(/-/g,"").toLowerCase(),r.includes(" ")))throw new F(2,4,4009);var o=[];try{o=s.map(function(l){return{initDataType:"cenc",initData:qi(l),keyId:null}})}catch(l){throw new F(2,4,4007)}return{node:e,fe:i,keyId:r,init:0<o.length?o:null}}var lA=1,uA=new Map().set("com.widevine.alpha",function(e){return(e=la(e.node,"urn:microsoft","laurl"))&&e.getAttribute("licenseUrl")||""}).set("com.microsoft.playready",Ya).set("com.microsoft.playready.recommendation",Ya).set("com.microsoft.playready.software",Ya).set("com.microsoft.playready.hardware",Ya).set("org.w3.clearkey",function(e){return(e=la(e.node,"http://dashif.org/guidelines/clearKey","Laurl"))&&e.getAttribute("Lic_type")==="EME-1.0"&&e.textContent?e.textContent:""});function Ka(e,i,r,s,o){var l={RepresentationID:i,Number:r,Bandwidth:s,Time:o};return e.replace(/\$(RepresentationID|Number|Bandwidth|Time)?(?:%0([0-9]+)([diouxX]))?\$/g,function(h,d,g,_){if(h=="$$")return"$";var y=l[d];if(y==null)return h;switch(d=="RepresentationID"&&g&&(g=void 0),d=="Time"&&(y=Math.round(y)),_){case void 0:case"d":case"i":case"u":h=y.toString();break;case"o":h=y.toString(8);break;case"x":h=y.toString(16);break;case"X":h=y.toString(16).toUpperCase();break;default:h=y.toString()}return g=u.parseInt(g,10)||1,Array(Math.max(0,g-h.length)+1).join("0")+h})}function d_(e,i){var r=Oi(e,i,"timescale"),s=1;r&&(s=ca(r)||1);var o=Oi(e,i,"duration");r=ca(o||""),e.I.contentType=="image"&&(r=Ps(o||"")),r&&(r/=s);var l=Oi(e,i,"startNumber");o=Number(Oi(e,i,"presentationTimeOffset"))||0;var h=Di(l||"");if((l==null||h==null)&&(h=1),l=Za(e,i,"SegmentTimeline"),i=null,l){i=s,e=e.T.duration||1/0,l=Qe(l,"S");for(var d=[],g=-o,_=0;_<l.length;++_){var y=l[_],S=l[_+1],w=We(y,"t",Di),E=We(y,"d",Di);if(y=We(y,"r",aS),w!=null&&(w-=o),!E)break;if(w=w!=null?w:g,y=y||0,0>y)if(S){if(S=We(S,"t",Di),S==null)break;if(w>=S)break;y=Math.ceil((S-w)/E)-1}else{if(e==1/0)break;if(w/i>=e)break;y=Math.ceil((e*i-w)/E)-1}for(0<d.length&&w!=g&&(d[d.length-1].end=w/i),S=0;S<=y;++S)g=w+E,d.push({start:w/i,end:g/i,Dg:w}),w=g}i=d}return{timescale:s,ia:r,Lb:h,Sa:o/s||0,se:o,timeline:i}}function Oi(e,i,r){return[i(e.I),i(e.fa),i(e.$)].filter(pr).map(function(s){return s.getAttribute(r)}).reduce(function(s,o){return s||o})}function Za(e,i,r){return[i(e.I),i(e.fa),i(e.$)].filter(pr).map(function(s){return aa(s,r)}).reduce(function(s,o){return s||o})}function hA(e,i,r,s,o,l){for(var h=Gr(e,"http://www.w3.org/1999/xlink","href"),d=Gr(e,"http://www.w3.org/1999/xlink","actuate")||"onRequest",g=v(Array.from(e.attributes)),_=g.next();!_.done;_=g.next())_=_.value,_.namespaceURI=="http://www.w3.org/1999/xlink"&&e.removeAttributeNS(_.namespaceURI,_.localName);if(5<=l)return Vr(new F(2,4,4028));if(d!="onLoad")return Vr(new F(2,4,4027));var y=Ft([s],[h]);return o.request(0,ti(y,i)).Y(function(S){if(S=Hp(S.data,e.tagName),!S)return Vr(new F(2,4,4001,h));for(;e.childNodes.length;)e.removeChild(e.childNodes[0]);for(;S.childNodes.length;){var w=S.childNodes[0];S.removeChild(w),e.appendChild(w)}for(S=v(Array.from(S.attributes)),w=S.next();!w.done;w=S.next())e.setAttributeNode(w.value.cloneNode(!1));return Qa(e,i,r,y[0],o,l+1)})}function Qa(e,i,r,s,o,l){if(l=l===void 0?0:l,Gr(e,"http://www.w3.org/1999/xlink","href")){var h=hA(e,i,r,s,o,l);return r&&(h=h.Y(void 0,function(){return Qa(e,i,r,s,o,l)})),h}h=[];for(var d=v(Array.from(e.childNodes)),g=d.next();!g.done;g=d.next())g=g.value,g instanceof Element&&(Gr(g,"http://www.w3.org/1999/xlink","href")=="urn:mpeg:dash:resolve-to-zero:2013"?e.removeChild(g):g.tagName!="SegmentTimeline"&&h.push(Qa(g,i,r,s,o,l)));return Ep(h).Y(function(){return e})}function cA(e,i,r,s,o,l,h){var d,g=new ze().P("sidx",function(_){d=dA(i,s,o,l,h,r,_)});if(e&&g.parse(e),d)return d;throw new F(2,3,3004)}function dA(e,i,r,s,o,l,h){var d=[];h.reader.skip(4);var g=h.reader.K();if(g==0)throw new F(2,3,3005);if(h.version==0)var _=h.reader.K(),y=h.reader.K();else _=h.reader.$a(),y=h.reader.$a();h.reader.skip(2);var S=h.reader.$d();for(e=e+h.size+y,y=0;y<S;y++){var w=h.reader.K(),E=(w&2147483648)>>>31;w&=2147483647;var R=h.reader.K();if(h.reader.skip(4),E==1)throw new F(2,3,3006);d.push(new be(_/g+r,(_+R)/g+r,function(){return l},e,e+w-1,i,r,s,o)),_+=R,e+=w}return h.parser.stop(),d}function Tr(e){this.h=Ot(e),this.g=new Oe(this.h,0)}Tr.prototype.ha=function(){return this.g.ha()};function ir(e){var i=f_(e);if(7<i.length)throw new F(2,3,3002);var r=0;i=v(i);for(var s=i.next();!s.done;s=i.next())r=256*r+s.value;i=f_(e);e:{s=v(fA);for(var o=s.next();!o.done;o=s.next())if(Fr(i,new Uint8Array(o.value))){s=!0;break e}s=!1}if(s)i=e.h.byteLength-e.g.Z();else{if(i.length==8&&i[1]&224)throw new F(2,3,3001);for(o=s=0;o<i.length;o++){var l=i[o];s=o==0?l&(1<<8-i.length)-1:256*s+l}i=s}return i=e.g.Z()+i<=e.h.byteLength?i:e.h.byteLength-e.g.Z(),s=Ot(e.h,e.g.Z(),i),e.g.skip(i),new pA(r,s)}function f_(e){var i=e.g.Z(),r=e.g.Ra();if(r==0)throw new F(2,3,3002);return r=8-Math.floor(Math.log2(r)),e.g.skip(r-1),Ee(e.h,i,r)}var fA=[[255],[127,255],[63,255,255],[31,255,255,255],[15,255,255,255,255],[7,255,255,255,255,255],[3,255,255,255,255,255,255],[1,255,255,255,255,255,255,255]];function pA(e,i){this.id=e,this.g=i}function uc(e){if(8<e.g.byteLength)throw new F(2,3,3002);if(e.g.byteLength==8&&e.g.getUint8(0)&224)throw new F(2,3,3001);for(var i=0,r=0;r<e.g.byteLength;r++){var s=e.g.getUint8(r);i=256*i+s}return i}function gA(e,i,r,s,o,l,h,d,g){function _(){return o}var y=[];e=new Tr(e.g);for(var S=null,w=null;e.ha();){var E=ir(e);if(E.id==187){var R=mA(E);R&&(E=r*R.Eg,R=i+R.ng,S!=null&&y.push(new be(S+h,E+h,_,w,R-1,l,h,d,g)),S=E,w=R)}}return S!=null&&y.push(new be(S+h,s+h,_,w,null,l,h,d,g)),y}function mA(e){var i=new Tr(e.g);if(e=ir(i),e.id!=179)throw new F(2,3,3013);if(e=uc(e),i=ir(i),i.id!=183)throw new F(2,3,3012);i=new Tr(i.g);for(var r=0;i.ha();){var s=ir(i);if(s.id==241){r=uc(s);break}}return{Eg:e,ng:r}}function p_(e,i){if(i=Za(e,i,"Initialization"),!i)return null;var r=e.I.wa,s=i.getAttribute("sourceURL");s&&(r=Ft(e.I.wa,[s])),s=0;var o=null;return(i=We(i,"range",ha))&&(s=i.start,o=i.end),new ri(function(){return r},s,o,y_(e))}function _A(e,i){var r=Number(Oi(e,Yn,"presentationTimeOffset"))||0,s=Oi(e,Yn,"timescale"),o=1;s&&(o=ca(s)||1);var l=r/o||0,h=p_(e,Yn);yA(e,h);var d=bp(e);return{Bb:function(){var g=Za(d,Yn,"RepresentationIndex"),_=d.I.wa;return g&&(g=g.getAttribute("sourceURL"))&&(_=Ft(d.I.wa,[g])),g=m_(d),g_(d,i,h,_,g.start,g.end,l)}}}function g_(e,i,r,s,o,l,h){var d,g,_,y,S,w,E,R,P,L,M,U,k,N,B;return z(function(j){if(j.g==1)return d=e.presentationTimeline,g=!e.Ma||!e.T.Gd,_=e.T.start,y=e.T.duration,S=e.I.mimeType.split("/")[1],w=i,E=null,R=[w(s,o,l),S=="webm"?w(r.ya(),r.Ba,r.ka):null],w=null,C(j,Promise.all(R),2);if(P=j.h,L=P[0],M=P[1]||null,U=null,k=_-h,N=_,B=y?_+y:1/0,S=="mp4")var V=cA(L,o,s,r,k,N,B);else{if(V=new Tr(M),ir(V).id!=440786851)throw new F(2,3,3008);var $=ir(V);if($.id!=408125543)throw new F(2,3,3009);V=$.g.byteOffset,$=new Tr($.g);for(var Y=null;$.ha();){var ae=ir($);if(ae.id==357149030){Y=ae;break}}if(!Y)throw new F(2,3,3010);for(Y=new Tr(Y.g),ae=1e6,$=null;Y.ha();){var ue=ir(Y);if(ue.id==2807729)ae=uc(ue);else if(ue.id==17545)if(ue.g.byteLength==4)$=ue.g.getFloat32(0);else if(ue.g.byteLength==8)$=ue.g.getFloat64(0);else throw new F(2,3,3003)}if($==null)throw new F(2,3,3011);if(Y=ae/1e9,$*=Y,ae=ir(new Tr(L)),ae.id!=475249515)throw new F(2,3,3007);V=gA(ae,V,Y,$,s,r,k,N,B)}return U=V,d.Ib(U),E=new Pe(U),g&&E.Wa(N,B,!0),j.return(E)})}function Yn(e){return e.wc}function m_(e){var i=Za(e,Yn,"RepresentationIndex");return e=Oi(e,Yn,"indexRange"),e=ha(e||""),i&&(e=We(i,"range",ha,e)),e}function yA(e,i){if(__(e,i),!m_(e))throw new F(2,4,4002)}function __(e,i){var r=e.I.mimeType.split("/")[1];if(e.I.contentType!=De&&r!="mp4"&&r!="webm")throw new F(2,4,4006);if(r=="webm"&&!i)throw new F(2,4,4005)}function y_(e){var i=e.I;return{bandwidth:e.bandwidth,audioSamplingRate:i.audioSamplingRate,codecs:i.codecs,contentType:i.contentType,frameRate:i.frameRate||null,height:i.height||null,mimeType:i.mimeType,channelsCount:i.ad,pixelAspectRatio:i.pixelAspectRatio||null,width:i.width||null}}function xA(e,i){var r=p_(e,x_),s=vA(e);if(!s.ia&&!s.timeline&&1<s.Gb.length)throw new F(2,4,4002);if(!s.ia&&!e.T.duration&&!s.timeline&&s.Gb.length==1)throw new F(2,4,4002);if(s.timeline&&s.timeline.length==0)throw new F(2,4,4002);var o=null,l=null;e.$.id&&e.I.id&&(l=i[e.$.id+","+e.I.id])&&(o=l.segmentIndex);var h=TA(e.T.start,e.T.duration,e.I.wa,s,r);return i=!o,o?o.Hb(h,e.presentationTimeline.Pa()):o=new Pe(h),e.presentationTimeline.Ib(h),e.Ma&&e.T.Gd||o.Wa(e.T.start,e.T.duration?e.T.start+e.T.duration:1/0,i),l&&(l.segmentIndex=o),{Bb:function(){return o&&o.g.length!=0||o.pc(h),Promise.resolve(o)}}}function x_(e){return e.ab}function vA(e){var i=SA(e);e=d_(e,x_);var r=e.Lb;r==0&&(r=1);var s=0;return e.ia?s=e.ia*(r-1):e.timeline&&0<e.timeline.length&&(s=e.timeline[0].start),{ia:e.ia,startTime:s,Lb:r,Sa:e.Sa,timeline:e.timeline,Gb:i}}function TA(e,i,r,s,o){var l=s.Gb.length;s.timeline&&s.timeline.length!=s.Gb.length&&(l=Math.min(s.timeline.length,s.Gb.length));for(var h=e-s.Sa,d=i?e+i:1/0,g=[],_=s.startTime,y={},S=0;S<l;y={od:y.od},S++){var w=s.Gb[S];y.od=Ft(r,[w.dg]);var E=void 0;E=s.ia!=null?_+s.ia:s.timeline?s.timeline[S].end:_+i,g.push(new be(e+_,e+E,function(R){return function(){return R.od}}(y),w.start,w.end,o,h,e,d)),_=E}return g}function SA(e){return[e.I.ab,e.fa.ab,e.$.ab].filter(pr).map(function(i){return Qe(i,"SegmentURL")}).reduce(function(i,r){return 0<i.length?i:r}).map(function(i){i.getAttribute("indexRange")&&!e.Ke&&(e.Ke=!0);var r=i.getAttribute("media");return i=We(i,"mediaRange",ha,{start:0,end:null}),{dg:r,start:i.start,end:i.end}})}function wA(e,i,r,s,o,l){var h=IA(e),d=AA(e);EA(d);var g=bp(e);if(d.oc)return __(e,h),{Bb:function(){var E=Ka(d.oc,g.I.id,null,g.bandwidth||null,null);return E=Ft(g.I.wa,[E]),g_(g,i,h,E,0,null,d.Sa)}};if(d.ia)return s||e.fa.contentType==="image"||(e.presentationTimeline.Sd(d.ia),e.presentationTimeline.Td(e.T.start)),{Bb:function(){return CA(g,d,o,h,l)}};var _=null;s=s=null,e.$.id&&e.I.id&&(s=e.$.id+","+e.I.id,s=r[s])&&(_=s.segmentIndex);var y=bA(g,d,h);r=e.T.start;var S=e.T.duration?e.T.start+e.T.duration:1/0,w=!(e.Ma&&e.T.Gd);return _?(w&&new Pe(y).Wa(r,S,!0),_.Hb(y,e.presentationTimeline.Pa())):_=new Pe(y),e.presentationTimeline.Ib(y),w&&_.Wa(r,S),s&&e.Ma&&(s.segmentIndex=_),{Bb:function(){return _&&_.g.length!=0||_.pc(y),Promise.resolve(_)}}}function Ja(e){return e.xc}function AA(e){var i=d_(e,Ja),r=Oi(e,Ja,"media");return e=Oi(e,Ja,"index"),{ia:i.ia,timescale:i.timescale,Lb:i.Lb,Sa:i.Sa,se:i.se,timeline:i.timeline,Pd:r,oc:e}}function EA(e){var i=e.oc?1:0;if(i+=e.timeline?1:0,i+=e.ia?1:0,i==0)throw new F(2,4,4002);if(i!=1&&(e.oc&&(e.timeline=null),e.ia=null),!e.oc&&!e.Pd)throw new F(2,4,4002)}function CA(e,i,r,s,o){function l(Y){var ae=(Y-E)*w,ue=ae+i.Sa,he=ae+_;ae=he+w;var Se=Math.min(ae,d());return he=new be(he,Se,function(){var ne=Ka(P,M,Y,L,ue*R);return Ft(U,[ne])},0,null,s,k,_,d()),he.j=ae,he}function h(){var Y=[Math.max(g.Pa(),_),Math.min(g.gb(),d())].map(function(ae){return ae-_});return[Math.ceil(Y[0]/w),Math.ceil(Y[1]/w)-1].map(function(ae){return ae+E})}function d(){var Y=y!=null&&o[y]||S;return Y?_+Y:1/0}var g=e.presentationTimeline,_=e.T.start,y=e.$.id,S=e.T.duration,w=i.ia,E=i.Lb,R=i.timescale,P=i.Pd,L=e.bandwidth||null,M=e.I.id,U=e.I.wa,k=_-i.Sa,N=h();e=e.Ma?Math.max(N[0],N[1]-r+1):N[0],N=N[1],r=[];for(var B=e;B<=N;++B){var j=l(B);r.push(j)}var V=new Pe(r);if(r=g.gb()<d(),B=g.U(),r||B){var $=Math.max(e,N+1);V.fd(w,function(){var Y=g.Pa();V.eb(Y);var ae=v(h());ae.next(),ae=ae.next().value;for(var ue=[];$<=ae;){var he=l($);ue.push(he),$++}return Y>d()&&!ue.length?null:ue})}return Promise.resolve(V)}function bA(e,i,r){var s=e.T.start,o=e.T.duration,l=s-i.Sa;o=o?s+o:1/0;for(var h=[],d={},g=0;g<i.timeline.length;d={nd:d.nd,rd:d.rd,ud:d.ud,kd:d.kd,wd:d.wd,ld:d.ld},g++){var _=i.timeline[g],y=_.start,S=_.Dg;_=_.end,d.ud=g+i.Lb,d.wd=S+i.se,d.rd=e.I.id,d.kd=e.bandwidth||null,d.nd=i.Pd,d.ld=e.I.wa,h.push(new be(s+y,s+_,function(w){return function(){var E=Ka(w.nd,w.rd,w.ud,w.kd||null,w.wd);return Ft(w.ld,[E]).map(function(R){return R.toString()})}}(d),0,null,r,l,s,o))}return h}function IA(e){var i=Oi(e,Ja,"initialization");if(!i)return null;var r=e.I.id,s=e.bandwidth||null,o=e.I.wa;return new ri(function(){var l=Ka(i,r,null,s,null);return Ft(o,[l])},0,null,y_(e))}function v_(){this.l=[],this.g=[],this.h=[],this.j=[],this.i=[],this.m=new Set}v_.prototype.release=function(){for(var e=v(this.g.concat(this.h,this.j,this.i)),i=e.next();!i.done;i=e.next())i=i.value,i.segmentIndex&&i.segmentIndex.release();this.g=[],this.h=[],this.j=[],this.i=[],this.l=[]};function RA(e,i,r){var s,o,l,h,d,g,_,y,S,w,E,R,P,L,M,U,k,N,B,j,V,$,Y,ae,ue,he,Se,ne,Ze,Ge;return z(function(nt){switch(nt.g){case 1:if(s=wt,LA(i),PA(i),MA(i),kA(i),!r&&i.length==1){o=i[0],e.g=o.Kc,e.h=o.gd,e.j=o.textStreams,e.i=o.imageStreams,nt.A(2);break}for(l=-1,h=0;h<i.length;h++)d=i[h],e.m.has(d.id)||(e.m.add(d.id),l==-1&&(l=h));if(l==-1)return nt.return();for(g=i.map(function(Gt){return Gt.Kc}),_=i.map(function(Gt){return Gt.gd}),y=i.map(function(Gt){return Gt.textStreams}),S=i.map(function(Gt){return Gt.imageStreams}),w=v(y),E=w.next();!E.done;E=w.next())R=E.value,R.push(b_(s.X));for(P=v(S),L=P.next();!L.done;L=P.next())M=L.value,M.push(b_(s.Wb));return C(nt,Sr(e.g,g,l,to,Kn),3);case 3:return C(nt,Sr(e.h,_,l,to,Kn),4);case 4:return C(nt,Sr(e.j,y,l,to,Kn),5);case 5:return C(nt,Sr(e.i,S,l,to,Kn),2);case 2:if(U=0,k=[],e.h.length&&e.g.length)for(Y=v(e.g),ae=Y.next();!ae.done;ae=Y.next())for(ue=ae.value,he=v(e.h),Se=he.next();!Se.done;Se=he.next())ne=Se.value,Ze=fa(ue.drmInfos,ne.drmInfos),ue.drmInfos.length&&ne.drmInfos.length&&!Ze.length||(Ge=U++,k.push({id:Ge,language:ue.language,primary:ue.primary,audio:ue,video:ne,bandwidth:(ue.bandwidth||0)+(ne.bandwidth||0),drmInfos:Ze,allowedByApplication:!0,allowedByKeySystem:!0,decodingInfos:[]}));else for(N=e.h.concat(e.g),B=v(N),j=B.next();!j.done;j=B.next())V=j.value,$=U++,k.push({id:$,language:V.language,primary:V.primary,audio:V.type==s.Hc?V:null,video:V.type==s.va?V:null,bandwidth:V.bandwidth||0,drmInfos:V.drmInfos,allowedByApplication:!0,allowedByKeySystem:!0,decodingInfos:[]});e.l=k,K(nt)}})}function LA(e){e=v(e);for(var i=e.next();!i.done;i=e.next()){i=i.value;for(var r=[],s=v(i.Kc),o=s.next();!o.done;o=s.next()){o=o.value;for(var l=!1,h=v(r),d=h.next();!d.done;d=h.next())d=d.value,o.id!=d.id&&o.channelsCount==d.channelsCount&&o.language==d.language&&o.bandwidth==d.bandwidth&&o.label==d.label&&o.codecs==d.codecs&&o.mimeType==d.mimeType&&fs(o.roles,d.roles)&&o.audioSamplingRate==d.audioSamplingRate&&o.primary==d.primary&&(l=!0);l||r.push(o)}i.Kc=r}}function MA(e){e=v(e);for(var i=e.next();!i.done;i=e.next()){i=i.value;for(var r=[],s=v(i.textStreams),o=s.next();!o.done;o=s.next()){o=o.value;for(var l=!1,h=v(r),d=h.next();!d.done;d=h.next())d=d.value,o.id!=d.id&&o.language==d.language&&o.label==d.label&&o.codecs==d.codecs&&o.mimeType==d.mimeType&&o.bandwidth==d.bandwidth&&fs(o.roles,d.roles)&&(l=!0);l||r.push(o)}i.textStreams=r}}function PA(e){e=v(e);for(var i=e.next();!i.done;i=e.next()){i=i.value;for(var r=[],s=v(i.gd),o=s.next();!o.done;o=s.next()){o=o.value;for(var l=!1,h=v(r),d=h.next();!d.done;d=h.next())d=d.value,o.id!=d.id&&o.width==d.width&&o.frameRate==d.frameRate&&o.codecs==d.codecs&&o.mimeType==d.mimeType&&o.label==d.label&&fs(o.roles,d.roles)&&nS(o.closedCaptions,d.closedCaptions)&&o.bandwidth==d.bandwidth&&(l=!0);l||r.push(o)}i.gd=r}}function kA(e){e=v(e);for(var i=e.next();!i.done;i=e.next()){i=i.value;for(var r=[],s=v(i.imageStreams),o=s.next();!o.done;o=s.next()){o=o.value;for(var l=!1,h=v(r),d=h.next();!d.done;d=h.next())d=d.value,o.id!=d.id&&o.width==d.width&&o.codecs==d.codecs&&o.mimeType==d.mimeType&&(l=!0);l||r.push(o)}i.imageStreams=r}}function T_(e){var i,r,s,o,l,h,d,g,_,y,S,w,E,R,P,L,M,U,k,N,B,j,V,$,Y,ae,ue;return z(function(he){switch(he.g){case 1:if(i=wt,e.length==1)return he.return(e[0]);for(r=e.map(function(Se){return Se.filter(function(ne){return ne.type==i.Hc})}),s=e.map(function(Se){return Se.filter(function(ne){return ne.type==i.va})}),o=e.map(function(Se){return Se.filter(function(ne){return ne.type==i.X})}),l=e.map(function(Se){return Se.filter(function(ne){return ne.type==i.Wb})}),h=v(o),d=h.next();!d.done;d=h.next())g=d.value,g.push(C_(i.X));for(_=v(l),y=_.next();!y.done;y=_.next())S=y.value,S.push(C_(i.Wb));return C(he,Sr([],r,0,el,tl),2);case 2:return w=he.h,C(he,Sr([],s,0,el,tl),3);case 3:return E=he.h,C(he,Sr([],o,0,el,tl),4);case 4:return R=he.h,C(he,Sr([],l,0,el,tl),5);case 5:if(P=he.h,L=0,E.length&&w.length)for(B=v(w),j=B.next();!j.done;j=B.next())for(V=j.value,$=v(E),Y=$.next();!Y.done;Y=$.next())ae=Y.value,ue=L++,ae.variantIds.push(ue),V.variantIds.push(ue);else for(M=E.concat(w),U=v(M),k=U.next();!k.done;k=U.next())N=k.value,N.variantIds=[L++];return he.return(E.concat(w).concat(R).concat(P))}})}function Sr(e,i,r,s,o){var l,h,d,g,_,y,S,w,E,R,P,L,M,U,k,N,B,j,V,$;return z(function(Y){switch(Y.g){case 1:for(l=wt,h=[],d=0;d<i.length;d++)d>=r?h.push(new Set(i[d])):h.push(new Set);g=v(e),_=g.next();case 2:if(_.done){Y.A(4);break}return y=_.value,C(Y,DA(y,i,r,o,h),5);case 5:if(S=Y.h,!S)throw new F(2,4,4037);_=g.next(),Y.A(2);break;case 4:for(w=v(h),E=w.next();!E.done;E=w.next())for(R=E.value,P=v(R),L=P.next();!L.done;L=P.next())M=L.value,(U=OA(M,i,s,o,h))&&e.push(U);for(k=v(h),E=k.next();!E.done;E=k.next())for(N=E.value,B={},j=v(N),L=j.next();!L.done;B={Va:B.Va},L=j.next())if(B.Va=L.value,V=B.Va.type==l.X&&!B.Va.language,$=B.Va.type==l.Wb&&!B.Va.tilesLayout,!V&&!$&&e.some(function(ae){return function(ue){return ue.mimeType==ae.Va.mimeType&&yr(ue.codecs)==yr(ae.Va.codecs)}}(B)))throw new F(2,4,4037);return Y.return(e)}})}function DA(e,i,r,s,o){return z(function(l){return l.g==1?(A_(i,e),e.matchedStreams?e.segmentIndex?C(l,S_(e,r),2):l.A(2):l.return(!1)):(w_(e,r,s,o),l.return(!0))})}function S_(e,i){var r,s,o,l,h,d,g;return z(function(_){if(_.g==1){for(r=[],s=e.matchedStreams,o=v(s),l=o.next();!l.done;l=o.next())h=l.value,r.push(h.createSegmentIndex()),h.trickModeVideo&&!h.trickModeVideo.segmentIndex&&r.push(h.trickModeVideo.createSegmentIndex());return C(_,Promise.all(r),2)}if(e.segmentIndex instanceof it)for(d=0;d<s.length;d++)g=s[d],g.segmentIndex&&d>=i&&e.segmentIndex.l.push(g.segmentIndex);K(_)})}function OA(e,i,r,s,o){var l=r(e);return A_(i,l),l.createSegmentIndex&&(l.createSegmentIndex=function(){return z(function(h){return l.segmentIndex?h.A(0):(l.segmentIndex=new it,C(h,S_(l,0),0))})}),l.matchedStreams?(w_(l,0,s,o),l):null}function w_(e,i,r,s){for(var o=e.matchedStreams,l=0;l<o.length;l++)if(l>=i){var h=o[l];r(e,h);var d=!0;e.type=="audio"&&jr(e.language,h.language)==0&&(d=!1),d&&s[l].delete(h)}}function to(e){var i=Object.assign({},e);return i.originalId=null,i.createSegmentIndex=function(){return Promise.resolve()},i.closeSegmentIndex=function(){if(i.segmentIndex&&(i.segmentIndex.release(),i.segmentIndex=null),i.matchedStreams)for(var r=v(i.matchedStreams),s=r.next();!s.done;s=r.next())s=s.value,s.segmentIndex&&(s.segmentIndex.release(),s.segmentIndex=null)},i.segmentIndex=null,i.emsgSchemeIdUris=[],i.keyIds=new Set,i.closedCaptions=null,i.trickModeVideo=null,i}function el(e){return e=Object.assign({},e),e.keyIds=new Set,e.segments=[],e.variantIds=[],e.closedCaptions=null,e}function Kn(e,i){e.roles=Array.from(new Set(e.roles.concat(i.roles))),i.emsgSchemeIdUris&&(e.emsgSchemeIdUris=Array.from(new Set(e.emsgSchemeIdUris.concat(i.emsgSchemeIdUris)))),e.keyIds=function(l,h){return new Set([].concat(O(l),O(h)))}(e.keyIds,i.keyIds),e.originalId==null?e.originalId=i.originalId:e.originalId+=","+(i.originalId||"");var r=fa(e.drmInfos,i.drmInfos);if(i.drmInfos.length&&e.drmInfos.length&&!r.length)throw new F(2,4,4038);if(e.drmInfos=r,e.encrypted=e.encrypted||i.encrypted,i.closedCaptions){e.closedCaptions||(e.closedCaptions=new Map),r=v(i.closedCaptions);for(var s=r.next();!s.done;s=r.next()){var o=v(s.value);s=o.next().value,o=o.next().value,e.closedCaptions.set(s,o)}}i.trickModeVideo?(e.trickModeVideo||(e.trickModeVideo=to(i.trickModeVideo),e.trickModeVideo.createSegmentIndex=function(){return e.trickModeVideo.segmentIndex=e.segmentIndex.clone(),Promise.resolve()}),Kn(e.trickModeVideo,i.trickModeVideo)):e.trickModeVideo&&Kn(e.trickModeVideo,i)}function tl(e,i){e.roles=Array.from(new Set(e.roles.concat(i.roles)));var r=i.keyIds;if(r=new Set([].concat(O(e.keyIds),O(r))),e.keyIds=r,e.encrypted=e.encrypted&&i.encrypted,e.segments.push.apply(e.segments,O(i.segments)),i.closedCaptions)for(e.closedCaptions||(e.closedCaptions=new Map),i=v(i.closedCaptions),r=i.next();!r.done;r=i.next()){var s=v(r.value);r=s.next().value,s=s.next().value,e.closedCaptions.set(r,s)}}function A_(e,i){var r=[];e=v(e);for(var s=e.next();!s.done;s=e.next()){var o=i,l={audio:E_,video:E_,text:FA,image:NA}[o.type],h={audio:UA,video:zA,text:BA,image:jA}[o.type],d=null;s=v(s.value);for(var g=s.next();!g.done;g=s.next())g=g.value,!l(o,g)||d&&!h(o,d,g)||(d=g);if(o=d,!o)return;r.push(o)}i.matchedStreams=r}function E_(e,i){var r;return!(r=i.mimeType!=e.mimeType||yr(i.codecs)!=yr(e.codecs))&&(r=e.drmInfos)&&(e=e.drmInfos,i=i.drmInfos,r=!(!(e.length&&i.length)||0<fa(e,i).length)),!r}function FA(e,i){return e.language?i.language?!(jr(e.language,i.language)==0||i.kind!=e.kind):!0:!1}function NA(e){return!!e.tilesLayout}function UA(e,i,r){if(e.id==r.id)return!0;var s=jr(e.language,i.language),o=jr(e.language,r.language);return o>s?!0:o<s?!1:e.roles.length?(s=i.roles.filter(function(l){return e.roles.includes(l)}),o=r.roles.filter(function(l){return e.roles.includes(l)}),o.length>s.length?!0:o.length<s.length?!1:r.roles.length<i.roles.length):!r.roles.length&&i.roles.length?!0:r.roles.length&&!i.roles.length?!1:!i.primary&&r.primary?!0:i.primary&&!r.primary?!1:(s=io(e.channelsCount,i.channelsCount,r.channelsCount),s==wi?!0:s==rr?!1:(s=io(e.audioSamplingRate,i.audioSamplingRate,r.audioSamplingRate),s==wi?!0:s==rr?!1:!!(e.bandwidth&&I_(e.bandwidth,i.bandwidth,r.bandwidth)==wi)))}function zA(e,i,r){if(e.id==r.id)return!0;var s=io(e.width*e.height,i.width*i.height,r.width*r.height);if(s==wi)return!0;if(s==rr)return!1;if(e.frameRate){if(s=io(e.frameRate,i.frameRate,r.frameRate),s==wi)return!0;if(s==rr)return!1}return!!(e.bandwidth&&I_(e.bandwidth,i.bandwidth,r.bandwidth)==wi)}function BA(e,i,r){if(e.id==r.id)return!0;var s=jr(e.language,i.language),o=jr(e.language,r.language);if(o>s)return!0;if(o<s)return!1;if(!i.primary&&r.primary)return!0;if(i.primary&&!r.primary)return!1;if(e.roles.length){if(s=i.roles.filter(function(l){return e.roles.includes(l)}),o=r.roles.filter(function(l){return e.roles.includes(l)}),o.length>s.length)return!0;if(o.length<s.length)return!1}else{if(!r.roles.length&&i.roles.length)return!0;if(r.roles.length&&!i.roles.length)return!1}return!(r.mimeType!=e.mimeType||r.codecs!=e.codecs||i.mimeType==e.mimeType&&i.codecs==e.codecs)}function jA(e,i,r){return e.id==r.id?!0:io(e.width*e.height,i.width*i.height,r.width*r.height)==wi}function C_(e){return{id:0,originalId:"",primary:!1,type:e,mimeType:"",codecs:"",language:"",label:null,width:null,height:null,encrypted:!1,keyIds:new Set,segments:[],variantIds:[],roles:[],forced:!1,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,closedCaptions:null}}function b_(e){return{id:0,originalId:"",createSegmentIndex:function(){return Promise.resolve()},segmentIndex:new Pe([]),mimeType:"",codecs:"",encrypted:!1,drmInfos:[],keyIds:new Set,language:"",label:null,type:e,primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],forced:!1,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,closedCaptions:null}}function io(e,i,r){if(i==e&&e!=r)return rr;if(r==e&&e!=i)return wi;if(i>e){if(r<=e||r-e<i-e)return wi;if(r-e>i-e)return rr}else{if(r>e)return rr;if(e-r<e-i)return wi;if(e-r>e-i)return rr}return R_}function I_(e,i,r){return i=Math.abs(e-i),e=Math.abs(e-r),e<i?wi:i<e?rr:R_}var wi=1,R_=0,rr=-1;function ro(){var e=this;this.h=this.g=null,this.m=[],this.i=null,this.G=1,this.l={},this.L={},this.j=new v_,this.F=0,this.H=new Bo(5),this.D=new we(function(){qA(e)}),this.o=new ra,this.s=null,this.J=[],this.u=1/0,this.B=!1}p=ro.prototype,p.configure=function(e){this.g=e},p.start=function(e,i){var r=this,s;return z(function(o){if(o.g==1)return r.B=i.isLowLatencyMode(),r.m=[e],r.h=i,C(o,hc(r),2);if(s=o.h,r.h&&M_(r,s),!r.h)throw new F(2,7,7001);return o.return(r.i)})},p.stop=function(){for(var e=v(Object.values(this.l)),i=e.next();!i.done;i=e.next())i=i.value,i.segmentIndex&&i.segmentIndex.release();return this.j&&this.j.release(),this.g=this.h=null,this.m=[],this.i=null,this.l={},this.j=null,this.D!=null&&(this.D.stop(),this.D=null),this.o.destroy()},p.update=function(){var e=this,i;return z(function(r){if(r.g==1)return de(r,2),C(r,hc(e),4);if(r.g!=2)return Ae(r,0);if(i=oe(r),!e.h||!i)return r.return();e.h.onError(i),K(r)})},p.onExpirationUpdated=function(){};function hc(e){var i,r,s,o,l,h,d;return z(function(g){return g.g==1?(i=ti(e.m,e.g.retryParameters),r=e.h.networkingEngine,e.h.modifyManifestRequest(i,{format:"d"}),s=Date.now(),o=r.request(0,i),On(e.o,o),C(g,o.promise,2)):g.g!=3?(l=g.h,e.h?(l.uri&&!e.m.includes(l.uri)&&e.m.unshift(l.uri),C(g,HA(e,l.data,l.uri),3)):g.return(0)):(h=Date.now(),d=(h-s)/1e3,e.H.sample(1,d),g.return(d))})}function HA(e,i,r){var s,o,l,h;return z(function(d){if(d.g==1){if(s=Hp(i,"MPD"),!s)throw new F(2,4,4001,r);return e.g.dash.disableXlinkProcessing?d.return(L_(e,s,r)):(o=e.g.dash.xlinkFailGracefully,l=Qa(s,e.g.retryParameters,o,r,e.h.networkingEngine),On(e.o,l),C(d,l.promise,2))}return h=d.h,d.return(L_(e,h,r))})}function L_(e,i,r){var s,o,l,h,d,g,_,y,S,w,E,R,P,L,M,U,k,N,B,j,V,$,Y,ae,ue,he,Se,ne,Ze,Ge;return z(function(nt){switch(nt.g){case 1:if((s=e.g.dash.manifestPreprocessor)&&s(i),o=[r],l=Qe(i,"Location").map(ua).filter(pr),0<l.length&&(h=Ft(o,l),o=e.m=h),d=Qe(i,"BaseURL"),g=d.map(ua),_=Ft(o,g),y=0,d&&d.length&&(y=We(d[0],"availabilityTimeOffset",Ps)||0),S=e.g.dash.ignoreMinBufferTime,w=0,S||(w=We(i,"minBufferTime",Qi)||0),e.F=We(i,"minimumUpdatePeriod",Qi,-1),E=We(i,"availabilityStartTime",jp),R=We(i,"timeShiftBufferDepth",Qi),P=e.g.dash.ignoreSuggestedPresentationDelay,L=null,P||(L=We(i,"suggestedPresentationDelay",Qi)),M=e.g.dash.ignoreMaxSegmentDuration,U=null,M||(U=We(i,"maxSegmentDuration",Qi)),k=i.getAttribute("type")||"static",e.i)for(N=e.i.presentationTimeline,B=v(Object.values(e.l)),j=B.next();!j.done;j=B.next())V=j.value,V.segmentIndex&&V.segmentIndex.eb(N.Pa());else $=e.g.defaultPresentationDelay||1.5*w,Y=L!=null?L:$,N=new le(E,Y,e.g.dash.autoCorrectDrift);return N.yc(k=="static"),N.U()&&!isNaN(e.g.availabilityWindowOverride)&&(R=e.g.availabilityWindowOverride),R==null&&(R=1/0),N.me(R),ae=i.getAttribute("profiles")||"",ue={Ma:k!="static",presentationTimeline:N,$:null,T:null,fa:null,I:null,bandwidth:0,Ke:!1,zb:y,profiles:ae.split(",")},he=VA(e,ue,_,i),Se=he.duration,ne=he.periods,k!="static"&&he.De||N.Aa(Se||1/0),e.u&&!e.B&&e.h.isAutoLowLatencyMode()&&(e.h.enableLowLatencyMode(),e.B=e.h.isLowLatencyMode()),e.B?N.Ue(e.u):e.u&&qe("Low-latency DASH live stream detected, but low-latency streaming mode is not enabled in Shaka Player. Set streaming.lowLatencyMode configuration to true, and see https://bit.ly/3clctcj for details."),N.Sd(U||1),C(nt,RA(e.j,ne,ue.Ma),2);case 2:if(e.i){e.i.variants=e.j.l,e.i.textStreams=e.j.j.slice(),e.i.imageStreams=e.j.i,e.h.filter(e.i),nt.A(3);break}if(e.i={presentationTimeline:N,variants:e.j.l,textStreams:e.j.j.slice(),imageStreams:e.j.i,offlineSessionIds:[],minBufferTime:w||0,sequenceMode:e.g.dash.sequenceMode},!N.df()){nt.A(4);break}return Ze=Qe(i,"UTCTiming"),C(nt,KA(e,_,Ze),5);case 5:if(Ge=nt.h,!e.h)return nt.return();N.Ve(Ge);case 4:N.Md();case 3:e.h.makeTextStreamsForClosedCaptions(e.i),K(nt)}})}function VA(e,i,r,s){var o=We(s,"mediaPresentationDuration",Qi),l=[],h=0;s=Qe(s,"Period");for(var d=0;d<s.length;d++){var g=s[d],_=s[d+1],y=We(g,"start",Qi,h),S=g.id,w=We(g,"duration",Qi),E=null;if(_){var R=We(_,"start",Qi);R!=null&&(E=R-y)}else o!=null&&(E=o-y);if(E==null&&(E=w),!(e.s!==null&&S!==null&&y!==null&&y<e.s)||e.J.includes(S)||d+1==s.length){if(y!==null&&(e.s===null||y>e.s)&&(e.s=y),h=WA(e,i,r,{start:y,duration:E,node:g,Gd:E==null||!_}),l.push(h),i.$.id&&E&&(e.L[i.$.id]=E),E==null){h=null;break}h=y+E}}return e.J=l.map(function(P){return P.id}),o!=null?{periods:l,duration:o,De:!1}:{periods:l,duration:h,De:!0}}function WA(e,i,r,s){i.$=cc(s.node,null,r),i.T=s,i.$.zb=i.zb,i.$.id||(i.$.id="__shaka_period_"+s.start);var o=Qe(s.node,"EventStream");r=i.presentationTimeline.Pa(),o=v(o);for(var l=o.next();!l.done;l=o.next())ZA(e,s.start,s.duration,l.value,r);if(r=Qe(s.node,"AdaptationSet").map(function(y){return GA(e,i,y)}).filter(pr),i.Ma){for(s=[],o=v(r),l=o.next();!l.done;l=o.next()){l=v(l.value.qg);for(var h=l.next();!h.done;h=l.next())s.push(h.value)}if(s.length!=new Set(s).size)throw new F(2,4,4018)}for(s=r.filter(function(y){return!y.qe}),r=r.filter(function(y){return y.qe}),r=v(r),o=r.next();!o.done;o=r.next()){o=o.value,l=o.qe.split(" "),h=v(s);for(var d=h.next();!d.done;d=h.next()){var g=d.value;if(l.includes(g.id)){d={},g=v(g.streams);for(var _=g.next();!_.done;d={Gc:d.Gc},_=g.next())d.Gc=_.value,d.Gc.trickModeVideo=o.streams.find(function(y){return function(S){return yr(y.Gc.codecs)==yr(S.codecs)}}(d))}}}if(o=e.g.disableAudio?[]:il(s,"audio"),h=e.g.disableVideo?[]:il(s,"video"),l=e.g.disableText?[]:il(s,De),r=e.g.disableThumbnails?[]:il(s,"image"),!h.length&&!o.length)throw new F(2,4,4004);for(s=[],o=v(o),d=o.next();!d.done;d=o.next())s.push.apply(s,O(d.value.streams));for(o=[],h=v(h),d=h.next();!d.done;d=h.next())o.push.apply(o,O(d.value.streams));for(h=[],l=v(l),d=l.next();!d.done;d=l.next())h.push.apply(h,O(d.value.streams));for(l=[],r=v(r),d=r.next();!d.done;d=r.next())l.push.apply(l,O(d.value.streams));return{id:i.$.id,Kc:s,gd:o,textStreams:h,imageStreams:l}}function il(e,i){return e.filter(function(r){return r.contentType==i})}function GA(e,i,r){function s(j){switch(j){case 1:case 6:case 13:case 14:case 15:return"SDR";case 16:return"PQ";case 18:return"HLG"}}i.fa=cc(r,i.$,null);var o=!1,l=Qe(r,"Role"),h=l.map(function(j){return j.getAttribute("value")}).filter(pr),d=void 0,g=i.fa.contentType==De;g&&(d="subtitle"),l=v(l);for(var _=l.next();!_.done;_=l.next()){_=_.value;var y=_.getAttribute("schemeIdUri");if(y==null||y=="urn:mpeg:dash:role:2011")switch(_=_.getAttribute("value"),_){case"main":o=!0;break;case"caption":case"subtitle":d=_}}var S;y=Qe(r,"EssentialProperty"),l=null,_=!1,y=v(y);for(var w=y.next();!w.done;w=y.next()){w=w.value;var E=w.getAttribute("schemeIdUri");E=="http://dashif.org/guidelines/trickmode"?l=w.getAttribute("value"):E=="urn:mpeg:mpegB:cicp:TransferCharacteristics"?S=s(parseInt(w.getAttribute("value"),10)):_=!0}for(y=Qe(r,"SupplementalProperty"),y=v(y),w=y.next();!w.done;w=y.next())w=w.value,w.getAttribute("schemeIdUri")=="urn:mpeg:mpegB:cicp:TransferCharacteristics"&&(S=s(parseInt(w.getAttribute("value"),10)));y=Qe(r,"Accessibility");var R=new Map;for(y=v(y),w=y.next();!w.done;w=y.next())if(E=w.value,w=E.getAttribute("schemeIdUri"),E=E.getAttribute("value"),w=="urn:scte:dash:cc:cea-608:2015")if(w=1,E!=null){E=E.split(";");for(var P=v(E),L=P.next();!L.done;L=P.next()){var M=L.value,U=L=void 0;M.includes("=")?(M=M.split("="),L=M[0].startsWith("CC")?M[0]:"CC"+M[0],U=M[1]||"und"):(L="CC"+w,E.length==2?w+=2:w++,U=M),R.set(L,Me(U))}}else R.set("CC1","und");else if(w=="urn:scte:dash:cc:cea-708:2015")if(w=1,E!=null)for(E=v(E.split(";")),L=E.next();!L.done;L=E.next())L=L.value,M=P=void 0,L.includes("=")?(L=L.split("="),P="svc"+L[0],M=L[1].split(",")[0].split(":").pop()):(P="svc"+w,w++,M=L),R.set(P,Me(M));else R.set("svc1","und");else w=="urn:mpeg:dash:role:2011"&&E!=null&&(h.push(E),E=="captions"&&(d="caption"));if(_)return null;_=Qe(r,"ContentProtection");var k=c_(_,e.g.dash.ignoreDrmInfo,e.g.dash.keySystemsByURI),N=Me(r.getAttribute("lang")||"und"),B=r.getAttribute("label");if((_=Qe(r,"Label"))&&_.length&&(_=_[0],_.textContent&&(B=_.textContent)),_=Qe(r,"Representation"),r=_.map(function(j){return(j=XA(e,i,k,d,N,B,o,h,R,j))&&(j.hdr=j.hdr||S),j}).filter(function(j){return!!j}),r.length==0){if(l=i.fa.contentType=="image",e.g.dash.ignoreEmptyAdaptationSet||g||l)return null;throw new F(2,4,4003)}if(!i.fa.contentType||i.fa.contentType=="application")for(i.fa.contentType=k_(r[0].mimeType,r[0].codecs),g=v(r),y=g.next();!y.done;y=g.next())y.value.type=i.fa.contentType;for(g=v(r),y=g.next();!y.done;y=g.next())for(y=y.value,w=v(k.drmInfos),E=w.next();!E.done;E=w.next())E=E.value,E.keyIds=E.keyIds&&y.keyIds?new Set([].concat(O(E.keyIds),O(y.keyIds))):E.keyIds||y.keyIds;return g=_.map(function(j){return j.getAttribute("id")}).filter(pr),{id:i.fa.id||"__fake__"+e.G++,contentType:i.fa.contentType,language:N,th:o,streams:r,drmInfos:k.drmInfos,qe:l,qg:g}}function XA(e,i,r,s,o,l,h,d,g,_){if(i.I=cc(_,i.fa,null),e.u=Math.min(e.u,i.I.zb),!YA(i.I))return null;var y=i.T.start;i.bandwidth=We(_,"bandwidth",ca)||0;var S=i.I.contentType,w=S==De||S=="application";S=S=="image";try{var E=function(V,$,Y){return QA(e,V,$,Y)};if(i.I.wc)var R=_A(i,E);else if(i.I.ab)R=xA(i,e.l);else if(i.I.xc)R=wA(i,E,e.l,!!e.i,e.g.dash.initialSegmentLimit,e.L);else{var P=i.I.wa,L=i.T.duration||0;R={Bb:function(){return Promise.resolve(xh(y,L,P))}}}}catch(V){if((w||S)&&V.code==4002)return null;throw V}E=Qe(_,"ContentProtection"),E=iA(E,r,e.g.dash.ignoreDrmInfo,e.g.dash.keySystemsByURI),E=new Set(E?[E]:[]);var M=!1;Qe(_,"SupplementalProperty").some(function(V){return V.getAttribute("schemeIdUri")=="tag:dolby.com,2018:dash:EC3_ExtensionType:2018"&&V.getAttribute("value")=="JOC"})&&(M=!0);var U=!1;w&&(U=d.includes("forced_subtitle")||d.includes("forced-subtitle"));var k;if(S&&((_=Qe(_,"EssentialProperty").find(function(V){return["http://dashif.org/thumbnail_tile","http://dashif.org/guidelines/thumbnail_tile"].includes(V.getAttribute("schemeIdUri"))}))&&(k=_.getAttribute("value")),!k))return null;var N;_=i.I.codecs,i.profiles.includes("http://dashif.org/guidelines/dash-if-uhd#hevc-hdr-pq10")&&(_.includes("hvc1.2.4.L153.B0")||_.includes("hev1.2.4.L153.B0"))&&(N="PQ");var B=i.I.id?i.$.id+","+i.I.id:"",j={id:e.G++,originalId:i.I.id,createSegmentIndex:function(){var V,$;return z(function(Y){if(Y.g==1)return V=B&&i.Ma&&e.l[B]?e.l[B]:j,V.segmentIndex?Y.A(0):($=V,C(Y,R.Bb(),3));$.segmentIndex=Y.h,K(Y)})},closeSegmentIndex:function(){j.segmentIndex&&(j.segmentIndex.release(),j.segmentIndex=null)},segmentIndex:null,mimeType:i.I.mimeType,codecs:i.I.codecs,frameRate:i.I.frameRate,pixelAspectRatio:i.I.pixelAspectRatio,bandwidth:i.bandwidth,width:i.I.width,height:i.I.height,kind:s,encrypted:0<r.drmInfos.length,drmInfos:r.drmInfos,keyIds:E,language:o,label:l,type:i.fa.contentType,primary:h,trickModeVideo:null,emsgSchemeIdUris:i.I.emsgSchemeIdUris,roles:d,forced:U,channelsCount:i.I.ad,audioSamplingRate:i.I.audioSamplingRate,spatialAudio:M,closedCaptions:g,hdr:N,tilesLayout:k,matchedStreams:[]};return B&&i.Ma&&!e.l[B]&&(e.l[B]=j),j}function qA(e){var i,r;z(function(s){switch(s.g){case 1:return i=0,de(s,2),C(s,hc(e),4);case 4:i=s.h,Ae(s,3);break;case 2:r=oe(s),e.h&&(r.severity=1,e.h.onError(r));case 3:if(!e.h)return s.return();M_(e,i),K(s)}})}function M_(e,i){0>e.F||e.D.N(Math.max(3,e.F-i,yu(e.H)))}function cc(e,i,r){i=i||{contentType:"",mimeType:"",codecs:"",emsgSchemeIdUris:[],frameRate:void 0,pixelAspectRatio:void 0,ad:null,audioSamplingRate:null,zb:0},r=r||i.wa;var s=Qe(e,"BaseURL"),o=s.map(ua),l=e.getAttribute("contentType")||i.contentType,h=e.getAttribute("mimeType")||i.mimeType,d=e.getAttribute("codecs")||i.codecs,g=We(e,"frameRate",lS)||i.frameRate,_=e.getAttribute("sar")||i.pixelAspectRatio,y=Qe(e,"InbandEventStream"),S=i.emsgSchemeIdUris.slice();y=v(y);for(var w=y.next();!w.done;w=y.next())w=w.value.getAttribute("schemeIdUri"),S.includes(w)||S.push(w);y=Qe(e,"AudioChannelConfiguration"),y=$A(y)||i.ad,w=We(e,"audioSamplingRate",Di)||i.audioSamplingRate,l||(l=k_(h,d));var E=aa(e,"SegmentBase"),R=aa(e,"SegmentTemplate"),P=E&&We(E,"availabilityTimeOffset",Ps)||0,L=R&&We(R,"availabilityTimeOffset",Ps)||0;return s=s&&s.length&&We(s[0],"availabilityTimeOffset",Ps)||0,s=i.zb+s+P+L,{wa:Ft(r,o),wc:E||i.wc,ab:aa(e,"SegmentList")||i.ab,xc:R||i.xc,width:We(e,"width",Di)||i.width,height:We(e,"height",Di)||i.height,contentType:l,mimeType:h,codecs:d,frameRate:g,pixelAspectRatio:_,emsgSchemeIdUris:S,id:e.getAttribute("id"),ad:y,audioSamplingRate:w,zb:s}}function $A(e){e=v(e);for(var i=e.next();!i.done;i=e.next()){var r=i.value;if((i=r.getAttribute("schemeIdUri"))&&(r=r.getAttribute("value")))switch(i){case"urn:mpeg:dash:outputChannelPositionList:2012":return r.trim().split(/ +/).length;case"urn:mpeg:dash:23003:3:audio_channel_configuration:2011":case"urn:dts:dash:audio_channel_configuration:2012":if(i=parseInt(r,10),!i)continue;return i;case"tag:dolby.com,2014:dash:audio_channel_configuration:2011":case"urn:dolby:dash:audio_channel_configuration:2011":if(i=parseInt(r,16),!i)continue;for(e=0;i;)i&1&&++e,i>>=1;return e;case"urn:mpeg:mpegB:cicp:ChannelConfiguration":if(i=[0,1,2,3,4,5,6,8,2,3,4,7,8,24,8,12,10,12,14,12,14],(r=parseInt(r,10))&&0<r&&r<i.length)return i[r]}}return null}function YA(e){var i=e.wc?1:0;return i+=e.ab?1:0,i+=e.xc?1:0,i==0?e.contentType==De||e.contentType=="application":(i!=1&&(e.wc&&(e.ab=null),e.xc=null),!0)}function P_(e,i,r,s){var o,l,h,d,g,_;return z(function(y){if(y.g==1)return o=Ft(i,[r]),l=ti(o,e.g.retryParameters),l.method=s,h=e.h.networkingEngine.request(4,l),On(e.o,h),C(y,h.promise,2);if(d=y.h,s=="HEAD"){if(!d.headers||!d.headers.date)return y.return(0);g=d.headers.date}else g=et(d.data);return _=Date.parse(g),isNaN(_)?y.return(0):y.return(_-Date.now())})}function KA(e,i,r){var s,o,l,h,d,g,_,y;return z(function(S){switch(S.g){case 1:s=r.map(function(w){return{scheme:w.getAttribute("schemeIdUri"),value:w.getAttribute("value")}}),o=e.g.dash.clockSyncUri,!s.length&&o&&s.push({scheme:"urn:mpeg:dash:utc:http-head:2014",value:o}),l=v(s),h=l.next();case 2:if(h.done){S.A(4);break}switch(d=h.value,de(S,5),g=d.scheme,_=d.value,g){case"urn:mpeg:dash:utc:http-head:2014":case"urn:mpeg:dash:utc:http-head:2012":return S.A(7);case"urn:mpeg:dash:utc:http-xsdate:2014":case"urn:mpeg:dash:utc:http-iso:2014":case"urn:mpeg:dash:utc:http-xsdate:2012":case"urn:mpeg:dash:utc:http-iso:2012":return S.A(8);case"urn:mpeg:dash:utc:direct:2014":case"urn:mpeg:dash:utc:direct:2012":return y=Date.parse(_),S.return(isNaN(y)?0:y-Date.now());case"urn:mpeg:dash:utc:http-ntp:2014":case"urn:mpeg:dash:utc:ntp:2014":case"urn:mpeg:dash:utc:sntp:2014":qe("NTP UTCTiming scheme is not supported");break;default:qe("Unrecognized scheme in UTCTiming element",g)}S.A(9);break;case 7:return C(S,P_(e,i,_,"HEAD"),10);case 10:return S.return(S.h);case 8:return C(S,P_(e,i,_,"GET"),11);case 11:return S.return(S.h);case 9:Ae(S,3);break;case 5:oe(S);case 3:h=l.next(),S.A(2);break;case 4:return qe("A UTCTiming element should always be given in live manifests! This content may not play on clients with bad clocks!"),S.return(0)}})}function ZA(e,i,r,s,o){var l=s.getAttribute("schemeIdUri")||"",h=s.getAttribute("value")||"",d=We(s,"timescale",Di)||1;s=v(Qe(s,"Event"));for(var g=s.next();!g.done;g=s.next()){g=g.value;var _=We(g,"presentationTime",Di)||0,y=We(g,"duration",Di)||0;_=_/d+i,y=_+y/d,r!=null&&(_=Math.min(_,i+r),y=Math.min(y,i+r)),y<o||(g={schemeIdUri:l,value:h,startTime:_,endTime:y,id:g.getAttribute("id")||"",eventElement:g},e.h.onTimelineRegionAdded(g))}}function QA(e,i,r,s){var o,l,h,d,g;return z(function(_){return _.g==1?(o=xr,l=Th(i,r,s,e.g.retryParameters),h=e.h.networkingEngine,d=h.request(o,l),On(e.o,d),C(_,d.promise,2)):(g=_.h,_.return(g.data))})}function k_(e,i){return qo(Pi(e,i))?De:e.split("/")[0]}te("shaka.dash.DashParser",ro),Xr.mpd=function(){return new ro},ii["application/dash+xml"]=function(){return new ro},ii["video/vnd.mpeg.dash.mpd"]=function(){return new ro};function D_(e,i,r,s){this.h=e,this.type=i,this.g=r,this.segments=s||null}function dc(e,i,r,s){this.id=e,this.name=i,this.g=r,this.value=s===void 0?null:s}dc.prototype.toString=function(){function e(s){return s.name+"="+(isNaN(Number(s.value))?'"'+s.value+'"':s.value)}var i="#"+this.name,r=this.g?this.g.map(e):[];return this.value&&r.unshift(this.value),0<r.length&&(i+=":"+r.join(",")),i},dc.prototype.getAttribute=function(e){var i=this.g.filter(function(r){return r.name==e});return i.length?i[0]:null};function pe(e,i,r){return(e=e.getAttribute(i))?e.value:r||null}function ot(e,i){if(e=e.getAttribute(i),!e)throw new F(2,4,4023,i);return e.value}function O_(e,i,r){r=r===void 0?[]:r,this.g=i,this.i=e,this.h=r}function F_(e,i){this.name=e,this.value=i}function Fi(e,i){return e.filter(function(r){return r.name==i})}function N_(e,i){return e.filter(function(r){return ot(r,"TYPE")==i})}function Rt(e,i){return e=Fi(e,i),e.length?e[0]:null}function rl(e,i){var r=0;return r=r===void 0?0:r,(e=Rt(e,i))?Number(e.value):r}function Zn(e,i){return Ft([e],[i])[0]}function en(e){this.h=e,this.g=0}function Qn(e){wr(e,/[ \t]+/gm)}function wr(e,i){return i.lastIndex=e.g,i=i.exec(e.h),i=i==null?null:{position:i.index,length:i[0].length,results:i},e.g==e.h.length||i==null||i.position!=e.g?null:(e.g+=i.length,i.results)}function tn(e){return e.g==e.h.length?null:(e=wr(e,/[^ \t\n]*/gm))?e[0]:null}function JA(){this.g=0}function fc(e,i,r){i=et(i),i=i.replace(/\r\n|\r(?=[^\n]|$)/gm,`
`).trim();var s=i.split(/\n+/m);if(!/^#EXTM3U($|[ \t\n])/m.test(s[0]))throw new F(2,4,4015);i=0;for(var o=!0,l=v(s),h=l.next();!h.done;h=l.next())if(h=h.value,/^#(?!EXT)/m.test(h)||o)o=!1;else if(h=pc(e,h),--e.g,U_.includes(h.name)){i=1;break}else h.name=="EXT-X-STREAM-INF"&&(o=!0);for(l=[],o=!0,h=0;h<s.length;h++){var d=s[h],g=s[h+1];if(/^#(?!EXT)/m.test(d)||o)o=!1;else{if(d=pc(e,d),eE.includes(d.name)){if(i!=1)throw new F(2,4,4017);var _=s.splice(h,s.length-h);s=r,o=[],h=[],g=[],d=null,_=v(_);for(var y=_.next();!y.done;y=_.next())y=y.value,/^(#EXT)/.test(y)?(y=pc(e,y),U_.includes(y.name)?l.push(y):y.name=="EXT-X-MAP"?d=y:y.name=="EXT-X-PART"?g.push(y):y.name=="EXT-X-PRELOAD-HINT"?pe(y,"TYPE")=="PART"?g.push(y):pe(y,"TYPE")=="MAP"&&(y.name="EXT-X-MAP",d=y):h.push(y)):/^#(?!EXT)/m.test(y)||(y=Zn(s,y.trim()),d&&h.push(d),o.push(new O_(y,h,g)),h=[],g=[]);return g.length&&(d&&h.push(d),o.push(new O_("",h,g))),new D_(r,i,l,o)}l.push(d),d.name=="EXT-X-STREAM-INF"&&(d.g.push(new F_("URI",g)),o=!0)}}return new D_(r,i,l)}function pc(e,i){e=e.g++;var r=i.match(/^#(EXT[^:]*)(?::(.*))?$/);if(!r)throw new F(2,4,4016,i);i=r[1];var s=r[2];r=[];var o;if(s){s=new en(s);var l;(l=wr(s,/^([^,=]+)(?:,|$)/g))&&(o=l[1]);for(var h=/([^=]+)=(?:"([^"]*)"|([^",]*))(?:,|$)/g;l=wr(s,h);)r.push(new F_(l[1],l[2]||l[3])),Qn(s)}return new dc(e,i,r,o)}var U_="EXT-X-TARGETDURATION EXT-X-MEDIA-SEQUENCE EXT-X-DISCONTINUITY-SEQUENCE EXT-X-PLAYLIST-TYPE EXT-X-I-FRAMES-ONLY EXT-X-ENDLIST EXT-X-SERVER-CONTROL EXT-X-SKIP".split(" "),eE="EXTINF EXT-X-BYTERANGE EXT-X-DISCONTINUITY EXT-X-PROGRAM-DATE-TIME EXT-X-KEY EXT-X-DATERANGE EXT-X-MAP".split(" ");function z_(){}function B_(e){try{var i=gc(e);return kn({uri:e,Oe:e,data:i.data,headers:{"content-type":i.contentType}})}catch(r){return Vr(r)}}function gc(e){var i=e.split(":");if(2>i.length||i[0]!="data")throw new F(2,1,1004,e);if(i=i.slice(1).join(":").split(","),2>i.length)throw new F(2,1,1004,e);var r=i[0];e=u.decodeURIComponent(i.slice(1).join(",")),i=r.split(";"),r=i[0];var s=!1;1<i.length&&i[i.length-1]=="base64"&&(s=!0,i.pop());var o;return s?o=qi(e):o=mr(e),{data:o,contentType:r}}te("shaka.net.DataUriPlugin",z_),z_.parse=B_,Yi("data",B_);function no(){var e=this;this.g=this.i=null,this.Fa=1,this.o=new Map,this.u=new Map,this.F=new Map,this.F.set("video",new Map),this.F.set("audio",new Map),this.F.set(De,new Map),this.F.set("image",new Map),this.ua=new Set,this.h=new Map,this.j=null,this.M="",this.W=new JA,this.O=0,this.B=-1,this.H=1/0,this.Ga=!1,this.m=new we(function(){yE(e)}),this.ea=sl,this.D=null,this.ca=0,this.J=1/0,this.V=this.da=0,this.G=new ra,this.L=new Map,this.s=new Map,this.ba=new Map,this.l=!1}p=no.prototype,p.configure=function(e){this.g=e},p.start=function(e,i){var r=this,s;return z(function(o){return o.g==1?(r.i=i,r.l=i.isLowLatencyMode(),C(o,wc(r,e),2)):o.g!=3?(s=o.h,r.M=s.uri,C(o,nE(r,s.data,e),3)):o.return(r.D)})},p.stop=function(){this.m&&(this.m.stop(),this.m=null);var e=[];return this.G&&(e.push(this.G.destroy()),this.G=null),this.g=this.i=null,this.ua.clear(),this.D=null,this.h.clear(),this.u.clear(),this.s.clear(),this.o.clear(),Promise.all(e)},p.update=function(){var e=this,i,r,s,o,l,h,d,g,_;return z(function(y){if(y.g==1){if(!li(e))return y.return();for(i=[],r=Array.from(e.h.values()),s=r.filter(function(S){return S.stream.segmentIndex}),o=v(s),l=o.next();!l.done;l=o.next())h=l.value,i.push(tE(e,h));return C(y,Promise.all(i),2)}X_(e,s.map(function(S){return S.stream})),d=s.some(function(S){return S.mc==0}),s.length&&!d&&(g=xE,nl(e,g.ff),_=s.map(function(S){return S.Ya}),e.j.Aa(Math.min.apply(Math,O(_))),e.i.updateDuration()),K(y)})};function mc(e,i){return li(e)?e.F.get(i.type):i.$c}function tE(e,i){var r,s,o,l,h,d,g,_,y,S,w,E,R,P,L,M;return z(function(U){if(U.g==1)return r=i.Jc,s=new jt(r),e.l&&i.Mc&&Ho(s,new Sn("_HLS_skip=YES")),C(U,wc(e,s.toString()),2);if(o=U.h,!i.stream.segmentIndex)return U.return();if(l=fc(e.W,o.data,o.uri),l.type!=1)throw new F(2,4,4017);h=Fi(l.g,"EXT-X-DEFINE"),d=V_(e,h),g=i.stream,_=mc(e,i),y=Y_(l,g.mimeType),S=y.keyIds,w=y.drmInfos,E=function(k,N){return k.size===N.size&&[].concat(O(k)).every(function(B){return N.has(B)})},E(g.keyIds,S)||(g.keyIds=S,g.drmInfos=w,e.i.newDrmInfo(g)),R=J_(e,l,g.type,_,d),g.segmentIndex.Hb(R,e.j.Pa()),R.length&&(P=rl(l.g,"EXT-X-MEDIA-SEQUENCE"),L=_.get(P),g.segmentIndex.eb(L)),M=R[R.length-1],Rt(l.g,"EXT-X-ENDLIST")&&(i.mc=!0,i.Ya=M.endTime),K(U)})}p.onExpirationUpdated=function(){};function iE(e,i){for(var r=e.B==-1,s=v(i),o=s.next();!o.done;o=s.next()){o=o.value;var l=o.stream.segmentIndex,h=mc(e,o);if(l=l.g[0]||null){h=v(h);for(var d=h.next();!d.done;d=h.next()){d=v(d.value);var g=d.next().value;if(d.next().value==l.startTime){r&&(e.B=Math.max(e.B,g)),o.Cd=g;break}}}}if(!(0>e.B))for(i=v(i),o=i.next();!o.done;o=i.next())r=o.value,(s=r.stream.segmentIndex)&&(s.g.splice(0,e.B-r.Cd),(s=s.g[0]||null)&&(s=-s.startTime,r.stream.segmentIndex.offset(s),j_(e,r,s)))}function rE(e,i){if(e.H==1/0){i=v(i);for(var r=i.next();!r.done;r=i.next()){var s=r.value.stream.segmentIndex.g[0]||null;s!=null&&s.g!=null&&(e.H=Math.min(e.H,s.g))}}if(i=e.H,i!=1/0)for(s=v(e.h.values()),r=s.next();!r.done;r=s.next()){r=r.value;var o=r.stream.segmentIndex;if(o!=null){var l=o.g[0]||null;if(l.g==null)Pr("Missing EXT-X-PROGRAM-DATE-TIME for stream",r.Ac,"Expect AV sync issues!");else for(j_(e,r,l.g-i-l.startTime),r=v(o),o=r.next();!o.done;o=r.next())o.value.oe(i)}}}function j_(e,i,r){i.Ya+=r,e=mc(e,i),i=v(e);for(var s=i.next();!s.done;s=i.next()){var o=v(s.value);s=o.next().value,o=o.next().value,e.set(s,o+r)}}function nE(e,i,r){var s,o,l,h,d,g,_,y,S,w,E,R,P,L,M,U,k,N,B,j,V,$,Y,ae,ue,he,Se,ne,Ze,Ge,nt,Gt;return z(function(ci){switch(ci.g){case 1:s=fc(e.W,i,e.M),o=Fi(s.g,"EXT-X-DEFINE");for(var Ui=v(o),gt=Ui.next();!gt.done;gt=Ui.next()){var Mt=gt.value;gt=pe(Mt,"NAME"),Mt=pe(Mt,"VALUE"),gt&&Mt&&(e.o.has(gt)||e.o.set(gt,Mt))}if(l=[],h=[],d=[],s.type==1)return j=e.g.hls.mediaPlaylistFullMimeType,s.segments.length&&(V=new jt(s.segments[0].i),$=V.qa.split(".").pop(),(Y=ey[$])?j=Y:$!=="ts"&&$!=="mp4"&&(Ec[$]?(Y=Ec[$],ae=e.g.hls.defaultAudioCodec,j=Y+'; codecs="'+ae+'"'):Cc[$]&&(Y=Cc[$],ue=e.g.hls.defaultVideoCodec,j=Y+'; codecs="'+ue+'"'))),he=j.split(";")[0],Se=he.split("/")[0],ne=Jf(j),Ze=new Map,C(ci,q_(e,s,r,r,ne,Se,"",!0,"Media Playlist",null,Ze,null,!1,!1,he),5);for(g=Fi(s.g,"EXT-X-MEDIA"),_=Fi(s.g,"EXT-X-STREAM-INF"),y=Fi(s.g,"EXT-X-IMAGE-STREAM-INF"),S=Fi(s.g,"EXT-X-SESSION-KEY"),Ui=v(_),gt=Ui.next();!gt.done;gt=Ui.next()){var nr=gt.value;Mt=pe(nr,"AUDIO"),gt=pe(nr,"VIDEO");var di=pe(nr,"SUBTITLES");if(nr=W_(e,nr),di){var qx=wn(De,nr);e.s.set(di,qx),yi(nr,qx)}Mt&&(di=wn("audio",nr),di||(di=e.g.hls.defaultAudioCodec),e.s.set(Mt,di)),gt&&(Mt=wn("video",nr),Mt||(Mt=e.g.hls.defaultVideoCodec),e.s.set(gt,Mt))}for(w=Fi(s.g,"EXT-X-SESSION-DATA"),E=v(w),R=E.next();!R.done;R=E.next())P=R.value,L=pe(P,"DATA-ID"),M=pe(P,"URI"),U=pe(P,"LANGUAGE"),k=pe(P,"VALUE"),N=new Map().set("id",L),M&&N.set("uri",Zn(e.M,M)),U&&N.set("language",U),k&&N.set("value",k),B=new fe("sessiondata",N),e.i&&e.i.onEvent(B);for(aE(e,g),Ui=N_(g,"CLOSED-CAPTIONS"),Ui=v(Ui),gt=Ui.next();!gt.done;gt=Ui.next())di=gt.value,gt=_c(di),Mt=ot(di,"GROUP-ID"),di=ot(di,"INSTREAM-ID"),e.L.get(Mt)||e.L.set(Mt,new Map),e.L.get(Mt).set(di,gt);return l=lE(e,_,S),h=sE(e,g),C(ci,oE(e,y),4);case 4:d=ci.h,ci.A(3);break;case 5:Ge=ci.h,e.h.set(r,Ge),l.push({id:0,language:"und",disabledUntilTime:0,primary:!0,audio:Se=="audio"?Ge.stream:null,video:Se=="video"?Ge.stream:null,bandwidth:0,allowedByApplication:!0,allowedByKeySystem:!0,decodingInfos:[]});case 3:if(!e.i)throw new F(2,7,7001);e.j=new le(null,0),e.j.yc(!0),s.type==1&&(li(e)&&(Z_(e),nt=e.O,e.m.N(nt)),Gt=Array.from(e.h.values()),vc(e,Gt),H_(e)),e.D={presentationTimeline:e.j,variants:l,textStreams:h,imageStreams:d,offlineSessionIds:[],minBufferTime:0,sequenceMode:!0},e.i.makeTextStreamsForClosedCaptions(e.D),K(ci)}})}function H_(e){if(li(e)){if(e.O=e.J,e.ea==bc){var i=xc(e);e.g.hls.useSafariBehaviorForLive&&(i=e.j.m),isNaN(e.g.availabilityWindowOverride)||(i=e.g.availabilityWindowOverride),e.j.me(i)}}else e.j.Aa(xc(e));e.j.Md()}function V_(e,i){var r=new Map;i=v(i);for(var s=i.next();!s.done;s=i.next()){var o=s.value;s=pe(o,"NAME");var l=pe(o,"VALUE");o=pe(o,"IMPORT"),s&&l&&r.set(s,l),o&&(s=e.o.get(o))&&r.set(o,s)}return r}function sE(e,i){var r=N_(i,"SUBTITLES");i=r.map(function(h){if(e.g.disableText)return null;try{return G_(e,h).stream}catch(d){if(e.g.hls.ignoreTextStreamFailures)return null;throw d}}),r=v(r);for(var s=r.next();!s.done;s=r.next()){var o=ot(s.value,"GROUP-ID");if((s=e.s.get(o))&&(o=e.u.get(o))){o=v(o);for(var l=o.next();!l.done;l=o.next())l=l.value,l.stream.codecs=s,l.stream.mimeType=Tc(De,s)||Sc(De)}}return i.filter(function(h){return h})}function oE(e,i){var r,s;return z(function(o){return o.g==1?(r=i.map(function(l){var h,d;return z(function(g){if(g.g==1)return e.g.disableThumbnails?g.return(null):(de(g,2),C(g,hE(e,l),4));if(g.g!=2)return h=g.h,g.return(h.stream);if(d=oe(g),e.g.hls.ignoreImageStreamFailures)return g.return(null);throw d})}),C(o,Promise.all(r),2)):(s=o.h,o.return(s.filter(function(l){return l})))})}function aE(e,i){i=i.filter(function(s){var o=pe(s,"URI")||"";return pe(s,"TYPE")!="SUBTITLES"&&o!=""}),i=v(i);for(var r=i.next();!r.done;r=i.next())G_(e,r.value)}function lE(e,i,r){var s=[],o=new Set;if(0<r.length){r=v(r);for(var l=r.next();!l.done;l=r.next()){l=l.value;var h=ot(l,"METHOD");if(h!="NONE"&&h!="AES-128"&&(h=pe(l,"KEYFORMAT")||"identity",l=(h=iy[h])?h(l,""):null)){if(l.keyIds){h=v(l.keyIds);for(var d=h.next();!d.done;d=h.next())o.add(d.value)}s.push(l)}}}return i=i.map(function(g){var _=pe(g,"FRAME-RATE"),y=Number(pe(g,"AVERAGE-BANDWIDTH"))||Number(ot(g,"BANDWIDTH")),S=pe(g,"RESOLUTION");S=v(S?S.split("x"):[null,null]);var w=S.next().value,E=S.next().value,R=pe(g,"VIDEO-RANGE");g=uE(e,g),S=g.audio,g=g.video;for(var P=v(g),L=P.next();!L.done;L=P.next())(L=L.value.stream)&&(L.width=Number(w)||void 0,L.height=Number(E)||void 0,L.frameRate=Number(_)||void 0,L.hdr=R||void 0);for(_=e.g.disableAudio,(!S.length||_)&&(S=[null]),_=e.g.disableVideo,(!g.length||_)&&(g=[null]),_=[],S=v(S),w=S.next();!w.done;w=S.next())for(w=w.value,E=v(g),R=E.next();!R.done;R=E.next()){var M=R.value;(R=w?w.stream:null)&&(R.drmInfos=s,R.keyIds=o),(P=M?M.stream:null)&&(P.drmInfos=s,P.keyIds=o),L=w?w.stream.drmInfos:null;var U=M?M.stream.drmInfos:null;M=(M?M.Ac:"")+" - "+(w?w.Ac:""),R&&P&&L.length&&U.length&&!(0<fa(L,U).length)||e.ua.has(M)||(R={id:e.Fa++,language:R?R.language:"und",primary:!!R&&R.primary||!!P&&P.primary,audio:R,video:P,bandwidth:y,allowedByApplication:!0,allowedByKeySystem:!0,decodingInfos:[]},_.push(R),e.ua.add(M))}return _}).reduce(Iu,[]),i=i.filter(function(g){return g!=null})}function uE(e,i){var r=W_(e,i),s=pe(i,"AUDIO"),o=pe(i,"VIDEO"),l=s||o;l=l&&e.u.has(l)?e.u.get(l):[],s={audio:s?l:[],video:o?l:[]},o=!1;var h=ot(i,"URI"),d=s.audio.find(function(y){return y&&y.Ac==h}),g=wn("video",r),_=wn("audio",r);return _&&!g?l="audio":!l.length&&_&&g?(l="video",r=[[g,_].join()]):s.audio.length&&d?(l="audio",o=!0):l=s.video.length&&!s.audio.length?"audio":"video",o||(e=cE(e,i,r,l),s[e.stream.type]=[e]),s}function W_(e,i){var r=[];e.g.disableVideo||r.push(e.g.hls.defaultVideoCodec),e.g.disableAudio||r.push(e.g.hls.defaultAudioCodec),r=pe(i,"CODECS",r.join(",")).split(/\s*,\s*/),e=new Set,i=[],r=v(r);for(var s=r.next();!s.done;s=r.next()){s=s.value;var o=Cs(s)[0];e.has(o)||(i.push(s),e.add(o))}return i}function _c(e){return e=pe(e,"LANGUAGE")||"und",Me(e)}function G_(e,i){var r=ot(i,"GROUP-ID"),s="",o=ot(i,"TYPE").toLowerCase();o=="subtitles"&&(o=De);var l=o;if(l!=De&&r&&e.s.has(r)&&(s=e.s.get(r)),o=Jn(ot(i,"URI"),e.o),e.h.has(o))return e.h.get(o);var h=_c(i),d=pe(i,"NAME"),g=pe(i,"DEFAULT")=="YES",_=l=="audio"&&(_=pe(i,"CHANNELS"))?parseInt(_.split("/")[0],10):null,y=l=="audio"&&(y=pe(i,"CHANNELS"))?y.includes("/JOC"):!1,S=pe(i,"CHARACTERISTICS");return i=pe(i,"FORCED")=="YES",s=yc(e,o,s,l,h,g,d,_,null,S,i,y),e.u.has(r)?e.u.get(r).push(s):e.u.set(r,[s]),e.h.has(o)?e.h.get(o):(e.h.set(o,s),s)}function hE(e,i){var r,s,o,l,h,d,g,_,y,S;return z(function(w){return w.g==1?(r=Jn(ot(i,"URI"),e.o),s=pe(i,"CODECS","jpeg")||"",e.h.has(r)?w.return(e.h.get(r)):(o=_c(i),l=pe(i,"NAME"),h=pe(i,"CHARACTERISTICS"),d=yc(e,r,s,"image",o,!1,l,null,null,h,!1,!1),e.h.has(r)?w.return(e.h.get(r)):(g=pe(i,"RESOLUTION"))?C(w,d.stream.createSegmentIndex(),3):w.A(2))):(w.g!=2&&(_=d.stream.segmentIndex.get(0),y=_.tilesLayout)&&(d.stream.width=Number(g.split("x")[0])*Number(y.split("x")[0]),d.stream.height=Number(g.split("x")[1])*Number(y.split("x")[1])),(S=pe(i,"BANDWIDTH"))&&(d.stream.bandwidth=Number(S)),e.h.set(r,d),w.return(d))})}function cE(e,i,r,s){var o=Jn(ot(i,"URI"),e.o);return e.h.has(o)||(i=pe(i,"CLOSED-CAPTIONS"),i=s=="video"&&i&&i!="NONE"?e.L.get(i):null,r=xs(s,r),s=yc(e,o,r,s,"und",!1,null,null,i,null,!1,!1),e.h.has(o))?e.h.get(o):(e.h.set(o,s),s)}function yc(e,i,r,s,o,l,h,d,g,_,y,S){function w(U){var k,N,B,j,V,$,Y,ae,ue,he,Se,ne,Ze;return z(function(Ge){if(Ge.g==1)return C(Ge,wc(e,P.Jc),2);if(Ge.g!=3)return k=Ge.h,U.aborted?Ge.return():(N=k.uri,B=fc(e.W,k.data,N),j=li(e),C(Ge,q_(e,B,i,N,r,s,o,l,h,d,g,_,y,S),3));if(V=Ge.h,U.aborted)return Ge.return();if($=V.stream,li(e)&&!j&&Z_(e),P.Jc=N,P.Ya=V.Ya,P.Mc=V.Mc,P.mc=V.mc,P.$c=V.$c,P.Ld=!0,R.segmentIndex=$.segmentIndex,R.encrypted=$.encrypted,R.drmInfos=$.drmInfos,R.keyIds=$.keyIds,R.mimeType=$.mimeType,zn.includes(R.mimeType)&&(R.codecs=""),R.drmInfos.length&&e.i.newDrmInfo(R),Y=wt,s==Y.va||s==Y.Hc)for(ae=v(e.h.values()),ue=ae.next();!ue.done;ue=ae.next())he=ue.value,he.Ld||he.type!=s||(he.stream.mimeType=$.mimeType,zn.includes(he.stream.mimeType)&&(he.stream.codecs=""));dE(e)&&(e.Ga?vc(e,[P]):(e.Ga=!0,Se=Array.from(e.h.values()),ne=Se.filter(function(nt){return nt.stream.segmentIndex}),vc(e,ne),H_(e),Ze=e.O,0<Ze&&e.m.N(Ze))),K(Ge)})}var E=Zn(e.M,i),R=$_(e,r,s,o,l,h,d,g,_,y,S);zn.includes(R.mimeType)&&(R.codecs="");var P={stream:R,type:s,Ac:i,Jc:E,Ya:0,$c:new Map,Mc:!1,mc:!1,Cd:-1,Ld:!1},L=null,M=new AbortController;return R.createSegmentIndex=function(){return L||(M=new AbortController,L=new Promise(function(U){U(w(M.signal))}))},R.closeSegmentIndex=function(){L&&!R.segmentIndex&&M.abort(),R.segmentIndex&&(R.segmentIndex.release(),R.segmentIndex=null),L=null},P}function xc(e){var i=1/0;e=v(e.h.values());for(var r=e.next();!r.done;r=e.next())r=r.value,r.stream.segmentIndex&&r.stream.type!="text"&&(i=Math.min(i,r.Ya));return i}function X_(e,i){var r=[];i=v(i);for(var s=i.next();!s.done;s=i.next())s=s.value,s.segmentIndex&&yw(s.segmentIndex,function(o){r.push(o)});e.j.Ib(r)}function vc(e,i){if(!li(e))for(var r=xc(e),s=v(i),o=s.next();!o.done;o=s.next())o.value.stream.segmentIndex.Wa(0,r);for(r=v(i),o=r.next();!o.done;o=r.next())o=o.value.stream,zn.includes(o.mimeType)&&(o.codecs="");X_(e,i.map(function(l){return l.stream})),e.g.hls.ignoreManifestProgramDateTime?iE(e,i):rE(e,i)}function dE(e){if(!e.D)return!1;var i=[],r=[];e=v(e.D.variants);for(var s=e.next();!s.done;s=e.next())s=s.value,s.video&&i.push(s.video),s.audio&&r.push(s.audio);return!(0<i.length&&!i.some(function(o){return o.segmentIndex})||0<r.length&&!r.some(function(o){return o.segmentIndex}))}function q_(e,i,r,s,o,l,h,d,g,_,y,S,w,E,R){var P,L,M,U,k,N,B,j,V,$,Y,ae,ue,he,Se;return z(function(ne){if(ne.g==1){if(i.type!=1)throw new F(2,4,4017);return P=Fi(i.g,"EXT-X-DEFINE"),L=V_(e,P),K_(e,i),R?ne.A(2):C(ne,_E(e,l,o,i,L),3)}if(ne.g!=2&&(R=ne.h),M=Y_(i,R),U=M.drmInfos,k=M.keyIds,N=M.encrypted,B=M.kf,N&&!U.length&&!B)throw new F(2,4,4026);return j=li(e)?e.F.get(l):new Map,V=e.l,$=J_(e,i,l,j,L),V!=e.l&&K_(e,i),Y=$[$.length-1].endTime,ae=new Pe($),he=(ue=Rt(i.g,"EXT-X-SERVER-CONTROL"))?ue.getAttribute("CAN-SKIP-UNTIL")!=null:!1,Se=$_(e,o,l,h,d,g,_,y,S,w,E),Se.segmentIndex=ae,Se.encrypted=N,Se.drmInfos=U,Se.keyIds=k,Se.mimeType=R,ne.return({stream:Se,type:l,Ac:r,Jc:s,Ya:Y,Mc:he,mc:!1,Cd:-1,$c:j,Ld:!1})})}function $_(e,i,r,s,o,l,h,d,g,_,y){var S=Tc(r,i)||Sc(r);return{id:e.Fa++,originalId:l,createSegmentIndex:function(){return Promise.resolve()},segmentIndex:null,mimeType:S,codecs:i,kind:r==De?"subtitle":void 0,encrypted:!1,drmInfos:[],keyIds:new Set,language:s,label:l,type:r,primary:o,trickModeVideo:null,emsgSchemeIdUris:null,frameRate:void 0,pixelAspectRatio:void 0,width:void 0,height:void 0,bandwidth:void 0,roles:g?g.split(","):[],forced:_,channelsCount:h,audioSamplingRate:null,spatialAudio:y,closedCaptions:d,hdr:void 0,tilesLayout:void 0}}function Y_(e,i){var r=[];if(e.segments){e=v(e.segments);for(var s=e.next();!s.done;s=e.next())s=Fi(s.value.g,"EXT-X-KEY"),r.push.apply(r,O(s))}s=e=!1;var o=[],l=new Set;r=v(r);for(var h=r.next();!h.done;h=r.next()){h=h.value;var d=ot(h,"METHOD");if(d!="NONE"){if(e=!0,d=="AES-128")s=!0;else if(d=pe(h,"KEYFORMAT")||"identity",h=(d=iy[d])?d(h,i):null){if(h.keyIds){d=v(h.keyIds);for(var g=d.next();!g.done;g=d.next())l.add(g.value)}o.push(h)}}}return{drmInfos:o,keyIds:l,encrypted:e,kf:s}}function fE(e,i,r){if(!u.crypto||!u.crypto.subtle)throw qe("Web Crypto API is not available to decrypt AES-128. (Web Crypto only exists in secure origins like https)"),new F(2,4,4042);var s=0,o=pe(i,"IV","");if(o){var l=ws(o.substr(2));if(l.byteLength!=16)throw new F(2,4,4043)}else s=rl(r.g,"EXT-X-MEDIA-SEQUENCE");i=Zn(r.h,ot(i,"URI"));var h=ti([i],e.g.retryParameters),d={method:"AES-128",iv:l,firstMediaSequenceNumber:s,fetchKey:function(){var g,_,y;return z(function(S){if(S.g==1)return C(S,Ac(e,h,6),2);if(S.g!=3){if(g=S.h,!g.data||g.data.byteLength!=16)throw new F(2,4,4044);return _={name:"AES-CBC"},y=d,C(S,u.crypto.subtle.importKey("raw",g.data,_,!0,["decrypt"]),3)}y.cryptoKey=S.h,d.fetchKey=void 0,K(S)})}};return d}function K_(e,i){var r=Rt(i.g,"EXT-X-PLAYLIST-TYPE"),s=Rt(i.g,"EXT-X-ENDLIST");if(s=r&&r.value=="VOD"||s,r=r&&r.value=="EVENT"&&!s,r=!s&&!r,s)nl(e,sl);else{if(r?nl(e,bc):nl(e,ry),s=Rt(i.g,"EXT-X-TARGETDURATION"),!s)throw new F(2,4,4024,"EXT-X-TARGETDURATION");s=Number(s.value),r=Rt(i.g,"EXT-X-PART-INF"),e.l&&r?(e.da=Number(ot(r,"PART-TARGET")),e.J=Math.min(e.da,e.J),i=Rt(i.g,"EXT-X-SERVER-CONTROL"),e.V=i?Number(ot(i,"PART-HOLD-BACK")):0):e.J=Math.min(s,e.J),e.ca=Math.max(s,e.ca)}}function Z_(e){var i=e.g.defaultPresentationDelay?e.g.defaultPresentationDelay:e.V?e.V:e.ca*e.g.hls.liveSegmentsDelay;e.j.Xe(0),e.j.We(i),e.j.yc(!1)}function pE(e,i,r,s){if(r=Rt(r,"EXT-X-MAP"),!r)return null;var o=ot(r,"URI");return s=Jn(Zn(i,o),s),i=[s,pe(r,"BYTERANGE","")].join("-"),e.ba.has(i)||(r=gE(s,r),e.ba.set(i,r)),e.ba.get(i)}function gE(e,i){var r=0,s=null;return(i=pe(i,"BYTERANGE"))&&(r=i.split("@"),s=Number(r[0]),r=Number(r[1]),s=r+s-1),new ri(function(){return[e]},r,s)}function mE(e,i,r,s,o,l,h,d,g){var _=s.g,y=Jn(s.i,l),S=Rt(_,"EXTINF"),w=l=0,E=null;s.h.length&&!e.l&&qe("Low-latency HLS live stream detected, but low-latency streaming mode is not enabled in Shaka Player. Set streaming.lowLatencyMode configuration to true, and see https://bit.ly/3clctcj for details.");var R=null;if(!e.g.hls.ignoreManifestProgramDateTime){var P=Rt(_,"EXT-X-PROGRAM-DATE-TIME");P&&P.value&&(R=jp(P.value))}if(P=Sa,Rt(_,"EXT-X-GAP")&&(P=2),!S){if(s.h.length==0)throw new F(2,4,4024,"EXTINF");if(!e.l)return null}var L=[];if(e.l)for(var M={},U=0;U<s.h.length;M={pd:M.pd},U++){var k=s.h[U],N=U==0?r:L[L.length-1],B=U==0?o:N.endTime,j=Number(pe(k,"DURATION"))||e.da;if(j){j=B+j;var V=0,$=null;k.name=="EXT-X-PRELOAD-HINT"?V=(V=pe(k,"BYTERANGE-START"))?Number(V):0:(V=pe(k,"BYTERANGE"),$=v(Q_(N,V)),V=$.next().value,$=$.next().value),(N=pe(k,"URI"))&&(M.pd=Zn(h,N),N=Sa,pe(k,"GAP")=="YES"&&(N=2),L.push(new be(B,j,function(Y){return function(){return[Y.pd]}}(M),V,$,i,0,0,1/0,[],"",null,null,N)))}}return S?l=o+Number(S.value.split(",")[0]):l=L[L.length-1].endTime,(e=Rt(_,"EXT-X-BYTERANGE"))?(E=v(Q_(r,e.value)),w=E.next().value,E=E.next().value):L.length&&(w=L[0].Ba,E=L[L.length-1].ka),r="",e=null,d=="image"&&(r="1x1",d=Rt(_,"EXT-X-TILES"))&&(r=ot(d,"LAYOUT"),(d=pe(d,"DURATION"))&&(e=Number(d))),new be(o,l,function(){return y.length?[y]:[]},w,E,i,0,0,1/0,L,r,e,R,P,g)}function Q_(e,i){var r=0,s=null;return i&&(r=i.split("@"),i=Number(r[0]),r=r[1]?Number(r[1]):e.ka+1,s=r+i-1),[r,s]}function J_(e,i,r,s,o){var l=i.segments,h=void 0,d=rl(i.g,"EXT-X-DISCONTINUITY-SEQUENCE"),g=rl(i.g,"EXT-X-MEDIA-SEQUENCE"),_=Rt(i.g,"EXT-X-SKIP");_=_?Number(pe(_,"SKIPPED-SEGMENTS")):0;var y=g+_,S=0;li(e)&&s.has(y)&&(S=s.get(y));for(var w=[],E=null,R=0;R<l.length;R++){var P=l[R],L=R==0?S:E.endTime;y=g+_+R,Rt(P.g,"EXT-X-DISCONTINUITY")&&d++;for(var M=v(P.g),U=M.next();!U.done;U=M.next())U=U.value,U.name=="EXT-X-KEY"&&(ot(U,"METHOD")=="AES-128"?h=fE(e,U,i):h=void 0);s.set(y,L),M=pE(e,i.h,P.g,o),!e.l&&e.i.isAutoLowLatencyMode()&&(e.i.enableLowLatencyMode(),e.l=e.i.isLowLatencyMode()),(E=P=mE(e,M,E,P,L,o,i.h,r,h))&&(P.m=d,e.g.hls.ignoreManifestProgramDateTime&&e.B!=null&&y<e.B||w.push(P))}if(i=w.some(function(k){return k.g!=null})){for(r={},s=0;s<w.length;r={Qb:r.Qb,Pb:r.Pb,Bc:r.Bc,Ta:r.Ta,Ob:r.Ob},s++)if(r.Ta=w[s],r.Ta.g==null)for(r.Pb=0,r.Qb=s,o=function(k){return function(){var N=w[k.Qb];if(N){if(N.g!=null)return N.g+k.Pb;k.Pb-=N.endTime-N.startTime,k.Qb+=1}return null}}(r),r.Ob=0,r.Bc=s,l=function(k){return function(){var N=w[k.Bc];if(N){if(N!=k.Ta&&(k.Ob+=N.endTime-N.startTime),N.g!=null)return N.g+k.Ob;--k.Bc}return null}}(r);r.Ta.g==null;)r.Ta.g=l(),r.Ta.g==null&&(r.Ta.g=o())}if(i)for(r=v(w),s=r.next();!s.done;s=r.next())for(o=s.value,s=o.g,o=v(o.i),l=o.next();!l.done;l=o.next())l=l.value,l.g=s,s+=l.endTime-l.startTime;if(e=e.H,i&&e!=1/0)for(i=v(w),s=i.next();!s.done;s=i.next())s.value.oe(e);return w}function Jn(e,i){e=String(e).replace(/%7B/g,"{").replace(/%7D/g,"}");var r=e.match(/{\$\w*}/g);if(r){r=v(r);for(var s=r.next();!s.done;s=r.next()){s=s.value;var o=s.slice(2,s.length-1),l=i.get(o);if(l)e=e.replace(s,l);else throw new F(2,4,4039,o)}}return e}function Tc(e,i){if(e==De){if(i=="vtt"||i=="wvtt")return"text/vtt";if(i&&i!=="")return"application/mp4"}return e!="image"||i&&i!="jpeg"?e=="audio"&&i=="mp4a.40.34"?"audio/mpeg":null:"image/jpeg"}function Sc(e){return e==De?"text/vtt":ty[e].mp4}function _E(e,i,r,s,o){var l,h,d,g,_,y,S,w,E,R;return z(function(P){return P.g==1?(l=xr,h=Math.trunc((s.segments.length-1)/2),d=Jn(s.segments[h].i,o),g=new jt(d),_=g.qa.split(".").pop(),y=ty[i],(S=y[_])||(S=ey[_])||(S=Tc(i,r))?P.return(S):(w=ti([d],e.g.retryParameters),w.method="HEAD",C(P,Ac(e,w,l),2))):(E=P.h,(R=E.headers["content-type"])?P.return(R.split(";")[0]):P.return(Sc(i)))})}function wc(e,i){return i=ti([i],e.g.retryParameters),e.i.modifyManifestRequest(i,{format:"h"}),Ac(e,i,0)}function yE(e){var i,r;z(function(s){if(s.g==1)return e.i?(de(s,2),C(s,e.update(),4)):s.return();if(s.g!=2)return li(e)&&(i=e.O,e.m.N(i)),Ae(s,0);if(r=oe(s),!e.i)return s.return();r.severity=1,e.i.onError(r),e.m.N(.1),K(s)})}function li(e){return e.ea!=sl}function nl(e,i){e.ea=i,e.j&&e.j.yc(!li(e)),li(e)||e.m.stop()}function Ac(e,i,r){if(!e.G)throw new F(2,7,7001);return i=e.i.networkingEngine.request(r,i),On(e.G,i),i.promise}te("shaka.hls.HlsParser",no);var ey={aac:"audio/aac",ac3:"audio/ac3",ec3:"audio/ec3",mp3:"audio/mpeg"},Ec={mp4:"audio/mp4",mp4a:"audio/mp4",m4s:"audio/mp4",m4i:"audio/mp4",m4a:"audio/mp4",m4f:"audio/mp4",cmfa:"audio/mp4",ts:"video/mp2t",tsa:"video/mp2t"},Cc={mp4:"video/mp4",mp4v:"video/mp4",m4s:"video/mp4",m4i:"video/mp4",m4v:"video/mp4",m4f:"video/mp4",cmfv:"video/mp4",ts:"video/mp2t",tsv:"video/mp2t"},ty={audio:Ec,video:Cc,text:{mp4:"application/mp4",m4s:"application/mp4",m4i:"application/mp4",m4f:"application/mp4",cmft:"application/mp4",vtt:"text/vtt",webvtt:"text/vtt",ttml:"application/ttml+xml"},image:{jpg:"image/jpeg",png:"image/png",svg:"image/svg+xml",webp:"image/webp",avif:"image/avif"}},iy={"com.apple.streamingkeydelivery":function(e,i){if(i=="video/mp2t")throw new F(2,4,4040);if(u.shakaMediaKeysPolyfill)throw new F(2,4,4041);return Nr("com.apple.fps",[{initDataType:"sinf",initData:new Uint8Array(0),keyId:null}])},"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":function(e){var i=ot(e,"METHOD");return["SAMPLE-AES","SAMPLE-AES-CTR"].includes(i)?(i=ot(e,"URI"),i=gc(i),i=Ee(i.data),i=Nr("com.widevine.alpha",[{initDataType:"cenc",initData:i}]),(e=pe(e,"KEYID"))&&(i.keyIds=new Set([e.toLowerCase().substr(2)])),i):null},"com.microsoft.playready":function(e){var i=ot(e,"METHOD");return["SAMPLE-AES","SAMPLE-AES-CTR"].includes(i)?(e=ot(e,"URI"),e=gc(e),e=Ee(e.data),i=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]),e=Yu(e,i,new Set,0),Nr("com.microsoft.playready",[{initDataType:"cenc",initData:e}])):null},identity:function(e){return e=ot(e,"METHOD"),["SAMPLE-AES","SAMPLE-AES-CTR"].includes(e)?Nr("org.w3.clearkey",null):null}},sl="VOD",ry="EVENT",bc="LIVE",xE={ff:sl,Og:ry,Sg:bc};$e("Tizen 3")||$e("Tizen 2")||Gf()||(Xr.m3u8=function(){return new no},ii["application/x-mpegurl"]=function(){return new no},ii["application/vnd.apple.mpegurl"]=function(){return new no});function ny(e,i,r,s,o,l){if(200<=r&&299>=r&&r!=202)return{uri:o||s,Oe:s,data:i,status:r,headers:e,fromCache:!!e["x-shaka-from-cache"]};o=null;try{o=zr(i)}catch(h){}throw new F(r==401||r==403?2:1,1,1001,s,r,o,e,l)}function Ic(){}function ol(e,i,r,s,o){var l=new AE;Rs(i.headers).forEach(function(_,y){l.append(y,_)});var h=new SE,d={ye:!1,bf:!1};if(e=vE(e,r,{body:i.body||void 0,headers:l,method:i.method,signal:h.signal,credentials:i.allowCrossSiteCredentials?"include":void 0},d,s,o,i.streamDataCallback),e=new Ye(e,function(){return d.ye=!0,h.abort(),Promise.resolve()}),i=i.retryParameters.timeout){var g=new we(function(){d.bf=!0,h.abort()});g.N(i/1e3),e.finally(function(){g.stop()})}return e}function vE(e,i,r,s,o,l,h){var d,g,_,y,S,w,E,R,P,L,M,U,k;return z(function(N){switch(N.g){case 1:return d=TE,g=wE,w=S=0,E=Date.now(),de(N,2),C(N,d(e,r),4);case 4:return _=N.h,l(sy(_.headers)),R=_.clone().body.getReader(),L=(P=_.headers.get("Content-Length"))?parseInt(P,10):0,M=function(B){function j(){var V,$;return z(function(Y){switch(Y.g){case 1:return de(Y,2),C(Y,R.read(),4);case 4:V=Y.h,Ae(Y,3);break;case 2:return oe(Y),Y.return();case 3:if(V.done){Y.A(5);break}if(S+=V.value.byteLength,!h){Y.A(5);break}return C(Y,h(V.value),5);case 5:$=Date.now(),(100<$-E||V.done)&&(o($-E,S-w,L-S),w=S,E=$),V.done?B.close():(B.enqueue(V.value),j()),K(Y)}})}j()},new g({start:M}),C(N,_.arrayBuffer(),5);case 5:y=N.h,Ae(N,3);break;case 2:throw U=oe(N),s.ye?new F(1,1,7001,e,i):s.bf?new F(1,1,1003,e,i):new F(1,1,1002,e,U,i);case 3:return k=sy(_.headers),N.return(ny(k,y,_.status,e,_.url,i))}})}function sy(e){var i={};return e.forEach(function(r,s){i[s.trim()]=r}),i}function oy(){if(u.ReadableStream)try{new ReadableStream({})}catch(e){return!1}else return!1;return!(!u.fetch||!u.AbortController)}te("shaka.net.HttpFetchPlugin",Ic),Ic.isSupported=oy,Ic.parse=ol;var TE=u.fetch,SE=u.AbortController,wE=u.ReadableStream,AE=u.Headers;oy()&&(Yi("http",ol,2,!0),Yi("https",ol,2,!0),Yi("blob",ol,2,!0));function ay(){}function al(e,i,r,s,o){var l=new EE,h=Date.now(),d=0,g=new Promise(function(_,y){l.open(i.method,e,!0),l.responseType="arraybuffer",l.timeout=i.retryParameters.timeout,l.withCredentials=i.allowCrossSiteCredentials,l.onabort=function(){y(new F(1,1,7001,e,r))};var S=!1;l.onreadystatechange=function(){if(l.readyState==2&&!S){var E=ly(l);o(E),S=!0}},l.onload=function(){var E=ly(l),R=l.response;try{var P=ny(E,R,l.status,e,l.responseURL,r);_(P)}catch(L){y(L)}},l.onerror=function(E){y(new F(1,1,1002,e,E,r))},l.ontimeout=function(){y(new F(1,1,1003,e,r))},l.onprogress=function(E){var R=Date.now();(100<R-h||E.lengthComputable&&E.loaded==E.total)&&(s(R-h,E.loaded-d,E.total-E.loaded),d=E.loaded,h=R)};for(var w in i.headers)l.setRequestHeader(w.toLowerCase(),i.headers[w]);l.send(i.body)});return new Ye(g,function(){return l.abort(),Promise.resolve()})}function ly(e){var i=e.getAllResponseHeaders().trim().split(`\r
`);e={},i=v(i);for(var r=i.next();!r.done;r=i.next())r=r.value.split(": "),e[r[0].toLowerCase()]=r.slice(1).join(": ");return e}te("shaka.net.HttpXHRPlugin",ay),ay.parse=al;var EE=u.XMLHttpRequest;Yi("http",al,1,!0),Yi("https",al,1,!0),Yi("blob",al,1,!0);function uy(e,i,r,s){this.g=e,this.i=i,this.groupId=r,this.h=s}function Rc(e){return e.ya().map(function(i){return"{"+encodeURI(i)+"}"}).join("")+":"+e.Ba+":"+e.ka}function CE(e,i){return Th(e.g.ya(),e.g.Ba,e.g.ka,i.streaming.retryParameters)}function hy(){this.h=this.j=this.i=0,this.g=new Map,this.l=0}function cy(e,i){e.i+=i;var r=e.l;return e.l++,e.g.set(r,i),r}hy.prototype.close=function(e,i){if(this.g.has(e)){var r=this.g.get(e);this.g.delete(e),this.j+=r,this.h+=i}};function dy(e){var i=this;this.o=e,this.j=new Map,this.i=new Wr(function(){return Lc(i).catch(function(){})}),this.h=[],this.m=function(){},this.l=function(){},this.g=new hy}dy.prototype.destroy=function(){return this.i.destroy()};function bE(e,i,r){e.m=i,e.l=r}function Lc(e){var i=e.h.map(function(r){return r()});return e.h=[],Promise.all(i)}function IE(e,i,r,s,o,l){Ue(e.i);var h=(e.j.get(i)||Promise.resolve()).then(function(){var d,g,_,y,S,w,E;return z(function(R){if(R.g==1)return C(R,LE(e,r),2);if(d=R.h,e.i.g)throw new F(2,9,7001);if(o)for(y in g=Ee(d),_=new Up(g),_.data)S=Number(y),w=_.data[S],E=_.g[S],e.l(w,E);e.g.close(s,d.byteLength);var P=e.g;return e.m(P.i==0?0:P.j/P.i,e.g.h),R.return(l(d))})});e.j.set(i,h)}function RE(e){return z(function(i){return i.g==1?C(i,Promise.all(e.j.values()),2):i.return(e.g.h)})}function LE(e,i){var r,s,o,l;return z(function(h){return h.g==1?(r=xr,s=e.o.request(r,i),o=function(){return s.abort()},e.h.push(o),C(h,s.promise,2)):(l=h.h,yi(e.h,o),h.return(l.data))})}function ll(e,i){var r=this;this.i=e,this.h=e.objectStore(i),this.g=new Ve,e.onabort=function(s){s.preventDefault(),r.g.reject()},e.onerror=function(s){s.preventDefault(),r.g.reject()},e.oncomplete=function(){r.g.resolve()}}ll.prototype.abort=function(){var e=this;return z(function(i){if(i.g==1){try{e.i.abort()}catch(r){}return de(i,2),C(i,e.g,4)}if(i.g!=2)return Ae(i,0);oe(i),K(i)})};function Mc(e,i){return new Promise(function(r,s){var o=e.h.openCursor();o.onerror=s,o.onsuccess=function(){var l;return z(function(h){if(h.g==1)return o.result==null?(r(),h.return()):(l=o.result,C(h,i(l.key,l.value,l),2));l.continue(),K(h)})}})}ll.prototype.store=function(){return this.h},ll.prototype.promise=function(){return this.g};function Pc(e){this.h=e,this.g=[]}Pc.prototype.destroy=function(){return Promise.all(this.g.map(function(e){return e.abort()}))};function rn(e,i){return ul(e,i,"readwrite")}function ul(e,i,r){r=e.h.transaction([i],r);var s=new ll(r,i);return e.g.push(s),s.promise().then(function(){yi(e.g,s)},function(){yi(e.g,s)}),s}function nn(e,i,r){this.h=new Pc(e),this.i=i,this.g=r}p=nn.prototype,p.destroy=function(){return this.h.destroy()},p.hasFixedKeySpace=function(){return!0},p.addSegments=function(){return fy(this.i)},p.removeSegments=function(e,i){return py(this,this.i,e,i)},p.getSegments=function(e){var i=this,r;return z(function(s){return s.g==1?C(s,gy(i,i.i,e),2):(r=s.h,s.return(r.map(function(o){return i.ze(o)})))})},p.addManifests=function(){return fy(this.g)},p.updateManifest=function(){return Promise.reject(new F(2,9,9016,"Cannot modify values in "+this.g))};function ME(e,i,r){e=rn(e.h,e.g);var s=e.store();return s.get(i).onsuccess=function(){s.put(r,i)},e.promise()}p.updateManifestExpiration=function(e,i){var r=rn(this.h,this.g),s=r.store();return s.get(e).onsuccess=function(o){(o=o.target.result)&&(o.expiration=i,s.put(o,e))},r.promise()},p.removeManifests=function(e,i){return py(this,this.g,e,i)},p.getManifests=function(e){var i=this,r;return z(function(s){return s.g==1?C(s,gy(i,i.g,e),2):(r=s.h,s.return(Promise.all(r.map(function(o){return i.bc(o)}))))})},p.getAllManifests=function(){var e=this,i,r;return z(function(s){return s.g==1?(i=ul(e.h,e.g,"readonly"),r=new Map,C(s,Mc(i,function(o,l){var h;return z(function(d){if(d.g==1)return C(d,e.bc(l),2);h=d.h,r.set(o,h),K(d)})}),2)):s.g!=3?C(s,i.promise(),3):s.return(r)})},p.ze=function(e){return e},p.bc=function(e){return Promise.resolve(e)};function fy(e){return Promise.reject(new F(2,9,9011,"Cannot add new value to "+e))}p.add=function(e,i){var r=this,s,o,l,h,d,g,_;return z(function(y){if(y.g==1){for(s=rn(r.h,e),o=s.store(),l=[],h={},d=v(i),g=d.next();!g.done;h={Fc:h.Fc},g=d.next())_=g.value,h.Fc=o.add(_),h.Fc.onsuccess=function(S){return function(){l.push(S.Fc.result)}}(h);return C(y,s.promise(),2)}return y.return(l)})};function py(e,i,r,s){e=rn(e.h,i),i=e.store();var o={};r=v(r);for(var l=r.next();!l.done;o={Ec:o.Ec},l=r.next())o.Ec=l.value,i.delete(o.Ec).onsuccess=function(h){return function(){return s(h.Ec)}}(o);return e.promise()}function gy(e,i,r){var s,o,l,h,d,g,_;return z(function(y){if(y.g==1){for(s=ul(e.h,i,"readonly"),o=s.store(),l={},h=[],d={},g=v(r),_=g.next();!_.done;d={Vb:d.Vb,Tb:d.Tb},_=g.next())d.Tb=_.value,d.Vb=o.get(d.Tb),d.Vb.onsuccess=function(S){return function(){S.Vb.result==null&&h.push(S.Tb),l[S.Tb]=S.Vb.result}}(d);return C(y,s.promise(),2)}if(h.length)throw new F(2,9,9012,"Could not find values for "+h);return y.return(r.map(function(S){return l[S]}))})}function so(e){this.g=new Pc(e)}so.prototype.destroy=function(){return this.g.destroy()},so.prototype.getAll=function(){var e=this,i,r;return z(function(s){return s.g==1?(i=ul(e.g,"session-ids","readonly"),r=[],C(s,Mc(i,function(o,l){r.push(l)}),2)):s.g!=3?C(s,i.promise(),3):s.return(r)})},so.prototype.add=function(e){var i=rn(this.g,"session-ids"),r=i.store();e=v(e);for(var s=e.next();!s.done;s=e.next())r.add(s.value);return i.promise()},so.prototype.remove=function(e){var i=this,r;return z(function(s){return s.g==1?(r=rn(i.g,"session-ids"),C(s,Mc(r,function(o,l,h){e.includes(l.sessionId)&&h.delete()}),2)):C(s,r.promise(),0)})};function Lt(){this.g=new Map}Lt.prototype.destroy=function(){for(var e=[],i=v(this.g.values()),r=i.next();!r.done;r=i.next())e.push(r.value.destroy());return this.g.clear(),Promise.all(e)},Lt.prototype.init=function(){var e=this;oo.forEach(function(o,l){(o=o())&&e.g.set(l,o)});for(var i=[],r=v(this.g.values()),s=r.next();!s.done;s=r.next())i.push(s.value.init());return Promise.all(i)};function my(e){var i=null;if(e.g.forEach(function(r,s){r.getCells().forEach(function(o,l){o.hasFixedKeySpace()||i||(i={path:{za:s,ja:l},ja:o})})}),i)return i;throw new F(2,9,9013,"Could not find a cell that supports add-operations")}function PE(e,i){e.g.forEach(function(r,s){r.getCells().forEach(function(o,l){i({za:s,ja:l},o)})})}function hl(e,i,r){if(e=e.g.get(i),!e)throw new F(2,9,9013,"Could not find mechanism with name "+i);if(i=e.getCells().get(r),!i)throw new F(2,9,9013,"Could not find cell with name "+r);return i}function kE(e,i){e.g.forEach(function(r){i(r.getEmeSessionCell())})}function DE(e){var i=Array.from(e.g.keys());if(!i.length)throw new F(2,9,9e3,"No supported storage mechanisms found");return e.g.get(i[0]).getEmeSessionCell()}function OE(e){var i,r,s;return z(function(o){return o.g==1?(i=Array.from(e.g.values()),r=0<i.length,r||(s=oo,s.forEach(function(l){(l=l())&&i.push(l)})),C(o,Promise.all(i.map(function(l){return l.erase()})),2)):r?o.A(0):C(o,Promise.all(i.map(function(l){return l.destroy()})),0)})}function _y(e,i){oo.set(e,i)}te("shaka.offline.StorageMuxer",Lt),Lt.unregister=function(e){oo.delete(e)},Lt.register=_y,Lt.prototype.destroy=Lt.prototype.destroy;var oo=new Map;function ao(){nn.apply(this,arguments)}me(ao,nn),ao.prototype.updateManifestExpiration=function(e,i){var r=this,s,o,l;return z(function(h){return s=rn(r.h,r.g),o=s.store(),l=new Ve,o.get(e).onsuccess=function(d){(d=d.target.result)?(d.expiration=i,o.put(d),l.resolve()):l.reject(new F(2,9,9012,"Could not find values for "+e))},C(h,Promise.all([s.promise(),l]),0)})},ao.prototype.bc=function(e){var i,r,s,o,l,h;return z(function(d){if(d.g==1){for(i=[],r=0;r<e.periods.length;++r)s=r==e.periods.length-1?e.duration:e.periods[r+1].startTime,o=s-e.periods[r].startTime,l=FE(e.periods[r],o),i.push(l);return C(d,T_(i),2)}return h=d.h,d.return({creationTime:0,originalManifestUri:e.originalManifestUri,duration:e.duration,size:e.size,expiration:e.expiration==null?1/0:e.expiration,streams:h,sessionIds:e.sessionIds,drmInfo:e.drmInfo,appMetadata:e.appMetadata,sequenceMode:!1})})};function FE(e,i){UE(e);for(var r=v(e.streams),s=r.next();!s.done;s=r.next());return e.streams.map(function(o){return NE(o,e.startTime,i)})}function NE(e,i,r){var s=e.initSegmentUri?yy(e.initSegmentUri):null,o=i+e.presentationTimeOffset,l=i+r;return{id:e.id,originalId:null,primary:e.primary,type:e.contentType,mimeType:e.mimeType,codecs:e.codecs,frameRate:e.frameRate,pixelAspectRatio:void 0,hdr:void 0,kind:e.kind,language:e.language,label:e.label,width:e.width,height:e.height,initSegmentKey:s,encrypted:e.encrypted,keyIds:new Set([e.keyId]),segments:e.segments.map(function(h){var d=yy(h.uri);return{startTime:i+h.startTime,endTime:i+h.endTime,dataKey:d,initSegmentKey:s,appendWindowStart:i,appendWindowEnd:l,timestampOffset:o,tilesLayout:""}}),variantIds:e.variantIds,roles:[],forced:!1,audioSamplingRate:null,channelsCount:null,spatialAudio:!1,closedCaptions:null,tilesLayout:void 0}}ao.prototype.ze=function(e){return{data:e.data}};function yy(e){var i;if((i=/^offline:[0-9]+\/[0-9]+\/([0-9]+)$/.exec(e))||(i=/^offline:segment\/([0-9]+)$/.exec(e)))return Number(i[1]);throw new F(2,9,9004,"Could not parse uri "+e)}function UE(e){var i=e.streams.filter(function(d){return d.contentType=="audio"});if(e=e.streams.filter(function(d){return d.contentType=="video"}),!i.every(function(d){return d.variantIds})||!e.every(function(d){return d.variantIds})){for(var r=v(i),s=r.next();!s.done;s=r.next())s.value.variantIds=[];for(r=v(e),s=r.next();!s.done;s=r.next())s.value.variantIds=[];if(r=0,e.length&&!i.length){var o=r++,l=v(e);for(s=l.next();!s.done;s=l.next())s.value.variantIds.push(o)}if(!e.length&&i.length)for(o=r++,l=v(i),s=l.next();!s.done;s=l.next())s.value.variantIds.push(o);if(e.length&&i.length)for(i=v(i),s=i.next();!s.done;s=i.next())for(s=s.value,o=v(e),l=o.next();!l.done;l=o.next()){l=l.value;var h=r++;s.variantIds.push(h),l.variantIds.push(h)}}}function cl(){nn.apply(this,arguments)}me(cl,nn),cl.prototype.bc=function(e){var i,r,s,o,l,h;return z(function(d){if(d.g==1){for(i=[],r=0;r<e.periods.length;++r){s=r==e.periods.length-1?e.duration:e.periods[r+1].startTime,o=s-e.periods[r].startTime;for(var g=e.periods[r],_=[],y=v(g.streams),S=y.next();!S.done;S=y.next())S=S.value,S.variantIds.length!=0&&_.push(zE(S,g.startTime,g.startTime+o));l=_,i.push(l)}return C(d,T_(i),2)}return h=d.h,d.return({appMetadata:e.appMetadata,creationTime:0,drmInfo:e.drmInfo,duration:e.duration,expiration:e.expiration==null?1/0:e.expiration,originalManifestUri:e.originalManifestUri,sessionIds:e.sessionIds,size:e.size,streams:h,sequenceMode:!1})})};function zE(e,i,r){return{id:e.id,originalId:e.originalId,primary:e.primary,type:e.contentType,mimeType:e.mimeType,codecs:e.codecs,frameRate:e.frameRate,pixelAspectRatio:e.pixelAspectRatio,hdr:void 0,kind:e.kind,language:e.language,label:e.label,width:e.width,height:e.height,encrypted:e.encrypted,keyIds:new Set([e.keyId]),segments:e.segments.map(function(s){return{startTime:i+s.startTime,endTime:i+s.endTime,initSegmentKey:e.initSegmentKey,appendWindowStart:i,appendWindowEnd:r,timestampOffset:i-e.presentationTimeOffset,dataKey:s.dataKey,tilesLayout:""}}),variantIds:e.variantIds,roles:[],forced:!1,audioSamplingRate:null,channelsCount:null,spatialAudio:!1,closedCaptions:null,tilesLayout:void 0}}function kc(){nn.apply(this,arguments)}me(kc,nn),p=kc.prototype,p.hasFixedKeySpace=function(){return!1},p.addSegments=function(e){return this.add(this.i,e)},p.addManifests=function(e){return this.add(this.g,e)},p.updateManifest=function(e,i){return ME(this,e,i)},p.bc=function(e){return e.expiration==null&&(e.expiration=1/0),Promise.resolve(e)};function xy(){this.m=this.j=this.i=this.h=this.g=this.l=null}p=xy.prototype,p.init=function(){var e=this,i=new Ve,r=!1,s=new we(function(){r=!0,i.reject(new F(2,9,9017))});s.N(5);var o=u.indexedDB.open("shaka_offline_db",5);return o.onsuccess=function(){if(!r){var l=o.result;e.l=l;var h=l.objectStoreNames;h=h.contains("manifest")&&h.contains("segment")?new ao(l,"segment","manifest"):null,e.g=h,h=l.objectStoreNames,h=h.contains("manifest-v2")&&h.contains("segment-v2")?new cl(l,"segment-v2","manifest-v2"):null,e.h=h,h=l.objectStoreNames,h=h.contains("manifest-v3")&&h.contains("segment-v3")?new cl(l,"segment-v3","manifest-v3"):null,e.i=h,h=l.objectStoreNames,h=h.contains("manifest-v5")&&h.contains("segment-v5")?new kc(l,"segment-v5","manifest-v5"):null,e.j=h,l=l.objectStoreNames.contains("session-ids")?new so(l):null,e.m=l,s.stop(),i.resolve()}},o.onupgradeneeded=function(){for(var l=o.result,h=v(["segment-v5","manifest-v5","session-ids"]),d=h.next();!d.done;d=h.next())d=d.value,l.objectStoreNames.contains(d)||l.createObjectStore(d,{autoIncrement:!0})},o.onerror=function(l){r||(i.reject(new F(2,9,9001,o.error)),s.stop(),l.preventDefault())},i},p.destroy=function(){var e=this;return z(function(i){switch(i.g){case 1:if(!e.g){i.A(2);break}return C(i,e.g.destroy(),2);case 2:if(!e.h){i.A(4);break}return C(i,e.h.destroy(),4);case 4:if(!e.i){i.A(6);break}return C(i,e.i.destroy(),6);case 6:if(!e.j){i.A(8);break}return C(i,e.j.destroy(),8);case 8:if(!e.m){i.A(10);break}return C(i,e.m.destroy(),10);case 10:e.l&&e.l.close(),K(i)}})},p.getCells=function(){var e=new Map;return this.g&&e.set("v1",this.g),this.h&&e.set("v2",this.h),this.i&&e.set("v3",this.i),this.j&&e.set("v5",this.j),e},p.getEmeSessionCell=function(){return this.m},p.erase=function(){var e=this;return z(function(i){switch(i.g){case 1:if(!e.g){i.A(2);break}return C(i,e.g.destroy(),2);case 2:if(!e.h){i.A(4);break}return C(i,e.h.destroy(),4);case 4:if(!e.i){i.A(6);break}return C(i,e.i.destroy(),6);case 6:if(!e.j){i.A(8);break}return C(i,e.j.destroy(),8);case 8:return e.l&&e.l.close(),C(i,BE(),10);case 10:return e.l=null,e.g=null,e.h=null,e.i=null,e.j=null,C(i,e.init(),0)}})};function BE(){var e=new Ve,i=u.indexedDB.deleteDatabase("shaka_offline_db");return i.onblocked=function(){},i.onsuccess=function(){e.resolve()},i.onerror=function(r){e.reject(new F(2,9,9001,i.error)),r.preventDefault()},e}_y("idb",function(){return $e("CrKey")||Ts()||!u.indexedDB?null:new xy});function Ni(e,i,r,s){this.g=e,this.i=i,this.h=r,this.l=s,this.j=["offline:",e,"/",i,"/",r,"/",s].join("")}Ni.prototype.za=function(){return this.i},Ni.prototype.ja=function(){return this.h},Ni.prototype.key=function(){return this.l},Ni.prototype.toString=function(){return this.j};function Dc(e){if(e=/^offline:([a-z]+)\/([^/]+)\/([^/]+)\/([0-9]+)$/.exec(e),e==null)return null;var i=e[1];if(i!="manifest"&&i!="segment")return null;var r=e[2];if(!r)return null;var s=e[3];return s&&i!=null?new Ni(i,r,s,Number(e[4])):null}function vy(e,i){this.h=e,this.g=i}function Ty(e,i){var r=new le(null,0);r.Aa(i.duration);var s=i.streams.filter(function(_){return _.type=="audio"}),o=i.streams.filter(function(_){return _.type=="video"});s=jE(e,s,o,r),o=i.streams.filter(function(_){return _.type==De}).map(function(_){return dl(e,_,r)});var l=i.streams.filter(function(_){return _.type=="image"}).map(function(_){return dl(e,_,r)}),h=i.drmInfo?[i.drmInfo]:[];if(i.drmInfo)for(var d=v(s.values()),g=d.next();!g.done;g=d.next())g=g.value,g.audio&&g.audio.encrypted&&(g.audio.drmInfos=h),g.video&&g.video.encrypted&&(g.video.drmInfos=h);return{presentationTimeline:r,minBufferTime:2,offlineSessionIds:i.sessionIds,variants:Array.from(s.values()),textStreams:o,imageStreams:l,sequenceMode:i.sequenceMode||!1}}function jE(e,i,r,s){for(var o=new Set,l=v(i),h=l.next();!h.done;h=l.next()){var d=v(h.value.variantIds);for(h=d.next();!h.done;h=d.next())o.add(h.value)}for(l=v(r),h=l.next();!h.done;h=l.next())for(d=v(h.value.variantIds),h=d.next();!h.done;h=d.next())o.add(h.value);for(l=new Map,o=v(o),h=o.next();!h.done;h=o.next())h=h.value,l.set(h,{id:h,language:"",disabledUntilTime:0,primary:!1,audio:null,video:null,bandwidth:0,allowedByApplication:!0,allowedByKeySystem:!0,decodingInfos:[]});for(i=v(i),o=i.next();!o.done;o=i.next())for(o=o.value,h=dl(e,o,s),d=v(o.variantIds),o=d.next();!o.done;o=d.next())o=l.get(o.value),o.language=h.language,o.primary=o.primary||h.primary,o.audio=h;for(r=v(r),i=r.next();!i.done;i=r.next())for(o=i.value,i=dl(e,o,s),h=v(o.variantIds),o=h.next();!o.done;o=h.next())o=l.get(o.value),o.primary=o.primary||i.primary,o.video=i;return l}function dl(e,i,r){var s=i.segments.map(function(o){return HE(e,o)});return r.Ib(s),{id:i.id,originalId:i.originalId,createSegmentIndex:function(){return Promise.resolve()},segmentIndex:new Pe(s),mimeType:i.mimeType,codecs:i.codecs,width:i.width||void 0,height:i.height||void 0,frameRate:i.frameRate,pixelAspectRatio:i.pixelAspectRatio,hdr:i.hdr,kind:i.kind,encrypted:i.encrypted,drmInfos:[],keyIds:i.keyIds,language:i.language,label:i.label,type:i.type,primary:i.primary,trickModeVideo:null,emsgSchemeIdUris:null,roles:i.roles,forced:i.forced,channelsCount:i.channelsCount,audioSamplingRate:i.audioSamplingRate,spatialAudio:i.spatialAudio,closedCaptions:i.closedCaptions,tilesLayout:i.tilesLayout}}function HE(e,i){var r=new Ni("segment",e.h,e.g,i.dataKey);return new be(i.startTime,i.endTime,function(){return[r.toString()]},0,null,i.initSegmentKey!=null?VE(e,i.initSegmentKey):null,i.timestampOffset,i.appendWindowStart,i.appendWindowEnd,[],i.tilesLayout||"")}function VE(e,i){var r=new Ni("segment",e.h,e.g,i);return new ri(function(){return[r.toString()]},0,null)}function Sy(){this.g=null}p=Sy.prototype,p.configure=function(){},p.start=function(e,i){var r=this,s,o,l,h,d,g,_;return z(function(y){switch(y.g){case 1:if(s=Dc(e),r.g=s,s==null||s.g!="manifest")throw new F(2,1,9004,e);return o=new Lt,lt(y),C(y,o.init(),4);case 4:return C(y,hl(o,s.za(),s.ja()),5);case 5:return l=y.h,C(y,l.getManifests([s.key()]),6);case 6:return h=y.h,d=h[0],g=new vy(s.za(),s.ja()),_=Ty(g,d),i.makeTextStreamsForClosedCaptions(_),y.return(_);case 2:return Dt(y),C(y,o.destroy(),7);case 7:St(y,0)}})},p.stop=function(){return Promise.resolve()},p.update=function(){},p.onExpirationUpdated=function(e,i){var r=this,s,o,l,h,d,g,_;return z(function(y){switch(y.g){case 1:return s=r.g,o=new Lt,de(y,2,3),C(y,o.init(),5);case 5:return C(y,hl(o,s.za(),s.ja()),6);case 6:return l=y.h,C(y,l.getManifests([s.key()]),7);case 7:if(h=y.h,d=h[0],g=d.sessionIds.includes(e),_=d.expiration==null||d.expiration>i,!g||!_){y.A(3);break}return C(y,l.updateManifestExpiration(s.key(),i),3);case 3:return Dt(y),C(y,o.destroy(),10);case 10:St(y,0);break;case 2:oe(y),y.A(3)}})},ii["application/x-offline-manifest"]=function(){return new Sy};function wy(){}function Ay(e){var i=Dc(e);return i&&i.g=="manifest"?(e={uri:e,Oe:e,data:new ArrayBuffer(0),headers:{"content-type":"application/x-offline-manifest"}},e=kn(e)):e=i&&i.g=="segment"?WE(i.key(),i):Vr(new F(2,1,9004,e)),e}function WE(e,i){var r=new Lt;return kn(void 0).Y(function(){return r.init()}).Y(function(){return hl(r,i.za(),i.ja())}).Y(function(s){return s.getSegments([i.key()])}).Y(function(s){return{uri:i,data:s[0].data,headers:{}}}).finally(function(){return r.destroy()})}te("shaka.offline.OfflineScheme",wy),wy.plugin=Ay,Yi("offline",Ay);function Ey(e,i,r){var s,o,l,h,d,g;return z(function(_){switch(_.g){case 1:s=[];for(var y=[],S=v(r),w=S.next();!w.done;w=S.next()){w=w.value;for(var E=!1,R=v(y),P=R.next();!P.done;P=R.next())if(P=P.value,XE(P.info,w)){P.sessionIds.push(w.sessionId),E=!0;break}E||y.push({info:w,sessionIds:[w.sessionId]})}o=v(y),l=o.next();case 2:if(l.done){_.A(4);break}return h=l.value,d=GE(e,i,h),C(_,d,5);case 5:g=_.h,s=s.concat(g),l=o.next(),_.A(2);break;case 4:return _.return(s)}})}function GE(e,i,r){var s,o;return z(function(l){switch(l.g){case 1:return s=new da({kb:i,onError:function(){},cd:function(){},onExpirationUpdated:function(){},onEvent:function(){}}),de(l,2),s.configure(e),C(l,dS(s,r.info.keySystem,r.info.licenseUri,r.info.serverCertificate,r.info.audioCapabilities,r.info.videoCapabilities),4);case 4:Ae(l,3);break;case 2:return oe(l),C(l,s.destroy(),5);case 5:return l.return([]);case 3:return de(l,6),C(l,Ku(s),8);case 8:Ae(l,7);break;case 6:return oe(l),C(l,s.destroy(),9);case 9:return l.return([]);case 7:return o=[],C(l,Promise.all(r.sessionIds.map(function(h){return z(function(d){if(d.g==1)return de(d,2),C(d,pS(s,h),4);if(d.g!=2)return o.push(h),Ae(d,0);oe(d),K(d)})})),10);case 10:return C(l,s.destroy(),11);case 11:return l.return(o)}})}function XE(e,i){function r(s,o){return s.robustness==o.robustness&&s.contentType==o.contentType}return e.keySystem==i.keySystem&&e.licenseUri==i.licenseUri&&fs(e.audioCapabilities,i.audioCapabilities,r)&&fs(e.videoCapabilities,i.videoCapabilities,r)}function qE(e,i,r){var s=i.presentationTimeline.getDuration();return i=Cy(i),{offlineUri:null,originalManifestUri:e,duration:s,size:0,expiration:1/0,tracks:i,appMetadata:r,isIncomplete:!1}}function Oc(e,i){var r=Ty(new vy(e.za(),e.ja()),i),s=i.appMetadata||{};return r=Cy(r),{offlineUri:e.toString(),originalManifestUri:i.originalManifestUri,duration:i.duration,size:i.size,expiration:i.expiration,tracks:r,appMetadata:s,isIncomplete:i.isIncomplete||!1}}function Cy(e){var i=[],r=zT(e.variants);r=v(r);for(var s=r.next();!s.done;s=r.next())i.push(Hr(s.value));for(e=v(e.textStreams),r=e.next();!r.done;r=e.next())i.push(Zo(r.value));return i}function $E(){this.g={}}function YE(e,i){var r=i.audio,s=i.video;if(r&&!s&&(e.g[r.id]=r.bandwidth||i.bandwidth),!r&&s&&(e.g[s.id]=s.bandwidth||i.bandwidth),r&&s){var o=r.bandwidth||393216,l=s.bandwidth||i.bandwidth-o;0>=l&&(l=i.bandwidth),e.g[r.id]=o,e.g[s.id]=l}}function KE(e,i){e.g[i.id]=i.bandwidth||2048}function by(e,i){return e=e.g[i],e==null&&(e=0),e}function ht(e){var i=this;if(e&&e.constructor!=H)throw new F(2,9,9008);this.g=this.h=null,e?(this.h=e.h,this.g=e.jc()):(this.h=Vn(),this.g=new Ne),this.i=[],this.j=[];var r=!e;this.l=new Wr(function(){var s,o,l,h,d;return z(function(g){switch(g.g){case 1:return C(g,Promise.all(i.j.map(function(_){return Lc(_)})),2);case 2:for(s=function(){},o=[],l=v(i.i),h=l.next();!h.done;h=l.next())d=h.value,o.push(d.then(s,s));return C(g,Promise.all(o),3);case 3:if(!r){g.A(4);break}return C(g,i.g.destroy(),4);case 4:i.h=null,i.g=null,K(g)}})})}function Fc(){if(xi())e:{for(var e=v(oo.values()),i=e.next();!i.done;i=e.next())if(i=i.value,i=i()){i.destroy(),e=!0;break e}e=!1}else e=!1;return e}p=ht.prototype,p.destroy=function(){return this.l.destroy()},p.configure=function(e,i){return arguments.length==2&&typeof e=="string"&&(e=Fh(e,i)),Wn(this.h,e)},p.getConfiguration=function(){var e=Vn();return Wn(e,this.h,Vn()),e},p.jc=function(){return this.g},p.store=function(e,i,r){var s=this,o=this.getConfiguration(),l=new dy(this.g);return this.j.push(l),i=ZE(this,e,i||{},function(){var h;return z(function(d){return d.g==1?C(d,tg(e,s.g,o.manifest.retryParameters,r||null),2):(h=d.h,d.return(h()))})},o,l),i=new Ye(i,function(){return Lc(l)}),i.finally(function(){yi(s.j,l)}),dC(this,i)};function ZE(e,i,r,s,o,l){var h,d,g,_,y,S,w,E,R,P,L,M,U,k;return z(function(N){switch(N.g){case 1:return fl(),d=h=null,g=new Lt,S=y=_=null,de(N,2,3),C(N,s(),5);case 5:return h=N.h,C(N,aC(e,i,h,o),6);case 6:if(w=N.h,Tt(e),E=!w.presentationTimeline.U()&&!w.presentationTimeline.jb(),!E)throw new F(2,9,9005,i);return C(N,lC(e,w,function(B){S=S||B},o),7);case 7:if(d=N.h,Tt(e),S)throw S;return C(N,JE(w,o),8);case 8:return C(N,g.init(),9);case 9:return Tt(e),C(N,my(g),10);case 10:return _=N.h,Tt(e),R=eC(d,w,i,r,o,l),P=R.ag,L=R.pe,C(N,_.ja.addManifests([P]),11);case 11:if(M=N.h,Tt(e),y=M[0],Tt(e),S)throw S;return C(N,QE(e,L,y,P,l,o,_.ja,w,d),12);case 12:return Tt(e),U=new Ni("manifest",_.path.za,_.path.ja,y),N.return(Oc(U,P));case 3:return Dt(N),C(N,g.destroy(),13);case 13:if(!h){N.A(14);break}return C(N,h.stop(),14);case 14:if(!d){N.A(16);break}return C(N,d.destroy(),16);case 16:St(N,0);break;case 2:if(k=oe(N),y==null){N.A(18);break}return C(N,Iy(y),18);case 18:throw S||k}})}function QE(e,i,r,s,o,l,h,d,g){var _,y,S,w,E,R,P,L,M,U;return z(function(k){switch(k.g){case 1:if(_={},y=0,S=function(N,B){var j,V,$,Y,ae,ue,he;return z(function(Se){if(Se.g==1){for(j={},V=v(N),$=V.next();!$.done;j={cb:j.cb},$=V.next())j.cb=$.value,Y=CE(j.cb,l),ae=j.cb.i,ue=j.cb.h,he=function(ne){return function(Ze){var Ge,nt,Gt;return z(function(ci){if(ci.g==1)return C(ci,h.addSegments([{data:Ze}]),2);Ge=ci.h,Tt(e),nt=ne.cb.g,Gt=Rc(nt),_[Gt]=Ge[0],y+=Ze.byteLength,K(ci)})}}(j),IE(o,j.cb.groupId,Y,ae,ue,he);return C(Se,RE(o),2)}return B?(Tt(e),tC(d,s,g,l),C(Se,h.updateManifest(r,s),0)):Se.A(0)})},w=!1,de(k,2),!Nc(d)||!w||Ly(d)){k.A(4);break}return C(k,S(i.filter(function(N){return N.h}),!0),5);case 5:return Tt(e),i=i.filter(function(N){return!N.h}),E=_,R=y,_={},y=0,C(k,Ry(h,r,s,E,R,function(){return Tt(e)}),6);case 6:Tt(e);case 4:if(w){k.A(7);break}return C(k,S(i,!1),8);case 8:return Tt(e),P=_,L=y,_={},y=0,C(k,Ry(h,r,s,P,L,function(){return Tt(e)}),9);case 9:Tt(e);case 7:Ae(k,0);break;case 2:return M=oe(k),U=Object.values(_),C(k,h.removeSegments(U,function(){}),10);case 10:throw M}})}function Iy(e){var i,r,s,o;return z(function(l){switch(l.g){case 1:return i=new Lt,C(l,i.init(),2);case 2:return C(l,my(i),3);case 3:return r=l.h,s=new Ni("manifest",r.path.za,r.path.ja,e),C(l,i.destroy(),4);case 4:return o=new ht,C(l,o.remove(s.toString()),0)}})}function Ry(e,i,r,s,o,l){var h,d,g,_,y,S,w,E,R,P,L;return z(function(M){switch(M.g){case 1:for(h=!1,de(M,2),d=!0,g=v(r.streams),_=g.next();!_.done;_=g.next())for(y=_.value,S=v(y.segments),w=S.next();!w.done;w=S.next())E=w.value,R=E.pendingSegmentRefId?s[E.pendingSegmentRefId]:null,R!=null&&(E.dataKey=R,E.pendingSegmentRefId=void 0),R=E.pendingInitSegmentRefId?s[E.pendingInitSegmentRefId]:null,R!=null&&(E.initSegmentKey=R,E.pendingInitSegmentRefId=void 0),E.pendingSegmentRefId&&(d=!1),E.pendingInitSegmentRefId&&(d=!1);return r.size+=o,d&&(r.isIncomplete=!1),C(M,e.updateManifest(i,r),4);case 4:h=!0,l(),Ae(M,0);break;case 2:return P=oe(M),C(M,Iy(i),5);case 5:if(h){M.A(6);break}return L=Object.values(s),C(M,e.removeSegments(L,function(){}),6);case 6:throw P}})}function JE(e,i){var r,s,o,l,h,d,g,_,y,S,w,E,R,P,L,M,U,k,N,B,j,V,$,Y,ae,ue,he,Se,ne;return z(function(Ze){switch(Ze.g){case 1:return r={width:1/0,height:1/0},kT(e,i.restrictions,r),C(Ze,op(e,i.offline.usePersistentLicense),2);case 2:for(s=[],o=i.preferredAudioChannelCount,l=i.preferredDecodingAttributes,h=i.preferredVideoCodecs,d=i.preferredAudioCodecs,np(e,h,d,o,l),g=v(e.variants),_=g.next();!_.done;_=g.next())y=_.value,s.push(Hr(y));for(S=v(e.textStreams),w=S.next();!w.done;w=S.next())E=w.value,s.push(Zo(E));for(R=v(e.imageStreams),P=R.next();!P.done;P=R.next())L=P.value,s.push(ju(L));return C(Ze,i.offline.trackSelectionCallback(s),3);case 3:for(M=Ze.h,U=e.presentationTimeline.getDuration(),k=0,N=v(M),B=N.next();!B.done;B=N.next())j=B.value,V=j.bandwidth*U/8,k+=V;return de(Ze,4),C(Ze,i.offline.downloadSizeCallback(k),6);case 6:if($=Ze.h,!$)throw new F(2,9,9014);Ae(Ze,5);break;case 4:throw Y=oe(Ze),Y instanceof F?Y:new F(2,9,9015);case 5:for(ae=new Set,ue=new Set,he=new Set,Se=v(M),B=Se.next();!B.done;B=Se.next())ne=B.value,ne.type=="variant"&&ae.add(ne.id),ne.type=="text"&&ue.add(ne.id),ne.type=="image"&&he.add(ne.id);e.variants=e.variants.filter(function(Ge){return ae.has(Ge.id)}),e.textStreams=e.textStreams.filter(function(Ge){return ue.has(Ge.id)}),e.imageStreams=e.imageStreams.filter(function(Ge){return he.has(Ge.id)}),gC(e),K(Ze)}})}function eC(e,i,r,s,o,l){var h=qE(r,i,s),d=o.offline.progressCallback;bE(l,function(E,R){h.size=R,d(h,E)},function(E,R){g&&o.offline.usePersistentLicense&&_==R&&Ds(e,"cenc",E)});var g=Nc(i)&&!Ly(i),_=null;g&&(_=mC.get(e.g.keySystem));for(var y=new $E,S=v(i.textStreams),w=S.next();!w.done;w=S.next())y.g[w.value.id]=52;for(S=v(i.imageStreams),w=S.next();!w.done;w=S.next())KE(y,w.value);for(w=v(i.variants),S=w.next();!S.done;S=w.next())YE(y,S.value);return y=uC(l,y,i,o),l=y.streams,y=y.pe,w=e.g,S=o.offline.usePersistentLicense,w&&S&&(w.initData=[]),{ag:{creationTime:Date.now(),originalManifestUri:r,duration:i.presentationTimeline.getDuration(),size:0,expiration:e.ic(),streams:l,sessionIds:S?$p(e):[],drmInfo:w,appMetadata:s,isIncomplete:!0,sequenceMode:i.sequenceMode},pe:y}}function Nc(e){return e.variants.some(function(i){var r=i.audio&&i.audio.encrypted;return i.video&&i.video.encrypted||r})}function Ly(e){return e.variants.some(function(i){return(i.video?i.video.drmInfos:[]).concat(i.audio?i.audio.drmInfos:[]).some(function(r){return r.initData&&r.initData.length})})}function tC(e,i,r,s){if(i.expiration=r.ic(),r=$p(r),i.sessionIds=s.offline.usePersistentLicense?r:[],Nc(e)&&s.offline.usePersistentLicense&&!r.length)throw new F(2,9,9007)}p.remove=function(e){return Uc(this,iC(this,e))};function iC(e,i){var r,s,o,l,h,d;return z(function(g){switch(g.g){case 1:if(fl(),r=Dc(i),r==null||r.g!="manifest")throw new F(2,9,9004,i);return s=r,o=new Lt,lt(g),C(g,o.init(),4);case 4:return C(g,hl(o,s.za(),s.ja()),5);case 5:return l=g.h,C(g,l.getManifests([s.key()]),6);case 6:return h=g.h,d=h[0],C(g,Promise.all([rC(e,d,o),nC(l,s,d)]),2);case 2:return Dt(g),C(g,o.destroy(),8);case 8:St(g,0)}})}function My(e,i){for(var r=[],s=v(e.streams),o=s.next();!o.done;o=s.next())o=o.value,i&&o.type=="video"?r.push({contentType:Pi(o.mimeType,o.codecs),robustness:e.drmInfo.videoRobustness}):i||o.type!="audio"||r.push({contentType:Pi(o.mimeType,o.codecs),robustness:e.drmInfo.audioRobustness});return r}function rC(e,i,r){return z(function(s){return C(s,pC(e.g,e.h.drm,r,i),0)})}function nC(e,i,r){function s(){}var o=fC(r);return Oc(i,r),Promise.all([e.removeSegments(o,s),e.removeManifests([i.key()],s)])}p.pg=function(){return Uc(this,sC(this))};function sC(e){var i,r,s,o,l,h,d,g,_,y;return z(function(S){switch(S.g){case 1:return fl(),i=e.g,r=e.h.drm,s=new Lt,o=!1,lt(S),C(S,s.init(),4);case 4:l=[],kE(s,function(w){return l.push(w)}),h=v(l),d=h.next();case 5:if(d.done){S.A(2);break}return g=d.value,C(S,g.getAll(),8);case 8:return _=S.h,C(S,Ey(r,i,_),9);case 9:return y=S.h,C(S,g.remove(y),10);case 10:y.length!=_.length&&(o=!0),d=h.next(),S.A(5);break;case 2:return Dt(S),C(S,s.destroy(),11);case 11:St(S,3);break;case 3:return S.return(!o)}})}p.list=function(){return Uc(this,oC())};function oC(){var e,i,r;return z(function(s){switch(s.g){case 1:return fl(),e=[],i=new Lt,lt(s),C(s,i.init(),4);case 4:return r=Promise.resolve(),PE(i,function(o,l){r=r.then(function(){var h;return z(function(d){if(d.g==1)return C(d,l.getAllManifests(),2);h=d.h,h.forEach(function(g,_){g=Oc(new Ni("manifest",o.za,o.ja,_),g),e.push(g)}),K(d)})})}),C(s,r,2);case 2:return Dt(s),C(s,i.destroy(),6);case 6:St(s,3);break;case 3:return s.return(e)}})}function aC(e,i,r,s){var o,l,h,d,g;return z(function(_){if(_.g==1)return o=null,l=e.g,h={networkingEngine:l,modifyManifestRequest:function(){},modifySegmentRequest:function(){},filter:function(){return Promise.resolve()},makeTextStreamsForClosedCaptions:function(){},onTimelineRegionAdded:function(){},onEvent:function(){},onError:function(y){o=y},isLowLatencyMode:function(){return!1},isAutoLowLatencyMode:function(){return!1},enableLowLatencyMode:function(){},updateDuration:function(){},newDrmInfo:function(){}},r.configure(s.manifest),Tt(e),C(_,r.start(i,h),2);if(_.g!=3)return d=_.h,Tt(e),g=Py(d),C(_,Promise.all(kp(g,function(y){return y.createSegmentIndex()})),3);if(Tt(e),o)throw o;return _.return(d)})}function lC(e,i,r,s){var o;return z(function(l){switch(l.g){case 1:return o=new da({kb:e.g,onError:r,cd:function(){},onExpirationUpdated:function(){},onEvent:function(){}}),o.configure(s.drm),C(l,cS(o,i.variants,s.offline.usePersistentLicense),2);case 2:return C(l,Ku(o),3);case 3:return C(l,Xp(o),4);case 4:return l.return(o)}})}function uC(e,i,r,s){var o=new Map,l=Py(r),h=new Map;l=v(l);for(var d=l.next();!d.done;d=l.next()){d=d.value;var g=hC(e,i,r,d,s,o);h.set(d.id,g)}for(e=v(r.variants),i=e.next();!i.done;i=e.next())i=i.value,i.audio&&h.get(i.audio.id).variantIds.push(i.id),i.video&&h.get(i.video.id).variantIds.push(i.id);return{streams:Array.from(h.values()),pe:Array.from(o.values())}}function hC(e,i,r,s,o,l){var h={id:s.id,originalId:s.originalId,primary:s.primary,type:s.type,mimeType:s.mimeType,codecs:s.codecs,frameRate:s.frameRate,pixelAspectRatio:s.pixelAspectRatio,hdr:s.hdr,kind:s.kind,language:s.language,label:s.label,width:s.width||null,height:s.height||null,encrypted:s.encrypted,keyIds:s.keyIds,segments:[],variantIds:[],roles:s.roles,forced:s.forced,channelsCount:s.channelsCount,audioSamplingRate:s.audioSamplingRate,spatialAudio:s.spatialAudio,closedCaptions:s.closedCaptions,tilesLayout:s.tilesLayout},d=o.offline.numberOfParallelDownloads,g=0;return cC(s,r.presentationTimeline.Pa(),function(_){var y=Rc(_),S=void 0;if(!l.has(y)){var w=_.endTime-_.startTime;w=by(i,s.id)*w,w=cy(e.g,w),l.set(y,new uy(_,w,g,!1))}_.h&&(S=Rc(_.h),l.has(S)||(w=.5*by(i,s.id),w=cy(e.g,w),l.set(S,new uy(_.h,w,g,!0)))),h.segments.push({pendingInitSegmentRefId:S,initSegmentKey:S?0:null,startTime:_.startTime,endTime:_.endTime,appendWindowStart:_.appendWindowStart,appendWindowEnd:_.appendWindowEnd,timestampOffset:_.timestampOffset,tilesLayout:_.tilesLayout,pendingSegmentRefId:y,dataKey:0}),g=(g+1)%d}),h}function cC(e,i,r){if(i=e.segmentIndex.find(i),i!=null)for(var s=e.segmentIndex.get(i);s;)r(s),s=e.segmentIndex.get(++i)}function Tt(e){if(e.l.g)throw new F(2,9,7001)}function fl(){if(!Fc())throw new F(2,9,9e3)}function Uc(e,i){return z(function(r){return r.g==1?(e.i.push(i),lt(r),C(r,i,4)):r.g!=2?r.return(r.h):(Dt(r),yi(e.i,i),St(r,0))})}function dC(e,i){var r=i.promise;return e.i.push(r),i.finally(function(){yi(e.i,r)})}function fC(e){var i=new Set;e=v(e.streams);for(var r=e.next();!r.done;r=e.next()){r=v(r.value.segments);for(var s=r.next();!s.done;s=r.next())s=s.value,s.initSegmentKey!=null&&i.add(s.initSegmentKey),i.add(s.dataKey)}return Array.from(i)}function pC(e,i,r,s){var o,l,h;return z(function(d){return d.g==1?s.drmInfo?(o=DE(r),l=s.sessionIds.map(function(g){return{sessionId:g,keySystem:s.drmInfo.keySystem,licenseUri:s.drmInfo.licenseServerUri,serverCertificate:s.drmInfo.serverCertificate,audioCapabilities:My(s,!1),videoCapabilities:My(s,!0)}}),C(d,Ey(i,e,l),2)):d.return():d.g!=3?(h=d.h,C(d,o.remove(h),3)):C(d,o.add(l.filter(function(g){return!h.includes(g.sessionId)})),0)})}function Py(e){for(var i=new Set,r=v(e.textStreams),s=r.next();!s.done;s=r.next())i.add(s.value);for(r=v(e.imageStreams),s=r.next();!s.done;s=r.next())i.add(s.value);for(e=v(e.variants),r=e.next();!r.done;r=e.next())r=r.value,r.audio&&i.add(r.audio),r.video&&i.add(r.video);return i}function gC(e){e.variants.map(function(l){return l.video});var i=new Set(e.variants.map(function(l){return l.audio}));e=e.textStreams;for(var r=v(i),s=r.next();!s.done;s=r.next()){s=v(i);for(var o=s.next();!o.done;o=s.next());}for(i=v(e),r=i.next();!r.done;r=i.next())for(r=v(e),s=r.next();!s.done;s=r.next());}te("shaka.offline.Storage",ht),ht.deleteAll=function(){var e;return z(function(i){return i.g==1?(e=new Lt,lt(i),C(i,OE(e),2)):i.g!=5?(Dt(i),C(i,e.destroy(),5)):St(i,0)})},ht.prototype.list=ht.prototype.list,ht.prototype.removeEmeSessions=ht.prototype.pg,ht.prototype.remove=ht.prototype.remove,ht.prototype.store=ht.prototype.store,ht.prototype.getNetworkingEngine=ht.prototype.jc,ht.prototype.getConfiguration=ht.prototype.getConfiguration,ht.prototype.configure=ht.prototype.configure,ht.prototype.destroy=ht.prototype.destroy,ht.support=Fc;var mC=new Map().set("org.w3.clearkey","1077efecc0b24d02ace33c1e52e2fb4b").set("com.widevine.alpha","edef8ba979d64acea3c827dcd51d21ed").set("com.microsoft.playready","9a04f07998404286ab92e65be0885f95").set("com.microsoft.playready.recommendation","9a04f07998404286ab92e65be0885f95").set("com.microsoft.playready.software","9a04f07998404286ab92e65be0885f95").set("com.microsoft.playready.hardware","9a04f07998404286ab92e65be0885f95").set("com.adobe.primetime","f239e769efa348509c16a903c6932efb");Zh.offline=Fc;function pt(){}function At(e,i){for(e={priority:i||0,mf:e},i=0;i<lo.length;i++)if(lo[i].priority<e.priority){lo.splice(i,0,e);return}lo.push(e)}te("shaka.polyfill",pt),pt.register=At,pt.installAll=function(){for(var e=v(lo),i=e.next();!i.done;i=e.next()){i=i.value;try{i.mf()}catch(r){qe("Error installing polyfill!",r)}}};var lo=[];function uo(){this.g=new pl}function ky(){u.AbortController||(u.AbortController=uo,u.AbortSignal=pl)}uo.prototype.abort=function(e){var i=this.g;i.h||(i.h=!0,i.g=e,i.g===void 0&&(i.g=new DOMException("signal is aborted without reason","AbortError")),e=new fe("abort"),i.onabort&&i.onabort(e),i.dispatchEvent(e))},b.Object.defineProperties(uo.prototype,{signal:{configurable:!0,enumerable:!0,get:function(){return this.g}}}),pt.AbortController=uo,uo.install=ky;function pl(){Le.call(this),this.h=!1,this.g=void 0,this.onabort=null}me(pl,Le),b.Object.defineProperties(pl.prototype,{aborted:{configurable:!0,enumerable:!0,get:function(){return this.h}},reason:{configurable:!0,enumerable:!0,get:function(){return this.g}}}),At(ky);function Dy(){}function Oy(){if(!Object.getOwnPropertyDescriptor(Element.prototype,"ariaHidden"))for(var e=v(["ariaHidden","ariaLabel","ariaPressed","ariaSelected"]),i=e.next();!i.done;i=e.next())_C(i.value)}function _C(e){var i="aria-"+e.toLowerCase().replace(/^aria/,"");Object.defineProperty(Element.prototype,e,{get:function(){return this.getAttribute(i)},set:function(r){r==null||r==null?this.removeAttribute(i):this.setAttribute(i,r)}})}pt.Aria=Dy,Dy.install=Oy,At(Oy);function Fy(){}function Ny(){Xx()}pt.EncryptionScheme=Fy,Fy.install=Ny,At(Ny,-2);function Uy(){}function zy(){if(u.Document){var e=Element.prototype;e.requestFullscreen=e.requestFullscreen||e.mozRequestFullScreen||e.msRequestFullscreen||e.webkitRequestFullscreen,e=Document.prototype,e.exitFullscreen=e.exitFullscreen||e.mozCancelFullScreen||e.msExitFullscreen||e.webkitCancelFullScreen,"fullscreenElement"in document||(Object.defineProperty(document,"fullscreenElement",{get:function(){return document.mozFullScreenElement||document.msFullscreenElement||document.webkitCurrentFullScreenElement||document.webkitFullscreenElement}}),Object.defineProperty(document,"fullscreenEnabled",{get:function(){return document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled}})),document.addEventListener("webkitfullscreenchange",es),document.addEventListener("webkitfullscreenerror",es),document.addEventListener("mozfullscreenchange",es),document.addEventListener("mozfullscreenerror",es),document.addEventListener("MSFullscreenChange",es),document.addEventListener("MSFullscreenError",es)}}function es(e){var i=e.type.replace(/^(webkit|moz|MS)/,"").toLowerCase(),r=document.createEvent("Event");r.initEvent(i,e.bubbles,e.cancelable),e.target.dispatchEvent(r)}pt.Fullscreen=Uy,Uy.install=zy,At(zy);function zc(){}function By(){var e=!0;(Vo()||$e("PlayStation 5")||Ss()||$e("Web0S")||Cn()||$e("CrKey")||$e("PC=EOS")||$e("Hisense")||$e("VIDAA"))&&(e=!1),e&&navigator.mediaCapabilities||(navigator.mediaCapabilities||(navigator.mediaCapabilities={}),jy=navigator.mediaCapabilities,navigator.mediaCapabilities.decodingInfo=yC)}function yC(e){var i,r,s,o,l,h,d,g,_,y,S,w,E,R,P,L,M;return z(function(U){switch(U.g){case 1:if(i={supported:!1,powerEfficient:!0,smooth:!0,keySystemAccess:null,configuration:e},!e)return U.return(i);if(r=e.video,s=e.audio,e.type=="media-source"){if(!xi())return U.return(i);if(r){if($e("CrKey"))if(u.cast&&cast.__platform__&&cast.__platform__.canDisplayType){var k=r.contentType;r.width&&r.height&&(k+="; width="+r.width+"; height="+r.height),r.framerate&&(k+="; framerate="+r.framerate),r.transferFunction==="pq"&&(k+="; eotf=smpte2084"),k=cast.__platform__.canDisplayType(k)}else k=Qt(r.contentType);else k=Qt(r.contentType);if(o=k,!o)return U.return(i)}if(s&&(l=s.contentType,h=Qt(l),!h))return U.return(i)}else if(e.type=="file"){if(r&&(d=r.contentType,g=En(d),!g)||s&&(_=s.contentType,y=En(_),!y))return U.return(i)}else return U.return(i);return e.keySystemConfiguration?(S=e.keySystemConfiguration,w=[],E=[],S.audio&&(R={robustness:S.audio.robustness||"",contentType:e.audio.contentType},w.push(R)),S.video&&(P={robustness:S.video.robustness||"",contentType:e.video.contentType},E.push(P)),L={initDataTypes:[S.initDataType],distinctiveIdentifier:S.distinctiveIdentifier,persistentState:S.persistentState,sessionTypes:S.sessionTypes},w.length&&(L.audioCapabilities=w),E.length&&(L.videoCapabilities=E),de(U,3),C(U,navigator.requestMediaKeySystemAccess(S.keySystem,[L]),5)):(i.supported=!0,U.return(Promise.resolve(i)));case 5:M=U.h,Ae(U,4);break;case 3:oe(U);case 4:M&&(i.supported=!0,i.keySystemAccess=M);case 2:return U.return(i)}})}pt.MediaCapabilities=zc,zc.install=By;var jy=null;zc.originalMcap=jy,At(By,-1);function Hy(){}function Vy(){var e=Lu();u.MediaSource&&(u.cast&&cast.__platform__&&cast.__platform__.canDisplayType?SC():e?12>=e?(Wy(),xC()):15>=e&&Wy():Ru()?vC():($e("Tizen 2")||$e("Tizen 3")||$e("Tizen 4"))&&TC()),u.MediaSource&&MediaSource.isTypeSupported('video/webm; codecs="vp9"')&&!MediaSource.isTypeSupported('video/webm; codecs="vp09.00.10.08"')&&wC()}function Wy(){var e=MediaSource.prototype.addSourceBuffer;MediaSource.prototype.addSourceBuffer=function(){var i=e.apply(this,Gi.apply(0,arguments));return i.abort=function(){},i}}function xC(){var e=SourceBuffer.prototype.remove;SourceBuffer.prototype.remove=function(i,r){return e.call(this,i,r-.001)}}function vC(){var e=MediaSource.isTypeSupported;MediaSource.isTypeSupported=function(i){return i.split(";")[0].split("/")[1]!="mp2t"&&e(i)}}function TC(){var e=MediaSource.isTypeSupported;MediaSource.isTypeSupported=function(i){return Cs(i)[0]!="opus"&&e(i)}}function SC(){var e=MediaSource.isTypeSupported;MediaSource.isTypeSupported=function(i){var r=i.split(/ *; */);return r.shift(),r.some(function(s){return s.startsWith("codecs=")})?cast.__platform__.canDisplayType(i):e(i)}}function wC(){var e=MediaSource.isTypeSupported;$e("Web0S")||(MediaSource.isTypeSupported=function(i){var r=i.split(/ *; */),s=r.findIndex(function(h){return h.startsWith("codecs=")});if(0>s)return e(i);var o=r[s].replace("codecs=","").replace(/"/g,"").split(/\s*,\s*/),l=o.findIndex(function(h){return h.startsWith("vp09")});return 0<=l&&(o[l]="vp9",r[s]='codecs="'+o.join(",")+'"',i=r.join("; ")),e(i)})}pt.MediaSource=Hy,Hy.install=Vy,At(Vy);function Gy(){}function Xy(){screen.orientation||u.orientation!=null&&AC()}function AC(){function e(){switch(u.orientation){case-90:i.type="landscape-secondary",i.angle=270;break;case 0:i.type="portrait-primary",i.angle=0;break;case 90:i.type="landscape-primary",i.angle=90;break;case 180:i.type="portrait-secondary",i.angle=180}}var i=new gl;screen.orientation=i,e(),u.addEventListener("orientationchange",function(){e();var r=new fe("change");i.dispatchEvent(r)})}pt.Orientation=Gy,Gy.install=Xy;function gl(){Le.call(this),this.type="",this.angle=0}me(gl,Le),gl.prototype.lock=function(e){function i(s){return screen.lockOrientation?screen.lockOrientation(s):screen.mozLockOrientation?screen.mozLockOrientation(s):screen.msLockOrientation?screen.msLockOrientation(s):!1}var r=!1;switch(e){case"natural":r=i("default");break;case"any":r=!0,this.unlock();break;default:r=i(e)}return r?Promise.resolve():(e=Error("screen.orientation.lock() is not available on this device"),e.name="NotSupportedError",e.code=DOMException.NOT_SUPPORTED_ERR,Promise.reject(e))},gl.prototype.unlock=function(){screen.unlockOrientation?screen.unlockOrientation():screen.mozUnlockOrientation?screen.mozUnlockOrientation():screen.msUnlockOrientation&&screen.msUnlockOrientation()},At(Xy);function Bc(){}var jc,Hc,Vc,Wc,Gc,Xc;function EC(e,i){try{var r=new ml(e,i);return Promise.resolve(r)}catch(s){return Promise.reject(s)}}function CC(e){var i=this.mediaKeys;return i&&i!=e&&qy(i,null),delete this.mediaKeys,(this.mediaKeys=e)?qy(e,this):Promise.resolve()}function bC(e){if(e=Ee(e.initData),Ot(e).getUint32(0,!0)+4!=e.byteLength)throw new RangeError("Malformed FairPlay init data");e=gr(e.subarray(4),!0),e=mr(e);var i=new Event("encrypted");i.initDataType="skd",i.initData=Jt(e),this.dispatchEvent(i)}pt.PatchedMediaKeysApple=Bc,Bc.uninstall=function(){jc&&(jc=!1,Object.defineProperty(HTMLMediaElement.prototype,"mediaKeys",Hc),HTMLMediaElement.prototype.setMediaKeys=Vc,u.MediaKeys=Wc,u.MediaKeySystemAccess=Gc,navigator.requestMediaKeySystemAccess=Xc,Hc=Xc=Vc=Gc=Wc=null,u.shakaMediaKeysPolyfill=!1)},Bc.install=function(e){u.HTMLVideoElement&&u.WebKitMediaKeys&&(e!==void 0&&e&&(jc=!0,Hc=Object.getOwnPropertyDescriptor(HTMLMediaElement.prototype,"mediaKeys"),Vc=HTMLMediaElement.prototype.setMediaKeys,Wc=u.MediaKeys,Gc=u.MediaKeySystemAccess,Xc=navigator.requestMediaKeySystemAccess),delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=CC,u.MediaKeys=_l,u.MediaKeySystemAccess=ml,navigator.requestMediaKeySystemAccess=EC,u.shakaMediaKeysPolyfill=!0)};function ml(e,i){if(this.keySystem=e,e.startsWith("com.apple.fps"))for(e=v(i),i=e.next();!i.done;i=e.next()){var r=i.value;if(r.persistentState=="required")i=null;else{i={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:r.initDataTypes,sessionTypes:["temporary"],label:r.label};var s=!1,o=!1;if(r.audioCapabilities)for(var l=v(r.audioCapabilities),h=l.next();!h.done;h=l.next())h=h.value,h.contentType&&(s=!0,WebKitMediaKeys.isTypeSupported(this.keySystem,h.contentType.split(";")[0])&&(i.audioCapabilities.push(h),o=!0));if(r.videoCapabilities)for(r=v(r.videoCapabilities),h=r.next();!h.done;h=r.next())l=h.value,l.contentType&&(s=!0,WebKitMediaKeys.isTypeSupported(this.keySystem,l.contentType.split(";")[0])&&(i.videoCapabilities.push(l),o=!0));s||(o=WebKitMediaKeys.isTypeSupported(this.keySystem,"video/mp4")),i=o?i:null}if(i){this.g=i;return}}throw e=Error("Unsupported keySystem"),e.name="NotSupportedError",e.code=DOMException.NOT_SUPPORTED_ERR,e}ml.prototype.createMediaKeys=function(){var e=new _l(this.keySystem);return Promise.resolve(e)},ml.prototype.getConfiguration=function(){return this.g};function _l(e){this.h=new WebKitMediaKeys(e),this.g=new je}_l.prototype.createSession=function(e){if(e=e||"temporary",e!="temporary")throw new TypeError("Session type "+e+" is unsupported on this platform.");return new qc(this.h)},_l.prototype.setServerCertificate=function(){return Promise.resolve(!1)};function qy(e,i){if(e.g.nb(),!i)return Promise.resolve();e.g.C(i,"webkitneedkey",bC);try{return Bn(i,HTMLMediaElement.HAVE_METADATA,e.g,function(){i.webkitSetMediaKeys(e.h)}),Promise.resolve()}catch(r){return Promise.reject(r)}}function qc(e){Le.call(this),this.i=null,this.l=e,this.g=this.h=null,this.j=new je,this.sessionId="",this.expiration=NaN,this.closed=new Ve,this.keyStatuses=new $y}me(qc,Le),p=qc.prototype,p.generateRequest=function(e,i){var r=this;this.h=new Ve;try{var s=this.l.createSession("video/mp4",Ee(i));this.i=s,this.sessionId=s.sessionId||"",this.j.C(this.i,"webkitkeymessage",function(o){r.h&&(r.h.resolve(),r.h=null),o=new Map().set("messageType",r.keyStatuses.Eb()==null?"license-request":"license-renewal").set("message",Jt(o.message)),o=new fe("message",o),r.dispatchEvent(o)}),this.j.C(s,"webkitkeyadded",function(){r.g&&(yl(r,"usable"),r.g.resolve(),r.g=null)}),this.j.C(s,"webkitkeyerror",function(){var o=Error("EME PatchedMediaKeysApple key error");if(o.errorCode=r.i.error,r.h!=null)r.h.reject(o),r.h=null;else if(r.g!=null)r.g.reject(o),r.g=null;else switch(r.i.error.code){case WebKitMediaKeyError.MEDIA_KEYERR_OUTPUT:case WebKitMediaKeyError.MEDIA_KEYERR_HARDWARECHANGE:yl(r,"output-not-allowed");break;default:yl(r,"internal-error")}}),yl(this,"status-pending")}catch(o){this.h.reject(o)}return this.h},p.load=function(){return Promise.reject(Error("MediaKeySession.load not yet supported"))},p.update=function(e){this.g=new Ve;try{this.i.update(Ee(e))}catch(i){this.g.reject(i)}return this.g},p.close=function(){try{this.i.close(),this.closed.resolve(),this.j.nb()}catch(e){this.closed.reject(e)}return this.closed},p.remove=function(){return Promise.reject(Error("MediaKeySession.remove is only applicable for persistent licenses, which are not supported on this platform"))};function yl(e,i){var r=e.keyStatuses;r.size=i==null?0:1,r.g=i,i=new fe("keystatuseschange"),e.dispatchEvent(i)}function $y(){this.size=0,this.g=void 0}p=$y.prototype,p.Eb=function(){return this.g},p.forEach=function(e){this.g&&e(this.g,ga.value())},p.get=function(e){if(this.has(e))return this.g},p.has=function(e){var i=ga.value();return!!(this.g&&Fr(e,i))},p.entries=function(){},p.keys=function(){},p.values=function(){};function Yy(){}function Ky(){!u.HTMLVideoElement||navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration||(navigator.requestMediaKeySystemAccess=IC,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=RC,u.MediaKeys=$c,u.MediaKeySystemAccess=Yc,u.shakaMediaKeysPolyfill=!0)}function IC(){return Promise.reject(Error("The key system specified is not supported."))}function RC(e){return e==null?Promise.resolve():Promise.reject(Error("MediaKeys not supported."))}pt.PatchedMediaKeysNop=Yy,Yy.install=Ky;function $c(){throw new TypeError("Illegal constructor.")}$c.prototype.createSession=function(){},$c.prototype.setServerCertificate=function(){};function Yc(){throw this.keySystem="",new TypeError("Illegal constructor.")}Yc.prototype.getConfiguration=function(){},Yc.prototype.createMediaKeys=function(){},At(Ky,-10);function Zy(){}function Qy(){if(!(!u.HTMLVideoElement||navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration)){if(HTMLMediaElement.prototype.webkitGenerateKeyRequest)ed="webkit";else if(!HTMLMediaElement.prototype.generateKeyRequest)return;navigator.requestMediaKeySystemAccess=LC,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=MC,u.MediaKeys=vl,u.MediaKeySystemAccess=xl,u.shakaMediaKeysPolyfill=!0}}function Kc(e){var i=ed;return i?i+e.charAt(0).toUpperCase()+e.slice(1):e}function LC(e,i){try{var r=new xl(e,i);return Promise.resolve(r)}catch(s){return Promise.reject(s)}}function MC(e){var i=this.mediaKeys;return i&&i!=e&&Jy(i,null),delete this.mediaKeys,(this.mediaKeys=e)&&Jy(e,this),Promise.resolve()}pt.PatchedMediaKeysWebkit=Zy,Zy.install=Qy;function xl(e,i){this.g=this.keySystem=e;var r=!1;e=="org.w3.clearkey"&&(this.g="webkit-org.w3.clearkey",r=!1);var s=!1,o=document.getElementsByTagName("video");o=o.length?o[0]:document.createElement("video"),i=v(i);for(var l=i.next();!l.done;l=i.next()){l=l.value;var h={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:l.initDataTypes,sessionTypes:["temporary"],label:l.label},d=!1;if(l.audioCapabilities)for(var g=v(l.audioCapabilities),_=g.next();!_.done;_=g.next())_=_.value,_.contentType&&(d=!0,o.canPlayType(_.contentType.split(";")[0],this.g)&&(h.audioCapabilities.push(_),s=!0));if(l.videoCapabilities)for(g=v(l.videoCapabilities),_=g.next();!_.done;_=g.next())_=_.value,_.contentType&&(d=!0,o.canPlayType(_.contentType,this.g)&&(h.videoCapabilities.push(_),s=!0));if(d||(s=o.canPlayType("video/mp4",this.g)||o.canPlayType("video/webm",this.g)),l.persistentState=="required"&&(r?(h.persistentState="required",h.sessionTypes=["persistent-license"]):s=!1),s){this.h=h;return}}throw r="Unsupported keySystem",(e=="org.w3.clearkey"||e=="com.widevine.alpha")&&(r="None of the requested configurations were supported."),e=Error(r),e.name="NotSupportedError",e.code=DOMException.NOT_SUPPORTED_ERR,e}xl.prototype.createMediaKeys=function(){var e=new vl(this.g);return Promise.resolve(e)},xl.prototype.getConfiguration=function(){return this.h};function vl(e){this.l=e,this.h=null,this.g=new je,this.i=[],this.j=new Map}function Jy(e,i){e.h=i,e.g.nb();var r=ed;i&&(e.g.C(i,r+"needkey",function(s){var o=new CustomEvent("encrypted");o.initDataType="cenc",o.initData=Jt(s.initData),e.h.dispatchEvent(o)}),e.g.C(i,r+"keymessage",function(s){var o=Zc(e,s.sessionId);o&&(s=new Map().set("messageType",o.keyStatuses.Eb()==null?"licenserequest":"licenserenewal").set("message",s.message),s=new fe("message",s),o.h&&(o.h.resolve(),o.h=null),o.dispatchEvent(s))}),e.g.C(i,r+"keyadded",function(s){(s=Zc(e,s.sessionId))&&(Tl(s,"usable"),s.g&&s.g.resolve(),s.g=null)}),e.g.C(i,r+"keyerror",function(s){var o=Zc(e,s.sessionId);o&&o.handleError(s)}))}vl.prototype.createSession=function(e){if(e=e||"temporary",e!="temporary"&&e!="persistent-license")throw new TypeError("Session type "+e+" is unsupported on this platform.");var i=this.h||document.createElement("video");return i.src||(i.src="about:blank"),e=new Qc(i,this.l,e),this.i.push(e),e},vl.prototype.setServerCertificate=function(){return Promise.resolve(!1)};function Zc(e,i){var r=e.j.get(i);return r||((r=e.i.shift())?(r.sessionId=i,e.j.set(i,r),r):null)}function Qc(e,i,r){Le.call(this),this.j=e,this.m=!1,this.g=this.h=null,this.i=i,this.l=r,this.sessionId="",this.expiration=NaN,this.closed=new Ve,this.keyStatuses=new tx}me(Qc,Le),p=Qc.prototype,p.handleError=function(e){var i=Error("EME v0.1b key error"),r=e.errorCode;r.systemCode=e.systemCode,i.errorCode=r,!e.sessionId&&this.h?(e.systemCode==45&&(i.message="Unsupported session type."),this.h.reject(i),this.h=null):e.sessionId&&this.g?(this.g.reject(i),this.g=null):(i=e.systemCode,e.errorCode.code==MediaKeyError.MEDIA_KEYERR_OUTPUT?Tl(this,"output-restricted"):i==1?Tl(this,"expired"):Tl(this,"internal-error"))};function ex(e,i,r){if(e.m)return Promise.reject(Error("The session is already initialized."));e.m=!0;try{if(e.l=="persistent-license")if(r)var s=Ee(mr("LOAD_SESSION|"+r));else{var o=mr("PERSISTENT|");s=Es(o,i)}else s=Ee(i)}catch(h){return Promise.reject(h)}e.h=new Ve;var l=Kc("generateKeyRequest");try{e.j[l](e.i,s)}catch(h){if(h.name!="InvalidStateError")return e.h=null,Promise.reject(h);new we(function(){try{e.j[l](e.i,s)}catch(d){e.h.reject(d),e.h=null}}).N(.01)}return e.h}function Jc(e,i,r){if(e.g)e.g.then(function(){return Jc(e,i,r)}).catch(function(){return Jc(e,i,r)});else{if(e.g=i,e.i=="webkit-org.w3.clearkey"){var s=et(r),o=JSON.parse(s);o.keys[0].kty!="oct"&&(e.g.reject(Error("Response is not a valid JSON Web Key Set.")),e.g=null),s=qi(o.keys[0].k),o=qi(o.keys[0].kid)}else s=Ee(r),o=null;var l=Kc("addKey");try{e.j[l](e.i,s,o,e.sessionId)}catch(h){e.g.reject(h),e.g=null}}}function Tl(e,i){var r=e.keyStatuses;r.size=i==null?0:1,r.g=i,i=new fe("keystatuseschange"),e.dispatchEvent(i)}p.generateRequest=function(e,i){return ex(this,i,null)},p.load=function(e){return this.l=="persistent-license"?ex(this,null,e):Promise.reject(Error("Not a persistent session."))},p.update=function(e){var i=new Ve;return Jc(this,i,e),i},p.close=function(){if(this.l!="persistent-license"){if(!this.sessionId)return this.closed.reject(Error("The session is not callable.")),this.closed;var e=Kc("cancelKeyRequest");try{this.j[e](this.i,this.sessionId)}catch(i){}}return this.closed.resolve(),this.closed},p.remove=function(){return this.l!="persistent-license"?Promise.reject(Error("Not a persistent session.")):this.close()};function tx(){this.size=0,this.g=void 0}p=tx.prototype,p.Eb=function(){return this.g},p.forEach=function(e){this.g&&e(this.g,ga.value())},p.get=function(e){if(this.has(e))return this.g},p.has=function(e){var i=ga.value();return!!(this.g&&Fr(e,i))},p.entries=function(){},p.keys=function(){},p.values=function(){};var ed="";At(Qy);function ix(){}function rx(){if(u.HTMLVideoElement){var e=HTMLVideoElement.prototype;e.requestPictureInPicture&&document.exitPictureInPicture||!e.webkitSupportsPresentationMode||(document.pictureInPictureEnabled=!0,document.pictureInPictureElement=null,e.requestPictureInPicture=kC,Object.defineProperty(e,"disablePictureInPicture",{get:OC,set:FC,enumerable:!0,configurable:!0}),document.exitPictureInPicture=DC,document.addEventListener("webkitpresentationmodechanged",PC,!0))}}function PC(e){if(e=e.target,e.webkitPresentationMode=="picture-in-picture"){document.pictureInPictureElement=e;var i=new Event("enterpictureinpicture");e.dispatchEvent(i)}else document.pictureInPictureElement==e&&(document.pictureInPictureElement=null),i=new Event("leavepictureinpicture"),e.dispatchEvent(i)}function kC(){return this.webkitSupportsPresentationMode("picture-in-picture")?(this.webkitSetPresentationMode("picture-in-picture"),document.pictureInPictureElement=this,Promise.resolve()):Promise.reject(Error("PiP not allowed by video element"))}function DC(){var e=document.pictureInPictureElement;return e?(e.webkitSetPresentationMode("inline"),document.pictureInPictureElement=null,Promise.resolve()):Promise.reject(Error("No picture in picture element found"))}function OC(){return this.hasAttribute("disablePictureInPicture")?!0:!this.webkitSupportsPresentationMode("picture-in-picture")}function FC(e){e?this.setAttribute("disablePictureInPicture",""):this.removeAttribute("disablePictureInPicture")}pt.PiPWebkit=ix,ix.install=rx,At(rx);function nx(){}function sx(){u.crypto&&("randomUUID"in u.crypto||(u.crypto.randomUUID=NC))}function NC(){var e=URL.createObjectURL(new Blob),i=e.toString();return URL.revokeObjectURL(e),i.substr(i.lastIndexOf("/")+1)}pt.RandomUUID=nx,nx.install=sx,At(sx);function ox(){}function ax(){navigator.storage&&navigator.storage.estimate||!navigator.webkitTemporaryStorage||!navigator.webkitTemporaryStorage.queryUsageAndQuota||("storage"in navigator||(navigator.storage={}),navigator.storage.estimate=UC)}function UC(){return new Promise(function(e,i){navigator.webkitTemporaryStorage.queryUsageAndQuota(function(r,s){e({usage:r,quota:s})},i)})}pt.StorageEstimate=ox,ox.install=ax,At(ax);function lx(){}function ux(){var e=Symbol.prototype;"description"in e||Object.defineProperty(e,"description",{get:zC})}function zC(){var e=/\((.*)\)/.exec(this.toString());return e?e[1]:void 0}pt.Symbol=lx,lx.install=ux,At(ux);function hx(){}function cx(){if(u.HTMLMediaElement){var e=HTMLMediaElement.prototype.play;HTMLMediaElement.prototype.play=function(){var i=e.apply(this);return i&&i.catch(function(){}),i}}}pt.VideoPlayPromise=hx,hx.install=cx,At(cx);function dx(){}function fx(){if(u.HTMLVideoElement){var e=HTMLVideoElement.prototype;!e.getVideoPlaybackQuality&&("webkitDroppedFrameCount"in e||Gf())&&(e.getVideoPlaybackQuality=BC)}}function BC(){return{droppedVideoFrames:this.webkitDroppedFrameCount,totalVideoFrames:this.webkitDecodedFrameCount,corruptedVideoFrames:0,creationTime:NaN,totalFrameDelay:0}}pt.VideoPlaybackQuality=dx,dx.install=fx,At(fx);function px(){}function gx(){if(!u.VTTCue&&u.TextTrackCue){var e=null,i=TextTrackCue.length;if(i==3)e=td;else if(i==6)e=jC;else{try{var r=!!td(1,2,"")}catch(s){r=!1}r&&(e=td)}e&&(u.VTTCue=function(s,o,l){return e(s,o,l)})}}function td(e,i,r){return new u.TextTrackCue(e,i,r)}function jC(e,i,r){return new u.TextTrackCue(e+"-"+i+"-"+r,e,i,r)}pt.VTTCue=px,px.install=gx,At(gx);function Ai(){}Ai.prototype.parseInit=function(){},Ai.prototype.setSequenceMode=function(){},Ai.prototype.parseMedia=function(e,i){var r=null,s=[];e=et(e).split(/\r?\n/),e=v(e);for(var o=e.next();!o.done;o=e.next())if((o=o.value)&&!/^\s+$/.test(o)&&(o=HC.exec(o))){var l=VC.exec(o[1]);l=60*parseInt(l[1],10)+parseFloat(l[2].replace(",",".")),o=new Be(l,i.segmentEnd?i.segmentEnd:l+2,o[2]),r&&(r.endTime=l,s.push(r)),r=o}return r&&s.push(r),s},te("shaka.text.LrcTextParser",Ai),Ai.prototype.parseMedia=Ai.prototype.parseMedia,Ai.prototype.setSequenceMode=Ai.prototype.setSequenceMode,Ai.prototype.parseInit=Ai.prototype.parseInit;var HC=/^\[(\d{1,2}:\d{1,2}(?:[.,]\d{1,3})?)\](.*)/,VC=/^(\d+):(\d{1,2}(?:[.,]\d{1,3})?)$/;ft["application/x-subtitle-lrc"]=function(){return new Ai};function ui(){}ui.prototype.parseInit=function(){},ui.prototype.setSequenceMode=function(){},ui.prototype.parseMedia=function(e,i){var r=et(e);if(e=[],r=="")return e;var s=ks(r,"tt");if(!s)throw new F(2,2,2005,"Failed to parse TTML.");if(r=s.getElementsByTagName("body")[0],!r)return[];var o=Zi(s,ho,"frameRate"),l=Zi(s,ho,"subFrameRate"),h=Zi(s,ho,"frameRateMultiplier"),d=Zi(s,ho,"tickRate"),g=Zi(s,ho,"cellResolution"),_=s.getAttribute("xml:space")||"default",y=Zi(s,Al,"extent");if(_!="default"&&_!="preserve")throw new F(2,2,2005,"Invalid xml:space value: "+_);_=_=="default",o=new XC(o,l,h,d),g=g&&(g=/^(\d+) (\d+)$/.exec(g))?{columns:parseInt(g[1],10),rows:parseInt(g[2],10)}:null,l=(l=s.getElementsByTagName("metadata")[0])?oS(l):[],h=Array.from(s.getElementsByTagName("style")),s=Array.from(s.getElementsByTagName("region")),d=[];for(var S=v(s),w=S.next();!w.done;w=S.next()){var E=w.value;w=new Tn;var R=E.getAttribute("xml:id");if(R){w.id=R;var P=null;y&&(P=sd.exec(y)||od.exec(y)),R=P?Number(P[1]):null,P=P?Number(P[2]):null;var L,M;(L=Sl(E,h,"extent"))&&(L=(M=sd.exec(L))||od.exec(L),L!=null&&(w.width=Number(L[1]),w.height=Number(L[2]),M||(R!=null&&(w.width=100*w.width/R),P!=null&&(w.height=100*w.height/P)),w.widthUnits=M||R!=null?Mi:0,w.heightUnits=M||P!=null?Mi:0)),(E=Sl(E,h,"origin"))&&(L=(M=sd.exec(E))||od.exec(E),L!=null&&(w.viewportAnchorX=Number(L[1]),w.viewportAnchorY=Number(L[2]),M||(P!=null&&(w.viewportAnchorY=100*w.viewportAnchorY/P),R!=null&&(w.viewportAnchorX=100*w.viewportAnchorX/R)),w.viewportAnchorUnits=M||R!=null?Mi:0))}else w=null;w&&d.push(w)}if(Qe(r,"p").length)throw new F(2,2,2001,"<p> can only be inside <div> in TTML");for(y=v(Qe(r,"div")),S=y.next();!S.done;S=y.next())if(Qe(S.value,"span").length)throw new F(2,2,2001,"<span> can only be inside <p> in TTML");return(i=mx(r,i,o,l,h,s,d,_,g,null,!1))&&(i.backgroundColor||(i.backgroundColor="transparent"),e.push(i)),e};function mx(e,i,r,s,o,l,h,d,g,_,y){var S=e.parentNode;if(e.nodeType==Node.COMMENT_NODE)return null;if(e.nodeType==Node.TEXT_NODE){if(!y)return null;var w=document.createElement("span");w.textContent=e.textContent}else w=e;for(var E=null,R=v(KC),P=R.next();!P.done&&!(E=wl(w,"backgroundImage",s,"#",P.value)[0]);P=R.next());if(R=y,(e.nodeName=="p"||E)&&(y=!0),d=(w.getAttribute("xml:space")||(d?"default":"preserve"))=="default",P=Array.from(w.childNodes).every(function(N){return N.nodeType==Node.TEXT_NODE}),e=[],!P)for(var L=v(w.childNodes),M=L.next();!M.done;M=L.next())(M=mx(M.value,i,r,s,o,l,h,d,g,w,y))&&e.push(M);s=_!=null,L=/\S/.test(w.textContent);var U=w.hasAttribute("begin")||w.hasAttribute("end")||w.hasAttribute("dur");if(!(U||L||w.tagName=="br"||e.length!=0||s&&!d))return null;for(M=xx(w,r),L=M.start,M=M.end;S&&S.nodeType==Node.ELEMENT_NODE&&S.tagName!="tt";)M=GC(S,r,L,M),L=M.start,M=M.end,S=S.parentNode;if(L==null&&(L=0),L+=i.periodStart,M=M==null?1/0:M+i.periodStart,L=Math.max(L,i.segmentStart),M=Math.min(M,i.segmentEnd),!U&&0<e.length)for(L=1/0,M=0,i=v(e),r=i.next();!r.done;r=i.next())r=r.value,L=Math.min(L,r.startTime),M=Math.max(M,r.endTime);if(w.tagName=="br")return o=new Be(L,M,""),o.lineBreak=!0,o;if(i="",P&&(i=w.textContent,d&&(i=i.trim(),i=i.replace(/\s+/g," "))),i=new Be(L,M,i),i.nestedCues=e,y||(i.isContainer=!0),g&&(i.cellResolution=g),g=wl(w,"region",l,"")[0],w.hasAttribute("region")&&g&&g.getAttribute("xml:id")){var k=g.getAttribute("xml:id");i.region=h.filter(function(N){return N.id==k})[0]}return h=g,_&&s&&!w.getAttribute("region")&&!w.getAttribute("style")&&(h=wl(_,"region",l,"")[0]),WC(i,w,h,E,o,R,e.length==0),i}function WC(e,i,r,s,o,l,h){if(l=l||h,Et(i,r,o,"direction",l)=="rtl"&&(e.direction="rtl"),h=Et(i,r,o,"writingMode",l),h=="tb"||h=="tblr"?e.writingMode="vertical-lr":h=="tbrl"?e.writingMode="vertical-rl":h=="rltb"||h=="rl"?e.direction="rtl":h&&(e.direction=Su),(h=Et(i,r,o,"textAlign",!0))?(e.positionAlign=YC[h],e.lineAlign=$C[h],e.textAlign=Tu[h.toUpperCase()]):e.textAlign=Xi,(h=Et(i,r,o,"displayAlign",!0))&&(e.displayAlign=Ff[h.toUpperCase()]),(h=Et(i,r,o,"color",l))&&(e.color=h),(h=Et(i,r,o,"backgroundColor",l))&&(e.backgroundColor=h),(h=Et(i,r,o,"border",l))&&(e.border=h),h=Et(i,r,o,"fontFamily",l))switch(h){case"monospaceSerif":e.fontFamily="Courier New,Liberation Mono,Courier,monospace";break;case"proportionalSansSerif":e.fontFamily="Arial,Helvetica,Liberation Sans,sans-serif";break;case"sansSerif":e.fontFamily="sans-serif";break;case"monospaceSansSerif":e.fontFamily="Consolas,monospace";break;case"proportionalSerif":e.fontFamily="serif";break;default:e.fontFamily=h}if((h=Et(i,r,o,"fontWeight",l))&&h=="bold"&&(e.fontWeight=700),h=Et(i,r,o,"wrapOption",l),e.wrapLine=!(h&&h=="noWrap"),(h=Et(i,r,o,"lineHeight",l))&&h.match(ts)&&(e.lineHeight=h),(h=Et(i,r,o,"fontSize",l))&&(h.match(ts)||h.match(qC))&&(e.fontSize=h),(h=Et(i,r,o,"fontStyle",l))&&(e.fontStyle=Bf[h.toUpperCase()]),s){h=s.getAttribute("imageType")||s.getAttribute("imagetype");var d=s.getAttribute("encoding");s=s.textContent.trim(),h=="PNG"&&d=="Base64"&&s&&(e.backgroundImage="data:image/png;base64,"+s)}(s=Et(i,r,o,"textOutline",l))&&(s=s.split(" "),s[0].match(ts)?e.textStrokeColor=e.color:(e.textStrokeColor=s[0],s.shift()),s[0]&&s[0].match(ts)?e.textStrokeWidth=s[0]:e.textStrokeColor=""),(s=Et(i,r,o,"letterSpacing",l))&&s.match(ts)&&(e.letterSpacing=s),(s=Et(i,r,o,"linePadding",l))&&s.match(ts)&&(e.linePadding=s),(l=Et(i,r,o,"opacity",l))&&(e.opacity=parseFloat(l)),(r=Sl(r,o,"textDecoration"))&&_x(e,r),(i=id(i,o,"textDecoration"))&&_x(e,i)}function _x(e,i){i=v(i.split(" "));for(var r=i.next();!r.done;r=i.next())switch(r.value){case"underline":e.textDecoration.includes("underline")||e.textDecoration.push("underline");break;case"noUnderline":e.textDecoration.includes("underline")&&yi(e.textDecoration,"underline");break;case"lineThrough":e.textDecoration.includes("lineThrough")||e.textDecoration.push("lineThrough");break;case"noLineThrough":e.textDecoration.includes("lineThrough")&&yi(e.textDecoration,"lineThrough");break;case"overline":e.textDecoration.includes("overline")||e.textDecoration.push("overline");break;case"noOverline":e.textDecoration.includes("overline")&&yi(e.textDecoration,"overline")}}function Et(e,i,r,s,o){return o=o===void 0?!0:o,(e=id(e,r,s))?e:o?Sl(i,r,s):null}function Sl(e,i,r){if(!e)return null;var s=Zi(e,Al,r);return s||yx(e,i,r)}function id(e,i,r){var s=Zi(e,Al,r);return s||yx(e,i,r)}function yx(e,i,r){e=wl(e,"style",i,"");for(var s=null,o=0;o<e.length;o++){var l=Gr(e[o],"urn:ebu:tt:style",r);l||(l=Zi(e[o],Al,r)),l||(l=id(e[o],i,r)),l&&(s=l)}return s}function wl(e,i,r,s,o){var l=[];if(!e||1>r.length)return l;var h=e;for(e=null;h&&!(e=o?Gr(h,o,i):h.getAttribute(i))&&(h=h.parentNode,h instanceof Element););if(i=e){for(i=v(i.split(" ")),o=i.next();!o.done;o=i.next())for(o=o.value,e=v(r),h=e.next();!h.done;h=e.next())if(h=h.value,s+h.getAttribute("xml:id")==o){l.push(h);break}}return l}function GC(e,i,r,s){return e=xx(e,i),r==null?r=e.start:e.start!=null&&(r+=e.start),s==null?s=e.end:e.start!=null&&(s+=e.start),{start:r,end:s}}function xx(e,i){var r=rd(e.getAttribute("begin"),i),s=rd(e.getAttribute("end"),i);return e=rd(e.getAttribute("dur"),i),s==null&&e!=null&&(s=r+e),{start:r,end:s}}function rd(e,i){var r=null;if(vx.test(e)){e=vx.exec(e),r=Number(e[1]);var s=Number(e[2]),o=Number(e[3]),l=Number(e[4]);l+=(Number(e[5])||0)/i.h,o+=l/i.frameRate,r=o+60*s+3600*r}else if(Tx.test(e))r=nd(Tx,e);else if(Sx.test(e))r=nd(Sx,e);else if(wx.test(e))e=wx.exec(e),r=Number(e[1])/i.frameRate;else if(Ax.test(e))e=Ax.exec(e),r=Number(e[1])/i.g;else if(Ex.test(e))r=nd(Ex,e);else if(e)throw new F(2,2,2001,"Could not parse cue time range in TTML");return r}function nd(e,i){return e=e.exec(i),e==null||e[0]==""?null:(Number(e[4])||0)/1e3+(Number(e[3])||0)+60*(Number(e[2])||0)+3600*(Number(e[1])||0)}te("shaka.text.TtmlTextParser",ui),ui.prototype.parseMedia=ui.prototype.parseMedia,ui.prototype.setSequenceMode=ui.prototype.setSequenceMode,ui.prototype.parseInit=ui.prototype.parseInit;function XC(e,i,r,s){this.frameRate=Number(e)||30,this.h=Number(i)||1,this.g=Number(s),this.g==0&&(this.g=e?this.frameRate*this.h:1),r&&(e=/^(\d+) (\d+)$/g.exec(r))&&(this.frameRate*=Number(e[1])/Number(e[2]))}var sd=/^(\d{1,2}(?:\.\d+)?|100(?:\.0+)?)% (\d{1,2}(?:\.\d+)?|100(?:\.0+)?)%$/,qC=/^(\d{1,2}(?:\.\d+)?|100)%$/,ts=/^(\d+px|\d+em|\d*\.?\d+c)$/,od=/^(\d+)px (\d+)px$/,vx=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,Tx=/^(?:(\d{2,}):)?(\d{2}):(\d{2})$/,Sx=/^(?:(\d{2,}):)?(\d{2}):(\d{2}\.\d{2,})$/,wx=/^(\d*(?:\.\d*)?)f$/,Ax=/^(\d*(?:\.\d*)?)t$/,Ex=RegExp("^(?:(\\d*(?:\\.\\d*)?)h)?(?:(\\d*(?:\\.\\d*)?)m)?(?:(\\d*(?:\\.\\d*)?)s)?(?:(\\d*(?:\\.\\d*)?)ms)?$"),$C={left:Or,center:"center",right:"end",start:Or,end:"end"},YC={left:"line-left",center:"center",right:"line-right"},ho=["http://www.w3.org/ns/ttml#parameter","http://www.w3.org/2006/10/ttaf1#parameter"],Al=["http://www.w3.org/ns/ttml#styling","http://www.w3.org/2006/10/ttaf1#styling"],KC=["http://www.smpte-ra.org/schemas/2052-1/2010/smpte-tt","http://www.smpte-ra.org/schemas/2052-1/2013/smpte-tt"];ft["application/ttml+xml"]=function(){return new ui};function Nt(){this.g=new ui}Nt.prototype.parseInit=function(e){var i=!1;if(new ze().box("moov",Ke).box("trak",Ke).box("mdia",Ke).box("minf",Ke).box("stbl",Ke).P("stsd",Ls).box("stpp",function(r){i=!0,r.parser.stop()}).parse(e),!i)throw new F(2,2,2007)},Nt.prototype.setSequenceMode=function(){},Nt.prototype.parseMedia=function(e,i){var r=this,s=!1,o=[];if(new ze().box("mdat",Fn(function(l){s=!0,o=o.concat(r.g.parseMedia(l,i))})).parse(e,!1),!s)throw new F(2,2,2007);return o},te("shaka.text.Mp4TtmlParser",Nt),Nt.prototype.parseMedia=Nt.prototype.parseMedia,Nt.prototype.setSequenceMode=Nt.prototype.setSequenceMode,Nt.prototype.parseInit=Nt.prototype.parseInit,ft['application/mp4; codecs="stpp"']=function(){return new Nt},ft['application/mp4; codecs="stpp.ttml"']=function(){return new Nt},ft['application/mp4; codecs="stpp.ttml.im1t"']=function(){return new Nt},ft['application/mp4; codecs="stpp.TTML.im1t"']=function(){return new Nt};function Ut(){this.g=!1}Ut.prototype.parseInit=function(){},Ut.prototype.setSequenceMode=function(e){this.g=e},Ut.prototype.parseMedia=function(e,i){e=et(e),e=e.replace(/\r\n|\r(?=[^\n]|$)/gm,`
`);var r=e.split(/\n{2,}/m);if(!/^WEBVTT($|[ \t\n])/m.test(r[0]))throw new F(2,2,2e3);if(e=i.vttOffset,r[0].includes("X-TIMESTAMP-MAP")&&this.g){var s=r[0].match(/LOCAL:((?:(\d{1,}):)?(\d{2}):(\d{2})\.(\d{3}))/m),o=r[0].match(/MPEGTS:(\d+)/m);if(s&&o){if(e=Cl(new en(s[1])),e==null)throw new F(2,2,2e3);for(o=Number(o[1]),s=i.segmentStart-i.periodStart;95443.7176888889<=s;)s-=95443.7176888889,o+=8589934592;e=i.periodStart+o/9e4-e}}for(i=[],o=v(r[0].split(`
`)),s=o.next();!s.done;s=o.next())if(s=s.value,/^Region:/.test(s)){s=new en(s);var l=new Tn;tn(s),Qn(s);for(var h=tn(s);h;){var d=l,g=h;(h=/^id=(.*)$/.exec(g))?d.id=h[1]:(h=/^width=(\d{1,2}|100)%$/.exec(g))?d.width=Number(h[1]):(h=/^lines=(\d+)$/.exec(g))?(d.height=Number(h[1]),d.heightUnits=2):(h=/^regionanchor=(\d{1,2}|100)%,(\d{1,2}|100)%$/.exec(g))?(d.regionAnchorX=Number(h[1]),d.regionAnchorY=Number(h[2])):(h=/^viewportanchor=(\d{1,2}|100)%,(\d{1,2}|100)%$/.exec(g))?(d.viewportAnchorX=Number(h[1]),d.viewportAnchorY=Number(h[2])):/^scroll=up$/.exec(g)&&(d.scroll="up"),Qn(s),h=tn(s)}i.push(l)}for(o=new Map,Cx(o),s=[],r=v(r.slice(1)),l=r.next();!l.done;l=r.next()){if(l=l.value.split(`
`),(l.length!=1||l[0])&&!/^NOTE($|[ \t])/.test(l[0])&&l[0]=="STYLE"){for(d=[],h=-1,g=1;g<l.length;g++)l[g].includes("::cue")&&(d.push([]),h=d.length-1),h!=-1&&(d[h].push(l[g]),l[g].includes("}")&&(h=-1));for(d=v(d),h=d.next();!h.done;h=d.next()){var _=h.value;h="global",(g=_[0].match(/\((.*)\)/))&&(h=g.pop()),g=_.slice(1,-1),_[0].includes("}")&&(_=/\{(.*?)\}/.exec(_[0]))&&(g=_[1].split(";")),(_=o.get(h))||(_=new Be(0,0,""));for(var y=!1,S=0;S<g.length;S++){var w=/^\s*([^:]+):\s*(.*)/.exec(g[S]);if(w){var E=w[2].trim().replace(";","");switch(w[1].trim()){case"background-color":case"background":y=!0,_.backgroundColor=E;break;case"color":y=!0,_.color=E;break;case"font-family":y=!0,_.fontFamily=E;break;case"font-size":y=!0,_.fontSize=E;break;case"font-weight":(700<=parseInt(E,10)||E=="bold")&&(y=!0,_.fontWeight=700);break;case"font-style":switch(E){case"normal":y=!0,_.fontStyle=Eu;break;case"italic":y=!0,_.fontStyle="italic";break;case"oblique":y=!0,_.fontStyle="oblique"}break;case"opacity":y=!0,_.opacity=parseFloat(E);break;case"text-shadow":y=!0,_.textShadow=E;break;case"white-space":y=!0,_.wrapLine=E!="noWrap"}}}y&&o.set(h,_)}}if(y=e,l.length==1&&!l[0]||/^NOTE($|[ \t])/.test(l[0])||l[0]=="STYLE"||l[0]=="REGION")l=null;else{if(d=null,l[0].includes("-->")||(d=l[0],l.splice(0,1)),h=new en(l[0]),g=Cl(h),S=wr(h,/[ \t]+--\x3e[ \t]+/g),_=Cl(h),g==null||S==null||_==null)throw new F(2,2,2001,"Could not parse cue time range in WebVTT");for(g+=y,_+=y,y=l.slice(1).join(`
`).trim(),o.has("global")?(l=o.get("global").clone(),l.startTime=g,l.endTime=_,l.payload=""):l=new Be(g,_,""),bx(y,l,o),Qn(h),g=tn(h);g;)Rx(l,g,i),Qn(h),g=tn(h);d!=null&&(l.id=d)}l&&s.push(l)}return s};function Cx(e){for(var i=v(Object.entries(Nf)),r=i.next();!r.done;r=i.next()){var s=v(r.value);r=s.next().value,s=s.next().value;var o=new Be(0,0,"");o.color=s,e.set("."+r,o)}for(i=v(Object.entries(Uf)),r=i.next();!r.done;r=i.next())s=v(r.value),r=s.next().value,s=s.next().value,o=new Be(0,0,""),o.backgroundColor=s,e.set("."+r,o)}function bx(e,i,r){r.size===0&&Cx(r);e:{var s=e;e=[];for(var o=-1,l="",h=0;h<s.length;h++)if(s[h]==="/"&&0<h&&s[h-1]==="<"){var d=s.indexOf(">",h);if(d<=h){e=s;break e}if((d=s.substring(h+1,d))&&d==="c"){var g=e.pop();g?g===d?(l+="/"+d+">",h+=d.length+1):g.startsWith("c.")?(h+=d.length+1,l+="/"+g+">"):l+=s[h]:l+=s[h]}else l+=s[h]}else s[h]==="<"?(o=h+1,s[o]!="c"&&(o=-1)):s[h]===">"&&0<o&&(e.push(s.substr(o,h-o)),o=-1),l+=s[h];e=l}for(s=[],l=-1,o=0;o<e.length;o++)e[o]==="<"?l=o+1:e[o]===">"&&0<l&&(l=e.substr(l,o-l),l.match(Lx)&&s.push(l),l=-1);for(s=v(s),o=s.next();!o.done;o=s.next())o=o.value,e=e.replace("<"+o+">",'<div time="'+o+'">'),e+="</div>";e:{for(o=e,l=[],h=-1,s="",e=!1,d=0;d<o.length;d++)if(o[d]==="/"){if(g=o.indexOf(">",d),g===-1){e=o;break e}if((g=o.substring(d+1,g))&&g=="v"){e=!0;var _=null;if(l.length&&(_=l[l.length-1]),_){if(_===g)s+="/"+g+">";else{if(!_.startsWith("v")){s+=o[d];continue}s+="/"+_+">"}d+=g.length+1}else s+=o[d]}else s+=o[d]}else o[d]==="<"?(h=d+1,o[h]!="v"&&(h=-1)):o[d]===">"&&0<h&&(l.push(o.substr(h,d-h)),h=-1),s+=o[d];for(o=v(l),l=o.next();!l.done;l=o.next())l=l.value,h=l.replace(" ",".voice-"),s=s.replace("<"+l+">","<"+h+">"),s=s.replace("</"+l+">","</"+h+">"),e||(s+="</"+h+">");e=s}if(o=ks("<span>"+e+"</span>","span")){if(s=[],o=o.childNodes,o.length==1&&(l=o[0],l.nodeType==Node.TEXT_NODE||l.nodeType==Node.CDATA_SECTION_NODE)){i.payload=ad(e);return}for(e=v(o),o=e.next();!o.done;o=e.next())Ix(o.value,i,s,r);i.nestedCues=s}else i.payload=ad(e)}function El(e,i){return e&&0<e.length?e:i}function Ix(e,i,r,s){var o=i.clone();if(e.nodeType===Node.ELEMENT_NODE&&e.nodeName)for(var l=v(e.nodeName.split(/(?=[ .])+/g)),h=l.next();!h.done;h=l.next()){var d=h=h.value;if(d.startsWith(".voice-")){var g=d.split("-").pop();d='v[voice="'+g+'"]',s.has(d)||(d="v[voice="+g+"]")}switch(s.has(d)&&(d=s.get(d))&&(o.backgroundColor=El(d.backgroundColor,o.backgroundColor),o.color=El(d.color,o.color),o.fontFamily=El(d.fontFamily,o.fontFamily),o.fontSize=El(d.fontSize,o.fontSize),o.fontWeight=d.fontWeight,o.fontStyle=d.fontStyle,o.opacity=d.opacity,o.wrapLine=d.wrapLine),h){case"br":h=i.clone(),h.lineBreak=!0,r.push(h);break;case"b":o.fontWeight=700;break;case"i":o.fontStyle="italic";break;case"u":o.textDecoration.push("underline");break;case"div":(h=e.getAttribute("time"))&&(h=Cl(new en(h)))&&(o.startTime=h)}}if(Bp(e))for(l=!0,s=v(e.textContent.split(`
`)),e=s.next();!e.done;e=s.next())e=e.value,l||(l=i.clone(),l.lineBreak=!0,r.push(l)),0<e.length&&(l=o.clone(),l.payload=ad(e),r.push(l)),l=!1;else for(i=v(e.childNodes),e=i.next();!e.done;e=i.next())Ix(e.value,o,r,s)}function Rx(e,i,r){var s;(s=/^align:(start|middle|center|end|left|right)$/.exec(i))?(i=s[1],i=="middle"?e.textAlign=Xi:e.textAlign=Tu[i.toUpperCase()]):(s=/^vertical:(lr|rl)$/.exec(i))?e.writingMode=s[1]=="lr"?"vertical-lr":"vertical-rl":(s=/^size:([\d.]+)%$/.exec(i))?e.size=Number(s[1]):(s=/^position:([\d.]+)%(?:,(line-left|line-right|center|start|end))?$/.exec(i))?(e.position=Number(s[1]),s[2]&&(i=s[2],e.positionAlign=i=="line-left"||i=="start"?"line-left":i=="line-right"||i=="end"?"line-right":"center")):(s=/^region:(.*)$/.exec(i))?(i=ZC(r,s[1]))&&(e.region=i):(r=/^line:([\d.]+)%(?:,(start|end|center))?$/.exec(i))?(e.lineInterpretation=1,e.line=Number(r[1]),r[2]&&(e.lineAlign=Au[r[2].toUpperCase()])):(r=/^line:(-?\d+)(?:,(start|end|center))?$/.exec(i))&&(e.lineInterpretation=wu,e.line=Number(r[1]),r[2]&&(e.lineAlign=Au[r[2].toUpperCase()]))}function ZC(e,i){return e=e.filter(function(r){return r.id==i}),e.length?e[0]:null}function Cl(e){if(e=wr(e,Lx),e==null)return null;var i=Number(e[2]),r=Number(e[3]);return 59<i||59<r?null:Number(e[4])/1e3+r+60*i+3600*(Number(e[1])||0)}function ad(e){var i={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&nbsp;":"","&lrm;":"","&rlm;":""},r=/&(?:amp|lt|gt|quot|#(0+)?39|nbsp|lrm|rlm);/g,s=RegExp(r.source);return e&&s.test(e)?e.replace(r,function(o){return i[o]||"'"}):e||""}te("shaka.text.VttTextParser",Ut),Ut.prototype.parseMedia=Ut.prototype.parseMedia,Ut.prototype.setSequenceMode=Ut.prototype.setSequenceMode,Ut.prototype.parseInit=Ut.prototype.parseInit;var Lx=/(?:(\d{1,}):)?(\d{2}):(\d{2})\.(\d{2,3})/g;ft["text/vtt"]=function(){return new Ut},ft['text/vtt; codecs="vtt"']=function(){return new Ut},ft['text/vtt; codecs="wvtt"']=function(){return new Ut};function Ei(){this.g=null}Ei.prototype.parseInit=function(e){var i=this,r=!1;if(new ze().box("moov",Ke).box("trak",Ke).box("mdia",Ke).P("mdhd",function(s){s=sh(s.reader,s.version),i.g=s.timescale}).box("minf",Ke).box("stbl",Ke).P("stsd",Ls).box("wvtt",function(){r=!0}).parse(e),!this.g)throw new F(2,2,2008);if(!r)throw new F(2,2,2008)},Ei.prototype.setSequenceMode=function(){},Ei.prototype.parseMedia=function(e,i){if(!this.g)throw new F(2,2,2008);var r=0,s=[],o,l=[],h=!1,d=!1,g=!1,_=null;if(new ze().box("moof",Ke).box("traf",Ke).P("tfdt",function(k){h=!0,r=wg(k.reader,k.version).we}).P("tfhd",function(k){_=Sg(k.reader,k.flags).Ce}).P("trun",function(k){d=!0,s=Ag(k.reader,k.version,k.flags).Re}).box("mdat",Fn(function(k){g=!0,o=k})).parse(e,!1),!g&&!h&&!d)throw new F(2,2,2008);e=r;for(var y=new Oe(o,0),S=v(s),w=S.next();!w.done;w=S.next()){w=w.value;var E=w.ee||_,R=w.ed?r+w.ed:e;e=R+(E||0);var P=0;do{var L=y.K();P+=L;var M=y.K(),U=null;oa(M)=="vttc"?8<L&&(U=y.Za(L-8)):y.skip(L-8),E&&U&&(L=QC(U,i.periodStart+R/this.g,i.periodStart+e/this.g),l.push(L))}while(w.sampleSize&&P<w.sampleSize)}return l.filter(pr)};function QC(e,i,r){var s,o,l;return new ze().box("payl",Fn(function(h){s=et(h)})).box("iden",Fn(function(h){o=et(h)})).box("sttg",Fn(function(h){l=et(h)})).parse(e),s?JC(s,o,l,i,r):null}function JC(e,i,r,s,o){if(s=new Be(s,o,""),bx(e,s,new Map),i&&(s.id=i),r)for(e=new en(r),i=tn(e);i;)Rx(s,i,[]),Qn(e),i=tn(e);return s}te("shaka.text.Mp4VttParser",Ei),Ei.prototype.parseMedia=Ei.prototype.parseMedia,Ei.prototype.setSequenceMode=Ei.prototype.setSequenceMode,Ei.prototype.parseInit=Ei.prototype.parseInit,ft['application/mp4; codecs="wvtt"']=function(){return new Ei};function Ci(){}Ci.prototype.parseInit=function(){},Ci.prototype.setSequenceMode=function(){},Ci.prototype.parseMedia=function(e){var i=et(e).replace(/\r+/g,"");if(i=i.trim(),e=[],i=="")return e;i=v(i.split(`

`));for(var r=i.next();!r.done;r=i.next()){r=r.value.split(`
`);var s=new en(r[0]),o=Mx(s),l=wr(s,/,/g);if(s=Mx(s),o==null||l==null||s==null)throw new F(2,2,2001,"Could not parse cue time range in SubViewer");e.push(new Be(o,s,r.slice(1).join(`
`).trim()))}return e};function Mx(e){if(e=wr(e,/(?:(\d{1,}):)?(\d{2}):(\d{2})\.(\d{2,3})/g),e==null)return null;var i=Number(e[2]),r=Number(e[3]);return 59<i||59<r?null:Number(e[4])/1e3+r+60*i+3600*(Number(e[1])||0)}te("shaka.text.SbvTextParser",Ci),Ci.prototype.parseMedia=Ci.prototype.parseMedia,Ci.prototype.setSequenceMode=Ci.prototype.setSequenceMode,Ci.prototype.parseInit=Ci.prototype.parseInit,ft["text/x-subviewer"]=function(){return new Ci};function hi(){this.g=new Ut}hi.prototype.parseInit=function(){},hi.prototype.setSequenceMode=function(){},hi.prototype.parseMedia=function(e,i){return e=et(e),e=Px(e),e=Ee(mr(e)),this.g.parseMedia(e,i)};function Px(e){var i=`WEBVTT

`;if(e=="")return i;e=e.replace(/\r+/g,""),e=e.trim(),e=v(e.split(`

`));for(var r=e.next();!r.done;r=e.next())r=r.value.split(/\n/),r[0].match(/\d+/)&&r.shift(),r[0]=r[0].replace(/,/g,"."),i+=r.join(`
`)+`

`;return i}te("shaka.text.SrtTextParser",hi),hi.srt2webvtt=Px,hi.prototype.parseMedia=hi.prototype.parseMedia,hi.prototype.setSequenceMode=hi.prototype.setSequenceMode,hi.prototype.parseInit=hi.prototype.parseInit,ft["text/srt"]=function(){return new hi};function bi(){}bi.prototype.parseInit=function(){},bi.prototype.setSequenceMode=function(){},bi.prototype.parseMedia=function(e){var i="",r="";e=et(e).split(/\r?\n\s*\r?\n/),e=v(e);for(var s=e.next();!s.done;s=e.next()){var o=tb.exec(s.value);o&&(s=o[1],o=o[2],s=="V4 Styles"||s=="V4+ Styles"?i=o:s=="Events"&&(r=o))}e=[],s=null,i=v(i.split(/\r?\n/));for(var l=i.next();!l.done;l=i.next())if(o=l.value,!/^\s*;/.test(o)&&(l=Ox.exec(o))){if(o=l[1].trim(),l=l[2].trim(),o=="Format")s=l.split(bl);else if(o=="Style"){o=l.split(bl),l={};for(var h=0;h<s.length&&h<o.length;h++)l[s[h]]=o[h];e.push(l)}}for(s=[],i=null,o={},r=v(r.split(/\r?\n/)),l=r.next();!l.done;o={vd:o.vd},l=r.next())if(l=l.value,!/^\s*;/.test(l)&&(h=Ox.exec(l))){if(l=h[1].trim(),h=h[2].trim(),l=="Format")i=h.split(bl);else if(l=="Dialogue"){h=h.split(bl),l={};for(var d=0;d<i.length&&d<h.length;d++)l[i[d]]=h[d];d=Dx(l.Start);var g=Dx(l.End);h=new Be(d,g,h.slice(i.length-1).join(",").replace(/\\N/g,`
`).replace(/\{[^}]+\}/g,"")),o.vd=l.Style,(l=e.find(function(_){return function(y){return y.Name==_.vd}}(o)))&&eb(h,l),s.push(h)}}return s};function eb(e,i){var r=i.Fontname;if(r&&(e.fontFamily=r),(r=i.Fontsize)&&(e.fontSize=r+"px"),(r=i.PrimaryColour)&&(r=kx(r))&&(e.color=r),(r=i.BackColour)&&(r=kx(r))&&(e.backgroundColor=r),i.Bold&&(e.fontWeight=700),i.Italic&&(e.fontStyle="italic"),i.Underline&&e.textDecoration.push("underline"),(r=i.Spacing)&&(e.letterSpacing=r+"px"),r=i.Alignment)switch(parseInt(r,10)){case 1:e.displayAlign=ps,e.textAlign="start";break;case 2:e.displayAlign=ps,e.textAlign=Xi;break;case 3:e.displayAlign=ps,e.textAlign="end";break;case 5:e.displayAlign="before",e.textAlign="start";break;case 6:e.displayAlign="before",e.textAlign=Xi;break;case 7:e.displayAlign="before",e.textAlign="end";break;case 9:e.displayAlign="center",e.textAlign="start";break;case 10:e.displayAlign="center",e.textAlign=Xi;break;case 11:e.displayAlign="center",e.textAlign="end"}(i=i.AlphaLevel)&&(e.opacity=parseFloat(i))}function kx(e){return e=parseInt(e.replace("&H",""),16),0<=e?"rgba("+(e&255)+","+(e>>8&255)+","+(e>>16&255)+","+(e>>24&255^255)/255+")":null}function Dx(e){return e=ib.exec(e),3600*(e[1]?parseInt(e[1].replace(":",""),10):0)+60*parseInt(e[2],10)+parseFloat(e[3])}te("shaka.text.SsaTextParser",bi),bi.prototype.parseMedia=bi.prototype.parseMedia,bi.prototype.setSequenceMode=bi.prototype.setSequenceMode,bi.prototype.parseInit=bi.prototype.parseInit;var tb=/^\s*\[([^\]]+)\]\r?\n([\s\S]*)/,Ox=/^\s*([^:]+):\s*(.*)/,bl=/\s*,\s*/,ib=/^(\d+:)?(\d{1,2}):(\d{1,2}(?:[.]\d{1,3})?)?$/;ft["text/x-ssa"]=function(){return new bi};/*
 @license
 EME Encryption Scheme Polyfill
 Copyright 2019 Google LLC
 SPDX-License-Identifier: Apache-2.0
*/function Fx(){}var co;function Nx(){co?console.debug("EmeEncryptionSchemePolyfill: Already installed."):navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration?(co=navigator.requestMediaKeySystemAccess,console.debug("EmeEncryptionSchemePolyfill: Waiting to detect encryptionScheme support."),navigator.requestMediaKeySystemAccess=rb):console.debug("EmeEncryptionSchemePolyfill: EME not found")}function rb(e,i){var r=this,s;return z(function(o){return o.g==1?(console.assert(r==navigator,'bad "this" for requestMediaKeySystemAccess'),C(o,co.call(r,e,i),2)):(s=o.h,Gx(s)?(console.debug("EmeEncryptionSchemePolyfill: Native encryptionScheme support found."),navigator.requestMediaKeySystemAccess=co,o.return(s)):(console.debug("EmeEncryptionSchemePolyfill: No native encryptionScheme support found. Patching encryptionScheme support."),navigator.requestMediaKeySystemAccess=Ux,o.return(Ux.call(r,e,i))))})}function Ux(e,i){var r=this,s,o,l,h,d,g,_,y,S,w;return z(function(E){if(E.g==1){for(console.assert(r==navigator,'bad "this" for requestMediaKeySystemAccess'),s=Wx(e),o=[],l=v(i),h=l.next();!h.done;h=l.next())d=h.value,g=zx(d.videoCapabilities,s),_=zx(d.audioCapabilities,s),d.videoCapabilities&&d.videoCapabilities.length&&!g.length||d.audioCapabilities&&d.audioCapabilities.length&&!_.length||(y=Object.assign({},d),y.videoCapabilities=g,y.audioCapabilities=_,o.push(y));if(!o.length)throw S=Error("Unsupported keySystem or supportedConfigurations."),S.name="NotSupportedError",S.code=DOMException.NOT_SUPPORTED_ERR,S;return C(E,co.call(r,e,o),2)}return w=E.h,E.return(new Il(w,s))})}function zx(e,i){return e&&e.filter(function(r){return!r.encryptionScheme||r.encryptionScheme==i})}te("EmeEncryptionSchemePolyfill",Fx),Fx.install=Nx;function Bx(){}var fo;function jx(){fo?console.debug("McEncryptionSchemePolyfill: Already installed."):navigator.mediaCapabilities?(fo=navigator.mediaCapabilities.decodingInfo,console.debug("McEncryptionSchemePolyfill: Waiting to detect encryptionScheme support."),navigator.mediaCapabilities.decodingInfo=nb):console.debug("McEncryptionSchemePolyfill: MediaCapabilities not found")}function nb(e){var i=this,r,s,o;return z(function(l){switch(l.g){case 1:return console.assert(i==navigator.mediaCapabilities,'bad "this" for decodingInfo'),C(l,fo.call(i,e),2);case 2:if(r=l.h,!e.keySystemConfiguration)return l.return(r);if((s=r.keySystemAccess)&&Gx(s))return console.debug("McEncryptionSchemePolyfill: Native encryptionScheme support found."),navigator.mediaCapabilities.decodingInfo=fo,l.return(r);if(console.debug("McEncryptionSchemePolyfill: No native encryptionScheme support found. Patching encryptionScheme support."),navigator.mediaCapabilities.decodingInfo=Hx,s){l.A(3);break}return o=r,C(l,Vx(e),4);case 4:return o.keySystemAccess=l.h,l.return(r);case 3:return l.return(Hx.call(i,e))}})}function Hx(e){var i=this,r,s,o,l,h,d,g,_;return z(function(y){switch(y.g){case 1:return console.assert(i==navigator.mediaCapabilities,'bad "this" for decodingInfo'),r=null,e.keySystemConfiguration&&(s=e.keySystemConfiguration,o=s.keySystem,l=s.audio&&s.audio.encryptionScheme,h=s.video&&s.video.encryptionScheme,r=Wx(o),d={powerEfficient:!1,smooth:!1,supported:!1,keySystemAccess:null,configuration:e},l&&l!=r||h&&h!=r)?y.return(d):C(y,fo.call(i,e),2);case 2:if(g=y.h,g.keySystemAccess){g.keySystemAccess=new Il(g.keySystemAccess,r),y.A(3);break}if(!e.keySystemConfiguration){y.A(3);break}return _=g,C(y,Vx(e),5);case 5:_.keySystemAccess=y.h;case 3:return y.return(g)}})}function Vx(e){var i,r;return z(function(s){if(s.g==1){var o=e.keySystemConfiguration,l=[],h=[];return o.audio&&l.push({robustness:o.audio.robustness||"",contentType:e.audio.contentType}),o.video&&h.push({robustness:o.video.robustness||"",contentType:e.video.contentType}),o={initDataTypes:o.initDataType?[o.initDataType]:[],distinctiveIdentifier:o.distinctiveIdentifier,persistentState:o.persistentState,sessionTypes:o.sessionTypes},l.length&&(o.audioCapabilities=l),h.length&&(o.videoCapabilities=h),i=o,C(s,navigator.requestMediaKeySystemAccess(e.keySystemConfiguration.keySystem,[i]),2)}return r=s.h,s.return(r)})}te("McEncryptionSchemePolyfill",Bx),Bx.install=jx;function Il(e,i){this.h=e,this.g=i,this.keySystem=e.keySystem}Il.prototype.getConfiguration=function(){var e=this.h.getConfiguration();if(e.videoCapabilities)for(var i=v(e.videoCapabilities),r=i.next();!r.done;r=i.next())r.value.encryptionScheme=this.g;if(e.audioCapabilities)for(i=v(e.audioCapabilities),r=i.next();!r.done;r=i.next())r.value.encryptionScheme=this.g;return e},Il.prototype.createMediaKeys=function(){return this.h.createMediaKeys()};function Wx(e){return e.startsWith("com.widevine")||e.startsWith("com.microsoft")||e.startsWith("com.chromecast")||e.startsWith("com.adobe")||e.startsWith("org.w3")?"cenc":e.startsWith("com.apple")?"cbcs-1-9":(console.warn("EmeEncryptionSchemePolyfill: Unknown key system:",e,"Please contribute!"),null)}function Gx(e){e=e.getConfiguration();var i=e.audioCapabilities&&e.audioCapabilities[0];return!!((e=e.videoCapabilities&&e.videoCapabilities[0]||i)&&e.encryptionScheme!==void 0)}function ld(){}function Xx(){Nx(),jx()}te("EncryptionSchemePolyfills",ld),ld.install=Xx,typeof m<"u"&&m.exports&&(m.exports=ld)}).call(n,t,t,void 0);for(var a in n.shaka)c[a]=n.shaka[a]})()})(lT);const qL=f0(lT);class $L extends J.Component{constructor(){super(...arguments),this.videoUrl="http://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4",this.index=1,this.contentId="",this._isPlaying=!0,this._loadPlayback=async(t,n)=>{this._setupShakaPlayer(n),await this._player.load(t)},this._unloadPlayback=async()=>{await this._player.unload()}}static _template(){return{Wrapper:{alpha:1,BackButton:{x:40,y:40,zIndex:99,type:pu},PlayPause:{type:kL}}}}set params(t){const{id:n}=t;this.contentId=n}_firstActive(){sn.consumer(this),sn.loader(this._loadPlayback),sn.unloader(this._unloadPlayback)}_init(){}_active(){sn.open(this.videoUrl)}_inactive(){sn.close()}_handleUp(){this.index>0&&(this.index-=1)}_handleDown(){this.index<1&&(this.index+=1)}_handleEnter(){if(this.index===0)Pt.navigate(`content/railItem/${this.contentId}`);else if(this.index===1){const t=this.tag("PlayPause");t.isPlaying=!t.isPlaying,t.isPlaying?sn.play():sn.pause()}}_getFocused(){return this.tag("Wrapper").children[this.index]}_setupShakaPlayer(t){t.autoplay=!0,this._player=new qL.Player(t),console.log(this._player)}}class YL extends J.Component{constructor(){super(...arguments),this.data={}}static _template(){return{rect:!0,color:ee.colors.primary,shader:{type:J.shaders.RoundedRectangle,radius:20},Image:{shader:{type:J.shaders.RoundedRectangle,radius:20}},Label:{x:10,y:435,w:t=>t,color:ee.colors.accentGrey.light,text:{fontSize:30}}}}set item(t){const{label:n,src:a,data:u}=t;this.data=u,this.patch({Image:{src:a},Label:{text:n==null?void 0:n.toString()}})}_handleEnter(){Pt.navigate(`content/gridItem/${this.data.uid}`,{contentData:this.data,from:"Grid"})}_focus(){this.patch({smooth:{color:ee.colors.secondary,scale:1.1},Label:{smooth:{color:ee.colors.white}},Rectangle:{color:ee.colors.yellow,x:10,y:t=>t+72,w:t=>t-20,h:5,rect:!0}})}_unfocus(){this.patch({smooth:{color:ee.colors.primary,scale:1},Label:{smooth:{color:ee.colors.accentGrey.light}},Rectangle:void 0})}}class KL extends J.Component{constructor(){super(...arguments),this.index=1,this.data=[],this.dataLength=0,this.intervalSub=0,this.isLoading=!0}static _template(){return{w:1920,h:1080,color:ee.colors.primaryLight,rect:!0,shader:{x:100,y:-100,pivot:.5,type:J.shaders.RadialGradient,outerColor:ee.colors.primaryLight,innerColor:ee.colors.dark,radius:800},BackButton:{x:40,y:40,shader:null,type:pu},Content:{Grid:{x:110,y:200,columns:5,spacing:160,crossSpacing:50,itemType:YL,type:FL}}}}_init(){this.setLongRail()}async setLongRail(){var n,a,u;this.isLoading=!0,this.data=await cf.get("longData"),this.dataLength=this.data.length;const t=[];for(let f=0;f<this.dataLength;f++){let m=(n=this.data[f])==null?void 0:n.title,p=(u=(a=this.data[f])==null?void 0:a.images.find(x=>x.width===288))==null?void 0:u.url;t.push({w:288,h:432,item:{label:m,src:p||"https://pmd205470tn-a.akamaihd.net/D2C_-_Content/191/249/oyPcsfGWL5Se6RGW1JCVgpHlASH_288x432_13635141800.jpg",data:this.data[f]}})}this.tag("Grid").add(t.map(f=>f)),this.isLoading=!1}_getFocused(){return this.index===0?this.tag("BackButton"):this.tag("Grid")}_handleUp(){this.index>0&&(this.index-=1)}_handleDown(){this.index<1&&(this.index+=1)}_handleEnter(){this.index===0&&Pt.navigate("home")}}const ZL={root:"home",routes:[{path:"home",component:kv},{path:"search",component:VL},{path:"grid",component:KL},{path:"settings",component:kv},{path:"content/:from/:id",component:XL,options:{reuseInstance:!1}},{path:"player/:id",component:$L}]};class QL extends Pt.App{_setup(){Pt.startRouter(ZL,this)}static getFonts(){return[{family:"Saira Regular",url:Io.asset("fonts/Saira-VariableFont_wdth,wght.ttf"),descriptors:{weight:"1 1000"}},{family:"Saira Italics",url:Io.asset("fonts/Saira-Italic-VariableFont_wdth,wght.ttf"),descriptors:{weight:"1 1000"}}]}}const JL=_R(QL,{stage:{pauseRafLoopOnIdle:!0,fontSharp:!0},debug:!0,enablePointer:!0,keys:{38:"Up",40:"Down",37:"Left",39:"Right",13:"Enter",8:"Back",27:"Exit"}},{}),eM=JL.stage.getCanvas();document.body.appendChild(eM);export{nM as __vite_legacy_guard};
//# sourceMappingURL=index-a9449e91.js.map
